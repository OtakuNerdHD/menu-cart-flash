var jP=e=>{throw TypeError(e)};var S2=(e,n,o)=>n.has(e)||jP("Cannot "+o);var qt=(e,n,o)=>(S2(e,n,"read from private field"),o?o.call(e):n.get(e)),qn=(e,n,o)=>n.has(e)?jP("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,o),gn=(e,n,o,u)=>(S2(e,n,"write to private field"),u?u.call(e,o):n.set(e,o),o),zs=(e,n,o)=>(S2(e,n,"access private method"),o);var L0=(e,n,o,u)=>({set _(g){gn(e,n,g,o)},get _(){return qt(e,n,u)}});function N6(e,n){for(var o=0;o<n.length;o++){const u=n[o];if(typeof u!="string"&&!Array.isArray(u)){for(const g in u)if(g!=="default"&&!(g in e)){const b=Object.getOwnPropertyDescriptor(u,g);b&&Object.defineProperty(e,g,b.get?b:{enumerable:!0,get:()=>u[g]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))u(g);new MutationObserver(g=>{for(const b of g)if(b.type==="childList")for(const C of b.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&u(C)}).observe(document,{childList:!0,subtree:!0});function o(g){const b={};return g.integrity&&(b.integrity=g.integrity),g.referrerPolicy&&(b.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?b.credentials="include":g.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function u(g){if(g.ep)return;g.ep=!0;const b=o(g);fetch(g.href,b)}})();var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function O6(e){if(e.__esModule)return e;var n=e.default;if(typeof n=="function"){var o=function u(){return this instanceof u?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};o.prototype=n.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach(function(u){var g=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(o,u,g.get?g:{enumerable:!0,get:function(){return e[u]}})}),o}var k3={exports:{}},w1={},D3={exports:{}},Sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var My=Symbol.for("react.element"),z6=Symbol.for("react.portal"),j6=Symbol.for("react.fragment"),F6=Symbol.for("react.strict_mode"),B6=Symbol.for("react.profiler"),U6=Symbol.for("react.provider"),V6=Symbol.for("react.context"),$6=Symbol.for("react.forward_ref"),G6=Symbol.for("react.suspense"),q6=Symbol.for("react.memo"),H6=Symbol.for("react.lazy"),FP=Symbol.iterator;function W6(e){return e===null||typeof e!="object"?null:(e=FP&&e[FP]||e["@@iterator"],typeof e=="function"?e:null)}var L3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N3=Object.assign,O3={};function rm(e,n,o){this.props=e,this.context=n,this.refs=O3,this.updater=o||L3}rm.prototype.isReactComponent={};rm.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};rm.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function z3(){}z3.prototype=rm.prototype;function iE(e,n,o){this.props=e,this.context=n,this.refs=O3,this.updater=o||L3}var sE=iE.prototype=new z3;sE.constructor=iE;N3(sE,rm.prototype);sE.isPureReactComponent=!0;var BP=Array.isArray,j3=Object.prototype.hasOwnProperty,oE={current:null},F3={key:!0,ref:!0,__self:!0,__source:!0};function B3(e,n,o){var u,g={},b=null,C=null;if(n!=null)for(u in n.ref!==void 0&&(C=n.ref),n.key!==void 0&&(b=""+n.key),n)j3.call(n,u)&&!F3.hasOwnProperty(u)&&(g[u]=n[u]);var i=arguments.length-2;if(i===1)g.children=o;else if(1<i){for(var L=Array(i),O=0;O<i;O++)L[O]=arguments[O+2];g.children=L}if(e&&e.defaultProps)for(u in i=e.defaultProps,i)g[u]===void 0&&(g[u]=i[u]);return{$$typeof:My,type:e,key:b,ref:C,props:g,_owner:oE.current}}function Z6(e,n){return{$$typeof:My,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function aE(e){return typeof e=="object"&&e!==null&&e.$$typeof===My}function X6(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(o){return n[o]})}var UP=/\/+/g;function T2(e,n){return typeof e=="object"&&e!==null&&e.key!=null?X6(""+e.key):n.toString(36)}function px(e,n,o,u,g){var b=typeof e;(b==="undefined"||b==="boolean")&&(e=null);var C=!1;if(e===null)C=!0;else switch(b){case"string":case"number":C=!0;break;case"object":switch(e.$$typeof){case My:case z6:C=!0}}if(C)return C=e,g=g(C),e=u===""?"."+T2(C,0):u,BP(g)?(o="",e!=null&&(o=e.replace(UP,"$&/")+"/"),px(g,n,o,"",function(O){return O})):g!=null&&(aE(g)&&(g=Z6(g,o+(!g.key||C&&C.key===g.key?"":(""+g.key).replace(UP,"$&/")+"/")+e)),n.push(g)),1;if(C=0,u=u===""?".":u+":",BP(e))for(var i=0;i<e.length;i++){b=e[i];var L=u+T2(b,i);C+=px(b,n,o,L,g)}else if(L=W6(e),typeof L=="function")for(e=L.call(e),i=0;!(b=e.next()).done;)b=b.value,L=u+T2(b,i++),C+=px(b,n,o,L,g);else if(b==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return C}function N0(e,n,o){if(e==null)return e;var u=[],g=0;return px(e,u,"","",function(b){return n.call(o,b,g++)}),u}function K6(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(o){(e._status===0||e._status===-1)&&(e._status=1,e._result=o)},function(o){(e._status===0||e._status===-1)&&(e._status=2,e._result=o)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var io={current:null},mx={transition:null},Y6={ReactCurrentDispatcher:io,ReactCurrentBatchConfig:mx,ReactCurrentOwner:oE};function U3(){throw Error("act(...) is not supported in production builds of React.")}Sn.Children={map:N0,forEach:function(e,n,o){N0(e,function(){n.apply(this,arguments)},o)},count:function(e){var n=0;return N0(e,function(){n++}),n},toArray:function(e){return N0(e,function(n){return n})||[]},only:function(e){if(!aE(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Sn.Component=rm;Sn.Fragment=j6;Sn.Profiler=B6;Sn.PureComponent=iE;Sn.StrictMode=F6;Sn.Suspense=G6;Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y6;Sn.act=U3;Sn.cloneElement=function(e,n,o){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var u=N3({},e.props),g=e.key,b=e.ref,C=e._owner;if(n!=null){if(n.ref!==void 0&&(b=n.ref,C=oE.current),n.key!==void 0&&(g=""+n.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(L in n)j3.call(n,L)&&!F3.hasOwnProperty(L)&&(u[L]=n[L]===void 0&&i!==void 0?i[L]:n[L])}var L=arguments.length-2;if(L===1)u.children=o;else if(1<L){i=Array(L);for(var O=0;O<L;O++)i[O]=arguments[O+2];u.children=i}return{$$typeof:My,type:e.type,key:g,ref:b,props:u,_owner:C}};Sn.createContext=function(e){return e={$$typeof:V6,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:U6,_context:e},e.Consumer=e};Sn.createElement=B3;Sn.createFactory=function(e){var n=B3.bind(null,e);return n.type=e,n};Sn.createRef=function(){return{current:null}};Sn.forwardRef=function(e){return{$$typeof:$6,render:e}};Sn.isValidElement=aE;Sn.lazy=function(e){return{$$typeof:H6,_payload:{_status:-1,_result:e},_init:K6}};Sn.memo=function(e,n){return{$$typeof:q6,type:e,compare:n===void 0?null:n}};Sn.startTransition=function(e){var n=mx.transition;mx.transition={};try{e()}finally{mx.transition=n}};Sn.unstable_act=U3;Sn.useCallback=function(e,n){return io.current.useCallback(e,n)};Sn.useContext=function(e){return io.current.useContext(e)};Sn.useDebugValue=function(){};Sn.useDeferredValue=function(e){return io.current.useDeferredValue(e)};Sn.useEffect=function(e,n){return io.current.useEffect(e,n)};Sn.useId=function(){return io.current.useId()};Sn.useImperativeHandle=function(e,n,o){return io.current.useImperativeHandle(e,n,o)};Sn.useInsertionEffect=function(e,n){return io.current.useInsertionEffect(e,n)};Sn.useLayoutEffect=function(e,n){return io.current.useLayoutEffect(e,n)};Sn.useMemo=function(e,n){return io.current.useMemo(e,n)};Sn.useReducer=function(e,n,o){return io.current.useReducer(e,n,o)};Sn.useRef=function(e){return io.current.useRef(e)};Sn.useState=function(e){return io.current.useState(e)};Sn.useSyncExternalStore=function(e,n,o){return io.current.useSyncExternalStore(e,n,o)};Sn.useTransition=function(){return io.current.useTransition()};Sn.version="18.3.1";D3.exports=Sn;var Z=D3.exports;const tr=nE(Z),V3=N6({__proto__:null,default:tr},[Z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J6=Z,Q6=Symbol.for("react.element"),eU=Symbol.for("react.fragment"),tU=Object.prototype.hasOwnProperty,rU=J6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nU={key:!0,ref:!0,__self:!0,__source:!0};function $3(e,n,o){var u,g={},b=null,C=null;o!==void 0&&(b=""+o),n.key!==void 0&&(b=""+n.key),n.ref!==void 0&&(C=n.ref);for(u in n)tU.call(n,u)&&!nU.hasOwnProperty(u)&&(g[u]=n[u]);if(e&&e.defaultProps)for(u in n=e.defaultProps,n)g[u]===void 0&&(g[u]=n[u]);return{$$typeof:Q6,type:e,key:b,ref:C,props:g,_owner:rU.current}}w1.Fragment=eU;w1.jsx=$3;w1.jsxs=$3;k3.exports=w1;var w=k3.exports,G3={exports:{}},Ko={},q3={exports:{}},H3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(ct,Je){var rt=ct.length;ct.push(Je);e:for(;0<rt;){var bt=rt-1>>>1,kt=ct[bt];if(0<g(kt,Je))ct[bt]=Je,ct[rt]=kt,rt=bt;else break e}}function o(ct){return ct.length===0?null:ct[0]}function u(ct){if(ct.length===0)return null;var Je=ct[0],rt=ct.pop();if(rt!==Je){ct[0]=rt;e:for(var bt=0,kt=ct.length,At=kt>>>1;bt<At;){var _r=2*(bt+1)-1,cn=ct[_r],pr=_r+1,Dt=ct[pr];if(0>g(cn,rt))pr<kt&&0>g(Dt,cn)?(ct[bt]=Dt,ct[pr]=rt,bt=pr):(ct[bt]=cn,ct[_r]=rt,bt=_r);else if(pr<kt&&0>g(Dt,rt))ct[bt]=Dt,ct[pr]=rt,bt=pr;else break e}}return Je}function g(ct,Je){var rt=ct.sortIndex-Je.sortIndex;return rt!==0?rt:ct.id-Je.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;e.unstable_now=function(){return b.now()}}else{var C=Date,i=C.now();e.unstable_now=function(){return C.now()-i}}var L=[],O=[],U=1,q=null,G=3,ie=!1,J=!1,K=!1,re=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(ct){for(var Je=o(O);Je!==null;){if(Je.callback===null)u(O);else if(Je.startTime<=ct)u(O),Je.sortIndex=Je.expirationTime,n(L,Je);else break;Je=o(O)}}function fe(ct){if(K=!1,ue(ct),!J)if(o(L)!==null)J=!0,Tt(ge);else{var Je=o(O);Je!==null&&Gt(fe,Je.startTime-ct)}}function ge(ct,Je){J=!1,K&&(K=!1,Q(Be),Be=-1),ie=!0;var rt=G;try{for(ue(Je),q=o(L);q!==null&&(!(q.expirationTime>Je)||ct&&!qe());){var bt=q.callback;if(typeof bt=="function"){q.callback=null,G=q.priorityLevel;var kt=bt(q.expirationTime<=Je);Je=e.unstable_now(),typeof kt=="function"?q.callback=kt:q===o(L)&&u(L),ue(Je)}else u(L);q=o(L)}if(q!==null)var At=!0;else{var _r=o(O);_r!==null&&Gt(fe,_r.startTime-Je),At=!1}return At}finally{q=null,G=rt,ie=!1}}var ke=!1,Ce=null,Be=-1,dt=5,Qe=-1;function qe(){return!(e.unstable_now()-Qe<dt)}function He(){if(Ce!==null){var ct=e.unstable_now();Qe=ct;var Je=!0;try{Je=Ce(!0,ct)}finally{Je?et():(ke=!1,Ce=null)}}else ke=!1}var et;if(typeof ee=="function")et=function(){ee(He)};else if(typeof MessageChannel<"u"){var mt=new MessageChannel,Ze=mt.port2;mt.port1.onmessage=He,et=function(){Ze.postMessage(null)}}else et=function(){re(He,0)};function Tt(ct){Ce=ct,ke||(ke=!0,et())}function Gt(ct,Je){Be=re(function(){ct(e.unstable_now())},Je)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ct){ct.callback=null},e.unstable_continueExecution=function(){J||ie||(J=!0,Tt(ge))},e.unstable_forceFrameRate=function(ct){0>ct||125<ct?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):dt=0<ct?Math.floor(1e3/ct):5},e.unstable_getCurrentPriorityLevel=function(){return G},e.unstable_getFirstCallbackNode=function(){return o(L)},e.unstable_next=function(ct){switch(G){case 1:case 2:case 3:var Je=3;break;default:Je=G}var rt=G;G=Je;try{return ct()}finally{G=rt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ct,Je){switch(ct){case 1:case 2:case 3:case 4:case 5:break;default:ct=3}var rt=G;G=ct;try{return Je()}finally{G=rt}},e.unstable_scheduleCallback=function(ct,Je,rt){var bt=e.unstable_now();switch(typeof rt=="object"&&rt!==null?(rt=rt.delay,rt=typeof rt=="number"&&0<rt?bt+rt:bt):rt=bt,ct){case 1:var kt=-1;break;case 2:kt=250;break;case 5:kt=1073741823;break;case 4:kt=1e4;break;default:kt=5e3}return kt=rt+kt,ct={id:U++,callback:Je,priorityLevel:ct,startTime:rt,expirationTime:kt,sortIndex:-1},rt>bt?(ct.sortIndex=rt,n(O,ct),o(L)===null&&ct===o(O)&&(K?(Q(Be),Be=-1):K=!0,Gt(fe,rt-bt))):(ct.sortIndex=kt,n(L,ct),J||ie||(J=!0,Tt(ge))),ct},e.unstable_shouldYield=qe,e.unstable_wrapCallback=function(ct){var Je=G;return function(){var rt=G;G=Je;try{return ct.apply(this,arguments)}finally{G=rt}}}})(H3);q3.exports=H3;var iU=q3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sU=Z,Xo=iU;function Yt(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var W3=new Set,X_={};function Dh(e,n){Hp(e,n),Hp(e+"Capture",n)}function Hp(e,n){for(X_[e]=n,e=0;e<n.length;e++)W3.add(n[e])}var hc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),SS=Object.prototype.hasOwnProperty,oU=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,VP={},$P={};function aU(e){return SS.call($P,e)?!0:SS.call(VP,e)?!1:oU.test(e)?$P[e]=!0:(VP[e]=!0,!1)}function lU(e,n,o,u){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return u?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function cU(e,n,o,u){if(n===null||typeof n>"u"||lU(e,n,o,u))return!0;if(u)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function so(e,n,o,u,g,b,C){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=u,this.attributeNamespace=g,this.mustUseProperty=o,this.propertyName=e,this.type=n,this.sanitizeURL=b,this.removeEmptyString=C}var Ms={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ms[e]=new so(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];Ms[n]=new so(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ms[e]=new so(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ms[e]=new so(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ms[e]=new so(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ms[e]=new so(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ms[e]=new so(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ms[e]=new so(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ms[e]=new so(e,5,!1,e.toLowerCase(),null,!1,!1)});var lE=/[\-:]([a-z])/g;function cE(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(lE,cE);Ms[n]=new so(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(lE,cE);Ms[n]=new so(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(lE,cE);Ms[n]=new so(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ms[e]=new so(e,1,!1,e.toLowerCase(),null,!1,!1)});Ms.xlinkHref=new so("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ms[e]=new so(e,1,!1,e.toLowerCase(),null,!0,!0)});function uE(e,n,o,u){var g=Ms.hasOwnProperty(n)?Ms[n]:null;(g!==null?g.type!==0:u||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(cU(n,o,g,u)&&(o=null),u||g===null?aU(n)&&(o===null?e.removeAttribute(n):e.setAttribute(n,""+o)):g.mustUseProperty?e[g.propertyName]=o===null?g.type===3?!1:"":o:(n=g.attributeName,u=g.attributeNamespace,o===null?e.removeAttribute(n):(g=g.type,o=g===3||g===4&&o===!0?"":""+o,u?e.setAttributeNS(u,n,o):e.setAttribute(n,o))))}var yc=sU.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O0=Symbol.for("react.element"),up=Symbol.for("react.portal"),dp=Symbol.for("react.fragment"),dE=Symbol.for("react.strict_mode"),TS=Symbol.for("react.profiler"),Z3=Symbol.for("react.provider"),X3=Symbol.for("react.context"),hE=Symbol.for("react.forward_ref"),ES=Symbol.for("react.suspense"),CS=Symbol.for("react.suspense_list"),fE=Symbol.for("react.memo"),Tu=Symbol.for("react.lazy"),K3=Symbol.for("react.offscreen"),GP=Symbol.iterator;function f_(e){return e===null||typeof e!="object"?null:(e=GP&&e[GP]||e["@@iterator"],typeof e=="function"?e:null)}var Ai=Object.assign,E2;function T_(e){if(E2===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);E2=n&&n[1]||""}return`
`+E2+e}var C2=!1;function A2(e,n){if(!e||C2)return"";C2=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(O){var u=O}Reflect.construct(e,[],n)}else{try{n.call()}catch(O){u=O}e.call(n.prototype)}else{try{throw Error()}catch(O){u=O}e()}}catch(O){if(O&&u&&typeof O.stack=="string"){for(var g=O.stack.split(`
`),b=u.stack.split(`
`),C=g.length-1,i=b.length-1;1<=C&&0<=i&&g[C]!==b[i];)i--;for(;1<=C&&0<=i;C--,i--)if(g[C]!==b[i]){if(C!==1||i!==1)do if(C--,i--,0>i||g[C]!==b[i]){var L=`
`+g[C].replace(" at new "," at ");return e.displayName&&L.includes("<anonymous>")&&(L=L.replace("<anonymous>",e.displayName)),L}while(1<=C&&0<=i);break}}}finally{C2=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?T_(e):""}function uU(e){switch(e.tag){case 5:return T_(e.type);case 16:return T_("Lazy");case 13:return T_("Suspense");case 19:return T_("SuspenseList");case 0:case 2:case 15:return e=A2(e.type,!1),e;case 11:return e=A2(e.type.render,!1),e;case 1:return e=A2(e.type,!0),e;default:return""}}function AS(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case dp:return"Fragment";case up:return"Portal";case TS:return"Profiler";case dE:return"StrictMode";case ES:return"Suspense";case CS:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case X3:return(e.displayName||"Context")+".Consumer";case Z3:return(e._context.displayName||"Context")+".Provider";case hE:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case fE:return n=e.displayName||null,n!==null?n:AS(e.type)||"Memo";case Tu:n=e._payload,e=e._init;try{return AS(e(n))}catch{}}return null}function dU(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return AS(n);case 8:return n===dE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Zu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Y3(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function hU(e){var n=Y3(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),u=""+e[n];if(!e.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var g=o.get,b=o.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return g.call(this)},set:function(C){u=""+C,b.call(this,C)}}),Object.defineProperty(e,n,{enumerable:o.enumerable}),{getValue:function(){return u},setValue:function(C){u=""+C},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function z0(e){e._valueTracker||(e._valueTracker=hU(e))}function J3(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var o=n.getValue(),u="";return e&&(u=Y3(e)?e.checked?"true":"false":e.value),e=u,e!==o?(n.setValue(e),!0):!1}function kx(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function MS(e,n){var o=n.checked;return Ai({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function qP(e,n){var o=n.defaultValue==null?"":n.defaultValue,u=n.checked!=null?n.checked:n.defaultChecked;o=Zu(n.value!=null?n.value:o),e._wrapperState={initialChecked:u,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function Q3(e,n){n=n.checked,n!=null&&uE(e,"checked",n,!1)}function IS(e,n){Q3(e,n);var o=Zu(n.value),u=n.type;if(o!=null)u==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(u==="submit"||u==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?PS(e,n.type,o):n.hasOwnProperty("defaultValue")&&PS(e,n.type,Zu(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function HP(e,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var u=n.type;if(!(u!=="submit"&&u!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,o||n===e.value||(e.value=n),e.defaultValue=n}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function PS(e,n,o){(n!=="number"||kx(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var E_=Array.isArray;function Ap(e,n,o,u){if(e=e.options,n){n={};for(var g=0;g<o.length;g++)n["$"+o[g]]=!0;for(o=0;o<e.length;o++)g=n.hasOwnProperty("$"+e[o].value),e[o].selected!==g&&(e[o].selected=g),g&&u&&(e[o].defaultSelected=!0)}else{for(o=""+Zu(o),n=null,g=0;g<e.length;g++){if(e[g].value===o){e[g].selected=!0,u&&(e[g].defaultSelected=!0);return}n!==null||e[g].disabled||(n=e[g])}n!==null&&(n.selected=!0)}}function RS(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Yt(91));return Ai({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function WP(e,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(Yt(92));if(E_(o)){if(1<o.length)throw Error(Yt(93));o=o[0]}n=o}n==null&&(n=""),o=n}e._wrapperState={initialValue:Zu(o)}}function eD(e,n){var o=Zu(n.value),u=Zu(n.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),n.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),u!=null&&(e.defaultValue=""+u)}function ZP(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function tD(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function kS(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?tD(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var j0,rD=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,u,g){MSApp.execUnsafeLocalFunction(function(){return e(n,o,u,g)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(j0=j0||document.createElement("div"),j0.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=j0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function K_(e,n){if(n){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=n;return}}e.textContent=n}var N_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fU=["Webkit","ms","Moz","O"];Object.keys(N_).forEach(function(e){fU.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),N_[n]=N_[e]})});function nD(e,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||N_.hasOwnProperty(e)&&N_[e]?(""+n).trim():n+"px"}function iD(e,n){e=e.style;for(var o in n)if(n.hasOwnProperty(o)){var u=o.indexOf("--")===0,g=nD(o,n[o],u);o==="float"&&(o="cssFloat"),u?e.setProperty(o,g):e[o]=g}}var pU=Ai({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function DS(e,n){if(n){if(pU[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Yt(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Yt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Yt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Yt(62))}}function LS(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var NS=null;function pE(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var OS=null,Mp=null,Ip=null;function XP(e){if(e=Ry(e)){if(typeof OS!="function")throw Error(Yt(280));var n=e.stateNode;n&&(n=A1(n),OS(e.stateNode,e.type,n))}}function sD(e){Mp?Ip?Ip.push(e):Ip=[e]:Mp=e}function oD(){if(Mp){var e=Mp,n=Ip;if(Ip=Mp=null,XP(e),n)for(e=0;e<n.length;e++)XP(n[e])}}function aD(e,n){return e(n)}function lD(){}var M2=!1;function cD(e,n,o){if(M2)return e(n,o);M2=!0;try{return aD(e,n,o)}finally{M2=!1,(Mp!==null||Ip!==null)&&(lD(),oD())}}function Y_(e,n){var o=e.stateNode;if(o===null)return null;var u=A1(o);if(u===null)return null;o=u[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(e=e.type,u=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!u;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(Yt(231,n,typeof o));return o}var zS=!1;if(hc)try{var p_={};Object.defineProperty(p_,"passive",{get:function(){zS=!0}}),window.addEventListener("test",p_,p_),window.removeEventListener("test",p_,p_)}catch{zS=!1}function mU(e,n,o,u,g,b,C,i,L){var O=Array.prototype.slice.call(arguments,3);try{n.apply(o,O)}catch(U){this.onError(U)}}var O_=!1,Dx=null,Lx=!1,jS=null,gU={onError:function(e){O_=!0,Dx=e}};function _U(e,n,o,u,g,b,C,i,L){O_=!1,Dx=null,mU.apply(gU,arguments)}function yU(e,n,o,u,g,b,C,i,L){if(_U.apply(this,arguments),O_){if(O_){var O=Dx;O_=!1,Dx=null}else throw Error(Yt(198));Lx||(Lx=!0,jS=O)}}function Lh(e){var n=e,o=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(o=n.return),e=n.return;while(e)}return n.tag===3?o:null}function uD(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function KP(e){if(Lh(e)!==e)throw Error(Yt(188))}function vU(e){var n=e.alternate;if(!n){if(n=Lh(e),n===null)throw Error(Yt(188));return n!==e?null:e}for(var o=e,u=n;;){var g=o.return;if(g===null)break;var b=g.alternate;if(b===null){if(u=g.return,u!==null){o=u;continue}break}if(g.child===b.child){for(b=g.child;b;){if(b===o)return KP(g),e;if(b===u)return KP(g),n;b=b.sibling}throw Error(Yt(188))}if(o.return!==u.return)o=g,u=b;else{for(var C=!1,i=g.child;i;){if(i===o){C=!0,o=g,u=b;break}if(i===u){C=!0,u=g,o=b;break}i=i.sibling}if(!C){for(i=b.child;i;){if(i===o){C=!0,o=b,u=g;break}if(i===u){C=!0,u=b,o=g;break}i=i.sibling}if(!C)throw Error(Yt(189))}}if(o.alternate!==u)throw Error(Yt(190))}if(o.tag!==3)throw Error(Yt(188));return o.stateNode.current===o?e:n}function dD(e){return e=vU(e),e!==null?hD(e):null}function hD(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=hD(e);if(n!==null)return n;e=e.sibling}return null}var fD=Xo.unstable_scheduleCallback,YP=Xo.unstable_cancelCallback,xU=Xo.unstable_shouldYield,bU=Xo.unstable_requestPaint,Vi=Xo.unstable_now,wU=Xo.unstable_getCurrentPriorityLevel,mE=Xo.unstable_ImmediatePriority,pD=Xo.unstable_UserBlockingPriority,Nx=Xo.unstable_NormalPriority,SU=Xo.unstable_LowPriority,mD=Xo.unstable_IdlePriority,S1=null,Rl=null;function TU(e){if(Rl&&typeof Rl.onCommitFiberRoot=="function")try{Rl.onCommitFiberRoot(S1,e,void 0,(e.current.flags&128)===128)}catch{}}var Za=Math.clz32?Math.clz32:AU,EU=Math.log,CU=Math.LN2;function AU(e){return e>>>=0,e===0?32:31-(EU(e)/CU|0)|0}var F0=64,B0=4194304;function C_(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ox(e,n){var o=e.pendingLanes;if(o===0)return 0;var u=0,g=e.suspendedLanes,b=e.pingedLanes,C=o&268435455;if(C!==0){var i=C&~g;i!==0?u=C_(i):(b&=C,b!==0&&(u=C_(b)))}else C=o&~g,C!==0?u=C_(C):b!==0&&(u=C_(b));if(u===0)return 0;if(n!==0&&n!==u&&!(n&g)&&(g=u&-u,b=n&-n,g>=b||g===16&&(b&4194240)!==0))return n;if(u&4&&(u|=o&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=u;0<n;)o=31-Za(n),g=1<<o,u|=e[o],n&=~g;return u}function MU(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function IU(e,n){for(var o=e.suspendedLanes,u=e.pingedLanes,g=e.expirationTimes,b=e.pendingLanes;0<b;){var C=31-Za(b),i=1<<C,L=g[C];L===-1?(!(i&o)||i&u)&&(g[C]=MU(i,n)):L<=n&&(e.expiredLanes|=i),b&=~i}}function FS(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gD(){var e=F0;return F0<<=1,!(F0&4194240)&&(F0=64),e}function I2(e){for(var n=[],o=0;31>o;o++)n.push(e);return n}function Iy(e,n,o){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-Za(n),e[n]=o}function PU(e,n){var o=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var u=e.eventTimes;for(e=e.expirationTimes;0<o;){var g=31-Za(o),b=1<<g;n[g]=0,u[g]=-1,e[g]=-1,o&=~b}}function gE(e,n){var o=e.entangledLanes|=n;for(e=e.entanglements;o;){var u=31-Za(o),g=1<<u;g&n|e[u]&n&&(e[u]|=n),o&=~g}}var Wn=0;function _D(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var yD,_E,vD,xD,bD,BS=!1,U0=[],Fu=null,Bu=null,Uu=null,J_=new Map,Q_=new Map,Au=[],RU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function JP(e,n){switch(e){case"focusin":case"focusout":Fu=null;break;case"dragenter":case"dragleave":Bu=null;break;case"mouseover":case"mouseout":Uu=null;break;case"pointerover":case"pointerout":J_.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Q_.delete(n.pointerId)}}function m_(e,n,o,u,g,b){return e===null||e.nativeEvent!==b?(e={blockedOn:n,domEventName:o,eventSystemFlags:u,nativeEvent:b,targetContainers:[g]},n!==null&&(n=Ry(n),n!==null&&_E(n)),e):(e.eventSystemFlags|=u,n=e.targetContainers,g!==null&&n.indexOf(g)===-1&&n.push(g),e)}function kU(e,n,o,u,g){switch(n){case"focusin":return Fu=m_(Fu,e,n,o,u,g),!0;case"dragenter":return Bu=m_(Bu,e,n,o,u,g),!0;case"mouseover":return Uu=m_(Uu,e,n,o,u,g),!0;case"pointerover":var b=g.pointerId;return J_.set(b,m_(J_.get(b)||null,e,n,o,u,g)),!0;case"gotpointercapture":return b=g.pointerId,Q_.set(b,m_(Q_.get(b)||null,e,n,o,u,g)),!0}return!1}function wD(e){var n=ch(e.target);if(n!==null){var o=Lh(n);if(o!==null){if(n=o.tag,n===13){if(n=uD(o),n!==null){e.blockedOn=n,bD(e.priority,function(){vD(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gx(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var o=US(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var u=new o.constructor(o.type,o);NS=u,o.target.dispatchEvent(u),NS=null}else return n=Ry(o),n!==null&&_E(n),e.blockedOn=o,!1;n.shift()}return!0}function QP(e,n,o){gx(e)&&o.delete(n)}function DU(){BS=!1,Fu!==null&&gx(Fu)&&(Fu=null),Bu!==null&&gx(Bu)&&(Bu=null),Uu!==null&&gx(Uu)&&(Uu=null),J_.forEach(QP),Q_.forEach(QP)}function g_(e,n){e.blockedOn===n&&(e.blockedOn=null,BS||(BS=!0,Xo.unstable_scheduleCallback(Xo.unstable_NormalPriority,DU)))}function ey(e){function n(g){return g_(g,e)}if(0<U0.length){g_(U0[0],e);for(var o=1;o<U0.length;o++){var u=U0[o];u.blockedOn===e&&(u.blockedOn=null)}}for(Fu!==null&&g_(Fu,e),Bu!==null&&g_(Bu,e),Uu!==null&&g_(Uu,e),J_.forEach(n),Q_.forEach(n),o=0;o<Au.length;o++)u=Au[o],u.blockedOn===e&&(u.blockedOn=null);for(;0<Au.length&&(o=Au[0],o.blockedOn===null);)wD(o),o.blockedOn===null&&Au.shift()}var Pp=yc.ReactCurrentBatchConfig,zx=!0;function LU(e,n,o,u){var g=Wn,b=Pp.transition;Pp.transition=null;try{Wn=1,yE(e,n,o,u)}finally{Wn=g,Pp.transition=b}}function NU(e,n,o,u){var g=Wn,b=Pp.transition;Pp.transition=null;try{Wn=4,yE(e,n,o,u)}finally{Wn=g,Pp.transition=b}}function yE(e,n,o,u){if(zx){var g=US(e,n,o,u);if(g===null)F2(e,n,u,jx,o),JP(e,u);else if(kU(g,e,n,o,u))u.stopPropagation();else if(JP(e,u),n&4&&-1<RU.indexOf(e)){for(;g!==null;){var b=Ry(g);if(b!==null&&yD(b),b=US(e,n,o,u),b===null&&F2(e,n,u,jx,o),b===g)break;g=b}g!==null&&u.stopPropagation()}else F2(e,n,u,null,o)}}var jx=null;function US(e,n,o,u){if(jx=null,e=pE(u),e=ch(e),e!==null)if(n=Lh(e),n===null)e=null;else if(o=n.tag,o===13){if(e=uD(n),e!==null)return e;e=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return jx=e,null}function SD(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wU()){case mE:return 1;case pD:return 4;case Nx:case SU:return 16;case mD:return 536870912;default:return 16}default:return 16}}var Nu=null,vE=null,_x=null;function TD(){if(_x)return _x;var e,n=vE,o=n.length,u,g="value"in Nu?Nu.value:Nu.textContent,b=g.length;for(e=0;e<o&&n[e]===g[e];e++);var C=o-e;for(u=1;u<=C&&n[o-u]===g[b-u];u++);return _x=g.slice(e,1<u?1-u:void 0)}function yx(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function V0(){return!0}function eR(){return!1}function Yo(e){function n(o,u,g,b,C){this._reactName=o,this._targetInst=g,this.type=u,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(o=e[i],this[i]=o?o(b):b[i]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?V0:eR,this.isPropagationStopped=eR,this}return Ai(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=V0)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=V0)},persist:function(){},isPersistent:V0}),n}var nm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xE=Yo(nm),Py=Ai({},nm,{view:0,detail:0}),OU=Yo(Py),P2,R2,__,T1=Ai({},Py,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bE,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==__&&(__&&e.type==="mousemove"?(P2=e.screenX-__.screenX,R2=e.screenY-__.screenY):R2=P2=0,__=e),P2)},movementY:function(e){return"movementY"in e?e.movementY:R2}}),tR=Yo(T1),zU=Ai({},T1,{dataTransfer:0}),jU=Yo(zU),FU=Ai({},Py,{relatedTarget:0}),k2=Yo(FU),BU=Ai({},nm,{animationName:0,elapsedTime:0,pseudoElement:0}),UU=Yo(BU),VU=Ai({},nm,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$U=Yo(VU),GU=Ai({},nm,{data:0}),rR=Yo(GU),qU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZU(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=WU[e])?!!n[e]:!1}function bE(){return ZU}var XU=Ai({},Py,{key:function(e){if(e.key){var n=qU[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=yx(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?HU[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bE,charCode:function(e){return e.type==="keypress"?yx(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yx(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),KU=Yo(XU),YU=Ai({},T1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nR=Yo(YU),JU=Ai({},Py,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bE}),QU=Yo(JU),eV=Ai({},nm,{propertyName:0,elapsedTime:0,pseudoElement:0}),tV=Yo(eV),rV=Ai({},T1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),nV=Yo(rV),iV=[9,13,27,32],wE=hc&&"CompositionEvent"in window,z_=null;hc&&"documentMode"in document&&(z_=document.documentMode);var sV=hc&&"TextEvent"in window&&!z_,ED=hc&&(!wE||z_&&8<z_&&11>=z_),iR=" ",sR=!1;function CD(e,n){switch(e){case"keyup":return iV.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function AD(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var hp=!1;function oV(e,n){switch(e){case"compositionend":return AD(n);case"keypress":return n.which!==32?null:(sR=!0,iR);case"textInput":return e=n.data,e===iR&&sR?null:e;default:return null}}function aV(e,n){if(hp)return e==="compositionend"||!wE&&CD(e,n)?(e=TD(),_x=vE=Nu=null,hp=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return ED&&n.locale!=="ko"?null:n.data;default:return null}}var lV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oR(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!lV[e.type]:n==="textarea"}function MD(e,n,o,u){sD(u),n=Fx(n,"onChange"),0<n.length&&(o=new xE("onChange","change",null,o,u),e.push({event:o,listeners:n}))}var j_=null,ty=null;function cV(e){FD(e,0)}function E1(e){var n=mp(e);if(J3(n))return e}function uV(e,n){if(e==="change")return n}var ID=!1;if(hc){var D2;if(hc){var L2="oninput"in document;if(!L2){var aR=document.createElement("div");aR.setAttribute("oninput","return;"),L2=typeof aR.oninput=="function"}D2=L2}else D2=!1;ID=D2&&(!document.documentMode||9<document.documentMode)}function lR(){j_&&(j_.detachEvent("onpropertychange",PD),ty=j_=null)}function PD(e){if(e.propertyName==="value"&&E1(ty)){var n=[];MD(n,ty,e,pE(e)),cD(cV,n)}}function dV(e,n,o){e==="focusin"?(lR(),j_=n,ty=o,j_.attachEvent("onpropertychange",PD)):e==="focusout"&&lR()}function hV(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return E1(ty)}function fV(e,n){if(e==="click")return E1(n)}function pV(e,n){if(e==="input"||e==="change")return E1(n)}function mV(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Ja=typeof Object.is=="function"?Object.is:mV;function ry(e,n){if(Ja(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var o=Object.keys(e),u=Object.keys(n);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var g=o[u];if(!SS.call(n,g)||!Ja(e[g],n[g]))return!1}return!0}function cR(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uR(e,n){var o=cR(e);e=0;for(var u;o;){if(o.nodeType===3){if(u=e+o.textContent.length,e<=n&&u>=n)return{node:o,offset:n-e};e=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=cR(o)}}function RD(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?RD(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function kD(){for(var e=window,n=kx();n instanceof e.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)e=n.contentWindow;else break;n=kx(e.document)}return n}function SE(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function gV(e){var n=kD(),o=e.focusedElem,u=e.selectionRange;if(n!==o&&o&&o.ownerDocument&&RD(o.ownerDocument.documentElement,o)){if(u!==null&&SE(o)){if(n=u.start,e=u.end,e===void 0&&(e=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(e,o.value.length);else if(e=(n=o.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var g=o.textContent.length,b=Math.min(u.start,g);u=u.end===void 0?b:Math.min(u.end,g),!e.extend&&b>u&&(g=u,u=b,b=g),g=uR(o,b);var C=uR(o,u);g&&C&&(e.rangeCount!==1||e.anchorNode!==g.node||e.anchorOffset!==g.offset||e.focusNode!==C.node||e.focusOffset!==C.offset)&&(n=n.createRange(),n.setStart(g.node,g.offset),e.removeAllRanges(),b>u?(e.addRange(n),e.extend(C.node,C.offset)):(n.setEnd(C.node,C.offset),e.addRange(n)))}}for(n=[],e=o;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)e=n[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _V=hc&&"documentMode"in document&&11>=document.documentMode,fp=null,VS=null,F_=null,$S=!1;function dR(e,n,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;$S||fp==null||fp!==kx(u)||(u=fp,"selectionStart"in u&&SE(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),F_&&ry(F_,u)||(F_=u,u=Fx(VS,"onSelect"),0<u.length&&(n=new xE("onSelect","select",null,n,o),e.push({event:n,listeners:u}),n.target=fp)))}function $0(e,n){var o={};return o[e.toLowerCase()]=n.toLowerCase(),o["Webkit"+e]="webkit"+n,o["Moz"+e]="moz"+n,o}var pp={animationend:$0("Animation","AnimationEnd"),animationiteration:$0("Animation","AnimationIteration"),animationstart:$0("Animation","AnimationStart"),transitionend:$0("Transition","TransitionEnd")},N2={},DD={};hc&&(DD=document.createElement("div").style,"AnimationEvent"in window||(delete pp.animationend.animation,delete pp.animationiteration.animation,delete pp.animationstart.animation),"TransitionEvent"in window||delete pp.transitionend.transition);function C1(e){if(N2[e])return N2[e];if(!pp[e])return e;var n=pp[e],o;for(o in n)if(n.hasOwnProperty(o)&&o in DD)return N2[e]=n[o];return e}var LD=C1("animationend"),ND=C1("animationiteration"),OD=C1("animationstart"),zD=C1("transitionend"),jD=new Map,hR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rd(e,n){jD.set(e,n),Dh(n,[e])}for(var O2=0;O2<hR.length;O2++){var z2=hR[O2],yV=z2.toLowerCase(),vV=z2[0].toUpperCase()+z2.slice(1);rd(yV,"on"+vV)}rd(LD,"onAnimationEnd");rd(ND,"onAnimationIteration");rd(OD,"onAnimationStart");rd("dblclick","onDoubleClick");rd("focusin","onFocus");rd("focusout","onBlur");rd(zD,"onTransitionEnd");Hp("onMouseEnter",["mouseout","mouseover"]);Hp("onMouseLeave",["mouseout","mouseover"]);Hp("onPointerEnter",["pointerout","pointerover"]);Hp("onPointerLeave",["pointerout","pointerover"]);Dh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Dh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Dh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Dh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var A_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xV=new Set("cancel close invalid load scroll toggle".split(" ").concat(A_));function fR(e,n,o){var u=e.type||"unknown-event";e.currentTarget=o,yU(u,n,void 0,e),e.currentTarget=null}function FD(e,n){n=(n&4)!==0;for(var o=0;o<e.length;o++){var u=e[o],g=u.event;u=u.listeners;e:{var b=void 0;if(n)for(var C=u.length-1;0<=C;C--){var i=u[C],L=i.instance,O=i.currentTarget;if(i=i.listener,L!==b&&g.isPropagationStopped())break e;fR(g,i,O),b=L}else for(C=0;C<u.length;C++){if(i=u[C],L=i.instance,O=i.currentTarget,i=i.listener,L!==b&&g.isPropagationStopped())break e;fR(g,i,O),b=L}}}if(Lx)throw e=jS,Lx=!1,jS=null,e}function li(e,n){var o=n[ZS];o===void 0&&(o=n[ZS]=new Set);var u=e+"__bubble";o.has(u)||(BD(n,e,2,!1),o.add(u))}function j2(e,n,o){var u=0;n&&(u|=4),BD(o,e,u,n)}var G0="_reactListening"+Math.random().toString(36).slice(2);function ny(e){if(!e[G0]){e[G0]=!0,W3.forEach(function(o){o!=="selectionchange"&&(xV.has(o)||j2(o,!1,e),j2(o,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[G0]||(n[G0]=!0,j2("selectionchange",!1,n))}}function BD(e,n,o,u){switch(SD(n)){case 1:var g=LU;break;case 4:g=NU;break;default:g=yE}o=g.bind(null,n,o,e),g=void 0,!zS||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(g=!0),u?g!==void 0?e.addEventListener(n,o,{capture:!0,passive:g}):e.addEventListener(n,o,!0):g!==void 0?e.addEventListener(n,o,{passive:g}):e.addEventListener(n,o,!1)}function F2(e,n,o,u,g){var b=u;if(!(n&1)&&!(n&2)&&u!==null)e:for(;;){if(u===null)return;var C=u.tag;if(C===3||C===4){var i=u.stateNode.containerInfo;if(i===g||i.nodeType===8&&i.parentNode===g)break;if(C===4)for(C=u.return;C!==null;){var L=C.tag;if((L===3||L===4)&&(L=C.stateNode.containerInfo,L===g||L.nodeType===8&&L.parentNode===g))return;C=C.return}for(;i!==null;){if(C=ch(i),C===null)return;if(L=C.tag,L===5||L===6){u=b=C;continue e}i=i.parentNode}}u=u.return}cD(function(){var O=b,U=pE(o),q=[];e:{var G=jD.get(e);if(G!==void 0){var ie=xE,J=e;switch(e){case"keypress":if(yx(o)===0)break e;case"keydown":case"keyup":ie=KU;break;case"focusin":J="focus",ie=k2;break;case"focusout":J="blur",ie=k2;break;case"beforeblur":case"afterblur":ie=k2;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=tR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=jU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=QU;break;case LD:case ND:case OD:ie=UU;break;case zD:ie=tV;break;case"scroll":ie=OU;break;case"wheel":ie=nV;break;case"copy":case"cut":case"paste":ie=$U;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=nR}var K=(n&4)!==0,re=!K&&e==="scroll",Q=K?G!==null?G+"Capture":null:G;K=[];for(var ee=O,ue;ee!==null;){ue=ee;var fe=ue.stateNode;if(ue.tag===5&&fe!==null&&(ue=fe,Q!==null&&(fe=Y_(ee,Q),fe!=null&&K.push(iy(ee,fe,ue)))),re)break;ee=ee.return}0<K.length&&(G=new ie(G,J,null,o,U),q.push({event:G,listeners:K}))}}if(!(n&7)){e:{if(G=e==="mouseover"||e==="pointerover",ie=e==="mouseout"||e==="pointerout",G&&o!==NS&&(J=o.relatedTarget||o.fromElement)&&(ch(J)||J[fc]))break e;if((ie||G)&&(G=U.window===U?U:(G=U.ownerDocument)?G.defaultView||G.parentWindow:window,ie?(J=o.relatedTarget||o.toElement,ie=O,J=J?ch(J):null,J!==null&&(re=Lh(J),J!==re||J.tag!==5&&J.tag!==6)&&(J=null)):(ie=null,J=O),ie!==J)){if(K=tR,fe="onMouseLeave",Q="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(K=nR,fe="onPointerLeave",Q="onPointerEnter",ee="pointer"),re=ie==null?G:mp(ie),ue=J==null?G:mp(J),G=new K(fe,ee+"leave",ie,o,U),G.target=re,G.relatedTarget=ue,fe=null,ch(U)===O&&(K=new K(Q,ee+"enter",J,o,U),K.target=ue,K.relatedTarget=re,fe=K),re=fe,ie&&J)t:{for(K=ie,Q=J,ee=0,ue=K;ue;ue=rp(ue))ee++;for(ue=0,fe=Q;fe;fe=rp(fe))ue++;for(;0<ee-ue;)K=rp(K),ee--;for(;0<ue-ee;)Q=rp(Q),ue--;for(;ee--;){if(K===Q||Q!==null&&K===Q.alternate)break t;K=rp(K),Q=rp(Q)}K=null}else K=null;ie!==null&&pR(q,G,ie,K,!1),J!==null&&re!==null&&pR(q,re,J,K,!0)}}e:{if(G=O?mp(O):window,ie=G.nodeName&&G.nodeName.toLowerCase(),ie==="select"||ie==="input"&&G.type==="file")var ge=uV;else if(oR(G))if(ID)ge=pV;else{ge=hV;var ke=dV}else(ie=G.nodeName)&&ie.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(ge=fV);if(ge&&(ge=ge(e,O))){MD(q,ge,o,U);break e}ke&&ke(e,G,O),e==="focusout"&&(ke=G._wrapperState)&&ke.controlled&&G.type==="number"&&PS(G,"number",G.value)}switch(ke=O?mp(O):window,e){case"focusin":(oR(ke)||ke.contentEditable==="true")&&(fp=ke,VS=O,F_=null);break;case"focusout":F_=VS=fp=null;break;case"mousedown":$S=!0;break;case"contextmenu":case"mouseup":case"dragend":$S=!1,dR(q,o,U);break;case"selectionchange":if(_V)break;case"keydown":case"keyup":dR(q,o,U)}var Ce;if(wE)e:{switch(e){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else hp?CD(e,o)&&(Be="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(Be="onCompositionStart");Be&&(ED&&o.locale!=="ko"&&(hp||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&hp&&(Ce=TD()):(Nu=U,vE="value"in Nu?Nu.value:Nu.textContent,hp=!0)),ke=Fx(O,Be),0<ke.length&&(Be=new rR(Be,e,null,o,U),q.push({event:Be,listeners:ke}),Ce?Be.data=Ce:(Ce=AD(o),Ce!==null&&(Be.data=Ce)))),(Ce=sV?oV(e,o):aV(e,o))&&(O=Fx(O,"onBeforeInput"),0<O.length&&(U=new rR("onBeforeInput","beforeinput",null,o,U),q.push({event:U,listeners:O}),U.data=Ce))}FD(q,n)})}function iy(e,n,o){return{instance:e,listener:n,currentTarget:o}}function Fx(e,n){for(var o=n+"Capture",u=[];e!==null;){var g=e,b=g.stateNode;g.tag===5&&b!==null&&(g=b,b=Y_(e,o),b!=null&&u.unshift(iy(e,b,g)),b=Y_(e,n),b!=null&&u.push(iy(e,b,g))),e=e.return}return u}function rp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pR(e,n,o,u,g){for(var b=n._reactName,C=[];o!==null&&o!==u;){var i=o,L=i.alternate,O=i.stateNode;if(L!==null&&L===u)break;i.tag===5&&O!==null&&(i=O,g?(L=Y_(o,b),L!=null&&C.unshift(iy(o,L,i))):g||(L=Y_(o,b),L!=null&&C.push(iy(o,L,i)))),o=o.return}C.length!==0&&e.push({event:n,listeners:C})}var bV=/\r\n?/g,wV=/\u0000|\uFFFD/g;function mR(e){return(typeof e=="string"?e:""+e).replace(bV,`
`).replace(wV,"")}function q0(e,n,o){if(n=mR(n),mR(e)!==n&&o)throw Error(Yt(425))}function Bx(){}var GS=null,qS=null;function HS(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var WS=typeof setTimeout=="function"?setTimeout:void 0,SV=typeof clearTimeout=="function"?clearTimeout:void 0,gR=typeof Promise=="function"?Promise:void 0,TV=typeof queueMicrotask=="function"?queueMicrotask:typeof gR<"u"?function(e){return gR.resolve(null).then(e).catch(EV)}:WS;function EV(e){setTimeout(function(){throw e})}function B2(e,n){var o=n,u=0;do{var g=o.nextSibling;if(e.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"){if(u===0){e.removeChild(g),ey(n);return}u--}else o!=="$"&&o!=="$?"&&o!=="$!"||u++;o=g}while(o);ey(n)}function Vu(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function _R(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return e;n--}else o==="/$"&&n++}e=e.previousSibling}return null}var im=Math.random().toString(36).slice(2),Il="__reactFiber$"+im,sy="__reactProps$"+im,fc="__reactContainer$"+im,ZS="__reactEvents$"+im,CV="__reactListeners$"+im,AV="__reactHandles$"+im;function ch(e){var n=e[Il];if(n)return n;for(var o=e.parentNode;o;){if(n=o[fc]||o[Il]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(e=_R(e);e!==null;){if(o=e[Il])return o;e=_R(e)}return n}e=o,o=e.parentNode}return null}function Ry(e){return e=e[Il]||e[fc],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function mp(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Yt(33))}function A1(e){return e[sy]||null}var XS=[],gp=-1;function nd(e){return{current:e}}function ci(e){0>gp||(e.current=XS[gp],XS[gp]=null,gp--)}function ni(e,n){gp++,XS[gp]=e.current,e.current=n}var Xu={},Vs=nd(Xu),To=nd(!1),wh=Xu;function Wp(e,n){var o=e.type.contextTypes;if(!o)return Xu;var u=e.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===n)return u.__reactInternalMemoizedMaskedChildContext;var g={},b;for(b in o)g[b]=n[b];return u&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=g),g}function Eo(e){return e=e.childContextTypes,e!=null}function Ux(){ci(To),ci(Vs)}function yR(e,n,o){if(Vs.current!==Xu)throw Error(Yt(168));ni(Vs,n),ni(To,o)}function UD(e,n,o){var u=e.stateNode;if(n=n.childContextTypes,typeof u.getChildContext!="function")return o;u=u.getChildContext();for(var g in u)if(!(g in n))throw Error(Yt(108,dU(e)||"Unknown",g));return Ai({},o,u)}function Vx(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Xu,wh=Vs.current,ni(Vs,e),ni(To,To.current),!0}function vR(e,n,o){var u=e.stateNode;if(!u)throw Error(Yt(169));o?(e=UD(e,n,wh),u.__reactInternalMemoizedMergedChildContext=e,ci(To),ci(Vs),ni(Vs,e)):ci(To),ni(To,o)}var oc=null,M1=!1,U2=!1;function VD(e){oc===null?oc=[e]:oc.push(e)}function MV(e){M1=!0,VD(e)}function id(){if(!U2&&oc!==null){U2=!0;var e=0,n=Wn;try{var o=oc;for(Wn=1;e<o.length;e++){var u=o[e];do u=u(!0);while(u!==null)}oc=null,M1=!1}catch(g){throw oc!==null&&(oc=oc.slice(e+1)),fD(mE,id),g}finally{Wn=n,U2=!1}}return null}var _p=[],yp=0,$x=null,Gx=0,ca=[],ua=0,Sh=null,ac=1,lc="";function sh(e,n){_p[yp++]=Gx,_p[yp++]=$x,$x=e,Gx=n}function $D(e,n,o){ca[ua++]=ac,ca[ua++]=lc,ca[ua++]=Sh,Sh=e;var u=ac;e=lc;var g=32-Za(u)-1;u&=~(1<<g),o+=1;var b=32-Za(n)+g;if(30<b){var C=g-g%5;b=(u&(1<<C)-1).toString(32),u>>=C,g-=C,ac=1<<32-Za(n)+g|o<<g|u,lc=b+e}else ac=1<<b|o<<g|u,lc=e}function TE(e){e.return!==null&&(sh(e,1),$D(e,1,0))}function EE(e){for(;e===$x;)$x=_p[--yp],_p[yp]=null,Gx=_p[--yp],_p[yp]=null;for(;e===Sh;)Sh=ca[--ua],ca[ua]=null,lc=ca[--ua],ca[ua]=null,ac=ca[--ua],ca[ua]=null}var Ho=null,qo=null,pi=!1,Wa=null;function GD(e,n){var o=da(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=e,n=e.deletions,n===null?(e.deletions=[o],e.flags|=16):n.push(o)}function xR(e,n){switch(e.tag){case 5:var o=e.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,Ho=e,qo=Vu(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,Ho=e,qo=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=Sh!==null?{id:ac,overflow:lc}:null,e.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=da(18,null,null,0),o.stateNode=n,o.return=e,e.child=o,Ho=e,qo=null,!0):!1;default:return!1}}function KS(e){return(e.mode&1)!==0&&(e.flags&128)===0}function YS(e){if(pi){var n=qo;if(n){var o=n;if(!xR(e,n)){if(KS(e))throw Error(Yt(418));n=Vu(o.nextSibling);var u=Ho;n&&xR(e,n)?GD(u,o):(e.flags=e.flags&-4097|2,pi=!1,Ho=e)}}else{if(KS(e))throw Error(Yt(418));e.flags=e.flags&-4097|2,pi=!1,Ho=e}}}function bR(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ho=e}function H0(e){if(e!==Ho)return!1;if(!pi)return bR(e),pi=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!HS(e.type,e.memoizedProps)),n&&(n=qo)){if(KS(e))throw qD(),Error(Yt(418));for(;n;)GD(e,n),n=Vu(n.nextSibling)}if(bR(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Yt(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(n===0){qo=Vu(e.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}e=e.nextSibling}qo=null}}else qo=Ho?Vu(e.stateNode.nextSibling):null;return!0}function qD(){for(var e=qo;e;)e=Vu(e.nextSibling)}function Zp(){qo=Ho=null,pi=!1}function CE(e){Wa===null?Wa=[e]:Wa.push(e)}var IV=yc.ReactCurrentBatchConfig;function y_(e,n,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(Yt(309));var u=o.stateNode}if(!u)throw Error(Yt(147,e));var g=u,b=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===b?n.ref:(n=function(C){var i=g.refs;C===null?delete i[b]:i[b]=C},n._stringRef=b,n)}if(typeof e!="string")throw Error(Yt(284));if(!o._owner)throw Error(Yt(290,e))}return e}function W0(e,n){throw e=Object.prototype.toString.call(n),Error(Yt(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function wR(e){var n=e._init;return n(e._payload)}function HD(e){function n(Q,ee){if(e){var ue=Q.deletions;ue===null?(Q.deletions=[ee],Q.flags|=16):ue.push(ee)}}function o(Q,ee){if(!e)return null;for(;ee!==null;)n(Q,ee),ee=ee.sibling;return null}function u(Q,ee){for(Q=new Map;ee!==null;)ee.key!==null?Q.set(ee.key,ee):Q.set(ee.index,ee),ee=ee.sibling;return Q}function g(Q,ee){return Q=Hu(Q,ee),Q.index=0,Q.sibling=null,Q}function b(Q,ee,ue){return Q.index=ue,e?(ue=Q.alternate,ue!==null?(ue=ue.index,ue<ee?(Q.flags|=2,ee):ue):(Q.flags|=2,ee)):(Q.flags|=1048576,ee)}function C(Q){return e&&Q.alternate===null&&(Q.flags|=2),Q}function i(Q,ee,ue,fe){return ee===null||ee.tag!==6?(ee=Z2(ue,Q.mode,fe),ee.return=Q,ee):(ee=g(ee,ue),ee.return=Q,ee)}function L(Q,ee,ue,fe){var ge=ue.type;return ge===dp?U(Q,ee,ue.props.children,fe,ue.key):ee!==null&&(ee.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Tu&&wR(ge)===ee.type)?(fe=g(ee,ue.props),fe.ref=y_(Q,ee,ue),fe.return=Q,fe):(fe=Ex(ue.type,ue.key,ue.props,null,Q.mode,fe),fe.ref=y_(Q,ee,ue),fe.return=Q,fe)}function O(Q,ee,ue,fe){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ue.containerInfo||ee.stateNode.implementation!==ue.implementation?(ee=X2(ue,Q.mode,fe),ee.return=Q,ee):(ee=g(ee,ue.children||[]),ee.return=Q,ee)}function U(Q,ee,ue,fe,ge){return ee===null||ee.tag!==7?(ee=bh(ue,Q.mode,fe,ge),ee.return=Q,ee):(ee=g(ee,ue),ee.return=Q,ee)}function q(Q,ee,ue){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=Z2(""+ee,Q.mode,ue),ee.return=Q,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case O0:return ue=Ex(ee.type,ee.key,ee.props,null,Q.mode,ue),ue.ref=y_(Q,null,ee),ue.return=Q,ue;case up:return ee=X2(ee,Q.mode,ue),ee.return=Q,ee;case Tu:var fe=ee._init;return q(Q,fe(ee._payload),ue)}if(E_(ee)||f_(ee))return ee=bh(ee,Q.mode,ue,null),ee.return=Q,ee;W0(Q,ee)}return null}function G(Q,ee,ue,fe){var ge=ee!==null?ee.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ge!==null?null:i(Q,ee,""+ue,fe);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case O0:return ue.key===ge?L(Q,ee,ue,fe):null;case up:return ue.key===ge?O(Q,ee,ue,fe):null;case Tu:return ge=ue._init,G(Q,ee,ge(ue._payload),fe)}if(E_(ue)||f_(ue))return ge!==null?null:U(Q,ee,ue,fe,null);W0(Q,ue)}return null}function ie(Q,ee,ue,fe,ge){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return Q=Q.get(ue)||null,i(ee,Q,""+fe,ge);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case O0:return Q=Q.get(fe.key===null?ue:fe.key)||null,L(ee,Q,fe,ge);case up:return Q=Q.get(fe.key===null?ue:fe.key)||null,O(ee,Q,fe,ge);case Tu:var ke=fe._init;return ie(Q,ee,ue,ke(fe._payload),ge)}if(E_(fe)||f_(fe))return Q=Q.get(ue)||null,U(ee,Q,fe,ge,null);W0(ee,fe)}return null}function J(Q,ee,ue,fe){for(var ge=null,ke=null,Ce=ee,Be=ee=0,dt=null;Ce!==null&&Be<ue.length;Be++){Ce.index>Be?(dt=Ce,Ce=null):dt=Ce.sibling;var Qe=G(Q,Ce,ue[Be],fe);if(Qe===null){Ce===null&&(Ce=dt);break}e&&Ce&&Qe.alternate===null&&n(Q,Ce),ee=b(Qe,ee,Be),ke===null?ge=Qe:ke.sibling=Qe,ke=Qe,Ce=dt}if(Be===ue.length)return o(Q,Ce),pi&&sh(Q,Be),ge;if(Ce===null){for(;Be<ue.length;Be++)Ce=q(Q,ue[Be],fe),Ce!==null&&(ee=b(Ce,ee,Be),ke===null?ge=Ce:ke.sibling=Ce,ke=Ce);return pi&&sh(Q,Be),ge}for(Ce=u(Q,Ce);Be<ue.length;Be++)dt=ie(Ce,Q,Be,ue[Be],fe),dt!==null&&(e&&dt.alternate!==null&&Ce.delete(dt.key===null?Be:dt.key),ee=b(dt,ee,Be),ke===null?ge=dt:ke.sibling=dt,ke=dt);return e&&Ce.forEach(function(qe){return n(Q,qe)}),pi&&sh(Q,Be),ge}function K(Q,ee,ue,fe){var ge=f_(ue);if(typeof ge!="function")throw Error(Yt(150));if(ue=ge.call(ue),ue==null)throw Error(Yt(151));for(var ke=ge=null,Ce=ee,Be=ee=0,dt=null,Qe=ue.next();Ce!==null&&!Qe.done;Be++,Qe=ue.next()){Ce.index>Be?(dt=Ce,Ce=null):dt=Ce.sibling;var qe=G(Q,Ce,Qe.value,fe);if(qe===null){Ce===null&&(Ce=dt);break}e&&Ce&&qe.alternate===null&&n(Q,Ce),ee=b(qe,ee,Be),ke===null?ge=qe:ke.sibling=qe,ke=qe,Ce=dt}if(Qe.done)return o(Q,Ce),pi&&sh(Q,Be),ge;if(Ce===null){for(;!Qe.done;Be++,Qe=ue.next())Qe=q(Q,Qe.value,fe),Qe!==null&&(ee=b(Qe,ee,Be),ke===null?ge=Qe:ke.sibling=Qe,ke=Qe);return pi&&sh(Q,Be),ge}for(Ce=u(Q,Ce);!Qe.done;Be++,Qe=ue.next())Qe=ie(Ce,Q,Be,Qe.value,fe),Qe!==null&&(e&&Qe.alternate!==null&&Ce.delete(Qe.key===null?Be:Qe.key),ee=b(Qe,ee,Be),ke===null?ge=Qe:ke.sibling=Qe,ke=Qe);return e&&Ce.forEach(function(He){return n(Q,He)}),pi&&sh(Q,Be),ge}function re(Q,ee,ue,fe){if(typeof ue=="object"&&ue!==null&&ue.type===dp&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case O0:e:{for(var ge=ue.key,ke=ee;ke!==null;){if(ke.key===ge){if(ge=ue.type,ge===dp){if(ke.tag===7){o(Q,ke.sibling),ee=g(ke,ue.props.children),ee.return=Q,Q=ee;break e}}else if(ke.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Tu&&wR(ge)===ke.type){o(Q,ke.sibling),ee=g(ke,ue.props),ee.ref=y_(Q,ke,ue),ee.return=Q,Q=ee;break e}o(Q,ke);break}else n(Q,ke);ke=ke.sibling}ue.type===dp?(ee=bh(ue.props.children,Q.mode,fe,ue.key),ee.return=Q,Q=ee):(fe=Ex(ue.type,ue.key,ue.props,null,Q.mode,fe),fe.ref=y_(Q,ee,ue),fe.return=Q,Q=fe)}return C(Q);case up:e:{for(ke=ue.key;ee!==null;){if(ee.key===ke)if(ee.tag===4&&ee.stateNode.containerInfo===ue.containerInfo&&ee.stateNode.implementation===ue.implementation){o(Q,ee.sibling),ee=g(ee,ue.children||[]),ee.return=Q,Q=ee;break e}else{o(Q,ee);break}else n(Q,ee);ee=ee.sibling}ee=X2(ue,Q.mode,fe),ee.return=Q,Q=ee}return C(Q);case Tu:return ke=ue._init,re(Q,ee,ke(ue._payload),fe)}if(E_(ue))return J(Q,ee,ue,fe);if(f_(ue))return K(Q,ee,ue,fe);W0(Q,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,ee!==null&&ee.tag===6?(o(Q,ee.sibling),ee=g(ee,ue),ee.return=Q,Q=ee):(o(Q,ee),ee=Z2(ue,Q.mode,fe),ee.return=Q,Q=ee),C(Q)):o(Q,ee)}return re}var Xp=HD(!0),WD=HD(!1),qx=nd(null),Hx=null,vp=null,AE=null;function ME(){AE=vp=Hx=null}function IE(e){var n=qx.current;ci(qx),e._currentValue=n}function JS(e,n,o){for(;e!==null;){var u=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,u!==null&&(u.childLanes|=n)):u!==null&&(u.childLanes&n)!==n&&(u.childLanes|=n),e===o)break;e=e.return}}function Rp(e,n){Hx=e,AE=vp=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(So=!0),e.firstContext=null)}function pa(e){var n=e._currentValue;if(AE!==e)if(e={context:e,memoizedValue:n,next:null},vp===null){if(Hx===null)throw Error(Yt(308));vp=e,Hx.dependencies={lanes:0,firstContext:e}}else vp=vp.next=e;return n}var uh=null;function PE(e){uh===null?uh=[e]:uh.push(e)}function ZD(e,n,o,u){var g=n.interleaved;return g===null?(o.next=o,PE(n)):(o.next=g.next,g.next=o),n.interleaved=o,pc(e,u)}function pc(e,n){e.lanes|=n;var o=e.alternate;for(o!==null&&(o.lanes|=n),o=e,e=e.return;e!==null;)e.childLanes|=n,o=e.alternate,o!==null&&(o.childLanes|=n),o=e,e=e.return;return o.tag===3?o.stateNode:null}var Eu=!1;function RE(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function XD(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function uc(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function $u(e,n,o){var u=e.updateQueue;if(u===null)return null;if(u=u.shared,On&2){var g=u.pending;return g===null?n.next=n:(n.next=g.next,g.next=n),u.pending=n,pc(e,o)}return g=u.interleaved,g===null?(n.next=n,PE(u)):(n.next=g.next,g.next=n),u.interleaved=n,pc(e,o)}function vx(e,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var u=n.lanes;u&=e.pendingLanes,o|=u,n.lanes=o,gE(e,o)}}function SR(e,n){var o=e.updateQueue,u=e.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var g=null,b=null;if(o=o.firstBaseUpdate,o!==null){do{var C={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};b===null?g=b=C:b=b.next=C,o=o.next}while(o!==null);b===null?g=b=n:b=b.next=n}else g=b=n;o={baseState:u.baseState,firstBaseUpdate:g,lastBaseUpdate:b,shared:u.shared,effects:u.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=n:e.next=n,o.lastBaseUpdate=n}function Wx(e,n,o,u){var g=e.updateQueue;Eu=!1;var b=g.firstBaseUpdate,C=g.lastBaseUpdate,i=g.shared.pending;if(i!==null){g.shared.pending=null;var L=i,O=L.next;L.next=null,C===null?b=O:C.next=O,C=L;var U=e.alternate;U!==null&&(U=U.updateQueue,i=U.lastBaseUpdate,i!==C&&(i===null?U.firstBaseUpdate=O:i.next=O,U.lastBaseUpdate=L))}if(b!==null){var q=g.baseState;C=0,U=O=L=null,i=b;do{var G=i.lane,ie=i.eventTime;if((u&G)===G){U!==null&&(U=U.next={eventTime:ie,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var J=e,K=i;switch(G=n,ie=o,K.tag){case 1:if(J=K.payload,typeof J=="function"){q=J.call(ie,q,G);break e}q=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=K.payload,G=typeof J=="function"?J.call(ie,q,G):J,G==null)break e;q=Ai({},q,G);break e;case 2:Eu=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,G=g.effects,G===null?g.effects=[i]:G.push(i))}else ie={eventTime:ie,lane:G,tag:i.tag,payload:i.payload,callback:i.callback,next:null},U===null?(O=U=ie,L=q):U=U.next=ie,C|=G;if(i=i.next,i===null){if(i=g.shared.pending,i===null)break;G=i,i=G.next,G.next=null,g.lastBaseUpdate=G,g.shared.pending=null}}while(!0);if(U===null&&(L=q),g.baseState=L,g.firstBaseUpdate=O,g.lastBaseUpdate=U,n=g.shared.interleaved,n!==null){g=n;do C|=g.lane,g=g.next;while(g!==n)}else b===null&&(g.shared.lanes=0);Eh|=C,e.lanes=C,e.memoizedState=q}}function TR(e,n,o){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var u=e[n],g=u.callback;if(g!==null){if(u.callback=null,u=o,typeof g!="function")throw Error(Yt(191,g));g.call(u)}}}var ky={},kl=nd(ky),oy=nd(ky),ay=nd(ky);function dh(e){if(e===ky)throw Error(Yt(174));return e}function kE(e,n){switch(ni(ay,n),ni(oy,e),ni(kl,ky),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:kS(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=kS(n,e)}ci(kl),ni(kl,n)}function Kp(){ci(kl),ci(oy),ci(ay)}function KD(e){dh(ay.current);var n=dh(kl.current),o=kS(n,e.type);n!==o&&(ni(oy,e),ni(kl,o))}function DE(e){oy.current===e&&(ci(kl),ci(oy))}var bi=nd(0);function Zx(e){for(var n=e;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var V2=[];function LE(){for(var e=0;e<V2.length;e++)V2[e]._workInProgressVersionPrimary=null;V2.length=0}var xx=yc.ReactCurrentDispatcher,$2=yc.ReactCurrentBatchConfig,Th=0,Ci=null,os=null,ms=null,Xx=!1,B_=!1,ly=0,PV=0;function js(){throw Error(Yt(321))}function NE(e,n){if(n===null)return!1;for(var o=0;o<n.length&&o<e.length;o++)if(!Ja(e[o],n[o]))return!1;return!0}function OE(e,n,o,u,g,b){if(Th=b,Ci=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,xx.current=e===null||e.memoizedState===null?LV:NV,e=o(u,g),B_){b=0;do{if(B_=!1,ly=0,25<=b)throw Error(Yt(301));b+=1,ms=os=null,n.updateQueue=null,xx.current=OV,e=o(u,g)}while(B_)}if(xx.current=Kx,n=os!==null&&os.next!==null,Th=0,ms=os=Ci=null,Xx=!1,n)throw Error(Yt(300));return e}function zE(){var e=ly!==0;return ly=0,e}function El(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?Ci.memoizedState=ms=e:ms=ms.next=e,ms}function ma(){if(os===null){var e=Ci.alternate;e=e!==null?e.memoizedState:null}else e=os.next;var n=ms===null?Ci.memoizedState:ms.next;if(n!==null)ms=n,os=e;else{if(e===null)throw Error(Yt(310));os=e,e={memoizedState:os.memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},ms===null?Ci.memoizedState=ms=e:ms=ms.next=e}return ms}function cy(e,n){return typeof n=="function"?n(e):n}function G2(e){var n=ma(),o=n.queue;if(o===null)throw Error(Yt(311));o.lastRenderedReducer=e;var u=os,g=u.baseQueue,b=o.pending;if(b!==null){if(g!==null){var C=g.next;g.next=b.next,b.next=C}u.baseQueue=g=b,o.pending=null}if(g!==null){b=g.next,u=u.baseState;var i=C=null,L=null,O=b;do{var U=O.lane;if((Th&U)===U)L!==null&&(L=L.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),u=O.hasEagerState?O.eagerState:e(u,O.action);else{var q={lane:U,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};L===null?(i=L=q,C=u):L=L.next=q,Ci.lanes|=U,Eh|=U}O=O.next}while(O!==null&&O!==b);L===null?C=u:L.next=i,Ja(u,n.memoizedState)||(So=!0),n.memoizedState=u,n.baseState=C,n.baseQueue=L,o.lastRenderedState=u}if(e=o.interleaved,e!==null){g=e;do b=g.lane,Ci.lanes|=b,Eh|=b,g=g.next;while(g!==e)}else g===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function q2(e){var n=ma(),o=n.queue;if(o===null)throw Error(Yt(311));o.lastRenderedReducer=e;var u=o.dispatch,g=o.pending,b=n.memoizedState;if(g!==null){o.pending=null;var C=g=g.next;do b=e(b,C.action),C=C.next;while(C!==g);Ja(b,n.memoizedState)||(So=!0),n.memoizedState=b,n.baseQueue===null&&(n.baseState=b),o.lastRenderedState=b}return[b,u]}function YD(){}function JD(e,n){var o=Ci,u=ma(),g=n(),b=!Ja(u.memoizedState,g);if(b&&(u.memoizedState=g,So=!0),u=u.queue,jE(tL.bind(null,o,u,e),[e]),u.getSnapshot!==n||b||ms!==null&&ms.memoizedState.tag&1){if(o.flags|=2048,uy(9,eL.bind(null,o,u,g,n),void 0,null),gs===null)throw Error(Yt(349));Th&30||QD(o,n,g)}return g}function QD(e,n,o){e.flags|=16384,e={getSnapshot:n,value:o},n=Ci.updateQueue,n===null?(n={lastEffect:null,stores:null},Ci.updateQueue=n,n.stores=[e]):(o=n.stores,o===null?n.stores=[e]:o.push(e))}function eL(e,n,o,u){n.value=o,n.getSnapshot=u,rL(n)&&nL(e)}function tL(e,n,o){return o(function(){rL(n)&&nL(e)})}function rL(e){var n=e.getSnapshot;e=e.value;try{var o=n();return!Ja(e,o)}catch{return!0}}function nL(e){var n=pc(e,1);n!==null&&Xa(n,e,1,-1)}function ER(e){var n=El();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cy,lastRenderedState:e},n.queue=e,e=e.dispatch=DV.bind(null,Ci,e),[n.memoizedState,e]}function uy(e,n,o,u){return e={tag:e,create:n,destroy:o,deps:u,next:null},n=Ci.updateQueue,n===null?(n={lastEffect:null,stores:null},Ci.updateQueue=n,n.lastEffect=e.next=e):(o=n.lastEffect,o===null?n.lastEffect=e.next=e:(u=o.next,o.next=e,e.next=u,n.lastEffect=e)),e}function iL(){return ma().memoizedState}function bx(e,n,o,u){var g=El();Ci.flags|=e,g.memoizedState=uy(1|n,o,void 0,u===void 0?null:u)}function I1(e,n,o,u){var g=ma();u=u===void 0?null:u;var b=void 0;if(os!==null){var C=os.memoizedState;if(b=C.destroy,u!==null&&NE(u,C.deps)){g.memoizedState=uy(n,o,b,u);return}}Ci.flags|=e,g.memoizedState=uy(1|n,o,b,u)}function CR(e,n){return bx(8390656,8,e,n)}function jE(e,n){return I1(2048,8,e,n)}function sL(e,n){return I1(4,2,e,n)}function oL(e,n){return I1(4,4,e,n)}function aL(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function lL(e,n,o){return o=o!=null?o.concat([e]):null,I1(4,4,aL.bind(null,n,e),o)}function FE(){}function cL(e,n){var o=ma();n=n===void 0?null:n;var u=o.memoizedState;return u!==null&&n!==null&&NE(n,u[1])?u[0]:(o.memoizedState=[e,n],e)}function uL(e,n){var o=ma();n=n===void 0?null:n;var u=o.memoizedState;return u!==null&&n!==null&&NE(n,u[1])?u[0]:(e=e(),o.memoizedState=[e,n],e)}function dL(e,n,o){return Th&21?(Ja(o,n)||(o=gD(),Ci.lanes|=o,Eh|=o,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,So=!0),e.memoizedState=o)}function RV(e,n){var o=Wn;Wn=o!==0&&4>o?o:4,e(!0);var u=$2.transition;$2.transition={};try{e(!1),n()}finally{Wn=o,$2.transition=u}}function hL(){return ma().memoizedState}function kV(e,n,o){var u=qu(e);if(o={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null},fL(e))pL(n,o);else if(o=ZD(e,n,o,u),o!==null){var g=no();Xa(o,e,u,g),mL(o,n,u)}}function DV(e,n,o){var u=qu(e),g={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null};if(fL(e))pL(n,g);else{var b=e.alternate;if(e.lanes===0&&(b===null||b.lanes===0)&&(b=n.lastRenderedReducer,b!==null))try{var C=n.lastRenderedState,i=b(C,o);if(g.hasEagerState=!0,g.eagerState=i,Ja(i,C)){var L=n.interleaved;L===null?(g.next=g,PE(n)):(g.next=L.next,L.next=g),n.interleaved=g;return}}catch{}finally{}o=ZD(e,n,g,u),o!==null&&(g=no(),Xa(o,e,u,g),mL(o,n,u))}}function fL(e){var n=e.alternate;return e===Ci||n!==null&&n===Ci}function pL(e,n){B_=Xx=!0;var o=e.pending;o===null?n.next=n:(n.next=o.next,o.next=n),e.pending=n}function mL(e,n,o){if(o&4194240){var u=n.lanes;u&=e.pendingLanes,o|=u,n.lanes=o,gE(e,o)}}var Kx={readContext:pa,useCallback:js,useContext:js,useEffect:js,useImperativeHandle:js,useInsertionEffect:js,useLayoutEffect:js,useMemo:js,useReducer:js,useRef:js,useState:js,useDebugValue:js,useDeferredValue:js,useTransition:js,useMutableSource:js,useSyncExternalStore:js,useId:js,unstable_isNewReconciler:!1},LV={readContext:pa,useCallback:function(e,n){return El().memoizedState=[e,n===void 0?null:n],e},useContext:pa,useEffect:CR,useImperativeHandle:function(e,n,o){return o=o!=null?o.concat([e]):null,bx(4194308,4,aL.bind(null,n,e),o)},useLayoutEffect:function(e,n){return bx(4194308,4,e,n)},useInsertionEffect:function(e,n){return bx(4,2,e,n)},useMemo:function(e,n){var o=El();return n=n===void 0?null:n,e=e(),o.memoizedState=[e,n],e},useReducer:function(e,n,o){var u=El();return n=o!==void 0?o(n):n,u.memoizedState=u.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},u.queue=e,e=e.dispatch=kV.bind(null,Ci,e),[u.memoizedState,e]},useRef:function(e){var n=El();return e={current:e},n.memoizedState=e},useState:ER,useDebugValue:FE,useDeferredValue:function(e){return El().memoizedState=e},useTransition:function(){var e=ER(!1),n=e[0];return e=RV.bind(null,e[1]),El().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,o){var u=Ci,g=El();if(pi){if(o===void 0)throw Error(Yt(407));o=o()}else{if(o=n(),gs===null)throw Error(Yt(349));Th&30||QD(u,n,o)}g.memoizedState=o;var b={value:o,getSnapshot:n};return g.queue=b,CR(tL.bind(null,u,b,e),[e]),u.flags|=2048,uy(9,eL.bind(null,u,b,o,n),void 0,null),o},useId:function(){var e=El(),n=gs.identifierPrefix;if(pi){var o=lc,u=ac;o=(u&~(1<<32-Za(u)-1)).toString(32)+o,n=":"+n+"R"+o,o=ly++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=PV++,n=":"+n+"r"+o.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},NV={readContext:pa,useCallback:cL,useContext:pa,useEffect:jE,useImperativeHandle:lL,useInsertionEffect:sL,useLayoutEffect:oL,useMemo:uL,useReducer:G2,useRef:iL,useState:function(){return G2(cy)},useDebugValue:FE,useDeferredValue:function(e){var n=ma();return dL(n,os.memoizedState,e)},useTransition:function(){var e=G2(cy)[0],n=ma().memoizedState;return[e,n]},useMutableSource:YD,useSyncExternalStore:JD,useId:hL,unstable_isNewReconciler:!1},OV={readContext:pa,useCallback:cL,useContext:pa,useEffect:jE,useImperativeHandle:lL,useInsertionEffect:sL,useLayoutEffect:oL,useMemo:uL,useReducer:q2,useRef:iL,useState:function(){return q2(cy)},useDebugValue:FE,useDeferredValue:function(e){var n=ma();return os===null?n.memoizedState=e:dL(n,os.memoizedState,e)},useTransition:function(){var e=q2(cy)[0],n=ma().memoizedState;return[e,n]},useMutableSource:YD,useSyncExternalStore:JD,useId:hL,unstable_isNewReconciler:!1};function Va(e,n){if(e&&e.defaultProps){n=Ai({},n),e=e.defaultProps;for(var o in e)n[o]===void 0&&(n[o]=e[o]);return n}return n}function QS(e,n,o,u){n=e.memoizedState,o=o(u,n),o=o==null?n:Ai({},n,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var P1={isMounted:function(e){return(e=e._reactInternals)?Lh(e)===e:!1},enqueueSetState:function(e,n,o){e=e._reactInternals;var u=no(),g=qu(e),b=uc(u,g);b.payload=n,o!=null&&(b.callback=o),n=$u(e,b,g),n!==null&&(Xa(n,e,g,u),vx(n,e,g))},enqueueReplaceState:function(e,n,o){e=e._reactInternals;var u=no(),g=qu(e),b=uc(u,g);b.tag=1,b.payload=n,o!=null&&(b.callback=o),n=$u(e,b,g),n!==null&&(Xa(n,e,g,u),vx(n,e,g))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var o=no(),u=qu(e),g=uc(o,u);g.tag=2,n!=null&&(g.callback=n),n=$u(e,g,u),n!==null&&(Xa(n,e,u,o),vx(n,e,u))}};function AR(e,n,o,u,g,b,C){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(u,b,C):n.prototype&&n.prototype.isPureReactComponent?!ry(o,u)||!ry(g,b):!0}function gL(e,n,o){var u=!1,g=Xu,b=n.contextType;return typeof b=="object"&&b!==null?b=pa(b):(g=Eo(n)?wh:Vs.current,u=n.contextTypes,b=(u=u!=null)?Wp(e,g):Xu),n=new n(o,b),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=P1,e.stateNode=n,n._reactInternals=e,u&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=g,e.__reactInternalMemoizedMaskedChildContext=b),n}function MR(e,n,o,u){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,u),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,u),n.state!==e&&P1.enqueueReplaceState(n,n.state,null)}function eT(e,n,o,u){var g=e.stateNode;g.props=o,g.state=e.memoizedState,g.refs={},RE(e);var b=n.contextType;typeof b=="object"&&b!==null?g.context=pa(b):(b=Eo(n)?wh:Vs.current,g.context=Wp(e,b)),g.state=e.memoizedState,b=n.getDerivedStateFromProps,typeof b=="function"&&(QS(e,n,b,o),g.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(n=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),n!==g.state&&P1.enqueueReplaceState(g,g.state,null),Wx(e,o,g,u),g.state=e.memoizedState),typeof g.componentDidMount=="function"&&(e.flags|=4194308)}function Yp(e,n){try{var o="",u=n;do o+=uU(u),u=u.return;while(u);var g=o}catch(b){g=`
Error generating stack: `+b.message+`
`+b.stack}return{value:e,source:n,stack:g,digest:null}}function H2(e,n,o){return{value:e,source:null,stack:o??null,digest:n??null}}function tT(e,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var zV=typeof WeakMap=="function"?WeakMap:Map;function _L(e,n,o){o=uc(-1,o),o.tag=3,o.payload={element:null};var u=n.value;return o.callback=function(){Jx||(Jx=!0,dT=u),tT(e,n)},o}function yL(e,n,o){o=uc(-1,o),o.tag=3;var u=e.type.getDerivedStateFromError;if(typeof u=="function"){var g=n.value;o.payload=function(){return u(g)},o.callback=function(){tT(e,n)}}var b=e.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(o.callback=function(){tT(e,n),typeof u!="function"&&(Gu===null?Gu=new Set([this]):Gu.add(this));var C=n.stack;this.componentDidCatch(n.value,{componentStack:C!==null?C:""})}),o}function IR(e,n,o){var u=e.pingCache;if(u===null){u=e.pingCache=new zV;var g=new Set;u.set(n,g)}else g=u.get(n),g===void 0&&(g=new Set,u.set(n,g));g.has(o)||(g.add(o),e=YV.bind(null,e,n,o),n.then(e,e))}function PR(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function RR(e,n,o,u,g){return e.mode&1?(e.flags|=65536,e.lanes=g,e):(e===n?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=uc(-1,1),n.tag=2,$u(o,n,1))),o.lanes|=1),e)}var jV=yc.ReactCurrentOwner,So=!1;function to(e,n,o,u){n.child=e===null?WD(n,null,o,u):Xp(n,e.child,o,u)}function kR(e,n,o,u,g){o=o.render;var b=n.ref;return Rp(n,g),u=OE(e,n,o,u,b,g),o=zE(),e!==null&&!So?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~g,mc(e,n,g)):(pi&&o&&TE(n),n.flags|=1,to(e,n,u,g),n.child)}function DR(e,n,o,u,g){if(e===null){var b=o.type;return typeof b=="function"&&!WE(b)&&b.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=b,vL(e,n,b,u,g)):(e=Ex(o.type,null,u,n,n.mode,g),e.ref=n.ref,e.return=n,n.child=e)}if(b=e.child,!(e.lanes&g)){var C=b.memoizedProps;if(o=o.compare,o=o!==null?o:ry,o(C,u)&&e.ref===n.ref)return mc(e,n,g)}return n.flags|=1,e=Hu(b,u),e.ref=n.ref,e.return=n,n.child=e}function vL(e,n,o,u,g){if(e!==null){var b=e.memoizedProps;if(ry(b,u)&&e.ref===n.ref)if(So=!1,n.pendingProps=u=b,(e.lanes&g)!==0)e.flags&131072&&(So=!0);else return n.lanes=e.lanes,mc(e,n,g)}return rT(e,n,o,u,g)}function xL(e,n,o){var u=n.pendingProps,g=u.children,b=e!==null?e.memoizedState:null;if(u.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},ni(bp,$o),$o|=o;else{if(!(o&1073741824))return e=b!==null?b.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,ni(bp,$o),$o|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=b!==null?b.baseLanes:o,ni(bp,$o),$o|=u}else b!==null?(u=b.baseLanes|o,n.memoizedState=null):u=o,ni(bp,$o),$o|=u;return to(e,n,g,o),n.child}function bL(e,n){var o=n.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function rT(e,n,o,u,g){var b=Eo(o)?wh:Vs.current;return b=Wp(n,b),Rp(n,g),o=OE(e,n,o,u,b,g),u=zE(),e!==null&&!So?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~g,mc(e,n,g)):(pi&&u&&TE(n),n.flags|=1,to(e,n,o,g),n.child)}function LR(e,n,o,u,g){if(Eo(o)){var b=!0;Vx(n)}else b=!1;if(Rp(n,g),n.stateNode===null)wx(e,n),gL(n,o,u),eT(n,o,u,g),u=!0;else if(e===null){var C=n.stateNode,i=n.memoizedProps;C.props=i;var L=C.context,O=o.contextType;typeof O=="object"&&O!==null?O=pa(O):(O=Eo(o)?wh:Vs.current,O=Wp(n,O));var U=o.getDerivedStateFromProps,q=typeof U=="function"||typeof C.getSnapshotBeforeUpdate=="function";q||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(i!==u||L!==O)&&MR(n,C,u,O),Eu=!1;var G=n.memoizedState;C.state=G,Wx(n,u,C,g),L=n.memoizedState,i!==u||G!==L||To.current||Eu?(typeof U=="function"&&(QS(n,o,U,u),L=n.memoizedState),(i=Eu||AR(n,o,i,u,G,L,O))?(q||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(n.flags|=4194308)):(typeof C.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=u,n.memoizedState=L),C.props=u,C.state=L,C.context=O,u=i):(typeof C.componentDidMount=="function"&&(n.flags|=4194308),u=!1)}else{C=n.stateNode,XD(e,n),i=n.memoizedProps,O=n.type===n.elementType?i:Va(n.type,i),C.props=O,q=n.pendingProps,G=C.context,L=o.contextType,typeof L=="object"&&L!==null?L=pa(L):(L=Eo(o)?wh:Vs.current,L=Wp(n,L));var ie=o.getDerivedStateFromProps;(U=typeof ie=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(i!==q||G!==L)&&MR(n,C,u,L),Eu=!1,G=n.memoizedState,C.state=G,Wx(n,u,C,g);var J=n.memoizedState;i!==q||G!==J||To.current||Eu?(typeof ie=="function"&&(QS(n,o,ie,u),J=n.memoizedState),(O=Eu||AR(n,o,O,u,G,J,L)||!1)?(U||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(u,J,L),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(u,J,L)),typeof C.componentDidUpdate=="function"&&(n.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof C.componentDidUpdate!="function"||i===e.memoizedProps&&G===e.memoizedState||(n.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&G===e.memoizedState||(n.flags|=1024),n.memoizedProps=u,n.memoizedState=J),C.props=u,C.state=J,C.context=L,u=O):(typeof C.componentDidUpdate!="function"||i===e.memoizedProps&&G===e.memoizedState||(n.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&G===e.memoizedState||(n.flags|=1024),u=!1)}return nT(e,n,o,u,b,g)}function nT(e,n,o,u,g,b){bL(e,n);var C=(n.flags&128)!==0;if(!u&&!C)return g&&vR(n,o,!1),mc(e,n,b);u=n.stateNode,jV.current=n;var i=C&&typeof o.getDerivedStateFromError!="function"?null:u.render();return n.flags|=1,e!==null&&C?(n.child=Xp(n,e.child,null,b),n.child=Xp(n,null,i,b)):to(e,n,i,b),n.memoizedState=u.state,g&&vR(n,o,!0),n.child}function wL(e){var n=e.stateNode;n.pendingContext?yR(e,n.pendingContext,n.pendingContext!==n.context):n.context&&yR(e,n.context,!1),kE(e,n.containerInfo)}function NR(e,n,o,u,g){return Zp(),CE(g),n.flags|=256,to(e,n,o,u),n.child}var iT={dehydrated:null,treeContext:null,retryLane:0};function sT(e){return{baseLanes:e,cachePool:null,transitions:null}}function SL(e,n,o){var u=n.pendingProps,g=bi.current,b=!1,C=(n.flags&128)!==0,i;if((i=C)||(i=e!==null&&e.memoizedState===null?!1:(g&2)!==0),i?(b=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(g|=1),ni(bi,g&1),e===null)return YS(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(C=u.children,e=u.fallback,b?(u=n.mode,b=n.child,C={mode:"hidden",children:C},!(u&1)&&b!==null?(b.childLanes=0,b.pendingProps=C):b=D1(C,u,0,null),e=bh(e,u,o,null),b.return=n,e.return=n,b.sibling=e,n.child=b,n.child.memoizedState=sT(o),n.memoizedState=iT,e):BE(n,C));if(g=e.memoizedState,g!==null&&(i=g.dehydrated,i!==null))return FV(e,n,C,u,i,g,o);if(b){b=u.fallback,C=n.mode,g=e.child,i=g.sibling;var L={mode:"hidden",children:u.children};return!(C&1)&&n.child!==g?(u=n.child,u.childLanes=0,u.pendingProps=L,n.deletions=null):(u=Hu(g,L),u.subtreeFlags=g.subtreeFlags&14680064),i!==null?b=Hu(i,b):(b=bh(b,C,o,null),b.flags|=2),b.return=n,u.return=n,u.sibling=b,n.child=u,u=b,b=n.child,C=e.child.memoizedState,C=C===null?sT(o):{baseLanes:C.baseLanes|o,cachePool:null,transitions:C.transitions},b.memoizedState=C,b.childLanes=e.childLanes&~o,n.memoizedState=iT,u}return b=e.child,e=b.sibling,u=Hu(b,{mode:"visible",children:u.children}),!(n.mode&1)&&(u.lanes=o),u.return=n,u.sibling=null,e!==null&&(o=n.deletions,o===null?(n.deletions=[e],n.flags|=16):o.push(e)),n.child=u,n.memoizedState=null,u}function BE(e,n){return n=D1({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function Z0(e,n,o,u){return u!==null&&CE(u),Xp(n,e.child,null,o),e=BE(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function FV(e,n,o,u,g,b,C){if(o)return n.flags&256?(n.flags&=-257,u=H2(Error(Yt(422))),Z0(e,n,C,u)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(b=u.fallback,g=n.mode,u=D1({mode:"visible",children:u.children},g,0,null),b=bh(b,g,C,null),b.flags|=2,u.return=n,b.return=n,u.sibling=b,n.child=u,n.mode&1&&Xp(n,e.child,null,C),n.child.memoizedState=sT(C),n.memoizedState=iT,b);if(!(n.mode&1))return Z0(e,n,C,null);if(g.data==="$!"){if(u=g.nextSibling&&g.nextSibling.dataset,u)var i=u.dgst;return u=i,b=Error(Yt(419)),u=H2(b,u,void 0),Z0(e,n,C,u)}if(i=(C&e.childLanes)!==0,So||i){if(u=gs,u!==null){switch(C&-C){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(u.suspendedLanes|C)?0:g,g!==0&&g!==b.retryLane&&(b.retryLane=g,pc(e,g),Xa(u,e,g,-1))}return HE(),u=H2(Error(Yt(421))),Z0(e,n,C,u)}return g.data==="$?"?(n.flags|=128,n.child=e.child,n=JV.bind(null,e),g._reactRetry=n,null):(e=b.treeContext,qo=Vu(g.nextSibling),Ho=n,pi=!0,Wa=null,e!==null&&(ca[ua++]=ac,ca[ua++]=lc,ca[ua++]=Sh,ac=e.id,lc=e.overflow,Sh=n),n=BE(n,u.children),n.flags|=4096,n)}function OR(e,n,o){e.lanes|=n;var u=e.alternate;u!==null&&(u.lanes|=n),JS(e.return,n,o)}function W2(e,n,o,u,g){var b=e.memoizedState;b===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:g}:(b.isBackwards=n,b.rendering=null,b.renderingStartTime=0,b.last=u,b.tail=o,b.tailMode=g)}function TL(e,n,o){var u=n.pendingProps,g=u.revealOrder,b=u.tail;if(to(e,n,u.children,o),u=bi.current,u&2)u=u&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&OR(e,o,n);else if(e.tag===19)OR(e,o,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}u&=1}if(ni(bi,u),!(n.mode&1))n.memoizedState=null;else switch(g){case"forwards":for(o=n.child,g=null;o!==null;)e=o.alternate,e!==null&&Zx(e)===null&&(g=o),o=o.sibling;o=g,o===null?(g=n.child,n.child=null):(g=o.sibling,o.sibling=null),W2(n,!1,g,o,b);break;case"backwards":for(o=null,g=n.child,n.child=null;g!==null;){if(e=g.alternate,e!==null&&Zx(e)===null){n.child=g;break}e=g.sibling,g.sibling=o,o=g,g=e}W2(n,!0,o,null,b);break;case"together":W2(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function wx(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function mc(e,n,o){if(e!==null&&(n.dependencies=e.dependencies),Eh|=n.lanes,!(o&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(Yt(153));if(n.child!==null){for(e=n.child,o=Hu(e,e.pendingProps),n.child=o,o.return=n;e.sibling!==null;)e=e.sibling,o=o.sibling=Hu(e,e.pendingProps),o.return=n;o.sibling=null}return n.child}function BV(e,n,o){switch(n.tag){case 3:wL(n),Zp();break;case 5:KD(n);break;case 1:Eo(n.type)&&Vx(n);break;case 4:kE(n,n.stateNode.containerInfo);break;case 10:var u=n.type._context,g=n.memoizedProps.value;ni(qx,u._currentValue),u._currentValue=g;break;case 13:if(u=n.memoizedState,u!==null)return u.dehydrated!==null?(ni(bi,bi.current&1),n.flags|=128,null):o&n.child.childLanes?SL(e,n,o):(ni(bi,bi.current&1),e=mc(e,n,o),e!==null?e.sibling:null);ni(bi,bi.current&1);break;case 19:if(u=(o&n.childLanes)!==0,e.flags&128){if(u)return TL(e,n,o);n.flags|=128}if(g=n.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ni(bi,bi.current),u)break;return null;case 22:case 23:return n.lanes=0,xL(e,n,o)}return mc(e,n,o)}var EL,oT,CL,AL;EL=function(e,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};oT=function(){};CL=function(e,n,o,u){var g=e.memoizedProps;if(g!==u){e=n.stateNode,dh(kl.current);var b=null;switch(o){case"input":g=MS(e,g),u=MS(e,u),b=[];break;case"select":g=Ai({},g,{value:void 0}),u=Ai({},u,{value:void 0}),b=[];break;case"textarea":g=RS(e,g),u=RS(e,u),b=[];break;default:typeof g.onClick!="function"&&typeof u.onClick=="function"&&(e.onclick=Bx)}DS(o,u);var C;o=null;for(O in g)if(!u.hasOwnProperty(O)&&g.hasOwnProperty(O)&&g[O]!=null)if(O==="style"){var i=g[O];for(C in i)i.hasOwnProperty(C)&&(o||(o={}),o[C]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(X_.hasOwnProperty(O)?b||(b=[]):(b=b||[]).push(O,null));for(O in u){var L=u[O];if(i=g!=null?g[O]:void 0,u.hasOwnProperty(O)&&L!==i&&(L!=null||i!=null))if(O==="style")if(i){for(C in i)!i.hasOwnProperty(C)||L&&L.hasOwnProperty(C)||(o||(o={}),o[C]="");for(C in L)L.hasOwnProperty(C)&&i[C]!==L[C]&&(o||(o={}),o[C]=L[C])}else o||(b||(b=[]),b.push(O,o)),o=L;else O==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,i=i?i.__html:void 0,L!=null&&i!==L&&(b=b||[]).push(O,L)):O==="children"?typeof L!="string"&&typeof L!="number"||(b=b||[]).push(O,""+L):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(X_.hasOwnProperty(O)?(L!=null&&O==="onScroll"&&li("scroll",e),b||i===L||(b=[])):(b=b||[]).push(O,L))}o&&(b=b||[]).push("style",o);var O=b;(n.updateQueue=O)&&(n.flags|=4)}};AL=function(e,n,o,u){o!==u&&(n.flags|=4)};function v_(e,n){if(!pi)switch(e.tailMode){case"hidden":n=e.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:u.sibling=null}}function Fs(e){var n=e.alternate!==null&&e.alternate.child===e.child,o=0,u=0;if(n)for(var g=e.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags&14680064,u|=g.flags&14680064,g.return=e,g=g.sibling;else for(g=e.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags,u|=g.flags,g.return=e,g=g.sibling;return e.subtreeFlags|=u,e.childLanes=o,n}function UV(e,n,o){var u=n.pendingProps;switch(EE(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fs(n),null;case 1:return Eo(n.type)&&Ux(),Fs(n),null;case 3:return u=n.stateNode,Kp(),ci(To),ci(Vs),LE(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(e===null||e.child===null)&&(H0(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Wa!==null&&(pT(Wa),Wa=null))),oT(e,n),Fs(n),null;case 5:DE(n);var g=dh(ay.current);if(o=n.type,e!==null&&n.stateNode!=null)CL(e,n,o,u,g),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!u){if(n.stateNode===null)throw Error(Yt(166));return Fs(n),null}if(e=dh(kl.current),H0(n)){u=n.stateNode,o=n.type;var b=n.memoizedProps;switch(u[Il]=n,u[sy]=b,e=(n.mode&1)!==0,o){case"dialog":li("cancel",u),li("close",u);break;case"iframe":case"object":case"embed":li("load",u);break;case"video":case"audio":for(g=0;g<A_.length;g++)li(A_[g],u);break;case"source":li("error",u);break;case"img":case"image":case"link":li("error",u),li("load",u);break;case"details":li("toggle",u);break;case"input":qP(u,b),li("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!b.multiple},li("invalid",u);break;case"textarea":WP(u,b),li("invalid",u)}DS(o,b),g=null;for(var C in b)if(b.hasOwnProperty(C)){var i=b[C];C==="children"?typeof i=="string"?u.textContent!==i&&(b.suppressHydrationWarning!==!0&&q0(u.textContent,i,e),g=["children",i]):typeof i=="number"&&u.textContent!==""+i&&(b.suppressHydrationWarning!==!0&&q0(u.textContent,i,e),g=["children",""+i]):X_.hasOwnProperty(C)&&i!=null&&C==="onScroll"&&li("scroll",u)}switch(o){case"input":z0(u),HP(u,b,!0);break;case"textarea":z0(u),ZP(u);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(u.onclick=Bx)}u=g,n.updateQueue=u,u!==null&&(n.flags|=4)}else{C=g.nodeType===9?g:g.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tD(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=C.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof u.is=="string"?e=C.createElement(o,{is:u.is}):(e=C.createElement(o),o==="select"&&(C=e,u.multiple?C.multiple=!0:u.size&&(C.size=u.size))):e=C.createElementNS(e,o),e[Il]=n,e[sy]=u,EL(e,n,!1,!1),n.stateNode=e;e:{switch(C=LS(o,u),o){case"dialog":li("cancel",e),li("close",e),g=u;break;case"iframe":case"object":case"embed":li("load",e),g=u;break;case"video":case"audio":for(g=0;g<A_.length;g++)li(A_[g],e);g=u;break;case"source":li("error",e),g=u;break;case"img":case"image":case"link":li("error",e),li("load",e),g=u;break;case"details":li("toggle",e),g=u;break;case"input":qP(e,u),g=MS(e,u),li("invalid",e);break;case"option":g=u;break;case"select":e._wrapperState={wasMultiple:!!u.multiple},g=Ai({},u,{value:void 0}),li("invalid",e);break;case"textarea":WP(e,u),g=RS(e,u),li("invalid",e);break;default:g=u}DS(o,g),i=g;for(b in i)if(i.hasOwnProperty(b)){var L=i[b];b==="style"?iD(e,L):b==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,L!=null&&rD(e,L)):b==="children"?typeof L=="string"?(o!=="textarea"||L!=="")&&K_(e,L):typeof L=="number"&&K_(e,""+L):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(X_.hasOwnProperty(b)?L!=null&&b==="onScroll"&&li("scroll",e):L!=null&&uE(e,b,L,C))}switch(o){case"input":z0(e),HP(e,u,!1);break;case"textarea":z0(e),ZP(e);break;case"option":u.value!=null&&e.setAttribute("value",""+Zu(u.value));break;case"select":e.multiple=!!u.multiple,b=u.value,b!=null?Ap(e,!!u.multiple,b,!1):u.defaultValue!=null&&Ap(e,!!u.multiple,u.defaultValue,!0);break;default:typeof g.onClick=="function"&&(e.onclick=Bx)}switch(o){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Fs(n),null;case 6:if(e&&n.stateNode!=null)AL(e,n,e.memoizedProps,u);else{if(typeof u!="string"&&n.stateNode===null)throw Error(Yt(166));if(o=dh(ay.current),dh(kl.current),H0(n)){if(u=n.stateNode,o=n.memoizedProps,u[Il]=n,(b=u.nodeValue!==o)&&(e=Ho,e!==null))switch(e.tag){case 3:q0(u.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&q0(u.nodeValue,o,(e.mode&1)!==0)}b&&(n.flags|=4)}else u=(o.nodeType===9?o:o.ownerDocument).createTextNode(u),u[Il]=n,n.stateNode=u}return Fs(n),null;case 13:if(ci(bi),u=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(pi&&qo!==null&&n.mode&1&&!(n.flags&128))qD(),Zp(),n.flags|=98560,b=!1;else if(b=H0(n),u!==null&&u.dehydrated!==null){if(e===null){if(!b)throw Error(Yt(318));if(b=n.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(Yt(317));b[Il]=n}else Zp(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Fs(n),b=!1}else Wa!==null&&(pT(Wa),Wa=null),b=!0;if(!b)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(u=u!==null,u!==(e!==null&&e.memoizedState!==null)&&u&&(n.child.flags|=8192,n.mode&1&&(e===null||bi.current&1?as===0&&(as=3):HE())),n.updateQueue!==null&&(n.flags|=4),Fs(n),null);case 4:return Kp(),oT(e,n),e===null&&ny(n.stateNode.containerInfo),Fs(n),null;case 10:return IE(n.type._context),Fs(n),null;case 17:return Eo(n.type)&&Ux(),Fs(n),null;case 19:if(ci(bi),b=n.memoizedState,b===null)return Fs(n),null;if(u=(n.flags&128)!==0,C=b.rendering,C===null)if(u)v_(b,!1);else{if(as!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(C=Zx(e),C!==null){for(n.flags|=128,v_(b,!1),u=C.updateQueue,u!==null&&(n.updateQueue=u,n.flags|=4),n.subtreeFlags=0,u=o,o=n.child;o!==null;)b=o,e=u,b.flags&=14680066,C=b.alternate,C===null?(b.childLanes=0,b.lanes=e,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=C.childLanes,b.lanes=C.lanes,b.child=C.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=C.memoizedProps,b.memoizedState=C.memoizedState,b.updateQueue=C.updateQueue,b.type=C.type,e=C.dependencies,b.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return ni(bi,bi.current&1|2),n.child}e=e.sibling}b.tail!==null&&Vi()>Jp&&(n.flags|=128,u=!0,v_(b,!1),n.lanes=4194304)}else{if(!u)if(e=Zx(C),e!==null){if(n.flags|=128,u=!0,o=e.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),v_(b,!0),b.tail===null&&b.tailMode==="hidden"&&!C.alternate&&!pi)return Fs(n),null}else 2*Vi()-b.renderingStartTime>Jp&&o!==1073741824&&(n.flags|=128,u=!0,v_(b,!1),n.lanes=4194304);b.isBackwards?(C.sibling=n.child,n.child=C):(o=b.last,o!==null?o.sibling=C:n.child=C,b.last=C)}return b.tail!==null?(n=b.tail,b.rendering=n,b.tail=n.sibling,b.renderingStartTime=Vi(),n.sibling=null,o=bi.current,ni(bi,u?o&1|2:o&1),n):(Fs(n),null);case 22:case 23:return qE(),u=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==u&&(n.flags|=8192),u&&n.mode&1?$o&1073741824&&(Fs(n),n.subtreeFlags&6&&(n.flags|=8192)):Fs(n),null;case 24:return null;case 25:return null}throw Error(Yt(156,n.tag))}function VV(e,n){switch(EE(n),n.tag){case 1:return Eo(n.type)&&Ux(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Kp(),ci(To),ci(Vs),LE(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return DE(n),null;case 13:if(ci(bi),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(Yt(340));Zp()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return ci(bi),null;case 4:return Kp(),null;case 10:return IE(n.type._context),null;case 22:case 23:return qE(),null;case 24:return null;default:return null}}var X0=!1,Us=!1,$V=typeof WeakSet=="function"?WeakSet:Set,Sr=null;function xp(e,n){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(u){Ni(e,n,u)}else o.current=null}function aT(e,n,o){try{o()}catch(u){Ni(e,n,u)}}var zR=!1;function GV(e,n){if(GS=zx,e=kD(),SE(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var g=u.anchorOffset,b=u.focusNode;u=u.focusOffset;try{o.nodeType,b.nodeType}catch{o=null;break e}var C=0,i=-1,L=-1,O=0,U=0,q=e,G=null;t:for(;;){for(var ie;q!==o||g!==0&&q.nodeType!==3||(i=C+g),q!==b||u!==0&&q.nodeType!==3||(L=C+u),q.nodeType===3&&(C+=q.nodeValue.length),(ie=q.firstChild)!==null;)G=q,q=ie;for(;;){if(q===e)break t;if(G===o&&++O===g&&(i=C),G===b&&++U===u&&(L=C),(ie=q.nextSibling)!==null)break;q=G,G=q.parentNode}q=ie}o=i===-1||L===-1?null:{start:i,end:L}}else o=null}o=o||{start:0,end:0}}else o=null;for(qS={focusedElem:e,selectionRange:o},zx=!1,Sr=n;Sr!==null;)if(n=Sr,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Sr=e;else for(;Sr!==null;){n=Sr;try{var J=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var K=J.memoizedProps,re=J.memoizedState,Q=n.stateNode,ee=Q.getSnapshotBeforeUpdate(n.elementType===n.type?K:Va(n.type,K),re);Q.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var ue=n.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Yt(163))}}catch(fe){Ni(n,n.return,fe)}if(e=n.sibling,e!==null){e.return=n.return,Sr=e;break}Sr=n.return}return J=zR,zR=!1,J}function U_(e,n,o){var u=n.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var g=u=u.next;do{if((g.tag&e)===e){var b=g.destroy;g.destroy=void 0,b!==void 0&&aT(n,o,b)}g=g.next}while(g!==u)}}function R1(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var u=o.create;o.destroy=u()}o=o.next}while(o!==n)}}function lT(e){var n=e.ref;if(n!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof n=="function"?n(e):n.current=e}}function ML(e){var n=e.alternate;n!==null&&(e.alternate=null,ML(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Il],delete n[sy],delete n[ZS],delete n[CV],delete n[AV])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function IL(e){return e.tag===5||e.tag===3||e.tag===4}function jR(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||IL(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function cT(e,n,o){var u=e.tag;if(u===5||u===6)e=e.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(e,n):o.insertBefore(e,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(e,o)):(n=o,n.appendChild(e)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=Bx));else if(u!==4&&(e=e.child,e!==null))for(cT(e,n,o),e=e.sibling;e!==null;)cT(e,n,o),e=e.sibling}function uT(e,n,o){var u=e.tag;if(u===5||u===6)e=e.stateNode,n?o.insertBefore(e,n):o.appendChild(e);else if(u!==4&&(e=e.child,e!==null))for(uT(e,n,o),e=e.sibling;e!==null;)uT(e,n,o),e=e.sibling}var Cs=null,qa=!1;function _u(e,n,o){for(o=o.child;o!==null;)PL(e,n,o),o=o.sibling}function PL(e,n,o){if(Rl&&typeof Rl.onCommitFiberUnmount=="function")try{Rl.onCommitFiberUnmount(S1,o)}catch{}switch(o.tag){case 5:Us||xp(o,n);case 6:var u=Cs,g=qa;Cs=null,_u(e,n,o),Cs=u,qa=g,Cs!==null&&(qa?(e=Cs,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):Cs.removeChild(o.stateNode));break;case 18:Cs!==null&&(qa?(e=Cs,o=o.stateNode,e.nodeType===8?B2(e.parentNode,o):e.nodeType===1&&B2(e,o),ey(e)):B2(Cs,o.stateNode));break;case 4:u=Cs,g=qa,Cs=o.stateNode.containerInfo,qa=!0,_u(e,n,o),Cs=u,qa=g;break;case 0:case 11:case 14:case 15:if(!Us&&(u=o.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){g=u=u.next;do{var b=g,C=b.destroy;b=b.tag,C!==void 0&&(b&2||b&4)&&aT(o,n,C),g=g.next}while(g!==u)}_u(e,n,o);break;case 1:if(!Us&&(xp(o,n),u=o.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=o.memoizedProps,u.state=o.memoizedState,u.componentWillUnmount()}catch(i){Ni(o,n,i)}_u(e,n,o);break;case 21:_u(e,n,o);break;case 22:o.mode&1?(Us=(u=Us)||o.memoizedState!==null,_u(e,n,o),Us=u):_u(e,n,o);break;default:_u(e,n,o)}}function FR(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new $V),n.forEach(function(u){var g=QV.bind(null,e,u);o.has(u)||(o.add(u),u.then(g,g))})}}function Ba(e,n){var o=n.deletions;if(o!==null)for(var u=0;u<o.length;u++){var g=o[u];try{var b=e,C=n,i=C;e:for(;i!==null;){switch(i.tag){case 5:Cs=i.stateNode,qa=!1;break e;case 3:Cs=i.stateNode.containerInfo,qa=!0;break e;case 4:Cs=i.stateNode.containerInfo,qa=!0;break e}i=i.return}if(Cs===null)throw Error(Yt(160));PL(b,C,g),Cs=null,qa=!1;var L=g.alternate;L!==null&&(L.return=null),g.return=null}catch(O){Ni(g,n,O)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)RL(n,e),n=n.sibling}function RL(e,n){var o=e.alternate,u=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ba(n,e),wl(e),u&4){try{U_(3,e,e.return),R1(3,e)}catch(K){Ni(e,e.return,K)}try{U_(5,e,e.return)}catch(K){Ni(e,e.return,K)}}break;case 1:Ba(n,e),wl(e),u&512&&o!==null&&xp(o,o.return);break;case 5:if(Ba(n,e),wl(e),u&512&&o!==null&&xp(o,o.return),e.flags&32){var g=e.stateNode;try{K_(g,"")}catch(K){Ni(e,e.return,K)}}if(u&4&&(g=e.stateNode,g!=null)){var b=e.memoizedProps,C=o!==null?o.memoizedProps:b,i=e.type,L=e.updateQueue;if(e.updateQueue=null,L!==null)try{i==="input"&&b.type==="radio"&&b.name!=null&&Q3(g,b),LS(i,C);var O=LS(i,b);for(C=0;C<L.length;C+=2){var U=L[C],q=L[C+1];U==="style"?iD(g,q):U==="dangerouslySetInnerHTML"?rD(g,q):U==="children"?K_(g,q):uE(g,U,q,O)}switch(i){case"input":IS(g,b);break;case"textarea":eD(g,b);break;case"select":var G=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!b.multiple;var ie=b.value;ie!=null?Ap(g,!!b.multiple,ie,!1):G!==!!b.multiple&&(b.defaultValue!=null?Ap(g,!!b.multiple,b.defaultValue,!0):Ap(g,!!b.multiple,b.multiple?[]:"",!1))}g[sy]=b}catch(K){Ni(e,e.return,K)}}break;case 6:if(Ba(n,e),wl(e),u&4){if(e.stateNode===null)throw Error(Yt(162));g=e.stateNode,b=e.memoizedProps;try{g.nodeValue=b}catch(K){Ni(e,e.return,K)}}break;case 3:if(Ba(n,e),wl(e),u&4&&o!==null&&o.memoizedState.isDehydrated)try{ey(n.containerInfo)}catch(K){Ni(e,e.return,K)}break;case 4:Ba(n,e),wl(e);break;case 13:Ba(n,e),wl(e),g=e.child,g.flags&8192&&(b=g.memoizedState!==null,g.stateNode.isHidden=b,!b||g.alternate!==null&&g.alternate.memoizedState!==null||($E=Vi())),u&4&&FR(e);break;case 22:if(U=o!==null&&o.memoizedState!==null,e.mode&1?(Us=(O=Us)||U,Ba(n,e),Us=O):Ba(n,e),wl(e),u&8192){if(O=e.memoizedState!==null,(e.stateNode.isHidden=O)&&!U&&e.mode&1)for(Sr=e,U=e.child;U!==null;){for(q=Sr=U;Sr!==null;){switch(G=Sr,ie=G.child,G.tag){case 0:case 11:case 14:case 15:U_(4,G,G.return);break;case 1:xp(G,G.return);var J=G.stateNode;if(typeof J.componentWillUnmount=="function"){u=G,o=G.return;try{n=u,J.props=n.memoizedProps,J.state=n.memoizedState,J.componentWillUnmount()}catch(K){Ni(u,o,K)}}break;case 5:xp(G,G.return);break;case 22:if(G.memoizedState!==null){UR(q);continue}}ie!==null?(ie.return=G,Sr=ie):UR(q)}U=U.sibling}e:for(U=null,q=e;;){if(q.tag===5){if(U===null){U=q;try{g=q.stateNode,O?(b=g.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(i=q.stateNode,L=q.memoizedProps.style,C=L!=null&&L.hasOwnProperty("display")?L.display:null,i.style.display=nD("display",C))}catch(K){Ni(e,e.return,K)}}}else if(q.tag===6){if(U===null)try{q.stateNode.nodeValue=O?"":q.memoizedProps}catch(K){Ni(e,e.return,K)}}else if((q.tag!==22&&q.tag!==23||q.memoizedState===null||q===e)&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===e)break e;for(;q.sibling===null;){if(q.return===null||q.return===e)break e;U===q&&(U=null),q=q.return}U===q&&(U=null),q.sibling.return=q.return,q=q.sibling}}break;case 19:Ba(n,e),wl(e),u&4&&FR(e);break;case 21:break;default:Ba(n,e),wl(e)}}function wl(e){var n=e.flags;if(n&2){try{e:{for(var o=e.return;o!==null;){if(IL(o)){var u=o;break e}o=o.return}throw Error(Yt(160))}switch(u.tag){case 5:var g=u.stateNode;u.flags&32&&(K_(g,""),u.flags&=-33);var b=jR(e);uT(e,b,g);break;case 3:case 4:var C=u.stateNode.containerInfo,i=jR(e);cT(e,i,C);break;default:throw Error(Yt(161))}}catch(L){Ni(e,e.return,L)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function qV(e,n,o){Sr=e,kL(e)}function kL(e,n,o){for(var u=(e.mode&1)!==0;Sr!==null;){var g=Sr,b=g.child;if(g.tag===22&&u){var C=g.memoizedState!==null||X0;if(!C){var i=g.alternate,L=i!==null&&i.memoizedState!==null||Us;i=X0;var O=Us;if(X0=C,(Us=L)&&!O)for(Sr=g;Sr!==null;)C=Sr,L=C.child,C.tag===22&&C.memoizedState!==null?VR(g):L!==null?(L.return=C,Sr=L):VR(g);for(;b!==null;)Sr=b,kL(b),b=b.sibling;Sr=g,X0=i,Us=O}BR(e)}else g.subtreeFlags&8772&&b!==null?(b.return=g,Sr=b):BR(e)}}function BR(e){for(;Sr!==null;){var n=Sr;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Us||R1(5,n);break;case 1:var u=n.stateNode;if(n.flags&4&&!Us)if(o===null)u.componentDidMount();else{var g=n.elementType===n.type?o.memoizedProps:Va(n.type,o.memoizedProps);u.componentDidUpdate(g,o.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var b=n.updateQueue;b!==null&&TR(n,b,u);break;case 3:var C=n.updateQueue;if(C!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}TR(n,C,o)}break;case 5:var i=n.stateNode;if(o===null&&n.flags&4){o=i;var L=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":L.autoFocus&&o.focus();break;case"img":L.src&&(o.src=L.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var O=n.alternate;if(O!==null){var U=O.memoizedState;if(U!==null){var q=U.dehydrated;q!==null&&ey(q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Yt(163))}Us||n.flags&512&&lT(n)}catch(G){Ni(n,n.return,G)}}if(n===e){Sr=null;break}if(o=n.sibling,o!==null){o.return=n.return,Sr=o;break}Sr=n.return}}function UR(e){for(;Sr!==null;){var n=Sr;if(n===e){Sr=null;break}var o=n.sibling;if(o!==null){o.return=n.return,Sr=o;break}Sr=n.return}}function VR(e){for(;Sr!==null;){var n=Sr;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{R1(4,n)}catch(L){Ni(n,o,L)}break;case 1:var u=n.stateNode;if(typeof u.componentDidMount=="function"){var g=n.return;try{u.componentDidMount()}catch(L){Ni(n,g,L)}}var b=n.return;try{lT(n)}catch(L){Ni(n,b,L)}break;case 5:var C=n.return;try{lT(n)}catch(L){Ni(n,C,L)}}}catch(L){Ni(n,n.return,L)}if(n===e){Sr=null;break}var i=n.sibling;if(i!==null){i.return=n.return,Sr=i;break}Sr=n.return}}var HV=Math.ceil,Yx=yc.ReactCurrentDispatcher,UE=yc.ReactCurrentOwner,ha=yc.ReactCurrentBatchConfig,On=0,gs=null,Zi=null,As=0,$o=0,bp=nd(0),as=0,dy=null,Eh=0,k1=0,VE=0,V_=null,bo=null,$E=0,Jp=1/0,ic=null,Jx=!1,dT=null,Gu=null,K0=!1,Ou=null,Qx=0,$_=0,hT=null,Sx=-1,Tx=0;function no(){return On&6?Vi():Sx!==-1?Sx:Sx=Vi()}function qu(e){return e.mode&1?On&2&&As!==0?As&-As:IV.transition!==null?(Tx===0&&(Tx=gD()),Tx):(e=Wn,e!==0||(e=window.event,e=e===void 0?16:SD(e.type)),e):1}function Xa(e,n,o,u){if(50<$_)throw $_=0,hT=null,Error(Yt(185));Iy(e,o,u),(!(On&2)||e!==gs)&&(e===gs&&(!(On&2)&&(k1|=o),as===4&&Mu(e,As)),Co(e,u),o===1&&On===0&&!(n.mode&1)&&(Jp=Vi()+500,M1&&id()))}function Co(e,n){var o=e.callbackNode;IU(e,n);var u=Ox(e,e===gs?As:0);if(u===0)o!==null&&YP(o),e.callbackNode=null,e.callbackPriority=0;else if(n=u&-u,e.callbackPriority!==n){if(o!=null&&YP(o),n===1)e.tag===0?MV($R.bind(null,e)):VD($R.bind(null,e)),TV(function(){!(On&6)&&id()}),o=null;else{switch(_D(u)){case 1:o=mE;break;case 4:o=pD;break;case 16:o=Nx;break;case 536870912:o=mD;break;default:o=Nx}o=BL(o,DL.bind(null,e))}e.callbackPriority=n,e.callbackNode=o}}function DL(e,n){if(Sx=-1,Tx=0,On&6)throw Error(Yt(327));var o=e.callbackNode;if(kp()&&e.callbackNode!==o)return null;var u=Ox(e,e===gs?As:0);if(u===0)return null;if(u&30||u&e.expiredLanes||n)n=e1(e,u);else{n=u;var g=On;On|=2;var b=NL();(gs!==e||As!==n)&&(ic=null,Jp=Vi()+500,xh(e,n));do try{XV();break}catch(i){LL(e,i)}while(!0);ME(),Yx.current=b,On=g,Zi!==null?n=0:(gs=null,As=0,n=as)}if(n!==0){if(n===2&&(g=FS(e),g!==0&&(u=g,n=fT(e,g))),n===1)throw o=dy,xh(e,0),Mu(e,u),Co(e,Vi()),o;if(n===6)Mu(e,u);else{if(g=e.current.alternate,!(u&30)&&!WV(g)&&(n=e1(e,u),n===2&&(b=FS(e),b!==0&&(u=b,n=fT(e,b))),n===1))throw o=dy,xh(e,0),Mu(e,u),Co(e,Vi()),o;switch(e.finishedWork=g,e.finishedLanes=u,n){case 0:case 1:throw Error(Yt(345));case 2:oh(e,bo,ic);break;case 3:if(Mu(e,u),(u&130023424)===u&&(n=$E+500-Vi(),10<n)){if(Ox(e,0)!==0)break;if(g=e.suspendedLanes,(g&u)!==u){no(),e.pingedLanes|=e.suspendedLanes&g;break}e.timeoutHandle=WS(oh.bind(null,e,bo,ic),n);break}oh(e,bo,ic);break;case 4:if(Mu(e,u),(u&4194240)===u)break;for(n=e.eventTimes,g=-1;0<u;){var C=31-Za(u);b=1<<C,C=n[C],C>g&&(g=C),u&=~b}if(u=g,u=Vi()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*HV(u/1960))-u,10<u){e.timeoutHandle=WS(oh.bind(null,e,bo,ic),u);break}oh(e,bo,ic);break;case 5:oh(e,bo,ic);break;default:throw Error(Yt(329))}}}return Co(e,Vi()),e.callbackNode===o?DL.bind(null,e):null}function fT(e,n){var o=V_;return e.current.memoizedState.isDehydrated&&(xh(e,n).flags|=256),e=e1(e,n),e!==2&&(n=bo,bo=o,n!==null&&pT(n)),e}function pT(e){bo===null?bo=e:bo.push.apply(bo,e)}function WV(e){for(var n=e;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var u=0;u<o.length;u++){var g=o[u],b=g.getSnapshot;g=g.value;try{if(!Ja(b(),g))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Mu(e,n){for(n&=~VE,n&=~k1,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var o=31-Za(n),u=1<<o;e[o]=-1,n&=~u}}function $R(e){if(On&6)throw Error(Yt(327));kp();var n=Ox(e,0);if(!(n&1))return Co(e,Vi()),null;var o=e1(e,n);if(e.tag!==0&&o===2){var u=FS(e);u!==0&&(n=u,o=fT(e,u))}if(o===1)throw o=dy,xh(e,0),Mu(e,n),Co(e,Vi()),o;if(o===6)throw Error(Yt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,oh(e,bo,ic),Co(e,Vi()),null}function GE(e,n){var o=On;On|=1;try{return e(n)}finally{On=o,On===0&&(Jp=Vi()+500,M1&&id())}}function Ch(e){Ou!==null&&Ou.tag===0&&!(On&6)&&kp();var n=On;On|=1;var o=ha.transition,u=Wn;try{if(ha.transition=null,Wn=1,e)return e()}finally{Wn=u,ha.transition=o,On=n,!(On&6)&&id()}}function qE(){$o=bp.current,ci(bp)}function xh(e,n){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,SV(o)),Zi!==null)for(o=Zi.return;o!==null;){var u=o;switch(EE(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&Ux();break;case 3:Kp(),ci(To),ci(Vs),LE();break;case 5:DE(u);break;case 4:Kp();break;case 13:ci(bi);break;case 19:ci(bi);break;case 10:IE(u.type._context);break;case 22:case 23:qE()}o=o.return}if(gs=e,Zi=e=Hu(e.current,null),As=$o=n,as=0,dy=null,VE=k1=Eh=0,bo=V_=null,uh!==null){for(n=0;n<uh.length;n++)if(o=uh[n],u=o.interleaved,u!==null){o.interleaved=null;var g=u.next,b=o.pending;if(b!==null){var C=b.next;b.next=g,u.next=C}o.pending=u}uh=null}return e}function LL(e,n){do{var o=Zi;try{if(ME(),xx.current=Kx,Xx){for(var u=Ci.memoizedState;u!==null;){var g=u.queue;g!==null&&(g.pending=null),u=u.next}Xx=!1}if(Th=0,ms=os=Ci=null,B_=!1,ly=0,UE.current=null,o===null||o.return===null){as=1,dy=n,Zi=null;break}e:{var b=e,C=o.return,i=o,L=n;if(n=As,i.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){var O=L,U=i,q=U.tag;if(!(U.mode&1)&&(q===0||q===11||q===15)){var G=U.alternate;G?(U.updateQueue=G.updateQueue,U.memoizedState=G.memoizedState,U.lanes=G.lanes):(U.updateQueue=null,U.memoizedState=null)}var ie=PR(C);if(ie!==null){ie.flags&=-257,RR(ie,C,i,b,n),ie.mode&1&&IR(b,O,n),n=ie,L=O;var J=n.updateQueue;if(J===null){var K=new Set;K.add(L),n.updateQueue=K}else J.add(L);break e}else{if(!(n&1)){IR(b,O,n),HE();break e}L=Error(Yt(426))}}else if(pi&&i.mode&1){var re=PR(C);if(re!==null){!(re.flags&65536)&&(re.flags|=256),RR(re,C,i,b,n),CE(Yp(L,i));break e}}b=L=Yp(L,i),as!==4&&(as=2),V_===null?V_=[b]:V_.push(b),b=C;do{switch(b.tag){case 3:b.flags|=65536,n&=-n,b.lanes|=n;var Q=_L(b,L,n);SR(b,Q);break e;case 1:i=L;var ee=b.type,ue=b.stateNode;if(!(b.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Gu===null||!Gu.has(ue)))){b.flags|=65536,n&=-n,b.lanes|=n;var fe=yL(b,i,n);SR(b,fe);break e}}b=b.return}while(b!==null)}zL(o)}catch(ge){n=ge,Zi===o&&o!==null&&(Zi=o=o.return);continue}break}while(!0)}function NL(){var e=Yx.current;return Yx.current=Kx,e===null?Kx:e}function HE(){(as===0||as===3||as===2)&&(as=4),gs===null||!(Eh&268435455)&&!(k1&268435455)||Mu(gs,As)}function e1(e,n){var o=On;On|=2;var u=NL();(gs!==e||As!==n)&&(ic=null,xh(e,n));do try{ZV();break}catch(g){LL(e,g)}while(!0);if(ME(),On=o,Yx.current=u,Zi!==null)throw Error(Yt(261));return gs=null,As=0,as}function ZV(){for(;Zi!==null;)OL(Zi)}function XV(){for(;Zi!==null&&!xU();)OL(Zi)}function OL(e){var n=FL(e.alternate,e,$o);e.memoizedProps=e.pendingProps,n===null?zL(e):Zi=n,UE.current=null}function zL(e){var n=e;do{var o=n.alternate;if(e=n.return,n.flags&32768){if(o=VV(o,n),o!==null){o.flags&=32767,Zi=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{as=6,Zi=null;return}}else if(o=UV(o,n,$o),o!==null){Zi=o;return}if(n=n.sibling,n!==null){Zi=n;return}Zi=n=e}while(n!==null);as===0&&(as=5)}function oh(e,n,o){var u=Wn,g=ha.transition;try{ha.transition=null,Wn=1,KV(e,n,o,u)}finally{ha.transition=g,Wn=u}return null}function KV(e,n,o,u){do kp();while(Ou!==null);if(On&6)throw Error(Yt(327));o=e.finishedWork;var g=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(Yt(177));e.callbackNode=null,e.callbackPriority=0;var b=o.lanes|o.childLanes;if(PU(e,b),e===gs&&(Zi=gs=null,As=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||K0||(K0=!0,BL(Nx,function(){return kp(),null})),b=(o.flags&15990)!==0,o.subtreeFlags&15990||b){b=ha.transition,ha.transition=null;var C=Wn;Wn=1;var i=On;On|=4,UE.current=null,GV(e,o),RL(o,e),gV(qS),zx=!!GS,qS=GS=null,e.current=o,qV(o),bU(),On=i,Wn=C,ha.transition=b}else e.current=o;if(K0&&(K0=!1,Ou=e,Qx=g),b=e.pendingLanes,b===0&&(Gu=null),TU(o.stateNode),Co(e,Vi()),n!==null)for(u=e.onRecoverableError,o=0;o<n.length;o++)g=n[o],u(g.value,{componentStack:g.stack,digest:g.digest});if(Jx)throw Jx=!1,e=dT,dT=null,e;return Qx&1&&e.tag!==0&&kp(),b=e.pendingLanes,b&1?e===hT?$_++:($_=0,hT=e):$_=0,id(),null}function kp(){if(Ou!==null){var e=_D(Qx),n=ha.transition,o=Wn;try{if(ha.transition=null,Wn=16>e?16:e,Ou===null)var u=!1;else{if(e=Ou,Ou=null,Qx=0,On&6)throw Error(Yt(331));var g=On;for(On|=4,Sr=e.current;Sr!==null;){var b=Sr,C=b.child;if(Sr.flags&16){var i=b.deletions;if(i!==null){for(var L=0;L<i.length;L++){var O=i[L];for(Sr=O;Sr!==null;){var U=Sr;switch(U.tag){case 0:case 11:case 15:U_(8,U,b)}var q=U.child;if(q!==null)q.return=U,Sr=q;else for(;Sr!==null;){U=Sr;var G=U.sibling,ie=U.return;if(ML(U),U===O){Sr=null;break}if(G!==null){G.return=ie,Sr=G;break}Sr=ie}}}var J=b.alternate;if(J!==null){var K=J.child;if(K!==null){J.child=null;do{var re=K.sibling;K.sibling=null,K=re}while(K!==null)}}Sr=b}}if(b.subtreeFlags&2064&&C!==null)C.return=b,Sr=C;else e:for(;Sr!==null;){if(b=Sr,b.flags&2048)switch(b.tag){case 0:case 11:case 15:U_(9,b,b.return)}var Q=b.sibling;if(Q!==null){Q.return=b.return,Sr=Q;break e}Sr=b.return}}var ee=e.current;for(Sr=ee;Sr!==null;){C=Sr;var ue=C.child;if(C.subtreeFlags&2064&&ue!==null)ue.return=C,Sr=ue;else e:for(C=ee;Sr!==null;){if(i=Sr,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:R1(9,i)}}catch(ge){Ni(i,i.return,ge)}if(i===C){Sr=null;break e}var fe=i.sibling;if(fe!==null){fe.return=i.return,Sr=fe;break e}Sr=i.return}}if(On=g,id(),Rl&&typeof Rl.onPostCommitFiberRoot=="function")try{Rl.onPostCommitFiberRoot(S1,e)}catch{}u=!0}return u}finally{Wn=o,ha.transition=n}}return!1}function GR(e,n,o){n=Yp(o,n),n=_L(e,n,1),e=$u(e,n,1),n=no(),e!==null&&(Iy(e,1,n),Co(e,n))}function Ni(e,n,o){if(e.tag===3)GR(e,e,o);else for(;n!==null;){if(n.tag===3){GR(n,e,o);break}else if(n.tag===1){var u=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Gu===null||!Gu.has(u))){e=Yp(o,e),e=yL(n,e,1),n=$u(n,e,1),e=no(),n!==null&&(Iy(n,1,e),Co(n,e));break}}n=n.return}}function YV(e,n,o){var u=e.pingCache;u!==null&&u.delete(n),n=no(),e.pingedLanes|=e.suspendedLanes&o,gs===e&&(As&o)===o&&(as===4||as===3&&(As&130023424)===As&&500>Vi()-$E?xh(e,0):VE|=o),Co(e,n)}function jL(e,n){n===0&&(e.mode&1?(n=B0,B0<<=1,!(B0&130023424)&&(B0=4194304)):n=1);var o=no();e=pc(e,n),e!==null&&(Iy(e,n,o),Co(e,o))}function JV(e){var n=e.memoizedState,o=0;n!==null&&(o=n.retryLane),jL(e,o)}function QV(e,n){var o=0;switch(e.tag){case 13:var u=e.stateNode,g=e.memoizedState;g!==null&&(o=g.retryLane);break;case 19:u=e.stateNode;break;default:throw Error(Yt(314))}u!==null&&u.delete(n),jL(e,o)}var FL;FL=function(e,n,o){if(e!==null)if(e.memoizedProps!==n.pendingProps||To.current)So=!0;else{if(!(e.lanes&o)&&!(n.flags&128))return So=!1,BV(e,n,o);So=!!(e.flags&131072)}else So=!1,pi&&n.flags&1048576&&$D(n,Gx,n.index);switch(n.lanes=0,n.tag){case 2:var u=n.type;wx(e,n),e=n.pendingProps;var g=Wp(n,Vs.current);Rp(n,o),g=OE(null,n,u,e,g,o);var b=zE();return n.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Eo(u)?(b=!0,Vx(n)):b=!1,n.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,RE(n),g.updater=P1,n.stateNode=g,g._reactInternals=n,eT(n,u,e,o),n=nT(null,n,u,!0,b,o)):(n.tag=0,pi&&b&&TE(n),to(null,n,g,o),n=n.child),n;case 16:u=n.elementType;e:{switch(wx(e,n),e=n.pendingProps,g=u._init,u=g(u._payload),n.type=u,g=n.tag=t8(u),e=Va(u,e),g){case 0:n=rT(null,n,u,e,o);break e;case 1:n=LR(null,n,u,e,o);break e;case 11:n=kR(null,n,u,e,o);break e;case 14:n=DR(null,n,u,Va(u.type,e),o);break e}throw Error(Yt(306,u,""))}return n;case 0:return u=n.type,g=n.pendingProps,g=n.elementType===u?g:Va(u,g),rT(e,n,u,g,o);case 1:return u=n.type,g=n.pendingProps,g=n.elementType===u?g:Va(u,g),LR(e,n,u,g,o);case 3:e:{if(wL(n),e===null)throw Error(Yt(387));u=n.pendingProps,b=n.memoizedState,g=b.element,XD(e,n),Wx(n,u,null,o);var C=n.memoizedState;if(u=C.element,b.isDehydrated)if(b={element:u,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},n.updateQueue.baseState=b,n.memoizedState=b,n.flags&256){g=Yp(Error(Yt(423)),n),n=NR(e,n,u,o,g);break e}else if(u!==g){g=Yp(Error(Yt(424)),n),n=NR(e,n,u,o,g);break e}else for(qo=Vu(n.stateNode.containerInfo.firstChild),Ho=n,pi=!0,Wa=null,o=WD(n,null,u,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Zp(),u===g){n=mc(e,n,o);break e}to(e,n,u,o)}n=n.child}return n;case 5:return KD(n),e===null&&YS(n),u=n.type,g=n.pendingProps,b=e!==null?e.memoizedProps:null,C=g.children,HS(u,g)?C=null:b!==null&&HS(u,b)&&(n.flags|=32),bL(e,n),to(e,n,C,o),n.child;case 6:return e===null&&YS(n),null;case 13:return SL(e,n,o);case 4:return kE(n,n.stateNode.containerInfo),u=n.pendingProps,e===null?n.child=Xp(n,null,u,o):to(e,n,u,o),n.child;case 11:return u=n.type,g=n.pendingProps,g=n.elementType===u?g:Va(u,g),kR(e,n,u,g,o);case 7:return to(e,n,n.pendingProps,o),n.child;case 8:return to(e,n,n.pendingProps.children,o),n.child;case 12:return to(e,n,n.pendingProps.children,o),n.child;case 10:e:{if(u=n.type._context,g=n.pendingProps,b=n.memoizedProps,C=g.value,ni(qx,u._currentValue),u._currentValue=C,b!==null)if(Ja(b.value,C)){if(b.children===g.children&&!To.current){n=mc(e,n,o);break e}}else for(b=n.child,b!==null&&(b.return=n);b!==null;){var i=b.dependencies;if(i!==null){C=b.child;for(var L=i.firstContext;L!==null;){if(L.context===u){if(b.tag===1){L=uc(-1,o&-o),L.tag=2;var O=b.updateQueue;if(O!==null){O=O.shared;var U=O.pending;U===null?L.next=L:(L.next=U.next,U.next=L),O.pending=L}}b.lanes|=o,L=b.alternate,L!==null&&(L.lanes|=o),JS(b.return,o,n),i.lanes|=o;break}L=L.next}}else if(b.tag===10)C=b.type===n.type?null:b.child;else if(b.tag===18){if(C=b.return,C===null)throw Error(Yt(341));C.lanes|=o,i=C.alternate,i!==null&&(i.lanes|=o),JS(C,o,n),C=b.sibling}else C=b.child;if(C!==null)C.return=b;else for(C=b;C!==null;){if(C===n){C=null;break}if(b=C.sibling,b!==null){b.return=C.return,C=b;break}C=C.return}b=C}to(e,n,g.children,o),n=n.child}return n;case 9:return g=n.type,u=n.pendingProps.children,Rp(n,o),g=pa(g),u=u(g),n.flags|=1,to(e,n,u,o),n.child;case 14:return u=n.type,g=Va(u,n.pendingProps),g=Va(u.type,g),DR(e,n,u,g,o);case 15:return vL(e,n,n.type,n.pendingProps,o);case 17:return u=n.type,g=n.pendingProps,g=n.elementType===u?g:Va(u,g),wx(e,n),n.tag=1,Eo(u)?(e=!0,Vx(n)):e=!1,Rp(n,o),gL(n,u,g),eT(n,u,g,o),nT(null,n,u,!0,e,o);case 19:return TL(e,n,o);case 22:return xL(e,n,o)}throw Error(Yt(156,n.tag))};function BL(e,n){return fD(e,n)}function e8(e,n,o,u){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function da(e,n,o,u){return new e8(e,n,o,u)}function WE(e){return e=e.prototype,!(!e||!e.isReactComponent)}function t8(e){if(typeof e=="function")return WE(e)?1:0;if(e!=null){if(e=e.$$typeof,e===hE)return 11;if(e===fE)return 14}return 2}function Hu(e,n){var o=e.alternate;return o===null?(o=da(e.tag,n,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=n,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,n=e.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function Ex(e,n,o,u,g,b){var C=2;if(u=e,typeof e=="function")WE(e)&&(C=1);else if(typeof e=="string")C=5;else e:switch(e){case dp:return bh(o.children,g,b,n);case dE:C=8,g|=8;break;case TS:return e=da(12,o,n,g|2),e.elementType=TS,e.lanes=b,e;case ES:return e=da(13,o,n,g),e.elementType=ES,e.lanes=b,e;case CS:return e=da(19,o,n,g),e.elementType=CS,e.lanes=b,e;case K3:return D1(o,g,b,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Z3:C=10;break e;case X3:C=9;break e;case hE:C=11;break e;case fE:C=14;break e;case Tu:C=16,u=null;break e}throw Error(Yt(130,e==null?e:typeof e,""))}return n=da(C,o,n,g),n.elementType=e,n.type=u,n.lanes=b,n}function bh(e,n,o,u){return e=da(7,e,u,n),e.lanes=o,e}function D1(e,n,o,u){return e=da(22,e,u,n),e.elementType=K3,e.lanes=o,e.stateNode={isHidden:!1},e}function Z2(e,n,o){return e=da(6,e,null,n),e.lanes=o,e}function X2(e,n,o){return n=da(4,e.children!==null?e.children:[],e.key,n),n.lanes=o,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function r8(e,n,o,u,g){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=I2(0),this.expirationTimes=I2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=I2(0),this.identifierPrefix=u,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function ZE(e,n,o,u,g,b,C,i,L){return e=new r8(e,n,o,i,L),n===1?(n=1,b===!0&&(n|=8)):n=0,b=da(3,null,null,n),e.current=b,b.stateNode=e,b.memoizedState={element:u,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},RE(b),e}function n8(e,n,o){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:up,key:u==null?null:""+u,children:e,containerInfo:n,implementation:o}}function UL(e){if(!e)return Xu;e=e._reactInternals;e:{if(Lh(e)!==e||e.tag!==1)throw Error(Yt(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Eo(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Yt(171))}if(e.tag===1){var o=e.type;if(Eo(o))return UD(e,o,n)}return n}function VL(e,n,o,u,g,b,C,i,L){return e=ZE(o,u,!0,e,g,b,C,i,L),e.context=UL(null),o=e.current,u=no(),g=qu(o),b=uc(u,g),b.callback=n??null,$u(o,b,g),e.current.lanes=g,Iy(e,g,u),Co(e,u),e}function L1(e,n,o,u){var g=n.current,b=no(),C=qu(g);return o=UL(o),n.context===null?n.context=o:n.pendingContext=o,n=uc(b,C),n.payload={element:e},u=u===void 0?null:u,u!==null&&(n.callback=u),e=$u(g,n,C),e!==null&&(Xa(e,g,C,b),vx(e,g,C)),C}function t1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function qR(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<n?o:n}}function XE(e,n){qR(e,n),(e=e.alternate)&&qR(e,n)}function i8(){return null}var $L=typeof reportError=="function"?reportError:function(e){console.error(e)};function KE(e){this._internalRoot=e}N1.prototype.render=KE.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(Yt(409));L1(e,n,null,null)};N1.prototype.unmount=KE.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Ch(function(){L1(null,e,null,null)}),n[fc]=null}};function N1(e){this._internalRoot=e}N1.prototype.unstable_scheduleHydration=function(e){if(e){var n=xD();e={blockedOn:null,target:e,priority:n};for(var o=0;o<Au.length&&n!==0&&n<Au[o].priority;o++);Au.splice(o,0,e),o===0&&wD(e)}};function YE(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function O1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function HR(){}function s8(e,n,o,u,g){if(g){if(typeof u=="function"){var b=u;u=function(){var O=t1(C);b.call(O)}}var C=VL(n,u,e,0,null,!1,!1,"",HR);return e._reactRootContainer=C,e[fc]=C.current,ny(e.nodeType===8?e.parentNode:e),Ch(),C}for(;g=e.lastChild;)e.removeChild(g);if(typeof u=="function"){var i=u;u=function(){var O=t1(L);i.call(O)}}var L=ZE(e,0,!1,null,null,!1,!1,"",HR);return e._reactRootContainer=L,e[fc]=L.current,ny(e.nodeType===8?e.parentNode:e),Ch(function(){L1(n,L,o,u)}),L}function z1(e,n,o,u,g){var b=o._reactRootContainer;if(b){var C=b;if(typeof g=="function"){var i=g;g=function(){var L=t1(C);i.call(L)}}L1(n,C,e,g)}else C=s8(o,n,e,g,u);return t1(C)}yD=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var o=C_(n.pendingLanes);o!==0&&(gE(n,o|1),Co(n,Vi()),!(On&6)&&(Jp=Vi()+500,id()))}break;case 13:Ch(function(){var u=pc(e,1);if(u!==null){var g=no();Xa(u,e,1,g)}}),XE(e,1)}};_E=function(e){if(e.tag===13){var n=pc(e,134217728);if(n!==null){var o=no();Xa(n,e,134217728,o)}XE(e,134217728)}};vD=function(e){if(e.tag===13){var n=qu(e),o=pc(e,n);if(o!==null){var u=no();Xa(o,e,n,u)}XE(e,n)}};xD=function(){return Wn};bD=function(e,n){var o=Wn;try{return Wn=e,n()}finally{Wn=o}};OS=function(e,n,o){switch(n){case"input":if(IS(e,o),n=o.name,o.type==="radio"&&n!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var u=o[n];if(u!==e&&u.form===e.form){var g=A1(u);if(!g)throw Error(Yt(90));J3(u),IS(u,g)}}}break;case"textarea":eD(e,o);break;case"select":n=o.value,n!=null&&Ap(e,!!o.multiple,n,!1)}};aD=GE;lD=Ch;var o8={usingClientEntryPoint:!1,Events:[Ry,mp,A1,sD,oD,GE]},x_={findFiberByHostInstance:ch,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},a8={bundleType:x_.bundleType,version:x_.version,rendererPackageName:x_.rendererPackageName,rendererConfig:x_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yc.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=dD(e),e===null?null:e.stateNode},findFiberByHostInstance:x_.findFiberByHostInstance||i8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Y0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Y0.isDisabled&&Y0.supportsFiber)try{S1=Y0.inject(a8),Rl=Y0}catch{}}Ko.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o8;Ko.createPortal=function(e,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!YE(n))throw Error(Yt(200));return n8(e,n,null,o)};Ko.createRoot=function(e,n){if(!YE(e))throw Error(Yt(299));var o=!1,u="",g=$L;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(g=n.onRecoverableError)),n=ZE(e,1,!1,null,null,o,!1,u,g),e[fc]=n.current,ny(e.nodeType===8?e.parentNode:e),new KE(n)};Ko.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(Yt(188)):(e=Object.keys(e).join(","),Error(Yt(268,e)));return e=dD(n),e=e===null?null:e.stateNode,e};Ko.flushSync=function(e){return Ch(e)};Ko.hydrate=function(e,n,o){if(!O1(n))throw Error(Yt(200));return z1(null,e,n,!0,o)};Ko.hydrateRoot=function(e,n,o){if(!YE(e))throw Error(Yt(405));var u=o!=null&&o.hydratedSources||null,g=!1,b="",C=$L;if(o!=null&&(o.unstable_strictMode===!0&&(g=!0),o.identifierPrefix!==void 0&&(b=o.identifierPrefix),o.onRecoverableError!==void 0&&(C=o.onRecoverableError)),n=VL(n,null,e,1,o??null,g,!1,b,C),e[fc]=n.current,ny(e),u)for(e=0;e<u.length;e++)o=u[e],g=o._getVersion,g=g(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,g]:n.mutableSourceEagerHydrationData.push(o,g);return new N1(n)};Ko.render=function(e,n,o){if(!O1(n))throw Error(Yt(200));return z1(null,e,n,!1,o)};Ko.unmountComponentAtNode=function(e){if(!O1(e))throw Error(Yt(40));return e._reactRootContainer?(Ch(function(){z1(null,null,e,!1,function(){e._reactRootContainer=null,e[fc]=null})}),!0):!1};Ko.unstable_batchedUpdates=GE;Ko.unstable_renderSubtreeIntoContainer=function(e,n,o,u){if(!O1(o))throw Error(Yt(200));if(e==null||e._reactInternals===void 0)throw Error(Yt(38));return z1(e,n,o,!1,u)};Ko.version="18.3.1-next-f1338f8080-20240426";function GL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(GL)}catch(e){console.error(e)}}GL(),G3.exports=Ko;var Nh=G3.exports;const qL=nE(Nh);var HL,WR=Nh;HL=WR.createRoot,WR.hydrateRoot;const l8=1,c8=1e6;let K2=0;function u8(){return K2=(K2+1)%Number.MAX_SAFE_INTEGER,K2.toString()}const Y2=new Map,ZR=e=>{if(Y2.has(e))return;const n=setTimeout(()=>{Y2.delete(e),G_({type:"REMOVE_TOAST",toastId:e})},c8);Y2.set(e,n)},d8=(e,n)=>{switch(n.type){case"ADD_TOAST":return{...e,toasts:[n.toast,...e.toasts].slice(0,l8)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(o=>o.id===n.toast.id?{...o,...n.toast}:o)};case"DISMISS_TOAST":{const{toastId:o}=n;return o?ZR(o):e.toasts.forEach(u=>{ZR(u.id)}),{...e,toasts:e.toasts.map(u=>u.id===o||o===void 0?{...u,open:!1}:u)}}case"REMOVE_TOAST":return n.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(o=>o.id!==n.toastId)}}},Cx=[];let Ax={toasts:[]};function G_(e){Ax=d8(Ax,e),Cx.forEach(n=>{n(Ax)})}function ar({...e}){const n=u8(),o=g=>G_({type:"UPDATE_TOAST",toast:{...g,id:n}}),u=()=>G_({type:"DISMISS_TOAST",toastId:n});return G_({type:"ADD_TOAST",toast:{...e,id:n,open:!0,onOpenChange:g=>{g||u()}}}),{id:n,dismiss:u,update:o}}function j1(){const[e,n]=Z.useState(Ax);return Z.useEffect(()=>(Cx.push(n),()=>{const o=Cx.indexOf(n);o>-1&&Cx.splice(o,1)}),[e]),{...e,toast:ar,dismiss:o=>G_({type:"DISMISS_TOAST",toastId:o})}}function dr(e,n,{checkForDefaultPrevented:o=!0}={}){return function(g){if(e==null||e(g),o===!1||!g.defaultPrevented)return n==null?void 0:n(g)}}function h8(e,n){typeof e=="function"?e(n):e!=null&&(e.current=n)}function F1(...e){return n=>e.forEach(o=>h8(o,n))}function Ln(...e){return Z.useCallback(F1(...e),e)}function f8(e,n=[]){let o=[];function u(b,C){const i=Z.createContext(C),L=o.length;o=[...o,C];function O(q){const{scope:G,children:ie,...J}=q,K=(G==null?void 0:G[e][L])||i,re=Z.useMemo(()=>J,Object.values(J));return w.jsx(K.Provider,{value:re,children:ie})}function U(q,G){const ie=(G==null?void 0:G[e][L])||i,J=Z.useContext(ie);if(J)return J;if(C!==void 0)return C;throw new Error(`\`${q}\` must be used within \`${b}\``)}return O.displayName=b+"Provider",[O,U]}const g=()=>{const b=o.map(C=>Z.createContext(C));return function(i){const L=(i==null?void 0:i[e])||b;return Z.useMemo(()=>({[`__scope${e}`]:{...i,[e]:L}}),[i,L])}};return g.scopeName=e,[u,p8(g,...n)]}function p8(...e){const n=e[0];if(e.length===1)return n;const o=()=>{const u=e.map(g=>({useScope:g(),scopeName:g.scopeName}));return function(b){const C=u.reduce((i,{useScope:L,scopeName:O})=>{const q=L(b)[`__scope${O}`];return{...i,...q}},{});return Z.useMemo(()=>({[`__scope${n.scopeName}`]:C}),[C])}};return o.scopeName=n.scopeName,o}var Ku=Z.forwardRef((e,n)=>{const{children:o,...u}=e,g=Z.Children.toArray(o),b=g.find(m8);if(b){const C=b.props.children,i=g.map(L=>L===b?Z.Children.count(C)>1?Z.Children.only(null):Z.isValidElement(C)?C.props.children:null:L);return w.jsx(mT,{...u,ref:n,children:Z.isValidElement(C)?Z.cloneElement(C,void 0,i):null})}return w.jsx(mT,{...u,ref:n,children:o})});Ku.displayName="Slot";var mT=Z.forwardRef((e,n)=>{const{children:o,...u}=e;if(Z.isValidElement(o)){const g=_8(o);return Z.cloneElement(o,{...g8(u,o.props),ref:n?F1(n,g):g})}return Z.Children.count(o)>1?Z.Children.only(null):null});mT.displayName="SlotClone";var WL=({children:e})=>w.jsx(w.Fragment,{children:e});function m8(e){return Z.isValidElement(e)&&e.type===WL}function g8(e,n){const o={...n};for(const u in n){const g=e[u],b=n[u];/^on[A-Z]/.test(u)?g&&b?o[u]=(...i)=>{b(...i),g(...i)}:g&&(o[u]=g):u==="style"?o[u]={...g,...b}:u==="className"&&(o[u]=[g,b].filter(Boolean).join(" "))}return{...e,...o}}function _8(e){var u,g;let n=(u=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:u.get,o=n&&"isReactWarning"in n&&n.isReactWarning;return o?e.ref:(n=(g=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:g.get,o=n&&"isReactWarning"in n&&n.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}function B1(e){const n=e+"CollectionProvider",[o,u]=f8(n),[g,b]=o(n,{collectionRef:{current:null},itemMap:new Map}),C=ie=>{const{scope:J,children:K}=ie,re=tr.useRef(null),Q=tr.useRef(new Map).current;return w.jsx(g,{scope:J,itemMap:Q,collectionRef:re,children:K})};C.displayName=n;const i=e+"CollectionSlot",L=tr.forwardRef((ie,J)=>{const{scope:K,children:re}=ie,Q=b(i,K),ee=Ln(J,Q.collectionRef);return w.jsx(Ku,{ref:ee,children:re})});L.displayName=i;const O=e+"CollectionItemSlot",U="data-radix-collection-item",q=tr.forwardRef((ie,J)=>{const{scope:K,children:re,...Q}=ie,ee=tr.useRef(null),ue=Ln(J,ee),fe=b(O,K);return tr.useEffect(()=>(fe.itemMap.set(ee,{ref:ee,...Q}),()=>void fe.itemMap.delete(ee))),w.jsx(Ku,{[U]:"",ref:ue,children:re})});q.displayName=O;function G(ie){const J=b(e+"CollectionConsumer",ie);return tr.useCallback(()=>{const re=J.collectionRef.current;if(!re)return[];const Q=Array.from(re.querySelectorAll(`[${U}]`));return Array.from(J.itemMap.values()).sort((fe,ge)=>Q.indexOf(fe.ref.current)-Q.indexOf(ge.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:C,Slot:L,ItemSlot:q},G,u]}function y8(e,n){const o=Z.createContext(n),u=b=>{const{children:C,...i}=b,L=Z.useMemo(()=>i,Object.values(i));return w.jsx(o.Provider,{value:L,children:C})};u.displayName=e+"Provider";function g(b){const C=Z.useContext(o);if(C)return C;if(n!==void 0)return n;throw new Error(`\`${b}\` must be used within \`${e}\``)}return[u,g]}function Jo(e,n=[]){let o=[];function u(b,C){const i=Z.createContext(C),L=o.length;o=[...o,C];const O=q=>{var Q;const{scope:G,children:ie,...J}=q,K=((Q=G==null?void 0:G[e])==null?void 0:Q[L])||i,re=Z.useMemo(()=>J,Object.values(J));return w.jsx(K.Provider,{value:re,children:ie})};O.displayName=b+"Provider";function U(q,G){var K;const ie=((K=G==null?void 0:G[e])==null?void 0:K[L])||i,J=Z.useContext(ie);if(J)return J;if(C!==void 0)return C;throw new Error(`\`${q}\` must be used within \`${b}\``)}return[O,U]}const g=()=>{const b=o.map(C=>Z.createContext(C));return function(i){const L=(i==null?void 0:i[e])||b;return Z.useMemo(()=>({[`__scope${e}`]:{...i,[e]:L}}),[i,L])}};return g.scopeName=e,[u,v8(g,...n)]}function v8(...e){const n=e[0];if(e.length===1)return n;const o=()=>{const u=e.map(g=>({useScope:g(),scopeName:g.scopeName}));return function(b){const C=u.reduce((i,{useScope:L,scopeName:O})=>{const q=L(b)[`__scope${O}`];return{...i,...q}},{});return Z.useMemo(()=>({[`__scope${n.scopeName}`]:C}),[C])}};return o.scopeName=n.scopeName,o}var x8=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],qr=x8.reduce((e,n)=>{const o=Z.forwardRef((u,g)=>{const{asChild:b,...C}=u,i=b?Ku:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(i,{...C,ref:g})});return o.displayName=`Primitive.${n}`,{...e,[n]:o}},{});function JE(e,n){e&&Nh.flushSync(()=>e.dispatchEvent(n))}function _s(e){const n=Z.useRef(e);return Z.useEffect(()=>{n.current=e}),Z.useMemo(()=>(...o)=>{var u;return(u=n.current)==null?void 0:u.call(n,...o)},[])}function b8(e,n=globalThis==null?void 0:globalThis.document){const o=_s(e);Z.useEffect(()=>{const u=g=>{g.key==="Escape"&&o(g)};return n.addEventListener("keydown",u,{capture:!0}),()=>n.removeEventListener("keydown",u,{capture:!0})},[o,n])}var w8="DismissableLayer",gT="dismissableLayer.update",S8="dismissableLayer.pointerDownOutside",T8="dismissableLayer.focusOutside",XR,ZL=Z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),sm=Z.forwardRef((e,n)=>{const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:u,onPointerDownOutside:g,onFocusOutside:b,onInteractOutside:C,onDismiss:i,...L}=e,O=Z.useContext(ZL),[U,q]=Z.useState(null),G=(U==null?void 0:U.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=Z.useState({}),J=Ln(n,Ce=>q(Ce)),K=Array.from(O.layers),[re]=[...O.layersWithOutsidePointerEventsDisabled].slice(-1),Q=K.indexOf(re),ee=U?K.indexOf(U):-1,ue=O.layersWithOutsidePointerEventsDisabled.size>0,fe=ee>=Q,ge=C8(Ce=>{const Be=Ce.target,dt=[...O.branches].some(Qe=>Qe.contains(Be));!fe||dt||(g==null||g(Ce),C==null||C(Ce),Ce.defaultPrevented||i==null||i())},G),ke=A8(Ce=>{const Be=Ce.target;[...O.branches].some(Qe=>Qe.contains(Be))||(b==null||b(Ce),C==null||C(Ce),Ce.defaultPrevented||i==null||i())},G);return b8(Ce=>{ee===O.layers.size-1&&(u==null||u(Ce),!Ce.defaultPrevented&&i&&(Ce.preventDefault(),i()))},G),Z.useEffect(()=>{if(U)return o&&(O.layersWithOutsidePointerEventsDisabled.size===0&&(XR=G.body.style.pointerEvents,G.body.style.pointerEvents="none"),O.layersWithOutsidePointerEventsDisabled.add(U)),O.layers.add(U),KR(),()=>{o&&O.layersWithOutsidePointerEventsDisabled.size===1&&(G.body.style.pointerEvents=XR)}},[U,G,o,O]),Z.useEffect(()=>()=>{U&&(O.layers.delete(U),O.layersWithOutsidePointerEventsDisabled.delete(U),KR())},[U,O]),Z.useEffect(()=>{const Ce=()=>ie({});return document.addEventListener(gT,Ce),()=>document.removeEventListener(gT,Ce)},[]),w.jsx(qr.div,{...L,ref:J,style:{pointerEvents:ue?fe?"auto":"none":void 0,...e.style},onFocusCapture:dr(e.onFocusCapture,ke.onFocusCapture),onBlurCapture:dr(e.onBlurCapture,ke.onBlurCapture),onPointerDownCapture:dr(e.onPointerDownCapture,ge.onPointerDownCapture)})});sm.displayName=w8;var E8="DismissableLayerBranch",XL=Z.forwardRef((e,n)=>{const o=Z.useContext(ZL),u=Z.useRef(null),g=Ln(n,u);return Z.useEffect(()=>{const b=u.current;if(b)return o.branches.add(b),()=>{o.branches.delete(b)}},[o.branches]),w.jsx(qr.div,{...e,ref:g})});XL.displayName=E8;function C8(e,n=globalThis==null?void 0:globalThis.document){const o=_s(e),u=Z.useRef(!1),g=Z.useRef(()=>{});return Z.useEffect(()=>{const b=i=>{if(i.target&&!u.current){let L=function(){KL(S8,o,O,{discrete:!0})};const O={originalEvent:i};i.pointerType==="touch"?(n.removeEventListener("click",g.current),g.current=L,n.addEventListener("click",g.current,{once:!0})):L()}else n.removeEventListener("click",g.current);u.current=!1},C=window.setTimeout(()=>{n.addEventListener("pointerdown",b)},0);return()=>{window.clearTimeout(C),n.removeEventListener("pointerdown",b),n.removeEventListener("click",g.current)}},[n,o]),{onPointerDownCapture:()=>u.current=!0}}function A8(e,n=globalThis==null?void 0:globalThis.document){const o=_s(e),u=Z.useRef(!1);return Z.useEffect(()=>{const g=b=>{b.target&&!u.current&&KL(T8,o,{originalEvent:b},{discrete:!1})};return n.addEventListener("focusin",g),()=>n.removeEventListener("focusin",g)},[n,o]),{onFocusCapture:()=>u.current=!0,onBlurCapture:()=>u.current=!1}}function KR(){const e=new CustomEvent(gT);document.dispatchEvent(e)}function KL(e,n,o,{discrete:u}){const g=o.originalEvent.target,b=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:o});n&&g.addEventListener(e,n,{once:!0}),u?JE(g,b):g.dispatchEvent(b)}var M8=sm,I8=XL,Ki=globalThis!=null&&globalThis.document?Z.useLayoutEffect:()=>{},P8="Portal",Dy=Z.forwardRef((e,n)=>{var i;const{container:o,...u}=e,[g,b]=Z.useState(!1);Ki(()=>b(!0),[]);const C=o||g&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return C?qL.createPortal(w.jsx(qr.div,{...u,ref:n}),C):null});Dy.displayName=P8;function R8(e,n){return Z.useReducer((o,u)=>n[o][u]??o,e)}var rl=e=>{const{present:n,children:o}=e,u=k8(n),g=typeof o=="function"?o({present:u.isPresent}):Z.Children.only(o),b=Ln(u.ref,D8(g));return typeof o=="function"||u.isPresent?Z.cloneElement(g,{ref:b}):null};rl.displayName="Presence";function k8(e){const[n,o]=Z.useState(),u=Z.useRef({}),g=Z.useRef(e),b=Z.useRef("none"),C=e?"mounted":"unmounted",[i,L]=R8(C,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const O=J0(u.current);b.current=i==="mounted"?O:"none"},[i]),Ki(()=>{const O=u.current,U=g.current;if(U!==e){const G=b.current,ie=J0(O);e?L("MOUNT"):ie==="none"||(O==null?void 0:O.display)==="none"?L("UNMOUNT"):L(U&&G!==ie?"ANIMATION_OUT":"UNMOUNT"),g.current=e}},[e,L]),Ki(()=>{if(n){let O;const U=n.ownerDocument.defaultView??window,q=ie=>{const K=J0(u.current).includes(ie.animationName);if(ie.target===n&&K&&(L("ANIMATION_END"),!g.current)){const re=n.style.animationFillMode;n.style.animationFillMode="forwards",O=U.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=re)})}},G=ie=>{ie.target===n&&(b.current=J0(u.current))};return n.addEventListener("animationstart",G),n.addEventListener("animationcancel",q),n.addEventListener("animationend",q),()=>{U.clearTimeout(O),n.removeEventListener("animationstart",G),n.removeEventListener("animationcancel",q),n.removeEventListener("animationend",q)}}else L("ANIMATION_END")},[n,L]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:Z.useCallback(O=>{O&&(u.current=getComputedStyle(O)),o(O)},[])}}function J0(e){return(e==null?void 0:e.animationName)||"none"}function D8(e){var u,g;let n=(u=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:u.get,o=n&&"isReactWarning"in n&&n.isReactWarning;return o?e.ref:(n=(g=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:g.get,o=n&&"isReactWarning"in n&&n.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}function Dl({prop:e,defaultProp:n,onChange:o=()=>{}}){const[u,g]=L8({defaultProp:n,onChange:o}),b=e!==void 0,C=b?e:u,i=_s(o),L=Z.useCallback(O=>{if(b){const q=typeof O=="function"?O(e):O;q!==e&&i(q)}else g(O)},[b,e,g,i]);return[C,L]}function L8({defaultProp:e,onChange:n}){const o=Z.useState(e),[u]=o,g=Z.useRef(u),b=_s(n);return Z.useEffect(()=>{g.current!==u&&(b(u),g.current=u)},[u,g,b]),o}var N8="VisuallyHidden",Ly=Z.forwardRef((e,n)=>w.jsx(qr.span,{...e,ref:n,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));Ly.displayName=N8;var O8=Ly,QE="ToastProvider",[eC,z8,j8]=B1("Toast"),[YL,vQ]=Jo("Toast",[j8]),[F8,U1]=YL(QE),JL=e=>{const{__scopeToast:n,label:o="Notification",duration:u=5e3,swipeDirection:g="right",swipeThreshold:b=50,children:C}=e,[i,L]=Z.useState(null),[O,U]=Z.useState(0),q=Z.useRef(!1),G=Z.useRef(!1);return o.trim()||console.error(`Invalid prop \`label\` supplied to \`${QE}\`. Expected non-empty \`string\`.`),w.jsx(eC.Provider,{scope:n,children:w.jsx(F8,{scope:n,label:o,duration:u,swipeDirection:g,swipeThreshold:b,toastCount:O,viewport:i,onViewportChange:L,onToastAdd:Z.useCallback(()=>U(ie=>ie+1),[]),onToastRemove:Z.useCallback(()=>U(ie=>ie-1),[]),isFocusedToastEscapeKeyDownRef:q,isClosePausedRef:G,children:C})})};JL.displayName=QE;var QL="ToastViewport",B8=["F8"],_T="toast.viewportPause",yT="toast.viewportResume",eN=Z.forwardRef((e,n)=>{const{__scopeToast:o,hotkey:u=B8,label:g="Notifications ({hotkey})",...b}=e,C=U1(QL,o),i=z8(o),L=Z.useRef(null),O=Z.useRef(null),U=Z.useRef(null),q=Z.useRef(null),G=Ln(n,q,C.onViewportChange),ie=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),J=C.toastCount>0;Z.useEffect(()=>{const re=Q=>{var ue;u.length!==0&&u.every(fe=>Q[fe]||Q.code===fe)&&((ue=q.current)==null||ue.focus())};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[u]),Z.useEffect(()=>{const re=L.current,Q=q.current;if(J&&re&&Q){const ee=()=>{if(!C.isClosePausedRef.current){const ke=new CustomEvent(_T);Q.dispatchEvent(ke),C.isClosePausedRef.current=!0}},ue=()=>{if(C.isClosePausedRef.current){const ke=new CustomEvent(yT);Q.dispatchEvent(ke),C.isClosePausedRef.current=!1}},fe=ke=>{!re.contains(ke.relatedTarget)&&ue()},ge=()=>{re.contains(document.activeElement)||ue()};return re.addEventListener("focusin",ee),re.addEventListener("focusout",fe),re.addEventListener("pointermove",ee),re.addEventListener("pointerleave",ge),window.addEventListener("blur",ee),window.addEventListener("focus",ue),()=>{re.removeEventListener("focusin",ee),re.removeEventListener("focusout",fe),re.removeEventListener("pointermove",ee),re.removeEventListener("pointerleave",ge),window.removeEventListener("blur",ee),window.removeEventListener("focus",ue)}}},[J,C.isClosePausedRef]);const K=Z.useCallback(({tabbingDirection:re})=>{const ee=i().map(ue=>{const fe=ue.ref.current,ge=[fe,...Q8(fe)];return re==="forwards"?ge:ge.reverse()});return(re==="forwards"?ee.reverse():ee).flat()},[i]);return Z.useEffect(()=>{const re=q.current;if(re){const Q=ee=>{var ge,ke,Ce;const ue=ee.altKey||ee.ctrlKey||ee.metaKey;if(ee.key==="Tab"&&!ue){const Be=document.activeElement,dt=ee.shiftKey;if(ee.target===re&&dt){(ge=O.current)==null||ge.focus();return}const He=K({tabbingDirection:dt?"backwards":"forwards"}),et=He.findIndex(mt=>mt===Be);J2(He.slice(et+1))?ee.preventDefault():dt?(ke=O.current)==null||ke.focus():(Ce=U.current)==null||Ce.focus()}};return re.addEventListener("keydown",Q),()=>re.removeEventListener("keydown",Q)}},[i,K]),w.jsxs(I8,{ref:L,role:"region","aria-label":g.replace("{hotkey}",ie),tabIndex:-1,style:{pointerEvents:J?void 0:"none"},children:[J&&w.jsx(vT,{ref:O,onFocusFromOutsideViewport:()=>{const re=K({tabbingDirection:"forwards"});J2(re)}}),w.jsx(eC.Slot,{scope:o,children:w.jsx(qr.ol,{tabIndex:-1,...b,ref:G})}),J&&w.jsx(vT,{ref:U,onFocusFromOutsideViewport:()=>{const re=K({tabbingDirection:"backwards"});J2(re)}})]})});eN.displayName=QL;var tN="ToastFocusProxy",vT=Z.forwardRef((e,n)=>{const{__scopeToast:o,onFocusFromOutsideViewport:u,...g}=e,b=U1(tN,o);return w.jsx(Ly,{"aria-hidden":!0,tabIndex:0,...g,ref:n,style:{position:"fixed"},onFocus:C=>{var O;const i=C.relatedTarget;!((O=b.viewport)!=null&&O.contains(i))&&u()}})});vT.displayName=tN;var V1="Toast",U8="toast.swipeStart",V8="toast.swipeMove",$8="toast.swipeCancel",G8="toast.swipeEnd",rN=Z.forwardRef((e,n)=>{const{forceMount:o,open:u,defaultOpen:g,onOpenChange:b,...C}=e,[i=!0,L]=Dl({prop:u,defaultProp:g,onChange:b});return w.jsx(rl,{present:o||i,children:w.jsx(W8,{open:i,...C,ref:n,onClose:()=>L(!1),onPause:_s(e.onPause),onResume:_s(e.onResume),onSwipeStart:dr(e.onSwipeStart,O=>{O.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:dr(e.onSwipeMove,O=>{const{x:U,y:q}=O.detail.delta;O.currentTarget.setAttribute("data-swipe","move"),O.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${U}px`),O.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${q}px`)}),onSwipeCancel:dr(e.onSwipeCancel,O=>{O.currentTarget.setAttribute("data-swipe","cancel"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),O.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:dr(e.onSwipeEnd,O=>{const{x:U,y:q}=O.detail.delta;O.currentTarget.setAttribute("data-swipe","end"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),O.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${U}px`),O.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${q}px`),L(!1)})})})});rN.displayName=V1;var[q8,H8]=YL(V1,{onClose(){}}),W8=Z.forwardRef((e,n)=>{const{__scopeToast:o,type:u="foreground",duration:g,open:b,onClose:C,onEscapeKeyDown:i,onPause:L,onResume:O,onSwipeStart:U,onSwipeMove:q,onSwipeCancel:G,onSwipeEnd:ie,...J}=e,K=U1(V1,o),[re,Q]=Z.useState(null),ee=Ln(n,mt=>Q(mt)),ue=Z.useRef(null),fe=Z.useRef(null),ge=g||K.duration,ke=Z.useRef(0),Ce=Z.useRef(ge),Be=Z.useRef(0),{onToastAdd:dt,onToastRemove:Qe}=K,qe=_s(()=>{var Ze;(re==null?void 0:re.contains(document.activeElement))&&((Ze=K.viewport)==null||Ze.focus()),C()}),He=Z.useCallback(mt=>{!mt||mt===1/0||(window.clearTimeout(Be.current),ke.current=new Date().getTime(),Be.current=window.setTimeout(qe,mt))},[qe]);Z.useEffect(()=>{const mt=K.viewport;if(mt){const Ze=()=>{He(Ce.current),O==null||O()},Tt=()=>{const Gt=new Date().getTime()-ke.current;Ce.current=Ce.current-Gt,window.clearTimeout(Be.current),L==null||L()};return mt.addEventListener(_T,Tt),mt.addEventListener(yT,Ze),()=>{mt.removeEventListener(_T,Tt),mt.removeEventListener(yT,Ze)}}},[K.viewport,ge,L,O,He]),Z.useEffect(()=>{b&&!K.isClosePausedRef.current&&He(ge)},[b,ge,K.isClosePausedRef,He]),Z.useEffect(()=>(dt(),()=>Qe()),[dt,Qe]);const et=Z.useMemo(()=>re?cN(re):null,[re]);return K.viewport?w.jsxs(w.Fragment,{children:[et&&w.jsx(Z8,{__scopeToast:o,role:"status","aria-live":u==="foreground"?"assertive":"polite","aria-atomic":!0,children:et}),w.jsx(q8,{scope:o,onClose:qe,children:Nh.createPortal(w.jsx(eC.ItemSlot,{scope:o,children:w.jsx(M8,{asChild:!0,onEscapeKeyDown:dr(i,()=>{K.isFocusedToastEscapeKeyDownRef.current||qe(),K.isFocusedToastEscapeKeyDownRef.current=!1}),children:w.jsx(qr.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":b?"open":"closed","data-swipe-direction":K.swipeDirection,...J,ref:ee,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:dr(e.onKeyDown,mt=>{mt.key==="Escape"&&(i==null||i(mt.nativeEvent),mt.nativeEvent.defaultPrevented||(K.isFocusedToastEscapeKeyDownRef.current=!0,qe()))}),onPointerDown:dr(e.onPointerDown,mt=>{mt.button===0&&(ue.current={x:mt.clientX,y:mt.clientY})}),onPointerMove:dr(e.onPointerMove,mt=>{if(!ue.current)return;const Ze=mt.clientX-ue.current.x,Tt=mt.clientY-ue.current.y,Gt=!!fe.current,ct=["left","right"].includes(K.swipeDirection),Je=["left","up"].includes(K.swipeDirection)?Math.min:Math.max,rt=ct?Je(0,Ze):0,bt=ct?0:Je(0,Tt),kt=mt.pointerType==="touch"?10:2,At={x:rt,y:bt},_r={originalEvent:mt,delta:At};Gt?(fe.current=At,Q0(V8,q,_r,{discrete:!1})):YR(At,K.swipeDirection,kt)?(fe.current=At,Q0(U8,U,_r,{discrete:!1}),mt.target.setPointerCapture(mt.pointerId)):(Math.abs(Ze)>kt||Math.abs(Tt)>kt)&&(ue.current=null)}),onPointerUp:dr(e.onPointerUp,mt=>{const Ze=fe.current,Tt=mt.target;if(Tt.hasPointerCapture(mt.pointerId)&&Tt.releasePointerCapture(mt.pointerId),fe.current=null,ue.current=null,Ze){const Gt=mt.currentTarget,ct={originalEvent:mt,delta:Ze};YR(Ze,K.swipeDirection,K.swipeThreshold)?Q0(G8,ie,ct,{discrete:!0}):Q0($8,G,ct,{discrete:!0}),Gt.addEventListener("click",Je=>Je.preventDefault(),{once:!0})}})})})}),K.viewport)})]}):null}),Z8=e=>{const{__scopeToast:n,children:o,...u}=e,g=U1(V1,n),[b,C]=Z.useState(!1),[i,L]=Z.useState(!1);return Y8(()=>C(!0)),Z.useEffect(()=>{const O=window.setTimeout(()=>L(!0),1e3);return()=>window.clearTimeout(O)},[]),i?null:w.jsx(Dy,{asChild:!0,children:w.jsx(Ly,{...u,children:b&&w.jsxs(w.Fragment,{children:[g.label," ",o]})})})},X8="ToastTitle",nN=Z.forwardRef((e,n)=>{const{__scopeToast:o,...u}=e;return w.jsx(qr.div,{...u,ref:n})});nN.displayName=X8;var K8="ToastDescription",iN=Z.forwardRef((e,n)=>{const{__scopeToast:o,...u}=e;return w.jsx(qr.div,{...u,ref:n})});iN.displayName=K8;var sN="ToastAction",oN=Z.forwardRef((e,n)=>{const{altText:o,...u}=e;return o.trim()?w.jsx(lN,{altText:o,asChild:!0,children:w.jsx(tC,{...u,ref:n})}):(console.error(`Invalid prop \`altText\` supplied to \`${sN}\`. Expected non-empty \`string\`.`),null)});oN.displayName=sN;var aN="ToastClose",tC=Z.forwardRef((e,n)=>{const{__scopeToast:o,...u}=e,g=H8(aN,o);return w.jsx(lN,{asChild:!0,children:w.jsx(qr.button,{type:"button",...u,ref:n,onClick:dr(e.onClick,g.onClose)})})});tC.displayName=aN;var lN=Z.forwardRef((e,n)=>{const{__scopeToast:o,altText:u,...g}=e;return w.jsx(qr.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":u||void 0,...g,ref:n})});function cN(e){const n=[];return Array.from(e.childNodes).forEach(u=>{if(u.nodeType===u.TEXT_NODE&&u.textContent&&n.push(u.textContent),J8(u)){const g=u.ariaHidden||u.hidden||u.style.display==="none",b=u.dataset.radixToastAnnounceExclude==="";if(!g)if(b){const C=u.dataset.radixToastAnnounceAlt;C&&n.push(C)}else n.push(...cN(u))}}),n}function Q0(e,n,o,{discrete:u}){const g=o.originalEvent.currentTarget,b=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:o});n&&g.addEventListener(e,n,{once:!0}),u?JE(g,b):g.dispatchEvent(b)}var YR=(e,n,o=0)=>{const u=Math.abs(e.x),g=Math.abs(e.y),b=u>g;return n==="left"||n==="right"?b&&u>o:!b&&g>o};function Y8(e=()=>{}){const n=_s(e);Ki(()=>{let o=0,u=0;return o=window.requestAnimationFrame(()=>u=window.requestAnimationFrame(n)),()=>{window.cancelAnimationFrame(o),window.cancelAnimationFrame(u)}},[n])}function J8(e){return e.nodeType===e.ELEMENT_NODE}function Q8(e){const n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:u=>{const g=u.tagName==="INPUT"&&u.type==="hidden";return u.disabled||u.hidden||g?NodeFilter.FILTER_SKIP:u.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n}function J2(e){const n=document.activeElement;return e.some(o=>o===n?!0:(o.focus(),document.activeElement!==n))}var e$=JL,uN=eN,dN=rN,hN=nN,fN=iN,pN=oN,mN=tC;function gN(e){var n,o,u="";if(typeof e=="string"||typeof e=="number")u+=e;else if(typeof e=="object")if(Array.isArray(e)){var g=e.length;for(n=0;n<g;n++)e[n]&&(o=gN(e[n]))&&(u&&(u+=" "),u+=o)}else for(o in e)e[o]&&(u&&(u+=" "),u+=o);return u}function _N(){for(var e,n,o=0,u="",g=arguments.length;o<g;o++)(e=arguments[o])&&(n=gN(e))&&(u&&(u+=" "),u+=n);return u}const JR=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,QR=_N,Ny=(e,n)=>o=>{var u;if((n==null?void 0:n.variants)==null)return QR(e,o==null?void 0:o.class,o==null?void 0:o.className);const{variants:g,defaultVariants:b}=n,C=Object.keys(g).map(O=>{const U=o==null?void 0:o[O],q=b==null?void 0:b[O];if(U===null)return null;const G=JR(U)||JR(q);return g[O][G]}),i=o&&Object.entries(o).reduce((O,U)=>{let[q,G]=U;return G===void 0||(O[q]=G),O},{}),L=n==null||(u=n.compoundVariants)===null||u===void 0?void 0:u.reduce((O,U)=>{let{class:q,className:G,...ie}=U;return Object.entries(ie).every(J=>{let[K,re]=J;return Array.isArray(re)?re.includes({...b,...i}[K]):{...b,...i}[K]===re})?[...O,q,G]:O},[]);return QR(e,C,L,o==null?void 0:o.class,o==null?void 0:o.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),yN=(...e)=>e.filter((n,o,u)=>!!n&&n.trim()!==""&&u.indexOf(n)===o).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var r$={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=Z.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:u,className:g="",children:b,iconNode:C,...i},L)=>Z.createElement("svg",{ref:L,...r$,width:n,height:n,stroke:e,strokeWidth:u?Number(o)*24/Number(n):o,className:yN("lucide",g),...i},[...C.map(([O,U])=>Z.createElement(O,U)),...Array.isArray(b)?b:[b]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=(e,n)=>{const o=Z.forwardRef(({className:u,...g},b)=>Z.createElement(n$,{ref:b,iconNode:n,className:yN(`lucide-${t$(e)}`,u),...g}));return o.displayName=`${e}`,o};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i$=Or("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s$=Or("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vN=Or("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=Or("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M_=Or("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rC=Or("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=Or("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a$=Or("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xN=Or("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l$=Or("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=Or("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c$=Or("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u$=Or("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d$=Or("CircleUserRound",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bN=Or("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=Or("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iC=Or("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=Or("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h$=Or("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f$=Or("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tk=Or("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=Or("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ex=Or("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p$=Or("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m$=Or("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g$=Or("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=Or("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q2=Or("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _$=Or("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=Or("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sC=Or("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y$=Or("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v$=Or("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wN=Or("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x$=Or("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=Or("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b$=Or("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=Or("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SN=Or("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w$=Or("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=Or("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S$=Or("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=Or("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mx=Or("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=Or("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=Or("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $1=Or("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=Or("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TN=Or("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EN=Or("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T$=Or("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E$=Or("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=Or("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=Or("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=Or("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C$=Or("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yu=Or("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),aC="-",A$=e=>{const n=I$(e),{conflictingClassGroups:o,conflictingClassGroupModifiers:u}=e;return{getClassGroupId:C=>{const i=C.split(aC);return i[0]===""&&i.length!==1&&i.shift(),CN(i,n)||M$(C)},getConflictingClassGroupIds:(C,i)=>{const L=o[C]||[];return i&&u[C]?[...L,...u[C]]:L}}},CN=(e,n)=>{var C;if(e.length===0)return n.classGroupId;const o=e[0],u=n.nextPart.get(o),g=u?CN(e.slice(1),u):void 0;if(g)return g;if(n.validators.length===0)return;const b=e.join(aC);return(C=n.validators.find(({validator:i})=>i(b)))==null?void 0:C.classGroupId},ik=/^\[(.+)\]$/,M$=e=>{if(ik.test(e)){const n=ik.exec(e)[1],o=n==null?void 0:n.substring(0,n.indexOf(":"));if(o)return"arbitrary.."+o}},I$=e=>{const{theme:n,prefix:o}=e,u={nextPart:new Map,validators:[]};return R$(Object.entries(e.classGroups),o).forEach(([b,C])=>{CT(C,u,b,n)}),u},CT=(e,n,o,u)=>{e.forEach(g=>{if(typeof g=="string"){const b=g===""?n:sk(n,g);b.classGroupId=o;return}if(typeof g=="function"){if(P$(g)){CT(g(u),n,o,u);return}n.validators.push({validator:g,classGroupId:o});return}Object.entries(g).forEach(([b,C])=>{CT(C,sk(n,b),o,u)})})},sk=(e,n)=>{let o=e;return n.split(aC).forEach(u=>{o.nextPart.has(u)||o.nextPart.set(u,{nextPart:new Map,validators:[]}),o=o.nextPart.get(u)}),o},P$=e=>e.isThemeGetter,R$=(e,n)=>n?e.map(([o,u])=>{const g=u.map(b=>typeof b=="string"?n+b:typeof b=="object"?Object.fromEntries(Object.entries(b).map(([C,i])=>[n+C,i])):b);return[o,g]}):e,k$=e=>{if(e<1)return{get:()=>{},set:()=>{}};let n=0,o=new Map,u=new Map;const g=(b,C)=>{o.set(b,C),n++,n>e&&(n=0,u=o,o=new Map)};return{get(b){let C=o.get(b);if(C!==void 0)return C;if((C=u.get(b))!==void 0)return g(b,C),C},set(b,C){o.has(b)?o.set(b,C):g(b,C)}}},AN="!",D$=e=>{const{separator:n,experimentalParseClassName:o}=e,u=n.length===1,g=n[0],b=n.length,C=i=>{const L=[];let O=0,U=0,q;for(let re=0;re<i.length;re++){let Q=i[re];if(O===0){if(Q===g&&(u||i.slice(re,re+b)===n)){L.push(i.slice(U,re)),U=re+b;continue}if(Q==="/"){q=re;continue}}Q==="["?O++:Q==="]"&&O--}const G=L.length===0?i:i.substring(U),ie=G.startsWith(AN),J=ie?G.substring(1):G,K=q&&q>U?q-U:void 0;return{modifiers:L,hasImportantModifier:ie,baseClassName:J,maybePostfixModifierPosition:K}};return o?i=>o({className:i,parseClassName:C}):C},L$=e=>{if(e.length<=1)return e;const n=[];let o=[];return e.forEach(u=>{u[0]==="["?(n.push(...o.sort(),u),o=[]):o.push(u)}),n.push(...o.sort()),n},N$=e=>({cache:k$(e.cacheSize),parseClassName:D$(e),...A$(e)}),O$=/\s+/,z$=(e,n)=>{const{parseClassName:o,getClassGroupId:u,getConflictingClassGroupIds:g}=n,b=[],C=e.trim().split(O$);let i="";for(let L=C.length-1;L>=0;L-=1){const O=C[L],{modifiers:U,hasImportantModifier:q,baseClassName:G,maybePostfixModifierPosition:ie}=o(O);let J=!!ie,K=u(J?G.substring(0,ie):G);if(!K){if(!J){i=O+(i.length>0?" "+i:i);continue}if(K=u(G),!K){i=O+(i.length>0?" "+i:i);continue}J=!1}const re=L$(U).join(":"),Q=q?re+AN:re,ee=Q+K;if(b.includes(ee))continue;b.push(ee);const ue=g(K,J);for(let fe=0;fe<ue.length;++fe){const ge=ue[fe];b.push(Q+ge)}i=O+(i.length>0?" "+i:i)}return i};function j$(){let e=0,n,o,u="";for(;e<arguments.length;)(n=arguments[e++])&&(o=MN(n))&&(u&&(u+=" "),u+=o);return u}const MN=e=>{if(typeof e=="string")return e;let n,o="";for(let u=0;u<e.length;u++)e[u]&&(n=MN(e[u]))&&(o&&(o+=" "),o+=n);return o};function F$(e,...n){let o,u,g,b=C;function C(L){const O=n.reduce((U,q)=>q(U),e());return o=N$(O),u=o.cache.get,g=o.cache.set,b=i,i(L)}function i(L){const O=u(L);if(O)return O;const U=z$(L,o);return g(L,U),U}return function(){return b(j$.apply(null,arguments))}}const ai=e=>{const n=o=>o[e]||[];return n.isThemeGetter=!0,n},IN=/^\[(?:([a-z-]+):)?(.+)\]$/i,B$=/^\d+\/\d+$/,U$=new Set(["px","full","screen"]),V$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,$$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,G$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,q$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,H$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,tc=e=>Dp(e)||U$.has(e)||B$.test(e),yu=e=>om(e,"length",eG),Dp=e=>!!e&&!Number.isNaN(Number(e)),rS=e=>om(e,"number",Dp),b_=e=>!!e&&Number.isInteger(Number(e)),W$=e=>e.endsWith("%")&&Dp(e.slice(0,-1)),hn=e=>IN.test(e),vu=e=>V$.test(e),Z$=new Set(["length","size","percentage"]),X$=e=>om(e,Z$,PN),K$=e=>om(e,"position",PN),Y$=new Set(["image","url"]),J$=e=>om(e,Y$,rG),Q$=e=>om(e,"",tG),w_=()=>!0,om=(e,n,o)=>{const u=IN.exec(e);return u?u[1]?typeof n=="string"?u[1]===n:n.has(u[1]):o(u[2]):!1},eG=e=>$$.test(e)&&!G$.test(e),PN=()=>!1,tG=e=>q$.test(e),rG=e=>H$.test(e),nG=()=>{const e=ai("colors"),n=ai("spacing"),o=ai("blur"),u=ai("brightness"),g=ai("borderColor"),b=ai("borderRadius"),C=ai("borderSpacing"),i=ai("borderWidth"),L=ai("contrast"),O=ai("grayscale"),U=ai("hueRotate"),q=ai("invert"),G=ai("gap"),ie=ai("gradientColorStops"),J=ai("gradientColorStopPositions"),K=ai("inset"),re=ai("margin"),Q=ai("opacity"),ee=ai("padding"),ue=ai("saturate"),fe=ai("scale"),ge=ai("sepia"),ke=ai("skew"),Ce=ai("space"),Be=ai("translate"),dt=()=>["auto","contain","none"],Qe=()=>["auto","hidden","clip","visible","scroll"],qe=()=>["auto",hn,n],He=()=>[hn,n],et=()=>["",tc,yu],mt=()=>["auto",Dp,hn],Ze=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Tt=()=>["solid","dashed","dotted","double","none"],Gt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ct=()=>["start","end","center","between","around","evenly","stretch"],Je=()=>["","0",hn],rt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],bt=()=>[Dp,hn];return{cacheSize:500,separator:":",theme:{colors:[w_],spacing:[tc,yu],blur:["none","",vu,hn],brightness:bt(),borderColor:[e],borderRadius:["none","","full",vu,hn],borderSpacing:He(),borderWidth:et(),contrast:bt(),grayscale:Je(),hueRotate:bt(),invert:Je(),gap:He(),gradientColorStops:[e],gradientColorStopPositions:[W$,yu],inset:qe(),margin:qe(),opacity:bt(),padding:He(),saturate:bt(),scale:bt(),sepia:Je(),skew:bt(),space:He(),translate:He()},classGroups:{aspect:[{aspect:["auto","square","video",hn]}],container:["container"],columns:[{columns:[vu]}],"break-after":[{"break-after":rt()}],"break-before":[{"break-before":rt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ze(),hn]}],overflow:[{overflow:Qe()}],"overflow-x":[{"overflow-x":Qe()}],"overflow-y":[{"overflow-y":Qe()}],overscroll:[{overscroll:dt()}],"overscroll-x":[{"overscroll-x":dt()}],"overscroll-y":[{"overscroll-y":dt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[K]}],"inset-x":[{"inset-x":[K]}],"inset-y":[{"inset-y":[K]}],start:[{start:[K]}],end:[{end:[K]}],top:[{top:[K]}],right:[{right:[K]}],bottom:[{bottom:[K]}],left:[{left:[K]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",b_,hn]}],basis:[{basis:qe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",hn]}],grow:[{grow:Je()}],shrink:[{shrink:Je()}],order:[{order:["first","last","none",b_,hn]}],"grid-cols":[{"grid-cols":[w_]}],"col-start-end":[{col:["auto",{span:["full",b_,hn]},hn]}],"col-start":[{"col-start":mt()}],"col-end":[{"col-end":mt()}],"grid-rows":[{"grid-rows":[w_]}],"row-start-end":[{row:["auto",{span:[b_,hn]},hn]}],"row-start":[{"row-start":mt()}],"row-end":[{"row-end":mt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",hn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",hn]}],gap:[{gap:[G]}],"gap-x":[{"gap-x":[G]}],"gap-y":[{"gap-y":[G]}],"justify-content":[{justify:["normal",...ct()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ct(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ct(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ee]}],px:[{px:[ee]}],py:[{py:[ee]}],ps:[{ps:[ee]}],pe:[{pe:[ee]}],pt:[{pt:[ee]}],pr:[{pr:[ee]}],pb:[{pb:[ee]}],pl:[{pl:[ee]}],m:[{m:[re]}],mx:[{mx:[re]}],my:[{my:[re]}],ms:[{ms:[re]}],me:[{me:[re]}],mt:[{mt:[re]}],mr:[{mr:[re]}],mb:[{mb:[re]}],ml:[{ml:[re]}],"space-x":[{"space-x":[Ce]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ce]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",hn,n]}],"min-w":[{"min-w":[hn,n,"min","max","fit"]}],"max-w":[{"max-w":[hn,n,"none","full","min","max","fit","prose",{screen:[vu]},vu]}],h:[{h:[hn,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[hn,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[hn,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[hn,n,"auto","min","max","fit"]}],"font-size":[{text:["base",vu,yu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",rS]}],"font-family":[{font:[w_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",hn]}],"line-clamp":[{"line-clamp":["none",Dp,rS]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",tc,hn]}],"list-image":[{"list-image":["none",hn]}],"list-style-type":[{list:["none","disc","decimal",hn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Q]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Tt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",tc,yu]}],"underline-offset":[{"underline-offset":["auto",tc,hn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:He()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",hn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",hn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Q]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ze(),K$]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",X$]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},J$]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[J]}],"gradient-via-pos":[{via:[J]}],"gradient-to-pos":[{to:[J]}],"gradient-from":[{from:[ie]}],"gradient-via":[{via:[ie]}],"gradient-to":[{to:[ie]}],rounded:[{rounded:[b]}],"rounded-s":[{"rounded-s":[b]}],"rounded-e":[{"rounded-e":[b]}],"rounded-t":[{"rounded-t":[b]}],"rounded-r":[{"rounded-r":[b]}],"rounded-b":[{"rounded-b":[b]}],"rounded-l":[{"rounded-l":[b]}],"rounded-ss":[{"rounded-ss":[b]}],"rounded-se":[{"rounded-se":[b]}],"rounded-ee":[{"rounded-ee":[b]}],"rounded-es":[{"rounded-es":[b]}],"rounded-tl":[{"rounded-tl":[b]}],"rounded-tr":[{"rounded-tr":[b]}],"rounded-br":[{"rounded-br":[b]}],"rounded-bl":[{"rounded-bl":[b]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[Q]}],"border-style":[{border:[...Tt(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Q]}],"divide-style":[{divide:Tt()}],"border-color":[{border:[g]}],"border-color-x":[{"border-x":[g]}],"border-color-y":[{"border-y":[g]}],"border-color-s":[{"border-s":[g]}],"border-color-e":[{"border-e":[g]}],"border-color-t":[{"border-t":[g]}],"border-color-r":[{"border-r":[g]}],"border-color-b":[{"border-b":[g]}],"border-color-l":[{"border-l":[g]}],"divide-color":[{divide:[g]}],"outline-style":[{outline:["",...Tt()]}],"outline-offset":[{"outline-offset":[tc,hn]}],"outline-w":[{outline:[tc,yu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:et()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Q]}],"ring-offset-w":[{"ring-offset":[tc,yu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",vu,Q$]}],"shadow-color":[{shadow:[w_]}],opacity:[{opacity:[Q]}],"mix-blend":[{"mix-blend":[...Gt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Gt()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[u]}],contrast:[{contrast:[L]}],"drop-shadow":[{"drop-shadow":["","none",vu,hn]}],grayscale:[{grayscale:[O]}],"hue-rotate":[{"hue-rotate":[U]}],invert:[{invert:[q]}],saturate:[{saturate:[ue]}],sepia:[{sepia:[ge]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[u]}],"backdrop-contrast":[{"backdrop-contrast":[L]}],"backdrop-grayscale":[{"backdrop-grayscale":[O]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[U]}],"backdrop-invert":[{"backdrop-invert":[q]}],"backdrop-opacity":[{"backdrop-opacity":[Q]}],"backdrop-saturate":[{"backdrop-saturate":[ue]}],"backdrop-sepia":[{"backdrop-sepia":[ge]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[C]}],"border-spacing-x":[{"border-spacing-x":[C]}],"border-spacing-y":[{"border-spacing-y":[C]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",hn]}],duration:[{duration:bt()}],ease:[{ease:["linear","in","out","in-out",hn]}],delay:[{delay:bt()}],animate:[{animate:["none","spin","ping","pulse","bounce",hn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[fe]}],"scale-x":[{"scale-x":[fe]}],"scale-y":[{"scale-y":[fe]}],rotate:[{rotate:[b_,hn]}],"translate-x":[{"translate-x":[Be]}],"translate-y":[{"translate-y":[Be]}],"skew-x":[{"skew-x":[ke]}],"skew-y":[{"skew-y":[ke]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",hn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",hn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":He()}],"scroll-mx":[{"scroll-mx":He()}],"scroll-my":[{"scroll-my":He()}],"scroll-ms":[{"scroll-ms":He()}],"scroll-me":[{"scroll-me":He()}],"scroll-mt":[{"scroll-mt":He()}],"scroll-mr":[{"scroll-mr":He()}],"scroll-mb":[{"scroll-mb":He()}],"scroll-ml":[{"scroll-ml":He()}],"scroll-p":[{"scroll-p":He()}],"scroll-px":[{"scroll-px":He()}],"scroll-py":[{"scroll-py":He()}],"scroll-ps":[{"scroll-ps":He()}],"scroll-pe":[{"scroll-pe":He()}],"scroll-pt":[{"scroll-pt":He()}],"scroll-pr":[{"scroll-pr":He()}],"scroll-pb":[{"scroll-pb":He()}],"scroll-pl":[{"scroll-pl":He()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",hn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[tc,yu,rS]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},iG=F$(nG);function Rr(...e){return iG(_N(e))}const sG=e$,RN=Z.forwardRef(({className:e,...n},o)=>w.jsx(uN,{ref:o,className:Rr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...n}));RN.displayName=uN.displayName;const oG=Ny("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),kN=Z.forwardRef(({className:e,variant:n,...o},u)=>w.jsx(dN,{ref:u,className:Rr(oG({variant:n}),e),...o}));kN.displayName=dN.displayName;const aG=Z.forwardRef(({className:e,...n},o)=>w.jsx(pN,{ref:o,className:Rr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...n}));aG.displayName=pN.displayName;const DN=Z.forwardRef(({className:e,...n},o)=>w.jsx(mN,{ref:o,className:Rr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...n,children:w.jsx(Yu,{className:"h-4 w-4"})}));DN.displayName=mN.displayName;const LN=Z.forwardRef(({className:e,...n},o)=>w.jsx(hN,{ref:o,className:Rr("text-sm font-semibold",e),...n}));LN.displayName=hN.displayName;const NN=Z.forwardRef(({className:e,...n},o)=>w.jsx(fN,{ref:o,className:Rr("text-sm opacity-90",e),...n}));NN.displayName=fN.displayName;function lG(){const{toasts:e}=j1();return w.jsxs(sG,{children:[e.map(function({id:n,title:o,description:u,action:g,...b}){return w.jsxs(kN,{...b,children:[w.jsxs("div",{className:"grid gap-1",children:[o&&w.jsx(LN,{children:o}),u&&w.jsx(NN,{children:u})]}),g,w.jsx(DN,{})]},n)}),w.jsx(RN,{})]})}var ok=["light","dark"],cG="(prefers-color-scheme: dark)",uG=Z.createContext(void 0),dG={setTheme:e=>{},themes:[]},hG=()=>{var e;return(e=Z.useContext(uG))!=null?e:dG};Z.memo(({forcedTheme:e,storageKey:n,attribute:o,enableSystem:u,enableColorScheme:g,defaultTheme:b,value:C,attrs:i,nonce:L})=>{let O=b==="system",U=o==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(J=>`'${J}'`).join(",")})`};`:`var d=document.documentElement,n='${o}',s='setAttribute';`,q=g?ok.includes(b)&&b?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${b}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",G=(J,K=!1,re=!0)=>{let Q=C?C[J]:J,ee=K?J+"|| ''":`'${Q}'`,ue="";return g&&re&&!K&&ok.includes(J)&&(ue+=`d.style.colorScheme = '${J}';`),o==="class"?K||Q?ue+=`c.add(${ee})`:ue+="null":Q&&(ue+=`d[s](n,${ee})`),ue},ie=e?`!function(){${U}${G(e)}}()`:u?`!function(){try{${U}var e=localStorage.getItem('${n}');if('system'===e||(!e&&${O})){var t='${cG}',m=window.matchMedia(t);if(m.media!==t||m.matches){${G("dark")}}else{${G("light")}}}else if(e){${C?`var x=${JSON.stringify(C)};`:""}${G(C?"x[e]":"e",!0)}}${O?"":"else{"+G(b,!1,!1)+"}"}${q}}catch(e){}}()`:`!function(){try{${U}var e=localStorage.getItem('${n}');if(e){${C?`var x=${JSON.stringify(C)};`:""}${G(C?"x[e]":"e",!0)}}else{${G(b,!1,!1)};}${q}}catch(t){}}();`;return Z.createElement("script",{nonce:L,dangerouslySetInnerHTML:{__html:ie}})});var fG=e=>{switch(e){case"success":return gG;case"info":return yG;case"warning":return _G;case"error":return vG;default:return null}},pG=Array(12).fill(0),mG=({visible:e})=>tr.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},tr.createElement("div",{className:"sonner-spinner"},pG.map((n,o)=>tr.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${o}`})))),gG=tr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tr.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),_G=tr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},tr.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),yG=tr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),vG=tr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},tr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),xG=()=>{let[e,n]=tr.useState(document.hidden);return tr.useEffect(()=>{let o=()=>{n(document.hidden)};return document.addEventListener("visibilitychange",o),()=>window.removeEventListener("visibilitychange",o)},[]),e},AT=1,bG=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let n=this.subscribers.indexOf(e);this.subscribers.splice(n,1)}),this.publish=e=>{this.subscribers.forEach(n=>n(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var n;let{message:o,...u}=e,g=typeof(e==null?void 0:e.id)=="number"||((n=e.id)==null?void 0:n.length)>0?e.id:AT++,b=this.toasts.find(i=>i.id===g),C=e.dismissible===void 0?!0:e.dismissible;return b?this.toasts=this.toasts.map(i=>i.id===g?(this.publish({...i,...e,id:g,title:o}),{...i,...e,id:g,dismissible:C,title:o}):i):this.addToast({title:o,...u,dismissible:C,id:g}),g},this.dismiss=e=>(e||this.toasts.forEach(n=>{this.subscribers.forEach(o=>o({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:e,dismiss:!0})),e),this.message=(e,n)=>this.create({...n,message:e}),this.error=(e,n)=>this.create({...n,message:e,type:"error"}),this.success=(e,n)=>this.create({...n,type:"success",message:e}),this.info=(e,n)=>this.create({...n,type:"info",message:e}),this.warning=(e,n)=>this.create({...n,type:"warning",message:e}),this.loading=(e,n)=>this.create({...n,type:"loading",message:e}),this.promise=(e,n)=>{if(!n)return;let o;n.loading!==void 0&&(o=this.create({...n,promise:e,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let u=e instanceof Promise?e:e(),g=o!==void 0;return u.then(async b=>{if(SG(b)&&!b.ok){g=!1;let C=typeof n.error=="function"?await n.error(`HTTP error! status: ${b.status}`):n.error,i=typeof n.description=="function"?await n.description(`HTTP error! status: ${b.status}`):n.description;this.create({id:o,type:"error",message:C,description:i})}else if(n.success!==void 0){g=!1;let C=typeof n.success=="function"?await n.success(b):n.success,i=typeof n.description=="function"?await n.description(b):n.description;this.create({id:o,type:"success",message:C,description:i})}}).catch(async b=>{if(n.error!==void 0){g=!1;let C=typeof n.error=="function"?await n.error(b):n.error,i=typeof n.description=="function"?await n.description(b):n.description;this.create({id:o,type:"error",message:C,description:i})}}).finally(()=>{var b;g&&(this.dismiss(o),o=void 0),(b=n.finally)==null||b.call(n)}),o},this.custom=(e,n)=>{let o=(n==null?void 0:n.id)||AT++;return this.create({jsx:e(o),id:o,...n}),o},this.subscribers=[],this.toasts=[]}},Vo=new bG,wG=(e,n)=>{let o=(n==null?void 0:n.id)||AT++;return Vo.addToast({title:e,...n,id:o}),o},SG=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",TG=wG,EG=()=>Vo.toasts;Object.assign(TG,{success:Vo.success,info:Vo.info,warning:Vo.warning,error:Vo.error,custom:Vo.custom,message:Vo.message,promise:Vo.promise,dismiss:Vo.dismiss,loading:Vo.loading},{getHistory:EG});function CG(e,{insertAt:n}={}){if(typeof document>"u")return;let o=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.type="text/css",n==="top"&&o.firstChild?o.insertBefore(u,o.firstChild):o.appendChild(u),u.styleSheet?u.styleSheet.cssText=e:u.appendChild(document.createTextNode(e))}CG(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tx(e){return e.label!==void 0}var AG=3,MG="32px",IG=4e3,PG=356,RG=14,kG=20,DG=200;function LG(...e){return e.filter(Boolean).join(" ")}var NG=e=>{var n,o,u,g,b,C,i,L,O,U;let{invert:q,toast:G,unstyled:ie,interacting:J,setHeights:K,visibleToasts:re,heights:Q,index:ee,toasts:ue,expanded:fe,removeToast:ge,defaultRichColors:ke,closeButton:Ce,style:Be,cancelButtonStyle:dt,actionButtonStyle:Qe,className:qe="",descriptionClassName:He="",duration:et,position:mt,gap:Ze,loadingIcon:Tt,expandByDefault:Gt,classNames:ct,icons:Je,closeButtonAriaLabel:rt="Close toast",pauseWhenPageIsHidden:bt,cn:kt}=e,[At,_r]=tr.useState(!1),[cn,pr]=tr.useState(!1),[Dt,ir]=tr.useState(!1),[zr,he]=tr.useState(!1),[br,Ht]=tr.useState(0),[jr,wt]=tr.useState(0),dn=tr.useRef(null),rn=tr.useRef(null),Vn=ee===0,wr=ee+1<=re,Hr=G.type,Yn=G.dismissible!==!1,ys=G.className||"",vs=G.descriptionClassName||"",xs=tr.useMemo(()=>Q.findIndex(sr=>sr.toastId===G.id)||0,[Q,G.id]),Tr=tr.useMemo(()=>{var sr;return(sr=G.closeButton)!=null?sr:Ce},[G.closeButton,Ce]),mi=tr.useMemo(()=>G.duration||et||IG,[G.duration,et]),Is=tr.useRef(0),Yi=tr.useRef(0),gi=tr.useRef(0),Mi=tr.useRef(null),[ui,Ao]=mt.split("-"),ao=tr.useMemo(()=>Q.reduce((sr,An,vn)=>vn>=xs?sr:sr+An.height,0),[Q,xs]),bs=xG(),$s=G.invert||q,Oi=Hr==="loading";Yi.current=tr.useMemo(()=>xs*Ze+ao,[xs,ao]),tr.useEffect(()=>{_r(!0)},[]),tr.useLayoutEffect(()=>{if(!At)return;let sr=rn.current,An=sr.style.height;sr.style.height="auto";let vn=sr.getBoundingClientRect().height;sr.style.height=An,wt(vn),K(jn=>jn.find(_i=>_i.toastId===G.id)?jn.map(_i=>_i.toastId===G.id?{..._i,height:vn}:_i):[{toastId:G.id,height:vn,position:G.position},...jn])},[At,G.title,G.description,K,G.id]);let Ji=tr.useCallback(()=>{pr(!0),Ht(Yi.current),K(sr=>sr.filter(An=>An.toastId!==G.id)),setTimeout(()=>{ge(G)},DG)},[G,ge,K,Yi]);tr.useEffect(()=>{if(G.promise&&Hr==="loading"||G.duration===1/0||G.type==="loading")return;let sr,An=mi;return fe||J||bt&&bs?(()=>{if(gi.current<Is.current){let vn=new Date().getTime()-Is.current;An=An-vn}gi.current=new Date().getTime()})():An!==1/0&&(Is.current=new Date().getTime(),sr=setTimeout(()=>{var vn;(vn=G.onAutoClose)==null||vn.call(G,G),Ji()},An)),()=>clearTimeout(sr)},[fe,J,Gt,G,mi,Ji,G.promise,Hr,bt,bs]),tr.useEffect(()=>{let sr=rn.current;if(sr){let An=sr.getBoundingClientRect().height;return wt(An),K(vn=>[{toastId:G.id,height:An,position:G.position},...vn]),()=>K(vn=>vn.filter(jn=>jn.toastId!==G.id))}},[K,G.id]),tr.useEffect(()=>{G.delete&&Ji()},[Ji,G.delete]);function Cn(){return Je!=null&&Je.loading?tr.createElement("div",{className:"sonner-loader","data-visible":Hr==="loading"},Je.loading):Tt?tr.createElement("div",{className:"sonner-loader","data-visible":Hr==="loading"},Tt):tr.createElement(mG,{visible:Hr==="loading"})}return tr.createElement("li",{"aria-live":G.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:rn,className:kt(qe,ys,ct==null?void 0:ct.toast,(n=G==null?void 0:G.classNames)==null?void 0:n.toast,ct==null?void 0:ct.default,ct==null?void 0:ct[Hr],(o=G==null?void 0:G.classNames)==null?void 0:o[Hr]),"data-sonner-toast":"","data-rich-colors":(u=G.richColors)!=null?u:ke,"data-styled":!(G.jsx||G.unstyled||ie),"data-mounted":At,"data-promise":!!G.promise,"data-removed":cn,"data-visible":wr,"data-y-position":ui,"data-x-position":Ao,"data-index":ee,"data-front":Vn,"data-swiping":Dt,"data-dismissible":Yn,"data-type":Hr,"data-invert":$s,"data-swipe-out":zr,"data-expanded":!!(fe||Gt&&At),style:{"--index":ee,"--toasts-before":ee,"--z-index":ue.length-ee,"--offset":`${cn?br:Yi.current}px`,"--initial-height":Gt?"auto":`${jr}px`,...Be,...G.style},onPointerDown:sr=>{Oi||!Yn||(dn.current=new Date,Ht(Yi.current),sr.target.setPointerCapture(sr.pointerId),sr.target.tagName!=="BUTTON"&&(ir(!0),Mi.current={x:sr.clientX,y:sr.clientY}))},onPointerUp:()=>{var sr,An,vn,jn;if(zr||!Yn)return;Mi.current=null;let _i=Number(((sr=rn.current)==null?void 0:sr.style.getPropertyValue("--swipe-amount").replace("px",""))||0),lo=new Date().getTime()-((An=dn.current)==null?void 0:An.getTime()),Mo=Math.abs(_i)/lo;if(Math.abs(_i)>=kG||Mo>.11){Ht(Yi.current),(vn=G.onDismiss)==null||vn.call(G,G),Ji(),he(!0);return}(jn=rn.current)==null||jn.style.setProperty("--swipe-amount","0px"),ir(!1)},onPointerMove:sr=>{var An;if(!Mi.current||!Yn)return;let vn=sr.clientY-Mi.current.y,jn=sr.clientX-Mi.current.x,_i=(ui==="top"?Math.min:Math.max)(0,vn),lo=sr.pointerType==="touch"?10:2;Math.abs(_i)>lo?(An=rn.current)==null||An.style.setProperty("--swipe-amount",`${vn}px`):Math.abs(jn)>lo&&(Mi.current=null)}},Tr&&!G.jsx?tr.createElement("button",{"aria-label":rt,"data-disabled":Oi,"data-close-button":!0,onClick:Oi||!Yn?()=>{}:()=>{var sr;Ji(),(sr=G.onDismiss)==null||sr.call(G,G)},className:kt(ct==null?void 0:ct.closeButton,(g=G==null?void 0:G.classNames)==null?void 0:g.closeButton)},tr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},tr.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),tr.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,G.jsx||tr.isValidElement(G.title)?G.jsx||G.title:tr.createElement(tr.Fragment,null,Hr||G.icon||G.promise?tr.createElement("div",{"data-icon":"",className:kt(ct==null?void 0:ct.icon,(b=G==null?void 0:G.classNames)==null?void 0:b.icon)},G.promise||G.type==="loading"&&!G.icon?G.icon||Cn():null,G.type!=="loading"?G.icon||(Je==null?void 0:Je[Hr])||fG(Hr):null):null,tr.createElement("div",{"data-content":"",className:kt(ct==null?void 0:ct.content,(C=G==null?void 0:G.classNames)==null?void 0:C.content)},tr.createElement("div",{"data-title":"",className:kt(ct==null?void 0:ct.title,(i=G==null?void 0:G.classNames)==null?void 0:i.title)},G.title),G.description?tr.createElement("div",{"data-description":"",className:kt(He,vs,ct==null?void 0:ct.description,(L=G==null?void 0:G.classNames)==null?void 0:L.description)},G.description):null),tr.isValidElement(G.cancel)?G.cancel:G.cancel&&tx(G.cancel)?tr.createElement("button",{"data-button":!0,"data-cancel":!0,style:G.cancelButtonStyle||dt,onClick:sr=>{var An,vn;tx(G.cancel)&&Yn&&((vn=(An=G.cancel).onClick)==null||vn.call(An,sr),Ji())},className:kt(ct==null?void 0:ct.cancelButton,(O=G==null?void 0:G.classNames)==null?void 0:O.cancelButton)},G.cancel.label):null,tr.isValidElement(G.action)?G.action:G.action&&tx(G.action)?tr.createElement("button",{"data-button":!0,"data-action":!0,style:G.actionButtonStyle||Qe,onClick:sr=>{var An,vn;tx(G.action)&&(sr.defaultPrevented||((vn=(An=G.action).onClick)==null||vn.call(An,sr),Ji()))},className:kt(ct==null?void 0:ct.actionButton,(U=G==null?void 0:G.classNames)==null?void 0:U.actionButton)},G.action.label):null))};function ak(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var OG=e=>{let{invert:n,position:o="bottom-right",hotkey:u=["altKey","KeyT"],expand:g,closeButton:b,className:C,offset:i,theme:L="light",richColors:O,duration:U,style:q,visibleToasts:G=AG,toastOptions:ie,dir:J=ak(),gap:K=RG,loadingIcon:re,icons:Q,containerAriaLabel:ee="Notifications",pauseWhenPageIsHidden:ue,cn:fe=LG}=e,[ge,ke]=tr.useState([]),Ce=tr.useMemo(()=>Array.from(new Set([o].concat(ge.filter(bt=>bt.position).map(bt=>bt.position)))),[ge,o]),[Be,dt]=tr.useState([]),[Qe,qe]=tr.useState(!1),[He,et]=tr.useState(!1),[mt,Ze]=tr.useState(L!=="system"?L:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Tt=tr.useRef(null),Gt=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),ct=tr.useRef(null),Je=tr.useRef(!1),rt=tr.useCallback(bt=>{var kt;(kt=ge.find(At=>At.id===bt.id))!=null&&kt.delete||Vo.dismiss(bt.id),ke(At=>At.filter(({id:_r})=>_r!==bt.id))},[ge]);return tr.useEffect(()=>Vo.subscribe(bt=>{if(bt.dismiss){ke(kt=>kt.map(At=>At.id===bt.id?{...At,delete:!0}:At));return}setTimeout(()=>{qL.flushSync(()=>{ke(kt=>{let At=kt.findIndex(_r=>_r.id===bt.id);return At!==-1?[...kt.slice(0,At),{...kt[At],...bt},...kt.slice(At+1)]:[bt,...kt]})})})}),[]),tr.useEffect(()=>{if(L!=="system"){Ze(L);return}L==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Ze("dark"):Ze("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:bt})=>{Ze(bt?"dark":"light")})},[L]),tr.useEffect(()=>{ge.length<=1&&qe(!1)},[ge]),tr.useEffect(()=>{let bt=kt=>{var At,_r;u.every(cn=>kt[cn]||kt.code===cn)&&(qe(!0),(At=Tt.current)==null||At.focus()),kt.code==="Escape"&&(document.activeElement===Tt.current||(_r=Tt.current)!=null&&_r.contains(document.activeElement))&&qe(!1)};return document.addEventListener("keydown",bt),()=>document.removeEventListener("keydown",bt)},[u]),tr.useEffect(()=>{if(Tt.current)return()=>{ct.current&&(ct.current.focus({preventScroll:!0}),ct.current=null,Je.current=!1)}},[Tt.current]),ge.length?tr.createElement("section",{"aria-label":`${ee} ${Gt}`,tabIndex:-1},Ce.map((bt,kt)=>{var At;let[_r,cn]=bt.split("-");return tr.createElement("ol",{key:bt,dir:J==="auto"?ak():J,tabIndex:-1,ref:Tt,className:C,"data-sonner-toaster":!0,"data-theme":mt,"data-y-position":_r,"data-x-position":cn,style:{"--front-toast-height":`${((At=Be[0])==null?void 0:At.height)||0}px`,"--offset":typeof i=="number"?`${i}px`:i||MG,"--width":`${PG}px`,"--gap":`${K}px`,...q},onBlur:pr=>{Je.current&&!pr.currentTarget.contains(pr.relatedTarget)&&(Je.current=!1,ct.current&&(ct.current.focus({preventScroll:!0}),ct.current=null))},onFocus:pr=>{pr.target instanceof HTMLElement&&pr.target.dataset.dismissible==="false"||Je.current||(Je.current=!0,ct.current=pr.relatedTarget)},onMouseEnter:()=>qe(!0),onMouseMove:()=>qe(!0),onMouseLeave:()=>{He||qe(!1)},onPointerDown:pr=>{pr.target instanceof HTMLElement&&pr.target.dataset.dismissible==="false"||et(!0)},onPointerUp:()=>et(!1)},ge.filter(pr=>!pr.position&&kt===0||pr.position===bt).map((pr,Dt)=>{var ir,zr;return tr.createElement(NG,{key:pr.id,icons:Q,index:Dt,toast:pr,defaultRichColors:O,duration:(ir=ie==null?void 0:ie.duration)!=null?ir:U,className:ie==null?void 0:ie.className,descriptionClassName:ie==null?void 0:ie.descriptionClassName,invert:n,visibleToasts:G,closeButton:(zr=ie==null?void 0:ie.closeButton)!=null?zr:b,interacting:He,position:bt,style:ie==null?void 0:ie.style,unstyled:ie==null?void 0:ie.unstyled,classNames:ie==null?void 0:ie.classNames,cancelButtonStyle:ie==null?void 0:ie.cancelButtonStyle,actionButtonStyle:ie==null?void 0:ie.actionButtonStyle,removeToast:rt,toasts:ge.filter(he=>he.position==pr.position),heights:Be.filter(he=>he.position==pr.position),setHeights:dt,expandByDefault:g,gap:K,loadingIcon:re,expanded:Qe,pauseWhenPageIsHidden:ue,cn:fe})}))})):null};const zG=({...e})=>{const{theme:n="system"}=hG();return w.jsx(OG,{theme:n,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var jG=V3.useId||(()=>{}),FG=0;function Ka(e){const[n,o]=Z.useState(jG());return Ki(()=>{e||o(u=>u??String(FG++))},[e]),e||(n?`radix-${n}`:"")}const BG=["top","right","bottom","left"],Ju=Math.min,Go=Math.max,i1=Math.round,rx=Math.floor,Qu=e=>({x:e,y:e}),UG={left:"right",right:"left",bottom:"top",top:"bottom"},VG={start:"end",end:"start"};function MT(e,n,o){return Go(e,Ju(n,o))}function gc(e,n){return typeof e=="function"?e(n):e}function _c(e){return e.split("-")[0]}function am(e){return e.split("-")[1]}function lC(e){return e==="x"?"y":"x"}function cC(e){return e==="y"?"height":"width"}function ed(e){return["top","bottom"].includes(_c(e))?"y":"x"}function uC(e){return lC(ed(e))}function $G(e,n,o){o===void 0&&(o=!1);const u=am(e),g=uC(e),b=cC(g);let C=g==="x"?u===(o?"end":"start")?"right":"left":u==="start"?"bottom":"top";return n.reference[b]>n.floating[b]&&(C=s1(C)),[C,s1(C)]}function GG(e){const n=s1(e);return[IT(e),n,IT(n)]}function IT(e){return e.replace(/start|end/g,n=>VG[n])}function qG(e,n,o){const u=["left","right"],g=["right","left"],b=["top","bottom"],C=["bottom","top"];switch(e){case"top":case"bottom":return o?n?g:u:n?u:g;case"left":case"right":return n?b:C;default:return[]}}function HG(e,n,o,u){const g=am(e);let b=qG(_c(e),o==="start",u);return g&&(b=b.map(C=>C+"-"+g),n&&(b=b.concat(b.map(IT)))),b}function s1(e){return e.replace(/left|right|bottom|top/g,n=>UG[n])}function WG(e){return{top:0,right:0,bottom:0,left:0,...e}}function ON(e){return typeof e!="number"?WG(e):{top:e,right:e,bottom:e,left:e}}function o1(e){const{x:n,y:o,width:u,height:g}=e;return{width:u,height:g,top:o,left:n,right:n+u,bottom:o+g,x:n,y:o}}function lk(e,n,o){let{reference:u,floating:g}=e;const b=ed(n),C=uC(n),i=cC(C),L=_c(n),O=b==="y",U=u.x+u.width/2-g.width/2,q=u.y+u.height/2-g.height/2,G=u[i]/2-g[i]/2;let ie;switch(L){case"top":ie={x:U,y:u.y-g.height};break;case"bottom":ie={x:U,y:u.y+u.height};break;case"right":ie={x:u.x+u.width,y:q};break;case"left":ie={x:u.x-g.width,y:q};break;default:ie={x:u.x,y:u.y}}switch(am(n)){case"start":ie[C]-=G*(o&&O?-1:1);break;case"end":ie[C]+=G*(o&&O?-1:1);break}return ie}const ZG=async(e,n,o)=>{const{placement:u="bottom",strategy:g="absolute",middleware:b=[],platform:C}=o,i=b.filter(Boolean),L=await(C.isRTL==null?void 0:C.isRTL(n));let O=await C.getElementRects({reference:e,floating:n,strategy:g}),{x:U,y:q}=lk(O,u,L),G=u,ie={},J=0;for(let K=0;K<i.length;K++){const{name:re,fn:Q}=i[K],{x:ee,y:ue,data:fe,reset:ge}=await Q({x:U,y:q,initialPlacement:u,placement:G,strategy:g,middlewareData:ie,rects:O,platform:C,elements:{reference:e,floating:n}});U=ee??U,q=ue??q,ie={...ie,[re]:{...ie[re],...fe}},ge&&J<=50&&(J++,typeof ge=="object"&&(ge.placement&&(G=ge.placement),ge.rects&&(O=ge.rects===!0?await C.getElementRects({reference:e,floating:n,strategy:g}):ge.rects),{x:U,y:q}=lk(O,G,L)),K=-1)}return{x:U,y:q,placement:G,strategy:g,middlewareData:ie}};async function hy(e,n){var o;n===void 0&&(n={});const{x:u,y:g,platform:b,rects:C,elements:i,strategy:L}=e,{boundary:O="clippingAncestors",rootBoundary:U="viewport",elementContext:q="floating",altBoundary:G=!1,padding:ie=0}=gc(n,e),J=ON(ie),re=i[G?q==="floating"?"reference":"floating":q],Q=o1(await b.getClippingRect({element:(o=await(b.isElement==null?void 0:b.isElement(re)))==null||o?re:re.contextElement||await(b.getDocumentElement==null?void 0:b.getDocumentElement(i.floating)),boundary:O,rootBoundary:U,strategy:L})),ee=q==="floating"?{x:u,y:g,width:C.floating.width,height:C.floating.height}:C.reference,ue=await(b.getOffsetParent==null?void 0:b.getOffsetParent(i.floating)),fe=await(b.isElement==null?void 0:b.isElement(ue))?await(b.getScale==null?void 0:b.getScale(ue))||{x:1,y:1}:{x:1,y:1},ge=o1(b.convertOffsetParentRelativeRectToViewportRelativeRect?await b.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:ee,offsetParent:ue,strategy:L}):ee);return{top:(Q.top-ge.top+J.top)/fe.y,bottom:(ge.bottom-Q.bottom+J.bottom)/fe.y,left:(Q.left-ge.left+J.left)/fe.x,right:(ge.right-Q.right+J.right)/fe.x}}const XG=e=>({name:"arrow",options:e,async fn(n){const{x:o,y:u,placement:g,rects:b,platform:C,elements:i,middlewareData:L}=n,{element:O,padding:U=0}=gc(e,n)||{};if(O==null)return{};const q=ON(U),G={x:o,y:u},ie=uC(g),J=cC(ie),K=await C.getDimensions(O),re=ie==="y",Q=re?"top":"left",ee=re?"bottom":"right",ue=re?"clientHeight":"clientWidth",fe=b.reference[J]+b.reference[ie]-G[ie]-b.floating[J],ge=G[ie]-b.reference[ie],ke=await(C.getOffsetParent==null?void 0:C.getOffsetParent(O));let Ce=ke?ke[ue]:0;(!Ce||!await(C.isElement==null?void 0:C.isElement(ke)))&&(Ce=i.floating[ue]||b.floating[J]);const Be=fe/2-ge/2,dt=Ce/2-K[J]/2-1,Qe=Ju(q[Q],dt),qe=Ju(q[ee],dt),He=Qe,et=Ce-K[J]-qe,mt=Ce/2-K[J]/2+Be,Ze=MT(He,mt,et),Tt=!L.arrow&&am(g)!=null&&mt!==Ze&&b.reference[J]/2-(mt<He?Qe:qe)-K[J]/2<0,Gt=Tt?mt<He?mt-He:mt-et:0;return{[ie]:G[ie]+Gt,data:{[ie]:Ze,centerOffset:mt-Ze-Gt,...Tt&&{alignmentOffset:Gt}},reset:Tt}}}),KG=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(n){var o,u;const{placement:g,middlewareData:b,rects:C,initialPlacement:i,platform:L,elements:O}=n,{mainAxis:U=!0,crossAxis:q=!0,fallbackPlacements:G,fallbackStrategy:ie="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:K=!0,...re}=gc(e,n);if((o=b.arrow)!=null&&o.alignmentOffset)return{};const Q=_c(g),ee=ed(i),ue=_c(i)===i,fe=await(L.isRTL==null?void 0:L.isRTL(O.floating)),ge=G||(ue||!K?[s1(i)]:GG(i)),ke=J!=="none";!G&&ke&&ge.push(...HG(i,K,J,fe));const Ce=[i,...ge],Be=await hy(n,re),dt=[];let Qe=((u=b.flip)==null?void 0:u.overflows)||[];if(U&&dt.push(Be[Q]),q){const mt=$G(g,C,fe);dt.push(Be[mt[0]],Be[mt[1]])}if(Qe=[...Qe,{placement:g,overflows:dt}],!dt.every(mt=>mt<=0)){var qe,He;const mt=(((qe=b.flip)==null?void 0:qe.index)||0)+1,Ze=Ce[mt];if(Ze)return{data:{index:mt,overflows:Qe},reset:{placement:Ze}};let Tt=(He=Qe.filter(Gt=>Gt.overflows[0]<=0).sort((Gt,ct)=>Gt.overflows[1]-ct.overflows[1])[0])==null?void 0:He.placement;if(!Tt)switch(ie){case"bestFit":{var et;const Gt=(et=Qe.filter(ct=>{if(ke){const Je=ed(ct.placement);return Je===ee||Je==="y"}return!0}).map(ct=>[ct.placement,ct.overflows.filter(Je=>Je>0).reduce((Je,rt)=>Je+rt,0)]).sort((ct,Je)=>ct[1]-Je[1])[0])==null?void 0:et[0];Gt&&(Tt=Gt);break}case"initialPlacement":Tt=i;break}if(g!==Tt)return{reset:{placement:Tt}}}return{}}}};function ck(e,n){return{top:e.top-n.height,right:e.right-n.width,bottom:e.bottom-n.height,left:e.left-n.width}}function uk(e){return BG.some(n=>e[n]>=0)}const YG=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(n){const{rects:o}=n,{strategy:u="referenceHidden",...g}=gc(e,n);switch(u){case"referenceHidden":{const b=await hy(n,{...g,elementContext:"reference"}),C=ck(b,o.reference);return{data:{referenceHiddenOffsets:C,referenceHidden:uk(C)}}}case"escaped":{const b=await hy(n,{...g,altBoundary:!0}),C=ck(b,o.floating);return{data:{escapedOffsets:C,escaped:uk(C)}}}default:return{}}}}};async function JG(e,n){const{placement:o,platform:u,elements:g}=e,b=await(u.isRTL==null?void 0:u.isRTL(g.floating)),C=_c(o),i=am(o),L=ed(o)==="y",O=["left","top"].includes(C)?-1:1,U=b&&L?-1:1,q=gc(n,e);let{mainAxis:G,crossAxis:ie,alignmentAxis:J}=typeof q=="number"?{mainAxis:q,crossAxis:0,alignmentAxis:null}:{mainAxis:q.mainAxis||0,crossAxis:q.crossAxis||0,alignmentAxis:q.alignmentAxis};return i&&typeof J=="number"&&(ie=i==="end"?J*-1:J),L?{x:ie*U,y:G*O}:{x:G*O,y:ie*U}}const QG=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(n){var o,u;const{x:g,y:b,placement:C,middlewareData:i}=n,L=await JG(n,e);return C===((o=i.offset)==null?void 0:o.placement)&&(u=i.arrow)!=null&&u.alignmentOffset?{}:{x:g+L.x,y:b+L.y,data:{...L,placement:C}}}}},eq=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(n){const{x:o,y:u,placement:g}=n,{mainAxis:b=!0,crossAxis:C=!1,limiter:i={fn:re=>{let{x:Q,y:ee}=re;return{x:Q,y:ee}}},...L}=gc(e,n),O={x:o,y:u},U=await hy(n,L),q=ed(_c(g)),G=lC(q);let ie=O[G],J=O[q];if(b){const re=G==="y"?"top":"left",Q=G==="y"?"bottom":"right",ee=ie+U[re],ue=ie-U[Q];ie=MT(ee,ie,ue)}if(C){const re=q==="y"?"top":"left",Q=q==="y"?"bottom":"right",ee=J+U[re],ue=J-U[Q];J=MT(ee,J,ue)}const K=i.fn({...n,[G]:ie,[q]:J});return{...K,data:{x:K.x-o,y:K.y-u,enabled:{[G]:b,[q]:C}}}}}},tq=function(e){return e===void 0&&(e={}),{options:e,fn(n){const{x:o,y:u,placement:g,rects:b,middlewareData:C}=n,{offset:i=0,mainAxis:L=!0,crossAxis:O=!0}=gc(e,n),U={x:o,y:u},q=ed(g),G=lC(q);let ie=U[G],J=U[q];const K=gc(i,n),re=typeof K=="number"?{mainAxis:K,crossAxis:0}:{mainAxis:0,crossAxis:0,...K};if(L){const ue=G==="y"?"height":"width",fe=b.reference[G]-b.floating[ue]+re.mainAxis,ge=b.reference[G]+b.reference[ue]-re.mainAxis;ie<fe?ie=fe:ie>ge&&(ie=ge)}if(O){var Q,ee;const ue=G==="y"?"width":"height",fe=["top","left"].includes(_c(g)),ge=b.reference[q]-b.floating[ue]+(fe&&((Q=C.offset)==null?void 0:Q[q])||0)+(fe?0:re.crossAxis),ke=b.reference[q]+b.reference[ue]+(fe?0:((ee=C.offset)==null?void 0:ee[q])||0)-(fe?re.crossAxis:0);J<ge?J=ge:J>ke&&(J=ke)}return{[G]:ie,[q]:J}}}},rq=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(n){var o,u;const{placement:g,rects:b,platform:C,elements:i}=n,{apply:L=()=>{},...O}=gc(e,n),U=await hy(n,O),q=_c(g),G=am(g),ie=ed(g)==="y",{width:J,height:K}=b.floating;let re,Q;q==="top"||q==="bottom"?(re=q,Q=G===(await(C.isRTL==null?void 0:C.isRTL(i.floating))?"start":"end")?"left":"right"):(Q=q,re=G==="end"?"top":"bottom");const ee=K-U.top-U.bottom,ue=J-U.left-U.right,fe=Ju(K-U[re],ee),ge=Ju(J-U[Q],ue),ke=!n.middlewareData.shift;let Ce=fe,Be=ge;if((o=n.middlewareData.shift)!=null&&o.enabled.x&&(Be=ue),(u=n.middlewareData.shift)!=null&&u.enabled.y&&(Ce=ee),ke&&!G){const Qe=Go(U.left,0),qe=Go(U.right,0),He=Go(U.top,0),et=Go(U.bottom,0);ie?Be=J-2*(Qe!==0||qe!==0?Qe+qe:Go(U.left,U.right)):Ce=K-2*(He!==0||et!==0?He+et:Go(U.top,U.bottom))}await L({...n,availableWidth:Be,availableHeight:Ce});const dt=await C.getDimensions(i.floating);return J!==dt.width||K!==dt.height?{reset:{rects:!0}}:{}}}};function G1(){return typeof window<"u"}function lm(e){return zN(e)?(e.nodeName||"").toLowerCase():"#document"}function Wo(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function jl(e){var n;return(n=(zN(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function zN(e){return G1()?e instanceof Node||e instanceof Wo(e).Node:!1}function Qa(e){return G1()?e instanceof Element||e instanceof Wo(e).Element:!1}function Ll(e){return G1()?e instanceof HTMLElement||e instanceof Wo(e).HTMLElement:!1}function dk(e){return!G1()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Wo(e).ShadowRoot}function Oy(e){const{overflow:n,overflowX:o,overflowY:u,display:g}=el(e);return/auto|scroll|overlay|hidden|clip/.test(n+u+o)&&!["inline","contents"].includes(g)}function nq(e){return["table","td","th"].includes(lm(e))}function q1(e){return[":popover-open",":modal"].some(n=>{try{return e.matches(n)}catch{return!1}})}function dC(e){const n=hC(),o=Qa(e)?el(e):e;return o.transform!=="none"||o.perspective!=="none"||(o.containerType?o.containerType!=="normal":!1)||!n&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!n&&(o.filter?o.filter!=="none":!1)||["transform","perspective","filter"].some(u=>(o.willChange||"").includes(u))||["paint","layout","strict","content"].some(u=>(o.contain||"").includes(u))}function iq(e){let n=td(e);for(;Ll(n)&&!Qp(n);){if(dC(n))return n;if(q1(n))return null;n=td(n)}return null}function hC(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Qp(e){return["html","body","#document"].includes(lm(e))}function el(e){return Wo(e).getComputedStyle(e)}function H1(e){return Qa(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function td(e){if(lm(e)==="html")return e;const n=e.assignedSlot||e.parentNode||dk(e)&&e.host||jl(e);return dk(n)?n.host:n}function jN(e){const n=td(e);return Qp(n)?e.ownerDocument?e.ownerDocument.body:e.body:Ll(n)&&Oy(n)?n:jN(n)}function fy(e,n,o){var u;n===void 0&&(n=[]),o===void 0&&(o=!0);const g=jN(e),b=g===((u=e.ownerDocument)==null?void 0:u.body),C=Wo(g);if(b){const i=PT(C);return n.concat(C,C.visualViewport||[],Oy(g)?g:[],i&&o?fy(i):[])}return n.concat(g,fy(g,[],o))}function PT(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function FN(e){const n=el(e);let o=parseFloat(n.width)||0,u=parseFloat(n.height)||0;const g=Ll(e),b=g?e.offsetWidth:o,C=g?e.offsetHeight:u,i=i1(o)!==b||i1(u)!==C;return i&&(o=b,u=C),{width:o,height:u,$:i}}function fC(e){return Qa(e)?e:e.contextElement}function Lp(e){const n=fC(e);if(!Ll(n))return Qu(1);const o=n.getBoundingClientRect(),{width:u,height:g,$:b}=FN(n);let C=(b?i1(o.width):o.width)/u,i=(b?i1(o.height):o.height)/g;return(!C||!Number.isFinite(C))&&(C=1),(!i||!Number.isFinite(i))&&(i=1),{x:C,y:i}}const sq=Qu(0);function BN(e){const n=Wo(e);return!hC()||!n.visualViewport?sq:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function oq(e,n,o){return n===void 0&&(n=!1),!o||n&&o!==Wo(e)?!1:n}function Mh(e,n,o,u){n===void 0&&(n=!1),o===void 0&&(o=!1);const g=e.getBoundingClientRect(),b=fC(e);let C=Qu(1);n&&(u?Qa(u)&&(C=Lp(u)):C=Lp(e));const i=oq(b,o,u)?BN(b):Qu(0);let L=(g.left+i.x)/C.x,O=(g.top+i.y)/C.y,U=g.width/C.x,q=g.height/C.y;if(b){const G=Wo(b),ie=u&&Qa(u)?Wo(u):u;let J=G,K=PT(J);for(;K&&u&&ie!==J;){const re=Lp(K),Q=K.getBoundingClientRect(),ee=el(K),ue=Q.left+(K.clientLeft+parseFloat(ee.paddingLeft))*re.x,fe=Q.top+(K.clientTop+parseFloat(ee.paddingTop))*re.y;L*=re.x,O*=re.y,U*=re.x,q*=re.y,L+=ue,O+=fe,J=Wo(K),K=PT(J)}}return o1({width:U,height:q,x:L,y:O})}function aq(e){let{elements:n,rect:o,offsetParent:u,strategy:g}=e;const b=g==="fixed",C=jl(u),i=n?q1(n.floating):!1;if(u===C||i&&b)return o;let L={scrollLeft:0,scrollTop:0},O=Qu(1);const U=Qu(0),q=Ll(u);if((q||!q&&!b)&&((lm(u)!=="body"||Oy(C))&&(L=H1(u)),Ll(u))){const G=Mh(u);O=Lp(u),U.x=G.x+u.clientLeft,U.y=G.y+u.clientTop}return{width:o.width*O.x,height:o.height*O.y,x:o.x*O.x-L.scrollLeft*O.x+U.x,y:o.y*O.y-L.scrollTop*O.y+U.y}}function lq(e){return Array.from(e.getClientRects())}function RT(e,n){const o=H1(e).scrollLeft;return n?n.left+o:Mh(jl(e)).left+o}function cq(e){const n=jl(e),o=H1(e),u=e.ownerDocument.body,g=Go(n.scrollWidth,n.clientWidth,u.scrollWidth,u.clientWidth),b=Go(n.scrollHeight,n.clientHeight,u.scrollHeight,u.clientHeight);let C=-o.scrollLeft+RT(e);const i=-o.scrollTop;return el(u).direction==="rtl"&&(C+=Go(n.clientWidth,u.clientWidth)-g),{width:g,height:b,x:C,y:i}}function uq(e,n){const o=Wo(e),u=jl(e),g=o.visualViewport;let b=u.clientWidth,C=u.clientHeight,i=0,L=0;if(g){b=g.width,C=g.height;const O=hC();(!O||O&&n==="fixed")&&(i=g.offsetLeft,L=g.offsetTop)}return{width:b,height:C,x:i,y:L}}function dq(e,n){const o=Mh(e,!0,n==="fixed"),u=o.top+e.clientTop,g=o.left+e.clientLeft,b=Ll(e)?Lp(e):Qu(1),C=e.clientWidth*b.x,i=e.clientHeight*b.y,L=g*b.x,O=u*b.y;return{width:C,height:i,x:L,y:O}}function hk(e,n,o){let u;if(n==="viewport")u=uq(e,o);else if(n==="document")u=cq(jl(e));else if(Qa(n))u=dq(n,o);else{const g=BN(e);u={...n,x:n.x-g.x,y:n.y-g.y}}return o1(u)}function UN(e,n){const o=td(e);return o===n||!Qa(o)||Qp(o)?!1:el(o).position==="fixed"||UN(o,n)}function hq(e,n){const o=n.get(e);if(o)return o;let u=fy(e,[],!1).filter(i=>Qa(i)&&lm(i)!=="body"),g=null;const b=el(e).position==="fixed";let C=b?td(e):e;for(;Qa(C)&&!Qp(C);){const i=el(C),L=dC(C);!L&&i.position==="fixed"&&(g=null),(b?!L&&!g:!L&&i.position==="static"&&!!g&&["absolute","fixed"].includes(g.position)||Oy(C)&&!L&&UN(e,C))?u=u.filter(U=>U!==C):g=i,C=td(C)}return n.set(e,u),u}function fq(e){let{element:n,boundary:o,rootBoundary:u,strategy:g}=e;const C=[...o==="clippingAncestors"?q1(n)?[]:hq(n,this._c):[].concat(o),u],i=C[0],L=C.reduce((O,U)=>{const q=hk(n,U,g);return O.top=Go(q.top,O.top),O.right=Ju(q.right,O.right),O.bottom=Ju(q.bottom,O.bottom),O.left=Go(q.left,O.left),O},hk(n,i,g));return{width:L.right-L.left,height:L.bottom-L.top,x:L.left,y:L.top}}function pq(e){const{width:n,height:o}=FN(e);return{width:n,height:o}}function mq(e,n,o){const u=Ll(n),g=jl(n),b=o==="fixed",C=Mh(e,!0,b,n);let i={scrollLeft:0,scrollTop:0};const L=Qu(0);if(u||!u&&!b)if((lm(n)!=="body"||Oy(g))&&(i=H1(n)),u){const ie=Mh(n,!0,b,n);L.x=ie.x+n.clientLeft,L.y=ie.y+n.clientTop}else g&&(L.x=RT(g));let O=0,U=0;if(g&&!u&&!b){const ie=g.getBoundingClientRect();U=ie.top+i.scrollTop,O=ie.left+i.scrollLeft-RT(g,ie)}const q=C.left+i.scrollLeft-L.x-O,G=C.top+i.scrollTop-L.y-U;return{x:q,y:G,width:C.width,height:C.height}}function nS(e){return el(e).position==="static"}function fk(e,n){if(!Ll(e)||el(e).position==="fixed")return null;if(n)return n(e);let o=e.offsetParent;return jl(e)===o&&(o=o.ownerDocument.body),o}function VN(e,n){const o=Wo(e);if(q1(e))return o;if(!Ll(e)){let g=td(e);for(;g&&!Qp(g);){if(Qa(g)&&!nS(g))return g;g=td(g)}return o}let u=fk(e,n);for(;u&&nq(u)&&nS(u);)u=fk(u,n);return u&&Qp(u)&&nS(u)&&!dC(u)?o:u||iq(e)||o}const gq=async function(e){const n=this.getOffsetParent||VN,o=this.getDimensions,u=await o(e.floating);return{reference:mq(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,width:u.width,height:u.height}}};function _q(e){return el(e).direction==="rtl"}const yq={convertOffsetParentRelativeRectToViewportRelativeRect:aq,getDocumentElement:jl,getClippingRect:fq,getOffsetParent:VN,getElementRects:gq,getClientRects:lq,getDimensions:pq,getScale:Lp,isElement:Qa,isRTL:_q};function vq(e,n){let o=null,u;const g=jl(e);function b(){var i;clearTimeout(u),(i=o)==null||i.disconnect(),o=null}function C(i,L){i===void 0&&(i=!1),L===void 0&&(L=1),b();const{left:O,top:U,width:q,height:G}=e.getBoundingClientRect();if(i||n(),!q||!G)return;const ie=rx(U),J=rx(g.clientWidth-(O+q)),K=rx(g.clientHeight-(U+G)),re=rx(O),ee={rootMargin:-ie+"px "+-J+"px "+-K+"px "+-re+"px",threshold:Go(0,Ju(1,L))||1};let ue=!0;function fe(ge){const ke=ge[0].intersectionRatio;if(ke!==L){if(!ue)return C();ke?C(!1,ke):u=setTimeout(()=>{C(!1,1e-7)},1e3)}ue=!1}try{o=new IntersectionObserver(fe,{...ee,root:g.ownerDocument})}catch{o=new IntersectionObserver(fe,ee)}o.observe(e)}return C(!0),b}function xq(e,n,o,u){u===void 0&&(u={});const{ancestorScroll:g=!0,ancestorResize:b=!0,elementResize:C=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:L=!1}=u,O=fC(e),U=g||b?[...O?fy(O):[],...fy(n)]:[];U.forEach(Q=>{g&&Q.addEventListener("scroll",o,{passive:!0}),b&&Q.addEventListener("resize",o)});const q=O&&i?vq(O,o):null;let G=-1,ie=null;C&&(ie=new ResizeObserver(Q=>{let[ee]=Q;ee&&ee.target===O&&ie&&(ie.unobserve(n),cancelAnimationFrame(G),G=requestAnimationFrame(()=>{var ue;(ue=ie)==null||ue.observe(n)})),o()}),O&&!L&&ie.observe(O),ie.observe(n));let J,K=L?Mh(e):null;L&&re();function re(){const Q=Mh(e);K&&(Q.x!==K.x||Q.y!==K.y||Q.width!==K.width||Q.height!==K.height)&&o(),K=Q,J=requestAnimationFrame(re)}return o(),()=>{var Q;U.forEach(ee=>{g&&ee.removeEventListener("scroll",o),b&&ee.removeEventListener("resize",o)}),q==null||q(),(Q=ie)==null||Q.disconnect(),ie=null,L&&cancelAnimationFrame(J)}}const bq=QG,wq=eq,Sq=KG,Tq=rq,Eq=YG,pk=XG,Cq=tq,Aq=(e,n,o)=>{const u=new Map,g={platform:yq,...o},b={...g.platform,_c:u};return ZG(e,n,{...g,platform:b})};var Ix=typeof document<"u"?Z.useLayoutEffect:Z.useEffect;function a1(e,n){if(e===n)return!0;if(typeof e!=typeof n)return!1;if(typeof e=="function"&&e.toString()===n.toString())return!0;let o,u,g;if(e&&n&&typeof e=="object"){if(Array.isArray(e)){if(o=e.length,o!==n.length)return!1;for(u=o;u--!==0;)if(!a1(e[u],n[u]))return!1;return!0}if(g=Object.keys(e),o=g.length,o!==Object.keys(n).length)return!1;for(u=o;u--!==0;)if(!{}.hasOwnProperty.call(n,g[u]))return!1;for(u=o;u--!==0;){const b=g[u];if(!(b==="_owner"&&e.$$typeof)&&!a1(e[b],n[b]))return!1}return!0}return e!==e&&n!==n}function $N(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function mk(e,n){const o=$N(e);return Math.round(n*o)/o}function iS(e){const n=Z.useRef(e);return Ix(()=>{n.current=e}),n}function Mq(e){e===void 0&&(e={});const{placement:n="bottom",strategy:o="absolute",middleware:u=[],platform:g,elements:{reference:b,floating:C}={},transform:i=!0,whileElementsMounted:L,open:O}=e,[U,q]=Z.useState({x:0,y:0,strategy:o,placement:n,middlewareData:{},isPositioned:!1}),[G,ie]=Z.useState(u);a1(G,u)||ie(u);const[J,K]=Z.useState(null),[re,Q]=Z.useState(null),ee=Z.useCallback(ct=>{ct!==ke.current&&(ke.current=ct,K(ct))},[]),ue=Z.useCallback(ct=>{ct!==Ce.current&&(Ce.current=ct,Q(ct))},[]),fe=b||J,ge=C||re,ke=Z.useRef(null),Ce=Z.useRef(null),Be=Z.useRef(U),dt=L!=null,Qe=iS(L),qe=iS(g),He=iS(O),et=Z.useCallback(()=>{if(!ke.current||!Ce.current)return;const ct={placement:n,strategy:o,middleware:G};qe.current&&(ct.platform=qe.current),Aq(ke.current,Ce.current,ct).then(Je=>{const rt={...Je,isPositioned:He.current!==!1};mt.current&&!a1(Be.current,rt)&&(Be.current=rt,Nh.flushSync(()=>{q(rt)}))})},[G,n,o,qe,He]);Ix(()=>{O===!1&&Be.current.isPositioned&&(Be.current.isPositioned=!1,q(ct=>({...ct,isPositioned:!1})))},[O]);const mt=Z.useRef(!1);Ix(()=>(mt.current=!0,()=>{mt.current=!1}),[]),Ix(()=>{if(fe&&(ke.current=fe),ge&&(Ce.current=ge),fe&&ge){if(Qe.current)return Qe.current(fe,ge,et);et()}},[fe,ge,et,Qe,dt]);const Ze=Z.useMemo(()=>({reference:ke,floating:Ce,setReference:ee,setFloating:ue}),[ee,ue]),Tt=Z.useMemo(()=>({reference:fe,floating:ge}),[fe,ge]),Gt=Z.useMemo(()=>{const ct={position:o,left:0,top:0};if(!Tt.floating)return ct;const Je=mk(Tt.floating,U.x),rt=mk(Tt.floating,U.y);return i?{...ct,transform:"translate("+Je+"px, "+rt+"px)",...$N(Tt.floating)>=1.5&&{willChange:"transform"}}:{position:o,left:Je,top:rt}},[o,i,Tt.floating,U.x,U.y]);return Z.useMemo(()=>({...U,update:et,refs:Ze,elements:Tt,floatingStyles:Gt}),[U,et,Ze,Tt,Gt])}const Iq=e=>{function n(o){return{}.hasOwnProperty.call(o,"current")}return{name:"arrow",options:e,fn(o){const{element:u,padding:g}=typeof e=="function"?e(o):e;return u&&n(u)?u.current!=null?pk({element:u.current,padding:g}).fn(o):{}:u?pk({element:u,padding:g}).fn(o):{}}}},Pq=(e,n)=>({...bq(e),options:[e,n]}),Rq=(e,n)=>({...wq(e),options:[e,n]}),kq=(e,n)=>({...Cq(e),options:[e,n]}),Dq=(e,n)=>({...Sq(e),options:[e,n]}),Lq=(e,n)=>({...Tq(e),options:[e,n]}),Nq=(e,n)=>({...Eq(e),options:[e,n]}),Oq=(e,n)=>({...Iq(e),options:[e,n]});var zq="Arrow",GN=Z.forwardRef((e,n)=>{const{children:o,width:u=10,height:g=5,...b}=e;return w.jsx(qr.svg,{...b,ref:n,width:u,height:g,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?o:w.jsx("polygon",{points:"0,0 30,0 15,10"})})});GN.displayName=zq;var jq=GN;function Fq(e,n=[]){let o=[];function u(b,C){const i=Z.createContext(C),L=o.length;o=[...o,C];function O(q){const{scope:G,children:ie,...J}=q,K=(G==null?void 0:G[e][L])||i,re=Z.useMemo(()=>J,Object.values(J));return w.jsx(K.Provider,{value:re,children:ie})}function U(q,G){const ie=(G==null?void 0:G[e][L])||i,J=Z.useContext(ie);if(J)return J;if(C!==void 0)return C;throw new Error(`\`${q}\` must be used within \`${b}\``)}return O.displayName=b+"Provider",[O,U]}const g=()=>{const b=o.map(C=>Z.createContext(C));return function(i){const L=(i==null?void 0:i[e])||b;return Z.useMemo(()=>({[`__scope${e}`]:{...i,[e]:L}}),[i,L])}};return g.scopeName=e,[u,Bq(g,...n)]}function Bq(...e){const n=e[0];if(e.length===1)return n;const o=()=>{const u=e.map(g=>({useScope:g(),scopeName:g.scopeName}));return function(b){const C=u.reduce((i,{useScope:L,scopeName:O})=>{const q=L(b)[`__scope${O}`];return{...i,...q}},{});return Z.useMemo(()=>({[`__scope${n.scopeName}`]:C}),[C])}};return o.scopeName=n.scopeName,o}function pC(e){const[n,o]=Z.useState(void 0);return Ki(()=>{if(e){o({width:e.offsetWidth,height:e.offsetHeight});const u=new ResizeObserver(g=>{if(!Array.isArray(g)||!g.length)return;const b=g[0];let C,i;if("borderBoxSize"in b){const L=b.borderBoxSize,O=Array.isArray(L)?L[0]:L;C=O.inlineSize,i=O.blockSize}else C=e.offsetWidth,i=e.offsetHeight;o({width:C,height:i})});return u.observe(e,{box:"border-box"}),()=>u.unobserve(e)}else o(void 0)},[e]),n}var mC="Popper",[qN,cm]=Fq(mC),[Uq,HN]=qN(mC),WN=e=>{const{__scopePopper:n,children:o}=e,[u,g]=Z.useState(null);return w.jsx(Uq,{scope:n,anchor:u,onAnchorChange:g,children:o})};WN.displayName=mC;var ZN="PopperAnchor",XN=Z.forwardRef((e,n)=>{const{__scopePopper:o,virtualRef:u,...g}=e,b=HN(ZN,o),C=Z.useRef(null),i=Ln(n,C);return Z.useEffect(()=>{b.onAnchorChange((u==null?void 0:u.current)||C.current)}),u?null:w.jsx(qr.div,{...g,ref:i})});XN.displayName=ZN;var gC="PopperContent",[Vq,$q]=qN(gC),KN=Z.forwardRef((e,n)=>{var Dt,ir,zr,he,br,Ht;const{__scopePopper:o,side:u="bottom",sideOffset:g=0,align:b="center",alignOffset:C=0,arrowPadding:i=0,avoidCollisions:L=!0,collisionBoundary:O=[],collisionPadding:U=0,sticky:q="partial",hideWhenDetached:G=!1,updatePositionStrategy:ie="optimized",onPlaced:J,...K}=e,re=HN(gC,o),[Q,ee]=Z.useState(null),ue=Ln(n,jr=>ee(jr)),[fe,ge]=Z.useState(null),ke=pC(fe),Ce=(ke==null?void 0:ke.width)??0,Be=(ke==null?void 0:ke.height)??0,dt=u+(b!=="center"?"-"+b:""),Qe=typeof U=="number"?U:{top:0,right:0,bottom:0,left:0,...U},qe=Array.isArray(O)?O:[O],He=qe.length>0,et={padding:Qe,boundary:qe.filter(qq),altBoundary:He},{refs:mt,floatingStyles:Ze,placement:Tt,isPositioned:Gt,middlewareData:ct}=Mq({strategy:"fixed",placement:dt,whileElementsMounted:(...jr)=>xq(...jr,{animationFrame:ie==="always"}),elements:{reference:re.anchor},middleware:[Pq({mainAxis:g+Be,alignmentAxis:C}),L&&Rq({mainAxis:!0,crossAxis:!1,limiter:q==="partial"?kq():void 0,...et}),L&&Dq({...et}),Lq({...et,apply:({elements:jr,rects:wt,availableWidth:dn,availableHeight:rn})=>{const{width:Vn,height:wr}=wt.reference,Hr=jr.floating.style;Hr.setProperty("--radix-popper-available-width",`${dn}px`),Hr.setProperty("--radix-popper-available-height",`${rn}px`),Hr.setProperty("--radix-popper-anchor-width",`${Vn}px`),Hr.setProperty("--radix-popper-anchor-height",`${wr}px`)}}),fe&&Oq({element:fe,padding:i}),Hq({arrowWidth:Ce,arrowHeight:Be}),G&&Nq({strategy:"referenceHidden",...et})]}),[Je,rt]=QN(Tt),bt=_s(J);Ki(()=>{Gt&&(bt==null||bt())},[Gt,bt]);const kt=(Dt=ct.arrow)==null?void 0:Dt.x,At=(ir=ct.arrow)==null?void 0:ir.y,_r=((zr=ct.arrow)==null?void 0:zr.centerOffset)!==0,[cn,pr]=Z.useState();return Ki(()=>{Q&&pr(window.getComputedStyle(Q).zIndex)},[Q]),w.jsx("div",{ref:mt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ze,transform:Gt?Ze.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:cn,"--radix-popper-transform-origin":[(he=ct.transformOrigin)==null?void 0:he.x,(br=ct.transformOrigin)==null?void 0:br.y].join(" "),...((Ht=ct.hide)==null?void 0:Ht.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:w.jsx(Vq,{scope:o,placedSide:Je,onArrowChange:ge,arrowX:kt,arrowY:At,shouldHideArrow:_r,children:w.jsx(qr.div,{"data-side":Je,"data-align":rt,...K,ref:ue,style:{...K.style,animation:Gt?void 0:"none"}})})})});KN.displayName=gC;var YN="PopperArrow",Gq={top:"bottom",right:"left",bottom:"top",left:"right"},JN=Z.forwardRef(function(n,o){const{__scopePopper:u,...g}=n,b=$q(YN,u),C=Gq[b.placedSide];return w.jsx("span",{ref:b.onArrowChange,style:{position:"absolute",left:b.arrowX,top:b.arrowY,[C]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[b.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[b.placedSide],visibility:b.shouldHideArrow?"hidden":void 0},children:w.jsx(jq,{...g,ref:o,style:{...g.style,display:"block"}})})});JN.displayName=YN;function qq(e){return e!==null}var Hq=e=>({name:"transformOrigin",options:e,fn(n){var re,Q,ee;const{placement:o,rects:u,middlewareData:g}=n,C=((re=g.arrow)==null?void 0:re.centerOffset)!==0,i=C?0:e.arrowWidth,L=C?0:e.arrowHeight,[O,U]=QN(o),q={start:"0%",center:"50%",end:"100%"}[U],G=(((Q=g.arrow)==null?void 0:Q.x)??0)+i/2,ie=(((ee=g.arrow)==null?void 0:ee.y)??0)+L/2;let J="",K="";return O==="bottom"?(J=C?q:`${G}px`,K=`${-L}px`):O==="top"?(J=C?q:`${G}px`,K=`${u.floating.height+L}px`):O==="right"?(J=`${-L}px`,K=C?q:`${ie}px`):O==="left"&&(J=`${u.floating.width+L}px`,K=C?q:`${ie}px`),{data:{x:J,y:K}}}});function QN(e){const[n,o="center"]=e.split("-");return[n,o]}var eO=WN,_C=XN,yC=KN,vC=JN,[W1,xQ]=Jo("Tooltip",[cm]),xC=cm(),tO="TooltipProvider",Wq=700,gk="tooltip.open",[Zq,rO]=W1(tO),nO=e=>{const{__scopeTooltip:n,delayDuration:o=Wq,skipDelayDuration:u=300,disableHoverableContent:g=!1,children:b}=e,[C,i]=Z.useState(!0),L=Z.useRef(!1),O=Z.useRef(0);return Z.useEffect(()=>{const U=O.current;return()=>window.clearTimeout(U)},[]),w.jsx(Zq,{scope:n,isOpenDelayed:C,delayDuration:o,onOpen:Z.useCallback(()=>{window.clearTimeout(O.current),i(!1)},[]),onClose:Z.useCallback(()=>{window.clearTimeout(O.current),O.current=window.setTimeout(()=>i(!0),u)},[u]),isPointerInTransitRef:L,onPointerInTransitChange:Z.useCallback(U=>{L.current=U},[]),disableHoverableContent:g,children:b})};nO.displayName=tO;var iO="Tooltip",[bQ,Z1]=W1(iO),kT="TooltipTrigger",Xq=Z.forwardRef((e,n)=>{const{__scopeTooltip:o,...u}=e,g=Z1(kT,o),b=rO(kT,o),C=xC(o),i=Z.useRef(null),L=Ln(n,i,g.onTriggerChange),O=Z.useRef(!1),U=Z.useRef(!1),q=Z.useCallback(()=>O.current=!1,[]);return Z.useEffect(()=>()=>document.removeEventListener("pointerup",q),[q]),w.jsx(_C,{asChild:!0,...C,children:w.jsx(qr.button,{"aria-describedby":g.open?g.contentId:void 0,"data-state":g.stateAttribute,...u,ref:L,onPointerMove:dr(e.onPointerMove,G=>{G.pointerType!=="touch"&&!U.current&&!b.isPointerInTransitRef.current&&(g.onTriggerEnter(),U.current=!0)}),onPointerLeave:dr(e.onPointerLeave,()=>{g.onTriggerLeave(),U.current=!1}),onPointerDown:dr(e.onPointerDown,()=>{O.current=!0,document.addEventListener("pointerup",q,{once:!0})}),onFocus:dr(e.onFocus,()=>{O.current||g.onOpen()}),onBlur:dr(e.onBlur,g.onClose),onClick:dr(e.onClick,g.onClose)})})});Xq.displayName=kT;var Kq="TooltipPortal",[wQ,Yq]=W1(Kq,{forceMount:void 0}),em="TooltipContent",sO=Z.forwardRef((e,n)=>{const o=Yq(em,e.__scopeTooltip),{forceMount:u=o.forceMount,side:g="top",...b}=e,C=Z1(em,e.__scopeTooltip);return w.jsx(rl,{present:u||C.open,children:C.disableHoverableContent?w.jsx(oO,{side:g,...b,ref:n}):w.jsx(Jq,{side:g,...b,ref:n})})}),Jq=Z.forwardRef((e,n)=>{const o=Z1(em,e.__scopeTooltip),u=rO(em,e.__scopeTooltip),g=Z.useRef(null),b=Ln(n,g),[C,i]=Z.useState(null),{trigger:L,onClose:O}=o,U=g.current,{onPointerInTransitChange:q}=u,G=Z.useCallback(()=>{i(null),q(!1)},[q]),ie=Z.useCallback((J,K)=>{const re=J.currentTarget,Q={x:J.clientX,y:J.clientY},ee=r7(Q,re.getBoundingClientRect()),ue=n7(Q,ee),fe=i7(K.getBoundingClientRect()),ge=o7([...ue,...fe]);i(ge),q(!0)},[q]);return Z.useEffect(()=>()=>G(),[G]),Z.useEffect(()=>{if(L&&U){const J=re=>ie(re,U),K=re=>ie(re,L);return L.addEventListener("pointerleave",J),U.addEventListener("pointerleave",K),()=>{L.removeEventListener("pointerleave",J),U.removeEventListener("pointerleave",K)}}},[L,U,ie,G]),Z.useEffect(()=>{if(C){const J=K=>{const re=K.target,Q={x:K.clientX,y:K.clientY},ee=(L==null?void 0:L.contains(re))||(U==null?void 0:U.contains(re)),ue=!s7(Q,C);ee?G():ue&&(G(),O())};return document.addEventListener("pointermove",J),()=>document.removeEventListener("pointermove",J)}},[L,U,C,O,G]),w.jsx(oO,{...e,ref:b})}),[Qq,e7]=W1(iO,{isInside:!1}),oO=Z.forwardRef((e,n)=>{const{__scopeTooltip:o,children:u,"aria-label":g,onEscapeKeyDown:b,onPointerDownOutside:C,...i}=e,L=Z1(em,o),O=xC(o),{onClose:U}=L;return Z.useEffect(()=>(document.addEventListener(gk,U),()=>document.removeEventListener(gk,U)),[U]),Z.useEffect(()=>{if(L.trigger){const q=G=>{const ie=G.target;ie!=null&&ie.contains(L.trigger)&&U()};return window.addEventListener("scroll",q,{capture:!0}),()=>window.removeEventListener("scroll",q,{capture:!0})}},[L.trigger,U]),w.jsx(sm,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:b,onPointerDownOutside:C,onFocusOutside:q=>q.preventDefault(),onDismiss:U,children:w.jsxs(yC,{"data-state":L.stateAttribute,...O,...i,ref:n,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[w.jsx(WL,{children:u}),w.jsx(Qq,{scope:o,isInside:!0,children:w.jsx(O8,{id:L.contentId,role:"tooltip",children:g||u})})]})})});sO.displayName=em;var aO="TooltipArrow",t7=Z.forwardRef((e,n)=>{const{__scopeTooltip:o,...u}=e,g=xC(o);return e7(aO,o).isInside?null:w.jsx(vC,{...g,...u,ref:n})});t7.displayName=aO;function r7(e,n){const o=Math.abs(n.top-e.y),u=Math.abs(n.bottom-e.y),g=Math.abs(n.right-e.x),b=Math.abs(n.left-e.x);switch(Math.min(o,u,g,b)){case b:return"left";case g:return"right";case o:return"top";case u:return"bottom";default:throw new Error("unreachable")}}function n7(e,n,o=5){const u=[];switch(n){case"top":u.push({x:e.x-o,y:e.y+o},{x:e.x+o,y:e.y+o});break;case"bottom":u.push({x:e.x-o,y:e.y-o},{x:e.x+o,y:e.y-o});break;case"left":u.push({x:e.x+o,y:e.y-o},{x:e.x+o,y:e.y+o});break;case"right":u.push({x:e.x-o,y:e.y-o},{x:e.x-o,y:e.y+o});break}return u}function i7(e){const{top:n,right:o,bottom:u,left:g}=e;return[{x:g,y:n},{x:o,y:n},{x:o,y:u},{x:g,y:u}]}function s7(e,n){const{x:o,y:u}=e;let g=!1;for(let b=0,C=n.length-1;b<n.length;C=b++){const i=n[b].x,L=n[b].y,O=n[C].x,U=n[C].y;L>u!=U>u&&o<(O-i)*(u-L)/(U-L)+i&&(g=!g)}return g}function o7(e){const n=e.slice();return n.sort((o,u)=>o.x<u.x?-1:o.x>u.x?1:o.y<u.y?-1:o.y>u.y?1:0),a7(n)}function a7(e){if(e.length<=1)return e.slice();const n=[];for(let u=0;u<e.length;u++){const g=e[u];for(;n.length>=2;){const b=n[n.length-1],C=n[n.length-2];if((b.x-C.x)*(g.y-C.y)>=(b.y-C.y)*(g.x-C.x))n.pop();else break}n.push(g)}n.pop();const o=[];for(let u=e.length-1;u>=0;u--){const g=e[u];for(;o.length>=2;){const b=o[o.length-1],C=o[o.length-2];if((b.x-C.x)*(g.y-C.y)>=(b.y-C.y)*(g.x-C.x))o.pop();else break}o.push(g)}return o.pop(),n.length===1&&o.length===1&&n[0].x===o[0].x&&n[0].y===o[0].y?n:n.concat(o)}var l7=nO,lO=sO;const c7=l7,u7=Z.forwardRef(({className:e,sideOffset:n=4,...o},u)=>w.jsx(lO,{ref:u,sideOffset:n,className:Rr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o}));u7.displayName=lO.displayName;var X1=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},K1=typeof window>"u"||"Deno"in globalThis;function $a(){}function d7(e,n){return typeof e=="function"?e(n):e}function h7(e){return typeof e=="number"&&e>=0&&e!==1/0}function f7(e,n){return Math.max(e+(n||0)-Date.now(),0)}function _k(e,n){return typeof e=="function"?e(n):e}function p7(e,n){return typeof e=="function"?e(n):e}function yk(e,n){const{type:o="all",exact:u,fetchStatus:g,predicate:b,queryKey:C,stale:i}=e;if(C){if(u){if(n.queryHash!==bC(C,n.options))return!1}else if(!my(n.queryKey,C))return!1}if(o!=="all"){const L=n.isActive();if(o==="active"&&!L||o==="inactive"&&L)return!1}return!(typeof i=="boolean"&&n.isStale()!==i||g&&g!==n.state.fetchStatus||b&&!b(n))}function vk(e,n){const{exact:o,status:u,predicate:g,mutationKey:b}=e;if(b){if(!n.options.mutationKey)return!1;if(o){if(py(n.options.mutationKey)!==py(b))return!1}else if(!my(n.options.mutationKey,b))return!1}return!(u&&n.state.status!==u||g&&!g(n))}function bC(e,n){return((n==null?void 0:n.queryKeyHashFn)||py)(e)}function py(e){return JSON.stringify(e,(n,o)=>DT(o)?Object.keys(o).sort().reduce((u,g)=>(u[g]=o[g],u),{}):o)}function my(e,n){return e===n?!0:typeof e!=typeof n?!1:e&&n&&typeof e=="object"&&typeof n=="object"?!Object.keys(n).some(o=>!my(e[o],n[o])):!1}function cO(e,n){if(e===n)return e;const o=xk(e)&&xk(n);if(o||DT(e)&&DT(n)){const u=o?e:Object.keys(e),g=u.length,b=o?n:Object.keys(n),C=b.length,i=o?[]:{};let L=0;for(let O=0;O<C;O++){const U=o?O:b[O];(!o&&u.includes(U)||o)&&e[U]===void 0&&n[U]===void 0?(i[U]=void 0,L++):(i[U]=cO(e[U],n[U]),i[U]===e[U]&&e[U]!==void 0&&L++)}return g===C&&L===g?e:i}return n}function xk(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function DT(e){if(!bk(e))return!1;const n=e.constructor;if(n===void 0)return!0;const o=n.prototype;return!(!bk(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function bk(e){return Object.prototype.toString.call(e)==="[object Object]"}function m7(e){return new Promise(n=>{setTimeout(n,e)})}function g7(e,n,o){return typeof o.structuralSharing=="function"?o.structuralSharing(e,n):o.structuralSharing!==!1?cO(e,n):n}function _7(e,n,o=0){const u=[...e,n];return o&&u.length>o?u.slice(1):u}function y7(e,n,o=0){const u=[n,...e];return o&&u.length>o?u.slice(0,-1):u}var wC=Symbol();function uO(e,n){return!e.queryFn&&(n!=null&&n.initialPromise)?()=>n.initialPromise:!e.queryFn||e.queryFn===wC?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var gh,Pu,zp,T3,v7=(T3=class extends X1{constructor(){super();qn(this,gh);qn(this,Pu);qn(this,zp);gn(this,zp,n=>{if(!K1&&window.addEventListener){const o=()=>n();return window.addEventListener("visibilitychange",o,!1),()=>{window.removeEventListener("visibilitychange",o)}}})}onSubscribe(){qt(this,Pu)||this.setEventListener(qt(this,zp))}onUnsubscribe(){var n;this.hasListeners()||((n=qt(this,Pu))==null||n.call(this),gn(this,Pu,void 0))}setEventListener(n){var o;gn(this,zp,n),(o=qt(this,Pu))==null||o.call(this),gn(this,Pu,n(u=>{typeof u=="boolean"?this.setFocused(u):this.onFocus()}))}setFocused(n){qt(this,gh)!==n&&(gn(this,gh,n),this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(o=>{o(n)})}isFocused(){var n;return typeof qt(this,gh)=="boolean"?qt(this,gh):((n=globalThis.document)==null?void 0:n.visibilityState)!=="hidden"}},gh=new WeakMap,Pu=new WeakMap,zp=new WeakMap,T3),dO=new v7,jp,Ru,Fp,E3,x7=(E3=class extends X1{constructor(){super();qn(this,jp,!0);qn(this,Ru);qn(this,Fp);gn(this,Fp,n=>{if(!K1&&window.addEventListener){const o=()=>n(!0),u=()=>n(!1);return window.addEventListener("online",o,!1),window.addEventListener("offline",u,!1),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",u)}}})}onSubscribe(){qt(this,Ru)||this.setEventListener(qt(this,Fp))}onUnsubscribe(){var n;this.hasListeners()||((n=qt(this,Ru))==null||n.call(this),gn(this,Ru,void 0))}setEventListener(n){var o;gn(this,Fp,n),(o=qt(this,Ru))==null||o.call(this),gn(this,Ru,n(this.setOnline.bind(this)))}setOnline(n){qt(this,jp)!==n&&(gn(this,jp,n),this.listeners.forEach(u=>{u(n)}))}isOnline(){return qt(this,jp)}},jp=new WeakMap,Ru=new WeakMap,Fp=new WeakMap,E3),l1=new x7;function b7(){let e,n;const o=new Promise((g,b)=>{e=g,n=b});o.status="pending",o.catch(()=>{});function u(g){Object.assign(o,g),delete o.resolve,delete o.reject}return o.resolve=g=>{u({status:"fulfilled",value:g}),e(g)},o.reject=g=>{u({status:"rejected",reason:g}),n(g)},o}function w7(e){return Math.min(1e3*2**e,3e4)}function hO(e){return(e??"online")==="online"?l1.isOnline():!0}var fO=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function sS(e){return e instanceof fO}function pO(e){let n=!1,o=0,u=!1,g;const b=b7(),C=K=>{var re;u||(G(new fO(K)),(re=e.abort)==null||re.call(e))},i=()=>{n=!0},L=()=>{n=!1},O=()=>dO.isFocused()&&(e.networkMode==="always"||l1.isOnline())&&e.canRun(),U=()=>hO(e.networkMode)&&e.canRun(),q=K=>{var re;u||(u=!0,(re=e.onSuccess)==null||re.call(e,K),g==null||g(),b.resolve(K))},G=K=>{var re;u||(u=!0,(re=e.onError)==null||re.call(e,K),g==null||g(),b.reject(K))},ie=()=>new Promise(K=>{var re;g=Q=>{(u||O())&&K(Q)},(re=e.onPause)==null||re.call(e)}).then(()=>{var K;g=void 0,u||(K=e.onContinue)==null||K.call(e)}),J=()=>{if(u)return;let K;const re=o===0?e.initialPromise:void 0;try{K=re??e.fn()}catch(Q){K=Promise.reject(Q)}Promise.resolve(K).then(q).catch(Q=>{var ke;if(u)return;const ee=e.retry??(K1?0:3),ue=e.retryDelay??w7,fe=typeof ue=="function"?ue(o,Q):ue,ge=ee===!0||typeof ee=="number"&&o<ee||typeof ee=="function"&&ee(o,Q);if(n||!ge){G(Q);return}o++,(ke=e.onFail)==null||ke.call(e,o,Q),m7(fe).then(()=>O()?void 0:ie()).then(()=>{n?G(Q):J()})})};return{promise:b,cancel:C,continue:()=>(g==null||g(),b),cancelRetry:i,continueRetry:L,canStart:U,start:()=>(U()?J():ie().then(J),b)}}function S7(){let e=[],n=0,o=i=>{i()},u=i=>{i()},g=i=>setTimeout(i,0);const b=i=>{n?e.push(i):g(()=>{o(i)})},C=()=>{const i=e;e=[],i.length&&g(()=>{u(()=>{i.forEach(L=>{o(L)})})})};return{batch:i=>{let L;n++;try{L=i()}finally{n--,n||C()}return L},batchCalls:i=>(...L)=>{b(()=>{i(...L)})},schedule:b,setNotifyFunction:i=>{o=i},setBatchNotifyFunction:i=>{u=i},setScheduler:i=>{g=i}}}var ro=S7(),_h,C3,mO=(C3=class{constructor(){qn(this,_h)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),h7(this.gcTime)&&gn(this,_h,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(K1?1/0:5*60*1e3))}clearGcTimeout(){qt(this,_h)&&(clearTimeout(qt(this,_h)),gn(this,_h,void 0))}},_h=new WeakMap,C3),Bp,Up,la,Bs,Cy,yh,Ga,nc,A3,T7=(A3=class extends mO{constructor(n){super();qn(this,Ga);qn(this,Bp);qn(this,Up);qn(this,la);qn(this,Bs);qn(this,Cy);qn(this,yh);gn(this,yh,!1),gn(this,Cy,n.defaultOptions),this.setOptions(n.options),this.observers=[],gn(this,la,n.cache),this.queryKey=n.queryKey,this.queryHash=n.queryHash,gn(this,Bp,C7(this.options)),this.state=n.state??qt(this,Bp),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var n;return(n=qt(this,Bs))==null?void 0:n.promise}setOptions(n){this.options={...qt(this,Cy),...n},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&qt(this,la).remove(this)}setData(n,o){const u=g7(this.state.data,n,this.options);return zs(this,Ga,nc).call(this,{data:u,type:"success",dataUpdatedAt:o==null?void 0:o.updatedAt,manual:o==null?void 0:o.manual}),u}setState(n,o){zs(this,Ga,nc).call(this,{type:"setState",state:n,setStateOptions:o})}cancel(n){var u,g;const o=(u=qt(this,Bs))==null?void 0:u.promise;return(g=qt(this,Bs))==null||g.cancel(n),o?o.then($a).catch($a):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qt(this,Bp))}isActive(){return this.observers.some(n=>p7(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===wC||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(n=0){return this.state.isInvalidated||this.state.data===void 0||!f7(this.state.dataUpdatedAt,n)}onFocus(){var o;const n=this.observers.find(u=>u.shouldFetchOnWindowFocus());n==null||n.refetch({cancelRefetch:!1}),(o=qt(this,Bs))==null||o.continue()}onOnline(){var o;const n=this.observers.find(u=>u.shouldFetchOnReconnect());n==null||n.refetch({cancelRefetch:!1}),(o=qt(this,Bs))==null||o.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),qt(this,la).notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(o=>o!==n),this.observers.length||(qt(this,Bs)&&(qt(this,yh)?qt(this,Bs).cancel({revert:!0}):qt(this,Bs).cancelRetry()),this.scheduleGc()),qt(this,la).notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||zs(this,Ga,nc).call(this,{type:"invalidate"})}fetch(n,o){var L,O,U;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(o!=null&&o.cancelRefetch))this.cancel({silent:!0});else if(qt(this,Bs))return qt(this,Bs).continueRetry(),qt(this,Bs).promise}if(n&&this.setOptions(n),!this.options.queryFn){const q=this.observers.find(G=>G.options.queryFn);q&&this.setOptions(q.options)}const u=new AbortController,g=q=>{Object.defineProperty(q,"signal",{enumerable:!0,get:()=>(gn(this,yh,!0),u.signal)})},b=()=>{const q=uO(this.options,o),G={queryKey:this.queryKey,meta:this.meta};return g(G),gn(this,yh,!1),this.options.persister?this.options.persister(q,G,this):q(G)},C={fetchOptions:o,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:b};g(C),(L=this.options.behavior)==null||L.onFetch(C,this),gn(this,Up,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((O=C.fetchOptions)==null?void 0:O.meta))&&zs(this,Ga,nc).call(this,{type:"fetch",meta:(U=C.fetchOptions)==null?void 0:U.meta});const i=q=>{var G,ie,J,K;sS(q)&&q.silent||zs(this,Ga,nc).call(this,{type:"error",error:q}),sS(q)||((ie=(G=qt(this,la).config).onError)==null||ie.call(G,q,this),(K=(J=qt(this,la).config).onSettled)==null||K.call(J,this.state.data,q,this)),this.scheduleGc()};return gn(this,Bs,pO({initialPromise:o==null?void 0:o.initialPromise,fn:C.fetchFn,abort:u.abort.bind(u),onSuccess:q=>{var G,ie,J,K;if(q===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(q)}catch(re){i(re);return}(ie=(G=qt(this,la).config).onSuccess)==null||ie.call(G,q,this),(K=(J=qt(this,la).config).onSettled)==null||K.call(J,q,this.state.error,this),this.scheduleGc()},onError:i,onFail:(q,G)=>{zs(this,Ga,nc).call(this,{type:"failed",failureCount:q,error:G})},onPause:()=>{zs(this,Ga,nc).call(this,{type:"pause"})},onContinue:()=>{zs(this,Ga,nc).call(this,{type:"continue"})},retry:C.options.retry,retryDelay:C.options.retryDelay,networkMode:C.options.networkMode,canRun:()=>!0})),qt(this,Bs).start()}},Bp=new WeakMap,Up=new WeakMap,la=new WeakMap,Bs=new WeakMap,Cy=new WeakMap,yh=new WeakMap,Ga=new WeakSet,nc=function(n){const o=u=>{switch(n.type){case"failed":return{...u,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...u,fetchStatus:"paused"};case"continue":return{...u,fetchStatus:"fetching"};case"fetch":return{...u,...E7(u.data,this.options),fetchMeta:n.meta??null};case"success":return{...u,data:n.data,dataUpdateCount:u.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const g=n.error;return sS(g)&&g.revert&&qt(this,Up)?{...qt(this,Up),fetchStatus:"idle"}:{...u,error:g,errorUpdateCount:u.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:u.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...u,isInvalidated:!0};case"setState":return{...u,...n.state}}};this.state=o(this.state),ro.batch(()=>{this.observers.forEach(u=>{u.onQueryUpdate()}),qt(this,la).notify({query:this,type:"updated",action:n})})},A3);function E7(e,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:hO(n.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function C7(e){const n=typeof e.initialData=="function"?e.initialData():e.initialData,o=n!==void 0,u=o?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:o?u??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var Cl,M3,A7=(M3=class extends X1{constructor(n={}){super();qn(this,Cl);this.config=n,gn(this,Cl,new Map)}build(n,o,u){const g=o.queryKey,b=o.queryHash??bC(g,o);let C=this.get(b);return C||(C=new T7({cache:this,queryKey:g,queryHash:b,options:n.defaultQueryOptions(o),state:u,defaultOptions:n.getQueryDefaults(g)}),this.add(C)),C}add(n){qt(this,Cl).has(n.queryHash)||(qt(this,Cl).set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const o=qt(this,Cl).get(n.queryHash);o&&(n.destroy(),o===n&&qt(this,Cl).delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){ro.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return qt(this,Cl).get(n)}getAll(){return[...qt(this,Cl).values()]}find(n){const o={exact:!0,...n};return this.getAll().find(u=>yk(o,u))}findAll(n={}){const o=this.getAll();return Object.keys(n).length>0?o.filter(u=>yk(n,u)):o}notify(n){ro.batch(()=>{this.listeners.forEach(o=>{o(n)})})}onFocus(){ro.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){ro.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},Cl=new WeakMap,M3),Al,eo,vh,Ml,xu,I3,M7=(I3=class extends mO{constructor(n){super();qn(this,Ml);qn(this,Al);qn(this,eo);qn(this,vh);this.mutationId=n.mutationId,gn(this,eo,n.mutationCache),gn(this,Al,[]),this.state=n.state||I7(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){qt(this,Al).includes(n)||(qt(this,Al).push(n),this.clearGcTimeout(),qt(this,eo).notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){gn(this,Al,qt(this,Al).filter(o=>o!==n)),this.scheduleGc(),qt(this,eo).notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){qt(this,Al).length||(this.state.status==="pending"?this.scheduleGc():qt(this,eo).remove(this))}continue(){var n;return((n=qt(this,vh))==null?void 0:n.continue())??this.execute(this.state.variables)}async execute(n){var g,b,C,i,L,O,U,q,G,ie,J,K,re,Q,ee,ue,fe,ge,ke,Ce;gn(this,vh,pO({fn:()=>this.options.mutationFn?this.options.mutationFn(n):Promise.reject(new Error("No mutationFn found")),onFail:(Be,dt)=>{zs(this,Ml,xu).call(this,{type:"failed",failureCount:Be,error:dt})},onPause:()=>{zs(this,Ml,xu).call(this,{type:"pause"})},onContinue:()=>{zs(this,Ml,xu).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>qt(this,eo).canRun(this)}));const o=this.state.status==="pending",u=!qt(this,vh).canStart();try{if(!o){zs(this,Ml,xu).call(this,{type:"pending",variables:n,isPaused:u}),await((b=(g=qt(this,eo).config).onMutate)==null?void 0:b.call(g,n,this));const dt=await((i=(C=this.options).onMutate)==null?void 0:i.call(C,n));dt!==this.state.context&&zs(this,Ml,xu).call(this,{type:"pending",context:dt,variables:n,isPaused:u})}const Be=await qt(this,vh).start();return await((O=(L=qt(this,eo).config).onSuccess)==null?void 0:O.call(L,Be,n,this.state.context,this)),await((q=(U=this.options).onSuccess)==null?void 0:q.call(U,Be,n,this.state.context)),await((ie=(G=qt(this,eo).config).onSettled)==null?void 0:ie.call(G,Be,null,this.state.variables,this.state.context,this)),await((K=(J=this.options).onSettled)==null?void 0:K.call(J,Be,null,n,this.state.context)),zs(this,Ml,xu).call(this,{type:"success",data:Be}),Be}catch(Be){try{throw await((Q=(re=qt(this,eo).config).onError)==null?void 0:Q.call(re,Be,n,this.state.context,this)),await((ue=(ee=this.options).onError)==null?void 0:ue.call(ee,Be,n,this.state.context)),await((ge=(fe=qt(this,eo).config).onSettled)==null?void 0:ge.call(fe,void 0,Be,this.state.variables,this.state.context,this)),await((Ce=(ke=this.options).onSettled)==null?void 0:Ce.call(ke,void 0,Be,n,this.state.context)),Be}finally{zs(this,Ml,xu).call(this,{type:"error",error:Be})}}finally{qt(this,eo).runNext(this)}}},Al=new WeakMap,eo=new WeakMap,vh=new WeakMap,Ml=new WeakSet,xu=function(n){const o=u=>{switch(n.type){case"failed":return{...u,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...u,isPaused:!0};case"continue":return{...u,isPaused:!1};case"pending":return{...u,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...u,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...u,data:void 0,error:n.error,failureCount:u.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=o(this.state),ro.batch(()=>{qt(this,Al).forEach(u=>{u.onMutationUpdate(n)}),qt(this,eo).notify({mutation:this,type:"updated",action:n})})},I3);function I7(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Uo,Ay,P3,P7=(P3=class extends X1{constructor(n={}){super();qn(this,Uo);qn(this,Ay);this.config=n,gn(this,Uo,new Map),gn(this,Ay,Date.now())}build(n,o,u){const g=new M7({mutationCache:this,mutationId:++L0(this,Ay)._,options:n.defaultMutationOptions(o),state:u});return this.add(g),g}add(n){const o=nx(n),u=qt(this,Uo).get(o)??[];u.push(n),qt(this,Uo).set(o,u),this.notify({type:"added",mutation:n})}remove(n){var u;const o=nx(n);if(qt(this,Uo).has(o)){const g=(u=qt(this,Uo).get(o))==null?void 0:u.filter(b=>b!==n);g&&(g.length===0?qt(this,Uo).delete(o):qt(this,Uo).set(o,g))}this.notify({type:"removed",mutation:n})}canRun(n){var u;const o=(u=qt(this,Uo).get(nx(n)))==null?void 0:u.find(g=>g.state.status==="pending");return!o||o===n}runNext(n){var u;const o=(u=qt(this,Uo).get(nx(n)))==null?void 0:u.find(g=>g!==n&&g.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}clear(){ro.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}getAll(){return[...qt(this,Uo).values()].flat()}find(n){const o={exact:!0,...n};return this.getAll().find(u=>vk(o,u))}findAll(n={}){return this.getAll().filter(o=>vk(n,o))}notify(n){ro.batch(()=>{this.listeners.forEach(o=>{o(n)})})}resumePausedMutations(){const n=this.getAll().filter(o=>o.state.isPaused);return ro.batch(()=>Promise.all(n.map(o=>o.continue().catch($a))))}},Uo=new WeakMap,Ay=new WeakMap,P3);function nx(e){var n;return((n=e.options.scope)==null?void 0:n.id)??String(e.mutationId)}function wk(e){return{onFetch:(n,o)=>{var U,q,G,ie,J;const u=n.options,g=(G=(q=(U=n.fetchOptions)==null?void 0:U.meta)==null?void 0:q.fetchMore)==null?void 0:G.direction,b=((ie=n.state.data)==null?void 0:ie.pages)||[],C=((J=n.state.data)==null?void 0:J.pageParams)||[];let i={pages:[],pageParams:[]},L=0;const O=async()=>{let K=!1;const re=ue=>{Object.defineProperty(ue,"signal",{enumerable:!0,get:()=>(n.signal.aborted?K=!0:n.signal.addEventListener("abort",()=>{K=!0}),n.signal)})},Q=uO(n.options,n.fetchOptions),ee=async(ue,fe,ge)=>{if(K)return Promise.reject();if(fe==null&&ue.pages.length)return Promise.resolve(ue);const ke={queryKey:n.queryKey,pageParam:fe,direction:ge?"backward":"forward",meta:n.options.meta};re(ke);const Ce=await Q(ke),{maxPages:Be}=n.options,dt=ge?y7:_7;return{pages:dt(ue.pages,Ce,Be),pageParams:dt(ue.pageParams,fe,Be)}};if(g&&b.length){const ue=g==="backward",fe=ue?R7:Sk,ge={pages:b,pageParams:C},ke=fe(u,ge);i=await ee(ge,ke,ue)}else{const ue=e??b.length;do{const fe=L===0?C[0]??u.initialPageParam:Sk(u,i);if(L>0&&fe==null)break;i=await ee(i,fe),L++}while(L<ue)}return i};n.options.persister?n.fetchFn=()=>{var K,re;return(re=(K=n.options).persister)==null?void 0:re.call(K,O,{queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},o)}:n.fetchFn=O}}}function Sk(e,{pages:n,pageParams:o}){const u=n.length-1;return n.length>0?e.getNextPageParam(n[u],n,o[u],o):void 0}function R7(e,{pages:n,pageParams:o}){var u;return n.length>0?(u=e.getPreviousPageParam)==null?void 0:u.call(e,n[0],n,o[0],o):void 0}var Li,ku,Du,Vp,$p,Lu,Gp,qp,R3,k7=(R3=class{constructor(e={}){qn(this,Li);qn(this,ku);qn(this,Du);qn(this,Vp);qn(this,$p);qn(this,Lu);qn(this,Gp);qn(this,qp);gn(this,Li,e.queryCache||new A7),gn(this,ku,e.mutationCache||new P7),gn(this,Du,e.defaultOptions||{}),gn(this,Vp,new Map),gn(this,$p,new Map),gn(this,Lu,0)}mount(){L0(this,Lu)._++,qt(this,Lu)===1&&(gn(this,Gp,dO.subscribe(async e=>{e&&(await this.resumePausedMutations(),qt(this,Li).onFocus())})),gn(this,qp,l1.subscribe(async e=>{e&&(await this.resumePausedMutations(),qt(this,Li).onOnline())})))}unmount(){var e,n;L0(this,Lu)._--,qt(this,Lu)===0&&((e=qt(this,Gp))==null||e.call(this),gn(this,Gp,void 0),(n=qt(this,qp))==null||n.call(this),gn(this,qp,void 0))}isFetching(e){return qt(this,Li).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return qt(this,ku).findAll({...e,status:"pending"}).length}getQueryData(e){var o;const n=this.defaultQueryOptions({queryKey:e});return(o=qt(this,Li).get(n.queryHash))==null?void 0:o.state.data}ensureQueryData(e){const n=this.getQueryData(e.queryKey);if(n===void 0)return this.fetchQuery(e);{const o=this.defaultQueryOptions(e),u=qt(this,Li).build(this,o);return e.revalidateIfStale&&u.isStaleByTime(_k(o.staleTime,u))&&this.prefetchQuery(o),Promise.resolve(n)}}getQueriesData(e){return qt(this,Li).findAll(e).map(({queryKey:n,state:o})=>{const u=o.data;return[n,u]})}setQueryData(e,n,o){const u=this.defaultQueryOptions({queryKey:e}),g=qt(this,Li).get(u.queryHash),b=g==null?void 0:g.state.data,C=d7(n,b);if(C!==void 0)return qt(this,Li).build(this,u).setData(C,{...o,manual:!0})}setQueriesData(e,n,o){return ro.batch(()=>qt(this,Li).findAll(e).map(({queryKey:u})=>[u,this.setQueryData(u,n,o)]))}getQueryState(e){var o;const n=this.defaultQueryOptions({queryKey:e});return(o=qt(this,Li).get(n.queryHash))==null?void 0:o.state}removeQueries(e){const n=qt(this,Li);ro.batch(()=>{n.findAll(e).forEach(o=>{n.remove(o)})})}resetQueries(e,n){const o=qt(this,Li),u={type:"active",...e};return ro.batch(()=>(o.findAll(e).forEach(g=>{g.reset()}),this.refetchQueries(u,n)))}cancelQueries(e={},n={}){const o={revert:!0,...n},u=ro.batch(()=>qt(this,Li).findAll(e).map(g=>g.cancel(o)));return Promise.all(u).then($a).catch($a)}invalidateQueries(e={},n={}){return ro.batch(()=>{if(qt(this,Li).findAll(e).forEach(u=>{u.invalidate()}),e.refetchType==="none")return Promise.resolve();const o={...e,type:e.refetchType??e.type??"active"};return this.refetchQueries(o,n)})}refetchQueries(e={},n){const o={...n,cancelRefetch:(n==null?void 0:n.cancelRefetch)??!0},u=ro.batch(()=>qt(this,Li).findAll(e).filter(g=>!g.isDisabled()).map(g=>{let b=g.fetch(void 0,o);return o.throwOnError||(b=b.catch($a)),g.state.fetchStatus==="paused"?Promise.resolve():b}));return Promise.all(u).then($a)}fetchQuery(e){const n=this.defaultQueryOptions(e);n.retry===void 0&&(n.retry=!1);const o=qt(this,Li).build(this,n);return o.isStaleByTime(_k(n.staleTime,o))?o.fetch(n):Promise.resolve(o.state.data)}prefetchQuery(e){return this.fetchQuery(e).then($a).catch($a)}fetchInfiniteQuery(e){return e.behavior=wk(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then($a).catch($a)}ensureInfiniteQueryData(e){return e.behavior=wk(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return l1.isOnline()?qt(this,ku).resumePausedMutations():Promise.resolve()}getQueryCache(){return qt(this,Li)}getMutationCache(){return qt(this,ku)}getDefaultOptions(){return qt(this,Du)}setDefaultOptions(e){gn(this,Du,e)}setQueryDefaults(e,n){qt(this,Vp).set(py(e),{queryKey:e,defaultOptions:n})}getQueryDefaults(e){const n=[...qt(this,Vp).values()];let o={};return n.forEach(u=>{my(e,u.queryKey)&&(o={...o,...u.defaultOptions})}),o}setMutationDefaults(e,n){qt(this,$p).set(py(e),{mutationKey:e,defaultOptions:n})}getMutationDefaults(e){const n=[...qt(this,$p).values()];let o={};return n.forEach(u=>{my(e,u.mutationKey)&&(o={...o,...u.defaultOptions})}),o}defaultQueryOptions(e){if(e._defaulted)return e;const n={...qt(this,Du).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return n.queryHash||(n.queryHash=bC(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.enabled!==!0&&n.queryFn===wC&&(n.enabled=!1),n}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...qt(this,Du).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){qt(this,Li).clear(),qt(this,ku).clear()}},Li=new WeakMap,ku=new WeakMap,Du=new WeakMap,Vp=new WeakMap,$p=new WeakMap,Lu=new WeakMap,Gp=new WeakMap,qp=new WeakMap,R3),D7=Z.createContext(void 0),L7=({client:e,children:n})=>(Z.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),w.jsx(D7.Provider,{value:e,children:n}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gy(){return gy=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(e[u]=o[u])}return e},gy.apply(this,arguments)}var zu;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(zu||(zu={}));const Tk="popstate";function N7(e){e===void 0&&(e={});function n(u,g){let{pathname:b,search:C,hash:i}=u.location;return LT("",{pathname:b,search:C,hash:i},g.state&&g.state.usr||null,g.state&&g.state.key||"default")}function o(u,g){return typeof g=="string"?g:c1(g)}return z7(n,o,null,e)}function Xi(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function gO(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function O7(){return Math.random().toString(36).substr(2,8)}function Ek(e,n){return{usr:e.state,key:e.key,idx:n}}function LT(e,n,o,u){return o===void 0&&(o=null),gy({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof n=="string"?um(n):n,{state:o,key:n&&n.key||u||O7()})}function c1(e){let{pathname:n="/",search:o="",hash:u=""}=e;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),u&&u!=="#"&&(n+=u.charAt(0)==="#"?u:"#"+u),n}function um(e){let n={};if(e){let o=e.indexOf("#");o>=0&&(n.hash=e.substr(o),e=e.substr(0,o));let u=e.indexOf("?");u>=0&&(n.search=e.substr(u),e=e.substr(0,u)),e&&(n.pathname=e)}return n}function z7(e,n,o,u){u===void 0&&(u={});let{window:g=document.defaultView,v5Compat:b=!1}=u,C=g.history,i=zu.Pop,L=null,O=U();O==null&&(O=0,C.replaceState(gy({},C.state,{idx:O}),""));function U(){return(C.state||{idx:null}).idx}function q(){i=zu.Pop;let re=U(),Q=re==null?null:re-O;O=re,L&&L({action:i,location:K.location,delta:Q})}function G(re,Q){i=zu.Push;let ee=LT(K.location,re,Q);O=U()+1;let ue=Ek(ee,O),fe=K.createHref(ee);try{C.pushState(ue,"",fe)}catch(ge){if(ge instanceof DOMException&&ge.name==="DataCloneError")throw ge;g.location.assign(fe)}b&&L&&L({action:i,location:K.location,delta:1})}function ie(re,Q){i=zu.Replace;let ee=LT(K.location,re,Q);O=U();let ue=Ek(ee,O),fe=K.createHref(ee);C.replaceState(ue,"",fe),b&&L&&L({action:i,location:K.location,delta:0})}function J(re){let Q=g.location.origin!=="null"?g.location.origin:g.location.href,ee=typeof re=="string"?re:c1(re);return ee=ee.replace(/ $/,"%20"),Xi(Q,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,Q)}let K={get action(){return i},get location(){return e(g,C)},listen(re){if(L)throw new Error("A history only accepts one active listener");return g.addEventListener(Tk,q),L=re,()=>{g.removeEventListener(Tk,q),L=null}},createHref(re){return n(g,re)},createURL:J,encodeLocation(re){let Q=J(re);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:G,replace:ie,go(re){return C.go(re)}};return K}var Ck;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Ck||(Ck={}));function j7(e,n,o){return o===void 0&&(o="/"),F7(e,n,o,!1)}function F7(e,n,o,u){let g=typeof n=="string"?um(n):n,b=SC(g.pathname||"/",o);if(b==null)return null;let C=_O(e);B7(C);let i=null;for(let L=0;i==null&&L<C.length;++L){let O=Y7(b);i=X7(C[L],O,u)}return i}function _O(e,n,o,u){n===void 0&&(n=[]),o===void 0&&(o=[]),u===void 0&&(u="");let g=(b,C,i)=>{let L={relativePath:i===void 0?b.path||"":i,caseSensitive:b.caseSensitive===!0,childrenIndex:C,route:b};L.relativePath.startsWith("/")&&(Xi(L.relativePath.startsWith(u),'Absolute route path "'+L.relativePath+'" nested under path '+('"'+u+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),L.relativePath=L.relativePath.slice(u.length));let O=Wu([u,L.relativePath]),U=o.concat(L);b.children&&b.children.length>0&&(Xi(b.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+O+'".')),_O(b.children,n,U,O)),!(b.path==null&&!b.index)&&n.push({path:O,score:W7(O,b.index),routesMeta:U})};return e.forEach((b,C)=>{var i;if(b.path===""||!((i=b.path)!=null&&i.includes("?")))g(b,C);else for(let L of yO(b.path))g(b,C,L)}),n}function yO(e){let n=e.split("/");if(n.length===0)return[];let[o,...u]=n,g=o.endsWith("?"),b=o.replace(/\?$/,"");if(u.length===0)return g?[b,""]:[b];let C=yO(u.join("/")),i=[];return i.push(...C.map(L=>L===""?b:[b,L].join("/"))),g&&i.push(...C),i.map(L=>e.startsWith("/")&&L===""?"/":L)}function B7(e){e.sort((n,o)=>n.score!==o.score?o.score-n.score:Z7(n.routesMeta.map(u=>u.childrenIndex),o.routesMeta.map(u=>u.childrenIndex)))}const U7=/^:[\w-]+$/,V7=3,$7=2,G7=1,q7=10,H7=-2,Ak=e=>e==="*";function W7(e,n){let o=e.split("/"),u=o.length;return o.some(Ak)&&(u+=H7),n&&(u+=$7),o.filter(g=>!Ak(g)).reduce((g,b)=>g+(U7.test(b)?V7:b===""?G7:q7),u)}function Z7(e,n){return e.length===n.length&&e.slice(0,-1).every((u,g)=>u===n[g])?e[e.length-1]-n[n.length-1]:0}function X7(e,n,o){let{routesMeta:u}=e,g={},b="/",C=[];for(let i=0;i<u.length;++i){let L=u[i],O=i===u.length-1,U=b==="/"?n:n.slice(b.length)||"/",q=Mk({path:L.relativePath,caseSensitive:L.caseSensitive,end:O},U),G=L.route;if(!q&&O&&o&&!u[u.length-1].route.index&&(q=Mk({path:L.relativePath,caseSensitive:L.caseSensitive,end:!1},U)),!q)return null;Object.assign(g,q.params),C.push({params:g,pathname:Wu([b,q.pathname]),pathnameBase:t9(Wu([b,q.pathnameBase])),route:G}),q.pathnameBase!=="/"&&(b=Wu([b,q.pathnameBase]))}return C}function Mk(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[o,u]=K7(e.path,e.caseSensitive,e.end),g=n.match(o);if(!g)return null;let b=g[0],C=b.replace(/(.)\/+$/,"$1"),i=g.slice(1);return{params:u.reduce((O,U,q)=>{let{paramName:G,isOptional:ie}=U;if(G==="*"){let K=i[q]||"";C=b.slice(0,b.length-K.length).replace(/(.)\/+$/,"$1")}const J=i[q];return ie&&!J?O[G]=void 0:O[G]=(J||"").replace(/%2F/g,"/"),O},{}),pathname:b,pathnameBase:C,pattern:e}}function K7(e,n,o){n===void 0&&(n=!1),o===void 0&&(o=!0),gO(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let u=[],g="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,i,L)=>(u.push({paramName:i,isOptional:L!=null}),L?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(u.push({paramName:"*"}),g+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?g+="\\/*$":e!==""&&e!=="/"&&(g+="(?:(?=\\/|$))"),[new RegExp(g,n?void 0:"i"),u]}function Y7(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return gO(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),e}}function SC(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let o=n.endsWith("/")?n.length-1:n.length,u=e.charAt(o);return u&&u!=="/"?null:e.slice(o)||"/"}function J7(e,n){n===void 0&&(n="/");let{pathname:o,search:u="",hash:g=""}=typeof e=="string"?um(e):e;return{pathname:o?o.startsWith("/")?o:Q7(o,n):n,search:r9(u),hash:n9(g)}}function Q7(e,n){let o=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(g=>{g===".."?o.length>1&&o.pop():g!=="."&&o.push(g)}),o.length>1?o.join("/"):"/"}function oS(e,n,o,u){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(u)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function e9(e){return e.filter((n,o)=>o===0||n.route.path&&n.route.path.length>0)}function vO(e,n){let o=e9(e);return n?o.map((u,g)=>g===o.length-1?u.pathname:u.pathnameBase):o.map(u=>u.pathnameBase)}function xO(e,n,o,u){u===void 0&&(u=!1);let g;typeof e=="string"?g=um(e):(g=gy({},e),Xi(!g.pathname||!g.pathname.includes("?"),oS("?","pathname","search",g)),Xi(!g.pathname||!g.pathname.includes("#"),oS("#","pathname","hash",g)),Xi(!g.search||!g.search.includes("#"),oS("#","search","hash",g)));let b=e===""||g.pathname==="",C=b?"/":g.pathname,i;if(C==null)i=o;else{let q=n.length-1;if(!u&&C.startsWith("..")){let G=C.split("/");for(;G[0]==="..";)G.shift(),q-=1;g.pathname=G.join("/")}i=q>=0?n[q]:"/"}let L=J7(g,i),O=C&&C!=="/"&&C.endsWith("/"),U=(b||C===".")&&o.endsWith("/");return!L.pathname.endsWith("/")&&(O||U)&&(L.pathname+="/"),L}const Wu=e=>e.join("/").replace(/\/\/+/g,"/"),t9=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),r9=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,n9=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function i9(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const bO=["post","put","patch","delete"];new Set(bO);const s9=["get",...bO];new Set(s9);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _y(){return _y=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(e[u]=o[u])}return e},_y.apply(this,arguments)}const TC=Z.createContext(null),o9=Z.createContext(null),Oh=Z.createContext(null),Y1=Z.createContext(null),sd=Z.createContext({outlet:null,matches:[],isDataRoute:!1}),wO=Z.createContext(null);function a9(e,n){let{relative:o}=n===void 0?{}:n;zy()||Xi(!1);let{basename:u,navigator:g}=Z.useContext(Oh),{hash:b,pathname:C,search:i}=TO(e,{relative:o}),L=C;return u!=="/"&&(L=C==="/"?u:Wu([u,C])),g.createHref({pathname:L,search:i,hash:b})}function zy(){return Z.useContext(Y1)!=null}function jy(){return zy()||Xi(!1),Z.useContext(Y1).location}function SO(e){Z.useContext(Oh).static||Z.useLayoutEffect(e)}function nl(){let{isDataRoute:e}=Z.useContext(sd);return e?b9():l9()}function l9(){zy()||Xi(!1);let e=Z.useContext(TC),{basename:n,future:o,navigator:u}=Z.useContext(Oh),{matches:g}=Z.useContext(sd),{pathname:b}=jy(),C=JSON.stringify(vO(g,o.v7_relativeSplatPath)),i=Z.useRef(!1);return SO(()=>{i.current=!0}),Z.useCallback(function(O,U){if(U===void 0&&(U={}),!i.current)return;if(typeof O=="number"){u.go(O);return}let q=xO(O,JSON.parse(C),b,U.relative==="path");e==null&&n!=="/"&&(q.pathname=q.pathname==="/"?n:Wu([n,q.pathname])),(U.replace?u.replace:u.push)(q,U.state,U)},[n,u,C,b,e])}function c9(){let{matches:e}=Z.useContext(sd),n=e[e.length-1];return n?n.params:{}}function TO(e,n){let{relative:o}=n===void 0?{}:n,{future:u}=Z.useContext(Oh),{matches:g}=Z.useContext(sd),{pathname:b}=jy(),C=JSON.stringify(vO(g,u.v7_relativeSplatPath));return Z.useMemo(()=>xO(e,JSON.parse(C),b,o==="path"),[e,C,b,o])}function u9(e,n){return d9(e,n)}function d9(e,n,o,u){zy()||Xi(!1);let{navigator:g}=Z.useContext(Oh),{matches:b}=Z.useContext(sd),C=b[b.length-1],i=C?C.params:{};C&&C.pathname;let L=C?C.pathnameBase:"/";C&&C.route;let O=jy(),U;if(n){var q;let re=typeof n=="string"?um(n):n;L==="/"||(q=re.pathname)!=null&&q.startsWith(L)||Xi(!1),U=re}else U=O;let G=U.pathname||"/",ie=G;if(L!=="/"){let re=L.replace(/^\//,"").split("/");ie="/"+G.replace(/^\//,"").split("/").slice(re.length).join("/")}let J=j7(e,{pathname:ie}),K=g9(J&&J.map(re=>Object.assign({},re,{params:Object.assign({},i,re.params),pathname:Wu([L,g.encodeLocation?g.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?L:Wu([L,g.encodeLocation?g.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),b,o,u);return n&&K?Z.createElement(Y1.Provider,{value:{location:_y({pathname:"/",search:"",hash:"",state:null,key:"default"},U),navigationType:zu.Pop}},K):K}function h9(){let e=x9(),n=i9(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),o=e instanceof Error?e.stack:null,g={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},n),o?Z.createElement("pre",{style:g},o):null,null)}const f9=Z.createElement(h9,null);class p9 extends Z.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){console.error("React Router caught the following error during render",n,o)}render(){return this.state.error!==void 0?Z.createElement(sd.Provider,{value:this.props.routeContext},Z.createElement(wO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function m9(e){let{routeContext:n,match:o,children:u}=e,g=Z.useContext(TC);return g&&g.static&&g.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(g.staticContext._deepestRenderedBoundaryId=o.route.id),Z.createElement(sd.Provider,{value:n},u)}function g9(e,n,o,u){var g;if(n===void 0&&(n=[]),o===void 0&&(o=null),u===void 0&&(u=null),e==null){var b;if(!o)return null;if(o.errors)e=o.matches;else if((b=u)!=null&&b.v7_partialHydration&&n.length===0&&!o.initialized&&o.matches.length>0)e=o.matches;else return null}let C=e,i=(g=o)==null?void 0:g.errors;if(i!=null){let U=C.findIndex(q=>q.route.id&&(i==null?void 0:i[q.route.id])!==void 0);U>=0||Xi(!1),C=C.slice(0,Math.min(C.length,U+1))}let L=!1,O=-1;if(o&&u&&u.v7_partialHydration)for(let U=0;U<C.length;U++){let q=C[U];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(O=U),q.route.id){let{loaderData:G,errors:ie}=o,J=q.route.loader&&G[q.route.id]===void 0&&(!ie||ie[q.route.id]===void 0);if(q.route.lazy||J){L=!0,O>=0?C=C.slice(0,O+1):C=[C[0]];break}}}return C.reduceRight((U,q,G)=>{let ie,J=!1,K=null,re=null;o&&(ie=i&&q.route.id?i[q.route.id]:void 0,K=q.route.errorElement||f9,L&&(O<0&&G===0?(J=!0,re=null):O===G&&(J=!0,re=q.route.hydrateFallbackElement||null)));let Q=n.concat(C.slice(0,G+1)),ee=()=>{let ue;return ie?ue=K:J?ue=re:q.route.Component?ue=Z.createElement(q.route.Component,null):q.route.element?ue=q.route.element:ue=U,Z.createElement(m9,{match:q,routeContext:{outlet:U,matches:Q,isDataRoute:o!=null},children:ue})};return o&&(q.route.ErrorBoundary||q.route.errorElement||G===0)?Z.createElement(p9,{location:o.location,revalidation:o.revalidation,component:K,error:ie,children:ee(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):ee()},null)}var EO=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(EO||{}),u1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(u1||{});function _9(e){let n=Z.useContext(TC);return n||Xi(!1),n}function y9(e){let n=Z.useContext(o9);return n||Xi(!1),n}function v9(e){let n=Z.useContext(sd);return n||Xi(!1),n}function CO(e){let n=v9(),o=n.matches[n.matches.length-1];return o.route.id||Xi(!1),o.route.id}function x9(){var e;let n=Z.useContext(wO),o=y9(u1.UseRouteError),u=CO(u1.UseRouteError);return n!==void 0?n:(e=o.errors)==null?void 0:e[u]}function b9(){let{router:e}=_9(EO.UseNavigateStable),n=CO(u1.UseNavigateStable),o=Z.useRef(!1);return SO(()=>{o.current=!0}),Z.useCallback(function(g,b){b===void 0&&(b={}),o.current&&(typeof g=="number"?e.navigate(g):e.navigate(g,_y({fromRouteId:n},b)))},[e,n])}function Di(e){Xi(!1)}function w9(e){let{basename:n="/",children:o=null,location:u,navigationType:g=zu.Pop,navigator:b,static:C=!1,future:i}=e;zy()&&Xi(!1);let L=n.replace(/^\/*/,"/"),O=Z.useMemo(()=>({basename:L,navigator:b,static:C,future:_y({v7_relativeSplatPath:!1},i)}),[L,i,b,C]);typeof u=="string"&&(u=um(u));let{pathname:U="/",search:q="",hash:G="",state:ie=null,key:J="default"}=u,K=Z.useMemo(()=>{let re=SC(U,L);return re==null?null:{location:{pathname:re,search:q,hash:G,state:ie,key:J},navigationType:g}},[L,U,q,G,ie,J,g]);return K==null?null:Z.createElement(Oh.Provider,{value:O},Z.createElement(Y1.Provider,{children:o,value:K}))}function S9(e){let{children:n,location:o}=e;return u9(NT(n),o)}new Promise(()=>{});function NT(e,n){n===void 0&&(n=[]);let o=[];return Z.Children.forEach(e,(u,g)=>{if(!Z.isValidElement(u))return;let b=[...n,g];if(u.type===Z.Fragment){o.push.apply(o,NT(u.props.children,b));return}u.type!==Di&&Xi(!1),!u.props.index||!u.props.children||Xi(!1);let C={id:u.props.id||b.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,loader:u.props.loader,action:u.props.action,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(C.children=NT(u.props.children,b)),o.push(C)}),o}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function OT(){return OT=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(e[u]=o[u])}return e},OT.apply(this,arguments)}function T9(e,n){if(e==null)return{};var o={},u=Object.keys(e),g,b;for(b=0;b<u.length;b++)g=u[b],!(n.indexOf(g)>=0)&&(o[g]=e[g]);return o}function E9(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function C9(e,n){return e.button===0&&(!n||n==="_self")&&!E9(e)}const A9=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],M9="6";try{window.__reactRouterVersion=M9}catch{}const I9="startTransition",Ik=V3[I9];function P9(e){let{basename:n,children:o,future:u,window:g}=e,b=Z.useRef();b.current==null&&(b.current=N7({window:g,v5Compat:!0}));let C=b.current,[i,L]=Z.useState({action:C.action,location:C.location}),{v7_startTransition:O}=u||{},U=Z.useCallback(q=>{O&&Ik?Ik(()=>L(q)):L(q)},[L,O]);return Z.useLayoutEffect(()=>C.listen(U),[C,U]),Z.createElement(w9,{basename:n,children:o,location:i.location,navigationType:i.action,navigator:C,future:u})}const R9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",k9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,rc=Z.forwardRef(function(n,o){let{onClick:u,relative:g,reloadDocument:b,replace:C,state:i,target:L,to:O,preventScrollReset:U,viewTransition:q}=n,G=T9(n,A9),{basename:ie}=Z.useContext(Oh),J,K=!1;if(typeof O=="string"&&k9.test(O)&&(J=O,R9))try{let ue=new URL(window.location.href),fe=O.startsWith("//")?new URL(ue.protocol+O):new URL(O),ge=SC(fe.pathname,ie);fe.origin===ue.origin&&ge!=null?O=ge+fe.search+fe.hash:K=!0}catch{}let re=a9(O,{relative:g}),Q=D9(O,{replace:C,state:i,target:L,preventScrollReset:U,relative:g,viewTransition:q});function ee(ue){u&&u(ue),ue.defaultPrevented||Q(ue)}return Z.createElement("a",OT({},G,{href:J||re,onClick:K||b?u:ee,ref:o,target:L}))});var Pk;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Pk||(Pk={}));var Rk;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Rk||(Rk={}));function D9(e,n){let{target:o,replace:u,state:g,preventScrollReset:b,relative:C,viewTransition:i}=n===void 0?{}:n,L=nl(),O=jy(),U=TO(e,{relative:C});return Z.useCallback(q=>{if(C9(q,o)){q.preventDefault();let G=u!==void 0?u:c1(O)===c1(U);L(e,{replace:G,state:g,preventScrollReset:b,relative:C,viewTransition:i})}},[O,L,U,u,g,o,e,b,C,i])}const L9="modulepreload",N9=function(e){return"/"+e},kk={},Ih=function(n,o,u){let g=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const C=document.querySelector("meta[property=csp-nonce]"),i=(C==null?void 0:C.nonce)||(C==null?void 0:C.getAttribute("nonce"));g=Promise.allSettled(o.map(L=>{if(L=N9(L),L in kk)return;kk[L]=!0;const O=L.endsWith(".css"),U=O?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${L}"]${U}`))return;const q=document.createElement("link");if(q.rel=O?"stylesheet":L9,O||(q.as="script"),q.crossOrigin="",q.href=L,i&&q.setAttribute("nonce",i),document.head.appendChild(q),O)return new Promise((G,ie)=>{q.addEventListener("load",G),q.addEventListener("error",()=>ie(new Error(`Unable to preload CSS for ${L}`)))})}))}function b(C){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=C,window.dispatchEvent(i),!i.defaultPrevented)throw C}return g.then(C=>{for(const i of C||[])i.status==="rejected"&&b(i.reason);return n().catch(b)})},O9=e=>{let n;return e?n=e:typeof fetch>"u"?n=(...o)=>Ih(async()=>{const{default:u}=await Promise.resolve().then(()=>dm);return{default:u}},void 0).then(({default:u})=>u(...o)):n=fetch,(...o)=>n(...o)};class EC extends Error{constructor(n,o="FunctionsError",u){super(n),this.name=o,this.context=u}}class z9 extends EC{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class j9 extends EC{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class F9 extends EC{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var zT;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(zT||(zT={}));var B9=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};class U9{constructor(n,{headers:o={},customFetch:u,region:g=zT.Any}={}){this.url=n,this.headers=o,this.region=g,this.fetch=O9(u)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,o={}){var u;return B9(this,void 0,void 0,function*(){try{const{headers:g,method:b,body:C}=o;let i={},{region:L}=o;L||(L=this.region),L&&L!=="any"&&(i["x-region"]=L);let O;C&&(g&&!Object.prototype.hasOwnProperty.call(g,"Content-Type")||!g)&&(typeof Blob<"u"&&C instanceof Blob||C instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",O=C):typeof C=="string"?(i["Content-Type"]="text/plain",O=C):typeof FormData<"u"&&C instanceof FormData?O=C:(i["Content-Type"]="application/json",O=JSON.stringify(C)));const U=yield this.fetch(`${this.url}/${n}`,{method:b||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),g),body:O}).catch(J=>{throw new z9(J)}),q=U.headers.get("x-relay-error");if(q&&q==="true")throw new j9(U);if(!U.ok)throw new F9(U);let G=((u=U.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),ie;return G==="application/json"?ie=yield U.json():G==="application/octet-stream"?ie=yield U.blob():G==="text/event-stream"?ie=U:G==="multipart/form-data"?ie=yield U.formData():ie=yield U.text(),{data:ie,error:null}}catch(g){return{data:null,error:g}}})}}var wo={},CC={},J1={},Fy={},Q1={},eb={},V9=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},tm=V9();const $9=tm.fetch,AO=tm.fetch.bind(tm),MO=tm.Headers,G9=tm.Request,q9=tm.Response,dm=Object.freeze(Object.defineProperty({__proto__:null,Headers:MO,Request:G9,Response:q9,default:AO,fetch:$9},Symbol.toStringTag,{value:"Module"})),H9=O6(dm);var tb={};Object.defineProperty(tb,"__esModule",{value:!0});let W9=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};tb.default=W9;var IO=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eb,"__esModule",{value:!0});const Z9=IO(H9),X9=IO(tb);let K9=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Z9.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,o){return this.headers=Object.assign({},this.headers),this.headers[n]=o,this}then(n,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const u=this.fetch;let g=u(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async b=>{var C,i,L;let O=null,U=null,q=null,G=b.status,ie=b.statusText;if(b.ok){if(this.method!=="HEAD"){const Q=await b.text();Q===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?U=Q:U=JSON.parse(Q))}const K=(C=this.headers.Prefer)===null||C===void 0?void 0:C.match(/count=(exact|planned|estimated)/),re=(i=b.headers.get("content-range"))===null||i===void 0?void 0:i.split("/");K&&re&&re.length>1&&(q=parseInt(re[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(U)&&(U.length>1?(O={code:"PGRST116",details:`Results contain ${U.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},U=null,q=null,G=406,ie="Not Acceptable"):U.length===1?U=U[0]:U=null)}else{const K=await b.text();try{O=JSON.parse(K),Array.isArray(O)&&b.status===404&&(U=[],O=null,G=200,ie="OK")}catch{b.status===404&&K===""?(G=204,ie="No Content"):O={message:K}}if(O&&this.isMaybeSingle&&(!((L=O==null?void 0:O.details)===null||L===void 0)&&L.includes("0 rows"))&&(O=null,G=200,ie="OK"),O&&this.shouldThrowOnError)throw new X9.default(O)}return{error:O,data:U,count:q,status:G,statusText:ie}});return this.shouldThrowOnError||(g=g.catch(b=>{var C,i,L;return{error:{message:`${(C=b==null?void 0:b.name)!==null&&C!==void 0?C:"FetchError"}: ${b==null?void 0:b.message}`,details:`${(i=b==null?void 0:b.stack)!==null&&i!==void 0?i:""}`,hint:"",code:`${(L=b==null?void 0:b.code)!==null&&L!==void 0?L:""}`},data:null,count:null,status:0,statusText:""}})),g.then(n,o)}returns(){return this}overrideTypes(){return this}};eb.default=K9;var Y9=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Q1,"__esModule",{value:!0});const J9=Y9(eb);let Q9=class extends J9.default{select(n){let o=!1;const u=(n??"*").split("").map(g=>/\s/.test(g)&&!o?"":(g==='"'&&(o=!o),g)).join("");return this.url.searchParams.set("select",u),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:o=!0,nullsFirst:u,foreignTable:g,referencedTable:b=g}={}){const C=b?`${b}.order`:"order",i=this.url.searchParams.get(C);return this.url.searchParams.set(C,`${i?`${i},`:""}${n}.${o?"asc":"desc"}${u===void 0?"":u?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:o,referencedTable:u=o}={}){const g=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(g,`${n}`),this}range(n,o,{foreignTable:u,referencedTable:g=u}={}){const b=typeof g>"u"?"offset":`${g}.offset`,C=typeof g>"u"?"limit":`${g}.limit`;return this.url.searchParams.set(b,`${n}`),this.url.searchParams.set(C,`${o-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:o=!1,settings:u=!1,buffers:g=!1,wal:b=!1,format:C="text"}={}){var i;const L=[n?"analyze":null,o?"verbose":null,u?"settings":null,g?"buffers":null,b?"wal":null].filter(Boolean).join("|"),O=(i=this.headers.Accept)!==null&&i!==void 0?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${C}; for="${O}"; options=${L};`,C==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Q1.default=Q9;var eH=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Fy,"__esModule",{value:!0});const tH=eH(Q1);let rH=class extends tH.default{eq(n,o){return this.url.searchParams.append(n,`eq.${o}`),this}neq(n,o){return this.url.searchParams.append(n,`neq.${o}`),this}gt(n,o){return this.url.searchParams.append(n,`gt.${o}`),this}gte(n,o){return this.url.searchParams.append(n,`gte.${o}`),this}lt(n,o){return this.url.searchParams.append(n,`lt.${o}`),this}lte(n,o){return this.url.searchParams.append(n,`lte.${o}`),this}like(n,o){return this.url.searchParams.append(n,`like.${o}`),this}likeAllOf(n,o){return this.url.searchParams.append(n,`like(all).{${o.join(",")}}`),this}likeAnyOf(n,o){return this.url.searchParams.append(n,`like(any).{${o.join(",")}}`),this}ilike(n,o){return this.url.searchParams.append(n,`ilike.${o}`),this}ilikeAllOf(n,o){return this.url.searchParams.append(n,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(n,o){return this.url.searchParams.append(n,`ilike(any).{${o.join(",")}}`),this}is(n,o){return this.url.searchParams.append(n,`is.${o}`),this}in(n,o){const u=Array.from(new Set(o)).map(g=>typeof g=="string"&&new RegExp("[,()]").test(g)?`"${g}"`:`${g}`).join(",");return this.url.searchParams.append(n,`in.(${u})`),this}contains(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cs.{${o.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(o)}`),this}containedBy(n,o){return typeof o=="string"?this.url.searchParams.append(n,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(n,`cd.{${o.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(o)}`),this}rangeGt(n,o){return this.url.searchParams.append(n,`sr.${o}`),this}rangeGte(n,o){return this.url.searchParams.append(n,`nxl.${o}`),this}rangeLt(n,o){return this.url.searchParams.append(n,`sl.${o}`),this}rangeLte(n,o){return this.url.searchParams.append(n,`nxr.${o}`),this}rangeAdjacent(n,o){return this.url.searchParams.append(n,`adj.${o}`),this}overlaps(n,o){return typeof o=="string"?this.url.searchParams.append(n,`ov.${o}`):this.url.searchParams.append(n,`ov.{${o.join(",")}}`),this}textSearch(n,o,{config:u,type:g}={}){let b="";g==="plain"?b="pl":g==="phrase"?b="ph":g==="websearch"&&(b="w");const C=u===void 0?"":`(${u})`;return this.url.searchParams.append(n,`${b}fts${C}.${o}`),this}match(n){return Object.entries(n).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(n,o,u){return this.url.searchParams.append(n,`not.${o}.${u}`),this}or(n,{foreignTable:o,referencedTable:u=o}={}){const g=u?`${u}.or`:"or";return this.url.searchParams.append(g,`(${n})`),this}filter(n,o,u){return this.url.searchParams.append(n,`${o}.${u}`),this}};Fy.default=rH;var nH=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(J1,"__esModule",{value:!0});const S_=nH(Fy);let iH=class{constructor(n,{headers:o={},schema:u,fetch:g}){this.url=n,this.headers=o,this.schema=u,this.fetch=g}select(n,{head:o=!1,count:u}={}){const g=o?"HEAD":"GET";let b=!1;const C=(n??"*").split("").map(i=>/\s/.test(i)&&!b?"":(i==='"'&&(b=!b),i)).join("");return this.url.searchParams.set("select",C),u&&(this.headers.Prefer=`count=${u}`),new S_.default({method:g,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:o,defaultToNull:u=!0}={}){const g="POST",b=[];if(this.headers.Prefer&&b.push(this.headers.Prefer),o&&b.push(`count=${o}`),u||b.push("missing=default"),this.headers.Prefer=b.join(","),Array.isArray(n)){const C=n.reduce((i,L)=>i.concat(Object.keys(L)),[]);if(C.length>0){const i=[...new Set(C)].map(L=>`"${L}"`);this.url.searchParams.set("columns",i.join(","))}}return new S_.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:o,ignoreDuplicates:u=!1,count:g,defaultToNull:b=!0}={}){const C="POST",i=[`resolution=${u?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&i.push(this.headers.Prefer),g&&i.push(`count=${g}`),b||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){const L=n.reduce((O,U)=>O.concat(Object.keys(U)),[]);if(L.length>0){const O=[...new Set(L)].map(U=>`"${U}"`);this.url.searchParams.set("columns",O.join(","))}}return new S_.default({method:C,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:o}={}){const u="PATCH",g=[];return this.headers.Prefer&&g.push(this.headers.Prefer),o&&g.push(`count=${o}`),this.headers.Prefer=g.join(","),new S_.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const o="DELETE",u=[];return n&&u.push(`count=${n}`),this.headers.Prefer&&u.unshift(this.headers.Prefer),this.headers.Prefer=u.join(","),new S_.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};J1.default=iH;var rb={},nb={};Object.defineProperty(nb,"__esModule",{value:!0});nb.version=void 0;nb.version="0.0.0-automated";Object.defineProperty(rb,"__esModule",{value:!0});rb.DEFAULT_HEADERS=void 0;const sH=nb;rb.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${sH.version}`};var PO=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(CC,"__esModule",{value:!0});const oH=PO(J1),aH=PO(Fy),lH=rb;let cH=class RO{constructor(n,{headers:o={},schema:u,fetch:g}={}){this.url=n,this.headers=Object.assign(Object.assign({},lH.DEFAULT_HEADERS),o),this.schemaName=u,this.fetch=g}from(n){const o=new URL(`${this.url}/${n}`);return new oH.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new RO(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,o={},{head:u=!1,get:g=!1,count:b}={}){let C;const i=new URL(`${this.url}/rpc/${n}`);let L;u||g?(C=u?"HEAD":"GET",Object.entries(o).filter(([U,q])=>q!==void 0).map(([U,q])=>[U,Array.isArray(q)?`{${q.join(",")}}`:`${q}`]).forEach(([U,q])=>{i.searchParams.append(U,q)})):(C="POST",L=o);const O=Object.assign({},this.headers);return b&&(O.Prefer=`count=${b}`),new aH.default({method:C,url:i,headers:O,schema:this.schemaName,body:L,fetch:this.fetch,allowEmpty:!1})}};CC.default=cH;var hm=Zo&&Zo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wo,"__esModule",{value:!0});wo.PostgrestError=wo.PostgrestBuilder=wo.PostgrestTransformBuilder=wo.PostgrestFilterBuilder=wo.PostgrestQueryBuilder=wo.PostgrestClient=void 0;const kO=hm(CC);wo.PostgrestClient=kO.default;const DO=hm(J1);wo.PostgrestQueryBuilder=DO.default;const LO=hm(Fy);wo.PostgrestFilterBuilder=LO.default;const NO=hm(Q1);wo.PostgrestTransformBuilder=NO.default;const OO=hm(eb);wo.PostgrestBuilder=OO.default;const zO=hm(tb);wo.PostgrestError=zO.default;var uH=wo.default={PostgrestClient:kO.default,PostgrestQueryBuilder:DO.default,PostgrestFilterBuilder:LO.default,PostgrestTransformBuilder:NO.default,PostgrestBuilder:OO.default,PostgrestError:zO.default};const{PostgrestClient:dH,PostgrestQueryBuilder:MQ,PostgrestFilterBuilder:IQ,PostgrestTransformBuilder:PQ,PostgrestBuilder:RQ,PostgrestError:kQ}=uH,hH="2.11.2",fH={"X-Client-Info":`realtime-js/${hH}`},pH="1.0.0",jO=1e4,mH=1e3;var Np;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Np||(Np={}));var Bo;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Bo||(Bo={}));var Ha;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Ha||(Ha={}));var jT;(function(e){e.websocket="websocket"})(jT||(jT={}));var lh;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(lh||(lh={}));class gH{constructor(){this.HEADER_LENGTH=1}decode(n,o){return n.constructor===ArrayBuffer?o(this._binaryDecode(n)):o(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){const o=new DataView(n),u=new TextDecoder;return this._decodeBroadcast(n,o,u)}_decodeBroadcast(n,o,u){const g=o.getUint8(1),b=o.getUint8(2);let C=this.HEADER_LENGTH+2;const i=u.decode(n.slice(C,C+g));C=C+g;const L=u.decode(n.slice(C,C+b));C=C+b;const O=JSON.parse(u.decode(n.slice(C,n.byteLength)));return{ref:null,topic:i,event:L,payload:O}}}class FO{constructor(n,o){this.callback=n,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ri;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(ri||(ri={}));const Dk=(e,n,o={})=>{var u;const g=(u=o.skipTypes)!==null&&u!==void 0?u:[];return Object.keys(n).reduce((b,C)=>(b[C]=_H(C,e,n,g),b),{})},_H=(e,n,o,u)=>{const g=n.find(i=>i.name===e),b=g==null?void 0:g.type,C=o[e];return b&&!u.includes(b)?BO(b,C):FT(C)},BO=(e,n)=>{if(e.charAt(0)==="_"){const o=e.slice(1,e.length);return bH(n,o)}switch(e){case ri.bool:return yH(n);case ri.float4:case ri.float8:case ri.int2:case ri.int4:case ri.int8:case ri.numeric:case ri.oid:return vH(n);case ri.json:case ri.jsonb:return xH(n);case ri.timestamp:return wH(n);case ri.abstime:case ri.date:case ri.daterange:case ri.int4range:case ri.int8range:case ri.money:case ri.reltime:case ri.text:case ri.time:case ri.timestamptz:case ri.timetz:case ri.tsrange:case ri.tstzrange:return FT(n);default:return FT(n)}},FT=e=>e,yH=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},vH=e=>{if(typeof e=="string"){const n=parseFloat(e);if(!Number.isNaN(n))return n}return e},xH=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(n){return console.log(`JSON parse error: ${n}`),e}return e},bH=(e,n)=>{if(typeof e!="string")return e;const o=e.length-1,u=e[o];if(e[0]==="{"&&u==="}"){let b;const C=e.slice(1,o);try{b=JSON.parse("["+C+"]")}catch{b=C?C.split(","):[]}return b.map(i=>BO(n,i))}return e},wH=e=>typeof e=="string"?e.replace(" ","T"):e,UO=e=>{let n=e;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};class aS{constructor(n,o,u={},g=jO){this.channel=n,this.event=o,this.payload=u,this.timeout=g,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,o){var u;return this._hasReceived(n)&&o((u=this.receivedResp)===null||u===void 0?void 0:u.response),this.recHooks.push({status:n,callback:o}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=o=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=o,this._matchReceive(o)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,o){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:o}){this.recHooks.filter(u=>u.status===n).forEach(u=>u.callback(o))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var Lk;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Lk||(Lk={}));class q_{constructor(n,o){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const u=(o==null?void 0:o.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(u.state,{},g=>{const{onJoin:b,onLeave:C,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=q_.syncState(this.state,g,b,C),this.pendingDiffs.forEach(L=>{this.state=q_.syncDiff(this.state,L,b,C)}),this.pendingDiffs=[],i()}),this.channel._on(u.diff,{},g=>{const{onJoin:b,onLeave:C,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(g):(this.state=q_.syncDiff(this.state,g,b,C),i())}),this.onJoin((g,b,C)=>{this.channel._trigger("presence",{event:"join",key:g,currentPresences:b,newPresences:C})}),this.onLeave((g,b,C)=>{this.channel._trigger("presence",{event:"leave",key:g,currentPresences:b,leftPresences:C})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,o,u,g){const b=this.cloneDeep(n),C=this.transformState(o),i={},L={};return this.map(b,(O,U)=>{C[O]||(L[O]=U)}),this.map(C,(O,U)=>{const q=b[O];if(q){const G=U.map(re=>re.presence_ref),ie=q.map(re=>re.presence_ref),J=U.filter(re=>ie.indexOf(re.presence_ref)<0),K=q.filter(re=>G.indexOf(re.presence_ref)<0);J.length>0&&(i[O]=J),K.length>0&&(L[O]=K)}else i[O]=U}),this.syncDiff(b,{joins:i,leaves:L},u,g)}static syncDiff(n,o,u,g){const{joins:b,leaves:C}={joins:this.transformState(o.joins),leaves:this.transformState(o.leaves)};return u||(u=()=>{}),g||(g=()=>{}),this.map(b,(i,L)=>{var O;const U=(O=n[i])!==null&&O!==void 0?O:[];if(n[i]=this.cloneDeep(L),U.length>0){const q=n[i].map(ie=>ie.presence_ref),G=U.filter(ie=>q.indexOf(ie.presence_ref)<0);n[i].unshift(...G)}u(i,U,L)}),this.map(C,(i,L)=>{let O=n[i];if(!O)return;const U=L.map(q=>q.presence_ref);O=O.filter(q=>U.indexOf(q.presence_ref)<0),n[i]=O,g(i,O,L),O.length===0&&delete n[i]}),n}static map(n,o){return Object.getOwnPropertyNames(n).map(u=>o(u,n[u]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((o,u)=>{const g=n[u];return"metas"in g?o[u]=g.metas.map(b=>(b.presence_ref=b.phx_ref,delete b.phx_ref,delete b.phx_ref_prev,b)):o[u]=g,o},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Nk;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Nk||(Nk={}));var Ok;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Ok||(Ok={}));var sc;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(sc||(sc={}));class AC{constructor(n,o={config:{}},u){this.topic=n,this.params=o,this.socket=u,this.bindings={},this.state=Bo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},o.config),this.timeout=this.socket.timeout,this.joinPush=new aS(this,Ha.join,this.params,this.timeout),this.rejoinTimer=new FO(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(g=>g.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bo.closed,this.socket._remove(this)}),this._onError(g=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,g),this.state=Bo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ha.reply,{},(g,b)=>{this._trigger(this._replyEventName(b),g)}),this.presence=new q_(this),this.broadcastEndpointURL=UO(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,o=this.timeout){var u,g;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:b,presence:C,private:i}}=this.params;this._onError(U=>n==null?void 0:n(sc.CHANNEL_ERROR,U)),this._onClose(()=>n==null?void 0:n(sc.CLOSED));const L={},O={broadcast:b,presence:C,postgres_changes:(g=(u=this.bindings.postgres_changes)===null||u===void 0?void 0:u.map(U=>U.filter))!==null&&g!==void 0?g:[],private:i};this.socket.accessTokenValue&&(L.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:O},L)),this.joinedOnce=!0,this._rejoin(o),this.joinPush.receive("ok",async({postgres_changes:U})=>{var q;if(this.socket.setAuth(),U===void 0){n==null||n(sc.SUBSCRIBED);return}else{const G=this.bindings.postgres_changes,ie=(q=G==null?void 0:G.length)!==null&&q!==void 0?q:0,J=[];for(let K=0;K<ie;K++){const re=G[K],{filter:{event:Q,schema:ee,table:ue,filter:fe}}=re,ge=U&&U[K];if(ge&&ge.event===Q&&ge.schema===ee&&ge.table===ue&&ge.filter===fe)J.push(Object.assign(Object.assign({},re),{id:ge.id}));else{this.unsubscribe(),n==null||n(sc.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=J,n&&n(sc.SUBSCRIBED);return}}).receive("error",U=>{n==null||n(sc.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(U).join(", ")||"error")))}).receive("timeout",()=>{n==null||n(sc.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,o={}){return await this.send({type:"presence",event:"track",payload:n},o.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,o,u){return this._on(n,o,u)}async send(n,o={}){var u,g;if(!this._canPush()&&n.type==="broadcast"){const{event:b,payload:C}=n,L={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:b,payload:C,private:this.private}]})};try{const O=await this._fetchWithTimeout(this.broadcastEndpointURL,L,(u=o.timeout)!==null&&u!==void 0?u:this.timeout);return await((g=O.body)===null||g===void 0?void 0:g.cancel()),O.ok?"ok":"error"}catch(O){return O.name==="AbortError"?"timed out":"error"}}else return new Promise(b=>{var C,i,L;const O=this._push(n.type,n,o.timeout||this.timeout);n.type==="broadcast"&&!(!((L=(i=(C=this.params)===null||C===void 0?void 0:C.config)===null||i===void 0?void 0:i.broadcast)===null||L===void 0)&&L.ack)&&b("ok"),O.receive("ok",()=>b("ok")),O.receive("error",()=>b("error")),O.receive("timeout",()=>b("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Bo.leaving;const o=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ha.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(u=>{const g=new aS(this,Ha.leave,{},n);g.receive("ok",()=>{o(),u("ok")}).receive("timeout",()=>{o(),u("timed out")}).receive("error",()=>{u("error")}),g.send(),this._canPush()||g.trigger("ok",{})})}async _fetchWithTimeout(n,o,u){const g=new AbortController,b=setTimeout(()=>g.abort(),u),C=await this.socket.fetch(n,Object.assign(Object.assign({},o),{signal:g.signal}));return clearTimeout(b),C}_push(n,o,u=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let g=new aS(this,n,o,u);return this._canPush()?g.send():(g.startTimeout(),this.pushBuffer.push(g)),g}_onMessage(n,o,u){return o}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,o,u){var g,b;const C=n.toLocaleLowerCase(),{close:i,error:L,leave:O,join:U}=Ha;if(u&&[i,L,O,U].indexOf(C)>=0&&u!==this._joinRef())return;let G=this._onMessage(C,o,u);if(o&&!G)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(C)?(g=this.bindings.postgres_changes)===null||g===void 0||g.filter(ie=>{var J,K,re;return((J=ie.filter)===null||J===void 0?void 0:J.event)==="*"||((re=(K=ie.filter)===null||K===void 0?void 0:K.event)===null||re===void 0?void 0:re.toLocaleLowerCase())===C}).map(ie=>ie.callback(G,u)):(b=this.bindings[C])===null||b===void 0||b.filter(ie=>{var J,K,re,Q,ee,ue;if(["broadcast","presence","postgres_changes"].includes(C))if("id"in ie){const fe=ie.id,ge=(J=ie.filter)===null||J===void 0?void 0:J.event;return fe&&((K=o.ids)===null||K===void 0?void 0:K.includes(fe))&&(ge==="*"||(ge==null?void 0:ge.toLocaleLowerCase())===((re=o.data)===null||re===void 0?void 0:re.type.toLocaleLowerCase()))}else{const fe=(ee=(Q=ie==null?void 0:ie.filter)===null||Q===void 0?void 0:Q.event)===null||ee===void 0?void 0:ee.toLocaleLowerCase();return fe==="*"||fe===((ue=o==null?void 0:o.event)===null||ue===void 0?void 0:ue.toLocaleLowerCase())}else return ie.type.toLocaleLowerCase()===C}).map(ie=>{if(typeof G=="object"&&"ids"in G){const J=G.data,{schema:K,table:re,commit_timestamp:Q,type:ee,errors:ue}=J;G=Object.assign(Object.assign({},{schema:K,table:re,commit_timestamp:Q,eventType:ee,new:{},old:{},errors:ue}),this._getPayloadRecords(J))}ie.callback(G,u)})}_isClosed(){return this.state===Bo.closed}_isJoined(){return this.state===Bo.joined}_isJoining(){return this.state===Bo.joining}_isLeaving(){return this.state===Bo.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,o,u){const g=n.toLocaleLowerCase(),b={type:g,filter:o,callback:u};return this.bindings[g]?this.bindings[g].push(b):this.bindings[g]=[b],this}_off(n,o){const u=n.toLocaleLowerCase();return this.bindings[u]=this.bindings[u].filter(g=>{var b;return!(((b=g.type)===null||b===void 0?void 0:b.toLocaleLowerCase())===u&&AC.isEqual(g.filter,o))}),this}static isEqual(n,o){if(Object.keys(n).length!==Object.keys(o).length)return!1;for(const u in n)if(n[u]!==o[u])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Ha.close,{},n)}_onError(n){this._on(Ha.error,{},o=>n(o))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bo.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const o={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(o.new=Dk(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(o.old=Dk(n.columns,n.old_record)),o}}const SH=()=>{},TH=typeof WebSocket<"u",EH=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class CH{constructor(n,o){var u;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=fH,this.params={},this.timeout=jO,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=SH,this.conn=null,this.sendBuffer=[],this.serializer=new gH,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=b=>{let C;return b?C=b:typeof fetch>"u"?C=(...i)=>Ih(async()=>{const{default:L}=await Promise.resolve().then(()=>dm);return{default:L}},void 0).then(({default:L})=>L(...i)):C=fetch,(...i)=>C(...i)},this.endPoint=`${n}/${jT.websocket}`,this.httpEndpoint=UO(n),o!=null&&o.transport?this.transport=o.transport:this.transport=null,o!=null&&o.params&&(this.params=o.params),o!=null&&o.headers&&(this.headers=Object.assign(Object.assign({},this.headers),o.headers)),o!=null&&o.timeout&&(this.timeout=o.timeout),o!=null&&o.logger&&(this.logger=o.logger),o!=null&&o.heartbeatIntervalMs&&(this.heartbeatIntervalMs=o.heartbeatIntervalMs);const g=(u=o==null?void 0:o.params)===null||u===void 0?void 0:u.apikey;if(g&&(this.accessTokenValue=g,this.apiKey=g),this.reconnectAfterMs=o!=null&&o.reconnectAfterMs?o.reconnectAfterMs:b=>[1e3,2e3,5e3,1e4][b-1]||1e4,this.encode=o!=null&&o.encode?o.encode:(b,C)=>C(JSON.stringify(b)),this.decode=o!=null&&o.decode?o.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new FO(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(o==null?void 0:o.fetch),o!=null&&o.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(o==null?void 0:o.worker)||!1,this.workerUrl=o==null?void 0:o.workerUrl}this.accessToken=(o==null?void 0:o.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(TH){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new AH(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Ih(async()=>{const{default:n}=await import("./browser-BC0WMm4-.js").then(o=>o.b);return{default:n}},[]).then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:pH}))}disconnect(n,o){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,o??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){const o=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),o}async removeAllChannels(){const n=await Promise.all(this.channels.map(o=>o.unsubscribe()));return this.disconnect(),n}log(n,o,u){this.logger(n,o,u)}connectionState(){switch(this.conn&&this.conn.readyState){case Np.connecting:return lh.Connecting;case Np.open:return lh.Open;case Np.closing:return lh.Closing;default:return lh.Closed}}isConnected(){return this.connectionState()===lh.Open}channel(n,o={config:{}}){const u=new AC(`realtime:${n}`,o,this);return this.channels.push(u),u}push(n){const{topic:o,event:u,payload:g,ref:b}=n,C=()=>{this.encode(n,i=>{var L;(L=this.conn)===null||L===void 0||L.send(i)})};this.log("push",`${o} ${u} (${b})`,g),this.isConnected()?C():this.sendBuffer.push(C)}async setAuth(n=null){let o=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(o){let u=null;try{u=JSON.parse(atob(o.split(".")[1]))}catch{}if(u&&u.exp&&!(Math.floor(Date.now()/1e3)-u.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${u.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${u.exp}`);this.accessTokenValue=o,this.channels.forEach(g=>{o&&g.updateJoinPayload({access_token:o}),g.joinedOnce&&g._isJoined()&&g._push(Ha.access_token,{access_token:o})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(mH,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let o=this.channels.find(u=>u.topic===n&&(u._isJoined()||u._isJoining()));o&&(this.log("transport",`leaving duplicate topic "${n}"`),o.unsubscribe())}_remove(n){this.channels=this.channels.filter(o=>o._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,o=>{let{topic:u,event:g,payload:b,ref:C}=o;C&&C===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${b.status||""} ${u} ${g} ${C&&"("+C+")"||""}`,b),this.channels.filter(i=>i._isMember(u)).forEach(i=>i._trigger(g,b,C)),this.stateChangeCallbacks.message.forEach(i=>i(o))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=o=>{this.log("worker","worker error",o.message),this.workerRef.terminate()},this.workerRef.onmessage=o=>{o.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(o=>o(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(o=>o(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(Ha.error))}_appendParams(n,o){if(Object.keys(o).length===0)return n;const u=n.match(/\?/)?"&":"?",g=new URLSearchParams(o);return`${n}${u}${g}`}_workerObjectUrl(n){let o;if(n)o=n;else{const u=new Blob([EH],{type:"application/javascript"});o=URL.createObjectURL(u)}return o}}class AH{constructor(n,o,u){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Np.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=u.close}}class MC extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function ps(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class MH extends MC{constructor(n,o){super(n),this.name="StorageApiError",this.status=o}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class BT extends MC{constructor(n,o){super(n),this.name="StorageUnknownError",this.originalError=o}}var IH=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};const VO=e=>{let n;return e?n=e:typeof fetch>"u"?n=(...o)=>Ih(async()=>{const{default:u}=await Promise.resolve().then(()=>dm);return{default:u}},void 0).then(({default:u})=>u(...o)):n=fetch,(...o)=>n(...o)},PH=()=>IH(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ih(()=>Promise.resolve().then(()=>dm),void 0)).Response:Response}),UT=e=>{if(Array.isArray(e))return e.map(o=>UT(o));if(typeof e=="function"||e!==Object(e))return e;const n={};return Object.entries(e).forEach(([o,u])=>{const g=o.replace(/([-_][a-z])/gi,b=>b.toUpperCase().replace(/[-_]/g,""));n[g]=UT(u)}),n};var zh=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};const lS=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),RH=(e,n,o)=>zh(void 0,void 0,void 0,function*(){const u=yield PH();e instanceof u&&!(o!=null&&o.noResolveJson)?e.json().then(g=>{n(new MH(lS(g),e.status||500))}).catch(g=>{n(new BT(lS(g),g))}):n(new BT(lS(e),e))}),kH=(e,n,o,u)=>{const g={method:e,headers:(n==null?void 0:n.headers)||{}};return e==="GET"?g:(g.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u&&(g.body=JSON.stringify(u)),Object.assign(Object.assign({},g),o))};function By(e,n,o,u,g,b){return zh(this,void 0,void 0,function*(){return new Promise((C,i)=>{e(o,kH(n,u,g,b)).then(L=>{if(!L.ok)throw L;return u!=null&&u.noResolveJson?L:L.json()}).then(L=>C(L)).catch(L=>RH(L,i,u))})})}function d1(e,n,o,u){return zh(this,void 0,void 0,function*(){return By(e,"GET",n,o,u)})}function Cu(e,n,o,u,g){return zh(this,void 0,void 0,function*(){return By(e,"POST",n,u,g,o)})}function DH(e,n,o,u,g){return zh(this,void 0,void 0,function*(){return By(e,"PUT",n,u,g,o)})}function LH(e,n,o,u){return zh(this,void 0,void 0,function*(){return By(e,"HEAD",n,Object.assign(Object.assign({},o),{noResolveJson:!0}),u)})}function $O(e,n,o,u,g){return zh(this,void 0,void 0,function*(){return By(e,"DELETE",n,u,g,o)})}var xo=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};const NH={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},zk={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class OH{constructor(n,o={},u,g){this.url=n,this.headers=o,this.bucketId=u,this.fetch=VO(g)}uploadOrUpdate(n,o,u,g){return xo(this,void 0,void 0,function*(){try{let b;const C=Object.assign(Object.assign({},zk),g);let i=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(C.upsert)});const L=C.metadata;typeof Blob<"u"&&u instanceof Blob?(b=new FormData,b.append("cacheControl",C.cacheControl),L&&b.append("metadata",this.encodeMetadata(L)),b.append("",u)):typeof FormData<"u"&&u instanceof FormData?(b=u,b.append("cacheControl",C.cacheControl),L&&b.append("metadata",this.encodeMetadata(L))):(b=u,i["cache-control"]=`max-age=${C.cacheControl}`,i["content-type"]=C.contentType,L&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(L)))),g!=null&&g.headers&&(i=Object.assign(Object.assign({},i),g.headers));const O=this._removeEmptyFolders(o),U=this._getFinalPath(O),q=yield this.fetch(`${this.url}/object/${U}`,Object.assign({method:n,body:b,headers:i},C!=null&&C.duplex?{duplex:C.duplex}:{})),G=yield q.json();return q.ok?{data:{path:O,id:G.Id,fullPath:G.Key},error:null}:{data:null,error:G}}catch(b){if(ps(b))return{data:null,error:b};throw b}})}upload(n,o,u){return xo(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,o,u)})}uploadToSignedUrl(n,o,u,g){return xo(this,void 0,void 0,function*(){const b=this._removeEmptyFolders(n),C=this._getFinalPath(b),i=new URL(this.url+`/object/upload/sign/${C}`);i.searchParams.set("token",o);try{let L;const O=Object.assign({upsert:zk.upsert},g),U=Object.assign(Object.assign({},this.headers),{"x-upsert":String(O.upsert)});typeof Blob<"u"&&u instanceof Blob?(L=new FormData,L.append("cacheControl",O.cacheControl),L.append("",u)):typeof FormData<"u"&&u instanceof FormData?(L=u,L.append("cacheControl",O.cacheControl)):(L=u,U["cache-control"]=`max-age=${O.cacheControl}`,U["content-type"]=O.contentType);const q=yield this.fetch(i.toString(),{method:"PUT",body:L,headers:U}),G=yield q.json();return q.ok?{data:{path:b,fullPath:G.Key},error:null}:{data:null,error:G}}catch(L){if(ps(L))return{data:null,error:L};throw L}})}createSignedUploadUrl(n,o){return xo(this,void 0,void 0,function*(){try{let u=this._getFinalPath(n);const g=Object.assign({},this.headers);o!=null&&o.upsert&&(g["x-upsert"]="true");const b=yield Cu(this.fetch,`${this.url}/object/upload/sign/${u}`,{},{headers:g}),C=new URL(this.url+b.url),i=C.searchParams.get("token");if(!i)throw new MC("No token returned by API");return{data:{signedUrl:C.toString(),path:n,token:i},error:null}}catch(u){if(ps(u))return{data:null,error:u};throw u}})}update(n,o,u){return xo(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,o,u)})}move(n,o,u){return xo(this,void 0,void 0,function*(){try{return{data:yield Cu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers}),error:null}}catch(g){if(ps(g))return{data:null,error:g};throw g}})}copy(n,o,u){return xo(this,void 0,void 0,function*(){try{return{data:{path:(yield Cu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:o,destinationBucket:u==null?void 0:u.destinationBucket},{headers:this.headers})).Key},error:null}}catch(g){if(ps(g))return{data:null,error:g};throw g}})}createSignedUrl(n,o,u){return xo(this,void 0,void 0,function*(){try{let g=this._getFinalPath(n),b=yield Cu(this.fetch,`${this.url}/object/sign/${g}`,Object.assign({expiresIn:o},u!=null&&u.transform?{transform:u.transform}:{}),{headers:this.headers});const C=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return b={signedUrl:encodeURI(`${this.url}${b.signedURL}${C}`)},{data:b,error:null}}catch(g){if(ps(g))return{data:null,error:g};throw g}})}createSignedUrls(n,o,u){return xo(this,void 0,void 0,function*(){try{const g=yield Cu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:o,paths:n},{headers:this.headers}),b=u!=null&&u.download?`&download=${u.download===!0?"":u.download}`:"";return{data:g.map(C=>Object.assign(Object.assign({},C),{signedUrl:C.signedURL?encodeURI(`${this.url}${C.signedURL}${b}`):null})),error:null}}catch(g){if(ps(g))return{data:null,error:g};throw g}})}download(n,o){return xo(this,void 0,void 0,function*(){const g=typeof(o==null?void 0:o.transform)<"u"?"render/image/authenticated":"object",b=this.transformOptsToQueryString((o==null?void 0:o.transform)||{}),C=b?`?${b}`:"";try{const i=this._getFinalPath(n);return{data:yield(yield d1(this.fetch,`${this.url}/${g}/${i}${C}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(i){if(ps(i))return{data:null,error:i};throw i}})}info(n){return xo(this,void 0,void 0,function*(){const o=this._getFinalPath(n);try{const u=yield d1(this.fetch,`${this.url}/object/info/${o}`,{headers:this.headers});return{data:UT(u),error:null}}catch(u){if(ps(u))return{data:null,error:u};throw u}})}exists(n){return xo(this,void 0,void 0,function*(){const o=this._getFinalPath(n);try{return yield LH(this.fetch,`${this.url}/object/${o}`,{headers:this.headers}),{data:!0,error:null}}catch(u){if(ps(u)&&u instanceof BT){const g=u.originalError;if([400,404].includes(g==null?void 0:g.status))return{data:!1,error:u}}throw u}})}getPublicUrl(n,o){const u=this._getFinalPath(n),g=[],b=o!=null&&o.download?`download=${o.download===!0?"":o.download}`:"";b!==""&&g.push(b);const i=typeof(o==null?void 0:o.transform)<"u"?"render/image":"object",L=this.transformOptsToQueryString((o==null?void 0:o.transform)||{});L!==""&&g.push(L);let O=g.join("&");return O!==""&&(O=`?${O}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${u}${O}`)}}}remove(n){return xo(this,void 0,void 0,function*(){try{return{data:yield $O(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}})}list(n,o,u){return xo(this,void 0,void 0,function*(){try{const g=Object.assign(Object.assign(Object.assign({},NH),o),{prefix:n||""});return{data:yield Cu(this.fetch,`${this.url}/object/list/${this.bucketId}`,g,{headers:this.headers},u),error:null}}catch(g){if(ps(g))return{data:null,error:g};throw g}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const o=[];return n.width&&o.push(`width=${n.width}`),n.height&&o.push(`height=${n.height}`),n.resize&&o.push(`resize=${n.resize}`),n.format&&o.push(`format=${n.format}`),n.quality&&o.push(`quality=${n.quality}`),o.join("&")}}const zH="2.7.1",jH={"X-Client-Info":`storage-js/${zH}`};var np=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};class FH{constructor(n,o={},u){this.url=n,this.headers=Object.assign(Object.assign({},jH),o),this.fetch=VO(u)}listBuckets(){return np(this,void 0,void 0,function*(){try{return{data:yield d1(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(ps(n))return{data:null,error:n};throw n}})}getBucket(n){return np(this,void 0,void 0,function*(){try{return{data:yield d1(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}})}createBucket(n,o={public:!1}){return np(this,void 0,void 0,function*(){try{return{data:yield Cu(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(ps(u))return{data:null,error:u};throw u}})}updateBucket(n,o){return np(this,void 0,void 0,function*(){try{return{data:yield DH(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(ps(u))return{data:null,error:u};throw u}})}emptyBucket(n){return np(this,void 0,void 0,function*(){try{return{data:yield Cu(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}})}deleteBucket(n){return np(this,void 0,void 0,function*(){try{return{data:yield $O(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(o){if(ps(o))return{data:null,error:o};throw o}})}}class BH extends FH{constructor(n,o={},u){super(n,o,u)}from(n){return new OH(this.url,this.headers,n,this.fetch)}}const UH="2.49.4";let I_="";typeof Deno<"u"?I_="deno":typeof document<"u"?I_="web":typeof navigator<"u"&&navigator.product==="ReactNative"?I_="react-native":I_="node";const VH={"X-Client-Info":`supabase-js-${I_}/${UH}`},$H={headers:VH},GH={schema:"public"},qH={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},HH={};var WH=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};const ZH=e=>{let n;return e?n=e:typeof fetch>"u"?n=AO:n=fetch,(...o)=>n(...o)},XH=()=>typeof Headers>"u"?MO:Headers,KH=(e,n,o)=>{const u=ZH(o),g=XH();return(b,C)=>WH(void 0,void 0,void 0,function*(){var i;const L=(i=yield n())!==null&&i!==void 0?i:e;let O=new g(C==null?void 0:C.headers);return O.has("apikey")||O.set("apikey",e),O.has("Authorization")||O.set("Authorization",`Bearer ${L}`),u(b,Object.assign(Object.assign({},C),{headers:O}))})};var YH=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};function JH(e){return e.replace(/\/$/,"")}function QH(e,n){const{db:o,auth:u,realtime:g,global:b}=e,{db:C,auth:i,realtime:L,global:O}=n,U={db:Object.assign(Object.assign({},C),o),auth:Object.assign(Object.assign({},i),u),realtime:Object.assign(Object.assign({},L),g),global:Object.assign(Object.assign({},O),b),accessToken:()=>YH(this,void 0,void 0,function*(){return""})};return e.accessToken?U.accessToken=e.accessToken:delete U.accessToken,U}const GO="2.69.1",cp=30*1e3,VT=3,cS=VT*cp,eW="http://localhost:9999",tW="supabase.auth.token",rW={"X-Client-Info":`gotrue-js/${GO}`},$T="X-Supabase-Api-Version",qO={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},nW=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,iW=6e5;class IC extends Error{constructor(n,o,u){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=o,this.code=u}}function fn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class sW extends IC{constructor(n,o,u){super(n,o,u),this.name="AuthApiError",this.status=o,this.code=u}}function oW(e){return fn(e)&&e.name==="AuthApiError"}class HO extends IC{constructor(n,o){super(n),this.name="AuthUnknownError",this.originalError=o}}class od extends IC{constructor(n,o,u,g){super(n,u,g),this.name=o,this.status=u}}class bu extends od{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function aW(e){return fn(e)&&e.name==="AuthSessionMissingError"}class uS extends od{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ix extends od{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class sx extends od{constructor(n,o=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function lW(e){return fn(e)&&e.name==="AuthImplicitGrantRedirectError"}class jk extends od{constructor(n,o=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=o}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class GT extends od{constructor(n,o){super(n,"AuthRetryableFetchError",o,void 0)}}function dS(e){return fn(e)&&e.name==="AuthRetryableFetchError"}class Fk extends od{constructor(n,o,u){super(n,"AuthWeakPasswordError",o,"weak_password"),this.reasons=u}}class H_ extends od{constructor(n){super(n,"AuthInvalidJwtError",400,"invalid_jwt")}}const Bk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Uk=` 	
\r=`.split(""),cW=(()=>{const e=new Array(128);for(let n=0;n<e.length;n+=1)e[n]=-1;for(let n=0;n<Uk.length;n+=1)e[Uk[n].charCodeAt(0)]=-2;for(let n=0;n<Bk.length;n+=1)e[Bk[n].charCodeAt(0)]=n;return e})();function WO(e,n,o){const u=cW[e];if(u>-1)for(n.queue=n.queue<<6|u,n.queuedBits+=6;n.queuedBits>=8;)o(n.queue>>n.queuedBits-8&255),n.queuedBits-=8;else{if(u===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Vk(e){const n=[],o=C=>{n.push(String.fromCodePoint(C))},u={utf8seq:0,codepoint:0},g={queue:0,queuedBits:0},b=C=>{hW(C,u,o)};for(let C=0;C<e.length;C+=1)WO(e.charCodeAt(C),g,b);return n.join("")}function uW(e,n){if(e<=127){n(e);return}else if(e<=2047){n(192|e>>6),n(128|e&63);return}else if(e<=65535){n(224|e>>12),n(128|e>>6&63),n(128|e&63);return}else if(e<=1114111){n(240|e>>18),n(128|e>>12&63),n(128|e>>6&63),n(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function dW(e,n){for(let o=0;o<e.length;o+=1){let u=e.charCodeAt(o);if(u>55295&&u<=56319){const g=(u-55296)*1024&65535;u=(e.charCodeAt(o+1)-56320&65535|g)+65536,o+=1}uW(u,n)}}function hW(e,n,o){if(n.utf8seq===0){if(e<=127){o(e);return}for(let u=1;u<6;u+=1)if(!(e>>7-u&1)){n.utf8seq=u;break}if(n.utf8seq===2)n.codepoint=e&31;else if(n.utf8seq===3)n.codepoint=e&15;else if(n.utf8seq===4)n.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");n.utf8seq-=1}else if(n.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");n.codepoint=n.codepoint<<6|e&63,n.utf8seq-=1,n.utf8seq===0&&o(n.codepoint)}}function fW(e){const n=[],o={queue:0,queuedBits:0},u=g=>{n.push(g)};for(let g=0;g<e.length;g+=1)WO(e.charCodeAt(g),o,u);return new Uint8Array(n)}function pW(e){const n=[];return dW(e,o=>n.push(o)),new Uint8Array(n)}function mW(e){return Math.round(Date.now()/1e3)+e}function gW(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e=="x"?n:n&3|8).toString(16)})}const Sl=()=>typeof window<"u"&&typeof document<"u",ih={tested:!1,writable:!1},W_=()=>{if(!Sl())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ih.tested)return ih.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ih.tested=!0,ih.writable=!0}catch{ih.tested=!0,ih.writable=!1}return ih.writable};function _W(e){const n={},o=new URL(e);if(o.hash&&o.hash[0]==="#")try{new URLSearchParams(o.hash.substring(1)).forEach((g,b)=>{n[b]=g})}catch{}return o.searchParams.forEach((u,g)=>{n[g]=u}),n}const ZO=e=>{let n;return e?n=e:typeof fetch>"u"?n=(...o)=>Ih(async()=>{const{default:u}=await Promise.resolve().then(()=>dm);return{default:u}},void 0).then(({default:u})=>u(...o)):n=fetch,(...o)=>n(...o)},yW=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",XO=async(e,n,o)=>{await e.setItem(n,JSON.stringify(o))},ox=async(e,n)=>{const o=await e.getItem(n);if(!o)return null;try{return JSON.parse(o)}catch{return o}},ax=async(e,n)=>{await e.removeItem(n)};class ib{constructor(){this.promise=new ib.promiseConstructor((n,o)=>{this.resolve=n,this.reject=o})}}ib.promiseConstructor=Promise;function hS(e){const n=e.split(".");if(n.length!==3)throw new H_("Invalid JWT structure");for(let u=0;u<n.length;u++)if(!nW.test(n[u]))throw new H_("JWT not in base64url format");return{header:JSON.parse(Vk(n[0])),payload:JSON.parse(Vk(n[1])),signature:fW(n[2]),raw:{header:n[0],payload:n[1]}}}async function vW(e){return await new Promise(n=>{setTimeout(()=>n(null),e)})}function xW(e,n){return new Promise((u,g)=>{(async()=>{for(let b=0;b<1/0;b++)try{const C=await e(b);if(!n(b,null,C)){u(C);return}}catch(C){if(!n(b,C)){g(C);return}}})()})}function bW(e){return("0"+e.toString(16)).substr(-2)}function wW(){const n=new Uint32Array(56);if(typeof crypto>"u"){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",u=o.length;let g="";for(let b=0;b<56;b++)g+=o.charAt(Math.floor(Math.random()*u));return g}return crypto.getRandomValues(n),Array.from(n,bW).join("")}async function SW(e){const o=new TextEncoder().encode(e),u=await crypto.subtle.digest("SHA-256",o),g=new Uint8Array(u);return Array.from(g).map(b=>String.fromCharCode(b)).join("")}async function TW(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const o=await SW(e);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ip(e,n,o=!1){const u=wW();let g=u;o&&(g+="/PASSWORD_RECOVERY"),await XO(e,`${n}-code-verifier`,g);const b=await TW(u);return[b,u===b?"plain":"s256"]}const EW=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function CW(e){const n=e.headers.get($T);if(!n||!n.match(EW))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}function AW(e){if(!e)throw new Error("Missing exp claim");const n=Math.floor(Date.now()/1e3);if(e<=n)throw new Error("JWT has expired")}function MW(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var IW=function(e,n){var o={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(o[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,u=Object.getOwnPropertySymbols(e);g<u.length;g++)n.indexOf(u[g])<0&&Object.prototype.propertyIsEnumerable.call(e,u[g])&&(o[u[g]]=e[u[g]]);return o};const ah=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),PW=[502,503,504];async function $k(e){var n;if(!yW(e))throw new GT(ah(e),0);if(PW.includes(e.status))throw new GT(ah(e),e.status);let o;try{o=await e.json()}catch(b){throw new HO(ah(b),b)}let u;const g=CW(e);if(g&&g.getTime()>=qO["2024-01-01"].timestamp&&typeof o=="object"&&o&&typeof o.code=="string"?u=o.code:typeof o=="object"&&o&&typeof o.error_code=="string"&&(u=o.error_code),u){if(u==="weak_password")throw new Fk(ah(o),e.status,((n=o.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(u==="session_not_found")throw new bu}else if(typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((b,C)=>b&&typeof C=="string",!0))throw new Fk(ah(o),e.status,o.weak_password.reasons);throw new sW(ah(o),e.status||500,u)}const RW=(e,n,o,u)=>{const g={method:e,headers:(n==null?void 0:n.headers)||{}};return e==="GET"?g:(g.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n==null?void 0:n.headers),g.body=JSON.stringify(u),Object.assign(Object.assign({},g),o))};async function Tn(e,n,o,u){var g;const b=Object.assign({},u==null?void 0:u.headers);b[$T]||(b[$T]=qO["2024-01-01"].name),u!=null&&u.jwt&&(b.Authorization=`Bearer ${u.jwt}`);const C=(g=u==null?void 0:u.query)!==null&&g!==void 0?g:{};u!=null&&u.redirectTo&&(C.redirect_to=u.redirectTo);const i=Object.keys(C).length?"?"+new URLSearchParams(C).toString():"",L=await kW(e,n,o+i,{headers:b,noResolveJson:u==null?void 0:u.noResolveJson},{},u==null?void 0:u.body);return u!=null&&u.xform?u==null?void 0:u.xform(L):{data:Object.assign({},L),error:null}}async function kW(e,n,o,u,g,b){const C=RW(n,u,g,b);let i;try{i=await e(o,Object.assign({},C))}catch(L){throw console.error(L),new GT(ah(L),0)}if(i.ok||await $k(i),u!=null&&u.noResolveJson)return i;try{return await i.json()}catch(L){await $k(L)}}function wu(e){var n;let o=null;OW(e)&&(o=Object.assign({},e),e.expires_at||(o.expires_at=mW(e.expires_in)));const u=(n=e.user)!==null&&n!==void 0?n:e;return{data:{session:o,user:u},error:null}}function Gk(e){const n=wu(e);return!n.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((o,u)=>o&&typeof u=="string",!0)&&(n.data.weak_password=e.weak_password),n}function Iu(e){var n;return{data:{user:(n=e.user)!==null&&n!==void 0?n:e},error:null}}function DW(e){return{data:e,error:null}}function LW(e){const{action_link:n,email_otp:o,hashed_token:u,redirect_to:g,verification_type:b}=e,C=IW(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:n,email_otp:o,hashed_token:u,redirect_to:g,verification_type:b},L=Object.assign({},C);return{data:{properties:i,user:L},error:null}}function NW(e){return e}function OW(e){return e.access_token&&e.refresh_token&&e.expires_in}var zW=function(e,n){var o={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(o[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,u=Object.getOwnPropertySymbols(e);g<u.length;g++)n.indexOf(u[g])<0&&Object.prototype.propertyIsEnumerable.call(e,u[g])&&(o[u[g]]=e[u[g]]);return o};class jW{constructor({url:n="",headers:o={},fetch:u}){this.url=n,this.headers=o,this.fetch=ZO(u),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,o="global"){try{return await Tn(this.fetch,"POST",`${this.url}/logout?scope=${o}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(u){if(fn(u))return{data:null,error:u};throw u}}async inviteUserByEmail(n,o={}){try{return await Tn(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:o.data},headers:this.headers,redirectTo:o.redirectTo,xform:Iu})}catch(u){if(fn(u))return{data:{user:null},error:u};throw u}}async generateLink(n){try{const{options:o}=n,u=zW(n,["options"]),g=Object.assign(Object.assign({},u),o);return"newEmail"in u&&(g.new_email=u==null?void 0:u.newEmail,delete g.newEmail),await Tn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:g,headers:this.headers,xform:LW,redirectTo:o==null?void 0:o.redirectTo})}catch(o){if(fn(o))return{data:{properties:null,user:null},error:o};throw o}}async createUser(n){try{return await Tn(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:Iu})}catch(o){if(fn(o))return{data:{user:null},error:o};throw o}}async listUsers(n){var o,u,g,b,C,i,L;try{const O={nextPage:null,lastPage:0,total:0},U=await Tn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(u=(o=n==null?void 0:n.page)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:"",per_page:(b=(g=n==null?void 0:n.perPage)===null||g===void 0?void 0:g.toString())!==null&&b!==void 0?b:""},xform:NW});if(U.error)throw U.error;const q=await U.json(),G=(C=U.headers.get("x-total-count"))!==null&&C!==void 0?C:0,ie=(L=(i=U.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&L!==void 0?L:[];return ie.length>0&&(ie.forEach(J=>{const K=parseInt(J.split(";")[0].split("=")[1].substring(0,1)),re=JSON.parse(J.split(";")[1].split("=")[1]);O[`${re}Page`]=K}),O.total=parseInt(G)),{data:Object.assign(Object.assign({},q),O),error:null}}catch(O){if(fn(O))return{data:{users:[]},error:O};throw O}}async getUserById(n){try{return await Tn(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:Iu})}catch(o){if(fn(o))return{data:{user:null},error:o};throw o}}async updateUserById(n,o){try{return await Tn(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:o,headers:this.headers,xform:Iu})}catch(u){if(fn(u))return{data:{user:null},error:u};throw u}}async deleteUser(n,o=!1){try{return await Tn(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:o},xform:Iu})}catch(u){if(fn(u))return{data:{user:null},error:u};throw u}}async _listFactors(n){try{const{data:o,error:u}=await Tn(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:g=>({data:{factors:g},error:null})});return{data:o,error:u}}catch(o){if(fn(o))return{data:null,error:o};throw o}}async _deleteFactor(n){try{return{data:await Tn(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(o){if(fn(o))return{data:null,error:o};throw o}}}const FW={getItem:e=>W_()?globalThis.localStorage.getItem(e):null,setItem:(e,n)=>{W_()&&globalThis.localStorage.setItem(e,n)},removeItem:e=>{W_()&&globalThis.localStorage.removeItem(e)}};function qk(e={}){return{getItem:n=>e[n]||null,setItem:(n,o)=>{e[n]=o},removeItem:n=>{delete e[n]}}}function BW(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const sp={debug:!!(globalThis&&W_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class KO extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class UW extends KO{}async function VW(e,n,o){sp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,n);const u=new globalThis.AbortController;return n>0&&setTimeout(()=>{u.abort(),sp.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:u.signal},async g=>{if(g){sp.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,g.name);try{return await o()}finally{sp.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,g.name)}}else{if(n===0)throw sp.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new UW(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(sp.debug)try{const b=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(b,null,"  "))}catch(b){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",b)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await o()}}))}BW();const $W={url:eW,storageKey:tW,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rW,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Hk(e,n,o){return await o()}class yy{constructor(n){var o,u;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=yy.nextInstanceID,yy.nextInstanceID+=1,this.instanceID>0&&Sl()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const g=Object.assign(Object.assign({},$W),n);if(this.logDebugMessages=!!g.debug,typeof g.debug=="function"&&(this.logger=g.debug),this.persistSession=g.persistSession,this.storageKey=g.storageKey,this.autoRefreshToken=g.autoRefreshToken,this.admin=new jW({url:g.url,headers:g.headers,fetch:g.fetch}),this.url=g.url,this.headers=g.headers,this.fetch=ZO(g.fetch),this.lock=g.lock||Hk,this.detectSessionInUrl=g.detectSessionInUrl,this.flowType=g.flowType,this.hasCustomAuthorizationHeader=g.hasCustomAuthorizationHeader,g.lock?this.lock=g.lock:Sl()&&(!((o=globalThis==null?void 0:globalThis.navigator)===null||o===void 0)&&o.locks)?this.lock=VW:this.lock=Hk,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?g.storage?this.storage=g.storage:W_()?this.storage=FW:(this.memoryStorage={},this.storage=qk(this.memoryStorage)):(this.memoryStorage={},this.storage=qk(this.memoryStorage)),Sl()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(b){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",b)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async b=>{this._debug("received broadcast notification from other tab or client",b),await this._notifyAllSubscribers(b.data.event,b.data.session,!1)})}this.initialize()}_debug(...n){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${GO}) ${new Date().toISOString()}`,...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var n;try{const o=_W(window.location.href);let u="none";if(this._isImplicitGrantCallback(o)?u="implicit":await this._isPKCECallback(o)&&(u="pkce"),Sl()&&this.detectSessionInUrl&&u!=="none"){const{data:g,error:b}=await this._getSessionFromURL(o,u);if(b){if(this._debug("#_initialize()","error detecting session from URL",b),lW(b)){const L=(n=b.details)===null||n===void 0?void 0:n.code;if(L==="identity_already_exists"||L==="identity_not_found"||L==="single_identity_not_deletable")return{error:b}}return await this._removeSession(),{error:b}}const{session:C,redirectType:i}=g;return this._debug("#_initialize()","detected session in URL",C,"redirect type",i),await this._saveSession(C),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",C):await this._notifyAllSubscribers("SIGNED_IN",C)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return fn(o)?{error:o}:{error:new HO("Unexpected error during initialization",o)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var o,u,g;try{const b=await Tn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(u=(o=n==null?void 0:n.options)===null||o===void 0?void 0:o.data)!==null&&u!==void 0?u:{},gotrue_meta_security:{captcha_token:(g=n==null?void 0:n.options)===null||g===void 0?void 0:g.captchaToken}},xform:wu}),{data:C,error:i}=b;if(i||!C)return{data:{user:null,session:null},error:i};const L=C.session,O=C.user;return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",L)),{data:{user:O,session:L},error:null}}catch(b){if(fn(b))return{data:{user:null,session:null},error:b};throw b}}async signUp(n){var o,u,g;try{let b;if("email"in n){const{email:U,password:q,options:G}=n;let ie=null,J=null;this.flowType==="pkce"&&([ie,J]=await ip(this.storage,this.storageKey)),b=await Tn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:G==null?void 0:G.emailRedirectTo,body:{email:U,password:q,data:(o=G==null?void 0:G.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken},code_challenge:ie,code_challenge_method:J},xform:wu})}else if("phone"in n){const{phone:U,password:q,options:G}=n;b=await Tn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:U,password:q,data:(u=G==null?void 0:G.data)!==null&&u!==void 0?u:{},channel:(g=G==null?void 0:G.channel)!==null&&g!==void 0?g:"sms",gotrue_meta_security:{captcha_token:G==null?void 0:G.captchaToken}},xform:wu})}else throw new ix("You must provide either an email or phone number and a password");const{data:C,error:i}=b;if(i||!C)return{data:{user:null,session:null},error:i};const L=C.session,O=C.user;return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",L)),{data:{user:O,session:L},error:null}}catch(b){if(fn(b))return{data:{user:null,session:null},error:b};throw b}}async signInWithPassword(n){try{let o;if("email"in n){const{email:b,password:C,options:i}=n;o=await Tn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:b,password:C,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Gk})}else if("phone"in n){const{phone:b,password:C,options:i}=n;o=await Tn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:b,password:C,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Gk})}else throw new ix("You must provide either an email or phone number and a password");const{data:u,error:g}=o;return g?{data:{user:null,session:null},error:g}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new uS}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:Object.assign({user:u.user,session:u.session},u.weak_password?{weakPassword:u.weak_password}:null),error:g})}catch(o){if(fn(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOAuth(n){var o,u,g,b;return await this._handleProviderSignIn(n.provider,{redirectTo:(o=n.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=n.options)===null||u===void 0?void 0:u.scopes,queryParams:(g=n.options)===null||g===void 0?void 0:g.queryParams,skipBrowserRedirect:(b=n.options)===null||b===void 0?void 0:b.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async _exchangeCodeForSession(n){const o=await ox(this.storage,`${this.storageKey}-code-verifier`),[u,g]=(o??"").split("/");try{const{data:b,error:C}=await Tn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:u},xform:wu});if(await ax(this.storage,`${this.storageKey}-code-verifier`),C)throw C;return!b||!b.session||!b.user?{data:{user:null,session:null,redirectType:null},error:new uS}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign(Object.assign({},b),{redirectType:g??null}),error:C})}catch(b){if(fn(b))return{data:{user:null,session:null,redirectType:null},error:b};throw b}}async signInWithIdToken(n){try{const{options:o,provider:u,token:g,access_token:b,nonce:C}=n,i=await Tn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:u,id_token:g,access_token:b,nonce:C,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:wu}),{data:L,error:O}=i;return O?{data:{user:null,session:null},error:O}:!L||!L.session||!L.user?{data:{user:null,session:null},error:new uS}:(L.session&&(await this._saveSession(L.session),await this._notifyAllSubscribers("SIGNED_IN",L.session)),{data:L,error:O})}catch(o){if(fn(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithOtp(n){var o,u,g,b,C;try{if("email"in n){const{email:i,options:L}=n;let O=null,U=null;this.flowType==="pkce"&&([O,U]=await ip(this.storage,this.storageKey));const{error:q}=await Tn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(o=L==null?void 0:L.data)!==null&&o!==void 0?o:{},create_user:(u=L==null?void 0:L.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:L==null?void 0:L.captchaToken},code_challenge:O,code_challenge_method:U},redirectTo:L==null?void 0:L.emailRedirectTo});return{data:{user:null,session:null},error:q}}if("phone"in n){const{phone:i,options:L}=n,{data:O,error:U}=await Tn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(g=L==null?void 0:L.data)!==null&&g!==void 0?g:{},create_user:(b=L==null?void 0:L.shouldCreateUser)!==null&&b!==void 0?b:!0,gotrue_meta_security:{captcha_token:L==null?void 0:L.captchaToken},channel:(C=L==null?void 0:L.channel)!==null&&C!==void 0?C:"sms"}});return{data:{user:null,session:null,messageId:O==null?void 0:O.message_id},error:U}}throw new ix("You must provide either an email or phone number.")}catch(i){if(fn(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(n){var o,u;try{let g,b;"options"in n&&(g=(o=n.options)===null||o===void 0?void 0:o.redirectTo,b=(u=n.options)===null||u===void 0?void 0:u.captchaToken);const{data:C,error:i}=await Tn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:b}}),redirectTo:g,xform:wu});if(i)throw i;if(!C)throw new Error("An error occurred on token verification.");const L=C.session,O=C.user;return L!=null&&L.access_token&&(await this._saveSession(L),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",L)),{data:{user:O,session:L},error:null}}catch(g){if(fn(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSSO(n){var o,u,g;try{let b=null,C=null;return this.flowType==="pkce"&&([b,C]=await ip(this.storage,this.storageKey)),await Tn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(u=(o=n.options)===null||o===void 0?void 0:o.redirectTo)!==null&&u!==void 0?u:void 0}),!((g=n==null?void 0:n.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:b,code_challenge_method:C}),headers:this.headers,xform:DW})}catch(b){if(fn(b))return{data:null,error:b};throw b}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:o},error:u}=n;if(u)throw u;if(!o)throw new bu;const{error:g}=await Tn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:o.access_token});return{data:{user:null,session:null},error:g}})}catch(n){if(fn(n))return{data:{user:null,session:null},error:n};throw n}}async resend(n){try{const o=`${this.url}/resend`;if("email"in n){const{email:u,type:g,options:b}=n,{error:C}=await Tn(this.fetch,"POST",o,{headers:this.headers,body:{email:u,type:g,gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}},redirectTo:b==null?void 0:b.emailRedirectTo});return{data:{user:null,session:null},error:C}}else if("phone"in n){const{phone:u,type:g,options:b}=n,{data:C,error:i}=await Tn(this.fetch,"POST",o,{headers:this.headers,body:{phone:u,type:g,gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}}});return{data:{user:null,session:null,messageId:C==null?void 0:C.message_id},error:i}}throw new ix("You must provide either an email or phone number and a type")}catch(o){if(fn(o))return{data:{user:null,session:null},error:o};throw o}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async o=>o))}async _acquireLock(n,o){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const u=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),g=(async()=>(await u,await o()))();return this.pendingInLock.push((async()=>{try{await g}catch{}})()),g}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const u=o();for(this.pendingInLock.push((async()=>{try{await u}catch{}})()),await u;this.pendingInLock.length;){const g=[...this.pendingInLock];await Promise.all(g),this.pendingInLock.splice(0,g.length)}return await u}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const o=await this.__loadSession();return await n(o)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const o=await ox(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",o),o!==null&&(this._isValidSession(o)?n=o:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const u=n.expires_at?n.expires_at*1e3-Date.now()<cS:!1;if(this._debug("#__loadSession()",`session has${u?"":" not"} expired`,"expires_at",n.expires_at),!u){if(this.storage.isServer){let C=this.suppressGetSessionWarning;n=new Proxy(n,{get:(L,O,U)=>(!C&&O==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),C=!0,this.suppressGetSessionWarning=!0),Reflect.get(L,O,U))})}return{data:{session:n},error:null}}const{session:g,error:b}=await this._callRefreshToken(n.refresh_token);return b?{data:{session:null},error:b}:{data:{session:g},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await Tn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:Iu}):await this._useSession(async o=>{var u,g,b;const{data:C,error:i}=o;if(i)throw i;return!(!((u=C.session)===null||u===void 0)&&u.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new bu}:await Tn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(b=(g=C.session)===null||g===void 0?void 0:g.access_token)!==null&&b!==void 0?b:void 0,xform:Iu})})}catch(o){if(fn(o))return aW(o)&&(await this._removeSession(),await ax(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:o};throw o}}async updateUser(n,o={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,o))}async _updateUser(n,o={}){try{return await this._useSession(async u=>{const{data:g,error:b}=u;if(b)throw b;if(!g.session)throw new bu;const C=g.session;let i=null,L=null;this.flowType==="pkce"&&n.email!=null&&([i,L]=await ip(this.storage,this.storageKey));const{data:O,error:U}=await Tn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:o==null?void 0:o.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:i,code_challenge_method:L}),jwt:C.access_token,xform:Iu});if(U)throw U;return C.user=O.user,await this._saveSession(C),await this._notifyAllSubscribers("USER_UPDATED",C),{data:{user:C.user},error:null}})}catch(u){if(fn(u))return{data:{user:null},error:u};throw u}}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new bu;const o=Date.now()/1e3;let u=o,g=!0,b=null;const{payload:C}=hS(n.access_token);if(C.exp&&(u=C.exp,g=u<=o),g){const{session:i,error:L}=await this._callRefreshToken(n.refresh_token);if(L)return{data:{user:null,session:null},error:L};if(!i)return{data:{user:null,session:null},error:null};b=i}else{const{data:i,error:L}=await this._getUser(n.access_token);if(L)throw L;b={access_token:n.access_token,refresh_token:n.refresh_token,user:i.user,token_type:"bearer",expires_in:u-o,expires_at:u},await this._saveSession(b),await this._notifyAllSubscribers("SIGNED_IN",b)}return{data:{user:b.user,session:b},error:null}}catch(o){if(fn(o))return{data:{session:null,user:null},error:o};throw o}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async o=>{var u;if(!n){const{data:C,error:i}=o;if(i)throw i;n=(u=C.session)!==null&&u!==void 0?u:void 0}if(!(n!=null&&n.refresh_token))throw new bu;const{session:g,error:b}=await this._callRefreshToken(n.refresh_token);return b?{data:{user:null,session:null},error:b}:g?{data:{user:g.user,session:g},error:null}:{data:{user:null,session:null},error:null}})}catch(o){if(fn(o))return{data:{user:null,session:null},error:o};throw o}}async _getSessionFromURL(n,o){try{if(!Sl())throw new sx("No browser detected.");if(n.error||n.error_description||n.error_code)throw new sx(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});switch(o){case"implicit":if(this.flowType==="pkce")throw new jk("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new sx("Not a valid implicit grant flow url.");break;default:}if(o==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!n.code)throw new jk("No code detected.");const{data:ee,error:ue}=await this._exchangeCodeForSession(n.code);if(ue)throw ue;const fe=new URL(window.location.href);return fe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",fe.toString()),{data:{session:ee.session,redirectType:null},error:null}}const{provider_token:u,provider_refresh_token:g,access_token:b,refresh_token:C,expires_in:i,expires_at:L,token_type:O}=n;if(!b||!i||!C||!O)throw new sx("No session defined in URL");const U=Math.round(Date.now()/1e3),q=parseInt(i);let G=U+q;L&&(G=parseInt(L));const ie=G-U;ie*1e3<=cp&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${ie}s, should have been closer to ${q}s`);const J=G-q;U-J>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",J,G,U):U-J<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",J,G,U);const{data:K,error:re}=await this._getUser(b);if(re)throw re;const Q={provider_token:u,provider_refresh_token:g,access_token:b,expires_in:q,expires_at:G,refresh_token:C,token_type:O,user:K.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:Q,redirectType:n.type},error:null}}catch(u){if(fn(u))return{data:{session:null,redirectType:null},error:u};throw u}}_isImplicitGrantCallback(n){return!!(n.access_token||n.error_description)}async _isPKCECallback(n){const o=await ox(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&o)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async o=>{var u;const{data:g,error:b}=o;if(b)return{error:b};const C=(u=g.session)===null||u===void 0?void 0:u.access_token;if(C){const{error:i}=await this.admin.signOut(C,n);if(i&&!(oW(i)&&(i.status===404||i.status===401||i.status===403)))return{error:i}}return n!=="others"&&(await this._removeSession(),await ax(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(n){const o=gW(),u={id:o,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",o),this.stateChangeEmitters.delete(o)}};return this._debug("#onAuthStateChange()","registered callback with id",o),this.stateChangeEmitters.set(o,u),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(o)})))(),{data:{subscription:u}}}async _emitInitialSession(n){return await this._useSession(async o=>{var u,g;try{const{data:{session:b},error:C}=o;if(C)throw C;await((u=this.stateChangeEmitters.get(n))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",b)),this._debug("INITIAL_SESSION","callback id",n,"session",b)}catch(b){await((g=this.stateChangeEmitters.get(n))===null||g===void 0?void 0:g.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",b),console.error(b)}})}async resetPasswordForEmail(n,o={}){let u=null,g=null;this.flowType==="pkce"&&([u,g]=await ip(this.storage,this.storageKey,!0));try{return await Tn(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:u,code_challenge_method:g,gotrue_meta_security:{captcha_token:o.captchaToken}},headers:this.headers,redirectTo:o.redirectTo})}catch(b){if(fn(b))return{data:null,error:b};throw b}}async getUserIdentities(){var n;try{const{data:o,error:u}=await this.getUser();if(u)throw u;return{data:{identities:(n=o.user.identities)!==null&&n!==void 0?n:[]},error:null}}catch(o){if(fn(o))return{data:null,error:o};throw o}}async linkIdentity(n){var o;try{const{data:u,error:g}=await this._useSession(async b=>{var C,i,L,O,U;const{data:q,error:G}=b;if(G)throw G;const ie=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(C=n.options)===null||C===void 0?void 0:C.redirectTo,scopes:(i=n.options)===null||i===void 0?void 0:i.scopes,queryParams:(L=n.options)===null||L===void 0?void 0:L.queryParams,skipBrowserRedirect:!0});return await Tn(this.fetch,"GET",ie,{headers:this.headers,jwt:(U=(O=q.session)===null||O===void 0?void 0:O.access_token)!==null&&U!==void 0?U:void 0})});if(g)throw g;return Sl()&&!(!((o=n.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u==null?void 0:u.url),{data:{provider:n.provider,url:u==null?void 0:u.url},error:null}}catch(u){if(fn(u))return{data:{provider:n.provider,url:null},error:u};throw u}}async unlinkIdentity(n){try{return await this._useSession(async o=>{var u,g;const{data:b,error:C}=o;if(C)throw C;return await Tn(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(g=(u=b.session)===null||u===void 0?void 0:u.access_token)!==null&&g!==void 0?g:void 0})})}catch(o){if(fn(o))return{data:null,error:o};throw o}}async _refreshAccessToken(n){const o=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(o,"begin");try{const u=Date.now();return await xW(async g=>(g>0&&await vW(200*Math.pow(2,g-1)),this._debug(o,"refreshing attempt",g),await Tn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:wu})),(g,b)=>{const C=200*Math.pow(2,g);return b&&dS(b)&&Date.now()+C-u<cp})}catch(u){if(this._debug(o,"error",u),fn(u))return{data:{session:null,user:null},error:u};throw u}finally{this._debug(o,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,o){const u=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:o.redirectTo,scopes:o.scopes,queryParams:o.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",o,"url",u),Sl()&&!o.skipBrowserRedirect&&window.location.assign(u),{data:{provider:n,url:u},error:null}}async _recoverAndRefresh(){var n;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const u=await ox(this.storage,this.storageKey);if(this._debug(o,"session from storage",u),!this._isValidSession(u)){this._debug(o,"session is not valid"),u!==null&&await this._removeSession();return}const g=((n=u.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<cS;if(this._debug(o,`session has${g?"":" not"} expired with margin of ${cS}s`),g){if(this.autoRefreshToken&&u.refresh_token){const{error:b}=await this._callRefreshToken(u.refresh_token);b&&(console.error(b),dS(b)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",b),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(o,"error",u),console.error(u);return}finally{this._debug(o,"end")}}async _callRefreshToken(n){var o,u;if(!n)throw new bu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const g=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(g,"begin");try{this.refreshingDeferred=new ib;const{data:b,error:C}=await this._refreshAccessToken(n);if(C)throw C;if(!b.session)throw new bu;await this._saveSession(b.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",b.session);const i={session:b.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(b){if(this._debug(g,"error",b),fn(b)){const C={session:null,error:b};return dS(b)||await this._removeSession(),(o=this.refreshingDeferred)===null||o===void 0||o.resolve(C),C}throw(u=this.refreshingDeferred)===null||u===void 0||u.reject(b),b}finally{this.refreshingDeferred=null,this._debug(g,"end")}}async _notifyAllSubscribers(n,o,u=!0){const g=`#_notifyAllSubscribers(${n})`;this._debug(g,"begin",o,`broadcast = ${u}`);try{this.broadcastChannel&&u&&this.broadcastChannel.postMessage({event:n,session:o});const b=[],C=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(n,o)}catch(L){b.push(L)}});if(await Promise.all(C),b.length>0){for(let i=0;i<b.length;i+=1)console.error(b[i]);throw b[0]}}finally{this._debug(g,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0,await XO(this.storage,this.storageKey,n)}async _removeSession(){this._debug("#_removeSession()"),await ax(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&Sl()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",n)}catch(o){console.error("removing visibilitychange callback failed",o)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),cp);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async o=>{const{data:{session:u}}=o;if(!u||!u.refresh_token||!u.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const g=Math.floor((u.expires_at*1e3-n)/cp);this._debug("#_autoRefreshTokenTick()",`access token expires in ${g} ticks, a tick lasts ${cp}ms, refresh threshold is ${VT} ticks`),g<=VT&&await this._callRefreshToken(u.refresh_token)})}catch(o){console.error("Auto refresh tick failed with error. This is likely a transient error.",o)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof KO)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Sl()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const o=`#_onVisibilityChanged(${n})`;this._debug(o,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(o,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,o,u){const g=[`provider=${encodeURIComponent(o)}`];if(u!=null&&u.redirectTo&&g.push(`redirect_to=${encodeURIComponent(u.redirectTo)}`),u!=null&&u.scopes&&g.push(`scopes=${encodeURIComponent(u.scopes)}`),this.flowType==="pkce"){const[b,C]=await ip(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(b)}`,code_challenge_method:`${encodeURIComponent(C)}`});g.push(i.toString())}if(u!=null&&u.queryParams){const b=new URLSearchParams(u.queryParams);g.push(b.toString())}return u!=null&&u.skipBrowserRedirect&&g.push(`skip_http_redirect=${u.skipBrowserRedirect}`),`${n}?${g.join("&")}`}async _unenroll(n){try{return await this._useSession(async o=>{var u;const{data:g,error:b}=o;return b?{data:null,error:b}:await Tn(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(u=g==null?void 0:g.session)===null||u===void 0?void 0:u.access_token})})}catch(o){if(fn(o))return{data:null,error:o};throw o}}async _enroll(n){try{return await this._useSession(async o=>{var u,g;const{data:b,error:C}=o;if(C)return{data:null,error:C};const i=Object.assign({friendly_name:n.friendlyName,factor_type:n.factorType},n.factorType==="phone"?{phone:n.phone}:{issuer:n.issuer}),{data:L,error:O}=await Tn(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(u=b==null?void 0:b.session)===null||u===void 0?void 0:u.access_token});return O?{data:null,error:O}:(n.factorType==="totp"&&(!((g=L==null?void 0:L.totp)===null||g===void 0)&&g.qr_code)&&(L.totp.qr_code=`data:image/svg+xml;utf-8,${L.totp.qr_code}`),{data:L,error:null})})}catch(o){if(fn(o))return{data:null,error:o};throw o}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var u;const{data:g,error:b}=o;if(b)return{data:null,error:b};const{data:C,error:i}=await Tn(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:{code:n.code,challenge_id:n.challengeId},headers:this.headers,jwt:(u=g==null?void 0:g.session)===null||u===void 0?void 0:u.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+C.expires_in},C)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",C),{data:C,error:i})})}catch(o){if(fn(o))return{data:null,error:o};throw o}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async o=>{var u;const{data:g,error:b}=o;return b?{data:null,error:b}:await Tn(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{body:{channel:n.channel},headers:this.headers,jwt:(u=g==null?void 0:g.session)===null||u===void 0?void 0:u.access_token})})}catch(o){if(fn(o))return{data:null,error:o};throw o}})}async _challengeAndVerify(n){const{data:o,error:u}=await this._challenge({factorId:n.factorId});return u?{data:null,error:u}:await this._verify({factorId:n.factorId,challengeId:o.id,code:n.code})}async _listFactors(){const{data:{user:n},error:o}=await this.getUser();if(o)return{data:null,error:o};const u=(n==null?void 0:n.factors)||[],g=u.filter(C=>C.factor_type==="totp"&&C.status==="verified"),b=u.filter(C=>C.factor_type==="phone"&&C.status==="verified");return{data:{all:u,totp:g,phone:b},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async n=>{var o,u;const{data:{session:g},error:b}=n;if(b)return{data:null,error:b};if(!g)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:C}=hS(g.access_token);let i=null;C.aal&&(i=C.aal);let L=i;((u=(o=g.user.factors)===null||o===void 0?void 0:o.filter(q=>q.status==="verified"))!==null&&u!==void 0?u:[]).length>0&&(L="aal2");const U=C.amr||[];return{data:{currentLevel:i,nextLevel:L,currentAuthenticationMethods:U},error:null}}))}async fetchJwk(n,o={keys:[]}){let u=o.keys.find(C=>C.kid===n);if(u||(u=this.jwks.keys.find(C=>C.kid===n),u&&this.jwks_cached_at+iW>Date.now()))return u;const{data:g,error:b}=await Tn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(b)throw b;if(!g.keys||g.keys.length===0)throw new H_("JWKS is empty");if(this.jwks=g,this.jwks_cached_at=Date.now(),u=g.keys.find(C=>C.kid===n),!u)throw new H_("No matching signing key found in JWKS");return u}async getClaims(n,o={keys:[]}){try{let u=n;if(!u){const{data:ie,error:J}=await this.getSession();if(J||!ie.session)return{data:null,error:J};u=ie.session.access_token}const{header:g,payload:b,signature:C,raw:{header:i,payload:L}}=hS(u);if(AW(b.exp),!g.kid||g.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:ie}=await this.getUser(u);if(ie)throw ie;return{data:{claims:b,header:g,signature:C},error:null}}const O=MW(g.alg),U=await this.fetchJwk(g.kid,o),q=await crypto.subtle.importKey("jwk",U,O,!0,["verify"]);if(!await crypto.subtle.verify(O,q,C,pW(`${i}.${L}`)))throw new H_("Invalid JWT signature");return{data:{claims:b,header:g,signature:C},error:null}}catch(u){if(fn(u))return{data:null,error:u};throw u}}}yy.nextInstanceID=0;const GW=yy;class qW extends GW{constructor(n){super(n)}}var HW=function(e,n,o,u){function g(b){return b instanceof o?b:new o(function(C){C(b)})}return new(o||(o=Promise))(function(b,C){function i(U){try{O(u.next(U))}catch(q){C(q)}}function L(U){try{O(u.throw(U))}catch(q){C(q)}}function O(U){U.done?b(U.value):g(U.value).then(i,L)}O((u=u.apply(e,n||[])).next())})};class WW{constructor(n,o,u){var g,b,C;if(this.supabaseUrl=n,this.supabaseKey=o,!n)throw new Error("supabaseUrl is required.");if(!o)throw new Error("supabaseKey is required.");const i=JH(n);this.realtimeUrl=`${i}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${i}/auth/v1`,this.storageUrl=`${i}/storage/v1`,this.functionsUrl=`${i}/functions/v1`;const L=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,O={db:GH,realtime:HH,auth:Object.assign(Object.assign({},qH),{storageKey:L}),global:$H},U=QH(u??{},O);this.storageKey=(g=U.auth.storageKey)!==null&&g!==void 0?g:"",this.headers=(b=U.global.headers)!==null&&b!==void 0?b:{},U.accessToken?(this.accessToken=U.accessToken,this.auth=new Proxy({},{get:(q,G)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(G)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((C=U.auth)!==null&&C!==void 0?C:{},this.headers,U.global.fetch),this.fetch=KH(o,this._getAccessToken.bind(this),U.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},U.realtime)),this.rest=new dH(`${i}/rest/v1`,{headers:this.headers,schema:U.db.schema,fetch:this.fetch}),U.accessToken||this._listenForAuthEvents()}get functions(){return new U9(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new BH(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,o={},u={}){return this.rest.rpc(n,o,u)}channel(n,o={config:{}}){return this.realtime.channel(n,o)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,o;return HW(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:u}=yield this.auth.getSession();return(o=(n=u.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:o,detectSessionInUrl:u,storage:g,storageKey:b,flowType:C,lock:i,debug:L},O,U){const q={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new qW({url:this.authUrl,headers:Object.assign(Object.assign({},q),O),storageKey:b,autoRefreshToken:n,persistSession:o,detectSessionInUrl:u,storage:g,flowType:C,lock:i,debug:L,fetch:U,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new CH(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((o,u)=>{this._handleTokenChanged(o,"CLIENT",u==null?void 0:u.access_token)})}_handleTokenChanged(n,o,u){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==u?this.changedAccessToken=u:n==="SIGNED_OUT"&&(this.realtime.setAuth(),o=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ZW=(e,n,o)=>new WW(e,n,o),XW="https://jzosgtmmjswjtjvibpye.supabase.co",KW="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6b3NndG1tanN3anRqdmlicHllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MDkxNjQsImV4cCI6MjA1OTQ4NTE2NH0.Ky2APyH6-3v52zWQonNV9fJr9PG5L5oS9zaZe12IWp0",Qt=ZW(XW,KW),YW=Object.freeze(Object.defineProperty({__proto__:null,supabase:Qt},Symbol.toStringTag,{value:"Module"})),YO=Z.createContext(void 0),jh=()=>{const e=Z.useContext(YO);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},JW=()=>{const e=window.location.hostname,n=window.location.protocol,o=window.location.port;if(e==="localhost"||e==="127.0.0.1")return`${n}//${e}:${o}/auth/callback`;if(e.endsWith("netlify.app"))return`${n}//${e}/auth/callback`;const u=e.split(".");return u.length===3&&u[1]==="delliapp"&&u[2]==="com"&&u[3]==="br"?`${n}//${e}/auth/callback`:`${n}//${e}/auth/callback`},QW=({children:e})=>{const[n,o]=Z.useState(null),[u,g]=Z.useState(null),[b,C]=Z.useState(!0);Z.useEffect(()=>{let J=!0;C(!0);const K=async()=>{try{console.log("Inicializando sessão (initializeSession)...");const{data:{session:Q},error:ee}=await Qt.auth.getSession();return J?ee?(console.error("Erro ao obter sessão (initializeSession):",ee),o(null),g(null),null):Q!=null&&Q.user?(console.log("Sessão ativa encontrada (initializeSession):",Q.user.id),o(Q.user),await i(Q.user.id),Q.user):(console.log("Nenhuma sessão ativa ou usuário na sessão (initializeSession)."),o(null),g(null),null):null}catch(Q){return console.error("Erro em initializeSession:",Q),J&&(o(null),g(null)),null}},{data:{subscription:re}}=Qt.auth.onAuthStateChange(async(Q,ee)=>{var ue;J&&(console.log("Evento de autenticação:",Q,(ue=ee==null?void 0:ee.user)==null?void 0:ue.id),Q==="SIGNED_IN"||Q==="TOKEN_REFRESHED"?(o((ee==null?void 0:ee.user)??null),ee!=null&&ee.user?await i(ee.user.id):g(null)):Q==="SIGNED_OUT"?(o(null),g(null),C(!1)):Q==="USER_UPDATED"&&(o((ee==null?void 0:ee.user)??null),ee!=null&&ee.user?await i(ee.user.id):g(null)))});return K().finally(()=>{J&&C(!1)}),()=>{J=!1,re.unsubscribe()}},[]);const i=async J=>{try{const{data:K,error:re}=await Qt.from("profiles").select("*").eq("id",J).single();if(re){console.error("Erro ao buscar perfil:",re),g(null);return}g(K||null)}catch(K){console.error("Erro ao buscar perfil:",K),g(null)}},ie={user:n,currentUser:u,loading:b,signIn:async(J,K)=>{try{const{error:re}=await Qt.auth.signInWithPassword({email:J,password:K});return{error:re}}catch(re){return{error:re}}},signUp:async(J,K,re)=>{try{const{error:Q}=await Qt.auth.signUp({email:J,password:K,options:{data:re}});return{error:Q}}catch(Q){return{error:Q}}},signInWithGoogle:async()=>{try{const J=JW();console.log("Redirecionando Google OAuth para:",J);const{error:K}=await Qt.auth.signInWithOAuth({provider:"google",options:{redirectTo:J,queryParams:{access_type:"offline",prompt:"select_account"}}});return{error:K}}catch(J){return{error:J}}},signOut:async()=>{try{await Qt.auth.signOut()}catch(J){console.error("Erro ao fazer logout:",J)}},updateProfile:async J=>{if(!n)return{error:"Usuário não autenticado"};try{const{error:K}=await Qt.from("profiles").update(J).eq("id",n.id);return K||g(re=>re?{...re,...J}:null),{error:K}}catch(K){return{error:K}}},setCurrentUser:g};return w.jsx(YO.Provider,{value:ie,children:e})},Uy=()=>{const[e,n]=Z.useState(null),[o,u]=Z.useState(!0),[g,b]=Z.useState(!1),{currentUser:C,loading:i}=jh();return Z.useEffect(()=>{i||((()=>{try{const q=window.location.hostname;if(q==="localhost"||q==="127.0.0.1"){const ie=new URLSearchParams(window.location.search).get("client");if(ie)n(ie),b(!1),console.log(`Ambiente local: modo cliente ativado para ${ie}`);else{n(null);const J=(C==null?void 0:C.role)==="admin";b(J),console.log(`Ambiente local: modo admin ${J?"ativado":"desativado"} - usuário ${J?"é":"não é"} admin`)}}else{const G=q.split(".");if(G.length===4&&G[0]==="app"&&G[1]==="delliapp"&&G[2]==="com"&&G[3]==="br"){n(null);const ie=(C==null?void 0:C.role)==="admin";b(ie),console.log(`Produção: app.delliapp.com.br - modo admin ${ie?"ativado":"desativado"} - usuário ${ie?"é":"não é"} admin`)}else if(G.length===4&&G[1]==="delliapp"&&G[2]==="com"&&G[3]==="br"&&G[0]!=="app"){const ie=G[0];n(ie),b(!1),console.log(`Produção: modo cliente ativado para ${ie}.delliapp.com.br`)}else n(null),b(!1)}}catch(q){console.error("Erro ao detectar subdomínio:",q),n(null),b(!1)}})(),u(!1))},[i,C]),{subdomain:e,isLoading:o,isAdminMode:g,isClientMode:!g&&!!e,switchToClient:U=>{if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){const q=new URL(window.location.href);q.searchParams.set("client",U),window.location.href=q.toString()}else window.location.href=`https://${U}.delliapp.com.br`},switchToAdmin:()=>{if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){const U=new URL(window.location.href);U.searchParams.delete("client"),window.location.href=U.toString()}else window.location.href="https://app.delliapp.com.br"}}},JO=Z.createContext(void 0),eZ=({children:e})=>{const{subdomain:n,isLoading:o,isAdminMode:u,switchToClient:g,switchToAdmin:b}=Uy(),[C,i]=Z.useState(null),[L,O]=Z.useState(!0),U=tr.useMemo(()=>{const J=window.location.hostname;return J==="localhost"||J==="127.0.0.1"},[]),q=async J=>{try{const{data:K,error:re}=await Qt.from("teams").select("*").eq("slug",J).single();return re?(console.error("Erro ao buscar team por slug:",re),null):K}catch(K){return console.error("Erro ao carregar team:",K),null}},G=async()=>{if(!n||u){i(null),O(!1);return}O(!0);const J=await q(n);if(J){i(J),console.log("Team carregado com sucesso:",J);try{const{error:K}=await Qt.rpc("set_current_team_id",{team_id:J.id.toString()});K?console.warn("Erro ao configurar team_id no Supabase:",K):console.log("Team ID configurado no Supabase para RLS:",J.id)}catch(K){console.warn("Erro ao configurar team_id no Supabase:",K)}}else{i(null),console.log("Nenhum team encontrado para o subdomínio:",n);try{const{error:K}=await Qt.rpc("set_current_team_id",{team_id:""});K?console.warn("Erro ao limpar team_id no Supabase:",K):console.log("Team ID limpo no Supabase (modo admin ou sem team)")}catch(K){console.warn("Erro ao limpar team_id no Supabase:",K)}}O(!1)};Z.useEffect(()=>{o||G()},[n,u,o]),Z.useEffect(()=>{if(U&&o===!1){const J=setTimeout(()=>{O(!1),console.log("Carregamento finalizado forçadamente em ambiente local")},500);return()=>clearTimeout(J)}},[U,o]);const ie={currentTeam:C,isLoading:U?!1:o||L,isAdminMode:u,isClientMode:!u&&!!n,subdomain:n,switchToClient:g,switchToAdmin:b,refreshTeam:G};return w.jsx(JO.Provider,{value:ie,children:e})},Vy=()=>{const e=Z.useContext(JO);if(e===void 0)throw new Error("useMultiTenant deve ser usado dentro de um MultiTenantProvider");return e},QO=Z.createContext(void 0),tZ=({children:e})=>{const[n,o]=Z.useState(null),[u,g]=Z.useState(!1),[b,C]=Z.useState(!1),{isAdminMode:i,switchToClient:L,switchToAdmin:O}=Vy(),{signOut:U,user:q}=jh();Z.useEffect(()=>{const Q=localStorage.getItem("currentUserSwitcher");if(Q)try{const ee=JSON.parse(Q);o(ee)}catch(ee){console.error("Erro ao carregar usuário salvo:",ee),o(G.visitor)}else o(G.visitor)},[]);const G={restaurant_owner:{id:"real-owner-joaby",role:"restaurant_owner",name:"Joaby Chaves",email:"joabychaves10@gmail.com",avatar_url:null},admin:{id:"real-admin-joaby",role:"admin",name:"Joaby Chaves",email:"testhabboo@gmail.com",avatar_url:null},chef:{id:"real-chef-milly",role:"chef",name:"Milly Gueno",email:"euguenoo@gmail.com",avatar_url:null},waiter:{id:"real-waiter-milly",role:"waiter",name:"Milly Safadinha",email:"myllyzinhasafadinhadojob@gmail.com",avatar_url:null},customer:{id:"real-customer-lucad",role:"customer",name:"Lucad Teste",email:"xdroidbr1021@gmail.com",avatar_url:null},visitor:{id:"visitor-default",role:"visitor",name:"Visitante",email:"visitor@example.com",avatar_url:null}},ie=Q=>{const ee=G[Q];ee&&(o(ee),localStorage.setItem("currentUserSwitcher",JSON.stringify(ee)),K())},J=()=>{C(Q=>!Q)},K=()=>{C(!1)},re=async()=>{try{await U();const Q=G.visitor;o(Q),localStorage.removeItem("currentUserSwitcher"),localStorage.setItem("currentUserSwitcher",JSON.stringify(Q)),i||L("cliente1"),K()}catch(Q){console.error("Erro ao fazer logout:",Q)}};return w.jsx(QO.Provider,{value:{currentUser:n,setCurrentUser:o,showUserSwitcher:u,setShowUserSwitcher:g,switchUser:ie,isUserSwitcherOpen:b,toggleUserSwitcher:J,closeUserSwitcher:K,logout:re},children:e})},Fh=()=>{const e=Z.useContext(QO);if(e===void 0)throw new Error("useUserSwitcher must be used within a UserSwitcherProvider");return e},ez=Z.createContext(void 0),rZ=({children:e})=>{const[n,o]=Z.useState([]),[u,g]=Z.useState(!1),{toast:b}=j1();Z.useEffect(()=>{const K=localStorage.getItem("cart");if(K)try{const re=JSON.parse(K);Array.isArray(re)&&o(re)}catch(re){console.error("Erro ao carregar carrinho do localStorage:",re)}},[]),Z.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(n))},[n]);const C=()=>{g(!u)},i=()=>{g(!1)},L=K=>{o(re=>re.find(ee=>ee.id===K.id&&ee.notes===K.notes)?re.map(ee=>ee.id===K.id&&ee.notes===K.notes?{...ee,quantity:ee.quantity+(K.quantity||1)}:ee):[...re,{...K,quantity:K.quantity||1,notes:K.notes}]),b({title:"Item adicionado",description:`${K.name} foi adicionado ao carrinho`})},O=(K,re)=>{o(Q=>Q.filter(ee=>!(ee.id===K&&ee.notes===re))),b({title:"Item removido",description:"O item foi removido do carrinho"})},U=(K,re,Q)=>{if(re<=0){O(K,Q);return}o(ee=>ee.map(ue=>ue.id===K&&ue.notes===Q?{...ue,quantity:re}:ue))},q=()=>{o([]),b({title:"Carrinho limpo",description:"Todos os itens foram removidos do carrinho"})},G=n.reduce((K,re)=>K+re.quantity,0),ie=n.reduce((K,re)=>K+re.price*re.quantity,0),J=()=>n.reduce((K,re)=>K+re.price*re.quantity,0);return w.jsx(ez.Provider,{value:{cartItems:n,cartOpen:u,toggleCart:C,addToCart:L,removeFromCart:O,updateQuantity:U,clearCart:q,totalItems:G,subtotal:ie,closeCart:i,getCartTotal:J},children:e})},ad=()=>{const e=Z.useContext(ez);if(e===void 0)throw new Error("useCart must be used within a CartProvider");return e},tz=Z.createContext(void 0),nZ=({children:e})=>{const[n,o]=Z.useState(null),[u,g]=Z.useState(!0),{subdomain:b,isLoading:C,isAdminMode:i}=Uy();Z.useEffect(()=>{C||(async()=>{try{const q=new URLSearchParams(window.location.search).get("team_id");if(q){o(q),localStorage.setItem("current_team_id",q),console.log(`Team ID definido via URL: ${q}`);return}if(i){o(null),localStorage.removeItem("current_team_id"),console.log("Modo admin: team_id removido");return}if(b){const{data:J,error:K}=await Qt.from("teams").select("id").eq("slug",b).single();if(J&&!K){o(J.id),localStorage.setItem("current_team_id",J.id),console.log(`Team ID definido via subdomínio ${b}: ${J.id}`);return}else console.warn(`Nenhum team encontrado para o subdomínio: ${b}`)}const G=localStorage.getItem("current_team_id");if(G&&G!=="default-team"){o(G),console.log(`Team ID recuperado do localStorage: ${G}`);return}if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){o(null),localStorage.removeItem("current_team_id"),console.log("Ambiente local: operando sem team_id específico");return}o(null),localStorage.removeItem("current_team_id"),console.log("Nenhum team_id definido")}catch(U){console.error("Erro ao inicializar team_id:",U),o(null)}finally{g(!1)}})()},[b,C,i]);const L=O=>{o(O),O?localStorage.setItem("current_team_id",O):localStorage.removeItem("current_team_id")};return w.jsx(tz.Provider,{value:{teamId:n,setTeamId:L,isLoading:u,isReady:!u&&!!n},children:e})},sb=()=>{const e=Z.useContext(tz);if(e===void 0)throw new Error("useTeam deve ser usado dentro de um TeamProvider");return e},rz=()=>{try{const e=window.location.hostname;if(e==="localhost"||e==="127.0.0.1"){const u=new URLSearchParams(window.location.search).get("client");return u?(console.log(`Ambiente local: detectado cliente ${u}`),u):(console.log("Ambiente local: modo admin (sem parâmetro client)"),null)}const n=e.split(".");if(n.length===4&&n[0]==="app"&&n[1]==="delliapp"&&n[2]==="com"&&n[3]==="br")return console.log("Produção: modo admin (app.delliapp.com.br)"),null;if(n.length===4&&n[1]==="delliapp"&&n[2]==="com"&&n[3]==="br"){const o=n[0];return console.log(`Produção: detectado subdomínio ${o}`),o}return n.length===3&&n[0]==="delliapp"&&n[1]==="com"&&n[2]==="br"?(console.log("Produção: domínio raiz (delliapp.com.br)"),null):(console.log(`Hostname não reconhecido: ${e}`),null)}catch(e){return console.error("Erro ao detectar subdomínio:",e),null}},iZ=()=>rz()===null,nz=Z.createContext(void 0),sZ=()=>{const e=Z.useContext(nz);if(e===void 0)throw new Error("useClient deve ser usado dentro de um ClientProvider");return e},oZ=({children:e})=>{const[n,o]=Z.useState(null),[u,g]=Z.useState(!0),[b,C]=Z.useState(null),[i,L]=Z.useState(null),[O,U]=Z.useState(!1),q=async J=>{try{g(!0),C(null),console.log(`Buscando cliente com slug: ${J}`);const{data:K,error:re}=await Qt.from("teams").select("*").eq("slug",J).eq("is_active",!0).single();if(re){console.error("Erro ao buscar cliente:",re),re.code==="PGRST116"?C(`Cliente "${J}" não encontrado ou inativo`):C("Erro ao carregar dados do cliente"),o(null);return}if(!K){C(`Cliente "${J}" não encontrado`),o(null);return}console.log("Cliente encontrado:",K),o(K),C(null)}catch(K){console.error("Erro inesperado ao buscar cliente:",K),C("Erro inesperado ao carregar cliente"),o(null)}finally{g(!1)}},G=async()=>{i&&await q(i)};Z.useEffect(()=>{const J=rz(),K=iZ();L(J),U(K),K?(console.log("Modo admin ativado - não carregando cliente específico"),o(null),C(null),g(!1)):J?q(J):(C("Subdomínio não detectado"),o(null),g(!1))},[]);const ie={client:n,isLoading:u,error:b,isAdminMode:O,subdomain:i,refetchClient:G};return w.jsx(nz.Provider,{value:ie,children:e})},aZ=Ny("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$t=Z.forwardRef(({className:e,variant:n,size:o,asChild:u=!1,...g},b)=>{const C=u?Ku:"button";return w.jsx(C,{className:Rr(aZ({variant:n,size:o,className:e})),ref:b,...g})});$t.displayName="Button";const Wk=768;function lZ(){const[e,n]=Z.useState(!1);return Z.useEffect(()=>{n(window.innerWidth<Wk);const o=()=>{n(window.innerWidth<Wk)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),e}const iz=()=>{const{currentUser:e,switchUser:n,isUserSwitcherOpen:o,toggleUserSwitcher:u,closeUserSwitcher:g,logout:b}=Fh(),{user:C}=jh(),i=lZ(),L=Z.useRef(null),[O,U]=Z.useState({x:-1,y:-1}),[q,G]=Z.useState(!1),[ie,J]=Z.useState({x:0,y:0}),[K,re]=Z.useState(!1);Z.useEffect(()=>{const dt=localStorage.getItem("userSwitcherPosition");U(dt?JSON.parse(dt):{x:window.innerWidth-100,y:window.innerHeight-100})},[]),Z.useEffect(()=>{O.x!==-1&&O.y!==-1&&localStorage.setItem("userSwitcherPosition",JSON.stringify(O))},[O]),Z.useEffect(()=>{const dt=Qe=>{L.current&&!L.current.contains(Qe.target)&&g()};return o&&document.addEventListener("mousedown",dt),()=>{document.removeEventListener("mousedown",dt)}},[o,g]);const Q=dt=>{dt.stopPropagation();const Qe=dt.currentTarget.getBoundingClientRect();J({x:dt.clientX-Qe.left,y:dt.clientY-Qe.top}),G(!0),re(!1)},ee=dt=>{if(q){re(!0);const Qe=Math.max(0,Math.min(dt.clientX-ie.x,window.innerWidth-100)),qe=Math.max(0,Math.min(dt.clientY-ie.y,window.innerHeight-100));U({x:Qe,y:qe})}},ue=()=>{G(!1)},fe=dt=>{K||u(),re(!1)};Z.useEffect(()=>(q?(window.addEventListener("mousemove",ee),window.addEventListener("mouseup",ue)):(window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",ue)),()=>{window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",ue)}),[q]);const ge={admin:w.jsx(S$,{className:"h-5 w-5"}),restaurant_owner:w.jsx(ST,{className:"h-5 w-5"}),waiter:w.jsx(C$,{className:"h-5 w-5"}),chef:w.jsx(ET,{className:"h-5 w-5"}),delivery_person:w.jsx(TN,{className:"h-5 w-5"}),customer:w.jsx(d$,{className:"h-5 w-5"}),visitor:w.jsx(E$,{className:"h-5 w-5"})},ke={admin:"bg-red-500 hover:bg-red-600",restaurant_owner:"bg-purple-500 hover:bg-purple-600",waiter:"bg-blue-500 hover:bg-blue-600",chef:"bg-yellow-500 hover:bg-yellow-600 text-black",delivery_person:"bg-green-500 hover:bg-green-600",customer:"bg-menu-primary hover:bg-menu-primary/90",visitor:"bg-gray-500 hover:bg-gray-600"},Ce={admin:"Admin",restaurant_owner:"Dono",waiter:"Garçom",chef:"Cozinha",delivery_person:"Entregador",customer:"Cliente",visitor:"Visitante"},Be=O.x!==-1?{position:"fixed",left:`${O.x}px`,top:`${O.y}px`,zIndex:9999,cursor:q?"grabbing":"grab"}:void 0;return w.jsxs("div",{className:"fixed z-[9999]",style:Be,ref:L,children:[o&&w.jsxs("div",{className:"absolute bottom-16 right-0 w-52 bg-white rounded-lg shadow-lg overflow-hidden mb-2 border border-gray-200",children:[w.jsxs("div",{className:"p-3 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[w.jsx("span",{className:"font-medium text-sm",children:"Trocar usuário"}),w.jsx($t,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:g,children:w.jsx(Yu,{className:"h-4 w-4"})})]}),w.jsxs("div",{className:"p-2 max-h-60 overflow-y-auto",children:[Object.entries(Ce).map(([dt,Qe])=>w.jsx($t,{variant:"ghost",className:`w-full justify-start mb-1 ${(e==null?void 0:e.role)===dt?"bg-gray-100":""}`,onClick:()=>{console.log("Switching to role:",dt),n(dt)},children:w.jsxs("div",{className:"flex items-center",children:[w.jsx("div",{className:`h-7 w-7 rounded-full flex items-center justify-center mr-2 ${ke[dt]}`,children:ge[dt]}),w.jsx("span",{children:Qe})]})},dt)),(C||(e==null?void 0:e.email)==="joabychaves10@gmail.com")&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"my-2 border-t border-gray-200"}),w.jsx($t,{variant:"ghost",className:"w-full justify-start mb-1 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:b,children:w.jsxs("div",{className:"flex items-center",children:[w.jsx("div",{className:"h-7 w-7 rounded-full flex items-center justify-center mr-2 bg-red-100",children:w.jsx(_$,{className:"h-4 w-4 text-red-500"})}),w.jsx("span",{children:"Sair"})]})})]})]})]}),w.jsxs($t,{onClick:fe,onMouseDown:Q,className:`rounded-full shadow-lg flex items-center gap-2 ${ke[(e==null?void 0:e.role)||"visitor"]||ke.visitor}`,children:[w.jsxs("span",{className:"flex items-center gap-2",children:[ge[(e==null?void 0:e.role)||"visitor"],!i&&w.jsx("span",{className:"hidden sm:inline",children:Ce[(e==null?void 0:e.role)||"visitor"]})]}),!i&&(o?w.jsx(nC,{className:"h-4 w-4"}):w.jsx(xN,{className:"h-4 w-4"}))]})]})};var fS="focusScope.autoFocusOnMount",pS="focusScope.autoFocusOnUnmount",Zk={bubbles:!1,cancelable:!0},cZ="FocusScope",ob=Z.forwardRef((e,n)=>{const{loop:o=!1,trapped:u=!1,onMountAutoFocus:g,onUnmountAutoFocus:b,...C}=e,[i,L]=Z.useState(null),O=_s(g),U=_s(b),q=Z.useRef(null),G=Ln(n,K=>L(K)),ie=Z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Z.useEffect(()=>{if(u){let K=function(ue){if(ie.paused||!i)return;const fe=ue.target;i.contains(fe)?q.current=fe:Su(q.current,{select:!0})},re=function(ue){if(ie.paused||!i)return;const fe=ue.relatedTarget;fe!==null&&(i.contains(fe)||Su(q.current,{select:!0}))},Q=function(ue){if(document.activeElement===document.body)for(const ge of ue)ge.removedNodes.length>0&&Su(i)};document.addEventListener("focusin",K),document.addEventListener("focusout",re);const ee=new MutationObserver(Q);return i&&ee.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",K),document.removeEventListener("focusout",re),ee.disconnect()}}},[u,i,ie.paused]),Z.useEffect(()=>{if(i){Kk.add(ie);const K=document.activeElement;if(!i.contains(K)){const Q=new CustomEvent(fS,Zk);i.addEventListener(fS,O),i.dispatchEvent(Q),Q.defaultPrevented||(uZ(mZ(sz(i)),{select:!0}),document.activeElement===K&&Su(i))}return()=>{i.removeEventListener(fS,O),setTimeout(()=>{const Q=new CustomEvent(pS,Zk);i.addEventListener(pS,U),i.dispatchEvent(Q),Q.defaultPrevented||Su(K??document.body,{select:!0}),i.removeEventListener(pS,U),Kk.remove(ie)},0)}}},[i,O,U,ie]);const J=Z.useCallback(K=>{if(!o&&!u||ie.paused)return;const re=K.key==="Tab"&&!K.altKey&&!K.ctrlKey&&!K.metaKey,Q=document.activeElement;if(re&&Q){const ee=K.currentTarget,[ue,fe]=dZ(ee);ue&&fe?!K.shiftKey&&Q===fe?(K.preventDefault(),o&&Su(ue,{select:!0})):K.shiftKey&&Q===ue&&(K.preventDefault(),o&&Su(fe,{select:!0})):Q===ee&&K.preventDefault()}},[o,u,ie.paused]);return w.jsx(qr.div,{tabIndex:-1,...C,ref:G,onKeyDown:J})});ob.displayName=cZ;function uZ(e,{select:n=!1}={}){const o=document.activeElement;for(const u of e)if(Su(u,{select:n}),document.activeElement!==o)return}function dZ(e){const n=sz(e),o=Xk(n,e),u=Xk(n.reverse(),e);return[o,u]}function sz(e){const n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:u=>{const g=u.tagName==="INPUT"&&u.type==="hidden";return u.disabled||u.hidden||g?NodeFilter.FILTER_SKIP:u.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n}function Xk(e,n){for(const o of e)if(!hZ(o,{upTo:n}))return o}function hZ(e,{upTo:n}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n!==void 0&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function fZ(e){return e instanceof HTMLInputElement&&"select"in e}function Su(e,{select:n=!1}={}){if(e&&e.focus){const o=document.activeElement;e.focus({preventScroll:!0}),e!==o&&fZ(e)&&n&&e.select()}}var Kk=pZ();function pZ(){let e=[];return{add(n){const o=e[0];n!==o&&(o==null||o.pause()),e=Yk(e,n),e.unshift(n)},remove(n){var o;e=Yk(e,n),(o=e[0])==null||o.resume()}}}function Yk(e,n){const o=[...e],u=o.indexOf(n);return u!==-1&&o.splice(u,1),o}function mZ(e){return e.filter(n=>n.tagName!=="A")}var mS=0;function PC(){Z.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Jk()),document.body.insertAdjacentElement("beforeend",e[1]??Jk()),mS++,()=>{mS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(n=>n.remove()),mS--}},[])}function Jk(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Pl=function(){return Pl=Object.assign||function(n){for(var o,u=1,g=arguments.length;u<g;u++){o=arguments[u];for(var b in o)Object.prototype.hasOwnProperty.call(o,b)&&(n[b]=o[b])}return n},Pl.apply(this,arguments)};function oz(e,n){var o={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(o[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,u=Object.getOwnPropertySymbols(e);g<u.length;g++)n.indexOf(u[g])<0&&Object.prototype.propertyIsEnumerable.call(e,u[g])&&(o[u[g]]=e[u[g]]);return o}function gZ(e,n,o){if(o||arguments.length===2)for(var u=0,g=n.length,b;u<g;u++)(b||!(u in n))&&(b||(b=Array.prototype.slice.call(n,0,u)),b[u]=n[u]);return e.concat(b||Array.prototype.slice.call(n))}var Px="right-scroll-bar-position",Rx="width-before-scroll-bar",_Z="with-scroll-bars-hidden",yZ="--removed-body-scroll-bar-size";function gS(e,n){return typeof e=="function"?e(n):e&&(e.current=n),e}function vZ(e,n){var o=Z.useState(function(){return{value:e,callback:n,facade:{get current(){return o.value},set current(u){var g=o.value;g!==u&&(o.value=u,o.callback(u,g))}}}})[0];return o.callback=n,o.facade}var xZ=typeof window<"u"?Z.useLayoutEffect:Z.useEffect,Qk=new WeakMap;function bZ(e,n){var o=vZ(null,function(u){return e.forEach(function(g){return gS(g,u)})});return xZ(function(){var u=Qk.get(o);if(u){var g=new Set(u),b=new Set(e),C=o.current;g.forEach(function(i){b.has(i)||gS(i,null)}),b.forEach(function(i){g.has(i)||gS(i,C)})}Qk.set(o,e)},[e]),o}function wZ(e){return e}function SZ(e,n){n===void 0&&(n=wZ);var o=[],u=!1,g={read:function(){if(u)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return o.length?o[o.length-1]:e},useMedium:function(b){var C=n(b,u);return o.push(C),function(){o=o.filter(function(i){return i!==C})}},assignSyncMedium:function(b){for(u=!0;o.length;){var C=o;o=[],C.forEach(b)}o={push:function(i){return b(i)},filter:function(){return o}}},assignMedium:function(b){u=!0;var C=[];if(o.length){var i=o;o=[],i.forEach(b),C=o}var L=function(){var U=C;C=[],U.forEach(b)},O=function(){return Promise.resolve().then(L)};O(),o={push:function(U){C.push(U),O()},filter:function(U){return C=C.filter(U),o}}}};return g}function TZ(e){e===void 0&&(e={});var n=SZ(null);return n.options=Pl({async:!0,ssr:!1},e),n}var az=function(e){var n=e.sideCar,o=oz(e,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var u=n.read();if(!u)throw new Error("Sidecar medium not found");return Z.createElement(u,Pl({},o))};az.isSideCarExport=!0;function EZ(e,n){return e.useMedium(n),az}var lz=TZ(),_S=function(){},ab=Z.forwardRef(function(e,n){var o=Z.useRef(null),u=Z.useState({onScrollCapture:_S,onWheelCapture:_S,onTouchMoveCapture:_S}),g=u[0],b=u[1],C=e.forwardProps,i=e.children,L=e.className,O=e.removeScrollBar,U=e.enabled,q=e.shards,G=e.sideCar,ie=e.noIsolation,J=e.inert,K=e.allowPinchZoom,re=e.as,Q=re===void 0?"div":re,ee=e.gapMode,ue=oz(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),fe=G,ge=bZ([o,n]),ke=Pl(Pl({},ue),g);return Z.createElement(Z.Fragment,null,U&&Z.createElement(fe,{sideCar:lz,removeScrollBar:O,shards:q,noIsolation:ie,inert:J,setCallbacks:b,allowPinchZoom:!!K,lockRef:o,gapMode:ee}),C?Z.cloneElement(Z.Children.only(i),Pl(Pl({},ke),{ref:ge})):Z.createElement(Q,Pl({},ke,{className:L,ref:ge}),i))});ab.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ab.classNames={fullWidth:Rx,zeroRight:Px};var CZ=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function AZ(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var n=CZ();return n&&e.setAttribute("nonce",n),e}function MZ(e,n){e.styleSheet?e.styleSheet.cssText=n:e.appendChild(document.createTextNode(n))}function IZ(e){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(e)}var PZ=function(){var e=0,n=null;return{add:function(o){e==0&&(n=AZ())&&(MZ(n,o),IZ(n)),e++},remove:function(){e--,!e&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},RZ=function(){var e=PZ();return function(n,o){Z.useEffect(function(){return e.add(n),function(){e.remove()}},[n&&o])}},cz=function(){var e=RZ(),n=function(o){var u=o.styles,g=o.dynamic;return e(u,g),null};return n},kZ={left:0,top:0,right:0,gap:0},yS=function(e){return parseInt(e||"",10)||0},DZ=function(e){var n=window.getComputedStyle(document.body),o=n[e==="padding"?"paddingLeft":"marginLeft"],u=n[e==="padding"?"paddingTop":"marginTop"],g=n[e==="padding"?"paddingRight":"marginRight"];return[yS(o),yS(u),yS(g)]},LZ=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return kZ;var n=DZ(e),o=document.documentElement.clientWidth,u=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,u-o+n[2]-n[0])}},NZ=cz(),Op="data-scroll-locked",OZ=function(e,n,o,u){var g=e.left,b=e.top,C=e.right,i=e.gap;return o===void 0&&(o="margin"),`
  .`.concat(_Z,` {
   overflow: hidden `).concat(u,`;
   padding-right: `).concat(i,"px ").concat(u,`;
  }
  body[`).concat(Op,`] {
    overflow: hidden `).concat(u,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(u,";"),o==="margin"&&`
    padding-left: `.concat(g,`px;
    padding-top: `).concat(b,`px;
    padding-right: `).concat(C,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(u,`;
    `),o==="padding"&&"padding-right: ".concat(i,"px ").concat(u,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Px,` {
    right: `).concat(i,"px ").concat(u,`;
  }
  
  .`).concat(Rx,` {
    margin-right: `).concat(i,"px ").concat(u,`;
  }
  
  .`).concat(Px," .").concat(Px,` {
    right: 0 `).concat(u,`;
  }
  
  .`).concat(Rx," .").concat(Rx,` {
    margin-right: 0 `).concat(u,`;
  }
  
  body[`).concat(Op,`] {
    `).concat(yZ,": ").concat(i,`px;
  }
`)},e3=function(){var e=parseInt(document.body.getAttribute(Op)||"0",10);return isFinite(e)?e:0},zZ=function(){Z.useEffect(function(){return document.body.setAttribute(Op,(e3()+1).toString()),function(){var e=e3()-1;e<=0?document.body.removeAttribute(Op):document.body.setAttribute(Op,e.toString())}},[])},jZ=function(e){var n=e.noRelative,o=e.noImportant,u=e.gapMode,g=u===void 0?"margin":u;zZ();var b=Z.useMemo(function(){return LZ(g)},[g]);return Z.createElement(NZ,{styles:OZ(b,!n,g,o?"":"!important")})},qT=!1;if(typeof window<"u")try{var lx=Object.defineProperty({},"passive",{get:function(){return qT=!0,!0}});window.addEventListener("test",lx,lx),window.removeEventListener("test",lx,lx)}catch{qT=!1}var op=qT?{passive:!1}:!1,FZ=function(e){return e.tagName==="TEXTAREA"},uz=function(e,n){if(!(e instanceof Element))return!1;var o=window.getComputedStyle(e);return o[n]!=="hidden"&&!(o.overflowY===o.overflowX&&!FZ(e)&&o[n]==="visible")},BZ=function(e){return uz(e,"overflowY")},UZ=function(e){return uz(e,"overflowX")},t3=function(e,n){var o=n.ownerDocument,u=n;do{typeof ShadowRoot<"u"&&u instanceof ShadowRoot&&(u=u.host);var g=dz(e,u);if(g){var b=hz(e,u),C=b[1],i=b[2];if(C>i)return!0}u=u.parentNode}while(u&&u!==o.body);return!1},VZ=function(e){var n=e.scrollTop,o=e.scrollHeight,u=e.clientHeight;return[n,o,u]},$Z=function(e){var n=e.scrollLeft,o=e.scrollWidth,u=e.clientWidth;return[n,o,u]},dz=function(e,n){return e==="v"?BZ(n):UZ(n)},hz=function(e,n){return e==="v"?VZ(n):$Z(n)},GZ=function(e,n){return e==="h"&&n==="rtl"?-1:1},qZ=function(e,n,o,u,g){var b=GZ(e,window.getComputedStyle(n).direction),C=b*u,i=o.target,L=n.contains(i),O=!1,U=C>0,q=0,G=0;do{var ie=hz(e,i),J=ie[0],K=ie[1],re=ie[2],Q=K-re-b*J;(J||Q)&&dz(e,i)&&(q+=Q,G+=J),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!L&&i!==document.body||L&&(n.contains(i)||n===i));return(U&&(Math.abs(q)<1||!g)||!U&&(Math.abs(G)<1||!g))&&(O=!0),O},cx=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},r3=function(e){return[e.deltaX,e.deltaY]},n3=function(e){return e&&"current"in e?e.current:e},HZ=function(e,n){return e[0]===n[0]&&e[1]===n[1]},WZ=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},ZZ=0,ap=[];function XZ(e){var n=Z.useRef([]),o=Z.useRef([0,0]),u=Z.useRef(),g=Z.useState(ZZ++)[0],b=Z.useState(cz)[0],C=Z.useRef(e);Z.useEffect(function(){C.current=e},[e]),Z.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(g));var K=gZ([e.lockRef.current],(e.shards||[]).map(n3),!0).filter(Boolean);return K.forEach(function(re){return re.classList.add("allow-interactivity-".concat(g))}),function(){document.body.classList.remove("block-interactivity-".concat(g)),K.forEach(function(re){return re.classList.remove("allow-interactivity-".concat(g))})}}},[e.inert,e.lockRef.current,e.shards]);var i=Z.useCallback(function(K,re){if("touches"in K&&K.touches.length===2||K.type==="wheel"&&K.ctrlKey)return!C.current.allowPinchZoom;var Q=cx(K),ee=o.current,ue="deltaX"in K?K.deltaX:ee[0]-Q[0],fe="deltaY"in K?K.deltaY:ee[1]-Q[1],ge,ke=K.target,Ce=Math.abs(ue)>Math.abs(fe)?"h":"v";if("touches"in K&&Ce==="h"&&ke.type==="range")return!1;var Be=t3(Ce,ke);if(!Be)return!0;if(Be?ge=Ce:(ge=Ce==="v"?"h":"v",Be=t3(Ce,ke)),!Be)return!1;if(!u.current&&"changedTouches"in K&&(ue||fe)&&(u.current=ge),!ge)return!0;var dt=u.current||ge;return qZ(dt,re,K,dt==="h"?ue:fe,!0)},[]),L=Z.useCallback(function(K){var re=K;if(!(!ap.length||ap[ap.length-1]!==b)){var Q="deltaY"in re?r3(re):cx(re),ee=n.current.filter(function(ge){return ge.name===re.type&&(ge.target===re.target||re.target===ge.shadowParent)&&HZ(ge.delta,Q)})[0];if(ee&&ee.should){re.cancelable&&re.preventDefault();return}if(!ee){var ue=(C.current.shards||[]).map(n3).filter(Boolean).filter(function(ge){return ge.contains(re.target)}),fe=ue.length>0?i(re,ue[0]):!C.current.noIsolation;fe&&re.cancelable&&re.preventDefault()}}},[]),O=Z.useCallback(function(K,re,Q,ee){var ue={name:K,delta:re,target:Q,should:ee,shadowParent:KZ(Q)};n.current.push(ue),setTimeout(function(){n.current=n.current.filter(function(fe){return fe!==ue})},1)},[]),U=Z.useCallback(function(K){o.current=cx(K),u.current=void 0},[]),q=Z.useCallback(function(K){O(K.type,r3(K),K.target,i(K,e.lockRef.current))},[]),G=Z.useCallback(function(K){O(K.type,cx(K),K.target,i(K,e.lockRef.current))},[]);Z.useEffect(function(){return ap.push(b),e.setCallbacks({onScrollCapture:q,onWheelCapture:q,onTouchMoveCapture:G}),document.addEventListener("wheel",L,op),document.addEventListener("touchmove",L,op),document.addEventListener("touchstart",U,op),function(){ap=ap.filter(function(K){return K!==b}),document.removeEventListener("wheel",L,op),document.removeEventListener("touchmove",L,op),document.removeEventListener("touchstart",U,op)}},[]);var ie=e.removeScrollBar,J=e.inert;return Z.createElement(Z.Fragment,null,J?Z.createElement(b,{styles:WZ(g)}):null,ie?Z.createElement(jZ,{gapMode:e.gapMode}):null)}function KZ(e){for(var n=null;e!==null;)e instanceof ShadowRoot&&(n=e.host,e=e.host),e=e.parentNode;return n}const YZ=EZ(lz,XZ);var lb=Z.forwardRef(function(e,n){return Z.createElement(ab,Pl({},e,{ref:n,sideCar:YZ}))});lb.classNames=ab.classNames;var JZ=function(e){if(typeof document>"u")return null;var n=Array.isArray(e)?e[0]:e;return n.ownerDocument.body},lp=new WeakMap,ux=new WeakMap,dx={},vS=0,fz=function(e){return e&&(e.host||fz(e.parentNode))},QZ=function(e,n){return n.map(function(o){if(e.contains(o))return o;var u=fz(o);return u&&e.contains(u)?u:(console.error("aria-hidden",o,"in not contained inside",e,". Doing nothing"),null)}).filter(function(o){return!!o})},eX=function(e,n,o,u){var g=QZ(n,Array.isArray(e)?e:[e]);dx[o]||(dx[o]=new WeakMap);var b=dx[o],C=[],i=new Set,L=new Set(g),O=function(q){!q||i.has(q)||(i.add(q),O(q.parentNode))};g.forEach(O);var U=function(q){!q||L.has(q)||Array.prototype.forEach.call(q.children,function(G){if(i.has(G))U(G);else try{var ie=G.getAttribute(u),J=ie!==null&&ie!=="false",K=(lp.get(G)||0)+1,re=(b.get(G)||0)+1;lp.set(G,K),b.set(G,re),C.push(G),K===1&&J&&ux.set(G,!0),re===1&&G.setAttribute(o,"true"),J||G.setAttribute(u,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",G,Q)}})};return U(n),i.clear(),vS++,function(){C.forEach(function(q){var G=lp.get(q)-1,ie=b.get(q)-1;lp.set(q,G),b.set(q,ie),G||(ux.has(q)||q.removeAttribute(u),ux.delete(q)),ie||q.removeAttribute(o)}),vS--,vS||(lp=new WeakMap,lp=new WeakMap,ux=new WeakMap,dx={})}},RC=function(e,n,o){o===void 0&&(o="data-aria-hidden");var u=Array.from(Array.isArray(e)?e:[e]),g=JZ(e);return g?(u.push.apply(u,Array.from(g.querySelectorAll("[aria-live]"))),eX(u,g,o,"aria-hidden")):function(){return null}},kC="Dialog",[pz,DQ]=Jo(kC),[tX,il]=pz(kC),mz=e=>{const{__scopeDialog:n,children:o,open:u,defaultOpen:g,onOpenChange:b,modal:C=!0}=e,i=Z.useRef(null),L=Z.useRef(null),[O=!1,U]=Dl({prop:u,defaultProp:g,onChange:b});return w.jsx(tX,{scope:n,triggerRef:i,contentRef:L,contentId:Ka(),titleId:Ka(),descriptionId:Ka(),open:O,onOpenChange:U,onOpenToggle:Z.useCallback(()=>U(q=>!q),[U]),modal:C,children:o})};mz.displayName=kC;var gz="DialogTrigger",_z=Z.forwardRef((e,n)=>{const{__scopeDialog:o,...u}=e,g=il(gz,o),b=Ln(n,g.triggerRef);return w.jsx(qr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":g.open,"aria-controls":g.contentId,"data-state":NC(g.open),...u,ref:b,onClick:dr(e.onClick,g.onOpenToggle)})});_z.displayName=gz;var DC="DialogPortal",[rX,yz]=pz(DC,{forceMount:void 0}),vz=e=>{const{__scopeDialog:n,forceMount:o,children:u,container:g}=e,b=il(DC,n);return w.jsx(rX,{scope:n,forceMount:o,children:Z.Children.map(u,C=>w.jsx(rl,{present:o||b.open,children:w.jsx(Dy,{asChild:!0,container:g,children:C})}))})};vz.displayName=DC;var h1="DialogOverlay",xz=Z.forwardRef((e,n)=>{const o=yz(h1,e.__scopeDialog),{forceMount:u=o.forceMount,...g}=e,b=il(h1,e.__scopeDialog);return b.modal?w.jsx(rl,{present:u||b.open,children:w.jsx(nX,{...g,ref:n})}):null});xz.displayName=h1;var nX=Z.forwardRef((e,n)=>{const{__scopeDialog:o,...u}=e,g=il(h1,o);return w.jsx(lb,{as:Ku,allowPinchZoom:!0,shards:[g.contentRef],children:w.jsx(qr.div,{"data-state":NC(g.open),...u,ref:n,style:{pointerEvents:"auto",...u.style}})})}),Ph="DialogContent",bz=Z.forwardRef((e,n)=>{const o=yz(Ph,e.__scopeDialog),{forceMount:u=o.forceMount,...g}=e,b=il(Ph,e.__scopeDialog);return w.jsx(rl,{present:u||b.open,children:b.modal?w.jsx(iX,{...g,ref:n}):w.jsx(sX,{...g,ref:n})})});bz.displayName=Ph;var iX=Z.forwardRef((e,n)=>{const o=il(Ph,e.__scopeDialog),u=Z.useRef(null),g=Ln(n,o.contentRef,u);return Z.useEffect(()=>{const b=u.current;if(b)return RC(b)},[]),w.jsx(wz,{...e,ref:g,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:dr(e.onCloseAutoFocus,b=>{var C;b.preventDefault(),(C=o.triggerRef.current)==null||C.focus()}),onPointerDownOutside:dr(e.onPointerDownOutside,b=>{const C=b.detail.originalEvent,i=C.button===0&&C.ctrlKey===!0;(C.button===2||i)&&b.preventDefault()}),onFocusOutside:dr(e.onFocusOutside,b=>b.preventDefault())})}),sX=Z.forwardRef((e,n)=>{const o=il(Ph,e.__scopeDialog),u=Z.useRef(!1),g=Z.useRef(!1);return w.jsx(wz,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{var C,i;(C=e.onCloseAutoFocus)==null||C.call(e,b),b.defaultPrevented||(u.current||(i=o.triggerRef.current)==null||i.focus(),b.preventDefault()),u.current=!1,g.current=!1},onInteractOutside:b=>{var L,O;(L=e.onInteractOutside)==null||L.call(e,b),b.defaultPrevented||(u.current=!0,b.detail.originalEvent.type==="pointerdown"&&(g.current=!0));const C=b.target;((O=o.triggerRef.current)==null?void 0:O.contains(C))&&b.preventDefault(),b.detail.originalEvent.type==="focusin"&&g.current&&b.preventDefault()}})}),wz=Z.forwardRef((e,n)=>{const{__scopeDialog:o,trapFocus:u,onOpenAutoFocus:g,onCloseAutoFocus:b,...C}=e,i=il(Ph,o),L=Z.useRef(null),O=Ln(n,L);return PC(),w.jsxs(w.Fragment,{children:[w.jsx(ob,{asChild:!0,loop:!0,trapped:u,onMountAutoFocus:g,onUnmountAutoFocus:b,children:w.jsx(sm,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":NC(i.open),...C,ref:O,onDismiss:()=>i.onOpenChange(!1)})}),w.jsxs(w.Fragment,{children:[w.jsx(oX,{titleId:i.titleId}),w.jsx(lX,{contentRef:L,descriptionId:i.descriptionId})]})]})}),LC="DialogTitle",Sz=Z.forwardRef((e,n)=>{const{__scopeDialog:o,...u}=e,g=il(LC,o);return w.jsx(qr.h2,{id:g.titleId,...u,ref:n})});Sz.displayName=LC;var Tz="DialogDescription",Ez=Z.forwardRef((e,n)=>{const{__scopeDialog:o,...u}=e,g=il(Tz,o);return w.jsx(qr.p,{id:g.descriptionId,...u,ref:n})});Ez.displayName=Tz;var Cz="DialogClose",Az=Z.forwardRef((e,n)=>{const{__scopeDialog:o,...u}=e,g=il(Cz,o);return w.jsx(qr.button,{type:"button",...u,ref:n,onClick:dr(e.onClick,()=>g.onOpenChange(!1))})});Az.displayName=Cz;function NC(e){return e?"open":"closed"}var Mz="DialogTitleWarning",[LQ,Iz]=y8(Mz,{contentName:Ph,titleName:LC,docsSlug:"dialog"}),oX=({titleId:e})=>{const n=Iz(Mz),o=`\`${n.contentName}\` requires a \`${n.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${n.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${n.docsSlug}`;return Z.useEffect(()=>{e&&(document.getElementById(e)||console.error(o))},[o,e]),null},aX="DialogDescriptionWarning",lX=({contentRef:e,descriptionId:n})=>{const u=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Iz(aX).contentName}}.`;return Z.useEffect(()=>{var b;const g=(b=e.current)==null?void 0:b.getAttribute("aria-describedby");n&&g&&(document.getElementById(n)||console.warn(u))},[u,e,n]),null},Pz=mz,Rz=_z,kz=vz,cb=xz,ub=bz,db=Sz,hb=Ez,Dz=Az;const cX=Pz,uX=Rz,dX=kz,Lz=Z.forwardRef(({className:e,...n},o)=>w.jsx(cb,{className:Rr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...n,ref:o}));Lz.displayName=cb.displayName;const hX=Ny("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Nz=Z.forwardRef(({side:e="right",className:n,children:o,...u},g)=>w.jsxs(dX,{children:[w.jsx(Lz,{}),w.jsxs(ub,{ref:g,className:Rr(hX({side:e}),n),...u,children:[o,w.jsxs(Dz,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[w.jsx(Yu,{className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Nz.displayName=ub.displayName;const fX=Z.forwardRef(({className:e,...n},o)=>w.jsx(db,{ref:o,className:Rr("text-lg font-semibold text-foreground",e),...n}));fX.displayName=db.displayName;const pX=Z.forwardRef(({className:e,...n},o)=>w.jsx(hb,{ref:o,className:Rr("text-sm text-muted-foreground",e),...n}));pX.displayName=hb.displayName;const mX=Ny("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ti({className:e,variant:n,...o}){return w.jsx("div",{className:Rr(mX({variant:n}),e),...o})}var gX=Z.createContext(void 0);function fm(e){const n=Z.useContext(gX);return e||n||"ltr"}function _X(e,n=[]){let o=[];function u(b,C){const i=Z.createContext(C),L=o.length;o=[...o,C];function O(q){const{scope:G,children:ie,...J}=q,K=(G==null?void 0:G[e][L])||i,re=Z.useMemo(()=>J,Object.values(J));return w.jsx(K.Provider,{value:re,children:ie})}function U(q,G){const ie=(G==null?void 0:G[e][L])||i,J=Z.useContext(ie);if(J)return J;if(C!==void 0)return C;throw new Error(`\`${q}\` must be used within \`${b}\``)}return O.displayName=b+"Provider",[O,U]}const g=()=>{const b=o.map(C=>Z.createContext(C));return function(i){const L=(i==null?void 0:i[e])||b;return Z.useMemo(()=>({[`__scope${e}`]:{...i,[e]:L}}),[i,L])}};return g.scopeName=e,[u,yX(g,...n)]}function yX(...e){const n=e[0];if(e.length===1)return n;const o=()=>{const u=e.map(g=>({useScope:g(),scopeName:g.scopeName}));return function(b){const C=u.reduce((i,{useScope:L,scopeName:O})=>{const q=L(b)[`__scope${O}`];return{...i,...q}},{});return Z.useMemo(()=>({[`__scope${n.scopeName}`]:C}),[C])}};return o.scopeName=n.scopeName,o}var xS="rovingFocusGroup.onEntryFocus",vX={bubbles:!1,cancelable:!0},fb="RovingFocusGroup",[HT,Oz,xX]=B1(fb),[bX,pb]=_X(fb,[xX]),[wX,SX]=bX(fb),zz=Z.forwardRef((e,n)=>w.jsx(HT.Provider,{scope:e.__scopeRovingFocusGroup,children:w.jsx(HT.Slot,{scope:e.__scopeRovingFocusGroup,children:w.jsx(TX,{...e,ref:n})})}));zz.displayName=fb;var TX=Z.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,orientation:u,loop:g=!1,dir:b,currentTabStopId:C,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:L,onEntryFocus:O,preventScrollOnEntryFocus:U=!1,...q}=e,G=Z.useRef(null),ie=Ln(n,G),J=fm(b),[K=null,re]=Dl({prop:C,defaultProp:i,onChange:L}),[Q,ee]=Z.useState(!1),ue=_s(O),fe=Oz(o),ge=Z.useRef(!1),[ke,Ce]=Z.useState(0);return Z.useEffect(()=>{const Be=G.current;if(Be)return Be.addEventListener(xS,ue),()=>Be.removeEventListener(xS,ue)},[ue]),w.jsx(wX,{scope:o,orientation:u,dir:J,loop:g,currentTabStopId:K,onItemFocus:Z.useCallback(Be=>re(Be),[re]),onItemShiftTab:Z.useCallback(()=>ee(!0),[]),onFocusableItemAdd:Z.useCallback(()=>Ce(Be=>Be+1),[]),onFocusableItemRemove:Z.useCallback(()=>Ce(Be=>Be-1),[]),children:w.jsx(qr.div,{tabIndex:Q||ke===0?-1:0,"data-orientation":u,...q,ref:ie,style:{outline:"none",...e.style},onMouseDown:dr(e.onMouseDown,()=>{ge.current=!0}),onFocus:dr(e.onFocus,Be=>{const dt=!ge.current;if(Be.target===Be.currentTarget&&dt&&!Q){const Qe=new CustomEvent(xS,vX);if(Be.currentTarget.dispatchEvent(Qe),!Qe.defaultPrevented){const qe=fe().filter(Tt=>Tt.focusable),He=qe.find(Tt=>Tt.active),et=qe.find(Tt=>Tt.id===K),Ze=[He,et,...qe].filter(Boolean).map(Tt=>Tt.ref.current);Bz(Ze,U)}}ge.current=!1}),onBlur:dr(e.onBlur,()=>ee(!1))})})}),jz="RovingFocusGroupItem",Fz=Z.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,focusable:u=!0,active:g=!1,tabStopId:b,...C}=e,i=Ka(),L=b||i,O=SX(jz,o),U=O.currentTabStopId===L,q=Oz(o),{onFocusableItemAdd:G,onFocusableItemRemove:ie}=O;return Z.useEffect(()=>{if(u)return G(),()=>ie()},[u,G,ie]),w.jsx(HT.ItemSlot,{scope:o,id:L,focusable:u,active:g,children:w.jsx(qr.span,{tabIndex:U?0:-1,"data-orientation":O.orientation,...C,ref:n,onMouseDown:dr(e.onMouseDown,J=>{u?O.onItemFocus(L):J.preventDefault()}),onFocus:dr(e.onFocus,()=>O.onItemFocus(L)),onKeyDown:dr(e.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){O.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const K=AX(J,O.orientation,O.dir);if(K!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let Q=q().filter(ee=>ee.focusable).map(ee=>ee.ref.current);if(K==="last")Q.reverse();else if(K==="prev"||K==="next"){K==="prev"&&Q.reverse();const ee=Q.indexOf(J.currentTarget);Q=O.loop?MX(Q,ee+1):Q.slice(ee+1)}setTimeout(()=>Bz(Q))}})})})});Fz.displayName=jz;var EX={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function CX(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function AX(e,n,o){const u=CX(e.key,o);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(u))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(u)))return EX[u]}function Bz(e,n=!1){const o=document.activeElement;for(const u of e)if(u===o||(u.focus({preventScroll:n}),document.activeElement!==o))return}function MX(e,n){return e.map((o,u)=>e[(n+u)%e.length])}var Uz=zz,Vz=Fz,WT=["Enter"," "],IX=["ArrowDown","PageUp","Home"],$z=["ArrowUp","PageDown","End"],PX=[...IX,...$z],RX={ltr:[...WT,"ArrowRight"],rtl:[...WT,"ArrowLeft"]},kX={ltr:["ArrowLeft"],rtl:["ArrowRight"]},$y="Menu",[vy,DX,LX]=B1($y),[Bh,Gz]=Jo($y,[LX,cm,pb]),mb=cm(),qz=pb(),[NX,Uh]=Bh($y),[OX,Gy]=Bh($y),Hz=e=>{const{__scopeMenu:n,open:o=!1,children:u,dir:g,onOpenChange:b,modal:C=!0}=e,i=mb(n),[L,O]=Z.useState(null),U=Z.useRef(!1),q=_s(b),G=fm(g);return Z.useEffect(()=>{const ie=()=>{U.current=!0,document.addEventListener("pointerdown",J,{capture:!0,once:!0}),document.addEventListener("pointermove",J,{capture:!0,once:!0})},J=()=>U.current=!1;return document.addEventListener("keydown",ie,{capture:!0}),()=>{document.removeEventListener("keydown",ie,{capture:!0}),document.removeEventListener("pointerdown",J,{capture:!0}),document.removeEventListener("pointermove",J,{capture:!0})}},[]),w.jsx(eO,{...i,children:w.jsx(NX,{scope:n,open:o,onOpenChange:q,content:L,onContentChange:O,children:w.jsx(OX,{scope:n,onClose:Z.useCallback(()=>q(!1),[q]),isUsingKeyboardRef:U,dir:G,modal:C,children:u})})})};Hz.displayName=$y;var zX="MenuAnchor",OC=Z.forwardRef((e,n)=>{const{__scopeMenu:o,...u}=e,g=mb(o);return w.jsx(_C,{...g,...u,ref:n})});OC.displayName=zX;var zC="MenuPortal",[jX,Wz]=Bh(zC,{forceMount:void 0}),Zz=e=>{const{__scopeMenu:n,forceMount:o,children:u,container:g}=e,b=Uh(zC,n);return w.jsx(jX,{scope:n,forceMount:o,children:w.jsx(rl,{present:o||b.open,children:w.jsx(Dy,{asChild:!0,container:g,children:u})})})};Zz.displayName=zC;var fa="MenuContent",[FX,jC]=Bh(fa),Xz=Z.forwardRef((e,n)=>{const o=Wz(fa,e.__scopeMenu),{forceMount:u=o.forceMount,...g}=e,b=Uh(fa,e.__scopeMenu),C=Gy(fa,e.__scopeMenu);return w.jsx(vy.Provider,{scope:e.__scopeMenu,children:w.jsx(rl,{present:u||b.open,children:w.jsx(vy.Slot,{scope:e.__scopeMenu,children:C.modal?w.jsx(BX,{...g,ref:n}):w.jsx(UX,{...g,ref:n})})})})}),BX=Z.forwardRef((e,n)=>{const o=Uh(fa,e.__scopeMenu),u=Z.useRef(null),g=Ln(n,u);return Z.useEffect(()=>{const b=u.current;if(b)return RC(b)},[]),w.jsx(FC,{...e,ref:g,trapFocus:o.open,disableOutsidePointerEvents:o.open,disableOutsideScroll:!0,onFocusOutside:dr(e.onFocusOutside,b=>b.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>o.onOpenChange(!1)})}),UX=Z.forwardRef((e,n)=>{const o=Uh(fa,e.__scopeMenu);return w.jsx(FC,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>o.onOpenChange(!1)})}),FC=Z.forwardRef((e,n)=>{const{__scopeMenu:o,loop:u=!1,trapFocus:g,onOpenAutoFocus:b,onCloseAutoFocus:C,disableOutsidePointerEvents:i,onEntryFocus:L,onEscapeKeyDown:O,onPointerDownOutside:U,onFocusOutside:q,onInteractOutside:G,onDismiss:ie,disableOutsideScroll:J,...K}=e,re=Uh(fa,o),Q=Gy(fa,o),ee=mb(o),ue=qz(o),fe=DX(o),[ge,ke]=Z.useState(null),Ce=Z.useRef(null),Be=Ln(n,Ce,re.onContentChange),dt=Z.useRef(0),Qe=Z.useRef(""),qe=Z.useRef(0),He=Z.useRef(null),et=Z.useRef("right"),mt=Z.useRef(0),Ze=J?lb:Z.Fragment,Tt=J?{as:Ku,allowPinchZoom:!0}:void 0,Gt=Je=>{var Dt,ir;const rt=Qe.current+Je,bt=fe().filter(zr=>!zr.disabled),kt=document.activeElement,At=(Dt=bt.find(zr=>zr.ref.current===kt))==null?void 0:Dt.textValue,_r=bt.map(zr=>zr.textValue),cn=QX(_r,rt,At),pr=(ir=bt.find(zr=>zr.textValue===cn))==null?void 0:ir.ref.current;(function zr(he){Qe.current=he,window.clearTimeout(dt.current),he!==""&&(dt.current=window.setTimeout(()=>zr(""),1e3))})(rt),pr&&setTimeout(()=>pr.focus())};Z.useEffect(()=>()=>window.clearTimeout(dt.current),[]),PC();const ct=Z.useCallback(Je=>{var bt,kt;return et.current===((bt=He.current)==null?void 0:bt.side)&&tK(Je,(kt=He.current)==null?void 0:kt.area)},[]);return w.jsx(FX,{scope:o,searchRef:Qe,onItemEnter:Z.useCallback(Je=>{ct(Je)&&Je.preventDefault()},[ct]),onItemLeave:Z.useCallback(Je=>{var rt;ct(Je)||((rt=Ce.current)==null||rt.focus(),ke(null))},[ct]),onTriggerLeave:Z.useCallback(Je=>{ct(Je)&&Je.preventDefault()},[ct]),pointerGraceTimerRef:qe,onPointerGraceIntentChange:Z.useCallback(Je=>{He.current=Je},[]),children:w.jsx(Ze,{...Tt,children:w.jsx(ob,{asChild:!0,trapped:g,onMountAutoFocus:dr(b,Je=>{var rt;Je.preventDefault(),(rt=Ce.current)==null||rt.focus({preventScroll:!0})}),onUnmountAutoFocus:C,children:w.jsx(sm,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:O,onPointerDownOutside:U,onFocusOutside:q,onInteractOutside:G,onDismiss:ie,children:w.jsx(Uz,{asChild:!0,...ue,dir:Q.dir,orientation:"vertical",loop:u,currentTabStopId:ge,onCurrentTabStopIdChange:ke,onEntryFocus:dr(L,Je=>{Q.isUsingKeyboardRef.current||Je.preventDefault()}),preventScrollOnEntryFocus:!0,children:w.jsx(yC,{role:"menu","aria-orientation":"vertical","data-state":dj(re.open),"data-radix-menu-content":"",dir:Q.dir,...ee,...K,ref:Be,style:{outline:"none",...K.style},onKeyDown:dr(K.onKeyDown,Je=>{const bt=Je.target.closest("[data-radix-menu-content]")===Je.currentTarget,kt=Je.ctrlKey||Je.altKey||Je.metaKey,At=Je.key.length===1;bt&&(Je.key==="Tab"&&Je.preventDefault(),!kt&&At&&Gt(Je.key));const _r=Ce.current;if(Je.target!==_r||!PX.includes(Je.key))return;Je.preventDefault();const pr=fe().filter(Dt=>!Dt.disabled).map(Dt=>Dt.ref.current);$z.includes(Je.key)&&pr.reverse(),YX(pr)}),onBlur:dr(e.onBlur,Je=>{Je.currentTarget.contains(Je.target)||(window.clearTimeout(dt.current),Qe.current="")}),onPointerMove:dr(e.onPointerMove,xy(Je=>{const rt=Je.target,bt=mt.current!==Je.clientX;if(Je.currentTarget.contains(rt)&&bt){const kt=Je.clientX>mt.current?"right":"left";et.current=kt,mt.current=Je.clientX}}))})})})})})})});Xz.displayName=fa;var VX="MenuGroup",BC=Z.forwardRef((e,n)=>{const{__scopeMenu:o,...u}=e;return w.jsx(qr.div,{role:"group",...u,ref:n})});BC.displayName=VX;var $X="MenuLabel",Kz=Z.forwardRef((e,n)=>{const{__scopeMenu:o,...u}=e;return w.jsx(qr.div,{...u,ref:n})});Kz.displayName=$X;var f1="MenuItem",i3="menu.itemSelect",gb=Z.forwardRef((e,n)=>{const{disabled:o=!1,onSelect:u,...g}=e,b=Z.useRef(null),C=Gy(f1,e.__scopeMenu),i=jC(f1,e.__scopeMenu),L=Ln(n,b),O=Z.useRef(!1),U=()=>{const q=b.current;if(!o&&q){const G=new CustomEvent(i3,{bubbles:!0,cancelable:!0});q.addEventListener(i3,ie=>u==null?void 0:u(ie),{once:!0}),JE(q,G),G.defaultPrevented?O.current=!1:C.onClose()}};return w.jsx(Yz,{...g,ref:L,disabled:o,onClick:dr(e.onClick,U),onPointerDown:q=>{var G;(G=e.onPointerDown)==null||G.call(e,q),O.current=!0},onPointerUp:dr(e.onPointerUp,q=>{var G;O.current||(G=q.currentTarget)==null||G.click()}),onKeyDown:dr(e.onKeyDown,q=>{const G=i.searchRef.current!=="";o||G&&q.key===" "||WT.includes(q.key)&&(q.currentTarget.click(),q.preventDefault())})})});gb.displayName=f1;var Yz=Z.forwardRef((e,n)=>{const{__scopeMenu:o,disabled:u=!1,textValue:g,...b}=e,C=jC(f1,o),i=qz(o),L=Z.useRef(null),O=Ln(n,L),[U,q]=Z.useState(!1),[G,ie]=Z.useState("");return Z.useEffect(()=>{const J=L.current;J&&ie((J.textContent??"").trim())},[b.children]),w.jsx(vy.ItemSlot,{scope:o,disabled:u,textValue:g??G,children:w.jsx(Vz,{asChild:!0,...i,focusable:!u,children:w.jsx(qr.div,{role:"menuitem","data-highlighted":U?"":void 0,"aria-disabled":u||void 0,"data-disabled":u?"":void 0,...b,ref:O,onPointerMove:dr(e.onPointerMove,xy(J=>{u?C.onItemLeave(J):(C.onItemEnter(J),J.defaultPrevented||J.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:dr(e.onPointerLeave,xy(J=>C.onItemLeave(J))),onFocus:dr(e.onFocus,()=>q(!0)),onBlur:dr(e.onBlur,()=>q(!1))})})})}),GX="MenuCheckboxItem",Jz=Z.forwardRef((e,n)=>{const{checked:o=!1,onCheckedChange:u,...g}=e;return w.jsx(nj,{scope:e.__scopeMenu,checked:o,children:w.jsx(gb,{role:"menuitemcheckbox","aria-checked":p1(o)?"mixed":o,...g,ref:n,"data-state":VC(o),onSelect:dr(g.onSelect,()=>u==null?void 0:u(p1(o)?!0:!o),{checkForDefaultPrevented:!1})})})});Jz.displayName=GX;var Qz="MenuRadioGroup",[qX,HX]=Bh(Qz,{value:void 0,onValueChange:()=>{}}),ej=Z.forwardRef((e,n)=>{const{value:o,onValueChange:u,...g}=e,b=_s(u);return w.jsx(qX,{scope:e.__scopeMenu,value:o,onValueChange:b,children:w.jsx(BC,{...g,ref:n})})});ej.displayName=Qz;var tj="MenuRadioItem",rj=Z.forwardRef((e,n)=>{const{value:o,...u}=e,g=HX(tj,e.__scopeMenu),b=o===g.value;return w.jsx(nj,{scope:e.__scopeMenu,checked:b,children:w.jsx(gb,{role:"menuitemradio","aria-checked":b,...u,ref:n,"data-state":VC(b),onSelect:dr(u.onSelect,()=>{var C;return(C=g.onValueChange)==null?void 0:C.call(g,o)},{checkForDefaultPrevented:!1})})})});rj.displayName=tj;var UC="MenuItemIndicator",[nj,WX]=Bh(UC,{checked:!1}),ij=Z.forwardRef((e,n)=>{const{__scopeMenu:o,forceMount:u,...g}=e,b=WX(UC,o);return w.jsx(rl,{present:u||p1(b.checked)||b.checked===!0,children:w.jsx(qr.span,{...g,ref:n,"data-state":VC(b.checked)})})});ij.displayName=UC;var ZX="MenuSeparator",sj=Z.forwardRef((e,n)=>{const{__scopeMenu:o,...u}=e;return w.jsx(qr.div,{role:"separator","aria-orientation":"horizontal",...u,ref:n})});sj.displayName=ZX;var XX="MenuArrow",oj=Z.forwardRef((e,n)=>{const{__scopeMenu:o,...u}=e,g=mb(o);return w.jsx(vC,{...g,...u,ref:n})});oj.displayName=XX;var KX="MenuSub",[NQ,aj]=Bh(KX),P_="MenuSubTrigger",lj=Z.forwardRef((e,n)=>{const o=Uh(P_,e.__scopeMenu),u=Gy(P_,e.__scopeMenu),g=aj(P_,e.__scopeMenu),b=jC(P_,e.__scopeMenu),C=Z.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:L}=b,O={__scopeMenu:e.__scopeMenu},U=Z.useCallback(()=>{C.current&&window.clearTimeout(C.current),C.current=null},[]);return Z.useEffect(()=>U,[U]),Z.useEffect(()=>{const q=i.current;return()=>{window.clearTimeout(q),L(null)}},[i,L]),w.jsx(OC,{asChild:!0,...O,children:w.jsx(Yz,{id:g.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":g.contentId,"data-state":dj(o.open),...e,ref:F1(n,g.onTriggerChange),onClick:q=>{var G;(G=e.onClick)==null||G.call(e,q),!(e.disabled||q.defaultPrevented)&&(q.currentTarget.focus(),o.open||o.onOpenChange(!0))},onPointerMove:dr(e.onPointerMove,xy(q=>{b.onItemEnter(q),!q.defaultPrevented&&!e.disabled&&!o.open&&!C.current&&(b.onPointerGraceIntentChange(null),C.current=window.setTimeout(()=>{o.onOpenChange(!0),U()},100))})),onPointerLeave:dr(e.onPointerLeave,xy(q=>{var ie,J;U();const G=(ie=o.content)==null?void 0:ie.getBoundingClientRect();if(G){const K=(J=o.content)==null?void 0:J.dataset.side,re=K==="right",Q=re?-5:5,ee=G[re?"left":"right"],ue=G[re?"right":"left"];b.onPointerGraceIntentChange({area:[{x:q.clientX+Q,y:q.clientY},{x:ee,y:G.top},{x:ue,y:G.top},{x:ue,y:G.bottom},{x:ee,y:G.bottom}],side:K}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>b.onPointerGraceIntentChange(null),300)}else{if(b.onTriggerLeave(q),q.defaultPrevented)return;b.onPointerGraceIntentChange(null)}})),onKeyDown:dr(e.onKeyDown,q=>{var ie;const G=b.searchRef.current!=="";e.disabled||G&&q.key===" "||RX[u.dir].includes(q.key)&&(o.onOpenChange(!0),(ie=o.content)==null||ie.focus(),q.preventDefault())})})})});lj.displayName=P_;var cj="MenuSubContent",uj=Z.forwardRef((e,n)=>{const o=Wz(fa,e.__scopeMenu),{forceMount:u=o.forceMount,...g}=e,b=Uh(fa,e.__scopeMenu),C=Gy(fa,e.__scopeMenu),i=aj(cj,e.__scopeMenu),L=Z.useRef(null),O=Ln(n,L);return w.jsx(vy.Provider,{scope:e.__scopeMenu,children:w.jsx(rl,{present:u||b.open,children:w.jsx(vy.Slot,{scope:e.__scopeMenu,children:w.jsx(FC,{id:i.contentId,"aria-labelledby":i.triggerId,...g,ref:O,align:"start",side:C.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:U=>{var q;C.isUsingKeyboardRef.current&&((q=L.current)==null||q.focus()),U.preventDefault()},onCloseAutoFocus:U=>U.preventDefault(),onFocusOutside:dr(e.onFocusOutside,U=>{U.target!==i.trigger&&b.onOpenChange(!1)}),onEscapeKeyDown:dr(e.onEscapeKeyDown,U=>{C.onClose(),U.preventDefault()}),onKeyDown:dr(e.onKeyDown,U=>{var ie;const q=U.currentTarget.contains(U.target),G=kX[C.dir].includes(U.key);q&&G&&(b.onOpenChange(!1),(ie=i.trigger)==null||ie.focus(),U.preventDefault())})})})})})});uj.displayName=cj;function dj(e){return e?"open":"closed"}function p1(e){return e==="indeterminate"}function VC(e){return p1(e)?"indeterminate":e?"checked":"unchecked"}function YX(e){const n=document.activeElement;for(const o of e)if(o===n||(o.focus(),document.activeElement!==n))return}function JX(e,n){return e.map((o,u)=>e[(n+u)%e.length])}function QX(e,n,o){const g=n.length>1&&Array.from(n).every(O=>O===n[0])?n[0]:n,b=o?e.indexOf(o):-1;let C=JX(e,Math.max(b,0));g.length===1&&(C=C.filter(O=>O!==o));const L=C.find(O=>O.toLowerCase().startsWith(g.toLowerCase()));return L!==o?L:void 0}function eK(e,n){const{x:o,y:u}=e;let g=!1;for(let b=0,C=n.length-1;b<n.length;C=b++){const i=n[b].x,L=n[b].y,O=n[C].x,U=n[C].y;L>u!=U>u&&o<(O-i)*(u-L)/(U-L)+i&&(g=!g)}return g}function tK(e,n){if(!n)return!1;const o={x:e.clientX,y:e.clientY};return eK(o,n)}function xy(e){return n=>n.pointerType==="mouse"?e(n):void 0}var rK=Hz,nK=OC,iK=Zz,sK=Xz,oK=BC,aK=Kz,lK=gb,cK=Jz,uK=ej,dK=rj,hK=ij,fK=sj,pK=oj,mK=lj,gK=uj,$C="DropdownMenu",[_K,OQ]=Jo($C,[Gz]),oo=Gz(),[yK,hj]=_K($C),fj=e=>{const{__scopeDropdownMenu:n,children:o,dir:u,open:g,defaultOpen:b,onOpenChange:C,modal:i=!0}=e,L=oo(n),O=Z.useRef(null),[U=!1,q]=Dl({prop:g,defaultProp:b,onChange:C});return w.jsx(yK,{scope:n,triggerId:Ka(),triggerRef:O,contentId:Ka(),open:U,onOpenChange:q,onOpenToggle:Z.useCallback(()=>q(G=>!G),[q]),modal:i,children:w.jsx(rK,{...L,open:U,onOpenChange:q,dir:u,modal:i,children:o})})};fj.displayName=$C;var pj="DropdownMenuTrigger",mj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,disabled:u=!1,...g}=e,b=hj(pj,o),C=oo(o);return w.jsx(nK,{asChild:!0,...C,children:w.jsx(qr.button,{type:"button",id:b.triggerId,"aria-haspopup":"menu","aria-expanded":b.open,"aria-controls":b.open?b.contentId:void 0,"data-state":b.open?"open":"closed","data-disabled":u?"":void 0,disabled:u,...g,ref:F1(n,b.triggerRef),onPointerDown:dr(e.onPointerDown,i=>{!u&&i.button===0&&i.ctrlKey===!1&&(b.onOpenToggle(),b.open||i.preventDefault())}),onKeyDown:dr(e.onKeyDown,i=>{u||(["Enter"," "].includes(i.key)&&b.onOpenToggle(),i.key==="ArrowDown"&&b.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});mj.displayName=pj;var vK="DropdownMenuPortal",gj=e=>{const{__scopeDropdownMenu:n,...o}=e,u=oo(n);return w.jsx(iK,{...u,...o})};gj.displayName=vK;var _j="DropdownMenuContent",yj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=hj(_j,o),b=oo(o),C=Z.useRef(!1);return w.jsx(sK,{id:g.contentId,"aria-labelledby":g.triggerId,...b,...u,ref:n,onCloseAutoFocus:dr(e.onCloseAutoFocus,i=>{var L;C.current||(L=g.triggerRef.current)==null||L.focus(),C.current=!1,i.preventDefault()}),onInteractOutside:dr(e.onInteractOutside,i=>{const L=i.detail.originalEvent,O=L.button===0&&L.ctrlKey===!0,U=L.button===2||O;(!g.modal||U)&&(C.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});yj.displayName=_j;var xK="DropdownMenuGroup",bK=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(oK,{...g,...u,ref:n})});bK.displayName=xK;var wK="DropdownMenuLabel",vj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(aK,{...g,...u,ref:n})});vj.displayName=wK;var SK="DropdownMenuItem",xj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(lK,{...g,...u,ref:n})});xj.displayName=SK;var TK="DropdownMenuCheckboxItem",bj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(cK,{...g,...u,ref:n})});bj.displayName=TK;var EK="DropdownMenuRadioGroup",wj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(uK,{...g,...u,ref:n})});wj.displayName=EK;var CK="DropdownMenuRadioItem",Sj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(dK,{...g,...u,ref:n})});Sj.displayName=CK;var AK="DropdownMenuItemIndicator",Tj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(hK,{...g,...u,ref:n})});Tj.displayName=AK;var MK="DropdownMenuSeparator",Ej=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(fK,{...g,...u,ref:n})});Ej.displayName=MK;var IK="DropdownMenuArrow",PK=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(pK,{...g,...u,ref:n})});PK.displayName=IK;var RK="DropdownMenuSubTrigger",Cj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(mK,{...g,...u,ref:n})});Cj.displayName=RK;var kK="DropdownMenuSubContent",Aj=Z.forwardRef((e,n)=>{const{__scopeDropdownMenu:o,...u}=e,g=oo(o);return w.jsx(gK,{...g,...u,ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Aj.displayName=kK;var DK=fj,LK=mj,NK=gj,Mj=yj,Ij=vj,Pj=xj,Rj=bj,OK=wj,kj=Sj,Dj=Tj,Lj=Ej,Nj=Cj,Oj=Aj;const Sp=DK,Tp=LK,hx=OK,zK=Z.forwardRef(({className:e,inset:n,children:o,...u},g)=>w.jsxs(Nj,{ref:g,className:Rr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",e),...u,children:[o,w.jsx(a$,{className:"ml-auto h-4 w-4"})]}));zK.displayName=Nj.displayName;const jK=Z.forwardRef(({className:e,...n},o)=>w.jsx(Oj,{ref:o,className:Rr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));jK.displayName=Oj.displayName;const hh=Z.forwardRef(({className:e,sideOffset:n=4,...o},u)=>w.jsx(NK,{children:w.jsx(Mj,{ref:u,sideOffset:n,className:Rr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o})}));hh.displayName=Mj.displayName;const R_=Z.forwardRef(({className:e,inset:n,...o},u)=>w.jsx(Pj,{ref:u,className:Rr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",e),...o}));R_.displayName=Pj.displayName;const FK=Z.forwardRef(({className:e,children:n,checked:o,...u},g)=>w.jsxs(Rj,{ref:g,className:Rr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:o,...u,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(Dj,{children:w.jsx(rC,{className:"h-4 w-4"})})}),n]}));FK.displayName=Rj.displayName;const Fo=Z.forwardRef(({className:e,children:n,...o},u)=>w.jsxs(kj,{ref:u,className:Rr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...o,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(Dj,{children:w.jsx(bN,{className:"h-2 w-2 fill-current"})})}),n]}));Fo.displayName=kj.displayName;const fh=Z.forwardRef(({className:e,inset:n,...o},u)=>w.jsx(Ij,{ref:u,className:Rr("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",e),...o}));fh.displayName=Ij.displayName;const cc=Z.forwardRef(({className:e,...n},o)=>w.jsx(Lj,{ref:o,className:Rr("-mx-1 my-1 h-px bg-muted",e),...n}));cc.displayName=Lj.displayName;const BK=()=>{const{isAdminMode:e,isClientMode:n,currentTeam:o,subdomain:u,switchToAdmin:g,switchToClient:b}=Vy();return e?w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"gap-2",children:[w.jsx(h$,{className:"h-4 w-4 text-yellow-500"}),w.jsx("span",{children:"Delliapp Admin Geral"}),w.jsx(Ti,{variant:"secondary",children:"Super Admin"})]})}),w.jsxs(hh,{align:"end",className:"w-56",children:[w.jsx(fh,{children:"Delliapp Admin Geral"}),w.jsx(cc,{}),w.jsx("div",{className:"px-2 py-1 text-sm text-muted-foreground",children:"Você está no modo super admin com acesso total à plataforma."}),w.jsx(cc,{}),w.jsxs(R_,{onClick:()=>b("joao"),className:"gap-2",children:[w.jsx(M_,{className:"h-4 w-4"}),"Testar como: Restaurante do João"]}),w.jsxs(R_,{onClick:()=>b("bella"),className:"gap-2",children:[w.jsx(M_,{className:"h-4 w-4"}),"Testar como: Pizzaria Bella"]}),w.jsxs(R_,{onClick:()=>b("burger"),className:"gap-2",children:[w.jsx(M_,{className:"h-4 w-4"}),"Testar como: Burger House"]})]})]}):n&&o?w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"gap-2",children:[w.jsx(M_,{className:"h-4 w-4 text-blue-500"}),w.jsx("span",{children:o.name}),w.jsx(Ti,{variant:"default",children:u})]})}),w.jsxs(hh,{align:"end",className:"w-56",children:[w.jsx(fh,{children:"Modo Cliente"}),w.jsx(cc,{}),w.jsxs("div",{className:"px-2 py-1 text-sm text-muted-foreground",children:[w.jsxs("div",{children:[w.jsx("strong",{children:"Cliente:"})," ",o.name]}),w.jsxs("div",{children:[w.jsx("strong",{children:"Slug:"})," ",o.slug]}),w.jsxs("div",{children:[w.jsx("strong",{children:"Subdomínio:"})," ",u]})]}),w.jsx(cc,{}),w.jsxs(R_,{onClick:g,className:"gap-2",children:[w.jsx(s$,{className:"h-4 w-4"}),"Voltar ao Modo Admin"]})]})]}):w.jsxs(Ti,{variant:"outline",className:"gap-2",children:[w.jsx("div",{className:"animate-pulse h-2 w-2 bg-gray-400 rounded-full"}),"Carregando..."]})},UK=()=>{const{totalItems:e,toggleCart:n}=ad(),{currentUser:o}=Fh(),u=(o==null?void 0:o.role)==="admin"||(o==null?void 0:o.role)==="restaurant_owner";return w.jsx("header",{className:"fixed top-0 z-50 w-full bg-white shadow-sm",children:w.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center",children:[w.jsxs(cX,{children:[w.jsx(uX,{asChild:!0,children:w.jsx($t,{variant:"ghost",size:"icon",className:"mr-2",children:w.jsx(y$,{className:"h-6 w-6"})})}),w.jsx(Nz,{side:"left",className:"w-[300px] sm:w-[400px]",children:w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsx("h3",{className:"text-lg font-bold mb-4",children:"Menu"}),w.jsxs("nav",{className:"flex flex-col gap-4",children:[w.jsx(rc,{to:"/",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Home"}),w.jsx(rc,{to:"/login",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Login / Cadastro"}),w.jsx(rc,{to:"/order-tracking",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Acompanhar Pedido"}),["waiter","chef","admin","restaurant_owner"].includes((o==null?void 0:o.role)||"")&&w.jsx(rc,{to:"/order-management",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Gerenciamento de Pedidos"}),["chef","admin","restaurant_owner"].includes((o==null?void 0:o.role)||"")&&w.jsx(rc,{to:"/kitchen-management",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Gerenciamento de Cozinha"}),u&&w.jsxs(w.Fragment,{children:[w.jsx(rc,{to:"/product-management",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Gerenciamento de Produtos"}),w.jsx(rc,{to:"/user-management",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Gerenciamento de Usuários"}),w.jsx(rc,{to:"/api-management",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Gerenciamento de APIs"}),w.jsx(rc,{to:"/dashboard-saas",className:"text-lg font-medium hover:text-menu-primary py-2 border-b border-gray-100",children:"Dashboard SAAS"})]})]})]})})]}),w.jsx("a",{href:"/",className:"flex items-center space-x-2",children:w.jsxs("h1",{className:"text-2xl font-bold text-menu-primary",children:["Cardápio",w.jsx("span",{className:"text-menu-accent",children:"Digital"})]})})]}),w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx(BK,{}),w.jsxs($t,{onClick:n,variant:"ghost",className:"relative p-2","aria-label":"Shopping cart",children:[w.jsx(Mx,{className:"h-6 w-6"}),e>0&&w.jsx("span",{className:"absolute -top-1 -right-1 bg-menu-primary text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:e})]})]})]})})},Un=Z.forwardRef(({className:e,...n},o)=>w.jsx("div",{ref:o,className:Rr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...n}));Un.displayName="Card";const wi=Z.forwardRef(({className:e,...n},o)=>w.jsx("div",{ref:o,className:Rr("flex flex-col space-y-1.5 p-6",e),...n}));wi.displayName="CardHeader";const Si=Z.forwardRef(({className:e,...n},o)=>w.jsx("h3",{ref:o,className:Rr("text-2xl font-semibold leading-none tracking-tight",e),...n}));Si.displayName="CardTitle";const ls=Z.forwardRef(({className:e,...n},o)=>w.jsx("p",{ref:o,className:Rr("text-sm text-muted-foreground",e),...n}));ls.displayName="CardDescription";const fi=Z.forwardRef(({className:e,...n},o)=>w.jsx("div",{ref:o,className:Rr("p-6 pt-0",e),...n}));fi.displayName="CardContent";const by=Z.forwardRef(({className:e,...n},o)=>w.jsx("div",{ref:o,className:Rr("flex items-center p-6 pt-0",e),...n}));by.displayName="CardFooter";const Nl=Pz,zj=Rz,VK=kz,jj=Z.forwardRef(({className:e,...n},o)=>w.jsx(cb,{ref:o,className:Rr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...n}));jj.displayName=cb.displayName;const tl=Z.forwardRef(({className:e,children:n,...o},u)=>w.jsxs(VK,{children:[w.jsx(jj,{}),w.jsxs(ub,{ref:u,className:Rr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...o,children:[n,w.jsxs(Dz,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[w.jsx(Yu,{className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));tl.displayName=ub.displayName;const Ol=({className:e,...n})=>w.jsx("div",{className:Rr("flex flex-col space-y-1.5 text-center sm:text-left",e),...n});Ol.displayName="DialogHeader";const wy=({className:e,...n})=>w.jsx("div",{className:Rr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...n});wy.displayName="DialogFooter";const zl=Z.forwardRef(({className:e,...n},o)=>w.jsx(db,{ref:o,className:Rr("text-lg font-semibold leading-none tracking-tight",e),...n}));zl.displayName=db.displayName;const _b=Z.forwardRef(({className:e,...n},o)=>w.jsx(hb,{ref:o,className:Rr("text-sm text-muted-foreground",e),...n}));_b.displayName=hb.displayName;const m1=Z.forwardRef(({className:e,...n},o)=>w.jsx("textarea",{className:Rr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...n}));m1.displayName="Textarea";function $K(e){return Object.prototype.toString.call(e)==="[object Object]"}function s3(e){return $K(e)||Array.isArray(e)}function GK(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function GC(e,n){const o=Object.keys(e),u=Object.keys(n);if(o.length!==u.length)return!1;const g=JSON.stringify(Object.keys(e.breakpoints||{})),b=JSON.stringify(Object.keys(n.breakpoints||{}));return g!==b?!1:o.every(C=>{const i=e[C],L=n[C];return typeof i=="function"?`${i}`==`${L}`:!s3(i)||!s3(L)?i===L:GC(i,L)})}function o3(e){return e.concat().sort((n,o)=>n.name>o.name?1:-1).map(n=>n.options)}function qK(e,n){if(e.length!==n.length)return!1;const o=o3(e),u=o3(n);return o.every((g,b)=>{const C=u[b];return GC(g,C)})}function qC(e){return typeof e=="number"}function ZT(e){return typeof e=="string"}function yb(e){return typeof e=="boolean"}function a3(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ei(e){return Math.abs(e)}function HC(e){return Math.sign(e)}function Z_(e,n){return Ei(e-n)}function HK(e,n){if(e===0||n===0||Ei(e)<=Ei(n))return 0;const o=Z_(Ei(e),Ei(n));return Ei(o/e)}function Sy(e){return Ty(e).map(Number)}function Ya(e){return e[qy(e)]}function qy(e){return Math.max(0,e.length-1)}function WC(e,n){return n===qy(e)}function l3(e,n=0){return Array.from(Array(e),(o,u)=>n+u)}function Ty(e){return Object.keys(e)}function Fj(e,n){return[e,n].reduce((o,u)=>(Ty(u).forEach(g=>{const b=o[g],C=u[g],i=a3(b)&&a3(C);o[g]=i?Fj(b,C):C}),o),{})}function XT(e,n){return typeof n.MouseEvent<"u"&&e instanceof n.MouseEvent}function WK(e,n){const o={start:u,center:g,end:b};function u(){return 0}function g(L){return b(L)/2}function b(L){return n-L}function C(L,O){return ZT(e)?o[e](L):e(n,L,O)}return{measure:C}}function Ey(){let e=[];function n(g,b,C,i={passive:!0}){let L;if("addEventListener"in g)g.addEventListener(b,C,i),L=()=>g.removeEventListener(b,C,i);else{const O=g;O.addListener(C),L=()=>O.removeListener(C)}return e.push(L),u}function o(){e=e.filter(g=>g())}const u={add:n,clear:o};return u}function ZK(e,n,o,u){const g=Ey(),b=1e3/60;let C=null,i=0,L=0;function O(){g.add(e,"visibilitychange",()=>{e.hidden&&J()})}function U(){ie(),g.clear()}function q(re){if(!L)return;C||(C=re);const Q=re-C;for(C=re,i+=Q;i>=b;)o(b),i-=b;const ee=i/b;u(ee),L&&n.requestAnimationFrame(q)}function G(){L||(L=n.requestAnimationFrame(q))}function ie(){n.cancelAnimationFrame(L),C=null,i=0,L=0}function J(){C=null,i=0}return{init:O,destroy:U,start:G,stop:ie,update:()=>o(b),render:u}}function XK(e,n){const o=n==="rtl",u=e==="y",g=u?"y":"x",b=u?"x":"y",C=!u&&o?-1:1,i=U(),L=q();function O(J){const{height:K,width:re}=J;return u?K:re}function U(){return u?"top":o?"right":"left"}function q(){return u?"bottom":o?"left":"right"}function G(J){return J*C}return{scroll:g,cross:b,startEdge:i,endEdge:L,measureSize:O,direction:G}}function Rh(e=0,n=0){const o=Ei(e-n);function u(O){return O<e}function g(O){return O>n}function b(O){return u(O)||g(O)}function C(O){return b(O)?u(O)?e:n:O}function i(O){return o?O-o*Math.ceil((O-n)/o):O}return{length:o,max:n,min:e,constrain:C,reachedAny:b,reachedMax:g,reachedMin:u,removeOffset:i}}function Bj(e,n,o){const{constrain:u}=Rh(0,e),g=e+1;let b=C(n);function C(G){return o?Ei((g+G)%g):u(G)}function i(){return b}function L(G){return b=C(G),q}function O(G){return U().set(i()+G)}function U(){return Bj(e,i(),o)}const q={get:i,set:L,add:O,clone:U};return q}function KK(e,n,o,u,g,b,C,i,L,O,U,q,G,ie,J,K,re,Q,ee){const{cross:ue,direction:fe}=e,ge=["INPUT","SELECT","TEXTAREA"],ke={passive:!1},Ce=Ey(),Be=Ey(),dt=Rh(50,225).constrain(ie.measure(20)),Qe={mouse:300,touch:400},qe={mouse:500,touch:600},He=J?43:25;let et=!1,mt=0,Ze=0,Tt=!1,Gt=!1,ct=!1,Je=!1;function rt(Ht){if(!ee)return;function jr(dn){(yb(ee)||ee(Ht,dn))&&pr(dn)}const wt=n;Ce.add(wt,"dragstart",dn=>dn.preventDefault(),ke).add(wt,"touchmove",()=>{},ke).add(wt,"touchend",()=>{}).add(wt,"touchstart",jr).add(wt,"mousedown",jr).add(wt,"touchcancel",ir).add(wt,"contextmenu",ir).add(wt,"click",zr,!0)}function bt(){Ce.clear(),Be.clear()}function kt(){const Ht=Je?o:n;Be.add(Ht,"touchmove",Dt,ke).add(Ht,"touchend",ir).add(Ht,"mousemove",Dt,ke).add(Ht,"mouseup",ir)}function At(Ht){const jr=Ht.nodeName||"";return ge.includes(jr)}function _r(){return(J?qe:Qe)[Je?"mouse":"touch"]}function cn(Ht,jr){const wt=q.add(HC(Ht)*-1),dn=U.byDistance(Ht,!J).distance;return J||Ei(Ht)<dt?dn:re&&jr?dn*.5:U.byIndex(wt.get(),0).distance}function pr(Ht){const jr=XT(Ht,u);Je=jr,ct=J&&jr&&!Ht.buttons&&et,et=Z_(g.get(),C.get())>=2,!(jr&&Ht.button!==0)&&(At(Ht.target)||(Tt=!0,b.pointerDown(Ht),O.useFriction(0).useDuration(0),g.set(C),kt(),mt=b.readPoint(Ht),Ze=b.readPoint(Ht,ue),G.emit("pointerDown")))}function Dt(Ht){if(!XT(Ht,u)&&Ht.touches.length>=2)return ir(Ht);const wt=b.readPoint(Ht),dn=b.readPoint(Ht,ue),rn=Z_(wt,mt),Vn=Z_(dn,Ze);if(!Gt&&!Je&&(!Ht.cancelable||(Gt=rn>Vn,!Gt)))return ir(Ht);const wr=b.pointerMove(Ht);rn>K&&(ct=!0),O.useFriction(.3).useDuration(.75),i.start(),g.add(fe(wr)),Ht.preventDefault()}function ir(Ht){const wt=U.byDistance(0,!1).index!==q.get(),dn=b.pointerUp(Ht)*_r(),rn=cn(fe(dn),wt),Vn=HK(dn,rn),wr=He-10*Vn,Hr=Q+Vn/50;Gt=!1,Tt=!1,Be.clear(),O.useDuration(wr).useFriction(Hr),L.distance(rn,!J),Je=!1,G.emit("pointerUp")}function zr(Ht){ct&&(Ht.stopPropagation(),Ht.preventDefault(),ct=!1)}function he(){return Tt}return{init:rt,destroy:bt,pointerDown:he}}function YK(e,n){let u,g;function b(q){return q.timeStamp}function C(q,G){const J=`client${(G||e.scroll)==="x"?"X":"Y"}`;return(XT(q,n)?q:q.touches[0])[J]}function i(q){return u=q,g=q,C(q)}function L(q){const G=C(q)-C(g),ie=b(q)-b(u)>170;return g=q,ie&&(u=q),G}function O(q){if(!u||!g)return 0;const G=C(g)-C(u),ie=b(q)-b(u),J=b(q)-b(g)>170,K=G/ie;return ie&&!J&&Ei(K)>.1?K:0}return{pointerDown:i,pointerMove:L,pointerUp:O,readPoint:C}}function JK(){function e(o){const{offsetTop:u,offsetLeft:g,offsetWidth:b,offsetHeight:C}=o;return{top:u,right:g+b,bottom:u+C,left:g,width:b,height:C}}return{measure:e}}function QK(e){function n(u){return e*(u/100)}return{measure:n}}function eY(e,n,o,u,g,b,C){const i=[e].concat(u);let L,O,U=[],q=!1;function G(re){return g.measureSize(C.measure(re))}function ie(re){if(!b)return;O=G(e),U=u.map(G);function Q(ee){for(const ue of ee){if(q)return;const fe=ue.target===e,ge=u.indexOf(ue.target),ke=fe?O:U[ge],Ce=G(fe?e:u[ge]);if(Ei(Ce-ke)>=.5){re.reInit(),n.emit("resize");break}}}L=new ResizeObserver(ee=>{(yb(b)||b(re,ee))&&Q(ee)}),o.requestAnimationFrame(()=>{i.forEach(ee=>L.observe(ee))})}function J(){q=!0,L&&L.disconnect()}return{init:ie,destroy:J}}function tY(e,n,o,u,g,b){let C=0,i=0,L=g,O=b,U=e.get(),q=0;function G(ke){const Ce=ke/1e3,Be=L*Ce,dt=u.get()-e.get(),Qe=!L;let qe=0;return Qe?(C=0,o.set(u),e.set(u),qe=dt):(o.set(e),C+=dt/Be,C*=O,U+=C,e.add(C*Ce),qe=U-q),i=HC(qe),q=U,ge}function ie(){const ke=u.get()-n.get();return Ei(ke)<.001}function J(){return L}function K(){return i}function re(){return C}function Q(){return ue(g)}function ee(){return fe(b)}function ue(ke){return L=ke,ge}function fe(ke){return O=ke,ge}const ge={direction:K,duration:J,velocity:re,seek:G,settled:ie,useBaseFriction:ee,useBaseDuration:Q,useFriction:fe,useDuration:ue};return ge}function rY(e,n,o,u,g){const b=g.measure(10),C=g.measure(50),i=Rh(.1,.99);let L=!1;function O(){return!(L||!e.reachedAny(o.get())||!e.reachedAny(n.get()))}function U(ie){if(!O())return;const J=e.reachedMin(n.get())?"min":"max",K=Ei(e[J]-n.get()),re=o.get()-n.get(),Q=i.constrain(K/C);o.subtract(re*Q),!ie&&Ei(re)<b&&(o.set(e.constrain(o.get())),u.useDuration(25).useBaseFriction())}function q(ie){L=!ie}return{shouldConstrain:O,constrain:U,toggleActive:q}}function nY(e,n,o,u,g){const b=Rh(-n+e,0),C=q(),i=U(),L=G();function O(J,K){return Z_(J,K)<1}function U(){const J=C[0],K=Ya(C),re=C.lastIndexOf(J),Q=C.indexOf(K)+1;return Rh(re,Q)}function q(){return o.map((J,K)=>{const{min:re,max:Q}=b,ee=b.constrain(J),ue=!K,fe=WC(o,K);return ue?Q:fe||O(re,ee)?re:O(Q,ee)?Q:ee}).map(J=>parseFloat(J.toFixed(3)))}function G(){if(n<=e+g)return[b.max];if(u==="keepSnaps")return C;const{min:J,max:K}=i;return C.slice(J,K)}return{snapsContained:L,scrollContainLimit:i}}function iY(e,n,o){const u=n[0],g=o?u-e:Ya(n);return{limit:Rh(g,u)}}function sY(e,n,o,u){const b=n.min+.1,C=n.max+.1,{reachedMin:i,reachedMax:L}=Rh(b,C);function O(G){return G===1?L(o.get()):G===-1?i(o.get()):!1}function U(G){if(!O(G))return;const ie=e*(G*-1);u.forEach(J=>J.add(ie))}return{loop:U}}function oY(e){const{max:n,length:o}=e;function u(b){const C=b-n;return o?C/-o:0}return{get:u}}function aY(e,n,o,u,g){const{startEdge:b,endEdge:C}=e,{groupSlides:i}=g,L=q().map(n.measure),O=G(),U=ie();function q(){return i(u).map(K=>Ya(K)[C]-K[0][b]).map(Ei)}function G(){return u.map(K=>o[b]-K[b]).map(K=>-Ei(K))}function ie(){return i(O).map(K=>K[0]).map((K,re)=>K+L[re])}return{snaps:O,snapsAligned:U}}function lY(e,n,o,u,g,b){const{groupSlides:C}=g,{min:i,max:L}=u,O=U();function U(){const G=C(b),ie=!e||n==="keepSnaps";return o.length===1?[b]:ie?G:G.slice(i,L).map((J,K,re)=>{const Q=!K,ee=WC(re,K);if(Q){const ue=Ya(re[0])+1;return l3(ue)}if(ee){const ue=qy(b)-Ya(re)[0]+1;return l3(ue,Ya(re)[0])}return J})}return{slideRegistry:O}}function cY(e,n,o,u,g){const{reachedAny:b,removeOffset:C,constrain:i}=u;function L(J){return J.concat().sort((K,re)=>Ei(K)-Ei(re))[0]}function O(J){const K=e?C(J):i(J),re=n.map((ee,ue)=>({diff:U(ee-K,0),index:ue})).sort((ee,ue)=>Ei(ee.diff)-Ei(ue.diff)),{index:Q}=re[0];return{index:Q,distance:K}}function U(J,K){const re=[J,J+o,J-o];if(!e)return J;if(!K)return L(re);const Q=re.filter(ee=>HC(ee)===K);return Q.length?L(Q):Ya(re)-o}function q(J,K){const re=n[J]-g.get(),Q=U(re,K);return{index:J,distance:Q}}function G(J,K){const re=g.get()+J,{index:Q,distance:ee}=O(re),ue=!e&&b(re);if(!K||ue)return{index:Q,distance:J};const fe=n[Q]-ee,ge=J+U(fe,0);return{index:Q,distance:ge}}return{byDistance:G,byIndex:q,shortcut:U}}function uY(e,n,o,u,g,b,C){function i(q){const G=q.distance,ie=q.index!==n.get();b.add(G),G&&(u.duration()?e.start():(e.update(),e.render(1),e.update())),ie&&(o.set(n.get()),n.set(q.index),C.emit("select"))}function L(q,G){const ie=g.byDistance(q,G);i(ie)}function O(q,G){const ie=n.clone().set(q),J=g.byIndex(ie.get(),G);i(J)}return{distance:L,index:O}}function dY(e,n,o,u,g,b,C,i){const L={passive:!0,capture:!0};let O=0;function U(ie){if(!i)return;function J(K){if(new Date().getTime()-O>10)return;C.emit("slideFocusStart"),e.scrollLeft=0;const ee=o.findIndex(ue=>ue.includes(K));qC(ee)&&(g.useDuration(0),u.index(ee,0),C.emit("slideFocus"))}b.add(document,"keydown",q,!1),n.forEach((K,re)=>{b.add(K,"focus",Q=>{(yb(i)||i(ie,Q))&&J(re)},L)})}function q(ie){ie.code==="Tab"&&(O=new Date().getTime())}return{init:U}}function k_(e){let n=e;function o(){return n}function u(L){n=C(L)}function g(L){n+=C(L)}function b(L){n-=C(L)}function C(L){return qC(L)?L:L.get()}return{get:o,set:u,add:g,subtract:b}}function Uj(e,n){const o=e.scroll==="x"?b:C,u=n.style;let g=!1;function b(q){return`translate3d(${q}px,0px,0px)`}function C(q){return`translate3d(0px,${q}px,0px)`}function i(q){g||(u.transform=o(e.direction(q)))}function L(q){g=!q}function O(){g||(u.transform="",n.getAttribute("style")||n.removeAttribute("style"))}return{clear:O,to:i,toggleActive:L}}function hY(e,n,o,u,g,b,C,i,L){const U=Sy(g),q=Sy(g).reverse(),G=Q().concat(ee());function ie(Ce,Be){return Ce.reduce((dt,Qe)=>dt-g[Qe],Be)}function J(Ce,Be){return Ce.reduce((dt,Qe)=>ie(dt,Be)>0?dt.concat([Qe]):dt,[])}function K(Ce){return b.map((Be,dt)=>({start:Be-u[dt]+.5+Ce,end:Be+n-.5+Ce}))}function re(Ce,Be,dt){const Qe=K(Be);return Ce.map(qe=>{const He=dt?0:-o,et=dt?o:0,mt=dt?"end":"start",Ze=Qe[qe][mt];return{index:qe,loopPoint:Ze,slideLocation:k_(-1),translate:Uj(e,L[qe]),target:()=>i.get()>Ze?He:et}})}function Q(){const Ce=C[0],Be=J(q,Ce);return re(Be,o,!1)}function ee(){const Ce=n-C[0]-1,Be=J(U,Ce);return re(Be,-o,!0)}function ue(){return G.every(({index:Ce})=>{const Be=U.filter(dt=>dt!==Ce);return ie(Be,n)<=.1})}function fe(){G.forEach(Ce=>{const{target:Be,translate:dt,slideLocation:Qe}=Ce,qe=Be();qe!==Qe.get()&&(dt.to(qe),Qe.set(qe))})}function ge(){G.forEach(Ce=>Ce.translate.clear())}return{canLoop:ue,clear:ge,loop:fe,loopPoints:G}}function fY(e,n,o){let u,g=!1;function b(L){if(!o)return;function O(U){for(const q of U)if(q.type==="childList"){L.reInit(),n.emit("slidesChanged");break}}u=new MutationObserver(U=>{g||(yb(o)||o(L,U))&&O(U)}),u.observe(e,{childList:!0})}function C(){u&&u.disconnect(),g=!0}return{init:b,destroy:C}}function pY(e,n,o,u){const g={};let b=null,C=null,i,L=!1;function O(){i=new IntersectionObserver(J=>{L||(J.forEach(K=>{const re=n.indexOf(K.target);g[re]=K}),b=null,C=null,o.emit("slidesInView"))},{root:e.parentElement,threshold:u}),n.forEach(J=>i.observe(J))}function U(){i&&i.disconnect(),L=!0}function q(J){return Ty(g).reduce((K,re)=>{const Q=parseInt(re),{isIntersecting:ee}=g[Q];return(J&&ee||!J&&!ee)&&K.push(Q),K},[])}function G(J=!0){if(J&&b)return b;if(!J&&C)return C;const K=q(J);return J&&(b=K),J||(C=K),K}return{init:O,destroy:U,get:G}}function mY(e,n,o,u,g,b){const{measureSize:C,startEdge:i,endEdge:L}=e,O=o[0]&&g,U=J(),q=K(),G=o.map(C),ie=re();function J(){if(!O)return 0;const ee=o[0];return Ei(n[i]-ee[i])}function K(){if(!O)return 0;const ee=b.getComputedStyle(Ya(u));return parseFloat(ee.getPropertyValue(`margin-${L}`))}function re(){return o.map((ee,ue,fe)=>{const ge=!ue,ke=WC(fe,ue);return ge?G[ue]+U:ke?G[ue]+q:fe[ue+1][i]-ee[i]}).map(Ei)}return{slideSizes:G,slideSizesWithGaps:ie,startGap:U,endGap:q}}function gY(e,n,o,u,g,b,C,i,L){const{startEdge:O,endEdge:U,direction:q}=e,G=qC(o);function ie(Q,ee){return Sy(Q).filter(ue=>ue%ee===0).map(ue=>Q.slice(ue,ue+ee))}function J(Q){return Q.length?Sy(Q).reduce((ee,ue,fe)=>{const ge=Ya(ee)||0,ke=ge===0,Ce=ue===qy(Q),Be=g[O]-b[ge][O],dt=g[O]-b[ue][U],Qe=!u&&ke?q(C):0,qe=!u&&Ce?q(i):0,He=Ei(dt-qe-(Be+Qe));return fe&&He>n+L&&ee.push(ue),Ce&&ee.push(Q.length),ee},[]).map((ee,ue,fe)=>{const ge=Math.max(fe[ue-1]||0);return Q.slice(ge,ee)}):[]}function K(Q){return G?ie(Q,o):J(Q)}return{groupSlides:K}}function _Y(e,n,o,u,g,b,C){const{align:i,axis:L,direction:O,startIndex:U,loop:q,duration:G,dragFree:ie,dragThreshold:J,inViewThreshold:K,slidesToScroll:re,skipSnaps:Q,containScroll:ee,watchResize:ue,watchSlides:fe,watchDrag:ge,watchFocus:ke}=b,Ce=2,Be=JK(),dt=Be.measure(n),Qe=o.map(Be.measure),qe=XK(L,O),He=qe.measureSize(dt),et=QK(He),mt=WK(i,He),Ze=!q&&!!ee,Tt=q||!!ee,{slideSizes:Gt,slideSizesWithGaps:ct,startGap:Je,endGap:rt}=mY(qe,dt,Qe,o,Tt,g),bt=gY(qe,He,re,q,dt,Qe,Je,rt,Ce),{snaps:kt,snapsAligned:At}=aY(qe,mt,dt,Qe,bt),_r=-Ya(kt)+Ya(ct),{snapsContained:cn,scrollContainLimit:pr}=nY(He,_r,At,ee,Ce),Dt=Ze?cn:At,{limit:ir}=iY(_r,Dt,q),zr=Bj(qy(Dt),U,q),he=zr.clone(),br=Sy(o),Ht=({dragHandler:ui,scrollBody:Ao,scrollBounds:ao,options:{loop:bs}},$s)=>{bs||ao.constrain(ui.pointerDown()),Ao.seek($s)},jr=({scrollBody:ui,translate:Ao,location:ao,offsetLocation:bs,scrollLooper:$s,slideLooper:Oi,dragHandler:Ji,animation:Cn,eventHandler:sr,scrollBounds:An,options:{loop:vn}},jn)=>{const _i=ui.settled(),lo=!An.shouldConstrain(),Mo=vn?_i:_i&&lo;Mo&&!Ji.pointerDown()&&(Cn.stop(),sr.emit("settle")),Mo||sr.emit("scroll");const vc=ao.get()*jn+wr.get()*(1-jn);bs.set(vc),vn&&($s.loop(ui.direction()),Oi.loop()),Ao.to(bs.get())},wt=ZK(u,g,ui=>Ht(Mi,ui),ui=>jr(Mi,ui)),dn=.68,rn=Dt[zr.get()],Vn=k_(rn),wr=k_(rn),Hr=k_(rn),Yn=k_(rn),ys=tY(Vn,Hr,wr,Yn,G,dn),vs=cY(q,Dt,_r,ir,Yn),xs=uY(wt,zr,he,ys,vs,Yn,C),Tr=oY(ir),mi=Ey(),Is=pY(n,o,C,K),{slideRegistry:Yi}=lY(Ze,ee,Dt,pr,bt,br),gi=dY(e,o,Yi,xs,ys,mi,C,ke),Mi={ownerDocument:u,ownerWindow:g,eventHandler:C,containerRect:dt,slideRects:Qe,animation:wt,axis:qe,dragHandler:KK(qe,e,u,g,Yn,YK(qe,g),Vn,wt,xs,ys,vs,zr,C,et,ie,J,Q,dn,ge),eventStore:mi,percentOfView:et,index:zr,indexPrevious:he,limit:ir,location:Vn,offsetLocation:Hr,previousLocation:wr,options:b,resizeHandler:eY(n,C,g,o,qe,ue,Be),scrollBody:ys,scrollBounds:rY(ir,Hr,Yn,ys,et),scrollLooper:sY(_r,ir,Hr,[Vn,Hr,wr,Yn]),scrollProgress:Tr,scrollSnapList:Dt.map(Tr.get),scrollSnaps:Dt,scrollTarget:vs,scrollTo:xs,slideLooper:hY(qe,He,_r,Gt,ct,kt,Dt,Hr,o),slideFocus:gi,slidesHandler:fY(n,C,fe),slidesInView:Is,slideIndexes:br,slideRegistry:Yi,slidesToScroll:bt,target:Yn,translate:Uj(qe,n)};return Mi}function yY(){let e={},n;function o(O){n=O}function u(O){return e[O]||[]}function g(O){return u(O).forEach(U=>U(n,O)),L}function b(O,U){return e[O]=u(O).concat([U]),L}function C(O,U){return e[O]=u(O).filter(q=>q!==U),L}function i(){e={}}const L={init:o,emit:g,off:C,on:b,clear:i};return L}const vY={align:"center",axis:"x",container:null,slides:null,containScroll:"trimSnaps",direction:"ltr",slidesToScroll:1,inViewThreshold:0,breakpoints:{},dragFree:!1,dragThreshold:10,loop:!1,skipSnaps:!1,duration:25,startIndex:0,active:!0,watchDrag:!0,watchResize:!0,watchSlides:!0,watchFocus:!0};function xY(e){function n(b,C){return Fj(b,C||{})}function o(b){const C=b.breakpoints||{},i=Ty(C).filter(L=>e.matchMedia(L).matches).map(L=>C[L]).reduce((L,O)=>n(L,O),{});return n(b,i)}function u(b){return b.map(C=>Ty(C.breakpoints||{})).reduce((C,i)=>C.concat(i),[]).map(e.matchMedia)}return{mergeOptions:n,optionsAtMedia:o,optionsMediaQueries:u}}function bY(e){let n=[];function o(b,C){return n=C.filter(({options:i})=>e.optionsAtMedia(i).active!==!1),n.forEach(i=>i.init(b,e)),C.reduce((i,L)=>Object.assign(i,{[L.name]:L}),{})}function u(){n=n.filter(b=>b.destroy())}return{init:o,destroy:u}}function g1(e,n,o){const u=e.ownerDocument,g=u.defaultView,b=xY(g),C=bY(b),i=Ey(),L=yY(),{mergeOptions:O,optionsAtMedia:U,optionsMediaQueries:q}=b,{on:G,off:ie,emit:J}=L,K=qe;let re=!1,Q,ee=O(vY,g1.globalOptions),ue=O(ee),fe=[],ge,ke,Ce;function Be(){const{container:br,slides:Ht}=ue;ke=(ZT(br)?e.querySelector(br):br)||e.children[0];const wt=ZT(Ht)?ke.querySelectorAll(Ht):Ht;Ce=[].slice.call(wt||ke.children)}function dt(br){const Ht=_Y(e,ke,Ce,u,g,br,L);if(br.loop&&!Ht.slideLooper.canLoop()){const jr=Object.assign({},br,{loop:!1});return dt(jr)}return Ht}function Qe(br,Ht){re||(ee=O(ee,br),ue=U(ee),fe=Ht||fe,Be(),Q=dt(ue),q([ee,...fe.map(({options:jr})=>jr)]).forEach(jr=>i.add(jr,"change",qe)),ue.active&&(Q.translate.to(Q.location.get()),Q.animation.init(),Q.slidesInView.init(),Q.slideFocus.init(he),Q.eventHandler.init(he),Q.resizeHandler.init(he),Q.slidesHandler.init(he),Q.options.loop&&Q.slideLooper.loop(),ke.offsetParent&&Ce.length&&Q.dragHandler.init(he),ge=C.init(he,fe)))}function qe(br,Ht){const jr=bt();He(),Qe(O({startIndex:jr},br),Ht),L.emit("reInit")}function He(){Q.dragHandler.destroy(),Q.eventStore.clear(),Q.translate.clear(),Q.slideLooper.clear(),Q.resizeHandler.destroy(),Q.slidesHandler.destroy(),Q.slidesInView.destroy(),Q.animation.destroy(),C.destroy(),i.clear()}function et(){re||(re=!0,i.clear(),He(),L.emit("destroy"),L.clear())}function mt(br,Ht,jr){!ue.active||re||(Q.scrollBody.useBaseFriction().useDuration(Ht===!0?0:ue.duration),Q.scrollTo.index(br,jr||0))}function Ze(br){const Ht=Q.index.add(1).get();mt(Ht,br,-1)}function Tt(br){const Ht=Q.index.add(-1).get();mt(Ht,br,1)}function Gt(){return Q.index.add(1).get()!==bt()}function ct(){return Q.index.add(-1).get()!==bt()}function Je(){return Q.scrollSnapList}function rt(){return Q.scrollProgress.get(Q.location.get())}function bt(){return Q.index.get()}function kt(){return Q.indexPrevious.get()}function At(){return Q.slidesInView.get()}function _r(){return Q.slidesInView.get(!1)}function cn(){return ge}function pr(){return Q}function Dt(){return e}function ir(){return ke}function zr(){return Ce}const he={canScrollNext:Gt,canScrollPrev:ct,containerNode:ir,internalEngine:pr,destroy:et,off:ie,on:G,emit:J,plugins:cn,previousScrollSnap:kt,reInit:K,rootNode:Dt,scrollNext:Ze,scrollPrev:Tt,scrollProgress:rt,scrollSnapList:Je,scrollTo:mt,selectedScrollSnap:bt,slideNodes:zr,slidesInView:At,slidesNotInView:_r};return Qe(n,o),setTimeout(()=>L.emit("init"),0),he}g1.globalOptions=void 0;function ZC(e={},n=[]){const o=Z.useRef(e),u=Z.useRef(n),[g,b]=Z.useState(),[C,i]=Z.useState(),L=Z.useCallback(()=>{g&&g.reInit(o.current,u.current)},[g]);return Z.useEffect(()=>{GC(o.current,e)||(o.current=e,L())},[e,L]),Z.useEffect(()=>{qK(u.current,n)||(u.current=n,L())},[n,L]),Z.useEffect(()=>{if(GK()&&C){g1.globalOptions=ZC.globalOptions;const O=g1(C,o.current,u.current);return b(O),()=>O.destroy()}else b(void 0)},[C,b]),[i,g]}ZC.globalOptions=void 0;const Vj=Z.createContext(null);function vb(){const e=Z.useContext(Vj);if(!e)throw new Error("useCarousel must be used within a <Carousel />");return e}const $j=Z.forwardRef(({orientation:e="horizontal",opts:n,setApi:o,plugins:u,className:g,children:b,...C},i)=>{const[L,O]=ZC({...n,axis:e==="horizontal"?"x":"y"},u),[U,q]=Z.useState(!1),[G,ie]=Z.useState(!1),J=Z.useCallback(ee=>{ee&&(q(ee.canScrollPrev()),ie(ee.canScrollNext()))},[]),K=Z.useCallback(()=>{O==null||O.scrollPrev()},[O]),re=Z.useCallback(()=>{O==null||O.scrollNext()},[O]),Q=Z.useCallback(ee=>{ee.key==="ArrowLeft"?(ee.preventDefault(),K()):ee.key==="ArrowRight"&&(ee.preventDefault(),re())},[K,re]);return Z.useEffect(()=>{!O||!o||o(O)},[O,o]),Z.useEffect(()=>{if(O)return J(O),O.on("reInit",J),O.on("select",J),()=>{O==null||O.off("select",J)}},[O,J]),w.jsx(Vj.Provider,{value:{carouselRef:L,api:O,opts:n,orientation:e||((n==null?void 0:n.axis)==="y"?"vertical":"horizontal"),scrollPrev:K,scrollNext:re,canScrollPrev:U,canScrollNext:G},children:w.jsx("div",{ref:i,onKeyDownCapture:Q,className:Rr("relative",g),role:"region","aria-roledescription":"carousel",...C,children:b})})});$j.displayName="Carousel";const Gj=Z.forwardRef(({className:e,...n},o)=>{const{carouselRef:u,orientation:g}=vb();return w.jsx("div",{ref:u,className:"overflow-hidden",children:w.jsx("div",{ref:o,className:Rr("flex",g==="horizontal"?"-ml-4":"-mt-4 flex-col",e),...n})})});Gj.displayName="CarouselContent";const qj=Z.forwardRef(({className:e,...n},o)=>{const{orientation:u}=vb();return w.jsx("div",{ref:o,role:"group","aria-roledescription":"slide",className:Rr("min-w-0 shrink-0 grow-0 basis-full",u==="horizontal"?"pl-4":"pt-4",e),...n})});qj.displayName="CarouselItem";const Hj=Z.forwardRef(({className:e,variant:n="outline",size:o="icon",...u},g)=>{const{orientation:b,scrollPrev:C,canScrollPrev:i}=vb();return w.jsxs($t,{ref:g,variant:n,size:o,className:Rr("absolute  h-8 w-8 rounded-full",b==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:C,...u,children:[w.jsx(vN,{className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Previous slide"})]})});Hj.displayName="CarouselPrevious";const Wj=Z.forwardRef(({className:e,variant:n="outline",size:o="icon",...u},g)=>{const{orientation:b,scrollNext:C,canScrollNext:i}=vb();return w.jsxs($t,{ref:g,variant:n,size:o,className:Rr("absolute h-8 w-8 rounded-full",b==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",e),disabled:!i,onClick:C,...u,children:[w.jsx(o$,{className:"h-4 w-4"}),w.jsx("span",{className:"sr-only",children:"Next slide"})]})});Wj.displayName="CarouselNext";const wY=e=>Array.isArray(e.images)&&e.images.length>0?e.images:[e.image_url||"/placeholder.svg"],SY=({product:e,open:n,onOpenChange:o})=>{var re;const[u,g]=Z.useState(1),[b,C]=Z.useState(""),[i,L]=Z.useState(!1),{addToCart:O}=ad();if(!e)return null;const U=()=>g(Q=>Q+1),q=()=>g(Q=>Q>1?Q-1:1),G=()=>{O({id:e.id,name:e.name,price:e.price,image:e.image_url,imageUrl:e.image_url,description:e.description,category:e.category,quantity:u,notes:b.trim()||void 0}),ar({title:"Item adicionado ao carrinho",description:`${u}x ${e.name} foi adicionado ao seu pedido`}),o(!1),C(""),g(1),L(!1)},ie=()=>{L(Q=>!Q),i&&C("")},J=wY(e),K=((re=e.nutritional_info)==null?void 0:re.ingredients)||["Sem informações de ingredientes"];return w.jsx(Nl,{open:n,onOpenChange:o,children:w.jsxs(tl,{className:"sm:max-w-[500px] max-h-[85vh] overflow-hidden flex flex-col",children:[w.jsxs(Ol,{className:"pb-2",children:[w.jsx(zl,{className:"text-lg font-bold",children:e.name}),w.jsxs(_b,{className:"text-base font-medium text-gray-700",children:["R$ ",e.price.toFixed(2)]})]}),w.jsxs("div",{className:"flex-grow overflow-y-auto pr-1 pb-20",children:[w.jsx("div",{className:"relative w-full mb-2",children:w.jsxs($j,{className:"w-full",children:[w.jsx(Gj,{children:J.map((Q,ee)=>w.jsx(qj,{className:"flex justify-center",children:w.jsx("img",{src:Q,alt:`${e.name} - imagem ${ee+1}`,className:"object-cover rounded-md max-h-[200px] w-auto mx-auto"})},ee))}),w.jsx(Hj,{className:"h-7 w-7 -left-3"}),w.jsx(Wj,{className:"h-7 w-7 -right-3"})]})}),w.jsxs("div",{className:"mb-2",children:[w.jsx("h3",{className:"font-medium text-base mb-1",children:"Descrição"}),w.jsx("p",{className:"text-gray-700 text-xs",children:e.description})]}),w.jsxs("div",{className:"mb-2",children:[w.jsx("h3",{className:"font-medium text-base mb-1",children:"Ingredientes"}),w.jsx("ul",{className:"list-disc pl-4",children:K.map((Q,ee)=>w.jsx("li",{className:"text-gray-700 text-xs",children:Q},ee))})]}),w.jsxs("div",{className:"mb-2",children:[w.jsxs($t,{variant:"outline",size:"sm",onClick:ie,className:"flex items-center gap-1 text-xs h-7 px-2",children:[w.jsx(v$,{className:"h-3 w-3"}),i?"Remover observações":"Adicionar observações"]}),i&&w.jsx("div",{className:"mt-2",children:w.jsx(m1,{placeholder:"Alguma observação? Ex: sem cebola, sem molho, etc.",value:b,onChange:Q=>C(Q.target.value),className:"w-full text-xs",rows:2})})]})]}),w.jsx("div",{className:"pt-3 mt-2 border-t absolute bottom-0 left-0 right-0 bg-white p-4",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx($t,{variant:"outline",size:"icon",onClick:q,disabled:u<=1,className:"h-7 w-7",children:w.jsx(c$,{className:"h-3 w-3"})}),w.jsx("span",{className:"text-base font-medium",children:u}),w.jsx($t,{variant:"outline",size:"icon",onClick:U,className:"h-7 w-7",children:w.jsx(u$,{className:"h-3 w-3"})})]}),w.jsxs($t,{onClick:G,className:"px-3 py-1 h-8 text-xs",children:["Adicionar • R$ ",(e.price*u).toFixed(2)]})]})})]})})},TY=({item:e})=>{const{addToCart:n}=ad(),[o,u]=Z.useState(!1),g=()=>{n({id:e.id,name:e.name,price:e.price,imageUrl:e.image_url,image:e.image_url,description:e.description,category:e.category})},b=()=>{u(!0)};return w.jsxs(w.Fragment,{children:[w.jsxs(Un,{className:"overflow-hidden",children:[w.jsxs("div",{className:"aspect-video relative",children:[w.jsx("img",{src:e.image_url||"/placeholder.svg",alt:e.name,className:"w-full h-full object-cover"}),e.featured&&w.jsx("span",{className:"absolute top-1 right-1 bg-yellow-500 text-white text-xs px-1.5 py-0.5 rounded-full text-[10px]",children:"Destaque"})]}),w.jsxs(wi,{className:"pb-1 pt-2 px-3",children:[w.jsx(Si,{className:"text-sm",children:e.name}),w.jsxs(ls,{className:"text-xs",children:["R$ ",e.price.toFixed(2)]})]}),w.jsx(fi,{className:"pb-1 pt-0 px-3",children:w.jsx("p",{className:"text-gray-600 text-xs line-clamp-1",children:e.description})}),w.jsxs(by,{className:"flex justify-between px-3 py-2",children:[w.jsxs($t,{variant:"outline",size:"sm",onClick:b,className:"flex items-center gap-1 h-7 px-2 text-xs",children:[w.jsx(g$,{className:"h-3 w-3"})," Detalhes"]}),w.jsx($t,{onClick:g,size:"sm",className:"text-xs px-2 py-0 h-7",children:"Adicionar"})]})]}),w.jsx(SY,{product:e,open:o,onOpenChange:u})]})},EY=({items:e})=>e.length===0?w.jsxs("div",{className:"text-center py-16",children:[w.jsx("h2",{className:"text-2xl font-semibold text-gray-600",children:"Nenhum item encontrado nesta categoria"}),w.jsx("p",{className:"mt-2 text-gray-500",children:"Tente selecionar outra categoria"})]}):w.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6",children:e.map(n=>w.jsx(TY,{item:n},n.id))}),D_=[{id:1,name:"Hambúrguer Clássico",description:"Hambúrguer de carne bovina, queijo cheddar, alface, tomate e molho especial",price:25.9,image_url:"https://images.unsplash.com/photo-1572802419224-296b0aeee0d9?q=80&w=1115&auto=format&fit=crop",category:"hamburgueres",featured:!0,available:!0,restaurant_id:1,nutritional_info:{ingredients:["Pão","Carne bovina","Queijo cheddar","Alface","Tomate","Molho especial"]}},{id:2,name:"Pizza Margherita",description:"Molho de tomate, mussarela de búfala, manjericão fresco e azeite",price:45,image_url:"https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?q=80&w=1170&auto=format&fit=crop",category:"pizzas",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Massa de pizza","Molho de tomate","Mussarela de búfala","Manjericão fresco","Azeite"]}},{id:3,name:"Salada Caesar",description:"Alface romana, croutons, parmesão e molho caesar",price:22.5,image_url:"https://images.unsplash.com/photo-1550304943-4f24f54ddde9?q=80&w=1170&auto=format&fit=crop",category:"saladas",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Alface romana","Croutons","Queijo parmesão","Molho caesar"]}},{id:4,name:"Macarrão à Carbonara",description:"Espaguete, bacon, ovo, queijo parmesão e pimenta preta",price:36.9,image_url:"https://images.unsplash.com/photo-1612874742237-6526221588e3?q=80&w=1171&auto=format&fit=crop",category:"massas",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Espaguete","Bacon","Ovo","Queijo parmesão","Pimenta preta"]}},{id:5,name:"Sushi Combo",description:"10 peças variadas de sushi e sashimi",price:58,image_url:"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?q=80&w=1170&auto=format&fit=crop",category:"japonesa",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Arroz","Peixe fresco variado","Alga nori","Wasabi","Gengibre"]}},{id:6,name:"Filé Mignon",description:"Filé mignon grelhado, acompanhado de batata rústica e molho de vinho",price:72.9,image_url:"https://images.unsplash.com/photo-1558030006-450675393462?q=80&w=1031&auto=format&fit=crop",category:"carnes",featured:!0,available:!0,restaurant_id:1,nutritional_info:{ingredients:["Filé mignon","Batata rústica","Molho de vinho","Ervas"]}},{id:7,name:"Burrito Vegetariano",description:"Tortilla de trigo, feijão, arroz, queijo, guacamole e pico de gallo",price:28.5,image_url:"https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=1194&auto=format&fit=crop",category:"mexicana",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Tortilla de trigo","Feijão","Arroz","Queijo","Guacamole","Pico de gallo"]}},{id:8,name:"Frango à Parmegiana",description:"Filé de frango empanado, coberto com molho de tomate e queijo gratinado",price:39.9,image_url:"https://images.unsplash.com/photo-1632778149955-e80f8ceca2e8?q=80&w=1170&auto=format&fit=crop",category:"carnes",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Filé de frango","Farinha de rosca","Molho de tomate","Queijo mussarela"]}},{id:9,name:"Risoto de Cogumelos",description:"Arroz arbóreo, mix de cogumelos, vinho branco e parmesão",price:42,image_url:"https://images.unsplash.com/photo-1534422646206-20bfb3e6fb3c?q=80&w=1169&auto=format&fit=crop",category:"massas",available:!0,restaurant_id:1,nutritional_info:{ingredients:["Arroz arbóreo","Mix de cogumelos","Vinho branco","Queijo parmesão"]}},{id:10,name:"Brownie com Sorvete",description:"Brownie de chocolate quentinho com sorvete de baunilha",price:18.9,image_url:"https://images.unsplash.com/photo-1564988208929-32932df0b42d?q=80&w=1170&auto=format&fit=crop",category:"sobremesas",featured:!0,available:!0,restaurant_id:1,nutritional_info:{ingredients:["Chocolate","Farinha","Açúcar","Ovos","Sorvete de baunilha"]}}],CY=[{id:"todos",name:"Todos"},{id:"hamburgueres",name:"Hambúrgueres"},{id:"pizzas",name:"Pizzas"},{id:"saladas",name:"Saladas"},{id:"massas",name:"Massas"},{id:"carnes",name:"Carnes"},{id:"japonesa",name:"Japonesa"},{id:"mexicana",name:"Mexicana"},{id:"sobremesas",name:"Sobremesas"}],AY=({selectedCategory:e,onCategoryChange:n})=>w.jsx("div",{className:"w-full overflow-x-auto pb-2",children:w.jsx("div",{className:"flex space-x-2 min-w-max",children:CY.map(o=>w.jsx($t,{onClick:()=>n(o.id),variant:e===o.id?"default":"outline",className:`px-4 py-2 whitespace-nowrap ${e===o.id?"bg-menu-primary text-white":"text-gray-700 hover:text-menu-primary"}`,children:o.name},o.id))})}),Zj=()=>{const{teamId:e}=sb(),n=Z.useMemo(()=>e?{getProducts:async o=>{let u=Qt.from("products").select(`
            *,
            restaurants!inner(
              id,
              name,
              team_id
            )
          `).eq("restaurants.team_id",e);(o==null?void 0:o.available)!==void 0&&(u=u.eq("available",o.available)),o!=null&&o.category&&(u=u.eq("category",o.category));const{data:g,error:b}=await u;if(b)throw b;return g},getOrders:async o=>{let u=Qt.from("orders").select(`
            *,
            order_items(
              *,
              products(*)
            ),
            restaurants!inner(
              id,
              name,
              team_id
            )
          `).eq("restaurants.team_id",e);o!=null&&o.status&&(u=u.eq("status",o.status)),o!=null&&o.user_id&&(u=u.eq("user_id",o.user_id));const{data:g,error:b}=await u.order("created_at",{ascending:!1});if(b)throw b;return g},getRestaurants:async()=>{const{data:o,error:u}=await Qt.from("restaurants").select("*").eq("team_id",e);if(u)throw u;return o},getCategories:async()=>{const{data:o,error:u}=await Qt.from("categories").select(`
            *,
            restaurants!inner(
              id,
              name,
              team_id
            )
          `).eq("restaurants.team_id",e);if(u)throw u;return o},getTables:async o=>{let u=Qt.from("tables").select(`
            *,
            restaurants!inner(
              id,
              name,
              team_id
            )
          `).eq("restaurants.team_id",e);o&&(u=u.eq("restaurant_id",o));const{data:g,error:b}=await u;if(b)throw b;return g},createProduct:async o=>{const{data:u}=await Qt.from("restaurants").select("id").eq("team_id",e).limit(1);if(!u||u.length===0)throw new Error("Nenhum restaurante encontrado para este team");return Qt.from("products").insert({...o,restaurant_id:u[0].id})},createOrder:async o=>{const{data:u}=await Qt.from("restaurants").select("id").eq("team_id",e).limit(1);if(!u||u.length===0)throw new Error("Nenhum restaurante encontrado para este team");return Qt.from("orders").insert({...o,restaurant_id:u[0].id})},updateProduct:async(o,u)=>Qt.from("products").update(u).eq("id",o).eq("restaurants.team_id",e),deleteProduct:async o=>Qt.from("products").delete().eq("id",o).eq("restaurants.team_id",e),client:Qt,currentTeamId:e}:null,[e]);return{teamSupabase:n,teamId:e,isReady:!!e&&!!n}},c3=()=>{const[e,n]=Z.useState("todos"),[o,u]=Z.useState(D_),[g,b]=Z.useState(!0),{teamId:C,isLoading:i}=sb(),{teamSupabase:L,isReady:O}=Zj();Z.useEffect(()=>{i||(async()=>{b(!0);try{const G=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";if(C&&O&&L){console.log(`Carregando produtos para team_id: ${C}`);const ie=await L.getProducts({available:!0});if(ie&&ie.length>0){const J=ie.map(K=>({...K,restaurant_id:K.restaurant_id||1}));u(J),console.log(`${ie.length} produtos carregados do Supabase para team_id: ${C}`)}else{console.log(`Nenhum produto encontrado para team_id: ${C}, buscando produtos gerais`);const{data:J,error:K}=await Qt.from("products").select("*").eq("available",!0);if(J&&J.length>0){const re=J.map(Q=>({...Q,restaurant_id:Q.restaurant_id||1}));u(re),console.log(`${J.length} produtos gerais carregados como fallback`)}else console.log("Usando dados mockados como último recurso"),u(D_)}}else{console.log("Carregando todos os produtos (sem filtro de team)");const{data:ie,error:J}=await Qt.from("products").select("*").eq("available",!0);if(ie&&ie.length>0){const K=ie.map(re=>({...re,restaurant_id:re.restaurant_id||1}));u(K),console.log(`${ie.length} produtos carregados do Supabase (modo geral)`)}else console.log("Nenhum produto encontrado no Supabase, usando dados mockados"),u(D_)}}catch(G){console.error("Erro ao buscar produtos:",G),console.log("Usando dados mockados devido ao erro"),u(D_)}finally{b(!1)}})()},[O,i,L,C]);const U=e==="todos"?o:o.filter(q=>q.category===e);return w.jsxs("div",{className:"min-h-screen flex flex-col pt-16",children:[w.jsxs("main",{className:"flex-grow container mx-auto px-4 py-8",children:[w.jsxs("section",{className:"mb-8",children:[w.jsx("h1",{className:"text-3xl font-bold mb-2 text-menu-secondary",children:"Cardápio Digital"}),w.jsx("p",{className:"text-gray-600 max-w-2xl",children:"Explore nosso delicioso menu com opções para todos os gostos. Adicione itens ao seu carrinho e faça seu pedido facilmente."}),C&&w.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Team ID: ",C]})]}),w.jsxs("section",{className:"mb-8",children:[w.jsx("h2",{className:"text-2xl font-bold mb-4 text-menu-secondary",children:"Categorias"}),w.jsx(AY,{selectedCategory:e,onCategoryChange:n})]}),w.jsxs("section",{className:"mb-12",children:[w.jsxs("div",{className:"flex justify-between items-center mb-6",children:[w.jsx("h2",{className:"text-2xl font-bold text-menu-secondary",children:e==="todos"?"Todos os itens":e.charAt(0).toUpperCase()+e.slice(1)}),w.jsxs("span",{className:"text-sm text-gray-500",children:[U.length," itens"]})]}),g||i?w.jsx("div",{className:"py-10 text-center",children:w.jsx("p",{className:"text-gray-500",children:"Carregando produtos..."})}):w.jsx(EY,{items:U})]})]}),w.jsx("footer",{className:"bg-gray-100 py-8 mt-auto",children:w.jsx("div",{className:"container mx-auto px-4",children:w.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[w.jsxs("div",{className:"mb-4 md:mb-0",children:[w.jsx("h3",{className:"text-lg font-bold text-menu-primary",children:"Delliapp"}),w.jsxs("p",{className:"text-sm text-gray-600",children:["© ",new Date().getFullYear()," Todos os direitos reservados"]})]}),w.jsxs("div",{className:"flex space-x-4",children:[w.jsx("a",{href:"#",className:"text-menu-primary hover:text-menu-secondary transition-colors",children:"Termos de Uso"}),w.jsx("a",{href:"#",className:"text-menu-primary hover:text-menu-secondary transition-colors",children:"Política de Privacidade"}),w.jsx("a",{href:"#",className:"text-menu-primary hover:text-menu-secondary transition-colors",children:"Contato"})]})]})})})]})};var MY="Separator",u3="horizontal",IY=["horizontal","vertical"],Xj=Z.forwardRef((e,n)=>{const{decorative:o,orientation:u=u3,...g}=e,b=PY(u)?u:u3,i=o?{role:"none"}:{"aria-orientation":b==="vertical"?b:void 0,role:"separator"};return w.jsx(qr.div,{"data-orientation":b,...i,...g,ref:n})});Xj.displayName=MY;function PY(e){return IY.includes(e)}var Kj=Xj;const pm=Z.forwardRef(({className:e,orientation:n="horizontal",decorative:o=!0,...u},g)=>w.jsx(Kj,{ref:g,decorative:o,orientation:n,className:Rr("shrink-0 bg-border",n==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...u}));pm.displayName=Kj.displayName;function dc(e,n,{checkForDefaultPrevented:o=!0}={}){return function(g){if(e==null||e(g),o===!1||!g.defaultPrevented)return n==null?void 0:n(g)}}function d3(e,n){if(typeof e=="function")return e(n);e!=null&&(e.current=n)}function Yj(...e){return n=>{let o=!1;const u=e.map(g=>{const b=d3(g,n);return!o&&typeof b=="function"&&(o=!0),b});if(o)return()=>{for(let g=0;g<u.length;g++){const b=u[g];typeof b=="function"?b():d3(e[g],null)}}}}function _1(...e){return Z.useCallback(Yj(...e),e)}var y1=Z.forwardRef((e,n)=>{const{children:o,...u}=e,g=Z.Children.toArray(o),b=g.find(kY);if(b){const C=b.props.children,i=g.map(L=>L===b?Z.Children.count(C)>1?Z.Children.only(null):Z.isValidElement(C)?C.props.children:null:L);return w.jsx(KT,{...u,ref:n,children:Z.isValidElement(C)?Z.cloneElement(C,void 0,i):null})}return w.jsx(KT,{...u,ref:n,children:o})});y1.displayName="Slot";var KT=Z.forwardRef((e,n)=>{const{children:o,...u}=e;if(Z.isValidElement(o)){const g=LY(o),b=DY(u,o.props);return o.type!==Z.Fragment&&(b.ref=n?Yj(n,g):g),Z.cloneElement(o,b)}return Z.Children.count(o)>1?Z.Children.only(null):null});KT.displayName="SlotClone";var RY=({children:e})=>w.jsx(w.Fragment,{children:e});function kY(e){return Z.isValidElement(e)&&e.type===RY}function DY(e,n){const o={...n};for(const u in n){const g=e[u],b=n[u];/^on[A-Z]/.test(u)?g&&b?o[u]=(...i)=>{b(...i),g(...i)}:g&&(o[u]=g):u==="style"?o[u]={...g,...b}:u==="className"&&(o[u]=[g,b].filter(Boolean).join(" "))}return{...e,...o}}function LY(e){var u,g;let n=(u=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:u.get,o=n&&"isReactWarning"in n&&n.isReactWarning;return o?e.ref:(n=(g=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:g.get,o=n&&"isReactWarning"in n&&n.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}function NY(e){const n=e+"CollectionProvider",[o,u]=Jo(n),[g,b]=o(n,{collectionRef:{current:null},itemMap:new Map}),C=ie=>{const{scope:J,children:K}=ie,re=tr.useRef(null),Q=tr.useRef(new Map).current;return w.jsx(g,{scope:J,itemMap:Q,collectionRef:re,children:K})};C.displayName=n;const i=e+"CollectionSlot",L=tr.forwardRef((ie,J)=>{const{scope:K,children:re}=ie,Q=b(i,K),ee=_1(J,Q.collectionRef);return w.jsx(y1,{ref:ee,children:re})});L.displayName=i;const O=e+"CollectionItemSlot",U="data-radix-collection-item",q=tr.forwardRef((ie,J)=>{const{scope:K,children:re,...Q}=ie,ee=tr.useRef(null),ue=_1(J,ee),fe=b(O,K);return tr.useEffect(()=>(fe.itemMap.set(ee,{ref:ee,...Q}),()=>void fe.itemMap.delete(ee))),w.jsx(y1,{[U]:"",ref:ue,children:re})});q.displayName=O;function G(ie){const J=b(e+"CollectionConsumer",ie);return tr.useCallback(()=>{const re=J.collectionRef.current;if(!re)return[];const Q=Array.from(re.querySelectorAll(`[${U}]`));return Array.from(J.itemMap.values()).sort((fe,ge)=>Q.indexOf(fe.ref.current)-Q.indexOf(ge.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:C,Slot:L,ItemSlot:q},G,u]}var OY=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],mm=OY.reduce((e,n)=>{const o=Z.forwardRef((u,g)=>{const{asChild:b,...C}=u,i=b?y1:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),w.jsx(i,{...C,ref:g})});return o.displayName=`Primitive.${n}`,{...e,[n]:o}},{}),bS="rovingFocusGroup.onEntryFocus",zY={bubbles:!1,cancelable:!0},xb="RovingFocusGroup",[YT,Jj,jY]=NY(xb),[FY,Qj]=Jo(xb,[jY]),[BY,UY]=FY(xb),e4=Z.forwardRef((e,n)=>w.jsx(YT.Provider,{scope:e.__scopeRovingFocusGroup,children:w.jsx(YT.Slot,{scope:e.__scopeRovingFocusGroup,children:w.jsx(VY,{...e,ref:n})})}));e4.displayName=xb;var VY=Z.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,orientation:u,loop:g=!1,dir:b,currentTabStopId:C,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:L,onEntryFocus:O,preventScrollOnEntryFocus:U=!1,...q}=e,G=Z.useRef(null),ie=_1(n,G),J=fm(b),[K=null,re]=Dl({prop:C,defaultProp:i,onChange:L}),[Q,ee]=Z.useState(!1),ue=_s(O),fe=Jj(o),ge=Z.useRef(!1),[ke,Ce]=Z.useState(0);return Z.useEffect(()=>{const Be=G.current;if(Be)return Be.addEventListener(bS,ue),()=>Be.removeEventListener(bS,ue)},[ue]),w.jsx(BY,{scope:o,orientation:u,dir:J,loop:g,currentTabStopId:K,onItemFocus:Z.useCallback(Be=>re(Be),[re]),onItemShiftTab:Z.useCallback(()=>ee(!0),[]),onFocusableItemAdd:Z.useCallback(()=>Ce(Be=>Be+1),[]),onFocusableItemRemove:Z.useCallback(()=>Ce(Be=>Be-1),[]),children:w.jsx(mm.div,{tabIndex:Q||ke===0?-1:0,"data-orientation":u,...q,ref:ie,style:{outline:"none",...e.style},onMouseDown:dc(e.onMouseDown,()=>{ge.current=!0}),onFocus:dc(e.onFocus,Be=>{const dt=!ge.current;if(Be.target===Be.currentTarget&&dt&&!Q){const Qe=new CustomEvent(bS,zY);if(Be.currentTarget.dispatchEvent(Qe),!Qe.defaultPrevented){const qe=fe().filter(Tt=>Tt.focusable),He=qe.find(Tt=>Tt.active),et=qe.find(Tt=>Tt.id===K),Ze=[He,et,...qe].filter(Boolean).map(Tt=>Tt.ref.current);n4(Ze,U)}}ge.current=!1}),onBlur:dc(e.onBlur,()=>ee(!1))})})}),t4="RovingFocusGroupItem",r4=Z.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,focusable:u=!0,active:g=!1,tabStopId:b,...C}=e,i=Ka(),L=b||i,O=UY(t4,o),U=O.currentTabStopId===L,q=Jj(o),{onFocusableItemAdd:G,onFocusableItemRemove:ie}=O;return Z.useEffect(()=>{if(u)return G(),()=>ie()},[u,G,ie]),w.jsx(YT.ItemSlot,{scope:o,id:L,focusable:u,active:g,children:w.jsx(mm.span,{tabIndex:U?0:-1,"data-orientation":O.orientation,...C,ref:n,onMouseDown:dc(e.onMouseDown,J=>{u?O.onItemFocus(L):J.preventDefault()}),onFocus:dc(e.onFocus,()=>O.onItemFocus(L)),onKeyDown:dc(e.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){O.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const K=qY(J,O.orientation,O.dir);if(K!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let Q=q().filter(ee=>ee.focusable).map(ee=>ee.ref.current);if(K==="last")Q.reverse();else if(K==="prev"||K==="next"){K==="prev"&&Q.reverse();const ee=Q.indexOf(J.currentTarget);Q=O.loop?HY(Q,ee+1):Q.slice(ee+1)}setTimeout(()=>n4(Q))}})})})});r4.displayName=t4;var $Y={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function GY(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function qY(e,n,o){const u=GY(e.key,o);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(u))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(u)))return $Y[u]}function n4(e,n=!1){const o=document.activeElement;for(const u of e)if(u===o||(u.focus({preventScroll:n}),document.activeElement!==o))return}function HY(e,n){return e.map((o,u)=>e[(n+u)%e.length])}var WY=e4,ZY=r4;function XY(e,n){return Z.useReducer((o,u)=>n[o][u]??o,e)}var i4=e=>{const{present:n,children:o}=e,u=KY(n),g=typeof o=="function"?o({present:u.isPresent}):Z.Children.only(o),b=_1(u.ref,YY(g));return typeof o=="function"||u.isPresent?Z.cloneElement(g,{ref:b}):null};i4.displayName="Presence";function KY(e){const[n,o]=Z.useState(),u=Z.useRef({}),g=Z.useRef(e),b=Z.useRef("none"),C=e?"mounted":"unmounted",[i,L]=XY(C,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Z.useEffect(()=>{const O=fx(u.current);b.current=i==="mounted"?O:"none"},[i]),Ki(()=>{const O=u.current,U=g.current;if(U!==e){const G=b.current,ie=fx(O);e?L("MOUNT"):ie==="none"||(O==null?void 0:O.display)==="none"?L("UNMOUNT"):L(U&&G!==ie?"ANIMATION_OUT":"UNMOUNT"),g.current=e}},[e,L]),Ki(()=>{if(n){let O;const U=n.ownerDocument.defaultView??window,q=ie=>{const K=fx(u.current).includes(ie.animationName);if(ie.target===n&&K&&(L("ANIMATION_END"),!g.current)){const re=n.style.animationFillMode;n.style.animationFillMode="forwards",O=U.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=re)})}},G=ie=>{ie.target===n&&(b.current=fx(u.current))};return n.addEventListener("animationstart",G),n.addEventListener("animationcancel",q),n.addEventListener("animationend",q),()=>{U.clearTimeout(O),n.removeEventListener("animationstart",G),n.removeEventListener("animationcancel",q),n.removeEventListener("animationend",q)}}else L("ANIMATION_END")},[n,L]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:Z.useCallback(O=>{O&&(u.current=getComputedStyle(O)),o(O)},[])}}function fx(e){return(e==null?void 0:e.animationName)||"none"}function YY(e){var u,g;let n=(u=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:u.get,o=n&&"isReactWarning"in n&&n.isReactWarning;return o?e.ref:(n=(g=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:g.get,o=n&&"isReactWarning"in n&&n.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}var XC="Tabs",[JY,zQ]=Jo(XC,[Qj]),s4=Qj(),[QY,KC]=JY(XC),o4=Z.forwardRef((e,n)=>{const{__scopeTabs:o,value:u,onValueChange:g,defaultValue:b,orientation:C="horizontal",dir:i,activationMode:L="automatic",...O}=e,U=fm(i),[q,G]=Dl({prop:u,onChange:g,defaultProp:b});return w.jsx(QY,{scope:o,baseId:Ka(),value:q,onValueChange:G,orientation:C,dir:U,activationMode:L,children:w.jsx(mm.div,{dir:U,"data-orientation":C,...O,ref:n})})});o4.displayName=XC;var a4="TabsList",l4=Z.forwardRef((e,n)=>{const{__scopeTabs:o,loop:u=!0,...g}=e,b=KC(a4,o),C=s4(o);return w.jsx(WY,{asChild:!0,...C,orientation:b.orientation,dir:b.dir,loop:u,children:w.jsx(mm.div,{role:"tablist","aria-orientation":b.orientation,...g,ref:n})})});l4.displayName=a4;var c4="TabsTrigger",u4=Z.forwardRef((e,n)=>{const{__scopeTabs:o,value:u,disabled:g=!1,...b}=e,C=KC(c4,o),i=s4(o),L=f4(C.baseId,u),O=p4(C.baseId,u),U=u===C.value;return w.jsx(ZY,{asChild:!0,...i,focusable:!g,active:U,children:w.jsx(mm.button,{type:"button",role:"tab","aria-selected":U,"aria-controls":O,"data-state":U?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:L,...b,ref:n,onMouseDown:dc(e.onMouseDown,q=>{!g&&q.button===0&&q.ctrlKey===!1?C.onValueChange(u):q.preventDefault()}),onKeyDown:dc(e.onKeyDown,q=>{[" ","Enter"].includes(q.key)&&C.onValueChange(u)}),onFocus:dc(e.onFocus,()=>{const q=C.activationMode!=="manual";!U&&!g&&q&&C.onValueChange(u)})})})});u4.displayName=c4;var d4="TabsContent",h4=Z.forwardRef((e,n)=>{const{__scopeTabs:o,value:u,forceMount:g,children:b,...C}=e,i=KC(d4,o),L=f4(i.baseId,u),O=p4(i.baseId,u),U=u===i.value,q=Z.useRef(U);return Z.useEffect(()=>{const G=requestAnimationFrame(()=>q.current=!1);return()=>cancelAnimationFrame(G)},[]),w.jsx(i4,{present:g||U,children:({present:G})=>w.jsx(mm.div,{"data-state":U?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":L,hidden:!G,id:O,tabIndex:0,...C,ref:n,style:{...e.style,animationDuration:q.current?"0s":void 0},children:G&&b})})});h4.displayName=d4;function f4(e,n){return`${e}-trigger-${n}`}function p4(e,n){return`${e}-content-${n}`}var eJ=o4,m4=l4,g4=u4,_4=h4;const Vh=eJ,ld=Z.forwardRef(({className:e,...n},o)=>w.jsx(m4,{ref:o,className:Rr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...n}));ld.displayName=m4.displayName;const cs=Z.forwardRef(({className:e,...n},o)=>w.jsx(g4,{ref:o,className:Rr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...n}));cs.displayName=g4.displayName;const us=Z.forwardRef(({className:e,...n},o)=>w.jsx(_4,{ref:o,className:Rr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...n}));us.displayName=_4.displayName;const En=Z.forwardRef(({className:e,type:n,...o},u)=>w.jsx("input",{type:n,className:Rr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:u,...o}));En.displayName="Input";const tJ=({order:e,open:n,onOpenChange:o,currentUserRole:u})=>{const[g,b]=Z.useState(e.status||"pending"),[C,i]=Z.useState(e),[L,O]=Z.useState("pending"),[U,q]=Z.useState(!1),[G,ie]=Z.useState(e.table),[J,K]=Z.useState([]),[re,Q]=Z.useState([]),ee=["admin","restaurant_owner","waiter"].includes(u),ue=["https://images.unsplash.com/photo-1618160702438-9b02ab6515c9","https://images.unsplash.com/photo-1568901346375-23c9450c58cd","https://images.unsplash.com/photo-1565299624946-b28f40a0ae38"],fe=Z.useCallback(async()=>{try{const{data:et,error:mt}=await Qt.from("orders").select("status").eq("id",e.id).single();et&&(b(et.status),O(et.status));const{data:Ze,error:Tt}=await Qt.from("order_items").select("order_id, quantity, price, notes, product_id").eq("order_id",e.id);if(Tt||!Ze)throw Tt;const Gt=Array.from(new Set(Ze.map(bt=>bt.product_id))),{data:ct}=await Qt.from("products").select("id, name, image_url").in("id",Gt),Je={};ct==null||ct.forEach(bt=>{Je[bt.id]=bt});const rt=Ze.map(bt=>{var kt,At;return{name:((kt=Je[bt.product_id])==null?void 0:kt.name)||"Produto Desconhecido",image:((At=Je[bt.product_id])==null?void 0:At.image_url)||void 0,quantity:bt.quantity,price:bt.price,notes:bt.notes||void 0}});i(bt=>({...bt,items:rt,total:rt.reduce((kt,At)=>kt+At.price*At.quantity,0)})),K((et==null?void 0:et.status)==="preparing"?rt:[]),Q(["ready","delivered"].includes((et==null?void 0:et.status)||"")?rt:[])}catch(et){console.error("Erro ao buscar detalhes do pedido:",et)}},[e.id]);Z.useEffect(()=>{fe()},[e.id]);const ge=async()=>{try{console.log("Enviando pedido para cozinha:",e.id);const{error:et}=await Qt.from("orders").update({status:"preparing",updated_at:new Date().toISOString()}).eq("id",e.id);if(et){console.error("Erro ao atualizar pedido no Supabase:",et),ar({title:"Erro ao enviar para cozinha",description:et.message,variant:"destructive"});return}console.log("Pedido atualizado no Supabase com sucesso"),b("preparing"),O("preparing"),K([...C.items]);const Ze=JSON.parse(localStorage.getItem("tableOrders")||"[]").map(ct=>ct.id===e.id?{...ct,status:"preparing",updated_at:new Date().toISOString()}:ct);localStorage.setItem("tableOrders",JSON.stringify(Ze)),await fe(),ar({title:"Pedido enviado para a cozinha",description:`O pedido de ${C.table} foi enviado para preparo`});const Tt=JSON.parse(localStorage.getItem("kitchenOrders")||"[]"),Gt=Tt.findIndex(ct=>ct.id===e.id);Gt>=0?Tt[Gt]={...C,status:"preparing",updated_at:new Date().toISOString()}:Tt.push({...C,status:"preparing",updated_at:new Date().toISOString()}),localStorage.setItem("kitchenOrders",JSON.stringify(Tt))}catch(et){console.error("Erro ao enviar pedido para cozinha:",et),ar({title:"Erro ao enviar para cozinha",description:et instanceof Error?et.message:String(et),variant:"destructive"})}},ke=()=>{ar({title:"Mesa liberada",description:`${C.table} foi liberada com sucesso`}),o(!1)},Ce=()=>{U?(i(et=>({...et,table:G})),ar({title:"Nome atualizado",description:`Renomeado para ${G}`}),q(!1)):q(!0)},Be=(et,mt)=>{if(mt<1)return;const Ze=[...C.items],Tt=Ze[et].quantity;Ze[et].quantity=mt;const Gt=Ze[et].price*(mt-Tt),ct=C.total+Gt;i({...C,items:Ze,total:ct}),ar({title:"Quantidade atualizada",description:`${Ze[et].name}: ${Tt} → ${mt}`})},dt=et=>{if(g==="pending"){const mt=[...C.items],Ze=mt[et];mt.splice(et,1);const Tt=C.total-Ze.price*Ze.quantity;i({...C,items:mt,total:Tt}),ar({title:"Item removido",description:`${Ze.name} foi removido do pedido`})}else ar({title:"Não é possível remover",description:"Pedidos em preparo ou entregues não podem ser editados",variant:"destructive"})},Qe=()=>C.items.filter((et,mt)=>g==="pending"||J.length===0),qe=()=>g!=="pending"?J:[],He=()=>g==="delivered"||g==="ready"?re:[];return w.jsx(Nl,{open:n,onOpenChange:o,children:w.jsxs(tl,{className:"sm:max-w-md",children:[w.jsx(Ol,{children:w.jsx("div",{className:"flex justify-between items-center",children:w.jsx(zl,{className:"text-2xl flex items-center gap-2",children:U?w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(En,{value:G,onChange:et=>ie(et.target.value),className:"h-9 w-40",autoFocus:!0}),w.jsx($t,{variant:"outline",size:"sm",onClick:Ce,children:"Salvar"})]}):w.jsxs(w.Fragment,{children:[C.table_name||C.table,ee&&w.jsx($t,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:Ce,children:w.jsx(oC,{className:"h-4 w-4"})})]})})})}),w.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[w.jsx(Ti,{className:`px-3 py-1 ${g==="pending"?"bg-yellow-100 text-yellow-800":g==="preparing"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:g==="pending"?"Pendente":g==="preparing"?"Em produção":"Entregue"}),w.jsxs("span",{className:"text-gray-600 text-sm",children:["Sendo atendido por ",C.assignedTo||"ninguém"]})]}),w.jsxs(Vh,{value:L,onValueChange:O,className:"w-full",children:[w.jsxs(ld,{className:"w-full grid grid-cols-3",children:[w.jsx(cs,{value:"pending",children:"Pendente"}),w.jsx(cs,{value:"preparing",children:"Em produção"}),w.jsx(cs,{value:"delivered",children:"Entregue"})]}),w.jsxs(us,{value:"pending",className:"mt-4",children:[w.jsx("h3",{className:"font-bold text-lg mb-2",children:"Itens Pendentes"}),w.jsx("div",{className:"space-y-4 mb-4 max-h-64 overflow-y-auto",children:Qe().length>0?Qe().map((et,mt)=>w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-md overflow-hidden flex-shrink-0",children:w.jsx("img",{src:et.image||ue[mt%ue.length],alt:et.name,className:"w-full h-full object-cover"})}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("h4",{className:"font-semibold",children:et.name}),w.jsxs("span",{className:"font-medium",children:["R$ ",(et.price*et.quantity).toFixed(2)]})]}),et.notes&&w.jsx("p",{className:"text-sm text-red-500 italic mt-1",children:et.notes}),w.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[w.jsx("span",{className:"text-sm text-gray-600",children:"Qtd:"}),ee&&g==="pending"?w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx($t,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>Be(mt,Math.max(1,et.quantity-1)),children:w.jsx(wN,{className:"h-3 w-3"})}),w.jsx("span",{className:"font-medium w-6 text-center",children:et.quantity}),w.jsx($t,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>Be(mt,et.quantity+1),children:w.jsx(Ah,{className:"h-3 w-3"})})]}):w.jsx("span",{children:et.quantity})]})]}),ee&&g==="pending"&&w.jsx("div",{className:"flex-shrink-0",children:w.jsx($t,{variant:"outline",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-700",onClick:()=>dt(mt),children:w.jsx($1,{className:"h-4 w-4"})})})]},`pending-${mt}`)):w.jsx("p",{className:"text-gray-500 text-center py-4",children:"Não há itens pendentes."})})]}),w.jsxs(us,{value:"preparing",className:"mt-4",children:[w.jsx("h3",{className:"font-bold text-lg mb-2",children:"Itens em Preparo"}),w.jsx("div",{className:"space-y-4 mb-4 max-h-64 overflow-y-auto",children:g==="pending"?w.jsx("p",{className:"text-gray-500 text-center py-4",children:"Não há itens em preparo. Envie o pedido para a cozinha primeiro."}):qe().length>0?qe().map((et,mt)=>w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-md overflow-hidden flex-shrink-0",children:w.jsx("img",{src:et.image||ue[(mt+1)%ue.length],alt:et.name,className:"w-full h-full object-cover"})}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("h4",{className:"font-semibold",children:et.name}),w.jsxs("span",{className:"font-medium",children:["R$ ",(et.price*et.quantity).toFixed(2)]})]}),et.notes&&w.jsx("p",{className:"text-sm text-red-500 italic mt-1",children:et.notes}),w.jsx("div",{className:"mt-1",children:w.jsxs("span",{className:"text-sm text-gray-600",children:["Qtd: ",et.quantity]})})]})]},`preparing-${mt}`)):w.jsx("p",{className:"text-gray-500 text-center py-4",children:"Todos os itens estão prontos para entrega."})})]}),w.jsxs(us,{value:"delivered",className:"mt-4",children:[w.jsx("h3",{className:"font-bold text-lg mb-2",children:"Itens Entregues"}),w.jsx("div",{className:"space-y-4 mb-4 max-h-64 overflow-y-auto",children:He().length>0?He().map((et,mt)=>w.jsxs("div",{className:"flex items-start gap-3",children:[w.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-md overflow-hidden flex-shrink-0",children:w.jsx("img",{src:et.image||ue[(mt+2)%ue.length],alt:et.name,className:"w-full h-full object-cover"})}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("h4",{className:"font-semibold",children:et.name}),w.jsxs("span",{className:"font-medium",children:["R$ ",(et.price*et.quantity).toFixed(2)]})]}),et.notes&&w.jsx("p",{className:"text-sm text-red-500 italic mt-1",children:et.notes}),w.jsx("div",{className:"mt-1",children:w.jsxs("span",{className:"text-sm text-gray-600",children:["Qtd: ",et.quantity]})})]})]},`delivered-${mt}`)):w.jsx("p",{className:"text-gray-500 text-center py-4",children:"Nenhum item foi entregue ainda."})})]})]}),w.jsx(pm,{className:"my-4"}),w.jsxs("div",{className:"flex justify-between items-center text-lg font-bold mb-6",children:[w.jsx("span",{children:"Total"}),w.jsxs("span",{children:["R$ ",C.total.toFixed(2)]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[w.jsx($t,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ge,disabled:g!=="pending"||C.items.length===0,children:"Mandar p/ Cozinha"}),w.jsx($t,{variant:"destructive",className:"w-full",onClick:ke,children:"Liberar Mesa"})]})]})})},YC=()=>{const{currentTeam:e,isAdminMode:n}=Vy(),{loading:o,user:u}=jh();Z.useEffect(()=>{(async()=>{if(o||!u){console.log("Aguardando autenticação ou usuário não encontrado para configurar RLS.");return}try{const{data:{session:ge},error:ke}=await Qt.auth.getSession();if(ke||!ge){console.log("Nenhuma sessão ativa encontrada, não configurando RLS:",ke);return}if(console.log("Sessão ativa confirmada, configurando RLS para:",u.id),n){const Ce=window.location.hostname;if(Ce==="localhost"||Ce==="127.0.0.1"||Ce==="app.delliapp.com.br"){const dt=await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"general_admin"}),Qe=await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:null});console.log("Configurações RLS aplicadas para admin geral:",dt,Qe)}else{const dt=await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"admin"}),Qe=await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:null});console.log("Configurações RLS aplicadas para modo admin:",dt,Qe)}}else if(e!=null&&e.id){const Ce=await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"user"}),Be=await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:e.id.toString()});console.log("Configurações RLS aplicadas para team:",e.id,Ce,Be)}}catch(ge){console.warn("Erro ao configurar RLS:",ge)}})()},[n,e,o,u]);const g=fe=>!n&&e?fe.eq("team_id",e.id):fe;return{supabase:Qt,currentTeam:e,isAdminMode:n,getProducts:async fe=>{let ge=Qt.from("products").select("*");ge=g(ge),fe!=null&&fe.category&&(ge=ge.eq("category",fe.category)),fe!=null&&fe.restaurant_id&&(ge=ge.eq("restaurant_id",Number(fe.restaurant_id)));const{data:ke,error:Ce}=await ge;if(Ce)throw Ce;return ke},createProduct:async fe=>{const ge={...fe,team_id:n?fe.team_id:e==null?void 0:e.id},{data:ke,error:Ce}=await Qt.from("products").insert(ge).select().single();if(Ce)throw Ce;return ke},updateProduct:async(fe,ge)=>{let ke=Qt.from("products").update(ge).eq("id",Number(fe));!n&&e&&(ke=ke.eq("team_id",e.id));const{data:Ce,error:Be}=await ke.select().single();if(Be)throw Be;return Ce},deleteProduct:async fe=>{let ge=Qt.from("products").delete().eq("id",Number(fe));!n&&e&&(ge=ge.eq("team_id",e.id));const{error:ke}=await ge;if(ke)throw ke},getOrders:async fe=>{let ge=Qt.from("orders").select("*, order_items(*)");ge=g(ge),fe!=null&&fe.status&&(ge=ge.eq("status",fe.status)),fe!=null&&fe.restaurant_id&&(ge=ge.eq("restaurant_id",Number(fe.restaurant_id)));const{data:ke,error:Ce}=await ge;if(Ce)throw Ce;return ke},createOrder:async fe=>{const ge={...fe,team_id:n?fe.team_id:e==null?void 0:e.id},{data:ke,error:Ce}=await Qt.from("orders").insert(ge).select().single();if(Ce)throw Ce;return ke},updateOrder:async(fe,ge)=>{let ke=Qt.from("orders").update(ge).eq("id",Number(fe));!n&&e&&(ke=ke.eq("team_id",e.id));const{data:Ce,error:Be}=await ke.select().single();if(Be)throw Be;return Ce},getRestaurants:async()=>{let fe=Qt.from("restaurants").select("*");fe=g(fe);const{data:ge,error:ke}=await fe;if(ke)throw ke;return ge},createRestaurant:async fe=>{const ge={...fe,team_id:n?fe.team_id:e==null?void 0:e.id},{data:ke,error:Ce}=await Qt.from("restaurants").insert(ge).select().single();if(Ce)throw Ce;return ke},getTables:async fe=>{let ge=Qt.from("tables").select("*");ge=g(ge),fe&&(ge=ge.eq("restaurant_id",Number(fe)));const{data:ke,error:Ce}=await ge;if(Ce)throw Ce;return ke},createTable:async fe=>{const ge={...fe,team_id:n?fe.team_id:e==null?void 0:e.id},{data:ke,error:Ce}=await Qt.from("tables").insert(ge).select().single();if(Ce)throw Ce;return ke},getTeams:async()=>{if(!n)throw new Error("Acesso negado: apenas admins podem listar teams");const{data:fe,error:ge}=await Qt.from("teams").select("*").order("created_at",{ascending:!1});if(ge)throw ge;return fe},createTeam:async fe=>{try{const{data:{session:ge},error:ke}=await Qt.auth.getSession();if(ke||!ge)throw new Error("Nenhuma sessão ativa encontrada. Faça login novamente.");const Ce=window.location.hostname;if(!(Ce==="localhost"||Ce==="127.0.0.1"||Ce==="app.delliapp.com.br"))throw new Error("Acesso negado: criação de clientes disponível apenas no domínio principal");if(!n)throw new Error("Acesso negado: apenas usuários admin podem criar clientes");await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"general_admin"}),await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:null});const{data:dt,error:Qe}=await Qt.from("teams").select("id, slug").eq("slug",fe.slug).maybeSingle();if(Qe)throw Qe;if(dt)throw new Error(`Slug '${fe.slug}' já está em uso. Escolha outro slug.`);const qe={name:fe.name,slug:fe.slug,description:fe.description||null,settings:fe.settings||{}},{data:He,error:et}=await Qt.from("teams").insert(qe).select().single();if(et)throw et;return He}catch(ge){throw console.error("Erro ao criar restaurante:",ge),ge}},updateTeam:async(fe,ge)=>{const{data:{session:ke},error:Ce}=await Qt.auth.getSession();if(Ce||!ke)throw new Error("Nenhuma sessão ativa encontrada. Faça login novamente.");const Be=window.location.hostname;if(!(Be==="localhost"||Be==="127.0.0.1"||Be==="app.delliapp.com.br"))throw new Error("Acesso negado: atualização de clientes disponível apenas no domínio principal");if(!n)throw new Error("Acesso negado: apenas usuários admin podem atualizar clientes");await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"general_admin"}),await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:null});const{data:Qe,error:qe}=await Qt.from("teams").update(ge).eq("id",fe).select().single();if(qe)throw qe;return Qe},deleteTeam:async fe=>{const{data:{session:ge},error:ke}=await Qt.auth.getSession();if(ke||!ge)throw new Error("Nenhuma sessão ativa encontrada. Faça login novamente.");const Ce=window.location.hostname;if(!n||!(Ce==="localhost"||Ce==="127.0.0.1"||Ce==="app.delliapp.com.br"))throw new Error("Acesso negado: apenas o admin geral pode deletar teams");await Qt.rpc("set_app_config",{config_name:"app.current_user_role",config_value:"general_admin"}),await Qt.rpc("set_app_config",{config_name:"app.current_team_id",config_value:null});const{error:dt}=await Qt.from("teams").delete().eq("id",fe);if(dt)throw dt},addTeamFilter:g}},rJ=[],nJ=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"preparing":return"bg-blue-100 text-blue-800";case"ready":return"bg-green-100 text-green-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},iJ=e=>{switch(e){case"pending":return"Pendente";case"preparing":return"Em preparo";case"ready":return"Pronto";case"delivered":return"Entregue";default:return"Desconhecido"}},sJ=()=>{const{currentUser:e}=Fh(),{getOrders:n}=YC(),[o,u]=Z.useState(rJ),[g,b]=Z.useState(null),[C,i]=Z.useState(!1),[L,O]=Z.useState(!1),U=nl(),q=["admin","restaurant_owner","waiter","chef"].includes((e==null?void 0:e.role)||"");Z.useEffect(()=>{G()},[]);const G=async()=>{try{const ee=await n();if(!ee||ee.length===0){u([]);return}const ue=ee.map(fe=>{var Ce;const ge=((Ce=fe.order_items)==null?void 0:Ce.map(Be=>({name:Be.name||"Produto Desconhecido",quantity:Be.quantity,price:Be.price||0,notes:Be.notes||void 0,image:Be.image_url||void 0,product_id:Be.product_id})))||[],ke=ge.reduce((Be,dt)=>Be+dt.price*dt.quantity,0);return{...fe,items:ge,total:ke}});u(ue)}catch(ee){console.error("Erro ao buscar pedidos do Supabase:",ee),ar({title:"Erro ao carregar pedidos",description:ee instanceof Error?ee.message:String(ee),variant:"destructive"})}},ie=()=>{O(!0),G().then(()=>{ar({title:"Atualizado",description:"Lista de pedidos atualizada com sucesso"}),O(!1)}).catch(()=>{O(!1)})},J=async()=>{try{await supabase.from("order_items").delete().gt("id",0),await supabase.from("orders").delete().gt("id",0),localStorage.removeItem("tableOrders"),u([]),ar({title:"Todos os pedidos apagados",description:"Todos os pedidos foram removidos com sucesso"})}catch(ee){console.error("Erro ao apagar pedidos:",ee),ar({title:"Erro ao apagar pedidos",description:ee instanceof Error?ee.message:"Falha ao limpar pedidos",variant:"destructive"})}};if(!q)return w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs(Un,{className:"w-full max-w-md mx-auto",children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Acesso restrito"}),w.jsx(ls,{children:"Você não tem permissão para acessar esta página"})]}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-500",children:"Esta página é destinada apenas para funcionários do restaurante."}),w.jsx($t,{className:"mt-4",onClick:()=>U("/"),children:"Voltar para o início"})]})]})})});const K=ee=>{var ue,fe;e&&(u(ge=>ge.map(ke=>ke.id===ee?{...ke,assignedTo:e.name}:ke)),ar({title:"Mesa assumida com sucesso",description:`Você é o responsável por ${((ue=o.find(ge=>ge.id===ee))==null?void 0:ue.table_name)||((fe=o.find(ge=>ge.id===ee))==null?void 0:fe.table)}`}))},re=ee=>{b(ee),i(!0)},Q=()=>{U("/kitchen-management")};return w.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16",children:[w.jsxs("div",{className:"container mx-auto px-4 py-8",children:[w.jsxs("div",{className:"flex items-center justify-between mb-6",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("h1",{className:"text-2xl font-bold",children:"Gerenciamento de Pedidos / Mesas"}),w.jsx($t,{size:"icon",variant:"outline",onClick:ie,className:"rounded-full h-8 w-8",disabled:L,children:w.jsx(SN,{className:`h-4 w-4 ${L?"animate-spin":""}`})})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[["admin","restaurant_owner"].includes((e==null?void 0:e.role)||"")&&w.jsx($t,{variant:"destructive",onClick:J,children:"Apagar todos os pedidos"}),["admin","restaurant_owner","chef"].includes((e==null?void 0:e.role)||"")&&w.jsx($t,{onClick:Q,children:"Acessar Cozinha"})]})]}),w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(ee=>w.jsxs(Un,{className:"overflow-hidden",children:[w.jsx("div",{className:`h-2 ${ee.status==="pending"?"bg-yellow-500":ee.status==="preparing"?"bg-blue-500":"bg-green-500"}`}),w.jsxs(wi,{className:"pb-2",children:[w.jsxs("div",{className:"flex justify-between items-start",children:[w.jsx(Si,{children:ee.table_name||ee.table}),w.jsx(Ti,{className:nJ(ee.status),children:iJ(ee.status)})]}),w.jsxs(ls,{className:"flex items-center gap-1",children:[w.jsx(iC,{className:"w-4 h-4"}),new Date(ee.createdAt).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),ee.assignedTo?w.jsxs("div",{className:"mt-1 text-sm flex items-center gap-1 text-gray-600",children:[w.jsx(ST,{className:"w-4 h-4"}),w.jsxs("span",{children:["Atendido por: ",ee.assignedTo]})]}):w.jsxs("div",{className:"mt-1 text-sm flex items-center gap-1 text-yellow-600",children:[w.jsx(ST,{className:"w-4 h-4"}),w.jsx("span",{children:"Atendimento pendente"})]})]}),w.jsx(fi,{children:w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Itens"}),w.jsx("ul",{className:"space-y-2",children:ee.items.map((ue,fe)=>w.jsxs("li",{className:"flex flex-col text-sm",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsxs("span",{children:[ue.quantity,"x ",ue.name]}),w.jsxs("span",{children:["R$ ",(ue.price*ue.quantity).toFixed(2)]})]}),ue.notes&&w.jsx("p",{className:"text-sm text-red-500 italic mt-1",children:ue.notes})]},fe))})]}),w.jsx(pm,{}),w.jsxs("div",{className:"flex justify-between font-medium",children:[w.jsx("span",{children:"Total"}),w.jsxs("span",{children:["R$ ",ee.total.toFixed(2)]})]}),w.jsxs("div",{className:"pt-3 space-y-2",children:[(e==null?void 0:e.role)==="waiter"&&w.jsxs(w.Fragment,{children:[w.jsx($t,{className:"w-full",variant:ee.status==="ready"?"default":"outline",onClick:()=>ee.assignedTo?re(ee):K(ee.id),children:ee.assignedTo?ee.status==="ready"?"Entregar pedido":"Verificar status":"Assumir mesa"}),w.jsx($t,{variant:"outline",className:"w-full",onClick:()=>re(ee),children:"Ver detalhes"})]}),(e==null?void 0:e.role)==="chef"&&w.jsxs("div",{className:"space-y-2",children:[w.jsx($t,{className:"w-full",variant:ee.status==="pending"?"default":"outline",onClick:Q,children:ee.status==="pending"?"Iniciar preparo":ee.status==="preparing"?"Marcar como pronto":"Ver detalhes"}),w.jsx($t,{variant:"outline",className:"w-full",onClick:()=>re(ee),children:"Ver detalhes"})]}),((e==null?void 0:e.role)==="admin"||(e==null?void 0:e.role)==="restaurant_owner")&&w.jsxs("div",{className:"space-y-2",children:[w.jsx($t,{className:"w-full",onClick:()=>ee.assignedTo?re(ee):K(ee.id),children:ee.assignedTo?"Alterar status":"Assumir mesa"}),w.jsx($t,{variant:"outline",className:"w-full",onClick:()=>re(ee),children:"Ver detalhes"})]})]})]})})]},ee.id))})]}),g&&w.jsx(tJ,{order:g,open:C,onOpenChange:i,currentUserRole:(e==null?void 0:e.role)||""})]})},h3=()=>w.jsx(sJ,{});var y4={exports:{}};(function(e,n){(function(o,u){e.exports=u()})(Zo,function(){var o,u,g;function b(i,L){if(!o)o=L;else if(!u)u=L;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",U={};o(U),g=L(U),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}b(["exports"],function(i){function L(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var O,U={},q={};function G(){if(O)return q;O=1,Object.defineProperty(q,"__esModule",{value:!0}),q.setMatrixArrayType=function(h){q.ARRAY_TYPE=t=h},q.toRadian=function(h){return h*c},q.equals=function(h,d){return Math.abs(h-d)<=l*Math.max(1,Math.abs(h),Math.abs(d))},q.RANDOM=q.ARRAY_TYPE=q.EPSILON=void 0;var l=1e-6;q.EPSILON=l;var t=typeof Float32Array<"u"?Float32Array:Array;q.ARRAY_TYPE=t;var s=Math.random;q.RANDOM=s;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var h=0,d=arguments.length;d--;)h+=arguments[d]*arguments[d];return Math.sqrt(h)}),q}var ie,J={};function K(){if(ie)return J;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(d)}ie=1,Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var d=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d},J.clone=function(d){var m=new t.ARRAY_TYPE(4);return m[0]=d[0],m[1]=d[1],m[2]=d[2],m[3]=d[3],m},J.copy=function(d,m){return d[0]=m[0],d[1]=m[1],d[2]=m[2],d[3]=m[3],d},J.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d},J.fromValues=function(d,m,x,T){var M=new t.ARRAY_TYPE(4);return M[0]=d,M[1]=m,M[2]=x,M[3]=T,M},J.set=function(d,m,x,T,M){return d[0]=m,d[1]=x,d[2]=T,d[3]=M,d},J.transpose=function(d,m){if(d===m){var x=m[1];d[1]=m[2],d[2]=x}else d[0]=m[0],d[1]=m[2],d[2]=m[1],d[3]=m[3];return d},J.invert=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=x*y-M*T;return E?(d[0]=y*(E=1/E),d[1]=-T*E,d[2]=-M*E,d[3]=x*E,d):null},J.adjoint=function(d,m){var x=m[0];return d[0]=m[3],d[1]=-m[1],d[2]=-m[2],d[3]=x,d},J.determinant=function(d){return d[0]*d[3]-d[2]*d[1]},J.multiply=c,J.rotate=function(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=Math.sin(x),A=Math.cos(x);return d[0]=T*A+y*P,d[1]=M*A+E*P,d[2]=T*-P+y*A,d[3]=M*-P+E*A,d},J.scale=function(d,m,x){var T=m[1],M=m[2],y=m[3],E=x[0],P=x[1];return d[0]=m[0]*E,d[1]=T*E,d[2]=M*P,d[3]=y*P,d},J.fromRotation=function(d,m){var x=Math.sin(m),T=Math.cos(m);return d[0]=T,d[1]=x,d[2]=-x,d[3]=T,d},J.fromScaling=function(d,m){return d[0]=m[0],d[1]=0,d[2]=0,d[3]=m[1],d},J.str=function(d){return"mat2("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},J.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3])},J.LDU=function(d,m,x,T){return d[2]=T[2]/T[0],x[0]=T[0],x[1]=T[1],x[3]=T[3]-d[2]*x[1],[d,m,x]},J.add=function(d,m,x){return d[0]=m[0]+x[0],d[1]=m[1]+x[1],d[2]=m[2]+x[2],d[3]=m[3]+x[3],d},J.subtract=h,J.exactEquals=function(d,m){return d[0]===m[0]&&d[1]===m[1]&&d[2]===m[2]&&d[3]===m[3]},J.equals=function(d,m){var x=d[0],T=d[1],M=d[2],y=d[3],E=m[0],P=m[1],A=m[2],I=m[3];return Math.abs(x-E)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(T-P)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(M-A)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(y-I)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(I))},J.multiplyScalar=function(d,m,x){return d[0]=m[0]*x,d[1]=m[1]*x,d[2]=m[2]*x,d[3]=m[3]*x,d},J.multiplyScalarAndAdd=function(d,m,x,T){return d[0]=m[0]+x[0]*T,d[1]=m[1]+x[1]*T,d[2]=m[2]+x[2]*T,d[3]=m[3]+x[3]*T,d},J.sub=J.mul=void 0;var t=function(d,m){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var x=s(void 0);if(x&&x.has(d))return x.get(d);var T={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in d)if(y!=="default"&&Object.prototype.hasOwnProperty.call(d,y)){var E=M?Object.getOwnPropertyDescriptor(d,y):null;E&&(E.get||E.set)?Object.defineProperty(T,y,E):T[y]=d[y]}return T.default=d,x&&x.set(d,T),T}(G());function s(d){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(d)}function c(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=x[0],A=x[1],I=x[2],k=x[3];return d[0]=T*P+y*A,d[1]=M*P+E*A,d[2]=T*I+y*k,d[3]=M*I+E*k,d}function h(d,m,x){return d[0]=m[0]-x[0],d[1]=m[1]-x[1],d[2]=m[2]-x[2],d[3]=m[3]-x[3],d}return J.mul=c,J.sub=h,J}var re,Q={};function ee(){if(re)return Q;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(d)}re=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.create=function(){var d=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[4]=0,d[5]=0),d[0]=1,d[3]=1,d},Q.clone=function(d){var m=new t.ARRAY_TYPE(6);return m[0]=d[0],m[1]=d[1],m[2]=d[2],m[3]=d[3],m[4]=d[4],m[5]=d[5],m},Q.copy=function(d,m){return d[0]=m[0],d[1]=m[1],d[2]=m[2],d[3]=m[3],d[4]=m[4],d[5]=m[5],d},Q.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=0,d[5]=0,d},Q.fromValues=function(d,m,x,T,M,y){var E=new t.ARRAY_TYPE(6);return E[0]=d,E[1]=m,E[2]=x,E[3]=T,E[4]=M,E[5]=y,E},Q.set=function(d,m,x,T,M,y,E){return d[0]=m,d[1]=x,d[2]=T,d[3]=M,d[4]=y,d[5]=E,d},Q.invert=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=m[4],P=m[5],A=x*y-T*M;return A?(d[0]=y*(A=1/A),d[1]=-T*A,d[2]=-M*A,d[3]=x*A,d[4]=(M*P-y*E)*A,d[5]=(T*E-x*P)*A,d):null},Q.determinant=function(d){return d[0]*d[3]-d[1]*d[2]},Q.multiply=c,Q.rotate=function(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=Math.sin(x),k=Math.cos(x);return d[0]=T*k+y*I,d[1]=M*k+E*I,d[2]=T*-I+y*k,d[3]=M*-I+E*k,d[4]=P,d[5]=A,d},Q.scale=function(d,m,x){var T=m[1],M=m[2],y=m[3],E=m[4],P=m[5],A=x[0],I=x[1];return d[0]=m[0]*A,d[1]=T*A,d[2]=M*I,d[3]=y*I,d[4]=E,d[5]=P,d},Q.translate=function(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=x[0],k=x[1];return d[0]=T,d[1]=M,d[2]=y,d[3]=E,d[4]=T*I+y*k+P,d[5]=M*I+E*k+A,d},Q.fromRotation=function(d,m){var x=Math.sin(m),T=Math.cos(m);return d[0]=T,d[1]=x,d[2]=-x,d[3]=T,d[4]=0,d[5]=0,d},Q.fromScaling=function(d,m){return d[0]=m[0],d[1]=0,d[2]=0,d[3]=m[1],d[4]=0,d[5]=0,d},Q.fromTranslation=function(d,m){return d[0]=1,d[1]=0,d[2]=0,d[3]=1,d[4]=m[0],d[5]=m[1],d},Q.str=function(d){return"mat2d("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+")"},Q.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],1)},Q.add=function(d,m,x){return d[0]=m[0]+x[0],d[1]=m[1]+x[1],d[2]=m[2]+x[2],d[3]=m[3]+x[3],d[4]=m[4]+x[4],d[5]=m[5]+x[5],d},Q.subtract=h,Q.multiplyScalar=function(d,m,x){return d[0]=m[0]*x,d[1]=m[1]*x,d[2]=m[2]*x,d[3]=m[3]*x,d[4]=m[4]*x,d[5]=m[5]*x,d},Q.multiplyScalarAndAdd=function(d,m,x,T){return d[0]=m[0]+x[0]*T,d[1]=m[1]+x[1]*T,d[2]=m[2]+x[2]*T,d[3]=m[3]+x[3]*T,d[4]=m[4]+x[4]*T,d[5]=m[5]+x[5]*T,d},Q.exactEquals=function(d,m){return d[0]===m[0]&&d[1]===m[1]&&d[2]===m[2]&&d[3]===m[3]&&d[4]===m[4]&&d[5]===m[5]},Q.equals=function(d,m){var x=d[0],T=d[1],M=d[2],y=d[3],E=d[4],P=d[5],A=m[0],I=m[1],k=m[2],j=m[3],F=m[4],W=m[5];return Math.abs(x-A)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(A))&&Math.abs(T-I)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(M-k)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(k))&&Math.abs(y-j)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(E-F)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(F))&&Math.abs(P-W)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(W))},Q.sub=Q.mul=void 0;var t=function(d,m){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var x=s(void 0);if(x&&x.has(d))return x.get(d);var T={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in d)if(y!=="default"&&Object.prototype.hasOwnProperty.call(d,y)){var E=M?Object.getOwnPropertyDescriptor(d,y):null;E&&(E.get||E.set)?Object.defineProperty(T,y,E):T[y]=d[y]}return T.default=d,x&&x.set(d,T),T}(G());function s(d){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(d)}function c(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=x[0],k=x[1],j=x[2],F=x[3],W=x[4],H=x[5];return d[0]=T*I+y*k,d[1]=M*I+E*k,d[2]=T*j+y*F,d[3]=M*j+E*F,d[4]=T*W+y*H+P,d[5]=M*W+E*H+A,d}function h(d,m,x){return d[0]=m[0]-x[0],d[1]=m[1]-x[1],d[2]=m[2]-x[2],d[3]=m[3]-x[3],d[4]=m[4]-x[4],d[5]=m[5]-x[5],d}return Q.mul=c,Q.sub=h,Q}var ue,fe={};function ge(){if(ue)return fe;function l(d){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(d)}ue=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.create=function(){var d=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1,d},fe.fromMat4=function(d,m){return d[0]=m[0],d[1]=m[1],d[2]=m[2],d[3]=m[4],d[4]=m[5],d[5]=m[6],d[6]=m[8],d[7]=m[9],d[8]=m[10],d},fe.clone=function(d){var m=new t.ARRAY_TYPE(9);return m[0]=d[0],m[1]=d[1],m[2]=d[2],m[3]=d[3],m[4]=d[4],m[5]=d[5],m[6]=d[6],m[7]=d[7],m[8]=d[8],m},fe.copy=function(d,m){return d[0]=m[0],d[1]=m[1],d[2]=m[2],d[3]=m[3],d[4]=m[4],d[5]=m[5],d[6]=m[6],d[7]=m[7],d[8]=m[8],d},fe.fromValues=function(d,m,x,T,M,y,E,P,A){var I=new t.ARRAY_TYPE(9);return I[0]=d,I[1]=m,I[2]=x,I[3]=T,I[4]=M,I[5]=y,I[6]=E,I[7]=P,I[8]=A,I},fe.set=function(d,m,x,T,M,y,E,P,A,I){return d[0]=m,d[1]=x,d[2]=T,d[3]=M,d[4]=y,d[5]=E,d[6]=P,d[7]=A,d[8]=I,d},fe.identity=function(d){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.transpose=function(d,m){if(d===m){var x=m[1],T=m[2],M=m[5];d[1]=m[3],d[2]=m[6],d[3]=x,d[5]=m[7],d[6]=T,d[7]=M}else d[0]=m[0],d[1]=m[3],d[2]=m[6],d[3]=m[1],d[4]=m[4],d[5]=m[7],d[6]=m[2],d[7]=m[5],d[8]=m[8];return d},fe.invert=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=m[4],P=m[5],A=m[6],I=m[7],k=m[8],j=k*E-P*I,F=-k*y+P*A,W=I*y-E*A,H=x*j+T*F+M*W;return H?(d[0]=j*(H=1/H),d[1]=(-k*T+M*I)*H,d[2]=(P*T-M*E)*H,d[3]=F*H,d[4]=(k*x-M*A)*H,d[5]=(-P*x+M*y)*H,d[6]=W*H,d[7]=(-I*x+T*A)*H,d[8]=(E*x-T*y)*H,d):null},fe.adjoint=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=m[4],P=m[5],A=m[6],I=m[7],k=m[8];return d[0]=E*k-P*I,d[1]=M*I-T*k,d[2]=T*P-M*E,d[3]=P*A-y*k,d[4]=x*k-M*A,d[5]=M*y-x*P,d[6]=y*I-E*A,d[7]=T*A-x*I,d[8]=x*E-T*y,d},fe.determinant=function(d){var m=d[3],x=d[4],T=d[5],M=d[6],y=d[7],E=d[8];return d[0]*(E*x-T*y)+d[1]*(-E*m+T*M)+d[2]*(y*m-x*M)},fe.multiply=c,fe.translate=function(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=m[6],k=m[7],j=m[8],F=x[0],W=x[1];return d[0]=T,d[1]=M,d[2]=y,d[3]=E,d[4]=P,d[5]=A,d[6]=F*T+W*E+I,d[7]=F*M+W*P+k,d[8]=F*y+W*A+j,d},fe.rotate=function(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=m[6],k=m[7],j=m[8],F=Math.sin(x),W=Math.cos(x);return d[0]=W*T+F*E,d[1]=W*M+F*P,d[2]=W*y+F*A,d[3]=W*E-F*T,d[4]=W*P-F*M,d[5]=W*A-F*y,d[6]=I,d[7]=k,d[8]=j,d},fe.scale=function(d,m,x){var T=x[0],M=x[1];return d[0]=T*m[0],d[1]=T*m[1],d[2]=T*m[2],d[3]=M*m[3],d[4]=M*m[4],d[5]=M*m[5],d[6]=m[6],d[7]=m[7],d[8]=m[8],d},fe.fromTranslation=function(d,m){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=m[0],d[7]=m[1],d[8]=1,d},fe.fromRotation=function(d,m){var x=Math.sin(m),T=Math.cos(m);return d[0]=T,d[1]=x,d[2]=0,d[3]=-x,d[4]=T,d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.fromScaling=function(d,m){return d[0]=m[0],d[1]=0,d[2]=0,d[3]=0,d[4]=m[1],d[5]=0,d[6]=0,d[7]=0,d[8]=1,d},fe.fromMat2d=function(d,m){return d[0]=m[0],d[1]=m[1],d[2]=0,d[3]=m[2],d[4]=m[3],d[5]=0,d[6]=m[4],d[7]=m[5],d[8]=1,d},fe.fromQuat=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=x+x,P=T+T,A=M+M,I=x*E,k=T*E,j=T*P,F=M*E,W=M*P,H=M*A,$=y*E,Y=y*P,ne=y*A;return d[0]=1-j-H,d[3]=k-ne,d[6]=F+Y,d[1]=k+ne,d[4]=1-I-H,d[7]=W-$,d[2]=F-Y,d[5]=W+$,d[8]=1-I-j,d},fe.normalFromMat4=function(d,m){var x=m[0],T=m[1],M=m[2],y=m[3],E=m[4],P=m[5],A=m[6],I=m[7],k=m[8],j=m[9],F=m[10],W=m[11],H=m[12],$=m[13],Y=m[14],ne=m[15],oe=x*P-T*E,ye=x*A-M*E,pe=x*I-y*E,me=T*A-M*P,Me=T*I-y*P,ve=M*I-y*A,Ie=k*$-j*H,Oe=k*Y-F*H,Le=k*ne-W*H,Fe=j*Y-F*$,je=j*ne-W*$,Xe=F*ne-W*Y,$e=oe*Xe-ye*je+pe*Fe+me*Le-Me*Oe+ve*Ie;return $e?(d[0]=(P*Xe-A*je+I*Fe)*($e=1/$e),d[1]=(A*Le-E*Xe-I*Oe)*$e,d[2]=(E*je-P*Le+I*Ie)*$e,d[3]=(M*je-T*Xe-y*Fe)*$e,d[4]=(x*Xe-M*Le+y*Oe)*$e,d[5]=(T*Le-x*je-y*Ie)*$e,d[6]=($*ve-Y*Me+ne*me)*$e,d[7]=(Y*pe-H*ve-ne*ye)*$e,d[8]=(H*Me-$*pe+ne*oe)*$e,d):null},fe.projection=function(d,m,x){return d[0]=2/m,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/x,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,d},fe.str=function(d){return"mat3("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"},fe.frob=function(d){return Math.hypot(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8])},fe.add=function(d,m,x){return d[0]=m[0]+x[0],d[1]=m[1]+x[1],d[2]=m[2]+x[2],d[3]=m[3]+x[3],d[4]=m[4]+x[4],d[5]=m[5]+x[5],d[6]=m[6]+x[6],d[7]=m[7]+x[7],d[8]=m[8]+x[8],d},fe.subtract=h,fe.multiplyScalar=function(d,m,x){return d[0]=m[0]*x,d[1]=m[1]*x,d[2]=m[2]*x,d[3]=m[3]*x,d[4]=m[4]*x,d[5]=m[5]*x,d[6]=m[6]*x,d[7]=m[7]*x,d[8]=m[8]*x,d},fe.multiplyScalarAndAdd=function(d,m,x,T){return d[0]=m[0]+x[0]*T,d[1]=m[1]+x[1]*T,d[2]=m[2]+x[2]*T,d[3]=m[3]+x[3]*T,d[4]=m[4]+x[4]*T,d[5]=m[5]+x[5]*T,d[6]=m[6]+x[6]*T,d[7]=m[7]+x[7]*T,d[8]=m[8]+x[8]*T,d},fe.exactEquals=function(d,m){return d[0]===m[0]&&d[1]===m[1]&&d[2]===m[2]&&d[3]===m[3]&&d[4]===m[4]&&d[5]===m[5]&&d[6]===m[6]&&d[7]===m[7]&&d[8]===m[8]},fe.equals=function(d,m){var x=d[0],T=d[1],M=d[2],y=d[3],E=d[4],P=d[5],A=d[6],I=d[7],k=d[8],j=m[0],F=m[1],W=m[2],H=m[3],$=m[4],Y=m[5],ne=m[6],oe=m[7],ye=m[8];return Math.abs(x-j)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))&&Math.abs(T-F)<=t.EPSILON*Math.max(1,Math.abs(T),Math.abs(F))&&Math.abs(M-W)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(W))&&Math.abs(y-H)<=t.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(E-$)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs($))&&Math.abs(P-Y)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(Y))&&Math.abs(A-ne)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(ne))&&Math.abs(I-oe)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(oe))&&Math.abs(k-ye)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(ye))},fe.sub=fe.mul=void 0;var t=function(d,m){if(d&&d.__esModule)return d;if(d===null||l(d)!=="object"&&typeof d!="function")return{default:d};var x=s(void 0);if(x&&x.has(d))return x.get(d);var T={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in d)if(y!=="default"&&Object.prototype.hasOwnProperty.call(d,y)){var E=M?Object.getOwnPropertyDescriptor(d,y):null;E&&(E.get||E.set)?Object.defineProperty(T,y,E):T[y]=d[y]}return T.default=d,x&&x.set(d,T),T}(G());function s(d){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(T){return T?x:m})(d)}function c(d,m,x){var T=m[0],M=m[1],y=m[2],E=m[3],P=m[4],A=m[5],I=m[6],k=m[7],j=m[8],F=x[0],W=x[1],H=x[2],$=x[3],Y=x[4],ne=x[5],oe=x[6],ye=x[7],pe=x[8];return d[0]=F*T+W*E+H*I,d[1]=F*M+W*P+H*k,d[2]=F*y+W*A+H*j,d[3]=$*T+Y*E+ne*I,d[4]=$*M+Y*P+ne*k,d[5]=$*y+Y*A+ne*j,d[6]=oe*T+ye*E+pe*I,d[7]=oe*M+ye*P+pe*k,d[8]=oe*y+ye*A+pe*j,d}function h(d,m,x){return d[0]=m[0]-x[0],d[1]=m[1]-x[1],d[2]=m[2]-x[2],d[3]=m[3]-x[3],d[4]=m[4]-x[4],d[5]=m[5]-x[5],d[6]=m[6]-x[6],d[7]=m[7]-x[7],d[8]=m[8]-x[8],d}return fe.mul=c,fe.sub=h,fe}var ke,Ce={};function Be(){if(ke)return Ce;function l(y){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},l(y)}ke=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=function(){var y=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0),y[0]=1,y[5]=1,y[10]=1,y[15]=1,y},Ce.clone=function(y){var E=new t.ARRAY_TYPE(16);return E[0]=y[0],E[1]=y[1],E[2]=y[2],E[3]=y[3],E[4]=y[4],E[5]=y[5],E[6]=y[6],E[7]=y[7],E[8]=y[8],E[9]=y[9],E[10]=y[10],E[11]=y[11],E[12]=y[12],E[13]=y[13],E[14]=y[14],E[15]=y[15],E},Ce.copy=function(y,E){return y[0]=E[0],y[1]=E[1],y[2]=E[2],y[3]=E[3],y[4]=E[4],y[5]=E[5],y[6]=E[6],y[7]=E[7],y[8]=E[8],y[9]=E[9],y[10]=E[10],y[11]=E[11],y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15],y},Ce.fromValues=function(y,E,P,A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe){var me=new t.ARRAY_TYPE(16);return me[0]=y,me[1]=E,me[2]=P,me[3]=A,me[4]=I,me[5]=k,me[6]=j,me[7]=F,me[8]=W,me[9]=H,me[10]=$,me[11]=Y,me[12]=ne,me[13]=oe,me[14]=ye,me[15]=pe,me},Ce.set=function(y,E,P,A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe,me){return y[0]=E,y[1]=P,y[2]=A,y[3]=I,y[4]=k,y[5]=j,y[6]=F,y[7]=W,y[8]=H,y[9]=$,y[10]=Y,y[11]=ne,y[12]=oe,y[13]=ye,y[14]=pe,y[15]=me,y},Ce.identity=c,Ce.transpose=function(y,E){if(y===E){var P=E[1],A=E[2],I=E[3],k=E[6],j=E[7],F=E[11];y[1]=E[4],y[2]=E[8],y[3]=E[12],y[4]=P,y[6]=E[9],y[7]=E[13],y[8]=A,y[9]=k,y[11]=E[14],y[12]=I,y[13]=j,y[14]=F}else y[0]=E[0],y[1]=E[4],y[2]=E[8],y[3]=E[12],y[4]=E[1],y[5]=E[5],y[6]=E[9],y[7]=E[13],y[8]=E[2],y[9]=E[6],y[10]=E[10],y[11]=E[14],y[12]=E[3],y[13]=E[7],y[14]=E[11],y[15]=E[15];return y},Ce.invert=function(y,E){var P=E[0],A=E[1],I=E[2],k=E[3],j=E[4],F=E[5],W=E[6],H=E[7],$=E[8],Y=E[9],ne=E[10],oe=E[11],ye=E[12],pe=E[13],me=E[14],Me=E[15],ve=P*F-A*j,Ie=P*W-I*j,Oe=P*H-k*j,Le=A*W-I*F,Fe=A*H-k*F,je=I*H-k*W,Xe=$*pe-Y*ye,$e=$*me-ne*ye,Ke=$*Me-oe*ye,xt=Y*me-ne*pe,yt=Y*Me-oe*pe,Ut=ne*Me-oe*me,Et=ve*Ut-Ie*yt+Oe*xt+Le*Ke-Fe*$e+je*Xe;return Et?(y[0]=(F*Ut-W*yt+H*xt)*(Et=1/Et),y[1]=(I*yt-A*Ut-k*xt)*Et,y[2]=(pe*je-me*Fe+Me*Le)*Et,y[3]=(ne*Fe-Y*je-oe*Le)*Et,y[4]=(W*Ke-j*Ut-H*$e)*Et,y[5]=(P*Ut-I*Ke+k*$e)*Et,y[6]=(me*Oe-ye*je-Me*Ie)*Et,y[7]=($*je-ne*Oe+oe*Ie)*Et,y[8]=(j*yt-F*Ke+H*Xe)*Et,y[9]=(A*Ke-P*yt-k*Xe)*Et,y[10]=(ye*Fe-pe*Oe+Me*ve)*Et,y[11]=(Y*Oe-$*Fe-oe*ve)*Et,y[12]=(F*$e-j*xt-W*Xe)*Et,y[13]=(P*xt-A*$e+I*Xe)*Et,y[14]=(pe*Ie-ye*Le-me*ve)*Et,y[15]=($*Le-Y*Ie+ne*ve)*Et,y):null},Ce.adjoint=function(y,E){var P=E[0],A=E[1],I=E[2],k=E[3],j=E[4],F=E[5],W=E[6],H=E[7],$=E[8],Y=E[9],ne=E[10],oe=E[11],ye=E[12],pe=E[13],me=E[14],Me=E[15];return y[0]=F*(ne*Me-oe*me)-Y*(W*Me-H*me)+pe*(W*oe-H*ne),y[1]=-(A*(ne*Me-oe*me)-Y*(I*Me-k*me)+pe*(I*oe-k*ne)),y[2]=A*(W*Me-H*me)-F*(I*Me-k*me)+pe*(I*H-k*W),y[3]=-(A*(W*oe-H*ne)-F*(I*oe-k*ne)+Y*(I*H-k*W)),y[4]=-(j*(ne*Me-oe*me)-$*(W*Me-H*me)+ye*(W*oe-H*ne)),y[5]=P*(ne*Me-oe*me)-$*(I*Me-k*me)+ye*(I*oe-k*ne),y[6]=-(P*(W*Me-H*me)-j*(I*Me-k*me)+ye*(I*H-k*W)),y[7]=P*(W*oe-H*ne)-j*(I*oe-k*ne)+$*(I*H-k*W),y[8]=j*(Y*Me-oe*pe)-$*(F*Me-H*pe)+ye*(F*oe-H*Y),y[9]=-(P*(Y*Me-oe*pe)-$*(A*Me-k*pe)+ye*(A*oe-k*Y)),y[10]=P*(F*Me-H*pe)-j*(A*Me-k*pe)+ye*(A*H-k*F),y[11]=-(P*(F*oe-H*Y)-j*(A*oe-k*Y)+$*(A*H-k*F)),y[12]=-(j*(Y*me-ne*pe)-$*(F*me-W*pe)+ye*(F*ne-W*Y)),y[13]=P*(Y*me-ne*pe)-$*(A*me-I*pe)+ye*(A*ne-I*Y),y[14]=-(P*(F*me-W*pe)-j*(A*me-I*pe)+ye*(A*W-I*F)),y[15]=P*(F*ne-W*Y)-j*(A*ne-I*Y)+$*(A*W-I*F),y},Ce.determinant=function(y){var E=y[0],P=y[1],A=y[2],I=y[3],k=y[4],j=y[5],F=y[6],W=y[7],H=y[8],$=y[9],Y=y[10],ne=y[11],oe=y[12],ye=y[13],pe=y[14],me=y[15];return(E*j-P*k)*(Y*me-ne*pe)-(E*F-A*k)*($*me-ne*ye)+(E*W-I*k)*($*pe-Y*ye)+(P*F-A*j)*(H*me-ne*oe)-(P*W-I*j)*(H*pe-Y*oe)+(A*W-I*F)*(H*ye-$*oe)},Ce.multiply=h,Ce.translate=function(y,E,P){var A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe=P[0],me=P[1],Me=P[2];return E===y?(y[12]=E[0]*pe+E[4]*me+E[8]*Me+E[12],y[13]=E[1]*pe+E[5]*me+E[9]*Me+E[13],y[14]=E[2]*pe+E[6]*me+E[10]*Me+E[14],y[15]=E[3]*pe+E[7]*me+E[11]*Me+E[15]):(I=E[1],k=E[2],j=E[3],F=E[4],W=E[5],H=E[6],$=E[7],Y=E[8],ne=E[9],oe=E[10],ye=E[11],y[0]=A=E[0],y[1]=I,y[2]=k,y[3]=j,y[4]=F,y[5]=W,y[6]=H,y[7]=$,y[8]=Y,y[9]=ne,y[10]=oe,y[11]=ye,y[12]=A*pe+F*me+Y*Me+E[12],y[13]=I*pe+W*me+ne*Me+E[13],y[14]=k*pe+H*me+oe*Me+E[14],y[15]=j*pe+$*me+ye*Me+E[15]),y},Ce.scale=function(y,E,P){var A=P[0],I=P[1],k=P[2];return y[0]=E[0]*A,y[1]=E[1]*A,y[2]=E[2]*A,y[3]=E[3]*A,y[4]=E[4]*I,y[5]=E[5]*I,y[6]=E[6]*I,y[7]=E[7]*I,y[8]=E[8]*k,y[9]=E[9]*k,y[10]=E[10]*k,y[11]=E[11]*k,y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15],y},Ce.rotate=function(y,E,P,A){var I,k,j,F,W,H,$,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe,Le,Fe,je,Xe,$e,Ke,xt,yt=A[0],Ut=A[1],Et=A[2],Pt=Math.hypot(yt,Ut,Et);return Pt<t.EPSILON?null:(yt*=Pt=1/Pt,Ut*=Pt,Et*=Pt,I=Math.sin(P),k=Math.cos(P),W=E[1],H=E[2],$=E[3],ne=E[5],oe=E[6],ye=E[7],me=E[9],Me=E[10],ve=E[11],Ie=yt*yt*(j=1-k)+k,Fe=yt*Ut*j-Et*I,je=Ut*Ut*j+k,Xe=Et*Ut*j+yt*I,$e=yt*Et*j+Ut*I,Ke=Ut*Et*j-yt*I,xt=Et*Et*j+k,y[0]=(F=E[0])*Ie+(Y=E[4])*(Oe=Ut*yt*j+Et*I)+(pe=E[8])*(Le=Et*yt*j-Ut*I),y[1]=W*Ie+ne*Oe+me*Le,y[2]=H*Ie+oe*Oe+Me*Le,y[3]=$*Ie+ye*Oe+ve*Le,y[4]=F*Fe+Y*je+pe*Xe,y[5]=W*Fe+ne*je+me*Xe,y[6]=H*Fe+oe*je+Me*Xe,y[7]=$*Fe+ye*je+ve*Xe,y[8]=F*$e+Y*Ke+pe*xt,y[9]=W*$e+ne*Ke+me*xt,y[10]=H*$e+oe*Ke+Me*xt,y[11]=$*$e+ye*Ke+ve*xt,E!==y&&(y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15]),y)},Ce.rotateX=function(y,E,P){var A=Math.sin(P),I=Math.cos(P),k=E[4],j=E[5],F=E[6],W=E[7],H=E[8],$=E[9],Y=E[10],ne=E[11];return E!==y&&(y[0]=E[0],y[1]=E[1],y[2]=E[2],y[3]=E[3],y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15]),y[4]=k*I+H*A,y[5]=j*I+$*A,y[6]=F*I+Y*A,y[7]=W*I+ne*A,y[8]=H*I-k*A,y[9]=$*I-j*A,y[10]=Y*I-F*A,y[11]=ne*I-W*A,y},Ce.rotateY=function(y,E,P){var A=Math.sin(P),I=Math.cos(P),k=E[0],j=E[1],F=E[2],W=E[3],H=E[8],$=E[9],Y=E[10],ne=E[11];return E!==y&&(y[4]=E[4],y[5]=E[5],y[6]=E[6],y[7]=E[7],y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15]),y[0]=k*I-H*A,y[1]=j*I-$*A,y[2]=F*I-Y*A,y[3]=W*I-ne*A,y[8]=k*A+H*I,y[9]=j*A+$*I,y[10]=F*A+Y*I,y[11]=W*A+ne*I,y},Ce.rotateZ=function(y,E,P){var A=Math.sin(P),I=Math.cos(P),k=E[0],j=E[1],F=E[2],W=E[3],H=E[4],$=E[5],Y=E[6],ne=E[7];return E!==y&&(y[8]=E[8],y[9]=E[9],y[10]=E[10],y[11]=E[11],y[12]=E[12],y[13]=E[13],y[14]=E[14],y[15]=E[15]),y[0]=k*I+H*A,y[1]=j*I+$*A,y[2]=F*I+Y*A,y[3]=W*I+ne*A,y[4]=H*I-k*A,y[5]=$*I-j*A,y[6]=Y*I-F*A,y[7]=ne*I-W*A,y},Ce.fromTranslation=function(y,E){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=E[0],y[13]=E[1],y[14]=E[2],y[15]=1,y},Ce.fromScaling=function(y,E){return y[0]=E[0],y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=E[1],y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=E[2],y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},Ce.fromRotation=function(y,E,P){var A,I,k,j=P[0],F=P[1],W=P[2],H=Math.hypot(j,F,W);return H<t.EPSILON?null:(j*=H=1/H,F*=H,W*=H,A=Math.sin(E),I=Math.cos(E),y[0]=j*j*(k=1-I)+I,y[1]=F*j*k+W*A,y[2]=W*j*k-F*A,y[3]=0,y[4]=j*F*k-W*A,y[5]=F*F*k+I,y[6]=W*F*k+j*A,y[7]=0,y[8]=j*W*k+F*A,y[9]=F*W*k-j*A,y[10]=W*W*k+I,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y)},Ce.fromXRotation=function(y,E){var P=Math.sin(E),A=Math.cos(E);return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=A,y[6]=P,y[7]=0,y[8]=0,y[9]=-P,y[10]=A,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},Ce.fromYRotation=function(y,E){var P=Math.sin(E),A=Math.cos(E);return y[0]=A,y[1]=0,y[2]=-P,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=P,y[9]=0,y[10]=A,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},Ce.fromZRotation=function(y,E){var P=Math.sin(E),A=Math.cos(E);return y[0]=A,y[1]=P,y[2]=0,y[3]=0,y[4]=-P,y[5]=A,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},Ce.fromRotationTranslation=d,Ce.fromQuat2=function(y,E){var P=new t.ARRAY_TYPE(3),A=-E[0],I=-E[1],k=-E[2],j=E[3],F=E[4],W=E[5],H=E[6],$=E[7],Y=A*A+I*I+k*k+j*j;return Y>0?(P[0]=2*(F*j+$*A+W*k-H*I)/Y,P[1]=2*(W*j+$*I+H*A-F*k)/Y,P[2]=2*(H*j+$*k+F*I-W*A)/Y):(P[0]=2*(F*j+$*A+W*k-H*I),P[1]=2*(W*j+$*I+H*A-F*k),P[2]=2*(H*j+$*k+F*I-W*A)),d(y,E,P),y},Ce.getTranslation=function(y,E){return y[0]=E[12],y[1]=E[13],y[2]=E[14],y},Ce.getScaling=m,Ce.getRotation=function(y,E){var P=new t.ARRAY_TYPE(3);m(P,E);var A=1/P[0],I=1/P[1],k=1/P[2],j=E[0]*A,F=E[1]*I,W=E[2]*k,H=E[4]*A,$=E[5]*I,Y=E[6]*k,ne=E[8]*A,oe=E[9]*I,ye=E[10]*k,pe=j+$+ye,me=0;return pe>0?(me=2*Math.sqrt(pe+1),y[3]=.25*me,y[0]=(Y-oe)/me,y[1]=(ne-W)/me,y[2]=(F-H)/me):j>$&&j>ye?(me=2*Math.sqrt(1+j-$-ye),y[3]=(Y-oe)/me,y[0]=.25*me,y[1]=(F+H)/me,y[2]=(ne+W)/me):$>ye?(me=2*Math.sqrt(1+$-j-ye),y[3]=(ne-W)/me,y[0]=(F+H)/me,y[1]=.25*me,y[2]=(Y+oe)/me):(me=2*Math.sqrt(1+ye-j-$),y[3]=(F-H)/me,y[0]=(ne+W)/me,y[1]=(Y+oe)/me,y[2]=.25*me),y},Ce.fromRotationTranslationScale=function(y,E,P,A){var I=E[0],k=E[1],j=E[2],F=E[3],W=I+I,H=k+k,$=j+j,Y=I*W,ne=I*H,oe=I*$,ye=k*H,pe=k*$,me=j*$,Me=F*W,ve=F*H,Ie=F*$,Oe=A[0],Le=A[1],Fe=A[2];return y[0]=(1-(ye+me))*Oe,y[1]=(ne+Ie)*Oe,y[2]=(oe-ve)*Oe,y[3]=0,y[4]=(ne-Ie)*Le,y[5]=(1-(Y+me))*Le,y[6]=(pe+Me)*Le,y[7]=0,y[8]=(oe+ve)*Fe,y[9]=(pe-Me)*Fe,y[10]=(1-(Y+ye))*Fe,y[11]=0,y[12]=P[0],y[13]=P[1],y[14]=P[2],y[15]=1,y},Ce.fromRotationTranslationScaleOrigin=function(y,E,P,A,I){var k=E[0],j=E[1],F=E[2],W=E[3],H=k+k,$=j+j,Y=F+F,ne=k*H,oe=k*$,ye=k*Y,pe=j*$,me=j*Y,Me=F*Y,ve=W*H,Ie=W*$,Oe=W*Y,Le=A[0],Fe=A[1],je=A[2],Xe=I[0],$e=I[1],Ke=I[2],xt=(1-(pe+Me))*Le,yt=(oe+Oe)*Le,Ut=(ye-Ie)*Le,Et=(oe-Oe)*Fe,Pt=(1-(ne+Me))*Fe,St=(me+ve)*Fe,rr=(ye+Ie)*je,zt=(me-ve)*je,Wt=(1-(ne+pe))*je;return y[0]=xt,y[1]=yt,y[2]=Ut,y[3]=0,y[4]=Et,y[5]=Pt,y[6]=St,y[7]=0,y[8]=rr,y[9]=zt,y[10]=Wt,y[11]=0,y[12]=P[0]+Xe-(xt*Xe+Et*$e+rr*Ke),y[13]=P[1]+$e-(yt*Xe+Pt*$e+zt*Ke),y[14]=P[2]+Ke-(Ut*Xe+St*$e+Wt*Ke),y[15]=1,y},Ce.fromQuat=function(y,E){var P=E[0],A=E[1],I=E[2],k=E[3],j=P+P,F=A+A,W=I+I,H=P*j,$=A*j,Y=A*F,ne=I*j,oe=I*F,ye=I*W,pe=k*j,me=k*F,Me=k*W;return y[0]=1-Y-ye,y[1]=$+Me,y[2]=ne-me,y[3]=0,y[4]=$-Me,y[5]=1-H-ye,y[6]=oe+pe,y[7]=0,y[8]=ne+me,y[9]=oe-pe,y[10]=1-H-Y,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},Ce.frustum=function(y,E,P,A,I,k,j){var F=1/(P-E),W=1/(I-A),H=1/(k-j);return y[0]=2*k*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*k*W,y[6]=0,y[7]=0,y[8]=(P+E)*F,y[9]=(I+A)*W,y[10]=(j+k)*H,y[11]=-1,y[12]=0,y[13]=0,y[14]=j*k*2*H,y[15]=0,y},Ce.perspectiveNO=x,Ce.perspectiveZO=function(y,E,P,A,I){var k,j=1/Math.tan(E/2);return y[0]=j/P,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,I!=null&&I!==1/0?(y[10]=I*(k=1/(A-I)),y[14]=I*A*k):(y[10]=-1,y[14]=-A),y},Ce.perspectiveFromFieldOfView=function(y,E,P,A){var I=Math.tan(E.upDegrees*Math.PI/180),k=Math.tan(E.downDegrees*Math.PI/180),j=Math.tan(E.leftDegrees*Math.PI/180),F=Math.tan(E.rightDegrees*Math.PI/180),W=2/(j+F),H=2/(I+k);return y[0]=W,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=H,y[6]=0,y[7]=0,y[8]=-(j-F)*W*.5,y[9]=(I-k)*H*.5,y[10]=A/(P-A),y[11]=-1,y[12]=0,y[13]=0,y[14]=A*P/(P-A),y[15]=0,y},Ce.orthoNO=T,Ce.orthoZO=function(y,E,P,A,I,k,j){var F=1/(E-P),W=1/(A-I),H=1/(k-j);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*W,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=H,y[11]=0,y[12]=(E+P)*F,y[13]=(I+A)*W,y[14]=k*H,y[15]=1,y},Ce.lookAt=function(y,E,P,A){var I,k,j,F,W,H,$,Y,ne,oe,ye=E[0],pe=E[1],me=E[2],Me=A[0],ve=A[1],Ie=A[2],Oe=P[0],Le=P[1],Fe=P[2];return Math.abs(ye-Oe)<t.EPSILON&&Math.abs(pe-Le)<t.EPSILON&&Math.abs(me-Fe)<t.EPSILON?c(y):($=ye-Oe,Y=pe-Le,ne=me-Fe,I=ve*(ne*=oe=1/Math.hypot($,Y,ne))-Ie*(Y*=oe),k=Ie*($*=oe)-Me*ne,j=Me*Y-ve*$,(oe=Math.hypot(I,k,j))?(I*=oe=1/oe,k*=oe,j*=oe):(I=0,k=0,j=0),F=Y*j-ne*k,W=ne*I-$*j,H=$*k-Y*I,(oe=Math.hypot(F,W,H))?(F*=oe=1/oe,W*=oe,H*=oe):(F=0,W=0,H=0),y[0]=I,y[1]=F,y[2]=$,y[3]=0,y[4]=k,y[5]=W,y[6]=Y,y[7]=0,y[8]=j,y[9]=H,y[10]=ne,y[11]=0,y[12]=-(I*ye+k*pe+j*me),y[13]=-(F*ye+W*pe+H*me),y[14]=-($*ye+Y*pe+ne*me),y[15]=1,y)},Ce.targetTo=function(y,E,P,A){var I=E[0],k=E[1],j=E[2],F=A[0],W=A[1],H=A[2],$=I-P[0],Y=k-P[1],ne=j-P[2],oe=$*$+Y*Y+ne*ne;oe>0&&($*=oe=1/Math.sqrt(oe),Y*=oe,ne*=oe);var ye=W*ne-H*Y,pe=H*$-F*ne,me=F*Y-W*$;return(oe=ye*ye+pe*pe+me*me)>0&&(ye*=oe=1/Math.sqrt(oe),pe*=oe,me*=oe),y[0]=ye,y[1]=pe,y[2]=me,y[3]=0,y[4]=Y*me-ne*pe,y[5]=ne*ye-$*me,y[6]=$*pe-Y*ye,y[7]=0,y[8]=$,y[9]=Y,y[10]=ne,y[11]=0,y[12]=I,y[13]=k,y[14]=j,y[15]=1,y},Ce.str=function(y){return"mat4("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+", "+y[6]+", "+y[7]+", "+y[8]+", "+y[9]+", "+y[10]+", "+y[11]+", "+y[12]+", "+y[13]+", "+y[14]+", "+y[15]+")"},Ce.frob=function(y){return Math.hypot(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])},Ce.add=function(y,E,P){return y[0]=E[0]+P[0],y[1]=E[1]+P[1],y[2]=E[2]+P[2],y[3]=E[3]+P[3],y[4]=E[4]+P[4],y[5]=E[5]+P[5],y[6]=E[6]+P[6],y[7]=E[7]+P[7],y[8]=E[8]+P[8],y[9]=E[9]+P[9],y[10]=E[10]+P[10],y[11]=E[11]+P[11],y[12]=E[12]+P[12],y[13]=E[13]+P[13],y[14]=E[14]+P[14],y[15]=E[15]+P[15],y},Ce.subtract=M,Ce.multiplyScalar=function(y,E,P){return y[0]=E[0]*P,y[1]=E[1]*P,y[2]=E[2]*P,y[3]=E[3]*P,y[4]=E[4]*P,y[5]=E[5]*P,y[6]=E[6]*P,y[7]=E[7]*P,y[8]=E[8]*P,y[9]=E[9]*P,y[10]=E[10]*P,y[11]=E[11]*P,y[12]=E[12]*P,y[13]=E[13]*P,y[14]=E[14]*P,y[15]=E[15]*P,y},Ce.multiplyScalarAndAdd=function(y,E,P,A){return y[0]=E[0]+P[0]*A,y[1]=E[1]+P[1]*A,y[2]=E[2]+P[2]*A,y[3]=E[3]+P[3]*A,y[4]=E[4]+P[4]*A,y[5]=E[5]+P[5]*A,y[6]=E[6]+P[6]*A,y[7]=E[7]+P[7]*A,y[8]=E[8]+P[8]*A,y[9]=E[9]+P[9]*A,y[10]=E[10]+P[10]*A,y[11]=E[11]+P[11]*A,y[12]=E[12]+P[12]*A,y[13]=E[13]+P[13]*A,y[14]=E[14]+P[14]*A,y[15]=E[15]+P[15]*A,y},Ce.exactEquals=function(y,E){return y[0]===E[0]&&y[1]===E[1]&&y[2]===E[2]&&y[3]===E[3]&&y[4]===E[4]&&y[5]===E[5]&&y[6]===E[6]&&y[7]===E[7]&&y[8]===E[8]&&y[9]===E[9]&&y[10]===E[10]&&y[11]===E[11]&&y[12]===E[12]&&y[13]===E[13]&&y[14]===E[14]&&y[15]===E[15]},Ce.equals=function(y,E){var P=y[0],A=y[1],I=y[2],k=y[3],j=y[4],F=y[5],W=y[6],H=y[7],$=y[8],Y=y[9],ne=y[10],oe=y[11],ye=y[12],pe=y[13],me=y[14],Me=y[15],ve=E[0],Ie=E[1],Oe=E[2],Le=E[3],Fe=E[4],je=E[5],Xe=E[6],$e=E[7],Ke=E[8],xt=E[9],yt=E[10],Ut=E[11],Et=E[12],Pt=E[13],St=E[14],rr=E[15];return Math.abs(P-ve)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(ve))&&Math.abs(A-Ie)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ie))&&Math.abs(I-Oe)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(Oe))&&Math.abs(k-Le)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(Le))&&Math.abs(j-Fe)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(Fe))&&Math.abs(F-je)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(je))&&Math.abs(W-Xe)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Xe))&&Math.abs(H-$e)<=t.EPSILON*Math.max(1,Math.abs(H),Math.abs($e))&&Math.abs($-Ke)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(Ke))&&Math.abs(Y-xt)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(xt))&&Math.abs(ne-yt)<=t.EPSILON*Math.max(1,Math.abs(ne),Math.abs(yt))&&Math.abs(oe-Ut)<=t.EPSILON*Math.max(1,Math.abs(oe),Math.abs(Ut))&&Math.abs(ye-Et)<=t.EPSILON*Math.max(1,Math.abs(ye),Math.abs(Et))&&Math.abs(pe-Pt)<=t.EPSILON*Math.max(1,Math.abs(pe),Math.abs(Pt))&&Math.abs(me-St)<=t.EPSILON*Math.max(1,Math.abs(me),Math.abs(St))&&Math.abs(Me-rr)<=t.EPSILON*Math.max(1,Math.abs(Me),Math.abs(rr))},Ce.sub=Ce.mul=Ce.ortho=Ce.perspective=void 0;var t=function(y,E){if(y&&y.__esModule)return y;if(y===null||l(y)!=="object"&&typeof y!="function")return{default:y};var P=s(void 0);if(P&&P.has(y))return P.get(y);var A={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in y)if(k!=="default"&&Object.prototype.hasOwnProperty.call(y,k)){var j=I?Object.getOwnPropertyDescriptor(y,k):null;j&&(j.get||j.set)?Object.defineProperty(A,k,j):A[k]=y[k]}return A.default=y,P&&P.set(y,A),A}(G());function s(y){if(typeof WeakMap!="function")return null;var E=new WeakMap,P=new WeakMap;return(s=function(A){return A?P:E})(y)}function c(y){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y}function h(y,E,P){var A=E[0],I=E[1],k=E[2],j=E[3],F=E[4],W=E[5],H=E[6],$=E[7],Y=E[8],ne=E[9],oe=E[10],ye=E[11],pe=E[12],me=E[13],Me=E[14],ve=E[15],Ie=P[0],Oe=P[1],Le=P[2],Fe=P[3];return y[0]=Ie*A+Oe*F+Le*Y+Fe*pe,y[1]=Ie*I+Oe*W+Le*ne+Fe*me,y[2]=Ie*k+Oe*H+Le*oe+Fe*Me,y[3]=Ie*j+Oe*$+Le*ye+Fe*ve,y[4]=(Ie=P[4])*A+(Oe=P[5])*F+(Le=P[6])*Y+(Fe=P[7])*pe,y[5]=Ie*I+Oe*W+Le*ne+Fe*me,y[6]=Ie*k+Oe*H+Le*oe+Fe*Me,y[7]=Ie*j+Oe*$+Le*ye+Fe*ve,y[8]=(Ie=P[8])*A+(Oe=P[9])*F+(Le=P[10])*Y+(Fe=P[11])*pe,y[9]=Ie*I+Oe*W+Le*ne+Fe*me,y[10]=Ie*k+Oe*H+Le*oe+Fe*Me,y[11]=Ie*j+Oe*$+Le*ye+Fe*ve,y[12]=(Ie=P[12])*A+(Oe=P[13])*F+(Le=P[14])*Y+(Fe=P[15])*pe,y[13]=Ie*I+Oe*W+Le*ne+Fe*me,y[14]=Ie*k+Oe*H+Le*oe+Fe*Me,y[15]=Ie*j+Oe*$+Le*ye+Fe*ve,y}function d(y,E,P){var A=E[0],I=E[1],k=E[2],j=E[3],F=A+A,W=I+I,H=k+k,$=A*F,Y=A*W,ne=A*H,oe=I*W,ye=I*H,pe=k*H,me=j*F,Me=j*W,ve=j*H;return y[0]=1-(oe+pe),y[1]=Y+ve,y[2]=ne-Me,y[3]=0,y[4]=Y-ve,y[5]=1-($+pe),y[6]=ye+me,y[7]=0,y[8]=ne+Me,y[9]=ye-me,y[10]=1-($+oe),y[11]=0,y[12]=P[0],y[13]=P[1],y[14]=P[2],y[15]=1,y}function m(y,E){var P=E[4],A=E[5],I=E[6],k=E[8],j=E[9],F=E[10];return y[0]=Math.hypot(E[0],E[1],E[2]),y[1]=Math.hypot(P,A,I),y[2]=Math.hypot(k,j,F),y}function x(y,E,P,A,I){var k,j=1/Math.tan(E/2);return y[0]=j/P,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=j,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,I!=null&&I!==1/0?(y[10]=(I+A)*(k=1/(A-I)),y[14]=2*I*A*k):(y[10]=-1,y[14]=-2*A),y}function T(y,E,P,A,I,k,j){var F=1/(E-P),W=1/(A-I),H=1/(k-j);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*W,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=2*H,y[11]=0,y[12]=(E+P)*F,y[13]=(I+A)*W,y[14]=(j+k)*H,y[15]=1,y}function M(y,E,P){return y[0]=E[0]-P[0],y[1]=E[1]-P[1],y[2]=E[2]-P[2],y[3]=E[3]-P[3],y[4]=E[4]-P[4],y[5]=E[5]-P[5],y[6]=E[6]-P[6],y[7]=E[7]-P[7],y[8]=E[8]-P[8],y[9]=E[9]-P[9],y[10]=E[10]-P[10],y[11]=E[11]-P[11],y[12]=E[12]-P[12],y[13]=E[13]-P[13],y[14]=E[14]-P[14],y[15]=E[15]-P[15],y}return Ce.perspective=x,Ce.ortho=T,Ce.mul=h,Ce.sub=M,Ce}var dt,Qe={},qe={};function He(){if(dt)return qe;function l(I){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},l(I)}dt=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=c,qe.clone=function(I){var k=new t.ARRAY_TYPE(3);return k[0]=I[0],k[1]=I[1],k[2]=I[2],k},qe.length=h,qe.fromValues=function(I,k,j){var F=new t.ARRAY_TYPE(3);return F[0]=I,F[1]=k,F[2]=j,F},qe.copy=function(I,k){return I[0]=k[0],I[1]=k[1],I[2]=k[2],I},qe.set=function(I,k,j,F){return I[0]=k,I[1]=j,I[2]=F,I},qe.add=function(I,k,j){return I[0]=k[0]+j[0],I[1]=k[1]+j[1],I[2]=k[2]+j[2],I},qe.subtract=d,qe.multiply=m,qe.divide=x,qe.ceil=function(I,k){return I[0]=Math.ceil(k[0]),I[1]=Math.ceil(k[1]),I[2]=Math.ceil(k[2]),I},qe.floor=function(I,k){return I[0]=Math.floor(k[0]),I[1]=Math.floor(k[1]),I[2]=Math.floor(k[2]),I},qe.min=function(I,k,j){return I[0]=Math.min(k[0],j[0]),I[1]=Math.min(k[1],j[1]),I[2]=Math.min(k[2],j[2]),I},qe.max=function(I,k,j){return I[0]=Math.max(k[0],j[0]),I[1]=Math.max(k[1],j[1]),I[2]=Math.max(k[2],j[2]),I},qe.round=function(I,k){return I[0]=Math.round(k[0]),I[1]=Math.round(k[1]),I[2]=Math.round(k[2]),I},qe.scale=function(I,k,j){return I[0]=k[0]*j,I[1]=k[1]*j,I[2]=k[2]*j,I},qe.scaleAndAdd=function(I,k,j,F){return I[0]=k[0]+j[0]*F,I[1]=k[1]+j[1]*F,I[2]=k[2]+j[2]*F,I},qe.distance=T,qe.squaredDistance=M,qe.squaredLength=y,qe.negate=function(I,k){return I[0]=-k[0],I[1]=-k[1],I[2]=-k[2],I},qe.inverse=function(I,k){return I[0]=1/k[0],I[1]=1/k[1],I[2]=1/k[2],I},qe.normalize=function(I,k){var j=k[0],F=k[1],W=k[2],H=j*j+F*F+W*W;return H>0&&(H=1/Math.sqrt(H)),I[0]=k[0]*H,I[1]=k[1]*H,I[2]=k[2]*H,I},qe.dot=E,qe.cross=function(I,k,j){var F=k[0],W=k[1],H=k[2],$=j[0],Y=j[1],ne=j[2];return I[0]=W*ne-H*Y,I[1]=H*$-F*ne,I[2]=F*Y-W*$,I},qe.lerp=function(I,k,j,F){var W=k[0],H=k[1],$=k[2];return I[0]=W+F*(j[0]-W),I[1]=H+F*(j[1]-H),I[2]=$+F*(j[2]-$),I},qe.hermite=function(I,k,j,F,W,H){var $=H*H,Y=$*(2*H-3)+1,ne=$*(H-2)+H,oe=$*(H-1),ye=$*(3-2*H);return I[0]=k[0]*Y+j[0]*ne+F[0]*oe+W[0]*ye,I[1]=k[1]*Y+j[1]*ne+F[1]*oe+W[1]*ye,I[2]=k[2]*Y+j[2]*ne+F[2]*oe+W[2]*ye,I},qe.bezier=function(I,k,j,F,W,H){var $=1-H,Y=$*$,ne=H*H,oe=Y*$,ye=3*H*Y,pe=3*ne*$,me=ne*H;return I[0]=k[0]*oe+j[0]*ye+F[0]*pe+W[0]*me,I[1]=k[1]*oe+j[1]*ye+F[1]*pe+W[1]*me,I[2]=k[2]*oe+j[2]*ye+F[2]*pe+W[2]*me,I},qe.random=function(I,k){k=k||1;var j=2*t.RANDOM()*Math.PI,F=2*t.RANDOM()-1,W=Math.sqrt(1-F*F)*k;return I[0]=Math.cos(j)*W,I[1]=Math.sin(j)*W,I[2]=F*k,I},qe.transformMat4=function(I,k,j){var F=k[0],W=k[1],H=k[2],$=j[3]*F+j[7]*W+j[11]*H+j[15];return I[0]=(j[0]*F+j[4]*W+j[8]*H+j[12])/($=$||1),I[1]=(j[1]*F+j[5]*W+j[9]*H+j[13])/$,I[2]=(j[2]*F+j[6]*W+j[10]*H+j[14])/$,I},qe.transformMat3=function(I,k,j){var F=k[0],W=k[1],H=k[2];return I[0]=F*j[0]+W*j[3]+H*j[6],I[1]=F*j[1]+W*j[4]+H*j[7],I[2]=F*j[2]+W*j[5]+H*j[8],I},qe.transformQuat=function(I,k,j){var F=j[0],W=j[1],H=j[2],$=k[0],Y=k[1],ne=k[2],oe=W*ne-H*Y,ye=H*$-F*ne,pe=F*Y-W*$,me=W*pe-H*ye,Me=H*oe-F*pe,ve=F*ye-W*oe,Ie=2*j[3];return ye*=Ie,pe*=Ie,Me*=2,ve*=2,I[0]=$+(oe*=Ie)+(me*=2),I[1]=Y+ye+Me,I[2]=ne+pe+ve,I},qe.rotateX=function(I,k,j,F){var W=[],H=[];return W[0]=k[0]-j[0],W[1]=k[1]-j[1],W[2]=k[2]-j[2],H[0]=W[0],H[1]=W[1]*Math.cos(F)-W[2]*Math.sin(F),H[2]=W[1]*Math.sin(F)+W[2]*Math.cos(F),I[0]=H[0]+j[0],I[1]=H[1]+j[1],I[2]=H[2]+j[2],I},qe.rotateY=function(I,k,j,F){var W=[],H=[];return W[0]=k[0]-j[0],W[1]=k[1]-j[1],W[2]=k[2]-j[2],H[0]=W[2]*Math.sin(F)+W[0]*Math.cos(F),H[1]=W[1],H[2]=W[2]*Math.cos(F)-W[0]*Math.sin(F),I[0]=H[0]+j[0],I[1]=H[1]+j[1],I[2]=H[2]+j[2],I},qe.rotateZ=function(I,k,j,F){var W=[],H=[];return W[0]=k[0]-j[0],W[1]=k[1]-j[1],W[2]=k[2]-j[2],H[0]=W[0]*Math.cos(F)-W[1]*Math.sin(F),H[1]=W[0]*Math.sin(F)+W[1]*Math.cos(F),H[2]=W[2],I[0]=H[0]+j[0],I[1]=H[1]+j[1],I[2]=H[2]+j[2],I},qe.angle=function(I,k){var j=I[0],F=I[1],W=I[2],H=k[0],$=k[1],Y=k[2],ne=Math.sqrt(j*j+F*F+W*W)*Math.sqrt(H*H+$*$+Y*Y),oe=ne&&E(I,k)/ne;return Math.acos(Math.min(Math.max(oe,-1),1))},qe.zero=function(I){return I[0]=0,I[1]=0,I[2]=0,I},qe.str=function(I){return"vec3("+I[0]+", "+I[1]+", "+I[2]+")"},qe.exactEquals=function(I,k){return I[0]===k[0]&&I[1]===k[1]&&I[2]===k[2]},qe.equals=function(I,k){var j=I[0],F=I[1],W=I[2],H=k[0],$=k[1],Y=k[2];return Math.abs(j-H)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(H))&&Math.abs(F-$)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs($))&&Math.abs(W-Y)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Y))},qe.forEach=qe.sqrLen=qe.len=qe.sqrDist=qe.dist=qe.div=qe.mul=qe.sub=void 0;var t=function(I,k){if(I&&I.__esModule)return I;if(I===null||l(I)!=="object"&&typeof I!="function")return{default:I};var j=s(void 0);if(j&&j.has(I))return j.get(I);var F={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in I)if(H!=="default"&&Object.prototype.hasOwnProperty.call(I,H)){var $=W?Object.getOwnPropertyDescriptor(I,H):null;$&&($.get||$.set)?Object.defineProperty(F,H,$):F[H]=I[H]}return F.default=I,j&&j.set(I,F),F}(G());function s(I){if(typeof WeakMap!="function")return null;var k=new WeakMap,j=new WeakMap;return(s=function(F){return F?j:k})(I)}function c(){var I=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0),I}function h(I){return Math.hypot(I[0],I[1],I[2])}function d(I,k,j){return I[0]=k[0]-j[0],I[1]=k[1]-j[1],I[2]=k[2]-j[2],I}function m(I,k,j){return I[0]=k[0]*j[0],I[1]=k[1]*j[1],I[2]=k[2]*j[2],I}function x(I,k,j){return I[0]=k[0]/j[0],I[1]=k[1]/j[1],I[2]=k[2]/j[2],I}function T(I,k){return Math.hypot(k[0]-I[0],k[1]-I[1],k[2]-I[2])}function M(I,k){var j=k[0]-I[0],F=k[1]-I[1],W=k[2]-I[2];return j*j+F*F+W*W}function y(I){var k=I[0],j=I[1],F=I[2];return k*k+j*j+F*F}function E(I,k){return I[0]*k[0]+I[1]*k[1]+I[2]*k[2]}qe.sub=d,qe.mul=m,qe.div=x,qe.dist=T,qe.sqrDist=M,qe.len=h,qe.sqrLen=y;var P,A=(P=c(),function(I,k,j,F,W,H){var $,Y;for(k||(k=3),j||(j=0),Y=F?Math.min(F*k+j,I.length):I.length,$=j;$<Y;$+=k)P[0]=I[$],P[1]=I[$+1],P[2]=I[$+2],W(P,P,H),I[$]=P[0],I[$+1]=P[1],I[$+2]=P[2];return I});return qe.forEach=A,qe}var et,mt,Ze={};function Tt(){if(et)return Ze;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(A)}et=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=c,Ze.clone=function(A){var I=new t.ARRAY_TYPE(4);return I[0]=A[0],I[1]=A[1],I[2]=A[2],I[3]=A[3],I},Ze.fromValues=function(A,I,k,j){var F=new t.ARRAY_TYPE(4);return F[0]=A,F[1]=I,F[2]=k,F[3]=j,F},Ze.copy=function(A,I){return A[0]=I[0],A[1]=I[1],A[2]=I[2],A[3]=I[3],A},Ze.set=function(A,I,k,j,F){return A[0]=I,A[1]=k,A[2]=j,A[3]=F,A},Ze.add=function(A,I,k){return A[0]=I[0]+k[0],A[1]=I[1]+k[1],A[2]=I[2]+k[2],A[3]=I[3]+k[3],A},Ze.subtract=h,Ze.multiply=d,Ze.divide=m,Ze.ceil=function(A,I){return A[0]=Math.ceil(I[0]),A[1]=Math.ceil(I[1]),A[2]=Math.ceil(I[2]),A[3]=Math.ceil(I[3]),A},Ze.floor=function(A,I){return A[0]=Math.floor(I[0]),A[1]=Math.floor(I[1]),A[2]=Math.floor(I[2]),A[3]=Math.floor(I[3]),A},Ze.min=function(A,I,k){return A[0]=Math.min(I[0],k[0]),A[1]=Math.min(I[1],k[1]),A[2]=Math.min(I[2],k[2]),A[3]=Math.min(I[3],k[3]),A},Ze.max=function(A,I,k){return A[0]=Math.max(I[0],k[0]),A[1]=Math.max(I[1],k[1]),A[2]=Math.max(I[2],k[2]),A[3]=Math.max(I[3],k[3]),A},Ze.round=function(A,I){return A[0]=Math.round(I[0]),A[1]=Math.round(I[1]),A[2]=Math.round(I[2]),A[3]=Math.round(I[3]),A},Ze.scale=function(A,I,k){return A[0]=I[0]*k,A[1]=I[1]*k,A[2]=I[2]*k,A[3]=I[3]*k,A},Ze.scaleAndAdd=function(A,I,k,j){return A[0]=I[0]+k[0]*j,A[1]=I[1]+k[1]*j,A[2]=I[2]+k[2]*j,A[3]=I[3]+k[3]*j,A},Ze.distance=x,Ze.squaredDistance=T,Ze.length=M,Ze.squaredLength=y,Ze.negate=function(A,I){return A[0]=-I[0],A[1]=-I[1],A[2]=-I[2],A[3]=-I[3],A},Ze.inverse=function(A,I){return A[0]=1/I[0],A[1]=1/I[1],A[2]=1/I[2],A[3]=1/I[3],A},Ze.normalize=function(A,I){var k=I[0],j=I[1],F=I[2],W=I[3],H=k*k+j*j+F*F+W*W;return H>0&&(H=1/Math.sqrt(H)),A[0]=k*H,A[1]=j*H,A[2]=F*H,A[3]=W*H,A},Ze.dot=function(A,I){return A[0]*I[0]+A[1]*I[1]+A[2]*I[2]+A[3]*I[3]},Ze.cross=function(A,I,k,j){var F=k[0]*j[1]-k[1]*j[0],W=k[0]*j[2]-k[2]*j[0],H=k[0]*j[3]-k[3]*j[0],$=k[1]*j[2]-k[2]*j[1],Y=k[1]*j[3]-k[3]*j[1],ne=k[2]*j[3]-k[3]*j[2],oe=I[0],ye=I[1],pe=I[2],me=I[3];return A[0]=ye*ne-pe*Y+me*$,A[1]=-oe*ne+pe*H-me*W,A[2]=oe*Y-ye*H+me*F,A[3]=-oe*$+ye*W-pe*F,A},Ze.lerp=function(A,I,k,j){var F=I[0],W=I[1],H=I[2],$=I[3];return A[0]=F+j*(k[0]-F),A[1]=W+j*(k[1]-W),A[2]=H+j*(k[2]-H),A[3]=$+j*(k[3]-$),A},Ze.random=function(A,I){var k,j,F,W,H,$;I=I||1;do H=(k=2*t.RANDOM()-1)*k+(j=2*t.RANDOM()-1)*j;while(H>=1);do $=(F=2*t.RANDOM()-1)*F+(W=2*t.RANDOM()-1)*W;while($>=1);var Y=Math.sqrt((1-H)/$);return A[0]=I*k,A[1]=I*j,A[2]=I*F*Y,A[3]=I*W*Y,A},Ze.transformMat4=function(A,I,k){var j=I[0],F=I[1],W=I[2],H=I[3];return A[0]=k[0]*j+k[4]*F+k[8]*W+k[12]*H,A[1]=k[1]*j+k[5]*F+k[9]*W+k[13]*H,A[2]=k[2]*j+k[6]*F+k[10]*W+k[14]*H,A[3]=k[3]*j+k[7]*F+k[11]*W+k[15]*H,A},Ze.transformQuat=function(A,I,k){var j=I[0],F=I[1],W=I[2],H=k[0],$=k[1],Y=k[2],ne=k[3],oe=ne*j+$*W-Y*F,ye=ne*F+Y*j-H*W,pe=ne*W+H*F-$*j,me=-H*j-$*F-Y*W;return A[0]=oe*ne+me*-H+ye*-Y-pe*-$,A[1]=ye*ne+me*-$+pe*-H-oe*-Y,A[2]=pe*ne+me*-Y+oe*-$-ye*-H,A[3]=I[3],A},Ze.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},Ze.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},Ze.exactEquals=function(A,I){return A[0]===I[0]&&A[1]===I[1]&&A[2]===I[2]&&A[3]===I[3]},Ze.equals=function(A,I){var k=A[0],j=A[1],F=A[2],W=A[3],H=I[0],$=I[1],Y=I[2],ne=I[3];return Math.abs(k-H)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(H))&&Math.abs(j-$)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs($))&&Math.abs(F-Y)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(Y))&&Math.abs(W-ne)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(ne))},Ze.forEach=Ze.sqrLen=Ze.len=Ze.sqrDist=Ze.dist=Ze.div=Ze.mul=Ze.sub=void 0;var t=function(A,I){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var k=s(void 0);if(k&&k.has(A))return k.get(A);var j={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in A)if(W!=="default"&&Object.prototype.hasOwnProperty.call(A,W)){var H=F?Object.getOwnPropertyDescriptor(A,W):null;H&&(H.get||H.set)?Object.defineProperty(j,W,H):j[W]=A[W]}return j.default=A,k&&k.set(A,j),j}(G());function s(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(s=function(j){return j?k:I})(A)}function c(){var A=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function h(A,I,k){return A[0]=I[0]-k[0],A[1]=I[1]-k[1],A[2]=I[2]-k[2],A[3]=I[3]-k[3],A}function d(A,I,k){return A[0]=I[0]*k[0],A[1]=I[1]*k[1],A[2]=I[2]*k[2],A[3]=I[3]*k[3],A}function m(A,I,k){return A[0]=I[0]/k[0],A[1]=I[1]/k[1],A[2]=I[2]/k[2],A[3]=I[3]/k[3],A}function x(A,I){return Math.hypot(I[0]-A[0],I[1]-A[1],I[2]-A[2],I[3]-A[3])}function T(A,I){var k=I[0]-A[0],j=I[1]-A[1],F=I[2]-A[2],W=I[3]-A[3];return k*k+j*j+F*F+W*W}function M(A){return Math.hypot(A[0],A[1],A[2],A[3])}function y(A){var I=A[0],k=A[1],j=A[2],F=A[3];return I*I+k*k+j*j+F*F}Ze.sub=h,Ze.mul=d,Ze.div=m,Ze.dist=x,Ze.sqrDist=T,Ze.len=M,Ze.sqrLen=y;var E,P=(E=c(),function(A,I,k,j,F,W){var H,$;for(I||(I=4),k||(k=0),$=j?Math.min(j*I+k,A.length):A.length,H=k;H<$;H+=I)E[0]=A[H],E[1]=A[H+1],E[2]=A[H+2],E[3]=A[H+3],F(E,E,W),A[H]=E[0],A[H+1]=E[1],A[H+2]=E[2],A[H+3]=E[3];return A});return Ze.forEach=P,Ze}function Gt(){if(mt)return Qe;function l(ve){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ie){return typeof Ie}:function(Ie){return Ie&&typeof Symbol=="function"&&Ie.constructor===Symbol&&Ie!==Symbol.prototype?"symbol":typeof Ie},l(ve)}mt=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=x,Qe.identity=function(ve){return ve[0]=0,ve[1]=0,ve[2]=0,ve[3]=1,ve},Qe.setAxisAngle=T,Qe.getAxisAngle=function(ve,Ie){var Oe=2*Math.acos(Ie[3]),Le=Math.sin(Oe/2);return Le>t.EPSILON?(ve[0]=Ie[0]/Le,ve[1]=Ie[1]/Le,ve[2]=Ie[2]/Le):(ve[0]=1,ve[1]=0,ve[2]=0),Oe},Qe.getAngle=function(ve,Ie){var Oe=k(ve,Ie);return Math.acos(2*Oe*Oe-1)},Qe.multiply=M,Qe.rotateX=function(ve,Ie,Oe){Oe*=.5;var Le=Ie[0],Fe=Ie[1],je=Ie[2],Xe=Ie[3],$e=Math.sin(Oe),Ke=Math.cos(Oe);return ve[0]=Le*Ke+Xe*$e,ve[1]=Fe*Ke+je*$e,ve[2]=je*Ke-Fe*$e,ve[3]=Xe*Ke-Le*$e,ve},Qe.rotateY=function(ve,Ie,Oe){Oe*=.5;var Le=Ie[0],Fe=Ie[1],je=Ie[2],Xe=Ie[3],$e=Math.sin(Oe),Ke=Math.cos(Oe);return ve[0]=Le*Ke-je*$e,ve[1]=Fe*Ke+Xe*$e,ve[2]=je*Ke+Le*$e,ve[3]=Xe*Ke-Fe*$e,ve},Qe.rotateZ=function(ve,Ie,Oe){Oe*=.5;var Le=Ie[0],Fe=Ie[1],je=Ie[2],Xe=Ie[3],$e=Math.sin(Oe),Ke=Math.cos(Oe);return ve[0]=Le*Ke+Fe*$e,ve[1]=Fe*Ke-Le*$e,ve[2]=je*Ke+Xe*$e,ve[3]=Xe*Ke-je*$e,ve},Qe.calculateW=function(ve,Ie){var Oe=Ie[0],Le=Ie[1],Fe=Ie[2];return ve[0]=Oe,ve[1]=Le,ve[2]=Fe,ve[3]=Math.sqrt(Math.abs(1-Oe*Oe-Le*Le-Fe*Fe)),ve},Qe.exp=y,Qe.ln=E,Qe.pow=function(ve,Ie,Oe){return E(ve,Ie),I(ve,ve,Oe),y(ve,ve),ve},Qe.slerp=P,Qe.random=function(ve){var Ie=t.RANDOM(),Oe=t.RANDOM(),Le=t.RANDOM(),Fe=Math.sqrt(1-Ie),je=Math.sqrt(Ie);return ve[0]=Fe*Math.sin(2*Math.PI*Oe),ve[1]=Fe*Math.cos(2*Math.PI*Oe),ve[2]=je*Math.sin(2*Math.PI*Le),ve[3]=je*Math.cos(2*Math.PI*Le),ve},Qe.invert=function(ve,Ie){var Oe=Ie[0],Le=Ie[1],Fe=Ie[2],je=Ie[3],Xe=Oe*Oe+Le*Le+Fe*Fe+je*je,$e=Xe?1/Xe:0;return ve[0]=-Oe*$e,ve[1]=-Le*$e,ve[2]=-Fe*$e,ve[3]=je*$e,ve},Qe.conjugate=function(ve,Ie){return ve[0]=-Ie[0],ve[1]=-Ie[1],ve[2]=-Ie[2],ve[3]=Ie[3],ve},Qe.fromMat3=A,Qe.fromEuler=function(ve,Ie,Oe,Le){var Fe=.5*Math.PI/180;Ie*=Fe,Oe*=Fe,Le*=Fe;var je=Math.sin(Ie),Xe=Math.cos(Ie),$e=Math.sin(Oe),Ke=Math.cos(Oe),xt=Math.sin(Le),yt=Math.cos(Le);return ve[0]=je*Ke*yt-Xe*$e*xt,ve[1]=Xe*$e*yt+je*Ke*xt,ve[2]=Xe*Ke*xt-je*$e*yt,ve[3]=Xe*Ke*yt+je*$e*xt,ve},Qe.str=function(ve){return"quat("+ve[0]+", "+ve[1]+", "+ve[2]+", "+ve[3]+")"},Qe.setAxes=Qe.sqlerp=Qe.rotationTo=Qe.equals=Qe.exactEquals=Qe.normalize=Qe.sqrLen=Qe.squaredLength=Qe.len=Qe.length=Qe.lerp=Qe.dot=Qe.scale=Qe.mul=Qe.add=Qe.set=Qe.copy=Qe.fromValues=Qe.clone=void 0;var t=m(G()),s=m(ge()),c=m(He()),h=m(Tt());function d(ve){if(typeof WeakMap!="function")return null;var Ie=new WeakMap,Oe=new WeakMap;return(d=function(Le){return Le?Oe:Ie})(ve)}function m(ve,Ie){if(ve&&ve.__esModule)return ve;if(ve===null||l(ve)!=="object"&&typeof ve!="function")return{default:ve};var Oe=d(Ie);if(Oe&&Oe.has(ve))return Oe.get(ve);var Le={},Fe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var je in ve)if(je!=="default"&&Object.prototype.hasOwnProperty.call(ve,je)){var Xe=Fe?Object.getOwnPropertyDescriptor(ve,je):null;Xe&&(Xe.get||Xe.set)?Object.defineProperty(Le,je,Xe):Le[je]=ve[je]}return Le.default=ve,Oe&&Oe.set(ve,Le),Le}function x(){var ve=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(ve[0]=0,ve[1]=0,ve[2]=0),ve[3]=1,ve}function T(ve,Ie,Oe){Oe*=.5;var Le=Math.sin(Oe);return ve[0]=Le*Ie[0],ve[1]=Le*Ie[1],ve[2]=Le*Ie[2],ve[3]=Math.cos(Oe),ve}function M(ve,Ie,Oe){var Le=Ie[0],Fe=Ie[1],je=Ie[2],Xe=Ie[3],$e=Oe[0],Ke=Oe[1],xt=Oe[2],yt=Oe[3];return ve[0]=Le*yt+Xe*$e+Fe*xt-je*Ke,ve[1]=Fe*yt+Xe*Ke+je*$e-Le*xt,ve[2]=je*yt+Xe*xt+Le*Ke-Fe*$e,ve[3]=Xe*yt-Le*$e-Fe*Ke-je*xt,ve}function y(ve,Ie){var Oe=Ie[0],Le=Ie[1],Fe=Ie[2],je=Ie[3],Xe=Math.sqrt(Oe*Oe+Le*Le+Fe*Fe),$e=Math.exp(je),Ke=Xe>0?$e*Math.sin(Xe)/Xe:0;return ve[0]=Oe*Ke,ve[1]=Le*Ke,ve[2]=Fe*Ke,ve[3]=$e*Math.cos(Xe),ve}function E(ve,Ie){var Oe=Ie[0],Le=Ie[1],Fe=Ie[2],je=Ie[3],Xe=Math.sqrt(Oe*Oe+Le*Le+Fe*Fe),$e=Xe>0?Math.atan2(Xe,je)/Xe:0;return ve[0]=Oe*$e,ve[1]=Le*$e,ve[2]=Fe*$e,ve[3]=.5*Math.log(Oe*Oe+Le*Le+Fe*Fe+je*je),ve}function P(ve,Ie,Oe,Le){var Fe,je,Xe,$e,Ke,xt=Ie[0],yt=Ie[1],Ut=Ie[2],Et=Ie[3],Pt=Oe[0],St=Oe[1],rr=Oe[2],zt=Oe[3];return(je=xt*Pt+yt*St+Ut*rr+Et*zt)<0&&(je=-je,Pt=-Pt,St=-St,rr=-rr,zt=-zt),1-je>t.EPSILON?(Fe=Math.acos(je),Xe=Math.sin(Fe),$e=Math.sin((1-Le)*Fe)/Xe,Ke=Math.sin(Le*Fe)/Xe):($e=1-Le,Ke=Le),ve[0]=$e*xt+Ke*Pt,ve[1]=$e*yt+Ke*St,ve[2]=$e*Ut+Ke*rr,ve[3]=$e*Et+Ke*zt,ve}function A(ve,Ie){var Oe,Le=Ie[0]+Ie[4]+Ie[8];if(Le>0)Oe=Math.sqrt(Le+1),ve[3]=.5*Oe,ve[0]=(Ie[5]-Ie[7])*(Oe=.5/Oe),ve[1]=(Ie[6]-Ie[2])*Oe,ve[2]=(Ie[1]-Ie[3])*Oe;else{var Fe=0;Ie[4]>Ie[0]&&(Fe=1),Ie[8]>Ie[3*Fe+Fe]&&(Fe=2);var je=(Fe+1)%3,Xe=(Fe+2)%3;Oe=Math.sqrt(Ie[3*Fe+Fe]-Ie[3*je+je]-Ie[3*Xe+Xe]+1),ve[Fe]=.5*Oe,ve[3]=(Ie[3*je+Xe]-Ie[3*Xe+je])*(Oe=.5/Oe),ve[je]=(Ie[3*je+Fe]+Ie[3*Fe+je])*Oe,ve[Xe]=(Ie[3*Xe+Fe]+Ie[3*Fe+Xe])*Oe}return ve}Qe.clone=h.clone,Qe.fromValues=h.fromValues,Qe.copy=h.copy,Qe.set=h.set,Qe.add=h.add,Qe.mul=M;var I=h.scale;Qe.scale=I;var k=h.dot;Qe.dot=k,Qe.lerp=h.lerp;var j=h.length;Qe.length=j,Qe.len=j;var F=h.squaredLength;Qe.squaredLength=F,Qe.sqrLen=F;var W=h.normalize;Qe.normalize=W,Qe.exactEquals=h.exactEquals,Qe.equals=h.equals;var H,$,Y,ne=(H=c.create(),$=c.fromValues(1,0,0),Y=c.fromValues(0,1,0),function(ve,Ie,Oe){var Le=c.dot(Ie,Oe);return Le<-.999999?(c.cross(H,$,Ie),c.len(H)<1e-6&&c.cross(H,Y,Ie),c.normalize(H,H),T(ve,H,Math.PI),ve):Le>.999999?(ve[0]=0,ve[1]=0,ve[2]=0,ve[3]=1,ve):(c.cross(H,Ie,Oe),ve[0]=H[0],ve[1]=H[1],ve[2]=H[2],ve[3]=1+Le,W(ve,ve))});Qe.rotationTo=ne;var oe,ye,pe=(oe=x(),ye=x(),function(ve,Ie,Oe,Le,Fe,je){return P(oe,Ie,Fe,je),P(ye,Oe,Le,je),P(ve,oe,ye,2*je*(1-je)),ve});Qe.sqlerp=pe;var me,Me=(me=s.create(),function(ve,Ie,Oe,Le){return me[0]=Oe[0],me[3]=Oe[1],me[6]=Oe[2],me[1]=Le[0],me[4]=Le[1],me[7]=Le[2],me[2]=-Ie[0],me[5]=-Ie[1],me[8]=-Ie[2],W(ve,A(ve,me))});return Qe.setAxes=Me,Qe}var ct,Je={};function rt(){if(ct)return Je;function l(P){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},l(P)}ct=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=function(){var P=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},Je.clone=function(P){var A=new t.ARRAY_TYPE(8);return A[0]=P[0],A[1]=P[1],A[2]=P[2],A[3]=P[3],A[4]=P[4],A[5]=P[5],A[6]=P[6],A[7]=P[7],A},Je.fromValues=function(P,A,I,k,j,F,W,H){var $=new t.ARRAY_TYPE(8);return $[0]=P,$[1]=A,$[2]=I,$[3]=k,$[4]=j,$[5]=F,$[6]=W,$[7]=H,$},Je.fromRotationTranslationValues=function(P,A,I,k,j,F,W){var H=new t.ARRAY_TYPE(8);H[0]=P,H[1]=A,H[2]=I,H[3]=k;var $=.5*j,Y=.5*F,ne=.5*W;return H[4]=$*k+Y*I-ne*A,H[5]=Y*k+ne*P-$*I,H[6]=ne*k+$*A-Y*P,H[7]=-$*P-Y*A-ne*I,H},Je.fromRotationTranslation=m,Je.fromTranslation=function(P,A){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*A[0],P[5]=.5*A[1],P[6]=.5*A[2],P[7]=0,P},Je.fromRotation=function(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},Je.fromMat4=function(P,A){var I=s.create();c.getRotation(I,A);var k=new t.ARRAY_TYPE(3);return c.getTranslation(k,A),m(P,I,k),P},Je.copy=x,Je.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},Je.set=function(P,A,I,k,j,F,W,H,$){return P[0]=A,P[1]=I,P[2]=k,P[3]=j,P[4]=F,P[5]=W,P[6]=H,P[7]=$,P},Je.getDual=function(P,A){return P[0]=A[4],P[1]=A[5],P[2]=A[6],P[3]=A[7],P},Je.setDual=function(P,A){return P[4]=A[0],P[5]=A[1],P[6]=A[2],P[7]=A[3],P},Je.getTranslation=function(P,A){var I=A[4],k=A[5],j=A[6],F=A[7],W=-A[0],H=-A[1],$=-A[2],Y=A[3];return P[0]=2*(I*Y+F*W+k*$-j*H),P[1]=2*(k*Y+F*H+j*W-I*$),P[2]=2*(j*Y+F*$+I*H-k*W),P},Je.translate=function(P,A,I){var k=A[0],j=A[1],F=A[2],W=A[3],H=.5*I[0],$=.5*I[1],Y=.5*I[2],ne=A[4],oe=A[5],ye=A[6],pe=A[7];return P[0]=k,P[1]=j,P[2]=F,P[3]=W,P[4]=W*H+j*Y-F*$+ne,P[5]=W*$+F*H-k*Y+oe,P[6]=W*Y+k*$-j*H+ye,P[7]=-k*H-j*$-F*Y+pe,P},Je.rotateX=function(P,A,I){var k=-A[0],j=-A[1],F=-A[2],W=A[3],H=A[4],$=A[5],Y=A[6],ne=A[7],oe=H*W+ne*k+$*F-Y*j,ye=$*W+ne*j+Y*k-H*F,pe=Y*W+ne*F+H*j-$*k,me=ne*W-H*k-$*j-Y*F;return s.rotateX(P,A,I),P[4]=oe*(W=P[3])+me*(k=P[0])+ye*(F=P[2])-pe*(j=P[1]),P[5]=ye*W+me*j+pe*k-oe*F,P[6]=pe*W+me*F+oe*j-ye*k,P[7]=me*W-oe*k-ye*j-pe*F,P},Je.rotateY=function(P,A,I){var k=-A[0],j=-A[1],F=-A[2],W=A[3],H=A[4],$=A[5],Y=A[6],ne=A[7],oe=H*W+ne*k+$*F-Y*j,ye=$*W+ne*j+Y*k-H*F,pe=Y*W+ne*F+H*j-$*k,me=ne*W-H*k-$*j-Y*F;return s.rotateY(P,A,I),P[4]=oe*(W=P[3])+me*(k=P[0])+ye*(F=P[2])-pe*(j=P[1]),P[5]=ye*W+me*j+pe*k-oe*F,P[6]=pe*W+me*F+oe*j-ye*k,P[7]=me*W-oe*k-ye*j-pe*F,P},Je.rotateZ=function(P,A,I){var k=-A[0],j=-A[1],F=-A[2],W=A[3],H=A[4],$=A[5],Y=A[6],ne=A[7],oe=H*W+ne*k+$*F-Y*j,ye=$*W+ne*j+Y*k-H*F,pe=Y*W+ne*F+H*j-$*k,me=ne*W-H*k-$*j-Y*F;return s.rotateZ(P,A,I),P[4]=oe*(W=P[3])+me*(k=P[0])+ye*(F=P[2])-pe*(j=P[1]),P[5]=ye*W+me*j+pe*k-oe*F,P[6]=pe*W+me*F+oe*j-ye*k,P[7]=me*W-oe*k-ye*j-pe*F,P},Je.rotateByQuatAppend=function(P,A,I){var k=I[0],j=I[1],F=I[2],W=I[3],H=A[0],$=A[1],Y=A[2],ne=A[3];return P[0]=H*W+ne*k+$*F-Y*j,P[1]=$*W+ne*j+Y*k-H*F,P[2]=Y*W+ne*F+H*j-$*k,P[3]=ne*W-H*k-$*j-Y*F,P[4]=(H=A[4])*W+(ne=A[7])*k+($=A[5])*F-(Y=A[6])*j,P[5]=$*W+ne*j+Y*k-H*F,P[6]=Y*W+ne*F+H*j-$*k,P[7]=ne*W-H*k-$*j-Y*F,P},Je.rotateByQuatPrepend=function(P,A,I){var k=A[0],j=A[1],F=A[2],W=A[3],H=I[0],$=I[1],Y=I[2],ne=I[3];return P[0]=k*ne+W*H+j*Y-F*$,P[1]=j*ne+W*$+F*H-k*Y,P[2]=F*ne+W*Y+k*$-j*H,P[3]=W*ne-k*H-j*$-F*Y,P[4]=k*(ne=I[7])+W*(H=I[4])+j*(Y=I[6])-F*($=I[5]),P[5]=j*ne+W*$+F*H-k*Y,P[6]=F*ne+W*Y+k*$-j*H,P[7]=W*ne-k*H-j*$-F*Y,P},Je.rotateAroundAxis=function(P,A,I,k){if(Math.abs(k)<t.EPSILON)return x(P,A);var j=Math.hypot(I[0],I[1],I[2]);k*=.5;var F=Math.sin(k),W=F*I[0]/j,H=F*I[1]/j,$=F*I[2]/j,Y=Math.cos(k),ne=A[0],oe=A[1],ye=A[2],pe=A[3];P[0]=ne*Y+pe*W+oe*$-ye*H,P[1]=oe*Y+pe*H+ye*W-ne*$,P[2]=ye*Y+pe*$+ne*H-oe*W,P[3]=pe*Y-ne*W-oe*H-ye*$;var me=A[4],Me=A[5],ve=A[6],Ie=A[7];return P[4]=me*Y+Ie*W+Me*$-ve*H,P[5]=Me*Y+Ie*H+ve*W-me*$,P[6]=ve*Y+Ie*$+me*H-Me*W,P[7]=Ie*Y-me*W-Me*H-ve*$,P},Je.add=function(P,A,I){return P[0]=A[0]+I[0],P[1]=A[1]+I[1],P[2]=A[2]+I[2],P[3]=A[3]+I[3],P[4]=A[4]+I[4],P[5]=A[5]+I[5],P[6]=A[6]+I[6],P[7]=A[7]+I[7],P},Je.multiply=T,Je.scale=function(P,A,I){return P[0]=A[0]*I,P[1]=A[1]*I,P[2]=A[2]*I,P[3]=A[3]*I,P[4]=A[4]*I,P[5]=A[5]*I,P[6]=A[6]*I,P[7]=A[7]*I,P},Je.lerp=function(P,A,I,k){var j=1-k;return M(A,I)<0&&(k=-k),P[0]=A[0]*j+I[0]*k,P[1]=A[1]*j+I[1]*k,P[2]=A[2]*j+I[2]*k,P[3]=A[3]*j+I[3]*k,P[4]=A[4]*j+I[4]*k,P[5]=A[5]*j+I[5]*k,P[6]=A[6]*j+I[6]*k,P[7]=A[7]*j+I[7]*k,P},Je.invert=function(P,A){var I=E(A);return P[0]=-A[0]/I,P[1]=-A[1]/I,P[2]=-A[2]/I,P[3]=A[3]/I,P[4]=-A[4]/I,P[5]=-A[5]/I,P[6]=-A[6]/I,P[7]=A[7]/I,P},Je.conjugate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P[2]=-A[2],P[3]=A[3],P[4]=-A[4],P[5]=-A[5],P[6]=-A[6],P[7]=A[7],P},Je.normalize=function(P,A){var I=E(A);if(I>0){I=Math.sqrt(I);var k=A[0]/I,j=A[1]/I,F=A[2]/I,W=A[3]/I,H=A[4],$=A[5],Y=A[6],ne=A[7],oe=k*H+j*$+F*Y+W*ne;P[0]=k,P[1]=j,P[2]=F,P[3]=W,P[4]=(H-k*oe)/I,P[5]=($-j*oe)/I,P[6]=(Y-F*oe)/I,P[7]=(ne-W*oe)/I}return P},Je.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},Je.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]&&P[4]===A[4]&&P[5]===A[5]&&P[6]===A[6]&&P[7]===A[7]},Je.equals=function(P,A){var I=P[0],k=P[1],j=P[2],F=P[3],W=P[4],H=P[5],$=P[6],Y=P[7],ne=A[0],oe=A[1],ye=A[2],pe=A[3],me=A[4],Me=A[5],ve=A[6],Ie=A[7];return Math.abs(I-ne)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(ne))&&Math.abs(k-oe)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(oe))&&Math.abs(j-ye)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(ye))&&Math.abs(F-pe)<=t.EPSILON*Math.max(1,Math.abs(F),Math.abs(pe))&&Math.abs(W-me)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(me))&&Math.abs(H-Me)<=t.EPSILON*Math.max(1,Math.abs(H),Math.abs(Me))&&Math.abs($-ve)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(ve))&&Math.abs(Y-Ie)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Ie))},Je.sqrLen=Je.squaredLength=Je.len=Je.length=Je.dot=Je.mul=Je.setReal=Je.getReal=void 0;var t=d(G()),s=d(Gt()),c=d(Be());function h(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,I=new WeakMap;return(h=function(k){return k?I:A})(P)}function d(P,A){if(P&&P.__esModule)return P;if(P===null||l(P)!=="object"&&typeof P!="function")return{default:P};var I=h(A);if(I&&I.has(P))return I.get(P);var k={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in P)if(F!=="default"&&Object.prototype.hasOwnProperty.call(P,F)){var W=j?Object.getOwnPropertyDescriptor(P,F):null;W&&(W.get||W.set)?Object.defineProperty(k,F,W):k[F]=P[F]}return k.default=P,I&&I.set(P,k),k}function m(P,A,I){var k=.5*I[0],j=.5*I[1],F=.5*I[2],W=A[0],H=A[1],$=A[2],Y=A[3];return P[0]=W,P[1]=H,P[2]=$,P[3]=Y,P[4]=k*Y+j*$-F*H,P[5]=j*Y+F*W-k*$,P[6]=F*Y+k*H-j*W,P[7]=-k*W-j*H-F*$,P}function x(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=A[4],P[5]=A[5],P[6]=A[6],P[7]=A[7],P}function T(P,A,I){var k=A[0],j=A[1],F=A[2],W=A[3],H=I[4],$=I[5],Y=I[6],ne=I[7],oe=A[4],ye=A[5],pe=A[6],me=A[7],Me=I[0],ve=I[1],Ie=I[2],Oe=I[3];return P[0]=k*Oe+W*Me+j*Ie-F*ve,P[1]=j*Oe+W*ve+F*Me-k*Ie,P[2]=F*Oe+W*Ie+k*ve-j*Me,P[3]=W*Oe-k*Me-j*ve-F*Ie,P[4]=k*ne+W*H+j*Y-F*$+oe*Oe+me*Me+ye*Ie-pe*ve,P[5]=j*ne+W*$+F*H-k*Y+ye*Oe+me*ve+pe*Me-oe*Ie,P[6]=F*ne+W*Y+k*$-j*H+pe*Oe+me*Ie+oe*ve-ye*Me,P[7]=W*ne-k*H-j*$-F*Y+me*Oe-oe*Me-ye*ve-pe*Ie,P}Je.getReal=s.copy,Je.setReal=s.copy,Je.mul=T;var M=s.dot;Je.dot=M;var y=s.length;Je.length=y,Je.len=y;var E=s.squaredLength;return Je.squaredLength=E,Je.sqrLen=E,Je}var bt,kt,At={};function _r(){if(bt)return At;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(A)}bt=1,Object.defineProperty(At,"__esModule",{value:!0}),At.create=c,At.clone=function(A){var I=new t.ARRAY_TYPE(2);return I[0]=A[0],I[1]=A[1],I},At.fromValues=function(A,I){var k=new t.ARRAY_TYPE(2);return k[0]=A,k[1]=I,k},At.copy=function(A,I){return A[0]=I[0],A[1]=I[1],A},At.set=function(A,I,k){return A[0]=I,A[1]=k,A},At.add=function(A,I,k){return A[0]=I[0]+k[0],A[1]=I[1]+k[1],A},At.subtract=h,At.multiply=d,At.divide=m,At.ceil=function(A,I){return A[0]=Math.ceil(I[0]),A[1]=Math.ceil(I[1]),A},At.floor=function(A,I){return A[0]=Math.floor(I[0]),A[1]=Math.floor(I[1]),A},At.min=function(A,I,k){return A[0]=Math.min(I[0],k[0]),A[1]=Math.min(I[1],k[1]),A},At.max=function(A,I,k){return A[0]=Math.max(I[0],k[0]),A[1]=Math.max(I[1],k[1]),A},At.round=function(A,I){return A[0]=Math.round(I[0]),A[1]=Math.round(I[1]),A},At.scale=function(A,I,k){return A[0]=I[0]*k,A[1]=I[1]*k,A},At.scaleAndAdd=function(A,I,k,j){return A[0]=I[0]+k[0]*j,A[1]=I[1]+k[1]*j,A},At.distance=x,At.squaredDistance=T,At.length=M,At.squaredLength=y,At.negate=function(A,I){return A[0]=-I[0],A[1]=-I[1],A},At.inverse=function(A,I){return A[0]=1/I[0],A[1]=1/I[1],A},At.normalize=function(A,I){var k=I[0],j=I[1],F=k*k+j*j;return F>0&&(F=1/Math.sqrt(F)),A[0]=I[0]*F,A[1]=I[1]*F,A},At.dot=function(A,I){return A[0]*I[0]+A[1]*I[1]},At.cross=function(A,I,k){var j=I[0]*k[1]-I[1]*k[0];return A[0]=A[1]=0,A[2]=j,A},At.lerp=function(A,I,k,j){var F=I[0],W=I[1];return A[0]=F+j*(k[0]-F),A[1]=W+j*(k[1]-W),A},At.random=function(A,I){I=I||1;var k=2*t.RANDOM()*Math.PI;return A[0]=Math.cos(k)*I,A[1]=Math.sin(k)*I,A},At.transformMat2=function(A,I,k){var j=I[0],F=I[1];return A[0]=k[0]*j+k[2]*F,A[1]=k[1]*j+k[3]*F,A},At.transformMat2d=function(A,I,k){var j=I[0],F=I[1];return A[0]=k[0]*j+k[2]*F+k[4],A[1]=k[1]*j+k[3]*F+k[5],A},At.transformMat3=function(A,I,k){var j=I[0],F=I[1];return A[0]=k[0]*j+k[3]*F+k[6],A[1]=k[1]*j+k[4]*F+k[7],A},At.transformMat4=function(A,I,k){var j=I[0],F=I[1];return A[0]=k[0]*j+k[4]*F+k[12],A[1]=k[1]*j+k[5]*F+k[13],A},At.rotate=function(A,I,k,j){var F=I[0]-k[0],W=I[1]-k[1],H=Math.sin(j),$=Math.cos(j);return A[0]=F*$-W*H+k[0],A[1]=F*H+W*$+k[1],A},At.angle=function(A,I){var k=A[0],j=A[1],F=I[0],W=I[1],H=Math.sqrt(k*k+j*j)*Math.sqrt(F*F+W*W);return Math.acos(Math.min(Math.max(H&&(k*F+j*W)/H,-1),1))},At.zero=function(A){return A[0]=0,A[1]=0,A},At.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},At.exactEquals=function(A,I){return A[0]===I[0]&&A[1]===I[1]},At.equals=function(A,I){var k=A[0],j=A[1],F=I[0],W=I[1];return Math.abs(k-F)<=t.EPSILON*Math.max(1,Math.abs(k),Math.abs(F))&&Math.abs(j-W)<=t.EPSILON*Math.max(1,Math.abs(j),Math.abs(W))},At.forEach=At.sqrLen=At.sqrDist=At.dist=At.div=At.mul=At.sub=At.len=void 0;var t=function(A,I){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var k=s(void 0);if(k&&k.has(A))return k.get(A);var j={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in A)if(W!=="default"&&Object.prototype.hasOwnProperty.call(A,W)){var H=F?Object.getOwnPropertyDescriptor(A,W):null;H&&(H.get||H.set)?Object.defineProperty(j,W,H):j[W]=A[W]}return j.default=A,k&&k.set(A,j),j}(G());function s(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(s=function(j){return j?k:I})(A)}function c(){var A=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function h(A,I,k){return A[0]=I[0]-k[0],A[1]=I[1]-k[1],A}function d(A,I,k){return A[0]=I[0]*k[0],A[1]=I[1]*k[1],A}function m(A,I,k){return A[0]=I[0]/k[0],A[1]=I[1]/k[1],A}function x(A,I){return Math.hypot(I[0]-A[0],I[1]-A[1])}function T(A,I){var k=I[0]-A[0],j=I[1]-A[1];return k*k+j*j}function M(A){return Math.hypot(A[0],A[1])}function y(A){var I=A[0],k=A[1];return I*I+k*k}At.len=M,At.sub=h,At.mul=d,At.div=m,At.dist=x,At.sqrDist=T,At.sqrLen=y;var E,P=(E=c(),function(A,I,k,j,F,W){var H,$;for(I||(I=2),k||(k=0),$=j?Math.min(j*I+k,A.length):A.length,H=k;H<$;H+=I)E[0]=A[H],E[1]=A[H+1],F(E,E,W),A[H]=E[0],A[H+1]=E[1];return A});return At.forEach=P,At}function cn(){if(kt)return U;function l(A){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},l(A)}kt=1,Object.defineProperty(U,"__esModule",{value:!0}),U.vec4=U.vec3=U.vec2=U.quat2=U.quat=U.mat4=U.mat3=U.mat2d=U.mat2=U.glMatrix=void 0;var t=P(G());U.glMatrix=t;var s=P(K());U.mat2=s;var c=P(ee());U.mat2d=c;var h=P(ge());U.mat3=h;var d=P(Be());U.mat4=d;var m=P(Gt());U.quat=m;var x=P(rt());U.quat2=x;var T=P(_r());U.vec2=T;var M=P(He());U.vec3=M;var y=P(Tt());function E(A){if(typeof WeakMap!="function")return null;var I=new WeakMap,k=new WeakMap;return(E=function(j){return j?k:I})(A)}function P(A,I){if(A&&A.__esModule)return A;if(A===null||l(A)!=="object"&&typeof A!="function")return{default:A};var k=E(I);if(k&&k.has(A))return k.get(A);var j={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in A)if(W!=="default"&&Object.prototype.hasOwnProperty.call(A,W)){var H=F?Object.getOwnPropertyDescriptor(A,W):null;H&&(H.get||H.set)?Object.defineProperty(j,W,H):j[W]=A[W]}return j.default=A,k&&k.set(A,j),j}return U.vec4=y,U}var pr,Dt,ir,zr,he=cn(),br=function(){if(Dt)return pr;function l(t,s,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=c,this.p2y=h}return Dt=1,pr=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var d=this.sampleCurveX(c)-t;if(Math.abs(d)<s)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=d/m}var x=0,T=1;for(c=t,h=0;h<20&&(d=this.sampleCurveX(c),!(Math.abs(d-t)<s));h++)t>d?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},pr}(),Ht=L(br);function jr(){if(zr)return ir;function l(t,s){this.x=t,this.y=s}return zr=1,ir=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,s){return this.clone()._rotateAround(t,s)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var s=t.x-this.x,c=t.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult:function(t){var s=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var s=Math.cos(t),c=Math.sin(t),h=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=h,this},_rotateAround:function(t,s){var c=Math.cos(t),h=Math.sin(t),d=s.y+h*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-h*(this.y-s.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(t){return t instanceof l?t:Array.isArray(t)?new l(t[0],t[1]):t},ir}var wt=L(jr());function dn(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!dn(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const s in l)if(!dn(l[s],t[s]))return!1;return!0}return l===t}const rn=Math.PI/180,Vn=180/Math.PI;function wr(l){return l*rn}function Hr(l){return l*Vn}const Yn=[[0,0],[1,0],[1,1],[0,1]];function ys(l){if(l<=0)return 0;if(l>=1)return 1;const t=l*l,s=t*l;return 4*(l<.5?s:3*(l-t)+s-.75)}function vs(l,t,s,c){const h=new Ht(l,t,s,c);return function(d){return h.solve(d)}}const xs=vs(.25,.1,.25,1);function Tr(l,t,s){return Math.min(s,Math.max(t,l))}function mi(l,t,s){return(s=Tr((s-l)/(t-l),0,1))*s*(3-2*s)}function Is(l,t,s){const c=s-t,h=((l-t)%c+c)%c+t;return h===t?s:h}function Yi(l,t,s){if(!l.length)return s(null,[]);let c=l.length;const h=new Array(l.length);let d=null;l.forEach((m,x)=>{t(m,(T,M)=>{T&&(d=T),h[x]=M,--c==0&&s(d,h)})})}function gi(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}let Mi=1;function ui(){return Mi++}function Ao(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function ao(l,t){l.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function bs(l,t,s){const c={};for(const h in l)c[h]=t.call(this,l[h],h,l);return c}function $s(l,t,s){const c={};for(const h in l)t.call(this,l[h],h,l)&&(c[h]=l[h]);return c}function Oi(l){return Array.isArray(l)?l.map(Oi):typeof l=="object"&&l?bs(l,Oi):l}const Ji={};function Cn(l){Ji[l]||(typeof console<"u"&&console.warn(l),Ji[l]=!0)}function sr(l,t,s){return(s.y-l.y)*(t.x-l.x)>(t.y-l.y)*(s.x-l.x)}function An(l){let t=0;for(let s,c,h=0,d=l.length,m=d-1;h<d;m=h++)s=l[h],c=l[m],t+=(c.x-s.x)*(s.y+c.y);return t}function vn([l,t,s]){const c=wr(t+90),h=wr(s);return{x:l*Math.cos(c)*Math.sin(h),y:l*Math.sin(c)*Math.sin(h),z:l*Math.cos(h),azimuthal:t,polar:s}}function jn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function _i(l){const t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,h,d)=>{const m=h||d;return t[c]=!m||m.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let lo=null;function Mo(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function vc(l,t,s,c){for(;t<s;){const h=t+s>>1;l[h]<c?t=h+1:s=h}return t}function $h(l,t,s,c){for(;t<s;){const h=t+s>>1;l[h]<=c?t=h+1:s=h}return t}function dd(l){return l>0?1/(1.001-l):1+l}function at(l){return l>0?1-1/(1.001-l):-l}const le={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!le.API_URL)return null;try{const l=new URL(le.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function de(l){return le.API_URL_REGEX.test(l)}function we(l){return le.API_SPRITE_REGEX.test(l)}let De,Pe,ze,tt,Ue,st;function ut(){return De==null&&(De=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),De}const ot={now:()=>tt!==void 0?tt:performance.now(),setNow(l){tt=l},restoreNow(){tt=void 0},frame(l){const t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){const{width:s,height:c}=l;Ue||(Ue=document.createElement("canvas"));const h=Ue.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(s>Ue.width||c>Ue.height)&&(Ue.width=s,Ue.height=c),h.clearRect(-t,-t,s+2*t,c+2*t),h.drawImage(l,0,0,s,c),h.getImageData(-t,-t,s+2*t,c+2*t)},resolveURL:l=>(Pe||(Pe=document.createElement("a")),Pe.href=l,Pe.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ze==null&&(ze=window.matchMedia("(prefers-reduced-motion: reduce)")),ze.matches)},hasCanvasFingerprintNoise(){if(st!==void 0)return st;if(!ut())return st=!1,!1;const l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0});let s=0;for(let h=0;h<l.width;++h)t.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,t.fillRect(h,0,1,1);const c=t.getImageData(0,0,l.width,l.height);s=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&s++!==c.data[h])return st=!0,!0;return st=!1,!1}};function Mt(l,t){const s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(l.slice(s));for(const h in t)c.set(h,t[h]);return`${l.slice(0,s)}?${c.toString()}`}function jt(l,t={persistentParams:[]}){const s=l.indexOf("?");if(s<0)return l;const c=new URLSearchParams,h=new URLSearchParams(l.slice(s));for(const m of t.persistentParams){const x=h.get(m);x&&c.set(m,x)}const d=c.toString();return`${l.slice(0,s)}${d.length>0?`?${d}`:""}`}const Vt="mapbox-tiles";let yr=500,Er=50;const Cr=["language","worldview","jobid"];let Ir,bn;function zn(){try{return caches}catch{}}function Lr(){const l=zn();l&&Ir==null&&(Ir=l.open(Vt))}let sn=1/0;const on={supported:!1,testSupport:function(l){!Ii&&Zn&&(Qi?ds(l):un=l)}};let un,Zn,Ii=!1,Qi=!1;const co=typeof self<"u"?self:{};function ds(l){const t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Zn),l.isContextLost())return;on.supported=!0}catch{}l.deleteTexture(t),Ii=!0}co.document&&(Zn=co.document.createElement("img"),Zn.onload=function(){un&&ds(un),un=null,Qi=!0},Zn.onerror=function(){Ii=!0,un=null},Zn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Pi);class zi extends Error{constructor(t,s,c){s===401&&de(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xc=jn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,uo=function(l,t){if(!(/^file:/.test(s=l.url)||/^file:/.test(xc())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){const d=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:xc(),referrerPolicy:c.referrerPolicy,signal:d.signal});let x=!1,T=!1;const M=(y=m.url).indexOf("sku=")>0&&de(y);var y;c.type==="json"&&m.headers.set("Accept","application/json");const E=(A,I,k)=>{if(T)return;if(A&&A.message!=="SecurityError"&&Cn(A.toString()),I&&k)return P(I);const j=Date.now();fetch(m).then(F=>{if(F.ok){const W=M?F.clone():null;return P(F,W,j)}return h(new zi(F.statusText,F.status,c.url))}).catch(F=>{F.name!=="AbortError"&&h(new Error(`${F.message} ${c.url}`))})},P=(A,I,k)=>{(c.type==="arrayBuffer"?A.arrayBuffer():c.type==="json"?A.json():A.text()).then(j=>{T||(I&&k&&function(F,W,H){if(Lr(),Ir==null)return;const $=_i(W.headers.get("Cache-Control")||"");if($["no-store"])return;const Y={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((ye,pe)=>Y.headers.set(pe,ye)),$["max-age"]&&Y.headers.set("Expires",new Date(H+1e3*$["max-age"]).toUTCString());const ne=Y.headers.get("Expires");if(!ne||new Date(ne).getTime()-H<42e4)return;let oe=jt(F.url,{persistentParams:Cr});if(W.status===206){const ye=F.headers.get("Range");if(!ye)return;Y.status=200,oe=Mt(oe,{range:ye})}(function(ye,pe){if(bn===void 0)try{new Response(new ReadableStream),bn=!0}catch{bn=!1}bn?pe(ye.body):ye.blob().then(pe)})(W,ye=>{const pe=new Response((me=W.status)!==200&&me!==404&&[101,103,204,205,304].includes(me)?null:ye,Y);var me;Lr(),Ir!=null&&Ir.then(Me=>Me.put(oe,pe)).catch(Me=>Cn(Me.message))})}(m,I,k),x=!0,h(null,j,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(j=>{T||h(new Error(j.message))})};return M?function(A,I){if(Lr(),Ir==null)return I(null);Ir.then(k=>{let j=jt(A.url,{persistentParams:Cr});const F=A.headers.get("Range");F&&(j=Mt(j,{range:F})),k.match(j).then(W=>{const H=function($){if(!$)return!1;const Y=new Date($.headers.get("Expires")||0),ne=_i($.headers.get("Cache-Control")||"");return Y>Date.now()&&!ne["no-cache"]}(W);k.delete(j),H&&k.put(j,W.clone()),I(null,W,H)}).catch(I)}).catch(I)}(m,E):E(null,null),{cancel:()=>{T=!0,x||d.abort()}}}(l,t);if(jn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var s;return function(c,h){const d=new XMLHttpRequest;d.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in c.headers)d.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=c.credentials==="include",d.onerror=()=>{h(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(c.type==="json")try{m=JSON.parse(d.response)}catch(x){return h(x)}h(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else h(new zi(d.statusText,d.status,c.url))},d.send(c.body),{cancel:()=>d.abort()}}(l,t)},ga=function(l,t){return uo(gi(l,{type:"arrayBuffer"}),t)};function _m(l){const t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}const Gh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hd,bc;hd=[],bc=0;const ym=function(l,t){if(on.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),bc>=le.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return hd.push(d),d}bc++;let s=!1;const c=()=>{if(!s)for(s=!0,bc--;hd.length&&bc<le.MAX_PARALLEL_IMAGE_REQUESTS;){const d=hd.shift(),{requestParameters:m,callback:x,cancelled:T}=d;T||(d.cancel=ym(m,x).cancel)}},h=ga(l,(d,m,x,T)=>{c(),d?t(d):m&&(self.createImageBitmap?function(M,y){const E=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(E).then(P=>{y(null,P)}).catch(P=>{y(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(M,y)=>t(M,y,x,T)):function(M,y){const E=new Image;E.onload=()=>{y(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Gh})},E.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(M)],{type:"image/png"});E.src=M.byteLength?URL.createObjectURL(P):Gh}(m,(M,y)=>t(M,y,x,T)))});return{cancel:()=>{h.cancel(),c()}}};var Wy,Zy,vm,wc={exports:{}},Gs={exports:{}},Io={exports:{}},sl=function(){if(vm)return wc.exports;vm=1;var l=(Wy||(Wy=1,Gs.exports=function(s,c){var h,d,m,x,T,M,y,E;for(d=s.length-(h=3&s.length),m=c,T=3432918353,M=461845907,E=0;E<d;)y=255&s.charCodeAt(E)|(255&s.charCodeAt(++E))<<8|(255&s.charCodeAt(++E))<<16|(255&s.charCodeAt(++E))<<24,++E,m=27492+(65535&(x=5*(65535&(m=(m^=y=(65535&(y=(y=(65535&y)*T+(((y>>>16)*T&65535)<<16)&4294967295)<<15|y>>>17))*M+(((y>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(y=0,h){case 3:y^=(255&s.charCodeAt(E+2))<<16;case 2:y^=(255&s.charCodeAt(E+1))<<8;case 1:m^=y=(65535&(y=(y=(65535&(y^=255&s.charCodeAt(E)))*T+(((y>>>16)*T&65535)<<16)&4294967295)<<15|y>>>17))*M+(((y>>>16)*M&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Gs.exports),t=(Zy||(Zy=1,Io.exports=function(s,c){for(var h,d=s.length,m=c^d,x=0;d>=4;)h=1540483477*(65535&(h=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),d-=4,++x;switch(d){case 3:m^=(255&s.charCodeAt(x+2))<<16;case 2:m^=(255&s.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Io.exports);return wc.exports=l,wc.exports.murmur3=l,wc.exports.murmur2=t,wc.exports}(),qs=L(sl);class Ps{constructor(t,...s){gi(this,s[0]||{}),this.type=t}}class Sc extends Ps{constructor(t,s={}){super("error",gi({error:t},s))}}function xm(l,t,s){s[l]&&s[l].indexOf(t)!==-1||(s[l]=s[l]||[],s[l].push(t))}function qh(l,t,s){if(s&&s[l]){const c=s[l].indexOf(t);c!==-1&&s[l].splice(c,1)}}class Po{on(t,s){return this._listeners=this._listeners||{},xm(t,s,this._listeners),this}off(t,s){return qh(t,s,this._listeners),qh(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},xm(t,s,this._oneTimeListeners),this):new Promise(c=>{this.once(t,c)})}fire(t,s){const c=typeof t=="string"?new Ps(t,s):t,h=c.type;if(this.listens(h)){c.target=this;const d=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of d)T.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of m)qh(h,T,this._oneTimeListeners),T.call(this,c);const x=this._eventedParent;x&&(gi(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof Sc&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}class ws{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new ws(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[s,c]=t.split("");return new ws({name:s,iconsetId:c})}static isEqual(t,s){return t.name===s.name&&t.iconsetId===s.iconsetId}toString(){return ws.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Xy,bm={},ho=function(){if(Xy)return bm;Xy=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(d){return(d=Math.round(d))<0?0:d>255?255:d}function s(d){return t(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function c(d){return(m=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:m>1?1:m;var m}function h(d,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?d+(m-d)*x*6:2*x<1?m:3*x<2?d+(m-d)*(2/3-x)*6:d}try{bm.parseCSSColor=function(d){var m,x=d.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var T=x.indexOf("("),M=x.indexOf(")");if(T!==-1&&M+1===x.length){var y=x.substr(0,T),E=x.substr(T+1,M-(T+1)).split(","),P=1;switch(y){case"rgba":if(E.length!==4)return null;P=c(E.pop());case"rgb":return E.length!==3?null:[s(E[0]),s(E[1]),s(E[2]),P];case"hsla":if(E.length!==4)return null;P=c(E.pop());case"hsl":if(E.length!==3)return null;var A=(parseFloat(E[0])%360+360)%360/360,I=c(E[1]),k=c(E[2]),j=k<=.5?k*(I+1):k+I-k*I,F=2*k-j;return[t(255*h(F,j,A+1/3)),t(255*h(F,j,A)),t(255*h(F,j,A-1/3)),P];default:return null}}return null}}catch{}return bm}();class an{constructor(t,s,c,h=1){this.r=t,this.g=s,this.b=c,this.a=h}static parse(t){if(!t)return;if(t instanceof an)return t;if(typeof t!="string")return;const s=ho.parseCSSColor(t);return s?new an(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toStringPremultipliedAlpha(){const[t,s,c,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(c)},${h})`}toString(){const[t,s,c,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*s)},${Math.round(255*c)},${h})`}toRenderColor(t){const{r:s,g:c,b:h,a:d}=this;return new wm(t,s,c,h,d)}clone(){return new an(this.r,this.g,this.b,this.a)}}class wm{constructor(t,s,c,h,d){if(t){const m=t.image.height,x=m*m;s=d===0?0:s/d*(m-1),c=d===0?0:c/d*(m-1),h=d===0?0:h/d*(m-1);const T=Math.floor(s),M=Math.floor(c),y=Math.floor(h),E=Math.ceil(s),P=Math.ceil(c),A=Math.ceil(h),I=s-T,k=c-M,j=h-y,F=t.image.data,W=4*(T+M*x+y*m),H=4*(T+M*x+A*m),$=4*(T+P*x+y*m),Y=4*(T+P*x+A*m),ne=4*(E+M*x+y*m),oe=4*(E+M*x+A*m),ye=4*(E+P*x+y*m),pe=4*(E+P*x+A*m);if(W<0||pe>=F.length)throw new Error("out of range");this.r=or(or(or(F[W],F[H],j),or(F[$],F[Y],j),k),or(or(F[ne],F[oe],j),or(F[ye],F[pe],j),k),I)/255*d,this.g=or(or(or(F[W+1],F[H+1],j),or(F[$+1],F[Y+1],j),k),or(or(F[ne+1],F[oe+1],j),or(F[ye+1],F[pe+1],j),k),I)/255*d,this.b=or(or(or(F[W+2],F[H+2],j),or(F[$+2],F[Y+2],j),k),or(or(F[ne+2],F[oe+2],j),or(F[ye+2],F[pe+2],j),k),I)/255*d,this.a=d}else this.r=s,this.g=c,this.b=h,this.a=d}toArray(){const{r:t,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*s/h,255*c/h,h]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:t,g:s,b:c,a:h}=this,d=Math.min(Math.max(t/h,0),1),m=Math.min(Math.max(s/h,0),1),x=Math.min(Math.max(c/h,0),1),T=Math.min(d,m,x),M=Math.max(d,m,x),y=(T+M)/2;if(T===M)return[0,0,100*y,h];const E=M-T,P=y>.5?E/(2-M-T):E/(M+T);let A=0;return M===d?A=(m-x)/E+(m<x?6:0):M===m?A=(x-d)/E+2:M===x&&(A=(d-m)/E+4),A*=60,[Math.min(Math.max(A,0),360),Math.min(Math.max(100*P,0),100),Math.min(Math.max(100*y,0),100),h]}toArray01(){const{r:t,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[t/h,s/h,c/h,h]}toArray01Scaled(t){const{r:s,g:c,b:h,a:d}=this;return d===0?[0,0,0]:[s/d*t,c/d*t,h/d*t]}toArray01PremultipliedAlpha(){const{r:t,g:s,b:c,a:h}=this;return[t,s,c,h]}toArray01Linear(){const{r:t,g:s,b:c,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(t/h,2.2),Math.pow(s/h,2.2),Math.pow(c/h,2.2),h]}}function or(l,t,s){return l*(1-s)+t*s}function Ky(l,t,s){return l.map((c,h)=>or(c,t[h],s))}function Yy(l){return l*l*l*l*l}an.black=new an(0,0,0,1),an.white=new an(1,1,1,1),an.transparent=new an(0,0,0,0),an.red=new an(1,0,0,1),an.blue=new an(0,0,1,1);var fd=Object.freeze({__proto__:null,array:Ky,color:function(l,t,s){return new an(or(l.r,t.r,s),or(l.g,t.g,s),or(l.b,t.b,s),or(l.a,t.a,s))},easeIn:Yy,number:or});function Kr(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}class fo extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Hh{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,h]of s)this.bindings[c]=h}concat(t){return new Hh(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Tc={kind:"null"},Kt={kind:"number"},nn={kind:"string"},Wr={kind:"boolean"},es={kind:"color"},Ec={kind:"object"},Yr={kind:"value"},_a={kind:"collator"},pd={kind:"formatted"},ya={kind:"resolvedImage"};function $i(l,t){return{kind:"array",itemType:l,N:t}}function Xn(l){if(l.kind==="array"){const t=Xn(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}const Ro=[Tc,Kt,nn,Wr,es,pd,Ec,$i(Yr),ya];function Cc(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Cc(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(const s of Ro)if(!Cc(s,t))return null}}return`Expected ${Xn(l)} but found ${Xn(t)} instead.`}function Sm(l,t){return t.some(s=>s.kind===l.kind)}function Ac(l,t){return t.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}class Wh{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class md{constructor(t,s,c,h,d){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=c,this.fontStack=h,this.textColor=d}}class ts{constructor(t){this.sections=t}static fromString(t){return new ts([new md(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof ts?t:ts.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){const h=s.image.getPrimary().id.toString();t.push(["image",h]);continue}t.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class Qo{constructor(t,s={}){if(this.id=ws.from(t),this.options=Object.assign({},s),s.transform){const{a:c,b:h,c:d,d:m,e:x,f:T}=s.transform;this.options.transform=new DOMMatrix([c,h,d,m,x,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:t,b:s,c,d:h,e:d,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:t,b:s,c,d:h,e:d,f:m}})}static parse(t){let s,c,h,d;try{({name:s,iconsetId:c,params:h,transform:d}=JSON.parse(t)||{})}catch{return null}if(!s)return null;const{a:m,b:x,c:T,d:M,e:y,f:E}=d||{};return new Qo({name:s,iconsetId:c},{params:h,transform:new DOMMatrix([m,x,T,M,y,E])})}scaleSelf(t){return this.options.transform.scaleSelf(t),this}}class rs{constructor(t,s,c,h,d=!1){this.primaryId=ws.from(t),this.primaryOptions=s,c&&(this.secondaryId=ws.from(c)),this.secondaryOptions=h,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Qo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Qo(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?rs.build({name:t}):t}static build(t,s,c,h){return!t||typeof t=="object"&&!("name"in t)?null:new rs(t,c,s,h)}}function gd(l,t,s,c){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,t,s,c]:[l,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ko(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof an||l instanceof Wh||l instanceof ts||l instanceof rs)return!0;if(Array.isArray(l)){for(const t of l)if(!ko(t))return!1;return!0}if(typeof l=="object"){for(const t in l)if(!ko(l[t]))return!1;return!0}return!1}function ii(l){if(l===null)return Tc;if(typeof l=="string")return nn;if(typeof l=="boolean")return Wr;if(typeof l=="number")return Kt;if(l instanceof an)return es;if(l instanceof Wh)return _a;if(l instanceof ts)return pd;if(l instanceof rs)return ya;if(Array.isArray(l)){const t=l.length;let s;for(const c of l){const h=ii(c);if(s){if(s===h)continue;s=Yr;break}s=h}return $i(s||Yr,t)}return Ec}function Ri(l){const t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof an?l.toStringPremultipliedAlpha():l instanceof ts||l instanceof rs?l.toString():JSON.stringify(l)}class va{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ko(t[1]))return s.error("invalid value");const c=t[1];let h=ii(c);const d=s.expectedType;return h.kind!=="array"||h.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(h=d),new va(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof an?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ts?this.value.serialize():this.value}}class Jn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Tm={string:nn,number:Kt,boolean:Wr,object:Ec};class Hs{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,h=1;const d=t[0];if(d==="array"){let x,T;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in Tm)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Tm[M],h++}else x=Yr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=t[2],h++}c=$i(x,T)}else c=Tm[d];const m=[];for(;h<t.length;h++){const x=s.parse(t[h],h,Yr);if(!x)return null;m.push(x)}return new Hs(c,m)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!Cc(this.type,ii(c)))return c;if(s===this.args.length-1)throw new Jn(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Xn(ii(c))} but was expected to be of type ${Xn(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(c=>c.serialize()))}}class Mc{constructor(t){this.type=pd,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const h=[];let d=!1;for(let m=1;m<=t.length-1;++m){const x=t[m];if(d&&typeof x=="object"&&!Array.isArray(x)){d=!1;let T=null;if(x["font-scale"]&&(T=s.parseObjectValue(x["font-scale"],m,"font-scale",Kt),!T))return null;let M=null;if(x["text-font"]&&(M=s.parseObjectValue(x["text-font"],m,"text-font",$i(nn)),!M))return null;let y=null;if(x["text-color"]&&(y=s.parseObjectValue(x["text-color"],m,"text-color",es),!y))return null;const E=h[h.length-1];E.scale=T,E.font=M,E.textColor=y}else{const T=s.parse(t[m],m,Yr);if(!T)return null;const M=T.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new Mc(h)}evaluate(t){return new ts(this.sections.map(s=>{const c=s.content.evaluate(t);return ii(c)===ya?new md("",c,null,null,null):new md(Ri(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),t.push(c)}return t}}class ol{constructor(t,s,c,h){this._imageWarnHistory={},this.type=ya,this.namePrimary=t,this.nameSecondary=s,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(t,s){if(t.length<2)return s.error("Expected two or more arguments.");let c=1;const h=[];function d(){if(c<t.length){const x=s.parse(t[c],c++,nn);return x?(h.push({image:x,options:{}}),!0):(s.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(c<t.length){const T=t[c];if((x=T)===null||typeof x!="object"||Array.isArray(x))return!0;const M=T.params,y=T.iconset,E=s.concat(c);if(!M&&!y)return c++,!0;if(M){if(typeof M!="object"||M.constructor!==Object)return E.error('Image options "params" should be an object'),!1;const P={},A=E.concat(void 0,"params");for(const I in M){if(!I)return A.error("Image parameter name should be non-empty"),!1;const k=A.concat(void 0,I).parse(M[I],void 0,es,void 0,{typeAnnotation:"coerce"});if(!k)return!1;P[I]=k}h[h.length-1].options.params=P}if(y){if(typeof y!="object"||y.constructor!==Object)return E.error('Image options "iconset" should be an object'),!1;if(!y.id)return E.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=y}return c++,!0}var x;return!0}for(let x=0;x<2;x++)if(!d()||!m())return;return new ol(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(t,s){const c={};if(s){for(const h in s)if(s[h])try{c[h]=s[h].evaluate(t)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const s={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,h=rs.build(s,c,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(h&&t.availableImages){const d=h.getPrimary().id;if(h.available=t.availableImages.some(m=>ws.isEqual(m,d)),h.available){const m=h.getSecondary()?h.getSecondary().id:null;m&&(h.available=t.availableImages.some(x=>ws.isEqual(x,m)))}}return h}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&t(this.paramsPrimary[s]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&t(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(t,s){const c={};if(s&&(c.iconset={id:s}),t){c.params={};for(const h in t)t[h]&&(c.params[h]=t[h].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&t.push(s)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&t.push(s)}return t}}function xa(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const Tb={"to-boolean":Wr,"to-color":es,"to-number":Kt,"to-string":nn};class ba{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0],h=[];let d=Tc;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const m=t[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);d=$i(s.expectedType.itemType,m)}else{if(!(m>0&&ko(t[1][0])))return null;d=$i(ii(t[1][0]),m)}for(let x=0;x<m;x++){const T=t[1][x];let M;if(xa(T)==="array")M=s.parse(T,void 0,d.itemType);else{const y=xa(T);if(y!==d.itemType.kind)return s.error(`Expected ${d.itemType.kind} but found ${y}.`);M=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!M)return null;h.push(M)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");d=Tb[c];for(let m=1;m<t.length;m++){const x=s.parse(t[m],m,Yr);if(!x)return null;h.push(x)}}return new ba(d,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,c;for(const h of this.args){if(s=h.evaluate(t),c=null,s instanceof an)return s;if(typeof s=="string"){const d=t.parseColor(s);if(d)return d}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:gd(s[0],s[1],s[2],s[3]),!c))return new an(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Jn(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const h=Number(s);if(!isNaN(h))return h}throw new Jn(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?ts.fromString(Ri(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?rs.build(Ri(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(s=>s.evaluate(t)):Ri(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Mc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ol(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const Eb=["Unknown","Point","LineString","Polygon"];class Zh{constructor(t,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Eb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-t[0])+this.featureDistanceData.bearing[1]*(h*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=an.parse(t)),s}getConfig(t){return this.options?this.options.get(t):null}}class hs{constructor(t,s,c,h,d){this.name=t,this.type=s,this._evaluate=c,this.args=h,this._overloadIndex=d}evaluate(t){if(!this._evaluate){const s=hs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const c=t[0],h=hs.definitions[c];if(!h)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let T=null,M=-1;for(const[y,E]of m){if(Array.isArray(y)&&y.length!==t.length-1)continue;x.push(y),M++,T=new Rm(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const P=[];let A=!1;for(let I=1;I<t.length;I++){const k=t[I],j=Array.isArray(y)?y[I-1]:y.type,F=T.parse(k,1+P.length,j);if(!F){A=!0;break}P.push(F)}if(!A)if(Array.isArray(y)&&y.length!==P.length)T.error(`Expected ${y.length} arguments, but found ${P.length} instead.`);else{for(let I=0;I<P.length;I++){const k=Array.isArray(y)?y[I]:y.type,j=P[I];T.concat(I+1).checkSubtype(k,j.type)}if(T.errors.length===0)return new hs(c,d,E,P,M)}}if(x.length===1)s.errors.push(...T.errors);else{const y=(x.length?x:m.map(([P])=>P)).map(Cb).join(" | "),E=[];for(let P=1;P<t.length;P++){const A=s.parse(t[P],1+E.length);if(!A)return null;E.push(Xn(A.type))}s.error(`Expected arguments of type ${y}, but found (${E.join(", ")}) instead.`)}return null}static register(t,s){hs.definitions=s;for(const c in s)t[c]=hs}}function Cb(l){return Array.isArray(l)?`(${l.map(Xn).join(", ")})`:`(${Xn(l.type)}...)`}class Fl{constructor(t,s,c){this.type=_a,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const h=c["case-sensitive"]===void 0?s.parse(!1,1,Wr):s.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Wr);if(!h)return null;const d=c["diacritic-sensitive"]===void 0?s.parse(!1,1,Wr):s.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Wr);if(!d)return null;let m=null;return c.locale&&(m=s.parseObjectValue(c.locale,1,"locale",nn),!m)?null:new Fl(h,d,m)}evaluate(t){return new Wh(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Jy(l,t,s=0,c=l.length-1,h=Ab){for(;c>s;){if(c-s>600){const T=c-s+1,M=t-s+1,y=Math.log(T),E=.5*Math.exp(2*y/3),P=.5*Math.sqrt(y*E*(T-E)/T)*(M-T/2<0?-1:1);Jy(l,t,Math.max(s,Math.floor(t-M*E/T+P)),Math.min(c,Math.floor(t+(T-M)*E/T+P)),h)}const d=l[t];let m=s,x=c;for(_d(l,s,t),h(l[c],d)>0&&_d(l,s,c);m<x;){for(_d(l,m,x),m++,x--;h(l[m],d)<0;)m++;for(;h(l[x],d)>0;)x--}h(l[s],d)===0?_d(l,s,x):(x++,_d(l,x,c)),x<=t&&(s=x+1),t<=x&&(c=x-1)}}function _d(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function Ab(l,t){return l<t?-1:l>t?1:0}function Mb(l){let t=0;for(let s,c,h=0,d=l.length,m=d-1;h<d;m=h++)s=l[h],c=l[m],t+=(c.x-s.x)*(s.y+c.y);return t}function yd(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function vd(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function Ib(l,t,s){const c=l[0]-t[0],h=l[1]-t[1],d=l[0]-s[0],m=l[1]-s[1];return c*m-d*h==0&&c*d<=0&&h*m<=0}function Bl(l,t,s=!1){let c=!1;for(let x=0,T=t.length;x<T;x++){const M=t[x];for(let y=0,E=M.length,P=E-1;y<E;P=y++){const A=M[P],I=M[y];if(Ib(l,A,I))return s;(d=A)[1]>(h=l)[1]!=(m=I)[1]>h[1]&&h[0]<(m[0]-d[0])*(h[1]-d[1])/(m[1]-d[1])+d[0]&&(c=!c)}}var h,d,m;return c}function Ul(l,t,s,c){const h=c[0]-s[0],d=c[1]-s[1],m=(l[0]-s[0])*d-h*(l[1]-s[1]),x=(t[0]-s[0])*d-h*(t[1]-s[1]);return m>0&&x<0||m<0&&x>0}function Xh(l,t,s,c){return(h=[c[0]-s[0],c[1]-s[1]])[0]*(d=[t[0]-l[0],t[1]-l[1]])[1]-h[1]*d[0]!=0&&!(!Ul(l,t,s,c)||!Ul(s,c,l,t));var h,d}const al=8192;function Em(l,t){const s=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*al),Math.round(c*h*al)]}function Pb(l,t){for(let s=0;s<t.length;s++)if(Bl(l,t[s]))return!0;return!1}function Rb(l,t,s){for(const c of s)for(let h=0,d=c.length,m=d-1;h<d;m=h++)if(Xh(l,t,c[m],c[h]))return!0;return!1}function Qy(l,t){for(let s=0;s<l.length;++s)if(!Bl(l[s],t))return!1;for(let s=0;s<l.length-1;++s)if(Rb(l[s],l[s+1],t))return!1;return!0}function kb(l,t){for(let s=0;s<t.length;s++)if(Qy(l,t[s]))return!0;return!1}function ll(l,t,s){const c=[];for(let h=0;h<l.length;h++){const d=[];for(let m=0;m<l[h].length;m++){const x=Em(l[h][m],s);yd(t,x),d.push(x)}c.push(d)}return c}function kr(l,t,s){const c=[];for(let h=0;h<l.length;h++){const d=ll(l[h],t,s);c.push(d)}return c}function Jt(l,t,s,c){if(l[0]<s[0]||l[0]>s[2]){const h=.5*c;let d=l[0]-s[0]>h?-c:s[0]-l[0]>h?c:0;d===0&&(d=l[0]-s[2]>h?-c:s[2]-l[0]>h?c:0),l[0]+=d}yd(t,l)}function Kh(l,t,s,c){const h=Math.pow(2,c.z)*al,d=[c.x*al,c.y*al],m=[];if(!l)return m;for(const x of l)for(const T of x){const M=[T.x+d[0],T.y+d[1]];Jt(M,t,s,h),m.push(M)}return m}function vr(l,t,s,c){const h=Math.pow(2,c.z)*al,d=[c.x*al,c.y*al],m=[];if(!l)return m;for(const T of l){const M=[];for(const y of T){const E=[y.x+d[0],y.y+d[1]];yd(t,E),M.push(E)}m.push(M)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of m)for(const M of T)Jt(M,t,s,h)}var x;return m}class wa{constructor(t,s){this.type=Wr,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ko(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const d=c.features[h].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new wa(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wa(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new wa(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=ll(c.coordinates,d,m),T=Kh(s.geometry(),h,d,m);if(!vd(h,d))return!1;for(const M of T)if(!Bl(M,x))return!1}if(c.type==="MultiPolygon"){const x=kr(c.coordinates,d,m),T=Kh(s.geometry(),h,d,m);if(!vd(h,d))return!1;for(const M of T)if(!Pb(M,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=ll(c.coordinates,d,m),T=vr(s.geometry(),h,d,m);if(!vd(h,d))return!1;for(const M of T)if(!Qy(M,x))return!1}if(c.type==="MultiPolygon"){const x=kr(c.coordinates,d,m),T=vr(s.geometry(),h,d,m);if(!vd(h,d))return!1;for(const M of T)if(!kb(M,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ic={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},mr=1/298.257223563,Cm=mr*(2-mr),Vl=Math.PI/180;class Pc{static fromTile(t,s,c){const h=Math.PI*(1-2*(t+.5)/Math.pow(2,s)),d=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Vl;return new Pc(d,c)}static get units(){return Ic}constructor(t,s){if(t===void 0)throw new Error("No latitude given.");if(s&&!Ic[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Ic).join(", ")}`);const c=6378.137*Vl*(s?Ic[s]:1),h=Math.cos(t*Vl),d=1/(1-Cm*(1-h*h)),m=Math.sqrt(d);this.kx=c*m*h,this.ky=c*m*d*(1-Cm)}distance(t,s){const c=Hn(t[0]-s[0])*this.kx,h=(t[1]-s[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(t,s){const c=Hn(s[0]-t[0])*this.kx;return Math.atan2(c,(s[1]-t[1])*this.ky)/Vl}destination(t,s,c){const h=c*Vl;return this.offset(t,Math.sin(h)*s,Math.cos(h)*s)}offset(t,s,c){return[t[0]+s/this.kx,t[1]+c/this.ky]}lineDistance(t){let s=0;for(let c=0;c<t.length-1;c++)s+=this.distance(t[c],t[c+1]);return s}area(t){let s=0;for(let c=0;c<t.length;c++){const h=t[c];for(let d=0,m=h.length,x=m-1;d<m;x=d++)s+=Hn(h[d][0]-h[x][0])*(h[d][1]+h[x][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(t,s){let c=0;if(s<=0)return t[0];for(let h=0;h<t.length-1;h++){const d=t[h],m=t[h+1],x=this.distance(d,m);if(c+=x,c>s)return Rc(d,m,(s-(c-x))/x)}return t[t.length-1]}pointToSegmentDistance(t,s,c){let[h,d]=s,m=Hn(c[0]-h)*this.kx,x=(c[1]-d)*this.ky;if(m!==0||x!==0){const T=(Hn(t[0]-h)*this.kx*m+(t[1]-d)*this.ky*x)/(m*m+x*x);T>1?(h=c[0],d=c[1]):T>0&&(h+=m/this.kx*T,d+=x/this.ky*T)}return m=Hn(t[0]-h)*this.kx,x=(t[1]-d)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(t,s){let c=1/0,h=t[0][0],d=t[0][1],m=0,x=0;for(let T=0;T<t.length-1;T++){let M=t[T][0],y=t[T][1],E=Hn(t[T+1][0]-M)*this.kx,P=(t[T+1][1]-y)*this.ky,A=0;E===0&&P===0||(A=(Hn(s[0]-M)*this.kx*E+(s[1]-y)*this.ky*P)/(E*E+P*P),A>1?(M=t[T+1][0],y=t[T+1][1]):A>0&&(M+=E/this.kx*A,y+=P/this.ky*A)),E=Hn(s[0]-M)*this.kx,P=(s[1]-y)*this.ky;const I=E*E+P*P;I<c&&(c=I,h=M,d=y,m=T,x=A)}return{point:[h,d],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(t,s,c){let h=this.pointOnLine(c,t),d=this.pointOnLine(c,s);if(h.index>d.index||h.index===d.index&&h.t>d.t){const M=h;h=d,d=M}const m=[h.point],x=h.index+1,T=d.index;!Am(c[x],m[0])&&x<=T&&m.push(c[x]);for(let M=x+1;M<=T;M++)m.push(c[M]);return Am(c[T],d.point)||m.push(d.point),m}lineSliceAlong(t,s,c){let h=0;const d=[];for(let m=0;m<c.length-1;m++){const x=c[m],T=c[m+1],M=this.distance(x,T);if(h+=M,h>t&&d.length===0&&d.push(Rc(x,T,(t-(h-M))/M)),h>=s)return d.push(Rc(x,T,(s-(h-M))/M)),d;h>t&&d.push(T)}return d}bufferPoint(t,s){const c=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-c,t[0]+h,t[1]+c]}bufferBBox(t,s){const c=s/this.ky,h=s/this.kx;return[t[0]-h,t[1]-c,t[2]+h,t[3]+c]}insideBBox(t,s){return Hn(t[0]-s[0])>=0&&Hn(t[0]-s[2])<=0&&t[1]>=s[1]&&t[1]<=s[3]}}function Am(l,t){return l[0]===t[0]&&l[1]===t[1]}function Rc(l,t,s){const c=Hn(t[0]-l[0]);return[l[0]+c*s,l[1]+(t[1]-l[1])*s]}function Hn(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class xd{constructor(t=[],s=(c,h)=>c<h?-1:c>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,h=s[t];for(;t>0;){const d=t-1>>1,m=s[d];if(c(h,m)>=0)break;s[t]=m,t=d}s[t]=h}_down(t){const{data:s,compare:c}=this,h=this.length>>1,d=s[t];for(;t<h;){let m=1+(t<<1);const x=m+1;if(x<this.length&&c(s[x],s[m])<0&&(m=x),c(s[m],d)>=0)break;s[t]=s[m],t=m}s[t]=d}}var Rt=8192;function Yh(l,t){return t.dist-l.dist}const Sa=100,Gi=50;function ev(l){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==l[s])return!1;return!0}function Jh(l){return l[1]-l[0]+1}function Ta(l,t){const s=l[1]>=l[0]&&l[1]<t;return s||console.warn("Distance Expression: Index is out of range"),s}function kc(l,t){if(l[0]>l[1])return[null,null];const s=Jh(l);if(t){if(s===2)return[l,null];const c=Math.floor(s/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(s===1)return[l,null];const c=Math.floor(s/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function cl(l,t){const s=[1/0,1/0,-1/0,-1/0];if(!Ta(t,l.length))return s;for(let c=t[0];c<=t[1];++c)yd(s,l[c]);return s}function Dc(l){const t=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let c=0;c<l[s].length;++c)yd(t,l[s][c]);return t}function Lc(l,t,s){if(ev(l)||ev(t))return NaN;let c=0,h=0;return l[2]<t[0]&&(c=t[0]-l[2]),l[0]>t[2]&&(c=l[0]-t[2]),l[1]>t[3]&&(h=l[1]-t[3]),l[3]<t[1]&&(h=t[1]-l[3]),s.distance([0,0],[c,h])}function Db(l){return 360*l-180}function Lb(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Mm(l,t){const s=Math.pow(2,t.z),c=(l.y/Rt+t.y)/s;return[Db((l.x/Rt+t.x)/s),Lb(c)]}function tv(l,t){const s=[];for(let c=0;c<l.length;++c)s.push(Mm(l[c],t));return s}function rv(l,t,s){const c=s.pointOnLine(t,l).point;return s.distance(l,c)}function nv(l,t,s,c,h){const d=s.slice(c[0],c[1]+1);let m=1/0;for(let x=t[0];x<=t[1];++x)if((m=Math.min(m,rv(l[x],d,h)))===0)return 0;return m}function Qh(l,t,s,c,h){const d=Math.min(h.pointToSegmentDistance(l,s,c),h.pointToSegmentDistance(t,s,c)),m=Math.min(h.pointToSegmentDistance(s,l,t),h.pointToSegmentDistance(c,l,t));return Math.min(d,m)}function Nb(l,t,s,c,h){if(!Ta(t,l.length)||!Ta(c,s.length))return NaN;let d=1/0;for(let m=t[0];m<t[1];++m)for(let x=c[0];x<c[1];++x){if(Xh(l[m],l[m+1],s[x],s[x+1]))return 0;d=Math.min(d,Qh(l[m],l[m+1],s[x],s[x+1],h))}return d}function $l(l,t,s,c,h){if(!Ta(t,l.length)||!Ta(c,s.length))return NaN;let d=1/0;for(let m=t[0];m<=t[1];++m)for(let x=c[0];x<=c[1];++x)if((d=Math.min(d,h.distance(l[m],s[x])))===0)return d;return d}function Ob(l,t,s){if(Bl(l,t,!0))return 0;let c=1/0;for(const h of t){const d=h.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[d-1]&&(c=Math.min(c,s.pointToSegmentDistance(l,h[d-1],h[0])))===0||(c=Math.min(c,rv(l,h,s)))===0)return c}return c}function zb(l,t,s,c){if(!Ta(t,l.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Bl(l[d],s,!0))return 0;let h=1/0;for(let d=t[0];d<t[1];++d)for(const m of s)for(let x=0,T=m.length,M=T-1;x<T;M=x++){if(Xh(l[d],l[d+1],m[M],m[x]))return 0;h=Math.min(h,Qh(l[d],l[d+1],m[M],m[x],c))}return h}function ef(l,t){for(const s of l)for(let c=0;c<=s.length-1;++c)if(Bl(s[c],t,!0))return!0;return!1}function iv(l,t,s,c=1/0){const h=Dc(l),d=Dc(t);if(c!==1/0&&Lc(h,d,s)>=c)return c;if(vd(h,d)){if(ef(l,t))return 0}else if(ef(t,l))return 0;let m=c;for(const x of l)for(let T=0,M=x.length,y=M-1;T<M;y=T++)for(const E of t)for(let P=0,A=E.length,I=A-1;P<A;I=P++){if(Xh(x[y],x[T],E[I],E[P]))return 0;m=Math.min(m,Qh(x[y],x[T],E[I],E[P],s))}return m}function bd(l,t,s,c,h,d,m){if(d===null||m===null)return;const x=Lc(cl(c,d),cl(h,m),s);x<t&&l.push({dist:x,range1:d,range2:m})}function Do(l,t,s,c,h=1/0){let d=Math.min(c.distance(l[0],s[0][0]),h);if(d===0)return d;const m=new xd([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Yh),x=t?Gi:Sa,T=Dc(s);for(;m.length;){const M=m.pop();if(M.dist>=d)continue;const y=M.range1;if(Jh(y)<=x){if(!Ta(y,l.length))return NaN;if(t){const E=zb(l,y,s,c);if((d=Math.min(d,E))===0)return d}else for(let E=y[0];E<=y[1];++E){const P=Ob(l[E],s,c);if((d=Math.min(d,P))===0)return d}}else{const E=kc(y,t);if(E[0]!==null){const P=Lc(cl(l,E[0]),T,c);P<d&&m.push({dist:P,range1:E[0],range2:[0,0]})}if(E[1]!==null){const P=Lc(cl(l,E[1]),T,c);P<d&&m.push({dist:P,range1:E[1],range2:[0,0]})}}}return d}function Im(l,t,s,c,h,d=1/0){let m=Math.min(d,h.distance(l[0],s[0]));if(m===0)return m;const x=new xd([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],Yh),T=t?Gi:Sa,M=c?Gi:Sa;for(;x.length;){const y=x.pop();if(y.dist>=m)continue;const E=y.range1,P=y.range2;if(Jh(E)<=T&&Jh(P)<=M){if(!Ta(E,l.length)||!Ta(P,s.length))return NaN;if(t&&c?m=Math.min(m,Nb(l,E,s,P,h)):t||c?t&&!c?m=Math.min(m,nv(s,P,l,E,h)):!t&&c&&(m=Math.min(m,nv(l,E,s,P,h))):m=Math.min(m,$l(l,E,s,P,h)),m===0)return m}else{const A=kc(E,t),I=kc(P,c);bd(x,m,h,l,s,A[0],I[0]),bd(x,m,h,l,s,A[0],I[1]),bd(x,m,h,l,s,A[1],I[0]),bd(x,m,h,l,s,A[1],I[1])}}return m}function tf(l,t,s,c,h=1/0){let d=h;const m=cl(l,[0,l.length-1]);for(const x of s)if(!(d!==1/0&&Lc(m,cl(x,[0,x.length-1]),c)>=d)&&(d=Math.min(d,Im(l,t,x,!0,c,d)),d===0))return d;return d}function wd(l,t,s,c,h=1/0){let d=h;const m=cl(l,[0,l.length-1]);for(const x of s){if(d!==1/0&&Lc(m,Dc(x),c)>=d)continue;const T=Do(l,t,x,c,d);if(isNaN(T))return T;if((d=Math.min(d,T))===0)return d}return d}function rf(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class ul{constructor(t,s){this.type=Kt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ko(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let h=0;h<c.features.length;++h)if(rf(c.features[h].geometry.type))return new ul(c,c.features[h].geometry)}else if(c.type==="Feature"){if(rf(c.geometry.type))return new ul(c,c.geometry)}else if(rf(c.type))return new ul(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const s=t.geometry(),c=t.canonicalID();if(s!=null&&c!=null){if(t.geometryType()==="Point")return function(h,d,m){const x=[];for(const M of h)for(const y of M)x.push(Mm(y,d));const T=new Pc(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Im(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T):m.type==="MultiLineString"?tf(x,!1,m.coordinates,T):m.type==="Polygon"||m.type==="MultiPolygon"?wd(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,T):null}(s,c,this.geometries);if(t.geometryType()==="LineString")return function(h,d,m){const x=[];for(const M of h){const y=[];for(const E of M)y.push(Mm(E,d));x.push(y)}const T=new Pc(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return tf(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,T);if(m.type==="MultiLineString"){let M=1/0;for(let y=0;y<m.coordinates.length;y++){const E=tf(m.coordinates[y],!0,x,T,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}if(m.type==="Polygon"||m.type==="MultiPolygon"){let M=1/0;for(let y=0;y<x.length;y++){const E=wd(x[y],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,T,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return null}(s,c,this.geometries);if(t.geometryType()==="Polygon")return function(h,d,m){const x=[];for(const M of function(y,E){const P=y.length;if(P<=1)return[y];const A=[];let I,k;for(let j=0;j<P;j++){const F=Mb(y[j]);F!==0&&(y[j].area=Math.abs(F),k===void 0&&(k=F<0),k===F<0?(I&&A.push(I),I=[y[j]]):I.push(y[j]))}return I&&A.push(I),A}(h)){const y=[];for(let E=0;E<M.length;++E)y.push(tv(M[E],d));x.push(y)}const T=new Pc(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return wd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,T);if(m.type==="MultiLineString"){let M=1/0;for(let y=0;y<m.coordinates.length;y++){const E=wd(m.coordinates[y],!0,x,T,M);if(isNaN(E))return E;if((M=Math.min(M,E))===0)return M}return M}return m.type==="Polygon"||m.type==="MultiPolygon"?function(M,y,E){let P=1/0;for(const A of M)for(const I of y){const k=iv(A,I,E,P);if(isNaN(k))return k;if((P=Math.min(P,k))===0)return P}return P}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,T):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nf(l,t){switch(l){case"string":return Ri(t);case"number":return+t;case"boolean":return!!t;case"color":return an.parse(t);case"formatted":return ts.fromString(Ri(t));case"resolvedImage":return rs.build(Ri(t))}return t}function Pm(l,t,s,c){return c!==void 0&&(l=c*Math.round(l/c)),t!==void 0&&l<t&&(l=t),s!==void 0&&l>s&&(l=s),l}class Gl{constructor(t,s,c){this.type=t,this.key=s,this.scope=c}static parse(t,s){let c=s.expectedType;if(c==null&&(c=Yr),t.length<2||t.length>3)return s.error("Invalid number of arguments for 'config' expression.");const h=s.parse(t[1],1);if(!(h instanceof va))return s.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const d=s.parse(t[2],2);return d instanceof va?new Gl(c,Ri(h.value),Ri(d.value)):s.error("Scope of 'config' expression must be a string literal.")}return new Gl(c,Ri(h.value))}evaluate(t){const s=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(s);if(!c)return null;const{type:h,value:d,values:m,minValue:x,maxValue:T,stepValue:M}=c,y=c.default.evaluate(t);let E=y;if(d){const P=t.scope;t.scope=(P||"").split("").slice(1).join(""),E=d.evaluate(t),t.scope=P}return h&&(E=nf(h,E)),E===void 0||x===void 0&&T===void 0&&M===void 0||(typeof E=="number"?E=Pm(E,x,T,M):Array.isArray(E)&&(E=E.map(P=>typeof P=="number"?Pm(P,x,T,M):P))),d!==void 0&&E!==void 0&&m&&!m.includes(E)&&(E=y,h&&(E=nf(h,E))),(h&&h!==this.type||E!==void 0&&ii(E)!==this.type)&&(E=nf(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function Nc(l){if(l instanceof hs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof wa||l instanceof ul)return!1;let t=!0;return l.eachChild(s=>{t&&!Nc(s)&&(t=!1)}),t}function Sd(l){if(l instanceof hs&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(s=>{t&&!Sd(s)&&(t=!1)}),t}function Td(l){if(l instanceof Gl)return new Set([l.key]);let t=new Set;return l.eachChild(s=>{t=new Set([...t,...Td(s)])}),t}function Ea(l,t){if(l instanceof hs&&t.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(c=>{s&&!Ea(c,t)&&(s=!1)}),s}class ql{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new ql(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Oc{constructor(t,s=[],c,h=new Hh,d=[],m,x){this.registry=t,this.path=s,this.key=s.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=h,this.errors=d,this.expectedType=c,this._scope=m,this.options=x}parse(t,s,c,h,d={}){return s||c?this.concat(s,null,c,h)._parse(t,d):this._parse(t,d)}parseObjectValue(t,s,c,h,d,m={}){return this.concat(s,c,h,d)._parse(t,m)}_parse(t,s){function c(h,d,m){return m==="assert"?new Hs(d,[h]):m==="coerce"?new ba(d,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let d=h.parse(t,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,x=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else d=c(d,m,s.typeAnnotation||"coerce");else d=c(d,m,s.typeAnnotation||"assert")}if(!(d instanceof va)&&d.type.kind!=="resolvedImage"&&sf(d)){const m=new Zh(this._scope,this.options);try{d=new va(d.type,d.evaluate(m))}catch(x){return this.error(x.message),null}}return d}return ba.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c,h){let d=typeof t=="number"?this.path.concat(t):this.path;d=typeof s=="string"?d.concat(s):d;const m=h?this.scope.concat(h):this.scope;return new Oc(this.registry,d,c||null,m,this.errors,this._scope,this.options)}error(t,...s){const c=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new fo(c,t))}checkSubtype(t,s){const c=Cc(t,s);return c&&this.error(c),c}}var Rm=Oc;function sf(l){if(l instanceof ql)return sf(l.boundExpression);if(l instanceof hs&&l.name==="error"||l instanceof Fl||l instanceof wa||l instanceof ul||l instanceof Gl)return!1;const t=l instanceof ba||l instanceof Hs;let s=!0;return l.eachChild(c=>{s=t?s&&sf(c):s&&c instanceof va}),!!s&&Nc(l)&&Ea(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ed(l,t){const s=l.length-1;let c,h,d=0,m=s,x=0;for(;d<=m;)if(x=Math.floor((d+m)/2),c=l[x],h=l[x+1],c<=t){if(x===s||t<h)return x;d=x+1}else{if(!(c>t))throw new Jn("Input is not a number.");m=x-1}return 0}class ea{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,d]of c)this.labels.push(h),this.outputs.push(d)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,Kt);if(!c)return null;const h=[];let d=null;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);for(let m=1;m<t.length;m+=2){const x=m===1?-1/0:t[m],T=t[m+1],M=m,y=m+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const E=s.parse(T,y,d);if(!E)return null;d=d||E.type,h.push([x,E])}return new ea(d,c,h)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return c[0].evaluate(t);const d=s.length;return h>=s[d-1]?c[d-1].evaluate(t):c[Ed(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}const Ur=.95047,sv=1.08883,ov=4/29,zc=6/29,km=3*zc*zc,jb=zc*zc*zc,Pn=Math.PI/180,Fb=180/Math.PI;function Dm(l){return l>jb?Math.pow(l,1/3):l/km+ov}function Lm(l){return l>zc?l*l*l:km*(l-ov)}function Nm(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Om(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function av(l){const t=Om(l.r),s=Om(l.g),c=Om(l.b),h=Dm((.4124564*t+.3575761*s+.1804375*c)/Ur),d=Dm((.2126729*t+.7151522*s+.072175*c)/1);return{l:116*d-16,a:500*(h-d),b:200*(d-Dm((.0193339*t+.119192*s+.9503041*c)/sv)),alpha:l.a}}function lv(l){let t=(l.l+16)/116,s=isNaN(l.a)?t:t+l.a/500,c=isNaN(l.b)?t:t-l.b/200;return t=1*Lm(t),s=Ur*Lm(s),c=sv*Lm(c),new an(Nm(3.2404542*s-1.5371385*t-.4985314*c),Nm(-.969266*s+1.8760108*t+.041556*c),Nm(.0556434*s-.2040259*t+1.0572252*c),l.alpha)}function Bb(l,t,s){const c=t-l;return l+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Cd={forward:av,reverse:lv,interpolate:function(l,t,s){return{l:or(l.l,t.l,s),a:or(l.a,t.a,s),b:or(l.b,t.b,s),alpha:or(l.alpha,t.alpha,s)}}},Ad={forward:function(l){const{l:t,a:s,b:c}=av(l),h=Math.atan2(c,s)*Fb;return{h:h<0?h+360:h,c:Math.sqrt(s*s+c*c),l:t,alpha:l.a}},reverse:function(l){const t=l.h*Pn,s=l.c;return lv({l:l.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:l.alpha})},interpolate:function(l,t,s){return{h:Bb(l.h,t.h,s),c:or(l.c,t.c,s),l:or(l.l,t.l,s),alpha:or(l.alpha,t.alpha,s)}}};var cv=Object.freeze({__proto__:null,hcl:Ad,lab:Cd});class Ws{constructor(t,s,c,h,d){this.type=t,this.operator=s,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[m,x]of d)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(t,s,c,h){let d=0;if(t.name==="exponential")d=zm(s,t.base,c,h);else if(t.name==="linear")d=zm(s,1,c,h);else if(t.name==="cubic-bezier"){const m=t.controlPoints;d=new Ht(m[0],m[1],m[2],m[3]).solve(zm(s,1,c,h))}return d}static parse(t,s){let[c,h,d,...m]=t;if(!Array.isArray(h)||h.length===0)return s.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const M=h[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if(h[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(M.length!==4||M.some(y=>typeof y!="number"||y<0||y>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(d=s.parse(d,2,Kt),!d)return null;const x=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=es:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let M=0;M<m.length;M+=2){const y=m[M],E=m[M+1],P=M+3,A=M+4;if(typeof y!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=y)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const I=s.parse(E,A,T);if(!I)return null;T=T||I.type,x.push([y,I])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Ws(T,c,h,d,x):s.error(`Type ${Xn(T)} is not interpolatable.`)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return c[0].evaluate(t);const d=s.length;if(h>=s[d-1])return c[d-1].evaluate(t);const m=Ed(s,h),x=Ws.interpolationFactor(this.interpolation,h,s[m],s[m+1]),T=c[m].evaluate(t),M=c[m+1].evaluate(t);return this.operator==="interpolate"?fd[this.type.kind.toLowerCase()](T,M,x):this.operator==="interpolate-hcl"?Ad.reverse(Ad.interpolate(Ad.forward(T),Ad.forward(M),x)):Cd.reverse(Cd.interpolate(Cd.forward(T),Cd.forward(M),x))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,t,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function zm(l,t,s,c){const h=c-s,d=l-s;return h===0?0:t===1?d/h:(Math.pow(t,d)-1)/(Math.pow(t,h)-1)}class of{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const h=s.expectedType;h&&h.kind!=="value"&&(c=h);const d=[];for(const x of t.slice(1)){const T=s.parse(x,1+d.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,d.push(T)}const m=h&&d.some(x=>Cc(h,x.type));return new of(m?Yr:c,d)}evaluate(t){let s,c=null,h=0;for(const d of this.args){if(h++,c=d.evaluate(t),c&&c instanceof rs&&!c.available&&(s||(s=c),c=null,h===this.args.length))return s;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class af{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let d=1;d<t.length-1;d+=2){const m=t[d];if(typeof m!="string")return s.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",d);const x=s.parse(t[d+1],d+1);if(!x)return null;c.push([m,x])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return h?new af(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,c]of this.bindings)t.push(s,c.serialize());return t.push(this.result.serialize()),t}}class jm{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Kt),h=s.parse(t[2],2,$i(s.expectedType||Yr));return c&&h?new jm(h.type.itemType,c,h):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new Jn(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Jn(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Jn(`Array index must be an integer, but found ${s} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return c[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fm{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Kt),h=s.parse(t[2],2,$i(s.expectedType||Yr));return c&&h?new Fm(h.type.itemType,c,h):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new Jn(`Array index out of bounds: ${s} < 0.`);if(s>c.length-1)throw new Jn(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s===Math.floor(s))return c[s];const h=Math.floor(s),d=Math.ceil(s),m=c[h],x=c[d];if(typeof m!="number"||typeof x!="number")throw new Jn(`Cannot interpolate between non-number values at index ${s}.`);const T=s-h;return m*(1-T)+x*T}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Bm{constructor(t,s){this.type=Wr,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Yr),h=s.parse(t[2],2,Yr);return c&&h?Sm(c.type,[Wr,nn,Kt,Tc,Yr])?new Bm(c,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Ac(s,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(ii(s))} instead.`);if(!Ac(c,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${Xn(ii(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lf{constructor(t,s,c){this.type=Kt,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Yr),h=s.parse(t[2],2,Yr);if(!c||!h)return null;if(!Sm(c.type,[Wr,nn,Kt,Tc,Yr]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(c.type)} instead`);if(t.length===4){const d=s.parse(t[3],3,Kt);return d?new lf(c,h,d):null}return new lf(c,h)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Ac(s,["boolean","string","number","null"]))throw new Jn(`Expected first argument to be of type boolean, string, number or null, but found ${Xn(ii(s))} instead.`);if(!Ac(c,["string","array"]))throw new Jn(`Expected second argument to be of type array or string, but found ${Xn(ii(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return c.indexOf(s,h)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Um{constructor(t,s,c,h,d,m){this.inputType=t,this.type=s,this.input=c,this.cases=h,this.outputs=d,this.otherwise=m}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const d={},m=[];for(let M=2;M<t.length-1;M+=2){let y=t[M];const E=t[M+1];Array.isArray(y)||(y=[y]);const P=s.concat(M);if(y.length===0)return P.error("Expected at least one branch label.");for(const I of y){if(typeof I!="number"&&typeof I!="string")return P.error("Branch labels must be numbers or strings.");if(typeof I=="number"&&Math.abs(I)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof I=="number"&&Math.floor(I)!==I)return P.error("Numeric branch labels must be integer values.");if(c){if(P.checkSubtype(c,ii(I)))return null}else c=ii(I);if(d[String(I)]!==void 0)return P.error("Branch labels must be unique.");d[String(I)]=m.length}const A=s.parse(E,M,h);if(!A)return null;h=h||A.type,m.push(A)}const x=s.parse(t[1],1,Yr);if(!x)return null;const T=s.parse(t[t.length-1],t.length-1,h);return T?x.type.kind!=="value"&&s.concat(1).checkSubtype(c,x.type)?null:new Um(c,h,x,d,m,T):null}evaluate(t){const s=this.input.evaluate(t);return(ii(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],h={};for(const m of s){const x=h[this.cases[m]];x===void 0?(h[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of c)t.push(x.length===1?d(x[0]):x.map(d)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}class Vm{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const h=[];for(let m=1;m<t.length-1;m+=2){const x=s.parse(t[m],m,Wr);if(!x)return null;const T=s.parse(t[m+1],m+1,c);if(!T)return null;h.push([x,T]),c=c||T.type}const d=s.parse(t[t.length-1],t.length-1,c);return d?new Vm(c,h,d):null}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class cf{constructor(t,s,c,h){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Yr),h=s.parse(t[2],2,Kt);if(!c||!h)return null;if(!Sm(c.type,[$i(Yr),nn,Yr]))return s.error(`Expected first argument to be of type array or string, but found ${Xn(c.type)} instead`);if(t.length===4){const d=s.parse(t[3],3,Kt);return d?new cf(c.type,c,h,d):null}return new cf(c.type,c,h)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Ac(s,["string","array"]))throw new Jn(`Expected first argument to be of type array or string, but found ${Xn(ii(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return s.slice(c,h)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function uv(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function dv(l,t,s,c){return c.compare(t,s)===0}function jc(l,t,s){const c=l!=="=="&&l!=="!=";return class v4{constructor(d,m,x){this.type=Wr,this.lhs=d,this.rhs=m,this.collator=x,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const x=d[0];let T=m.parse(d[1],1,Yr);if(!T)return null;if(!uv(x,T.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${Xn(T.type)}'.`);let M=m.parse(d[2],2,Yr);if(!M)return null;if(!uv(x,M.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${Xn(M.type)}'.`);if(T.type.kind!==M.type.kind&&T.type.kind!=="value"&&M.type.kind!=="value")return m.error(`Cannot compare types '${Xn(T.type)}' and '${Xn(M.type)}'.`);c&&(T.type.kind==="value"&&M.type.kind!=="value"?T=new Hs(M.type,[T]):T.type.kind!=="value"&&M.type.kind==="value"&&(M=new Hs(T.type,[M])));let y=null;if(d.length===4){if(T.type.kind!=="string"&&M.type.kind!=="string"&&T.type.kind!=="value"&&M.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(y=m.parse(d[3],3,_a),!y)return null}return new v4(T,M,y)}evaluate(d){const m=this.lhs.evaluate(d),x=this.rhs.evaluate(d);if(c&&this.hasUntypedArgument){const T=ii(m),M=ii(x);if(T.kind!==M.kind||T.kind!=="string"&&T.kind!=="number")throw new Jn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${M.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=ii(m),M=ii(x);if(T.kind!=="string"||M.kind!=="string")return t(d,m,x)}return this.collator?s(d,m,x,this.collator.evaluate(d)):t(d,m,x)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[l];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const Ub=jc("==",function(l,t,s){return t===s},dv),Vb=jc("!=",function(l,t,s){return t!==s},function(l,t,s,c){return!dv(0,t,s,c)}),$b=jc("<",function(l,t,s){return t<s},function(l,t,s,c){return c.compare(t,s)<0}),Gb=jc(">",function(l,t,s){return t>s},function(l,t,s,c){return c.compare(t,s)>0}),qb=jc("<=",function(l,t,s){return t<=s},function(l,t,s,c){return c.compare(t,s)<=0}),Hb=jc(">=",function(l,t,s){return t>=s},function(l,t,s,c){return c.compare(t,s)>=0});class Md{constructor(t,s,c,h,d,m){this.type=nn,this.number=t,this.locale=s,this.currency=c,this.unit=h,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,Kt);if(!c)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let d=null;if(h.locale&&(d=s.parseObjectValue(h.locale,2,"locale",nn),!d))return null;let m=null;if(h.currency&&(m=s.parseObjectValue(h.currency,2,"currency",nn),!m))return null;let x=null;if(h.unit&&(x=s.parseObjectValue(h.unit,2,"unit",nn),!x))return null;let T=null;if(h["min-fraction-digits"]&&(T=s.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Kt),!T))return null;let M=null;return h["max-fraction-digits"]&&(M=s.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Kt),!M)?null:new Md(c,d,m,x,T,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class $m{constructor(t){this.type=Kt,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Xn(c.type)} instead.`):new $m(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Jn(`Expected value to be of type string or array, but found ${Xn(ii(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}function Gm(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Fc={"==":Ub,"!=":Vb,">":Gb,"<":$b,">=":Hb,"<=":qb,array:Hs,at:jm,"at-interpolated":Fm,boolean:Hs,case:Vm,coalesce:of,collator:Fl,format:Mc,image:ol,in:Bm,"index-of":lf,interpolate:Ws,"interpolate-hcl":Ws,"interpolate-lab":Ws,length:$m,let:af,literal:va,match:Um,number:Hs,"number-format":Md,object:Hs,slice:cf,step:ea,string:Hs,"to-boolean":ba,"to-color":ba,"to-number":ba,"to-string":ba,var:ql,within:wa,distance:ul,config:Gl};function hv(l,[t,s,c,h]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const d=h?h.evaluate(l):1,m=gd(t,s,c,d);if(m)throw new Jn(m);return new an(t/255*d,s/255*d,c/255*d,d)}function fv(l,[t,s,c,h]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const d=h?h.evaluate(l):1,m=function(M,y,E,P){return typeof M=="number"&&M>=0&&M<=360?typeof y=="number"&&y>=0&&y<=100&&typeof E=="number"&&E>=0&&E<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[M,y,E,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[M,y,E,P]:[M,y,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[M,y,E,P]:[M,y,E]).join(", ")}]: 'h' must be between 0 and 360.`}(t,s,c,d);if(m)throw new Jn(m);const x=`hsla(${t}, ${s}%, ${c}%, ${d})`,T=an.parse(x);if(!T)throw new Jn(`Failed to parse HSLA color: ${x}`);return T}function qm(l,t){return l in t}function uf(l,t){const s=t[l];return s===void 0?null:s}function po(l){return{type:l}}function Hm(l){return{result:"success",value:l}}function Ca(l){return{result:"error",value:l}}function Wm(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function Bc(l){return l["property-type"]==="data-driven"}function df(l){return Wm(l.expression,"measure-light")}function pv(l){return Wm(l.expression,"zoom")}function Zm(l){return!!l.expression&&l.expression.interpolated}function hf(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function mv(l){return l}function gv(l,t){const s=t.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",h=c||!(c||l.property!==void 0),d=l.type||(Zm(t)?"exponential":"interval");if(s&&((l=Kr({},l)).stops&&(l.stops=l.stops.map(M=>[M[0],an.parse(M[1])])),l.default=an.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!cv[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,x,T;if(d==="exponential")m=Xm;else if(d==="interval")m=_v;else if(d==="categorical"){m=Wb,x=Object.create(null);for(const M of l.stops)x[M[0]]=M[1];T=typeof l.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=ff}if(c){const M={},y=[];for(let A=0;A<l.stops.length;A++){const I=l.stops[A],k=I[0].zoom;M[k]===void 0&&(M[k]={zoom:k,type:l.type,property:l.property,default:l.default,stops:[]},y.push(k)),M[k].stops.push([I[0].value,I[1]])}const E=[];for(const A of y)E.push([M[A].zoom,gv(M[A],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Ws.interpolationFactor.bind(void 0,P),zoomStops:E.map(A=>A[0]),evaluate:({zoom:A},I)=>Xm({stops:E,base:l.base},t,A).evaluate(A,I)}}if(h){const M=d==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Ws.interpolationFactor.bind(void 0,M),zoomStops:l.stops.map(y=>y[0]),evaluate:({zoom:y})=>m(l,t,y,x,T)}}return{kind:"source",evaluate(M,y){const E=y&&y.properties?y.properties[l.property]:void 0;return E===void 0?Id(l.default,t.default):m(l,t,E,x,T)}}}function Id(l,t,s){return l!==void 0?l:t!==void 0?t:s!==void 0?s:void 0}function Wb(l,t,s,c,h){return Id(typeof s===h?c[s]:void 0,l.default,t.default)}function _v(l,t,s){if(xa(s)!=="number")return Id(l.default,t.default);const c=l.stops.length;if(c===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[c-1][0])return l.stops[c-1][1];const h=Ed(l.stops.map(d=>d[0]),s);return l.stops[h][1]}function Xm(l,t,s){const c=l.base!==void 0?l.base:1;if(xa(s)!=="number")return Id(l.default,t.default);const h=l.stops.length;if(h===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[h-1][0])return l.stops[h-1][1];const d=Ed(l.stops.map(y=>y[0]),s),m=function(y,E,P,A){const I=A-P,k=y-P;return I===0?0:E===1?k/I:(Math.pow(E,k)-1)/(Math.pow(E,I)-1)}(s,c,l.stops[d][0],l.stops[d+1][0]),x=l.stops[d][1],T=l.stops[d+1][1];let M=fd[t.type]||mv;if(l.colorSpace&&l.colorSpace!=="rgb"){const y=cv[l.colorSpace];M=(E,P)=>y.reverse(y.interpolate(y.forward(E),y.forward(P),m))}return typeof x.evaluate=="function"?{evaluate(...y){const E=x.evaluate.apply(void 0,y),P=T.evaluate.apply(void 0,y);if(E!==void 0&&P!==void 0)return M(E,P,m)}}:M(x,T,m)}function ff(l,t,s){return t.type==="color"?s=an.parse(s):t.type==="formatted"?s=ts.fromString(s.toString()):t.type==="resolvedImage"?s=rs.build(s.toString()):xa(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),Id(s,l.default,t.default)}hs.register(Fc,{error:[{kind:"error"},[nn],(l,[t])=>{throw new Jn(t.evaluate(l))}],typeof:[nn,[Yr],(l,[t])=>Xn(ii(t.evaluate(l)))],"to-rgba":[$i(Kt,4),[es],(l,[t])=>t.evaluate(l).toRenderColor(null).toArray()],"to-hsla":[$i(Kt,4),[es],(l,[t])=>t.evaluate(l).toRenderColor(null).toHslaArray()],rgb:[es,[Kt,Kt,Kt],hv],rgba:[es,[Kt,Kt,Kt,Kt],hv],hsl:[es,[Kt,Kt,Kt],fv],hsla:[es,[Kt,Kt,Kt,Kt],fv],has:{type:Wr,overloads:[[[nn],(l,[t])=>qm(t.evaluate(l),l.properties())],[[nn,Ec],(l,[t,s])=>qm(t.evaluate(l),s.evaluate(l))]]},get:{type:Yr,overloads:[[[nn],(l,[t])=>uf(t.evaluate(l),l.properties())],[[nn,Ec],(l,[t,s])=>uf(t.evaluate(l),s.evaluate(l))]]},"feature-state":[Yr,[nn],(l,[t])=>uf(t.evaluate(l),l.featureState||{})],properties:[Ec,[],l=>l.properties()],"geometry-type":[nn,[],l=>l.geometryType()],id:[Yr,[],l=>l.id()],zoom:[Kt,[],l=>l.globals.zoom],pitch:[Kt,[],l=>l.globals.pitch||0],"distance-from-center":[Kt,[],l=>l.distanceFromCenter()],"measure-light":[Kt,[nn],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[Kt,[],l=>l.globals.heatmapDensity||0],"line-progress":[Kt,[],l=>l.globals.lineProgress||0],"raster-value":[Kt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[Kt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[Kt,[],l=>l.globals.skyRadialProgress||0],accumulated:[Yr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Kt,po(Kt),(l,t)=>{let s=0;for(const c of t)s+=c.evaluate(l);return s}],"*":[Kt,po(Kt),(l,t)=>{let s=1;for(const c of t)s*=c.evaluate(l);return s}],"-":{type:Kt,overloads:[[[Kt,Kt],(l,[t,s])=>t.evaluate(l)-s.evaluate(l)],[[Kt],(l,[t])=>-t.evaluate(l)]]},"/":[Kt,[Kt,Kt],(l,[t,s])=>t.evaluate(l)/s.evaluate(l)],"%":[Kt,[Kt,Kt],(l,[t,s])=>t.evaluate(l)%s.evaluate(l)],ln2:[Kt,[],()=>Math.LN2],pi:[Kt,[],()=>Math.PI],e:[Kt,[],()=>Math.E],"^":[Kt,[Kt,Kt],(l,[t,s])=>Math.pow(t.evaluate(l),s.evaluate(l))],sqrt:[Kt,[Kt],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[Kt,[Kt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[Kt,[Kt],(l,[t])=>Math.log(t.evaluate(l))],log2:[Kt,[Kt],(l,[t])=>Math.log(t.evaluate(l))/Math.LN2],sin:[Kt,[Kt],(l,[t])=>Math.sin(t.evaluate(l))],cos:[Kt,[Kt],(l,[t])=>Math.cos(t.evaluate(l))],tan:[Kt,[Kt],(l,[t])=>Math.tan(t.evaluate(l))],asin:[Kt,[Kt],(l,[t])=>Math.asin(t.evaluate(l))],acos:[Kt,[Kt],(l,[t])=>Math.acos(t.evaluate(l))],atan:[Kt,[Kt],(l,[t])=>Math.atan(t.evaluate(l))],min:[Kt,po(Kt),(l,t)=>Math.min(...t.map(s=>s.evaluate(l)))],max:[Kt,po(Kt),(l,t)=>Math.max(...t.map(s=>s.evaluate(l)))],abs:[Kt,[Kt],(l,[t])=>Math.abs(t.evaluate(l))],round:[Kt,[Kt],(l,[t])=>{const s=t.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[Kt,[Kt],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[Kt,[Kt],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[Wr,[nn,Yr],(l,[t,s])=>l.properties()[t.value]===s.value],"filter-id-==":[Wr,[Yr],(l,[t])=>l.id()===t.value],"filter-type-==":[Wr,[nn],(l,[t])=>l.geometryType()===t.value],"filter-<":[Wr,[nn,Yr],(l,[t,s])=>{const c=l.properties()[t.value],h=s.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Wr,[Yr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Wr,[nn,Yr],(l,[t,s])=>{const c=l.properties()[t.value],h=s.value;return typeof c==typeof h&&c>h}],"filter-id->":[Wr,[Yr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Wr,[nn,Yr],(l,[t,s])=>{const c=l.properties()[t.value],h=s.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Wr,[Yr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Wr,[nn,Yr],(l,[t,s])=>{const c=l.properties()[t.value],h=s.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Wr,[Yr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Wr,[Yr],(l,[t])=>t.value in l.properties()],"filter-has-id":[Wr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Wr,[$i(nn)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[Wr,[$i(Yr)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[Wr,[nn,$i(Yr)],(l,[t,s])=>s.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[Wr,[nn,$i(Yr)],(l,[t,s])=>function(c,h,d,m){for(;d<=m;){const x=d+m>>1;if(h[x]===c)return!0;h[x]>c?m=x-1:d=x+1}return!1}(l.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Wr,overloads:[[[Wr,Wr],(l,[t,s])=>t.evaluate(l)&&s.evaluate(l)],[po(Wr),(l,t)=>{for(const s of t)if(!s.evaluate(l))return!1;return!0}]]},any:{type:Wr,overloads:[[[Wr,Wr],(l,[t,s])=>t.evaluate(l)||s.evaluate(l)],[po(Wr),(l,t)=>{for(const s of t)if(s.evaluate(l))return!0;return!1}]]},"!":[Wr,[Wr],(l,[t])=>!t.evaluate(l)],"is-supported-script":[Wr,[nn],(l,[t])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(t.evaluate(l))}],upcase:[nn,[nn],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[nn,[nn],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[nn,po(Yr),(l,t)=>t.map(s=>Ri(s.evaluate(l))).join("")],"resolved-locale":[nn,[_a],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[Kt,[Kt,Kt,Yr],(l,t)=>{const[s,c,h]=t.map(m=>m.evaluate(l));if(s>c||s===c)return s;let d;if(typeof h=="string")d=function(m){let x=0;if(m.length===0)return x;for(let T=0;T<m.length;T++)x=(x<<5)-x+m.charCodeAt(T),x|=0;return x}(h);else{if(typeof h!="number")throw new Jn(`Invalid seed input: ${h}`);d=h}return s+Gm(d)()*(c-s)}]});class Km{constructor(t,s,c,h){this.expression=t,this._warningHistory={},this._evaluator=new Zh(c,h),this._defaultValue=s?function(d){return d.type==="color"&&(hf(d.default)||Array.isArray(d.default))?new an(0,0,0,0):d.type==="color"?an.parse(d.default)||null:d.default===void 0?null:d.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Td(t)}evaluateWithoutErrorHandling(t,s,c,h,d,m,x,T){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,h,d,m,x,T){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Jn(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function pf(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Fc}function Uc(l,t,s,c){const h=new Rm(Fc,[],t?function(m){const x={color:es,string:nn,number:Kt,enum:nn,boolean:Wr,formatted:pd,resolvedImage:ya};return m.type==="array"?$i(x[m.value]||Yr,m.length):x[m.type]}(t):void 0,void 0,void 0,s,c),d=h.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Hm(new Km(d,t,s,c)):Ca(h.errors)}class Ym{constructor(t,s,c,h){this.kind=t,this._styleExpression=s,this.isLightConstant=c,this.isLineProgressConstant=h,this.isStateDependent=t!=="constant"&&!Sd(s.expression),this.configDependencies=Td(s.expression)}evaluateWithoutErrorHandling(t,s,c,h,d,m){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,h,d,m)}evaluate(t,s,c,h,d,m){return this._styleExpression.evaluate(t,s,c,h,d,m)}}class Vc{constructor(t,s,c,h,d,m){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Sd(s.expression),this.isLightConstant=d,this.isLineProgressConstant=m,this.configDependencies=Td(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,c,h,d,m){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,h,d,m)}evaluate(t,s,c,h,d,m){return this._styleExpression.evaluate(t,s,c,h,d,m)}interpolationFactor(t,s,c){return this.interpolationType?Ws.interpolationFactor(this.interpolationType,t,s,c):0}}function Jm(l,t,s,c){if((l=Uc(l,t,s,c)).result==="error")return l;const h=l.value.expression,d=Nc(h);if(!d&&!Bc(t))return Ca([new fo("","data expressions not supported")]);const m=Ea(h,["zoom","pitch","distance-from-center"]);if(!m&&!pv(t))return Ca([new fo("","zoom expressions not supported")]);const x=Ea(h,["measure-light"]);if(!x&&!df(t))return Ca([new fo("","measure-light expression not supported")]);const T=Ea(h,["line-progress"]);if(!T&&!function(E){return Wm(E.expression,"line-progress")}(t))return Ca([new fo("","line-progress expression not supported")]);const M=t.expression&&t.expression.relaxZoomRestriction,y=gf(h);return y||m||M?y instanceof fo?Ca([y]):y instanceof Ws&&!Zm(t)?Ca([new fo("",'"interpolate" expressions cannot be used with this property')]):Hm(y?new Vc(d&&T?"camera":"composite",l.value,y.labels,y instanceof Ws?y.interpolation:void 0,x,T):new Ym(d&&T?"constant":"source",l.value,x,T)):Ca([new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mf{constructor(t,s){this._parameters=t,this._specification=s,Kr(this,gv(this._parameters,this._specification))}static deserialize(t){return new mf(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function gf(l){let t=null;if(l instanceof af)t=gf(l.result);else if(l instanceof of){for(const s of l.args)if(t=gf(s),t)break}else(l instanceof ea||l instanceof Ws)&&l.input instanceof hs&&l.input.name==="zoom"&&(t=l);return t instanceof fo||l.eachChild(s=>{const c=gf(s);c instanceof fo?t=c:t&&c&&t!==c&&(t=new fo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Pd,yv,vv=function(){if(yv)return Pd;yv=1,Pd=t;var l=3;function t(s,c,h){var d=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(c=m[1])+2*(h=m[2]);for(var x=0;x<this.d*this.d;x++){var T=m[l+x],M=m[l+x+1];d.push(T===M?null:m.subarray(T,M))}var y=m[l+d.length+1];this.keys=m.subarray(m[l+d.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=c+2*h;for(var E=0;E<this.d*this.d;E++)d.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=s,this.padding=h,this.scale=c/s,this.uid=0;var P=h/c*s;this.min=-P,this.max=s+P}return t.prototype.insert=function(s,c,h,d,m){this._forEachCell(c,h,d,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(m)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(s,c,h,d,m,x){this.cells[m].push(x)},t.prototype.query=function(s,c,h,d,m){var x=this.min,T=this.max;if(s<=x&&c<=x&&T<=h&&T<=d&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(s,c,h,d,this._queryCell,M,{},m),M},t.prototype._queryCell=function(s,c,h,d,m,x,T,M){var y=this.cells[m];if(y!==null)for(var E=this.keys,P=this.bboxes,A=0;A<y.length;A++){var I=y[A];if(T[I]===void 0){var k=4*I;(M?M(P[k+0],P[k+1],P[k+2],P[k+3]):s<=P[k+2]&&c<=P[k+3]&&h>=P[k+0]&&d>=P[k+1])?(T[I]=!0,x.push(E[I])):T[I]=!1}}},t.prototype._forEachCell=function(s,c,h,d,m,x,T,M){for(var y=this._convertToCellCoord(s),E=this._convertToCellCoord(c),P=this._convertToCellCoord(h),A=this._convertToCellCoord(d),I=y;I<=P;I++)for(var k=E;k<=A;k++){var j=this.d*k+I;if((!M||M(this._convertFromCellCoord(I),this._convertFromCellCoord(k),this._convertFromCellCoord(I+1),this._convertFromCellCoord(k+1)))&&m.call(this,s,c,h,d,j,x,T,M))return}},t.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},t.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,c=l+this.cells.length+1+1,h=0,d=0;d<this.cells.length;d++)h+=this.cells[d].length;var m=new Int32Array(c+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,T=0;T<s.length;T++){var M=s[T];m[l+T]=x,m.set(M,x),x+=M.length}return m[l+s.length]=x,m.set(this.keys,x),m[l+s.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},Pd}(),$c=L(vv);const _f={};function Bt(l,t,s={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),_f[t]={klass:l,omit:s.omit||[]}}Bt(Object,"Object"),$c.serialize=function(l,t){const s=l.toArrayBuffer();return t&&t.add(s),{buffer:s}},$c.deserialize=function(l){return new $c(l.buffer)},Object.defineProperty($c,"name",{value:"Grid"}),Bt($c,"Grid"),typeof DOMMatrix<"u"&&Bt(DOMMatrix,"DOMMatrix"),Bt(an,"Color"),Bt(Error,"Error"),Bt(ts,"Formatted"),Bt(md,"FormattedSection"),Bt(zi,"AJAXError"),Bt(rs,"ResolvedImage"),Bt(mf,"StylePropertyFunction"),Bt(Km,"StyleExpression",{omit:["_evaluator"]}),Bt(ws,"ImageId"),Bt(Qo,"ImageVariant"),Bt(Vc,"ZoomDependentExpression"),Bt(Ym,"ZoomConstantExpression"),Bt(hs,"CompoundExpression",{omit:["_evaluate"]});for(const l in Fc)_f[Fc[l]._classRegistryKey]||Bt(Fc[l],`Expression${l}`);function Qm(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function eg(l){return self.ImageBitmap&&l instanceof ImageBitmap}function dl(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Qm(l)||eg(l))return t&&t.add(l),l;if(ArrayBuffer.isView(l))return t&&t.add(l.buffer),l;if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){const s=[];for(const c of l)s.push(dl(c,t));return s}if(l instanceof Map){const s={$name:"Map",entries:[]};for(const[c,h]of l.entries())s.entries.push(dl(c),dl(h));return s}if(l instanceof Set){const s={$name:"Set"};let c=0;for(const h of l.values())s[++c]=dl(h);return s}if(l instanceof DOMMatrix){const s={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of c)s[h]=l[h];return s}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const s=l.constructor,c=s._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const h=s.serialize?s.serialize(l,t):{};if(!s.serialize){for(const d in l)l.hasOwnProperty(d)&&(_f[c].omit.indexOf(d)>=0||(h[d]=dl(l[d],t)));l instanceof Error&&(h.message=l.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof l)}function Zs(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Qm(l)||eg(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Zs);if(typeof l=="object"){const t=l.$name||"Object";if(t==="Map"){const h=l.entries||[],d=new Map;for(let m=0;m<h.length;m+=2)d.set(Zs(h[m]),Zs(h[m+1]));return d}if(t==="Set"){const h=new Set;for(const d of Object.keys(l))d!=="$name"&&h.add(Zs(l[d]));return h}if(t==="DOMMatrix"){let h;return h=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(h)}if(t==="BigInt")return BigInt(l.value);const{klass:s}=_f[t];if(!s)throw new Error(`Can't deserialize unregistered class "${t}".`);if(s.deserialize)return s.deserialize(l);const c=Object.create(s.prototype);for(const h of Object.keys(l))h!=="$name"&&(c[h]=Zs(l[h]));return c}throw new Error("can't deserialize object of type "+typeof l)}const er={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function tg(l){for(const t of l)if(yf(t.charCodeAt(0)))return!0;return!1}function Zb(l){for(const t of l)if(!xv(t.charCodeAt(0)))return!1;return!0}function xv(l){return!(er.Arabic(l)||er["Arabic Supplement"](l)||er["Arabic Extended-A"](l)||er["Arabic Presentation Forms-A"](l)||er["Arabic Presentation Forms-B"](l))}function yf(l){return!(l!==746&&l!==747&&(l<4352||!(er["Bopomofo Extended"](l)||er.Bopomofo(l)||er["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||er["CJK Compatibility Ideographs"](l)||er["CJK Compatibility"](l)||er["CJK Radicals Supplement"](l)||er["CJK Strokes"](l)||!(!er["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||er["CJK Unified Ideographs Extension A"](l)||er["CJK Unified Ideographs"](l)||er["Enclosed CJK Letters and Months"](l)||er["Hangul Compatibility Jamo"](l)||er["Hangul Jamo Extended-A"](l)||er["Hangul Jamo Extended-B"](l)||er["Hangul Jamo"](l)||er["Hangul Syllables"](l)||er.Hiragana(l)||er["Ideographic Description Characters"](l)||er.Kanbun(l)||er["Kangxi Radicals"](l)||er["Katakana Phonetic Extensions"](l)||er.Katakana(l)&&l!==12540||!(!er["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!er["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||er["Unified Canadian Aboriginal Syllabics"](l)||er["Unified Canadian Aboriginal Syllabics Extended"](l)||er["Vertical Forms"](l)||er["Yijing Hexagram Symbols"](l)||er["Yi Syllables"](l)||er["Yi Radicals"](l))))}function rg(l){return!(yf(l)||function(t){return!!(er["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||er["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||er["Letterlike Symbols"](t)||er["Number Forms"](t)||er["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||er["Control Pictures"](t)&&t!==9251||er["Optical Character Recognition"](t)||er["Enclosed Alphanumerics"](t)||er["Geometric Shapes"](t)||er["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||er["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||er["CJK Symbols and Punctuation"](t)||er.Katakana(t)||er["Private Use Area"](t)||er["CJK Compatibility Forms"](t)||er["Small Form Variants"](t)||er["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(l))}function bv(l){return er.Arabic(l)||er["Arabic Supplement"](l)||er["Arabic Extended-A"](l)||er["Arabic Presentation Forms-A"](l)||er["Arabic Presentation Forms-B"](l)}function vf(l){return l>=1424&&l<=2303||er["Arabic Presentation Forms-A"](l)||er["Arabic Presentation Forms-B"](l)}function ng(l,t){return!(!t&&vf(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||er.Khmer(l))}function wv(l){for(const t of l)if(vf(t.charCodeAt(0)))return!0;return!1}const ig="deferred",ta="loading",sg="loaded";let og=null,Ss="unavailable",hl=null;const Rd=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Ss="error"),og&&og(l)};function xf(){Gc.fire(new Ps("pluginStateChange",{pluginStatus:Ss,pluginURL:hl}))}const Gc=new Po,bf=function(){return Ss},Sv=function(){if(Ss!==ig||!hl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ss=ta,xf(),hl&&ga({url:hl},l=>{l?Rd(l):(Ss=sg,xf())})},mo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ss===sg||mo.applyArabicShaping!=null,isLoading:()=>Ss===ta,setState(l){Ss=l.pluginStatus,hl=l.pluginURL},isParsed:()=>mo.applyArabicShaping!=null&&mo.processBidirectionalText!=null&&mo.processStyledBidirectionalText!=null,getPluginURL:()=>hl};class _n{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(s,c){for(const h of s)if(!ng(h.charCodeAt(0),c))return!1;return!0}(t,mo.isLoaded())}}class qc{constructor(t,s,c,h){this.property=t,this.value=s,this.expression=function(d,m,x,T){if(hf(d))return new mf(d,m);if(pf(d)||Array.isArray(d)&&d.length>0){const M=Jm(d,m,x,T);if(M.result==="error")throw new Error(M.value.map(y=>`${y.key}: ${y.message}`).join(", "));return M.value}{let M=d;return typeof d=="string"&&m.type==="color"&&(M=an.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(s===void 0?t.specification.default:s,t.specification,c,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class ag{constructor(t,s,c){this.property=t,this.value=new qc(t,void 0,s,c)}transitioned(t,s){return new wf(this.property,this.value,s,gi({},t.transition,this.transition),t.now)}untransitioned(){return new wf(this.property,this.value,null,{},0)}}class lg{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return Oi(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new ag(this._values[t].property,this._scope,this._options)),this._values[t].value=new qc(this._values[t].property,s===null?void 0:Oi(s),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,s){s&&(this._options=s);const c=this._properties.properties;if(t)for(const h in t){const d=t[h];if(h.endsWith("-transition")){const m=h.slice(0,-11);c[m]&&this.setTransition(m,d)}else c.hasOwnProperty(h)&&this.setValue(h,d)}}getTransition(t){return Oi(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new ag(this._values[t].property)),this._values[t].transition=Oi(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const h=this.getTransition(s);h!==void 0&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const c=new kd(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(t,s._values[h]);return c}untransitioned(){const t=new kd(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class wf{constructor(t,s,c,h,d){const m=h.delay||0,x=h.duration||0;d=d||0,this.property=t,this.value=s,this.begin=d+m,this.end=this.begin+x,t.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const h=t.now||0,d=this.value.possiblyEvaluate(t,s,c),m=this.prior;if(m){if(h>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(h<this.begin)return m.possiblyEvaluate(t,s,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,s,c),d,ys(x))}}return d}}class kd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const h=new Zc(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,s,c);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Hc{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return Oi(this._values[t].value)}setValue(t,s){this._values[t]=new qc(this._values[t].property,s===null?void 0:Oi(s),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const h=new Zc(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,s,c);return h}}class Wc{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,h){return this.property.evaluate(this.value,this.parameters,t,s,c,h)}}class Zc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class It{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,c){const h=fd[this.specification.type];return h?h(t,s,c):t}}class Ft{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,h){return new Wc(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,h)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Wc(this,{kind:"constant",value:void 0},t.parameters);const h=fd[this.specification.type];return h?new Wc(this,{kind:"constant",value:h(t.value.value,s.value.value,c)},t.parameters):t}evaluate(t,s,c,h,d,m){return t.kind==="constant"?t.value:t.evaluate(s,c,h,d,m)}}class Xc{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,h){return!!t.expression.evaluate(s,null,{},c,h)}interpolate(){return!1}}class Fn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new _n(0,{});for(const c in t){const h=t[c];h.specification.overridable&&this.overridableProperties.push(c);const d=this.defaultPropertyValues[c]=new qc(h,void 0),m=this.defaultTransitionablePropertyValues[c]=new ag(h);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=d.possiblyEvaluate(s)}}}Bt(Ft,"DataDrivenProperty"),Bt(It,"DataConstantProperty"),Bt(Xc,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Tv(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Sf(l){if(Array.isArray(l))return l.map(Sf);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const t={};for(const s in l)t[s]=Sf(l[s]);return t}return Tv(l)}function cg(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const t of l.slice(1))if(!cg(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function ug(l,t="",s=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};cg(l)||(l=Tf(l));const h=l;let d=!0;try{d=function(y){if(!Kc(y))return y;let E=Sf(y);return Cv(E),E=Ev(E),E}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let m=null,x=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){x=Ye[`filter_${c}`];const y=Uc(d,x,t,s);if(y.result==="error")throw new Error(y.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,P,A)=>y.value.evaluate(E,P,{},A)}let T=null,M=null;if(d!==h){const y=Uc(h,x,t,s);if(y.result==="error")throw new Error(y.value.map(E=>`${E.key}: ${E.message}`).join(", "));T=(E,P,A,I,k)=>y.value.evaluate(E,P,{},A,void 0,void 0,I,k),M=!Nc(y.value.expression)}return{filter:m,dynamicFilter:T||void 0,needGeometry:Av(d),needFeature:!!M}}function Ev(l){if(!Array.isArray(l))return l;const t=function(s){if(Xb.has(s[0])){for(let c=1;c<s.length;c++)if(Kc(s[c]))return!0}return s}(l);return t===!0?t:t.map(s=>Ev(s))}function Cv(l){let t=!1;const s=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)t=t||Kc(l[c]),s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="match"){t=t||Kc(l[1]);for(let c=2;c<l.length-1;c+=2)s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="step"){t=t||Kc(l[1]);for(let c=1;c<l.length-1;c+=2)s.push(l[c+1])}t&&(l.length=0,l.push("any",...s));for(let c=1;c<l.length;c++)Cv(l[c])}function Kc(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<l.length;s++)if(Kc(l[s]))return!0;return!1}const Xb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Kb(l,t){return l<t?-1:l>t?1:0}function Av(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(Av(l[t]))return!0;return!1}function Tf(l){if(!l)return!0;const t=l[0];return l.length<=1?t!=="any":t==="=="?fl(l[1],l[2],"=="):t==="!="?Hl(fl(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?fl(l[1],l[2],t):t==="any"?(s=l.slice(1),["any"].concat(s.map(Tf))):t==="all"?["all"].concat(l.slice(1).map(Tf)):t==="none"?["all"].concat(l.slice(1).map(Tf).map(Hl)):t==="in"?dg(l[1],l.slice(2)):t==="!in"?Hl(dg(l[1],l.slice(2))):t==="has"?hg(l[1]):t!=="!has"||Hl(hg(l[1]));var s}function fl(l,t,s){switch(l){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,l,t]}}function dg(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",l,["literal",t.sort(Kb)]]:["filter-in-small",l,["literal",t]]}}function hg(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Hl(l){return["!",l]}const Ef="";function Yc(l,t){return t?`${l}${Ef}${t}`:l}const Aa="-transition",Mv=new Set(["fill","line","background","hillshade","raster"]);class ki extends Po{constructor(t,s,c,h,d){if(super(),this.id=t.id,this.fqid=Yc(this.id,c),this.type=t.type,this.scope=c,this.lut=h,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const m=Uc(this.filter,Ye[`filter_${t.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),s.layout&&(this._unevaluatedLayout=new Hc(s.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new lg(s.paint,this.scope,d);for(const m in t.paint)this.setPaintProperty(m,t.paint[m]);for(const m in t.layout)this.setLayoutProperty(m,t.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zc(s.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&Mv.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s){if(this.type==="custom"&&t==="visibility")return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(Aa)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s){const c=this._transitionablePaint,h=c._properties.properties;if(t.endsWith(Aa)){const E=t.slice(0,-11);return h[E]&&c.setTransition(E,s||void 0),!1}if(!h[t])return!1;const d=c._values[t],m=d.value.isDataDriven(),x=d.value;c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const T=c._values[t].value,M=T.isDataDriven(),y=t.endsWith("pattern")||t==="line-dasharray";return M||m||y||this._handleOverridablePaintPropertyUpdate(t,x,T)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,s,c){return null}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){return $s({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,s)=>!(t===void 0||s==="layout"&&!Object.keys(t).length||s==="paint"&&!Object.keys(t).length))}is3D(t){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Wc&&Bc(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=ug(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,s,c,h,d,m,x,T,M){}}const Yb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dd{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Jr(l,t=1){let s=0,c=0;return{members:l.map(h=>{const d=Yb[h.type].BYTES_PER_ELEMENT,m=s=Iv(s,Math.max(t,d)),x=h.components||1;return c=Math.max(c,d),s+=d*x,{name:h.name,type:h.type,components:x,offset:m}}),size:Iv(s,Math.max(c,t)),alignment:t}}function Iv(l,t){return Math.ceil(l/t)*t}class Ma extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=c,t}}Ma.prototype.bytesPerElement=4,Bt(Ma,"StructArrayLayout2i4");class Jc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const d=3*t;return this.int16[d+0]=s,this.int16[d+1]=c,this.int16[d+2]=h,t}}Jc.prototype.bytesPerElement=6,Bt(Jc,"StructArrayLayout3i6");class Ia extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,c,h)}emplace(t,s,c,h,d){const m=4*t;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=h,this.int16[m+3]=d,t}}Ia.prototype.bytesPerElement=8,Bt(Ia,"StructArrayLayout4i8");class Wl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}Wl.prototype.bytesPerElement=4,Bt(Wl,"StructArrayLayout1f4");class Ld extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const d=4*t,m=2*t;return this.int16[d+0]=s,this.int16[d+1]=c,this.float32[m+1]=h,t}}Ld.prototype.bytesPerElement=8,Bt(Ld,"StructArrayLayout2i1f8");class fg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const d=4*t;return this.int16[d+0]=s,this.int16[d+1]=c,this.int16[d+2]=h,t}}fg.prototype.bytesPerElement=8,Bt(fg,"StructArrayLayout3i8");class go extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,h,d)}emplace(t,s,c,h,d,m){const x=5*t;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=h,this.int16[x+3]=d,this.int16[x+4]=m,t}}go.prototype.bytesPerElement=10,Bt(go,"StructArrayLayout5i10");class pg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,h,d,m,x)}emplace(t,s,c,h,d,m,x,T){const M=6*t,y=12*t,E=3*t;return this.int16[M+0]=s,this.int16[M+1]=c,this.uint8[y+4]=h,this.uint8[y+5]=d,this.uint8[y+6]=m,this.uint8[y+7]=x,this.float32[E+2]=T,t}}pg.prototype.bytesPerElement=12,Bt(pg,"StructArrayLayout2i4ub1f12");class Lo extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const d=3*t;return this.float32[d+0]=s,this.float32[d+1]=c,this.float32[d+2]=h,t}}Lo.prototype.bytesPerElement=12,Bt(Lo,"StructArrayLayout3f12");class pl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,h,d)}emplace(t,s,c,h,d,m){const x=6*t,T=3*t;return this.uint16[x+0]=s,this.uint16[x+1]=c,this.uint16[x+2]=h,this.uint16[x+3]=d,this.float32[T+2]=m,t}}pl.prototype.bytesPerElement=12,Bt(pl,"StructArrayLayout4ui1f12");class Cf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,c,h)}emplace(t,s,c,h,d){const m=4*t;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=h,this.uint16[m+3]=d,t}}Cf.prototype.bytesPerElement=8,Bt(Cf,"StructArrayLayout4ui8");class Af extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,h,d,m)}emplace(t,s,c,h,d,m,x){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+3]=d,this.int16[T+4]=m,this.int16[T+5]=x,t}}Af.prototype.bytesPerElement=12,Bt(Af,"StructArrayLayout6i12");class mg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,s,c,h,d,m,x,T,M,y,E,P)}emplace(t,s,c,h,d,m,x,T,M,y,E,P,A){const I=12*t;return this.int16[I+0]=s,this.int16[I+1]=c,this.int16[I+2]=h,this.int16[I+3]=d,this.uint16[I+4]=m,this.uint16[I+5]=x,this.uint16[I+6]=T,this.uint16[I+7]=M,this.int16[I+8]=y,this.int16[I+9]=E,this.int16[I+10]=P,this.int16[I+11]=A,t}}mg.prototype.bytesPerElement=24,Bt(mg,"StructArrayLayout4i4ui4i24");class gg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,h,d,m)}emplace(t,s,c,h,d,m,x){const T=10*t,M=5*t;return this.int16[T+0]=s,this.int16[T+1]=c,this.int16[T+2]=h,this.float32[M+2]=d,this.float32[M+3]=m,this.float32[M+4]=x,t}}gg.prototype.bytesPerElement=20,Bt(gg,"StructArrayLayout3i3f20");class Zl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,c,h)}emplace(t,s,c,h,d){const m=4*t;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=h,this.float32[m+3]=d,t}}Zl.prototype.bytesPerElement=16,Bt(Zl,"StructArrayLayout4f16");class _g extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}_g.prototype.bytesPerElement=4,Bt(_g,"StructArrayLayout1ul4");class ml extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=c,t}}ml.prototype.bytesPerElement=4,Bt(ml,"StructArrayLayout2ui4");class yg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E,P,A){const I=this.length;return this.resize(I+1),this.emplace(I,t,s,c,h,d,m,x,T,M,y,E,P,A)}emplace(t,s,c,h,d,m,x,T,M,y,E,P,A,I){const k=20*t,j=10*t;return this.int16[k+0]=s,this.int16[k+1]=c,this.int16[k+2]=h,this.int16[k+3]=d,this.int16[k+4]=m,this.float32[j+3]=x,this.float32[j+4]=T,this.float32[j+5]=M,this.float32[j+6]=y,this.int16[k+14]=E,this.uint32[j+8]=P,this.uint16[k+18]=A,this.uint16[k+19]=I,t}}yg.prototype.bytesPerElement=40,Bt(yg,"StructArrayLayout5i4f1i1ul2ui40");class Nd extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,h,d,m,x)}emplace(t,s,c,h,d,m,x,T){const M=8*t;return this.int16[M+0]=s,this.int16[M+1]=c,this.int16[M+2]=h,this.int16[M+4]=d,this.int16[M+5]=m,this.int16[M+6]=x,this.int16[M+7]=T,t}}Nd.prototype.bytesPerElement=16,Bt(Nd,"StructArrayLayout3i2i2i16");class vg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,h,d)}emplace(t,s,c,h,d,m){const x=4*t,T=8*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[T+6]=d,this.int16[T+7]=m,t}}vg.prototype.bytesPerElement=16,Bt(vg,"StructArrayLayout2f1f2i16");class xg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,h,d,m)}emplace(t,s,c,h,d,m,x){const T=20*t,M=5*t;return this.uint8[T+0]=s,this.uint8[T+1]=c,this.float32[M+1]=h,this.float32[M+2]=d,this.float32[M+3]=m,this.float32[M+4]=x,t}}xg.prototype.bytesPerElement=20,Bt(xg,"StructArrayLayout2ub4f20");class ji extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c)}emplace(t,s,c,h){const d=3*t;return this.uint16[d+0]=s,this.uint16[d+1]=c,this.uint16[d+2]=h,t}}ji.prototype.bytesPerElement=6,Bt(ji,"StructArrayLayout3ui6");class Mf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y)}emplace(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y,ne){const oe=30*t,ye=15*t,pe=60*t;return this.int16[oe+0]=s,this.int16[oe+1]=c,this.int16[oe+2]=h,this.float32[ye+2]=d,this.float32[ye+3]=m,this.uint16[oe+8]=x,this.uint16[oe+9]=T,this.uint32[ye+5]=M,this.uint32[ye+6]=y,this.uint32[ye+7]=E,this.uint16[oe+16]=P,this.uint16[oe+17]=A,this.uint16[oe+18]=I,this.float32[ye+10]=k,this.float32[ye+11]=j,this.uint8[pe+48]=F,this.uint8[pe+49]=W,this.uint8[pe+50]=H,this.uint32[ye+13]=$,this.int16[oe+28]=Y,this.uint8[pe+58]=ne,t}}Mf.prototype.bytesPerElement=60,Bt(Mf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class If extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe,Le,Fe,je){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe,Le,Fe,je)}emplace(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H,$,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe,Le,Fe,je,Xe){const $e=20*t,Ke=40*t,xt=80*t;return this.float32[$e+0]=s,this.float32[$e+1]=c,this.int16[Ke+4]=h,this.int16[Ke+5]=d,this.int16[Ke+6]=m,this.int16[Ke+7]=x,this.int16[Ke+8]=T,this.int16[Ke+9]=M,this.int16[Ke+10]=y,this.int16[Ke+11]=E,this.int16[Ke+12]=P,this.uint16[Ke+13]=A,this.uint16[Ke+14]=I,this.uint16[Ke+15]=k,this.uint16[Ke+16]=j,this.uint16[Ke+17]=F,this.uint16[Ke+18]=W,this.uint16[Ke+19]=H,this.uint16[Ke+20]=$,this.uint16[Ke+21]=Y,this.uint16[Ke+22]=ne,this.uint16[Ke+23]=oe,this.uint16[Ke+24]=ye,this.uint16[Ke+25]=pe,this.uint16[Ke+26]=me,this.uint16[Ke+27]=Me,this.uint32[$e+14]=ve,this.float32[$e+15]=Ie,this.float32[$e+16]=Oe,this.float32[$e+17]=Le,this.float32[$e+18]=Fe,this.uint8[xt+76]=je,this.uint16[Ke+39]=Xe,t}}If.prototype.bytesPerElement=80,Bt(If,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Rs extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c,h,d)}emplace(t,s,c,h,d,m){const x=5*t;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=h,this.float32[x+3]=d,this.float32[x+4]=m,t}}Rs.prototype.bytesPerElement=20,Bt(Rs,"StructArrayLayout5f20");class Pf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,h,d,m,x)}emplace(t,s,c,h,d,m,x,T){const M=7*t;return this.float32[M+0]=s,this.float32[M+1]=c,this.float32[M+2]=h,this.float32[M+3]=d,this.float32[M+4]=m,this.float32[M+5]=x,this.float32[M+6]=T,t}}Pf.prototype.bytesPerElement=28,Bt(Pf,"StructArrayLayout7f28");class bg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,c,h,d,m,x,T,M,y,E)}emplace(t,s,c,h,d,m,x,T,M,y,E,P){const A=11*t;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=h,this.float32[A+3]=d,this.float32[A+4]=m,this.float32[A+5]=x,this.float32[A+6]=T,this.float32[A+7]=M,this.float32[A+8]=y,this.float32[A+9]=E,this.float32[A+10]=P,t}}bg.prototype.bytesPerElement=44,Bt(bg,"StructArrayLayout11f44");class wg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,c,h,d,m,x,T,M)}emplace(t,s,c,h,d,m,x,T,M,y){const E=9*t;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=h,this.float32[E+3]=d,this.float32[E+4]=m,this.float32[E+5]=x,this.float32[E+6]=T,this.float32[E+7]=M,this.float32[E+8]=y,t}}wg.prototype.bytesPerElement=36,Bt(wg,"StructArrayLayout9f36");class Qc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=c,t}}Qc.prototype.bytesPerElement=8,Bt(Qc,"StructArrayLayout2f8");class Od extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,s,c,h)}emplace(t,s,c,h,d){const m=6*t;return this.uint32[3*t+0]=s,this.uint16[m+2]=c,this.uint16[m+3]=h,this.uint16[m+4]=d,t}}Od.prototype.bytesPerElement=12,Bt(Od,"StructArrayLayout1ul3ui12");class Rf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Rf.prototype.bytesPerElement=2,Bt(Rf,"StructArrayLayout1ui2");class kf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j){const F=this.length;return this.resize(F+1),this.emplace(F,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j)}emplace(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F){const W=16*t;return this.float32[W+0]=s,this.float32[W+1]=c,this.float32[W+2]=h,this.float32[W+3]=d,this.float32[W+4]=m,this.float32[W+5]=x,this.float32[W+6]=T,this.float32[W+7]=M,this.float32[W+8]=y,this.float32[W+9]=E,this.float32[W+10]=P,this.float32[W+11]=A,this.float32[W+12]=I,this.float32[W+13]=k,this.float32[W+14]=j,this.float32[W+15]=F,t}}kf.prototype.bytesPerElement=64,Bt(kf,"StructArrayLayout16f64");class Df extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,h,d,m,x){const T=this.length;return this.resize(T+1),this.emplace(T,t,s,c,h,d,m,x)}emplace(t,s,c,h,d,m,x,T){const M=10*t,y=5*t;return this.uint16[M+0]=s,this.uint16[M+1]=c,this.uint16[M+2]=h,this.uint16[M+3]=d,this.float32[y+2]=m,this.float32[y+3]=x,this.float32[y+4]=T,t}}Df.prototype.bytesPerElement=20,Bt(Df,"StructArrayLayout4ui3f20");class Lf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.int16[1*t+0]=s,t}}Lf.prototype.bytesPerElement=2,Bt(Lf,"StructArrayLayout1i2");class Sg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint8[1*t+0]=s,t}}Sg.prototype.bytesPerElement=1,Bt(Sg,"StructArrayLayout1ub1");class Tg extends Dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Tg.prototype.size=40;class zd extends yg{get(t){return new Tg(this,t)}}Bt(zd,"CollisionBoxArray");class Pv extends Dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Pv.prototype.size=60;class Rv extends Mf{get(t){return new Pv(this,t)}}Bt(Rv,"PlacedSymbolArray");class kv extends Dd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}kv.prototype.size=80;class Dv extends If{get(t){return new kv(this,t)}}Bt(Dv,"SymbolInstanceArray");class Lv extends Wl{getoffsetX(t){return this.float32[1*t+0]}}Bt(Lv,"GlyphOffsetArray");class jd extends Ma{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Bt(jd,"SymbolLineVertexArray");class Fd extends Dd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fd.prototype.size=12;class ks extends Od{get(t){return new Fd(this,t)}}Bt(ks,"FeatureIndexArray");class Bd extends ml{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Bt(Bd,"FillExtrusionCentroidArray");class Nv extends Dd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Nv.prototype.size=6;class Ov extends Jc{get(t){return new Nv(this,t)}}Bt(Ov,"FillExtrusionWallArray");const Jb=Jr([{name:"a_pos",components:2,type:"Int16"}],4),Qb=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Rn{constructor(t=[]){this.segments=t}_prepareSegment(t,s,c,h){let d=this.segments[this.segments.length-1];return t>Rn.MAX_VERTEX_ARRAY_LENGTH&&Cn(`Max vertices per segment is ${Rn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>Rn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==h)&&(d={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},h!==void 0&&(d.sortKey=h),this.segments.push(d)),d}prepareSegment(t,s,c,h){return this._prepareSegment(t,s.length,c.length,h)}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,h){return new Rn([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function zv(l,t){return 256*(l=Tr(Math.floor(l),0,255))+Tr(Math.floor(t),0,255)}Rn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(Rn,"SegmentVector");const Eg=Jr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ew=Jr([{name:"a_dash",components:4,type:"Uint16"}]);class Ud{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,s,c,h){this.ids.push(Cg(t)),this.positions.push(s,c,h)}eachPosition(t,s){const c=Cg(t);let h=0,d=this.ids.length-1;for(;h<d;){const m=h+d>>1;this.ids[m]>=c?d=m:h=m+1}for(;this.ids[h]===c;)s(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,s){const c=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Vd(c,h,0,c.length-1),s&&(s.add(c.buffer),s.add(h.buffer)),{ids:c,positions:h}}static deserialize(t){const s=new Ud;let c;s.ids=t.ids,s.positions=t.positions;for(const h of s.ids)h!==c&&s.uniqueIds.push(h),c=h;return s.indexed=!0,s}}function Cg(l){const t=+l;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:qs(String(l))}function Vd(l,t,s,c){for(;s<c;){const h=l[s+c>>1];let d=s-1,m=c+1;for(;;){do d++;while(l[d]<h);do m--;while(l[m]>h);if(d>=m)break;Nf(l,d,m),Nf(t,3*d,3*m),Nf(t,3*d+1,3*m+1),Nf(t,3*d+2,3*m+2)}m-s<c-m?(Vd(l,t,s,m),s=m+1):(Vd(l,t,m+1,c),c=m)}}function Nf(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}Bt(Ud,"FeaturePositionMap");class ra{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}set(t,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class $d extends ra{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Qn extends ra{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class _o extends ra{constructor(t){super(t),this.current=[0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class eu extends ra{constructor(t){super(t),this.current=[0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Gd extends ra{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class jv extends ra{constructor(t){super(t),this.current=an.transparent.toRenderColor(null)}set(t,s,c){this.fetchUniformLocation(t,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Fv=new Float32Array(16);class qd extends ra{constructor(t){super(t),this.current=Fv}set(t,s,c){if(this.fetchUniformLocation(t,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Ag=new Float32Array(9),tw=new Float32Array(4);class Mg extends ra{constructor(t){super(t),this.current=tw}set(t,s,c){if(this.fetchUniformLocation(t,s)){for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function Ig(l){return[zv(255*l.r,255*l.g),zv(255*l.b,255*l.a)]}class Hd{constructor(t,s,c,h){this.value=t,this.uniformNames=s.map(d=>`u_${d}`),this.type=c,this.context=h}setUniform(t,s,c,h,d){const m=h.constantOr(this.value);s.set(t,d,m instanceof an?m.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(t,s){return this.type==="color"?new jv(t):new Qn(t)}}class Xl{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,s,c,h,d){const m=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;m&&s.set(t,d,m)}getBinding(t,s){return s==="u_pattern"||s==="u_dash"?new Gd(t):new Qn(t)}}class Pa{constructor(t,s,c,h){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(d=>({name:`a_${d}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,c,h,d,m,x){const T=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new _n(0,{brightness:m}),s,{},d,h,x):this.expression.kind==="constant"&&this.expression.value,y=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _n(0,{brightness:m}),s,{},d,h,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(t),this._setPaintValue(T,t,M,y?null:this.context.lut)}updatePaintArray(t,s,c,h,d,m,x){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x},c,h,void 0,d):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _n(0,{brightness:x}),c,h,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(t,s,T,M?null:this.context.lut)}_setPaintValue(t,s,c,h){if(this.type==="color"){const d=Ig(c.toRenderColor(h));for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=t;d<s;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class No{constructor(t,s,c,h,d,m){this.expression=t,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.context=d,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,s,c,h,d,m,x){const T=this.expression.evaluate(new _n(this.context.zoom,{brightness:m}),s,{},d,h,x),M=this.expression.evaluate(new _n(this.context.zoom+1,{brightness:m}),s,{},d,h,x),y=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _n(0,{brightness:m}),s,{},d,h,x):this.lutExpression.value)==="none",E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,T,M,y?null:this.context.lut)}updatePaintArray(t,s,c,h,d,m,x){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,h,void 0,d),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,h,void 0,d),y=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new _n(0,{brightness:x}),c,h,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(t,s,T,M,y?null:this.context.lut)}_setPaintValue(t,s,c,h,d){if(this.type==="color"){const m=Ig(c.toRenderColor(d)),x=Ig(c.toRenderColor(d));for(let T=t;T<s;T++)this.paintVertexArray.emplace(T,m[0],m[1],x[0],x[1])}else{for(let m=t;m<s;m++)this.paintVertexArray.emplace(m,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,c,h,d){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=Tr(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(t,d,x)}getBinding(t,s){return new Qn(t)}}class gl{constructor(t,s,c,h,d){this.expression=t,this.layerId=d,this.paintVertexAttributes=(c==="array"?ew:Eg).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new h}populatePaintArray(t,s,c,h){const d=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(d,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,h,d,m,x){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(t,s,c,h){if(!h||!c)return;const d=h[c];if(!d)return;const{tl:m,br:x,pixelRatio:T}=d;for(let M=t;M<s;M++)this.paintVertexArray.emplace(M,m[0],m[1],x[0],x[1],T)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kl{constructor(t,s,c=()=>!0){this.binders={},this._buffers=[],this.context=s;const h=[];for(const d in t.paint._values){const m=t.paint.get(d);if(d.endsWith("-use-theme")||!c(d)||!(m instanceof Wc&&Bc(m.property.specification)))continue;const x=nw(d,t.type),T=m.value,M=m.property.specification.type,y=!!m.property.useIntegerZoom,E=d==="line-dasharray"||d.endsWith("pattern"),P=t.paint.get(`${d}-use-theme`),A=d==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(T.kind!=="constant"||A)if(T.kind==="source"||A||E){const I=Bv(d,M,"source");this.binders[d]=E?new gl(T,x,M,I,t.id):new Pa(T,x,M,I),h.push(`/a_${d}`)}else{const I=Bv(d,M,"composite");this.binders[d]=new No(T,x,M,y,s,I),h.push(`/z_${d}`)}else this.binders[d]=E?new Xl(T.value,x):new Hd(T.value,x,M,s),h.push(`/u_${d}`);P&&(this.binders[d].lutExpression=P.value)}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Pa||s instanceof No?s.maxValue:0}populatePaintArrays(t,s,c,h,d,m,x){for(const T in this.binders){const M=this.binders[T];M.context=this.context,(M instanceof Pa||M instanceof No||M instanceof gl)&&M.populatePaintArray(t,s,c,h,d,m,x)}}setConstantPatternPositions(t){for(const s in this.binders){const c=this.binders[s];c instanceof Xl&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,s,c,h,d,m,x,T,M){let y=!1;const E=Object.keys(t),P=E.length!==0&&!T,A=P?E:s.uniqueIds;this.context.lut=d.lut;for(const I in this.binders){const k=this.binders[I];if(k.context=this.context,(k instanceof Pa||k instanceof No||k instanceof gl)&&k.expression&&k.expression.kind&&k.expression.kind!=="constant"&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){const j=d.paint.get(I);k.expression=j.value;for(const F of A){const W=t[F.toString()];s.eachPosition(F,(H,$,Y)=>{const ne=h.feature(H);k.updatePaintArray($,Y,ne,W,m,x,M)})}if(!P)for(const F of c.uniqueIds){const W=t[F.toString()];c.eachPosition(F,(H,$,Y)=>{const ne=h.feature(H);k.updatePaintArray($,Y,ne,W,m,x,M)})}y=!0}}return y}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Hd||c instanceof Xl)&&t.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Pa||c instanceof No||c instanceof gl)for(let h=0;h<c.paintVertexAttributes.length;h++)t.push(c.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Hd||c instanceof Xl||c instanceof No)for(const h of c.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Hd||h instanceof Xl||h instanceof No)for(const d of h.uniformNames)s.push({name:d,property:c,binding:h.getBinding(t,d)})}return s}setUniforms(t,s,c,h,d){for(const{name:m,property:x,binding:T}of c)this.binders[x].setUniform(t,T,d,h.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const s=this.binders[t];(s instanceof Pa||s instanceof No||s instanceof gl)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof Pa||c instanceof No||c instanceof gl)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Pa||s instanceof No||s instanceof gl)&&s.destroy()}}}class _l{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Kl(h,s,c);this.needsUpload=!1,this._featureMap=new Ud,this._featureMapWithoutIds=new Ud,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,s,c,h,d,m,x,T){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(t,s,h,d,m,x,T);s.id!==void 0?this._featureMap.add(s.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,h,d,m,x){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,s,T,h,d,m,x||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const rw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nw(l,t){return rw[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}const iw={"line-pattern":{source:pl,composite:pl},"fill-pattern":{source:pl,composite:pl},"fill-extrusion-pattern":{source:pl,composite:pl},"line-dasharray":{source:Cf,composite:Cf}},Of={color:{source:Qc,composite:Zl},number:{source:Wl,composite:Qc}};function Bv(l,t,s){const c=iw[l];return c&&c[s]||Of[t][s]}Bt(Hd,"ConstantBinder"),Bt(Xl,"PatternConstantBinder"),Bt(Pa,"SourceExpressionBinder"),Bt(gl,"PatternCompositeBinder"),Bt(No,"CompositeExpressionBinder"),Bt(Kl,"ProgramConfiguration",{omit:["_buffers"]}),Bt(_l,"ProgramConfigurationSet");const fs=Rt/Math.PI/2,tu=5,Uv=6,Vv=16383,ru=64,zf=[ru,32,16],Xs=-fs,Ks=fs;function nu(l,t,s,c=fs){return s=wr(s),[l*Math.sin(s)*c,-t*c,l*Math.cos(s)*c]}function Yl(l,t,s){return nu(Math.cos(wr(l)),Math.sin(wr(l)),t,s)}const Jl=63710088e-1,Pg=2*Math.PI*Jl;class Qr{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qr(Is(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,h=t.lat*s,d=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return Jl*Math.acos(Math.min(d,1))}toBounds(t=0){const s=360*t/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new yl({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(t){return Yl(this.lat,this.lng,fs+t*fs/Jl)}static convert(t){if(t instanceof Qr)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Qr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Qr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yl{constructor(t,s){if(t)if(s)this.setSouthWest(t).setNorthEast(s);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof Qr?new Qr(t.lng,t.lat):Qr.convert(t),this}setSouthWest(t){return this._sw=t instanceof Qr?new Qr(t.lng,t.lat):Qr.convert(t),this}extend(t){const s=this._sw,c=this._ne;let h,d;if(t instanceof Qr)h=t,d=t;else{if(!(t instanceof yl))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(yl.convert(t)):this.extend(Qr.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Qr.convert(t)):this;if(h=t._sw,d=t._ne,!h||!d)return this}return s||c?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),c.lng=Math.max(d.lng,c.lng),c.lat=Math.max(d.lat,c.lat)):(this._sw=new Qr(h.lng,h.lat),this._ne=new Qr(d.lng,d.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=Qr.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(t){if(t)return t instanceof yl?t:new yl(t)}}const sw=0,ow=25.5;function jf(l){return Pg*Math.cos(l*Math.PI/180)}function na(l){return(180+l)/360}function Ds(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function qi(l,t){return l/jf(t)}function Ls(l){return 360*l-180}function Fi(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Rg(l,t){return l*jf(Fi(t))}const Kn=85.051129;function $v(l){return Math.cos(wr(Tr(l,-Kn,Kn)))}function vl(l,t){const s=Tr(t,sw,ow),c=Math.pow(2,s);return $v(l)*Pg/(512*c)}function aw(l){return 1/Math.cos(l*Math.PI/180)}function p(l,t=0){const s=Math.exp(Math.PI*(1-(l.y+t/Rt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/Rt/(1<<l.z)}class r{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=Qr.convert(t);return new r(na(c.lng),Ds(c.lat),qi(s,c.lat))}toLngLat(){return new Qr(Ls(this.x),Fi(this.y))}toAltitude(){return Rg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Pg*aw(Fi(this.y))}}function a(l,t,s,c,h,d,m,x,T){const M=(t+c)/2,y=(s+h)/2,E=new wt(M,y);x(E),function(P,A,I,k,j,F){const W=I-j,H=k-F;return Math.abs((k-A)*W-(I-P)*H)/Math.hypot(W,H)}(E.x,E.y,d.x,d.y,m.x,m.y)>=T?(a(l,t,s,M,y,d,E,x,T),a(l,M,y,c,h,E,m,x,T)):l.push(m)}function f(l,t,s){let c=l[0],h=c.x,d=c.y;t(c);const m=[c];for(let x=1;x<l.length;x++){const T=l[x],{x:M,y}=T;t(T),a(m,h,d,M,y,c,T,t,s),h=M,d=y,c=T}return m}function _(l,t,s,c){if(c(t,s)){const h=t.add(s)._mult(.5);_(l,t,h,c),_(l,h,s,c)}else l.push(s)}function v(l,t){let s=l[0];const c=[s];for(let h=1;h<l.length;h++){const d=l[h];_(c,s,d,t),s=d}return c}const S=Math.pow(2,14)-1,R=-S-1;function D(l,t){const s=Math.round(l.x*t),c=Math.round(l.y*t);return l.x=Tr(s,R,S),l.y=Tr(c,R,S),(s<l.x||s>l.x+1||c<l.y||c>l.y+1)&&Cn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function N(l,t,s){const c=l.loadGeometry(),h=l.extent,d=Rt/h;if(t&&s&&s.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:x,x:T,y:M,projection:y}=s,E=P=>{const A=Ls((t.x+P.x/h)/m),I=Fi((t.y+P.y/h)/m),k=y.project(A,I);P.x=(k.x*x-T)*h,P.y=(k.y*x-M)*h};for(let P=0;P<c.length;P++)if(l.type!==1)c[P]=f(c[P],E,1);else{const A=[];for(const I of c[P])I.x<0||I.x>=h||I.y<0||I.y>=h||(E(I),A.push(I));c[P]=A}}for(const m of c)for(const x of m)D(x,d);return c}function z(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?N(l):[]}}function B(l,t,s,c,h){l.emplaceBack(2*t+(c+1)/2,2*s+(h+1)/2)}function V(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class X{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Ma,this.indexArray=new ji,this.segments=new Rn,this.programConfigurations=new _l(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(t,s){}populate(t,s,c,h){const d=this.layers[0],m=[];let x=null;d.type==="circle"&&(x=d.layout.get("circle-sort-key"));for(const{feature:M,id:y,index:E,sourceLayerIndex:P}of t){const A=this.layers[0]._featureFilter.needGeometry,I=z(M,A);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),I,c))continue;const k=x?x.evaluate(I,{},c):void 0,j={id:y,properties:M.properties,type:M.type,sourceLayerIndex:P,index:E,geometry:A?I.geometry:N(M,c,h),patterns:{},sortKey:k};m.push(j)}x&&m.sort((M,y)=>M.sortKey-y.sortKey);let T=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Af,T=h.projection);for(const M of m){const{geometry:y,index:E,sourceLayerIndex:P}=M,A=t[E].feature;this.addFeature(M,y,E,s.availableImages,c,T,s.brightness),s.featureIndex.insert(A,y,E,P,this.index)}}update(t,s,c,h,d,m,x){this.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Qb.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,c,h,d,m,x){for(const T of s)for(const M of T){const y=M.x,E=M.y;if(y<0||y>=Rt||E<0||E>=Rt)continue;if(m){const I=m.projectTilePoint(y,E,d),k=m.upVector(d,y,E),j=this.globeExtVertexArray;V(j,I,k),V(j,I,k),V(j,I,k),V(j,I,k)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;B(this.layoutVertexArray,y,E,-1,-1),B(this.layoutVertexArray,y,E,1,-1),B(this.layoutVertexArray,y,E,1,1),B(this.layoutVertexArray,y,E,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},h,d,x)}}function se(l,t){for(let s=0;s<l.length;s++)if(Te(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Te(l,t[s]))return!0;return!!_e(l,t)}function te(l,t,s){return!!Te(l,t)||!!xe(t,l,s)}function ae(l,t){if(l.length===1)return Se(t,l[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let h=0;h<c.length;h++)if(Te(l,c[h]))return!0}for(let s=0;s<l.length;s++)if(Se(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(_e(l,t[s]))return!0;return!1}function ce(l,t,s){if(l.length>1){if(_e(l,t))return!0;for(let c=0;c<t.length;c++)if(xe(t[c],l,s))return!0}for(let c=0;c<l.length;c++)if(xe(l[c],t,s))return!0;return!1}function _e(l,t){if(l.length===0||t.length===0)return!1;for(let s=0;s<l.length-1;s++){const c=l[s],h=l[s+1];for(let d=0;d<t.length-1;d++)if(be(c,h,t[d],t[d+1]))return!0}return!1}function be(l,t,s,c){return sr(l,s,c)!==sr(t,s,c)&&sr(l,t,s)!==sr(l,t,c)}function xe(l,t,s){const c=s*s;if(t.length===1)return l.distSqr(t[0])<c;for(let h=1;h<t.length;h++)if(Ae(l,t[h-1],t[h])<c)return!0;return!1}function Ae(l,t,s){const c=t.distSqr(s);if(c===0)return l.distSqr(t);const h=((l.x-t.x)*(s.x-t.x)+(l.y-t.y)*(s.y-t.y))/c;return l.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function Se(l,t){let s,c,h,d=!1;for(let m=0;m<l.length;m++){s=l[m];for(let x=0,T=s.length-1;x<s.length;T=x++)c=s[x],h=s[T],c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(d=!d)}return d}function Te(l,t){let s=!1;for(let c=0,h=l.length-1;c<l.length;h=c++){const d=l[c],m=l[h];d.y>t.y!=m.y>t.y&&t.x<(m.x-d.x)*(t.y-d.y)/(m.y-d.y)+d.x&&(s=!s)}return s}function Ee(l,t,s,c,h){for(const m of l)if(t<=m.x&&s<=m.y&&c>=m.x&&h>=m.y)return!0;const d=[new wt(t,s),new wt(t,h),new wt(c,h),new wt(c,s)];if(l.length>2){for(const m of d)if(Te(l,m))return!0}for(let m=0;m<l.length-1;m++)if(Re(l[m],l[m+1],d))return!0;return!1}function Re(l,t,s){const c=s[0],h=s[2];if(l.x<c.x&&t.x<c.x||l.x>h.x&&t.x>h.x||l.y<c.y&&t.y<c.y||l.y>h.y&&t.y>h.y)return!1;const d=sr(l,t,s[0]);return d!==sr(l,t,s[1])||d!==sr(l,t,s[2])||d!==sr(l,t,s[3])}function Ne(l,t,s,c,h,d){let m=t.y-l.y,x=l.x-t.x;if(d=d||0){const T=m*m+x*x;if(T===0)return!0;const M=Math.sqrt(T);m/=M,x/=M}return!((s.x-l.x)*m+(s.y-l.y)*x-d<0||(c.x-l.x)*m+(c.y-l.y)*x-d<0||(h.x-l.x)*m+(h.y-l.y)*x-d<0)}function nt(l,t,s,c,h,d,m){return!(Ne(l,t,c,h,d,m)||Ne(t,s,c,h,d,m)||Ne(s,l,c,h,d,m)||Ne(c,h,l,t,s,m)||Ne(h,d,l,t,s,m)||Ne(d,c,l,t,s,m))}function We(l,t,s){const c=t.paint.get(l).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(l)}function pt(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function gt(l,t,s,c,h){if(!t[0]&&!t[1])return l;const d=wt.convert(t)._mult(h);s==="viewport"&&d._rotate(-c);const m=[];for(let x=0;x<l.length;x++)m.push(l[x].sub(d));return m}function Ct(l,t,s,c){const h=wt.convert(l)._mult(c);return t==="viewport"&&h._rotate(-s),h}let Ge,ft;Bt(X,"CircleBucket",{omit:["layers"]});var Ve,ht={exports:{}},lt=(Ve||(Ve=1,function(l,t){(function(s){function c(d,m,x){var T=h(256*d,256*(m=Math.pow(2,x)-m-1),x),M=h(256*(d+1),256*(m+1),x);return T[0]+","+T[1]+","+M[0]+","+M[1]}function h(d,m,x){var T=2*Math.PI*6378137/256/Math.pow(2,x);return[d*T-2*Math.PI*6378137/2,m*T-2*Math.PI*6378137/2]}s.getURL=function(d,m,x,T,M,y){return y=y||{},d+"?"+["bbox="+c(x,T,M),"format="+(y.format||"image/png"),"service="+(y.service||"WMS"),"version="+(y.version||"1.1.1"),"request="+(y.request||"GetMap"),"srs="+(y.srs||"EPSG:3857"),"width="+(y.width||256),"height="+(y.height||256),"layers="+m].join("&")},s.getTileBBox=c,s.getMercCoords=h,Object.defineProperty(s,"__esModule",{value:!0})})(t)}(0,ht.exports)),ht.exports);class _t{constructor(t,s,c){this.z=t,this.x=s,this.y=c,this.key=Lt(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const c=lt.getTileBBox(this.x,this.y,this.z),h=function(d,m,x){let T,M="";for(let y=d;y>0;y--)T=1<<y-1,M+=(m&T?1:0)+(x&T?2:0);return M}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class it{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Lt(t,s.z,s.z,s.x,s.y)}}class vt{constructor(t,s,c,h,d){this.overscaledZ=t,this.wrap=s,this.canonical=new _t(c,+h,+d),this.key=s===0&&t===c?this.canonical.key:Lt(s,t,c,h,d)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new vt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vt(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return Lt(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Lt(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new vt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new vt(s,this.wrap,s,c,h),new vt(s,this.wrap,s,c+1,h),new vt(s,this.wrap,s,c,h+1),new vt(s,this.wrap,s,c+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new vt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new vt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new it(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Lt(l,t,s,c,h){const d=1<<Math.min(s,22);let m=d*(h%d)+c%d;return l&&s<22&&(m+=d*d*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*m+s)+(t-s)}const Nt=[l=>{let t=l.canonical.x-1,s=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,s--),new vt(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,s=l.wrap;return t===1<<l.canonical.z&&(t=0,s++),new vt(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>new vt(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new vt(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Bt(_t,"CanonicalTileID"),Bt(vt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ot=Jr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Zt}=Ot,gr=Jr([{name:"a_pos_3",components:3,type:"Int16"}]);var nr=Jr([{name:"a_pos",type:"Int16",components:2}]);class hr{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const h=he.vec2.dot(s,this.dir);if(Math.abs(h)<1e-6)return!1;const d=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1])/h;return c[0]=this.pos[0]+this.dir[0]*d,c[1]=this.pos[1]+this.dir[1]*d,!0}}class lr{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const h=he.vec3.dot(s,this.dir);if(Math.abs(h)<1e-6)return!1;const d=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/h;return c[0]=this.pos[0]+this.dir[0]*d,c[1]=this.pos[1]+this.dir[1]*d,c[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(t,s,c){if(he.vec3.equals(this.pos,t)||s===0)return c[0]=c[1]=c[2]=0,!1;const[h,d,m]=this.dir,x=this.pos[0]-t[0],T=this.pos[1]-t[1],M=this.pos[2]-t[2],y=h*h+d*d+m*m,E=2*(x*h+T*d+M*m),P=E*E-4*y*(x*x+T*T+M*M-s*s);if(P<0){const A=Math.max(-E/2,0),I=x+h*A,k=T+d*A,j=M+m*A,F=Math.hypot(I,k,j);return c[0]=I*s/F,c[1]=k*s/F,c[2]=j*s/F,!1}{const A=(-E-Math.sqrt(P))/(2*y);if(A<0){const I=Math.hypot(x,T,M);return c[0]=x*s/I,c[1]=T*s/I,c[2]=M*s/I,!1}return c[0]=x+h*A,c[1]=T+d*A,c[2]=M+m*A,!0}}}class Fr{constructor(t,s,c,h,d){this.TL=t,this.TR=s,this.BR=c,this.BL=h,this.horizon=d}static fromInvProjectionMatrix(t,s,c){const h=[-1,1,1],d=[1,1,1],m=[1,-1,1],x=[-1,-1,1],T=he.vec3.transformMat4(h,h,t),M=he.vec3.transformMat4(d,d,t),y=he.vec3.transformMat4(m,m,t),E=he.vec3.transformMat4(x,x,t);return new Fr(T,M,y,E,s/c)}}function en(l,t,s){let c=1/0,h=-1/0;const d=[];for(const m of l){he.vec3.sub(d,m,t);const x=he.vec3.dot(d,s);c=Math.min(c,x),h=Math.max(h,x)}return[c,h]}function xn(l,t){let s=!0;for(let c=0;c<l.planes.length;c++){const h=l.planes[c];let d=0;for(let m=0;m<t.length;m++)d+=he.vec3.dot(h,t[m])+h[3]>=0;if(d===0)return 0;d!==t.length&&(s=!1)}return s?2:1}function Pr(l,t){for(const s of l.projections){const c=en(t,l.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function kn(l,t){let s=0;const c=[0,0,0,0];for(let h=0;h<l.length;h++)c[0]=l[h][0],c[1]=l[h][1],c[2]=l[h][2],c[3]=1,he.vec4.dot(c,t)>=0&&s++;return s}class xr{constructor(t,s){this.points=t||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=Xt.fromPoints(this.points),this.projections=[],this.frustumEdges=[he.vec3.sub([],this.points[2],this.points[3]),he.vec3.sub([],this.points[0],this.points[3]),he.vec3.sub([],this.points[4],this.points[0]),he.vec3.sub([],this.points[5],this.points[1]),he.vec3.sub([],this.points[6],this.points[2]),he.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const h=[0,-c[2],c[1]],d=[c[2],0,-c[0]];this.projections.push({axis:h,projection:en(this.points,this.points[0],h)}),this.projections.push({axis:d,projection:en(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(t,s,c,h){const d=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const y=he.vec4.transformMat4([],M,t),E=1/y[3]/s*d;return he.vec4.mul(y,y,[E,E,h?1/y[3]:E,E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const y=he.vec3.sub([],m[M[0]],m[M[1]]),E=he.vec3.sub([],m[M[2]],m[M[1]]),P=he.vec3.normalize([],he.vec3.cross([],y,E)),A=-he.vec3.dot(P,m[M[1]]);return P.concat(A)}),T=[];for(let M=0;M<m.length;M++)T.push([m[M][0],m[M][1],m[M][2]]);return new xr(T,x)}intersectsPrecise(t,s,c){for(let h=0;h<s.length;h++)if(!kn(t,s[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!kn(t,this.planes[h]))return 0;for(const h of c)for(const d of this.frustumEdges){const m=he.vec3.cross([],h,d),x=he.vec3.length(m);if(x===0)continue;he.vec3.scale(m,m,1/x);const T=en(this.points,this.points[0],m),M=en(t,this.points[0],m);if(T[0]>M[1]||M[0]>T[1])return 0}return 1}containsPoint(t){for(const s of this.planes){const c=s[3];if(he.vec3.dot([s[0],s[1],s[2]],t)+c<0)return!1}return!0}}class Xt{static fromPoints(t){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of t)he.vec3.min(s,s,h),he.vec3.max(c,c,h);return new Xt(s,c)}static fromTileIdAndHeight(t,s,c){const h=1<<t.canonical.z,d=t.canonical.x,m=t.canonical.y;return new Xt([d/h,m/h,s],[(d+1)/h,(m+1)/h,c])}static applyTransform(t,s){const c=t.getCorners();for(let h=0;h<c.length;++h)he.vec3.transformMat4(c[h],c[h],s);return Xt.fromPoints(c)}static applyTransformFast(t,s){const c=[s[12],s[13],s[14]],h=[...c];for(let d=0;d<3;d++)for(let m=0;m<3;m++){const x=s[4*m+d],T=x*t.min[m],M=x*t.max[m];c[d]+=Math.min(T,M),h[d]+=Math.max(T,M)}return new Xt(c,h)}static projectAabbCorners(t,s){const c=t.getCorners();for(let h=0;h<c.length;++h)he.vec3.transformMat4(c[h],c[h],s);return c}constructor(t,s){this.min=t,this.max=s,this.center=he.vec3.scale([],he.vec3.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=he.vec3.clone(this.min),h=he.vec3.clone(this.max);for(let d=0;d<s.length;d++)c[d]=s[d]?this.min[d]:this.center[d],h[d]=s[d]?this.center[d]:this.max[d];return h[2]=this.max[2],new Xt(c,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?xn(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?xn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,s){return s||this.intersects(t)?Pr(t,this.getCorners()):0}intersectsPreciseFlat(t,s){return s||this.intersectsFlat(t)?Pr(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let s=0;s<3;++s)if(this.min[s]>t.max[s]||t.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t.min[s]),this.max[s]=Math.max(this.max[s],t.max[s])}encapsulatePoint(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t[s]),this.max[s]=Math.max(this.max[s],t[s])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function Vr(l){return l*fs/Jl}Bt(Xt,"Aabb");const ln=[new Xt([Xs,Xs,Xs],[Ks,Ks,Ks]),new Xt([Xs,Xs,Xs],[0,0,Ks]),new Xt([0,Xs,Xs],[Ks,0,Ks]),new Xt([Xs,0,Xs],[0,Ks,Ks]),new Xt([0,0,Xs],[Ks,Ks,Ks])];function Zr(l,t,s,c=!0){const h=he.vec3.scale([],l._camera.position,l.worldSize),d=[t,s,1,1];he.vec4.transformMat4(d,d,l.pixelMatrixInverse),he.vec4.scale(d,d,1/d[3]);const m=he.vec3.sub([],d,h),x=he.vec3.normalize([],m),T=l.globeMatrix,M=[T[12],T[13],T[14]],y=he.vec3.sub([],M,h),E=he.vec3.length(y),P=he.vec3.normalize([],y),A=l.worldSize/(2*Math.PI),I=he.vec3.dot(P,x),k=Math.asin(A/E);if(k<Math.acos(I)){if(!c)return null;const Me=[],ve=[];he.vec3.scale(Me,x,E/I),he.vec3.normalize(ve,he.vec3.sub(ve,Me,y)),he.vec3.normalize(x,he.vec3.add(x,y,he.vec3.scale(x,ve,Math.tan(k)*E)))}const j=[];new lr(h,x).closestPointOnSphere(M,A,j);const F=he.vec3.normalize([],Mo(T,0)),W=he.vec3.normalize([],Mo(T,1)),H=he.vec3.normalize([],Mo(T,2)),$=he.vec3.dot(F,j),Y=he.vec3.dot(W,j),ne=he.vec3.dot(H,j),oe=Hr(Math.asin(-Y/A));let ye=Hr(Math.atan2($,ne));ye=l.center.lng+function(Me,ve){const Ie=(ve-Me+180)%360-180;return Ie<-180?Ie+360:Ie}(l.center.lng,ye);const pe=na(ye),me=Tr(Ds(oe),0,1);return new r(pe,me)}class $n{constructor(t,s,c){this.a=he.vec3.sub([],t,c),this.b=he.vec3.sub([],s,c),this.center=c;const h=he.vec3.normalize([],this.a),d=he.vec3.normalize([],this.b);this.angle=Math.acos(he.vec3.dot(h,d))}}function ei(l,t){if(l.angle===0)return null;let s;return s=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:function(c,h,d,m){const x=Math.sin(d);return c*(Math.sin((1-m)*d)/x)+h*(Math.sin(m*d)/x)}(l.a[t],l.b[t],l.angle,Tr(s,0,1))+l.center[t]}function di(l){if(l.z<=1)return ln[l.z+2*l.y+l.x];const t=Dn(Gr(l));return Xt.fromPoints(t)}function yi(l,t,s){return he.vec3.scale(l,l,1-s),he.vec3.scaleAndAdd(l,l,t,s)}function Ys(l,t,s){for(const c of l)he.vec3.transformMat4(c,c,t),he.vec3.scale(c,c,s)}function ns(l,t,s,c){const h=t/l.worldSize,d=l.globeMatrix;if(s.z<=1){const pe=di(s).getCorners();return Ys(pe,d,h),Xt.fromPoints(pe)}const m=Gr(s,c),x=Dn(m,fs+Vr(l._tileCoverLift));Ys(x,d,h);const T=Number.MAX_VALUE,M=[-T,-T,-T],y=[T,T,T];if(m.contains(l.center)){for(const Me of x)he.vec3.min(y,y,Me),he.vec3.max(M,M,Me);M[2]=0;const pe=l.point,me=[pe.x*h,pe.y*h,0];return he.vec3.min(y,y,me),he.vec3.max(M,M,me),new Xt(y,M)}if(l._tileCoverLift>0){for(const pe of x)he.vec3.min(y,y,pe),he.vec3.max(M,M,pe);return new Xt(y,M)}const E=[d[12]*h,d[13]*h,d[14]*h],P=m.getCenter(),A=Tr(l.center.lat,-Kn,Kn),I=Tr(P.lat,-Kn,Kn),k=na(l.center.lng),j=Ds(A);let F=k-na(P.lng);const W=j-Ds(I);F>.5?F-=1:F<-.5&&(F+=1);let H=0;if(Math.abs(F)>Math.abs(W))H=F>=0?1:3;else{H=W>=0?0:2;const pe=[d[4]*h,d[5]*h,d[6]*h],me=-Math.sin(wr(W>=0?m.getSouth():m.getNorth()))*fs;he.vec3.scaleAndAdd(E,E,pe,me)}const $=x[H],Y=x[(H+1)%4],ne=new $n($,Y,E),oe=[ei(ne,0)||$[0],ei(ne,1)||$[1],ei(ne,2)||$[2]],ye=Ts(l.zoom);if(ye>0){const pe=function({x:Me,y:ve,z:Ie},Oe,Le,Fe,je){const Xe=1/(1<<Ie);let $e=Me*Xe,Ke=$e+Xe,xt=ve*Xe,yt=xt+Xe,Ut=0;const Et=($e+Ke)/2-Fe;return Et>.5?Ut=-1:Et<-.5&&(Ut=1),$e=(($e+Ut)*Oe-(Fe*=Oe))*Le+Fe,Ke=((Ke+Ut)*Oe-Fe)*Le+Fe,xt=(xt*Oe-(je*=Oe))*Le+je,yt=(yt*Oe-je)*Le+je,[[$e,yt,0],[Ke,yt,0],[Ke,xt,0],[$e,xt,0]]}(s,t,l._pixelsPerMercatorPixel,k,j);for(let Me=0;Me<x.length;Me++)yi(x[Me],pe[Me],ye);const me=he.vec3.add([],pe[H],pe[(H+1)%4]);he.vec3.scale(me,me,.5),yi(oe,me,ye)}for(const pe of x)he.vec3.min(y,y,pe),he.vec3.max(M,M,pe);return y[2]=Math.min($[2],Y[2]),he.vec3.min(y,y,oe),he.vec3.max(M,M,oe),new Xt(y,M)}function Gr({x:l,y:t,z:s},c=!1){const h=1/(1<<s),d=new Qr(Ls(l*h),t===(1<<s)-1&&c?-90:Fi((t+1)*h)),m=new Qr(Ls((l+1)*h),t===0&&c?90:Fi(t*h));return new yl(d,m)}function Dn(l,t=fs){const s=wr(l.getNorth()),c=wr(l.getSouth()),h=Math.cos(s),d=Math.cos(c),m=Math.sin(s),x=Math.sin(c),T=l.getWest(),M=l.getEast();return[nu(d,x,T,t),nu(d,x,M,t),nu(h,m,M,t),nu(h,m,T,t)]}function tn(l,t,s,c){const h=1<<s.z,d=(l/Rt+s.x)/h;return Yl(Fi((t/Rt+s.y)/h),Ls(d),c)}function pn({min:l,max:t}){return Vv/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}const Bi=new Float64Array(16);function Mn(l){const t=pn(l),s=he.mat4.fromScaling(Bi,[t,t,t]);return he.mat4.translate(s,s,he.vec3.negate([],l.min))}function hi(l){const t=he.mat4.fromTranslation(Bi,l.min),s=1/pn(l);return he.mat4.scale(t,t,[s,s,s])}function ia(l){const t=Rt/(2*Math.PI);return l/(2*Math.PI)/t}function Ns(l,t){return Rt/(512*Math.pow(2,l))*pn(di(t))}function yo(l,t,s,c,h){const d=ia(s),m=[l,t,-s/(2*Math.PI)],x=he.mat4.identity(new Float64Array(16));return he.mat4.translate(x,x,m),he.mat4.scale(x,x,[d,d,d]),he.mat4.rotateX(x,x,wr(-h)),he.mat4.rotateY(x,x,wr(-c)),x}function Ts(l){return mi(tu,Uv,l)}function vo(l,t){const s=Yl(t.lat,t.lng),c=function(d){const m=Yl(d._center.lat,d._center.lng),x=he.vec3.fromValues(0,1,0);let T=he.vec3.cross([],x,m);const M=he.mat4.fromRotation([],-d.angle,m);T=he.vec3.transformMat4(T,T,M),he.mat4.fromRotation(M,-d._pitch,T);const y=he.vec3.normalize([],m);return he.vec3.scale(y,y,Vr(d.cameraToCenterDistance/d.pixelsPerMeter)),he.vec3.transformMat4(y,y,M),he.vec3.add([],m,y)}(l),h=he.vec3.subtract([],c,s);return he.vec3.angle(h,s)}function Os(l,t){return vo(l,t)>Math.PI/2*1.01}const Ra=wr(85),sa=Math.cos(Ra),ka=Math.sin(Ra),kg=he.mat4.create(),iu=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Ff(l,t,s,c,h,d,m,x,T){if(d&&l.queryGeometry.isAboveHorizon)return!1;d&&(T*=l.pixelToTileUnitsFactor);const M=l.tileID.canonical,y=s.projection.upVectorScale(M,s.center.lat,s.worldSize).metersToTile;for(const E of t)for(const P of E){const A=P.add(x),I=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(A.x,A.y,!0):0,k=s.projection.projectTilePoint(A.x,A.y,M);if(I>0){const H=s.projection.upVector(M,A.x,A.y);k.x+=H[0]*y*I,k.y+=H[1]*y*I,k.z+=H[2]*y*I}const j=d?A:Dg(k.x,k.y,k.z,c),F=d?l.tilespaceRays.map(H=>OF(H,I)):l.queryGeometry.screenGeometry,W=he.vec4.transformMat4([],[k.x,k.y,k.z,1],c);if(!m&&d?T*=W[3]/s.cameraToCenterDistance:m&&!d&&(T*=s.cameraToCenterDistance/W[3]),d){const H=Fi((P.y/Rt+M.y)/(1<<M.z));T/=s.projection.pixelsPerMeter(H,1)/qi(1,H)}if(te(F,j,T))return!0}return!1}function Dg(l,t,s,c){const h=he.vec4.transformMat4([],[l,t,s,1],c);return new wt(h[0]/h[3],h[1]/h[3])}const iA=he.vec3.fromValues(0,0,0),NF=he.vec3.fromValues(0,0,1);function OF(l,t){const s=he.vec3.create();return iA[2]=t,l.intersectsPlane(iA,NF,s),new wt(s[0],s[1])}class sA extends X{}let oA,aA,lA,cA;function uA(l,{width:t,height:s},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*s*c);return l.width=t,l.height=s,l.data=h,l}function dA(l,t,s){const{width:c,height:h}=t;c===l.width&&h===l.height||(lw(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,h)},s,null),l.width=c,l.height=h,l.data=t.data)}function lw(l,t,s,c,h,d,m,x){if(h.width===0||h.height===0)return t;if(h.width>l.width||h.height>l.height||s.x>l.width-h.width||s.y>l.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||c.x>t.width-h.width||c.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=l.data,M=t.data,y=d===4&&x;for(let E=0;E<h.height;E++){const P=((s.y+E)*l.width+s.x)*d,A=((c.y+E)*t.width+c.x)*d;if(y)for(let I=0;I<h.width;I++){const k=P+I*d+3,j=A+I*d;M[j+0]=255,M[j+1]=255,M[j+2]=255,M[j+3]=T[k]}else if(m)for(let I=0;I<h.width;I++){const k=P+I*d,j=A+I*d,F=T[k+3],W=new an(T[k+0]/255*F,T[k+1]/255*F,T[k+2]/255*F,F).toRenderColor(m).toArray();M[j+0]=W[0],M[j+1]=W[1],M[j+2]=W[2],M[j+3]=W[3]}else for(let I=0;I<h.width*d;I++)M[A+I]=T[P+I]}return t}Bt(sA,"HeatmapBucket",{omit:["layers"]});class su{constructor(t,s){uA(this,t,1,s)}resize(t){dA(this,new su(t),1)}clone(){return new su({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,h,d){lw(t,s,c,h,d,1,null)}}class Hi{constructor(t,s){uA(this,t,4,s)}resize(t){dA(this,new Hi(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,h,d,m,x){lw(t,s,c,h,d,4,m,x)}}class hA{constructor(t,s){this.width=t.width,this.height=t.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Lg(l){const t={},s=l.resolution||256,c=l.clips?l.clips.length:1,h=l.image||new Hi({width:s,height:c}),d=(m,x,T)=>{t[l.evaluationKey]=T;const M=l.expression.evaluate(t);M&&(h.data[m+x+0]=Math.floor(255*M.r/M.a),h.data[m+x+1]=Math.floor(255*M.g/M.a),h.data[m+x+2]=Math.floor(255*M.b/M.a),h.data[m+x+3]=Math.floor(255*M.a))};if(l.clips)for(let m=0,x=0;m<c;++m,x+=4*s)for(let T=0,M=0;T<s;T++,M+=4){const y=T/(s-1),{start:E,end:P}=l.clips[m];d(x,M,E*(1-y)+P*y)}else for(let m=0,x=0;m<s;m++,x+=4)d(0,x,m/(s-1));return h}Bt(su,"AlphaImage"),Bt(Hi,"RGBAImage");const zF=Jr([{name:"a_pos",components:2,type:"Int16"}],4),jF=Jr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),FF=Jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),BF=Jr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ng(l,t,s=2){const c=t&&t.length,h=c?t[0]*s:l.length;let d=fA(l,0,h,s,!0);const m=[];if(!d||d.next===d.prev)return m;let x,T,M;if(c&&(d=function(y,E,P,A){const I=[];for(let k=0,j=E.length;k<j;k++){const F=fA(y,E[k]*A,k<j-1?E[k+1]*A:y.length,A,!1);F===F.next&&(F.steiner=!0),I.push(ZF(F))}I.sort(qF);for(let k=0;k<I.length;k++)P=HF(I[k],P);return P}(l,t,d,s)),l.length>80*s){x=1/0,T=1/0;let y=-1/0,E=-1/0;for(let P=s;P<h;P+=s){const A=l[P],I=l[P+1];A<x&&(x=A),I<T&&(T=I),A>y&&(y=A),I>E&&(E=I)}M=Math.max(y-x,E-T),M=M!==0?32767/M:0}return Og(d,m,s,x,T,M,0),m}function fA(l,t,s,c,h){let d;if(h===function(m,x,T,M){let y=0;for(let E=x,P=T-M;E<T;E+=M)y+=(m[P]-m[E])*(m[E+1]+m[P+1]),P=E;return y}(l,t,s,c)>0)for(let m=t;m<s;m+=c)d=gA(m/c|0,l[m],l[m+1],d);else for(let m=s-c;m>=t;m-=c)d=gA(m/c|0,l[m],l[m+1],d);return d&&Gv(d,d.next)&&(jg(d),d=d.next),d}function Wd(l,t){if(!l)return l;t||(t=l);let s,c=l;do if(s=!1,c.steiner||!Gv(c,c.next)&&vi(c.prev,c,c.next)!==0)c=c.next;else{if(jg(c),c=t=c.prev,c===c.next)break;s=!0}while(s||c!==t);return t}function Og(l,t,s,c,h,d,m){if(!l)return;!m&&d&&function(T,M,y,E){let P=T;do P.z===0&&(P.z=cw(P.x,P.y,M,y,E)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==T);P.prevZ.nextZ=null,P.prevZ=null,function(A){let I,k=1;do{let j,F=A;A=null;let W=null;for(I=0;F;){I++;let H=F,$=0;for(let ne=0;ne<k&&($++,H=H.nextZ,H);ne++);let Y=k;for(;$>0||Y>0&&H;)$!==0&&(Y===0||!H||F.z<=H.z)?(j=F,F=F.nextZ,$--):(j=H,H=H.nextZ,Y--),W?W.nextZ=j:A=j,j.prevZ=W,W=j;F=H}W.nextZ=null,k*=2}while(I>1)}(P)}(l,c,h,d);let x=l;for(;l.prev!==l.next;){const T=l.prev,M=l.next;if(d?VF(l,c,h,d):UF(l))t.push(T.i,l.i,M.i),jg(l),l=M.next,x=M.next;else if((l=M)===x){m?m===1?Og(l=$F(Wd(l),t),t,s,c,h,d,2):m===2&&GF(l,t,s,c,h,d):Og(Wd(l),t,s,c,h,d,1);break}}}function UF(l){const t=l.prev,s=l,c=l.next;if(vi(t,s,c)>=0)return!1;const h=t.x,d=s.x,m=c.x,x=t.y,T=s.y,M=c.y,y=h<d?h<m?h:m:d<m?d:m,E=x<T?x<M?x:M:T<M?T:M,P=h>d?h>m?h:m:d>m?d:m,A=x>T?x>M?x:M:T>M?T:M;let I=c.next;for(;I!==t;){if(I.x>=y&&I.x<=P&&I.y>=E&&I.y<=A&&Bf(h,x,d,T,m,M,I.x,I.y)&&vi(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function VF(l,t,s,c){const h=l.prev,d=l,m=l.next;if(vi(h,d,m)>=0)return!1;const x=h.x,T=d.x,M=m.x,y=h.y,E=d.y,P=m.y,A=x<T?x<M?x:M:T<M?T:M,I=y<E?y<P?y:P:E<P?E:P,k=x>T?x>M?x:M:T>M?T:M,j=y>E?y>P?y:P:E>P?E:P,F=cw(A,I,t,s,c),W=cw(k,j,t,s,c);let H=l.prevZ,$=l.nextZ;for(;H&&H.z>=F&&$&&$.z<=W;){if(H.x>=A&&H.x<=k&&H.y>=I&&H.y<=j&&H!==h&&H!==m&&Bf(x,y,T,E,M,P,H.x,H.y)&&vi(H.prev,H,H.next)>=0||(H=H.prevZ,$.x>=A&&$.x<=k&&$.y>=I&&$.y<=j&&$!==h&&$!==m&&Bf(x,y,T,E,M,P,$.x,$.y)&&vi($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;H&&H.z>=F;){if(H.x>=A&&H.x<=k&&H.y>=I&&H.y<=j&&H!==h&&H!==m&&Bf(x,y,T,E,M,P,H.x,H.y)&&vi(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;$&&$.z<=W;){if($.x>=A&&$.x<=k&&$.y>=I&&$.y<=j&&$!==h&&$!==m&&Bf(x,y,T,E,M,P,$.x,$.y)&&vi($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function $F(l,t){let s=l;do{const c=s.prev,h=s.next.next;!Gv(c,h)&&pA(c,s,s.next,h)&&zg(c,h)&&zg(h,c)&&(t.push(c.i,s.i,h.i),jg(s),jg(s.next),s=l=h),s=s.next}while(s!==l);return Wd(s)}function GF(l,t,s,c,h,d){let m=l;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&XF(m,x)){let T=mA(m,x);return m=Wd(m,m.next),T=Wd(T,T.next),Og(m,t,s,c,h,d,0),void Og(T,t,s,c,h,d,0)}x=x.next}m=m.next}while(m!==l)}function qF(l,t){return l.x-t.x}function HF(l,t){const s=function(h,d){let m=d;const x=h.x,T=h.y;let M,y=-1/0;do{if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const k=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(k<=x&&k>y&&(y=k,M=m.x<m.next.x?m:m.next,k===x))return M}m=m.next}while(m!==d);if(!M)return null;const E=M,P=M.x,A=M.y;let I=1/0;m=M;do{if(x>=m.x&&m.x>=P&&x!==m.x&&Bf(T<A?x:y,T,P,A,T<A?y:x,T,m.x,m.y)){const k=Math.abs(T-m.y)/(x-m.x);zg(m,h)&&(k<I||k===I&&(m.x>M.x||m.x===M.x&&WF(M,m)))&&(M=m,I=k)}m=m.next}while(m!==E);return M}(l,t);if(!s)return t;const c=mA(s,l);return Wd(c,c.next),Wd(s,s.next)}function WF(l,t){return vi(l.prev,l,t.prev)<0&&vi(t.next,l,l.next)<0}function cw(l,t,s,c,h){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*h|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ZF(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function Bf(l,t,s,c,h,d,m,x){return(h-m)*(t-x)>=(l-m)*(d-x)&&(l-m)*(c-x)>=(s-m)*(t-x)&&(s-m)*(d-x)>=(h-m)*(c-x)}function XF(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!function(s,c){let h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==c.i&&h.next.i!==c.i&&pA(h,h.next,s,c))return!0;h=h.next}while(h!==s);return!1}(l,t)&&(zg(l,t)&&zg(t,l)&&function(s,c){let h=s,d=!1;const m=(s.x+c.x)/2,x=(s.y+c.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&m<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(d=!d),h=h.next;while(h!==s);return d}(l,t)&&(vi(l.prev,l,t.prev)||vi(l,t.prev,t))||Gv(l,t)&&vi(l.prev,l,l.next)>0&&vi(t.prev,t,t.next)>0)}function vi(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function Gv(l,t){return l.x===t.x&&l.y===t.y}function pA(l,t,s,c){const h=Hv(vi(l,t,s)),d=Hv(vi(l,t,c)),m=Hv(vi(s,c,l)),x=Hv(vi(s,c,t));return h!==d&&m!==x||!(h!==0||!qv(l,s,t))||!(d!==0||!qv(l,c,t))||!(m!==0||!qv(s,l,c))||!(x!==0||!qv(s,t,c))}function qv(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function Hv(l){return l>0?1:l<0?-1:0}function zg(l,t){return vi(l.prev,l,l.next)<0?vi(l,t,l.next)>=0&&vi(l,l.prev,t)>=0:vi(l,t,l.prev)<0||vi(l,l.next,t)<0}function mA(l,t){const s=uw(l.i,l.x,l.y),c=uw(t.i,t.x,t.y),h=l.next,d=t.prev;return l.next=t,t.prev=l,s.next=h,h.prev=s,c.next=s,s.prev=c,d.next=c,c.prev=d,c}function gA(l,t,s,c){const h=uw(l,t,s);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function jg(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function uw(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Wv(l,t){const s=l.length;if(s<=1)return[l];const c=[];let h,d;for(let m=0;m<s;m++){const x=An(l[m]);x!==0&&(l[m].area=Math.abs(x),d===void 0&&(d=x<0),d===x<0?(h&&c.push(h),h=[l[m]]):h.push(l[m]))}if(h&&c.push(h),t>1)for(let m=0;m<c.length;m++)c[m].length<=t||(Jy(c[m],t,1,c[m].length-1,KF),c[m]=c[m].slice(0,t));return c}function KF(l,t){return t.area-l.area}function _A(l,t,s=1){if(!l)return null;const c=typeof l=="string"?rs.from(l).getPrimary():l.getPrimary(),h=c.id.toString();return t.has(h)||t.set(h,[]),c.scaleSelf(s),t.get(h).push(c),c.toString()}function dw(l,t,s,c){const h=c.patternDependencies;let d=!1;for(const m of t){const x=m.paint.get(`${l}-pattern`);x.isConstant()||(d=!0),_A(x.constantOr(null),h,s)&&(d=!0)}return d}function hw(l,t,s,c,h,d){const m=d.patternDependencies;for(const x of t){const T=x.paint.get(`${l}-pattern`).value;if(T.kind!=="constant"){let M=T.evaluate({zoom:c},s,{},d.availableImages);M=M&&M.name?M.name:M;const y=_A(M,m,h);y&&(s.patterns[x.id]=y)}}return s}var fw,yA,pw,vA,mw,xA,bA,Zv={};function wA(){if(yA)return fw;yA=1;var l=jr();function t(h,d,m,x,T){this.properties={},this.extent=m,this.type=0,this._pbf=h,this._geometry=-1,this._keys=x,this._values=T,h.readFields(s,this,d)}function s(h,d,m){h==1?d.id=m.readVarint():h==2?function(x,T){for(var M=x.readVarint()+x.pos;x.pos<M;){var y=T._keys[x.readVarint()],E=T._values[x.readVarint()];T.properties[y]=E}}(m,d):h==3?d.type=m.readVarint():h==4&&(d._geometry=m.pos)}function c(h){for(var d,m,x=0,T=0,M=h.length,y=M-1;T<M;y=T++)x+=((m=h[y]).x-(d=h[T]).x)*(d.y+m.y);return x}return fw=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var d,m=h.readVarint()+h.pos,x=1,T=0,M=0,y=0,E=[];h.pos<m;){if(T<=0){var P=h.readVarint();x=7&P,T=P>>3}if(T--,x===1||x===2)M+=h.readSVarint(),y+=h.readSVarint(),x===1&&(d&&E.push(d),d=[]),d.push(new l(M,y));else{if(x!==7)throw new Error("unknown command "+x);d&&d.push(d[0].clone())}}return d&&E.push(d),E},t.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var d=h.readVarint()+h.pos,m=1,x=0,T=0,M=0,y=1/0,E=-1/0,P=1/0,A=-1/0;h.pos<d;){if(x<=0){var I=h.readVarint();m=7&I,x=I>>3}if(x--,m===1||m===2)(T+=h.readSVarint())<y&&(y=T),T>E&&(E=T),(M+=h.readSVarint())<P&&(P=M),M>A&&(A=M);else if(m!==7)throw new Error("unknown command "+m)}return[y,P,E,A]},t.prototype.toGeoJSON=function(h,d,m){var x,T,M=this.extent*Math.pow(2,m),y=this.extent*h,E=this.extent*d,P=this.loadGeometry(),A=t.types[this.type];function I(F){for(var W=0;W<F.length;W++){var H=F[W];F[W]=[360*(H.x+y)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+E)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(x=0;x<P.length;x++)k[x]=P[x][0];I(P=k);break;case 2:for(x=0;x<P.length;x++)I(P[x]);break;case 3:for(P=function(F){var W=F.length;if(W<=1)return[F];for(var H,$,Y=[],ne=0;ne<W;ne++){var oe=c(F[ne]);oe!==0&&($===void 0&&($=oe<0),$===oe<0?(H&&Y.push(H),H=[F[ne]]):H.push(F[ne]))}return H&&Y.push(H),Y}(P),x=0;x<P.length;x++)for(T=0;T<P[x].length;T++)I(P[x][T])}P.length===1?P=P[0]:A="Multi"+A;var j={type:"Feature",geometry:{type:A,coordinates:P},properties:this.properties};return"id"in this&&(j.id=this.id),j},fw}function SA(){if(vA)return pw;vA=1;var l=wA();function t(c,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(s,this,h),this.length=this._features.length}function s(c,h,d){c===15?h.version=d.readVarint():c===1?h.name=d.readString():c===5?h.extent=d.readVarint():c===2?h._features.push(d.pos):c===3?h._keys.push(d.readString()):c===4&&h._values.push(function(m){for(var x=null,T=m.readVarint()+m.pos;m.pos<T;){var M=m.readVarint()>>3;x=M===1?m.readString():M===2?m.readFloat():M===3?m.readDouble():M===4?m.readVarint64():M===5?m.readVarint():M===6?m.readSVarint():M===7?m.readBoolean():null}return x}(d))}return pw=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var h=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,h,this.extent,this._keys,this._values)},pw}function TA(){return bA||(bA=1,Zv.VectorTile=function(){if(xA)return mw;xA=1;var l=SA();function t(s,c,h){if(s===3){var d=new l(h,h.readVarint()+h.pos);d.length&&(c[d.name]=d)}}return mw=function(s,c){this.layers=s.readFields(t,{},c)},mw}(),Zv.VectorTileFeature=wA(),Zv.VectorTileLayer=SA()),Zv}var ou=TA();const Zd="3d_elevation_id",EA="level";class YF{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,s){return this._valid&&t(s(this._geometry)),this}require(t,s,c){return this.get(t,!0,s,c)}optional(t,s,c){return this.get(t,!1,s,c)}success(){return this._valid}get(t,s,c,h){const d=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&d!==void 0?c(h?h(d):d):s&&(this._valid=!1),this}}class CA{constructor(t,s){this.featureFunc=t,this.vertexFunc=s}parseFeature(t,s,c){return this.featureFunc(t,s,c)}parseVertex(t,s,c){return this.vertexFunc(t,s,c)}}const JF=new CA((l,t,s)=>l.reset(t).require(Zd,c=>{s.id=c}).optional("fixed_height_relative",c=>{s.constantHeight=c},Ql.decodeRelativeHeight).geometry(c=>{s.bounds=c},Ql.computeBounds).success(),(l,t,s)=>l.reset(t).require(Zd,c=>{s.id=c}).require("elevation_idx",c=>{s.idx=c}).require("extent",c=>{s.extent=c}).require("height_relative",c=>{s.height=c},Ql.decodeRelativeHeight).geometry(c=>{s.position=c},Ql.getPoint).success()),QF=new CA((l,t,s)=>l.reset(t).require(Zd,c=>{s.id=c}).optional("fixed_height",c=>{s.constantHeight=c},Ql.decodeMetricHeight).geometry(c=>{s.bounds=c},Ql.computeBounds).success(),(l,t,s)=>l.reset(t).require(Zd,c=>{s.id=c}).require("elevation_idx",c=>{s.idx=c}).require("extent",c=>{s.extent=c}).require("height",c=>{s.height=c},Ql.decodeMetricHeight).geometry(c=>{s.position=c},Ql.getPoint).success());class Ql{static computeBounds(t){const s=new wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of t[0])s.x>h.x&&(s.x=h.x),s.y>h.y&&(s.y=h.y),c.x<h.x&&(c.x=h.x),c.y<h.y&&(c.y=h.y);return{min:s,max:c}}static getPoint(t){return he.vec2.fromValues(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static parse(t){const s=[],c=[],h=t.length,d=new YF;for(let x=0;x<h;x++){const T=t.feature(x),M=T.properties.hasOwnProperty("version")?String(T.properties.version):void 0,y=(m=M)?m==="1.0.1"?QF:void 0:JF;if(y===void 0){Cn(`Unknown elevation feature version number ${M||"(unknown)"}`);continue}const E=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(E){if(ou.VectorTileFeature.types[T.type]==="Point"&&E==="curve_point"){const P={};y.parseVertex(d,T,P)&&s.push(P)}else if(ou.VectorTileFeature.types[T.type]==="Polygon"&&E==="curve_meta"){const P={};y.parseFeature(d,T,P)&&c.push(P)}}}var m;return{vertices:s,features:c}}}class gw{constructor(t,s,c,h,d,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=t,this.heightRange={min:c,max:c},this.safeArea=s,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=d,this.edges=this.edges.filter(x=>x.a<this.vertices.length&&x.b<this.vertices.length&&!he.vec2.exactEquals(this.vertices[x.a].position,this.vertices[x.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:he.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const T=this.vertices[x.a].position,M=this.vertices[x.b].position,y=he.vec2.subtract(he.vec2.create(),M,T),E=he.vec2.length(y),P=he.vec2.scale(he.vec2.create(),y,1/E);this.edgeProps.push({vec:y,dir:P,len:E});const A=this.vertexProps[x.a].dir,I=this.vertexProps[x.b].dir;he.vec2.add(A,A,P),he.vec2.add(I,I,P)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||he.vec2.normalize(x.dir,x.dir);this.tessellate(m)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(t);if(s==null)return 0;const[c,h]=s;return((d,m,x)=>(1-x)*d+x*m)(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,h)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let s=0,c=Number.POSITIVE_INFINITY,h=0;const d=he.vec2.fromValues(t.x,t.y);for(let m=0;m<this.edges.length;m++){const x=this.edges[m],T=this.edgeProps[m].dir,M=new hr(d,this.edgeProps[m].dir),y=this.vertices[x.a].position,E=this.vertices[x.b].position,P=he.vec2.create(),A=he.vec2.create(),I=M.intersectsPlane(y,this.vertexProps[x.a].dir,P),k=M.intersectsPlane(E,this.vertexProps[x.b].dir,A);if(!I||!k)continue;const j=he.vec2.subtract(he.vec2.create(),A,P),F=he.vec2.subtract(he.vec2.create(),d,P),W=he.vec2.dot(j,j),H=W>0?he.vec2.dot(F,j)/W:0,$=Tr(H,0,1),Y=Math.abs((H-$)*this.edgeProps[m].len),ne=he.vec2.subtract(he.vec2.create(),d,y),oe=Y+Math.abs(he.vec2.dot(ne,he.vec2.fromValues(T[1],-T[0])));oe<c&&(s=m,c=oe,h=$)}return[s,h]}tessellate(t){for(let s=this.edges.length-1;s>=0;--s){const c=this.edges[s].a,h=this.edges[s].b,{position:d,height:m,extent:x}=this.vertices[c],{position:T,height:M,extent:y}=this.vertices[h],E=this.vertexProps[c].dir,P=this.vertexProps[h].dir,A=he.vec3.fromValues(d[0]/t,d[1]/t,m),I=he.vec3.fromValues(T[0]/t,T[1]/t,M),k=he.vec3.fromValues(E[1],-E[0],0);he.vec3.scale(k,k,x);const j=he.vec3.fromValues(P[1],-P[0],0);if(he.vec3.scale(j,j,y),this.distSqLines(he.vec3.fromValues(A[0]+.5*k[0],A[1]+.5*k[1],A[2]+.5*k[2]),he.vec3.fromValues(I[0]-.5*j[0],I[1]-.5*j[1],I[2]-.5*j[2]),he.vec3.fromValues(A[0]-.5*k[0],A[1]-.5*k[1],A[2]-.5*k[2]),he.vec3.fromValues(I[0]+.5*j[0],I[1]+.5*j[1],I[2]+.5*j[2]))<=.05*.05)continue;const F=this.vertices.length,W=he.vec2.add(he.vec2.create(),d,T);this.vertices.push({position:he.vec2.scale(W,W,.5),height:.5*(m+M),extent:.5*(x+y)});const H=he.vec2.add(he.vec2.create(),E,P);this.vertexProps.push({dir:he.vec2.normalize(H,H)}),this.edges.splice(s,1),this.edgeProps.splice(s,1),this.edges.push({a:c,b:F}),this.edges.push({a:F,b:h});const $=he.vec2.subtract(he.vec2.create(),this.vertices[F].position,d),Y=he.vec2.length($),ne={vec:$,dir:he.vec2.scale(he.vec2.create(),$,1/Y),len:Y};this.edgeProps.push(ne),this.edgeProps.push(ne)}}distSqLines(t,s,c,h){const d=he.vec3.subtract(he.vec3.create(),s,t),m=he.vec3.subtract(he.vec3.create(),h,c),x=he.vec3.subtract(he.vec3.create(),t,c),T=he.vec3.dot(d,d),M=he.vec3.dot(d,m),y=he.vec3.dot(d,x),E=he.vec3.dot(m,m),P=he.vec3.dot(m,x),A=T*E-M*M;if(A===0){const W=he.vec3.dot(x,m)/he.vec3.dot(m,m),H=he.vec3.lerp(he.vec3.create(),c,h,W);return he.vec3.squaredDistance(H,t)}const I=(M*P-y*E)/A,k=(T*P-M*y)/A,j=he.vec3.lerp(he.vec3.create(),t,s,I),F=he.vec3.lerp(he.vec3.create(),c,h,k);return he.vec3.squaredDistance(j,F)}}class e5{constructor(t,s){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(s)||(this.zScale=Math.pow(2,s.z-t.z),this.xOffset=(t.x*this.zScale-s.x)*Rt,this.yOffset=(t.y*this.zScale-s.y)*Rt)}constantElevation(t,s){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,s)}pointElevation(t,s,c){const h=this.constantElevation(s,c);return h??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(t),c))}computeBiasedHeight(t,s){return s<=0?t:t+s*mi(0,s,t>=0?t:Math.abs(.5*t))}}Bt(gw,"ElevationFeature");class AA{constructor(){this.polygons=new Map}add(t,...s){this.polygons.has(t)?this.polygons.get(t).push(...s):this.polygons.set(t,s)}merge(t){for(const[s,c]of t.polygons)this.add(s,...c)}}class Xd{constructor(){this.portals=[]}static evaluate(t){if(t.length===0)return new Xd;let s=[];for(const M of t)s.push(...M.portals);if(s.length===0)return new Xd;const c=(M,y)=>M<=0&&y<=0||M>=Rt&&y>=Rt;for(const M of s){const y=M.va,E=M.vb;(c(y.x,E.x)||c(y.y,E.y))&&(M.type="border")}const h=s.filter(M=>M.type!=="unevaluated"),d=s.filter(M=>M.type==="unevaluated");if(d.length===0)return new Xd;d.sort((M,y)=>M.hash===y.hash?M.isTunnel===y.isTunnel?0:M.isTunnel?-1:1:M.hash<y.hash?1:-1),s=h.concat(d);let m=h.length,x=m,T=m;do if(x++,x===s.length||s[m].hash!==s[x].hash){if(x-m==2){T<m&&(s[T]=s[m],s[m]=null);const M=s[T],y=s[x-1];M.type=M.isTunnel!==y.isTunnel?"tunnel":"polygon",M.connection={a:M.connection.a,b:y.connection.a},T++}m=x}while(m!==s.length);return s.splice(T),s.sort((M,y)=>M.hash<y.hash?1:-1),{portals:s}}}Bt(Xd,"ElevationPortalGraph"),Bt(AA,"ElevationPolygons");class t5{constructor(t,s,c){this.outPositions=t,this.outNormals=s,this.outIndices=c,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(t,s,c){let h=t[2];c!=null&&(h*=c);const d=this.getVec3Bits(t)<<96n|this.getVec3Bits(s),m=this.vertexLookup.get(d);if(m!=null)return m;const x=this.outPositions.length;this.vertexLookup.set(d,x);const T=Math.trunc(16384*s[0]),M=Math.trunc(16384*s[1]),y=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(t[0],t[1],h),this.outNormals.emplaceBack(T,M,y),x}addVertices(t,s,...c){const h=[];for(const d of c){const m=this.addVertex(d,t,s);h.push(m)}return h}addTriangles(t,s,c){if(s&&c){const h=c.length===1,d=he.vec3.fromValues(0,0,0);for(let m=0;m<t.length;m+=3){const x=s[t[m+0]],T=s[t[m+1]],M=s[t[m+2]],y=h?c[0]:c[t[m+1]],E=h?c[0]:c[t[m+2]],P=this.addVertex(he.vec3.fromValues(x.x,x.y,h?c[0]:c[t[m+0]]),d),A=this.addVertex(he.vec3.fromValues(T.x,T.y,y),d),I=this.addVertex(he.vec3.fromValues(M.x,M.y,E),d);this.outIndices.emplaceBack(P,A,I)}}else for(let h=0;h<t.length;h+=3)this.outIndices.emplaceBack(t[h+0],t[h+1],t[h+2])}addQuad(t,s){const c=this.addVertices(s,void 0,...t.map(T=>he.vec3.fromValues(T.coord.x,T.coord.y,T.height))),[h,d,m,x]=c;this.addTriangles([h,d,m,m,x,h])}getBits(t){return this.view.setFloat32(0,t),BigInt(this.view.getUint32(0))}getVec3Bits(t){return this.getBits(t[0])<<64n|this.getBits(t[1])<<32n|this.getBits(t[2])}}class Da{constructor(t){this.unevaluatedPortals=new Xd,this.portalPolygons=new AA,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ld,this.vertexNormals=new fg,this.indexArray=new ji,this.tileToMeters=p(t)}addVertices(t,s){const c=this.unevalVertices.length;for(let h=0;h<t.length;h++)this.unevalVertices.push(t[h]),this.unevalHeights.push(s[h]);return c}addTriangles(t,s,c){const h=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of t)h.push(d+s)}addRenderableRing(t,s,c,h,d){const m=[new wt(d.min.x,d.min.y),new wt(d.max.x,d.min.y),new wt(d.max.x,d.max.y),new wt(d.min.x,d.max.y)];for(let x=0;x<c-1;x++){const T=s+x,M=T+1,y=this.unevalVertices[T],E=this.unevalVertices[M];if(!(y.x>=d.min.x&&y.x<=d.max.x&&y.y>=d.min.y&&y.y<=d.max.y||E.x>=d.min.x&&E.x<=d.max.x&&E.y>=d.min.y&&E.y<=d.max.y||Re(y,E,m))||this.isOnBorder(y.x,E.x)||this.isOnBorder(y.y,E.y))continue;const P=Da.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[M]);let A,I=this.vertexHashLookup.get(Da.computePosHash(y));I!=null?A=I.next:(I=this.vertexHashLookup.get(Da.computePosHash(E)),A=I!=null?I.prev:P),this.unevalEdges.push({polygonIdx:t,a:T,b:M,hash:P,portalHash:A,isTunnel:h,type:"unevaluated"})}}addPortalCandidates(t,s,c,h,d){if(s.length===0)return;this.portalPolygons.add(t,{geometry:s,zLevel:d});const m=s[0];this.vertexHashLookup.clear();let x=Da.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let T=0;T<m.length-1;T++){const M=m[T+0],y=m[T+1],E=he.vec2.fromValues(y.x-M.x,y.y-M.y),P=he.vec2.length(E);if(P===0)continue;let A="unevaluated";const I=h.pointElevation(M),k=h.pointElevation(y);Math.abs(I)<.01&&Math.abs(k)<.01?A="entrance":(this.isOnBorder(M.x,y.x)||this.isOnBorder(M.y,y.y))&&(A="border");const j=Da.computeEdgeHash(M,y);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:M,vb:y,vab:E,length:P,hash:j,isTunnel:c,type:A});const F=Da.computePosHash(M);this.vertexHashLookup.set(F,{prev:x,next:j}),x=j}}construct(t){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=E=>{E.primitiveLength=this.indexArray.length-E.primitiveOffset},h=new t5(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const d=s(),m=s(),x=s(),T=(E,P)=>{E.sort((I,k)=>I.type===P&&k.type!==P?-1:I.type!==P&&k.type===P?1:0);const A=E.findIndex(I=>I.type!==P);return A>=0?A:E.length};let M=0;this.unevalEdges.length>0&&(M=T(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},this.tileToMeters));const y=s();if(this.unevalEdges.length>0){const E=this.unevalEdges.splice(M),P=T(E,"tunnel")+M;this.unevalEdges.push(...E),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},{min:M,max:P})}c(x),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(y),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(m),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(d),this.maskSegments=Rn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.depthSegments=Rn.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableSegments=Rn.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.shadowCasterSegments=Rn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,FF.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,BF.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(t,s,c,h){const d=new Map;for(let m=c;m<h;m++){const x=s[m],T=x.a,M=x.b;d.has(T)||d.set(T,{}),d.has(M)||d.set(M,{});const y=d.get(T),E=d.get(M);t[M]>0&&(y.to=M),t[T]>0&&(E.from=T)}return d}constructBridgeStructures(t,s,c,h,d,m){const x=this.computeVertexConnections(c,h,d.min,d.max),T=1/m,M=.5*T,y=P=>he.vec3.fromValues(s[P].x,s[P].y,c[P]*T),E=P=>{const A=x.get(P),I=A.from,k=A.to;if(!I||!k)return;const j=y(I),F=y(P),W=y(k),H=he.vec3.fromValues(0,0,0);if(!he.vec3.exactEquals(j,F)){const Y=he.vec3.sub(he.vec3.create(),F,j);he.vec3.add(H,H,he.vec3.normalize(Y,Y))}if(!he.vec3.exactEquals(W,F)){const Y=he.vec3.sub(he.vec3.create(),W,F);he.vec3.add(H,H,he.vec3.normalize(Y,Y))}const $=he.vec3.len(H);return $>0?he.vec3.scale(H,H,1/$):void 0};for(let P=d.min;P<d.max;P++){const A=h[P],I=this.prepareEdgePoints(s,c,A,(St,rr)=>St>=rr);if(I==null)continue;const k=I[0],j=I[1],F=he.vec3.fromValues(k.coord.x,k.coord.y,T*k.height),W=he.vec3.fromValues(j.coord.x,j.coord.y,T*j.height);if(he.vec3.exactEquals(F,W))continue;const H=he.vec3.sub(he.vec3.create(),W,F);he.vec3.normalize(H,H);const $=St=>he.vec3.normalize(St,St),Y=E(A.a)||H,ne=E(A.b)||H,oe=$(he.vec3.fromValues(Y[1],-Y[0],0)),ye=$(he.vec3.fromValues(ne[1],-ne[0],0)),pe=$(he.vec3.cross(he.vec3.create(),oe,Y)),me=$(he.vec3.cross(he.vec3.create(),ye,ne)),Me=he.vec3.create(),ve=[he.vec3.add(he.vec3.create(),F,he.vec3.scale(Me,he.vec3.sub(Me,oe,pe),M)),he.vec3.add(he.vec3.create(),F,he.vec3.scale(Me,he.vec3.add(Me,oe,pe),M)),he.vec3.add(he.vec3.create(),F,he.vec3.scale(Me,pe,M)),F],Ie=[he.vec3.add(he.vec3.create(),W,he.vec3.scale(Me,he.vec3.sub(Me,ye,me),M)),he.vec3.add(he.vec3.create(),W,he.vec3.scale(Me,he.vec3.add(Me,ye,me),M)),he.vec3.add(he.vec3.create(),W,he.vec3.scale(Me,me,M)),W],[Oe,Le]=t.addVertices(oe,m,ve[0],ve[1]),[Fe,je]=t.addVertices(ye,m,Ie[0],Ie[1]);t.addTriangles([Oe,Le,Fe,Le,je,Fe]);const[Xe,$e]=t.addVertices(pe,m,ve[1],ve[2]),[Ke,xt]=t.addVertices(me,m,Ie[1],Ie[2]);t.addTriangles([Xe,$e,Ke,$e,xt,Ke]);const[yt,Ut]=t.addVertices(he.vec3.negate(oe,oe),m,ve[2],ve[3]),[Et,Pt]=t.addVertices(he.vec3.negate(ye,ye),m,Ie[2],Ie[3]);t.addTriangles([yt,Ut,Et,Ut,Pt,Et])}}constructTunnelStructures(t,s,c,h,d,m){const x=T=>he.vec3.normalize(T,T);for(let T=d.min;T<d.max;T++){const M=this.prepareEdgePoints(s,c,h[T],(A,I)=>A<=I);if(M==null)continue;const[y,E]=M,P=x(he.vec3.fromValues(E.coord.y-y.coord.y,-(E.coord.x-y.coord.x),0));t.addQuad([y,E,{coord:E.coord,height:h[T].isTunnel?-.1:0},{coord:y.coord,height:h[T].isTunnel?-.1:0}],P)}for(let T=m.min;T<m.max;T++){const M=h[T],y=s[M.a],E=s[M.b],P=x(he.vec3.fromValues(E.y-y.y,-(E.x-y.x),0));t.addQuad([{coord:E,height:0},{coord:y,height:0},{coord:y,height:c[M.a]+4},{coord:E,height:c[M.b]+4}],P),t.addQuad([{coord:y,height:0},{coord:E,height:0},{coord:E,height:c[M.b]+4},{coord:y,height:c[M.a]+4}],P)}}prepareEdgePoints(t,s,c,h){const d=t[c.a],m=t[c.b];let x=s[c.a],T=s[c.b];if(!(x!==0&&h(x,0)||T!==0&&h(T,0)))return;const M=d.clone(),y=m.clone();if(h(x,0)){if(!h(T,0)){const E=T/(T-x);y.x=or(y.x,M.x,E),y.y=or(y.y,M.y,E),T=or(T,x,E)}}else{const E=x/(x-T);M.x=or(M.x,y.x,E),M.y=or(M.y,y.y,E),x=or(x,T,E)}return[{coord:M,height:x},{coord:y,height:T}]}prepareEdges(t,s){if(s.length===0)return;s.sort((x,T)=>x.hash===T.hash?T.polygonIdx-x.polygonIdx:T.hash>x.hash?1:-1);let c=0,h=0,d=0,m=s[c].polygonIdx;do h++,(h===s.length||s[c].hash!==s[h].hash)&&((h-c==1||s[h-1].polygonIdx!==m)&&(d<c&&(s[d]=s[c],s[c]=null),s[d].type="none",d++),c=h,c!==s.length&&(m=s[c].polygonIdx));while(c!==s.length);if(s.splice(d),s.length!==0&&t.length!==0){s.sort((M,y)=>M.hash<y.hash?1:-1);let x=0,T=0;for(;x!==s.length&&T!==t.length;){const M=s[x],y=t[T];M.portalHash>y.hash?x++:y.hash>M.portalHash?T++:(M.type=y.type,x++)}}}isOnBorder(t,s){return t<=0&&s<=0||t>=Rt&&s>=Rt}static computeEdgeHash(t,s){return(t.y===s.y&&t.x>s.x||t.y>s.y)&&([t,s]=[s,t]),BigInt(Da.computePosHash(t))<<32n|BigInt(Da.computePosHash(s))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}class _w{constructor(t,s){this.layoutVertexArray=new Ma,this.indexArray=new ji,this.lineIndexArray=new ml,this.triangleSegments=new Rn,this.lineSegments=new Rn,this.programConfigurations=new _l(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new Wl)}update(t,s,c,h,d,m,x){this.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zF.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,jF.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,s,c,h,d,m){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,h,d,m)}}class yw{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new _w(t,!1),this.elevationBufferData=new _w(t,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(t,s){}populate(t,s,c,h){this.hasPattern=dw("fill",this.layers,this.pixelRatio,s);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:T,index:M,sourceLayerIndex:y}of t){const E=this.layers[0]._featureFilter.needGeometry,P=z(x,E);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),P,c))continue;const A=d?d.evaluate(P,{},c,s.availableImages):void 0,I={id:T,properties:x.properties,type:x.type,sourceLayerIndex:y,index:M,geometry:E?P.geometry:N(x,c,h),patterns:{},sortKey:A};m.push(I)}d&&m.sort((x,T)=>x.sortKey-T.sortKey);for(const x of m){const{geometry:T,index:M,sourceLayerIndex:y}=x;if(this.hasPattern){const E=hw("fill",this.layers,x,this.zoom,this.pixelRatio,s);this.patternFeatures.push(E)}else this.addFeature(x,T,M,c,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(t[M].feature,T,M,y,this.index)}}update(t,s,c,h,d,m,x){this.bufferData.update(t,s,c,h,d,m,x),this.elevationBufferData.update(t,s,c,h,d,m,x)}addFeatures(t,s,c,h,d,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,h,m,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,s,c,h,d,m=[],x,T){const M=Wv(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,M,h,c,T):this.addGeometry(M,this.bufferData),this.bufferData.populatePaintArrays(t,c,d,m,h,x),this.elevationBufferData.populatePaintArrays(t,c,d,m,h,x)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t){this.elevatedStructures&&this.elevatedStructures.construct(t)}addElevatedRoadFeature(t,s,c,h,d){const m=new Array,x=this.getElevationFeature(t,d);if(x){m.push({polygons:s,elevationFeature:x,elevationTileID:c});for(const T of m)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Da(T.elevationTileID));const y=T.elevationFeature.isTunnel();let E=0;t.properties.hasOwnProperty(EA)&&(E=+t.properties[EA]);for(const P of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,P,y,T.elevationFeature,E)}const M=new e5(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,M,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h)}}else this.addGeometry(s,this.bufferData)}addElevatedGeometry(t,s,c,h,d){const m={elevation:c,elevationSampler:s,bias:h,index:d},[x,T]=this.addGeometry(t,this.elevationBufferData,m);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:x,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,x),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(t,s,c){let h=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,m=null;c&&(m=c.elevationSampler.constantElevation(c.elevation,c.bias),m!=null&&(h=m,d=m));const x=(T,M,y)=>{if(c!=null)if(M.push(T),m!=null)s.elevatedLayoutVertexArray.emplaceBack(m),y.push(m);else{const E=c.elevationSampler.pointElevation(T,c.elevation,c.bias);s.elevatedLayoutVertexArray.emplaceBack(E),y.push(E),h=Math.min(h,E),d=Math.max(d,E)}};for(const T of t){let M=0;for(const H of T)M+=H.length;const y=s.triangleSegments.prepareSegment(M,s.layoutVertexArray,s.indexArray),E=y.vertexLength,P=[],A=[],I=[],k=[],j=[],F=s.layoutVertexArray.length;for(const H of T){if(H.length===0)continue;H!==T[0]&&A.push(P.length/2);const $=s.lineSegments.prepareSegment(H.length,s.layoutVertexArray,s.lineIndexArray),Y=$.vertexLength;c&&j.push(s.layoutVertexArray.length-F),x(H[0],I,k),s.layoutVertexArray.emplaceBack(H[0].x,H[0].y),s.lineIndexArray.emplaceBack(Y+H.length-1,Y),P.push(H[0].x),P.push(H[0].y);for(let ne=1;ne<H.length;ne++)x(H[ne],I,k),s.layoutVertexArray.emplaceBack(H[ne].x,H[ne].y),s.lineIndexArray.emplaceBack(Y+ne-1,Y+ne),P.push(H[ne].x),P.push(H[ne].y);$.vertexLength+=H.length,$.primitiveLength+=H.length}const W=Ng(P,A);for(let H=0;H<W.length;H+=3)s.indexArray.emplaceBack(E+W[H],E+W[H+1],E+W[H+2]);if(c&&this.elevationMode==="hd-road-base"){const H=c.elevation.isTunnel(),$=c.elevation.safeArea,Y=this.elevatedStructures.addVertices(I,k);this.elevatedStructures.addTriangles(W,Y,H);const ne=j.length;if(ne>0){for(let oe=0;oe<ne-1;oe++)this.elevatedStructures.addRenderableRing(c.index,j[oe]+Y,j[oe+1]-j[oe],H,$);this.elevatedStructures.addRenderableRing(c.index,j[ne-1]+Y,I.length-j[ne-1],H,$)}}y.vertexLength+=M,y.primitiveLength+=W.length/3}return[h,d]}getElevationFeature(t,s){if(!s)return;const c=+t.properties[Zd];return c!=null?s.find(h=>h.id===c):void 0}}let MA,IA,PA,RA;Bt(yw,"FillBucket",{omit:["layers","patternFeatures"]}),Bt(_w,"FillBufferData"),Bt(Da,"ElevatedStructures");class vw{constructor(t,s,c,h){if(this.triangleCount=s.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[d,m]=[t[0].clone(),t[0].clone()];for(let E=1;E<t.length;++E){const P=t[E];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),m.x=Math.max(m.x,P.x),m.y=Math.max(m.y,P.y)}if(h){const E=Math.ceil(Math.max(m.x-d.x,m.y-d.y)/h);c=Math.max(c,E)}if(c===0)return;this.min=d,this.max=m;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const T=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/T)),this.cellsY=Math.max(1,Math.ceil(x.y/T)),this.xScale=1/T,this.yScale=1/T;const M=[];for(let E=0;E<this.triangleCount;E++){const P=t[s[3*E+0]].sub(this.min),A=t[s[3*E+1]].sub(this.min),I=t[s[3*E+2]].sub(this.min),k=xl(Math.floor(Math.min(P.x,A.x,I.x)),this.xScale,this.cellsX),j=xl(Math.floor(Math.max(P.x,A.x,I.x)),this.xScale,this.cellsX),F=xl(Math.floor(Math.min(P.y,A.y,I.y)),this.yScale,this.cellsY),W=xl(Math.floor(Math.max(P.y,A.y,I.y)),this.yScale,this.cellsY),H=new wt(0,0),$=new wt(0,0),Y=new wt(0,0),ne=new wt(0,0);for(let oe=F;oe<=W;++oe){H.y=$.y=oe*T,Y.y=ne.y=(oe+1)*T;for(let ye=k;ye<=j;++ye)H.x=Y.x=ye*T,$.x=ne.x=(ye+1)*T,(nt(P,A,I,H,$,ne)||nt(P,A,I,H,ne,Y))&&M.push({cellIdx:oe*this.cellsX+ye,triIdx:E})}}if(M.length===0)return;M.sort((E,P)=>E.cellIdx-P.cellIdx||E.triIdx-P.triIdx);let y=0;for(;y<M.length;){const E=M[y].cellIdx,P={start:this.payload.length,len:0};for(;y<M.length&&M[y].cellIdx===E;)++P.len,this.payload.push(M[y++].triIdx);this.cells[E]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,s){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=xl(t.x-this.min.x,this.xScale,this.cellsX),h=xl(t.y-this.min.y,this.yScale,this.cellsY),d=this.cells[h*this.cellsX+c];if(d){this._lazyInitLookup();for(let m=0;m<d.len;m++){const x=this.payload[d.start+m],T=Math.floor(x/8),M=1<<x%8;if(!(this.lookup[T]&M)&&(this.lookup[T]|=M,s.push(x),s.length===this.triangleCount))return}}}query(t,s,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>s.x||t.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const h=xl(t.x-this.min.x,this.xScale,this.cellsX),d=xl(s.x-this.min.x,this.xScale,this.cellsX),m=xl(t.y-this.min.y,this.yScale,this.cellsY),x=xl(s.y-this.min.y,this.yScale,this.cellsY);for(let T=m;T<=x;T++)for(let M=h;M<=d;M++){const y=this.cells[T*this.cellsX+M];if(y)for(let E=0;E<y.len;E++){const P=this.payload[y.start+E],A=Math.floor(P/8),I=1<<P%8;if(!(this.lookup[A]&I)&&(this.lookup[A]|=I,c.push(P),c.length===this.triangleCount))return}}}}function xl(l,t,s){return Math.max(0,Math.min(s-1,Math.floor(l*t)))}Bt(vw,"TriangleGridIndex");class kA{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(t,s){for(const c of this.footprints)s.push({footprint:c,id:t})}populate(t,s,c,h){const d=[];for(const{feature:m,id:x,index:T,sourceLayerIndex:M}of t){const y=this.layers[0]._featureFilter.needGeometry,E=z(m,y);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),E,c))continue;const P={id:x,properties:m.properties,type:m.type,sourceLayerIndex:M,index:T,geometry:y?E.geometry:N(m,c,h),patterns:{}};d.push(P)}for(const m of d){const{geometry:x,index:T,sourceLayerIndex:M}=m;this.addFeature(m,x,T,c,{},s.availableImages,s.brightness),s.featureIndex.insert(t[T].feature,x,T,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,s,c,h,d,m,x){}destroy(){}addFeature(t,s,c,h,d,m=[],x){for(const T of Wv(s,2)){const M=[],y=[],E=[],P=new wt(1/0,1/0),A=new wt(-1/0,-1/0);for(const j of T)if(j.length!==0){j!==T[0]&&E.push(y.length/2);for(let F=0;F<j.length;F++)y.push(j[F].x),y.push(j[F].y),M.push(j[F]),P.x=Math.min(P.x,j[F].x),P.y=Math.min(P.y,j[F].y),A.x=Math.max(A.x,j[F].x),A.y=Math.max(A.y,j[F].y)}const I=Ng(y,E),k=new vw(M,I,8,256);this.footprints.push({vertices:M,indices:I,grid:k,min:P,max:A})}}}Bt(kA,"ClipBucket",{omit:["layers"]});const r5=Jr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),n5=Jr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),i5=Jr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),s5=Jr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),o5=Jr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),a5=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:l5}=r5;class Kd extends wt{constructor(t,s,c){super(t,s),this.z=c}}class DA extends Kd{constructor(t,s,c,h){super(t,s,c),this.w=h}}function Xv(l,t,s,c){const h=[],d=c===0?(m,x,T,M,y,E)=>{m.push(new wt(E,T+(E-x)/(M-x)*(y-T)))}:(m,x,T,M,y,E)=>{m.push(new wt(x+(E-T)/(y-T)*(M-x),E))};for(const m of l){const x=[];for(const T of m){if(T.length<=2)continue;const M=[];for(let P=0;P<T.length-1;P++){const A=T[P].x,I=T[P].y,k=T[P+1].x,j=T[P+1].y,F=c===0?A:I,W=c===0?k:j;F<t?W>t&&d(M,A,I,k,j,t):F>s?W<s&&d(M,A,I,k,j,s):M.push(T[P]),W<t&&F>=t&&d(M,A,I,k,j,t),W>s&&F<=s&&d(M,A,I,k,j,s)}let y=T[T.length-1];const E=c===0?y.x:y.y;E>=t&&E<=s&&M.push(y),M.length&&(y=M[M.length-1],M[0].x===y.x&&M[0].y===y.y||M.push(M[0]),x.push(M))}x.length&&h.push(x)}return h}function LA(l,t,s,c){const h=s==="x"?"y":"x",d=(c-l[s])/(t[s]-l[s]);l[h]=l[h]+(t[h]-l[h])*d,l[s]=c,l.hasOwnProperty("z")&&(l.z=or(l.z,t.z,d)),l.hasOwnProperty("w")&&(l.w=or(l.w,t.w,d))}function NA(l,t,s,c){const h=s,d=c;for(const m of["x","y"]){let x=l,T=t;x[m]>=T[m]&&(x=t,T=l),x[m]<h&&T[m]>h&&LA(x,T,m,h),x[m]<d&&T[m]>d&&LA(T,x,m,d)}}const Kv=Number.MAX_SAFE_INTEGER;function OA(l,t,s,c){return l.order<t||l.order===Kv||!(l.clipMask&s)||function(h,d){return d.length!==0&&d.find(m=>m===h)===void 0}(c,l.clipScope)}function Yv(l,t){return l.x-t.x||l.y-t.y}function zA(l,t){return Yv(l.min,t.min)===0&&Yv(l.max,t.max)===0}function xw(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function bw(l,t){if(l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==t[s].sourceId||!zA(l[s],t[s])||l[s].order!==t[s].order||l[s].clipMask!==t[s].clipMask||!dn(l[s].clipScope,t[s].clipScope))return!1;return!0}function jA(l,t,s){const c=1/Rt,h=1/(1<<s.canonical.z),d=(t.x*c+s.canonical.x)*h+s.wrap,m=(t.y*c+s.canonical.y)*h;return{min:new wt((l.x*c+s.canonical.x)*h+s.wrap,(l.y*c+s.canonical.y)*h),max:new wt(d,m)}}function c5(l,t,s){const c=1<<s.canonical.z,h=((t.x-s.wrap)*c-s.canonical.x)*Rt,d=(t.y*c-s.canonical.y)*Rt;return{min:new wt(((l.x-s.wrap)*c-s.canonical.x)*Rt,(l.y*c-s.canonical.y)*Rt),max:new wt(h,d)}}function FA(l,t,s,c,h,d,m){const x=l.indices,T=l.vertices,M=[];for(let y=c;y<c+h;y+=3){const E=t[s[y+0]+d],P=t[s[y+1]+d],A=t[s[y+2]+d],I=Math.min(E.x,P.x,A.x),k=Math.max(E.x,P.x,A.x),j=Math.min(E.y,P.y,A.y),F=Math.max(E.y,P.y,A.y);M.length=0,l.grid.query(new wt(I,j),new wt(k,F),M);for(let W=0;W<M.length;W++){const H=M[W];if(nt(T[x[3*H+0]],T[x[3*H+1]],T[x[3*H+2]],E,P,A,m))return!0}}return!1}function BA(l,t,s,c){if(!l||!s)return!1;let h=l.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(s.vertices.length<l.vertices.length)return BA(s,c,l,t);const d=t.canonical,m=c.canonical,x=Math.pow(2,m.z-d.z);h=l.vertices.map(T=>new wt((T.x+d.x*Rt)*x-m.x*Rt,(T.y+d.y*Rt)*x-m.y*Rt))}return FA(s,h,l.indices,0,l.indices.length,0,0)}function UA(l,t,s,c){const h=Math.pow(2,c.z-s.z);return new wt((l+s.x*Rt)*h-c.x*Rt,(t+s.y*Rt)*h-c.y*Rt)}function VA(l,t){const s=[];t.grid.queryPoint(l,s);const c=t.indices,h=t.vertices;for(let d=0;d<s.length;d++){const m=s[d];if(Te([h[c[3*m+0]],h[c[3*m+1]],h[c[3*m+2]]],l))return!0}return!1}const ww=[new wt(0,0),new wt(Rt,0),new wt(Rt,Rt),new wt(0,Rt)];function $A(l,t){const s=[];let c=[];if(!t||l.length<2)return[l];if(l.length===2)return Re(l[0],l[1],ww)?[l]:[];for(let h=0;h<l.length+2;h++){const d=l[h%l.length],m=l[(h+1)%l.length],x=Re(h===0?l[l.length-1]:l[(h-1)%l.length],d,ww),T=Re(d,m,ww),M=x||T;M&&c.push(d),M&&T||c.length>0&&(c.length>1&&s.push(c),c=[])}return c.length>1&&s.push(c),s}const Sw=ou.VectorTileFeature.types,u5=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],d5=["fill-extrusion-flood-light-ground-radius"],h5=Math.pow(2,13),f5=Math.pow(2,15)-1,GA=new wt(0,1),au=2147483648;function Fg(l,t,s,c,h,d,m,x){l.emplaceBack((t<<1)+m,(s<<1)+d,(Math.floor(c*h5)<<1)+h,Math.round(x))}function Bg(l,t,s){l.emplaceBack(t.x*Rt,t.y*Rt,s?1:0)}function Jv(l,t,s,c,h,d){l.emplaceBack(t.x,t.y,(s.x<<1)+c,(s.y<<1)+h,d)}function Ug(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class qA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class HA{constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class WA{constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,s){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=s.x,t.min.y=t.max.y=s.y)}appendEdge(t,s,c){this.accCount++,this.acc._add(s);let h=!!this.borders;s.x<t.min.x?(t.min.x=s.x,h=!0):s.x>t.max.x&&(t.max.x=s.x,h=!0),s.y<t.min.y?(t.min.y=s.y,h=!0):s.y>t.max.y&&(t.max.y=s.y,h=!0),((s.x===0||s.x===Rt)&&s.x===c.x)!=((s.y===0||s.y===Rt)&&s.y===c.y)&&this.processBorderOverlap(s,c),h&&this.checkBorderIntersection(s,c)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,or(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>Rt!=t.x>Rt&&this.addBorderIntersection(1,or(s.y,t.y,(Rt-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,or(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>Rt!=t.y>Rt&&this.addBorderIntersection(3,or(s.x,t.x,(Rt-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0):0}}function ZA(l,t){const s=l.add(t)._unit(),c=Tr(l.x*s.x+l.y*s.y,-1,1);var h,d,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*f5*((h=l).x*(d=t).y-h.y*d.x<0?-1:1)}const p5=[l=>l.x<0,l=>l.x>Rt,l=>l.y<0,l=>l.y>Rt];function m5(l,t,s,c){const h=[4];if(c===0)return h;s._mult(c);const d=l.sub(s),m=t.sub(s),x=[l,t,d,m];for(let T=0;T<4;T++)for(const M of x)if(p5[T](M)){h.push(T);break}return h}class XA{constructor(t){this.vertexArray=new go,this.indexArray=new ji,this.programConfigurations=new _l(t.layers,{zoom:t.zoom,lut:t.lut},s=>d5.includes(s)),this._segments=new Rn,this.hiddenByLandmarkVertexArray=new Sg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Rn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,s,c,h=!1){const d=t.length;if(d>2){let m=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let T;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const M=t[0],y=t[1];T=ZA(M.sub(t[d-1])._perp()._unit(),y.sub(M)._perp()._unit())}for(let M=0;M<d;M++){const y=M===d-1?0:M+1,E=t[M],P=t[y],A=t[y===d-1?0:y+1],I=P.sub(E)._perp()._unit(),k=ZA(I,A.sub(P)._perp()._unit()),j=T,F=k;if(Tw(E,P,s)||h&&JA(E,s)&&JA(P,s)){T=k;continue}const W=x.vertexLength;Jv(this.vertexArray,E,P,1,1,j),Jv(this.vertexArray,E,P,1,0,j),Jv(this.vertexArray,E,P,0,1,F),Jv(this.vertexArray,E,P,0,0,F),x.vertexLength+=4;const H=m5(E,P,I,c);for(const $ of H)this._segmentToGroundQuads[m].push({id:W,region:$}),this._segmentToRegionTriCounts[m][$]+=2,x.primitiveLength+=2;T=k}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),s=t.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((h,d)=>h.region-d.region);for(let c=0;c<s;c++){const h=this._segmentToGroundQuads[c],d=t[c],m=this._segmentToRegionTriCounts[c];m.reduce((T,M)=>T+M,0);let x=0;for(let T=0;T<=4;T++){const M=m[T];if(M!==0){let y=this.regionSegments[T];y||(y=this.regionSegments[T]=new Rn);const E={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+x,vertexLength:d.vertexLength,primitiveLength:M};y.get().push(E)}x+=M}for(let T=0;T<h.length;T++){const M=h[T].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,s,c,h,d,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,s,c,h,d,m)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,n5.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,s,c,h,d,m,x){this.hasData()&&this.programConfigurations.updatePaintArrays(t,s,c,h,d,m,x)}updateHiddenByLandmark(t){if(!this.hasData())return;const s=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&au?1:0;for(let h=t.groundVertexArrayOffset;h<s;++h)this.hiddenByLandmarkVertexArray.emplace(h,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,o5.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const s=this.regionSegments[t];s&&s.destroy()}}}}class Qv{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ji,this.footprintVertices=new Ma,this.footprintSegments=[],this.layoutVertexArray=new Ia,this.centroidVertexArray=new Bd,this.wallVertexArray=new Ov,this.indexArray=new ji,this.programConfigurations=new _l(t.layers,{zoom:t.zoom,lut:t.lut},s=>u5.includes(s)),this.segments=new Rn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new XA(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,s){}populate(t,s,c,h){this.features=[],this.hasPattern=dw("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=p(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:m,index:x,sourceLayerIndex:T}of t){const M=this.layers[0]._featureFilter.needGeometry,y=z(d,M);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),y,c))continue;const E={id:m,sourceLayerIndex:T,index:x,geometry:M?y.geometry:N(d,c,h),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,A=Sw[E.type]==="Polygon";if(this.hasPattern)this.features.push(hw("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,s));else if(this.wallMode)for(const I of E.geometry)for(const k of $A(I,A))this.addFeature(E,[k],x,c,{},s.availableImages,h,s.brightness);else this.addFeature(E,E.geometry,x,c,{},s.availableImages,h,s.brightness);s.featureIndex.insert(d,E.geometry,x,T,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,s,c,h,d,m){for(const x of this.features){const T=Sw[x.type]==="Polygon",{geometry:M}=x;if(this.wallMode)for(const y of M)for(const E of $A(y,T))this.addFeature(x,[E],x.index,s,c,h,d,m);else this.addFeature(x,M,x.index,s,c,h,d,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,s,c,h,d,m,x){this.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x),this.groundEffect.update(t,s,d,c,h,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l5),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,s5.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,a5.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,i5.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,h,d,m,x,T){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,y=[new wt(0,0),new wt(Rt,Rt)],E=x.projection,P=E.name==="globe",A=this.wallMode||Sw[t.type]==="Polygon",I=new WA;I.centroidDataIndex=this.centroidData.length;const k=new HA,j=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},h)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},h);let W;if(k.height=F,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Af),this.wallMode){if(P)return void Cn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;W=function(me){const Me=me[0].x===me[me.length-1].x&&me[0].y===me[me.length-1].y;(function(Pt){let St=0;const rr=Pt.length;for(let zt=0;zt<rr;zt++)St+=(Pt[(zt+1)%rr].x-Pt[zt].x)*(Pt[(zt+1)%rr].y+Pt[zt].y);return St>=0})(me)||(me=me.reverse());const Ie={geometry:[],joinNormals:[],indices:[]},Oe=[],Le=[],Fe=[];let je=me.length;for(;je>=2&&me[je-1].equals(me[je-2]);)je--;if(je<(Me?3:2))return Ie;let Xe,$e,Ke,xt,yt,Ut=0;for(;Ut<je-1&&me[Ut].equals(me[Ut+1]);)Ut++;Me&&(Xe=me[je-2],yt=me[Ut].sub(Xe)._unit()._perp());for(let Pt=Ut;Pt<je;Pt++){if(Ke=Pt===je-1?Me?me[Ut+1]:void 0:me[Pt+1],Ke&&me[Pt].equals(Ke))continue;yt&&(xt=yt),Xe&&($e=Xe),Xe=me[Pt],yt=Ke?Ke.sub(Xe)._unit()._perp():xt,xt=xt||yt;let St=xt.add(yt);St.x===0&&St.y===0||St._unit();const rr=St.x*yt.x+St.y*yt.y,zt=rr!==0?1/rr:1/0,Wt=xt.x*yt.y-xt.y*yt.x>0;let cr="miter";const Mr=2;cr==="miter"&&zt>Mr&&(cr="bevel"),cr==="bevel"&&(zt>100&&(cr="flipbevel"),zt<Mr&&(cr="miter"));const fr=(Dr,Ar,Nr,Xr)=>{const yn=new wt(Dr.x,Dr.y),ur=new wt(Dr.x,Dr.y);yn.x+=Ar.x*Xr,yn.y+=Ar.y*Xr,ur.x-=Ar.x*Math.max(Nr,1),ur.y-=Ar.y*Math.max(Nr,1),Fe.push(Ar),Oe.push(yn),Le.push(ur)};if(cr==="miter")St._mult(zt),fr(Xe,St,0,0);else if(cr==="flipbevel")St=yt.mult(-1),fr(Xe,St,0,0),fr(Xe,St.mult(-1),0,0);else{const Dr=-Math.sqrt(zt*zt-1),Ar=Wt?Dr:0,Nr=Wt?0:Dr;$e&&fr(Xe,xt,Ar,Nr),Ke&&fr(Xe,yt,Ar,Nr)}}Ie.geometry=[...Oe,...Le.reverse(),Oe[0]],Ie.joinNormals=[...Fe,...Fe.reverse(),Fe[Fe.length-1]];const Et=Ie.geometry.length-1;for(let Pt=0;Pt<Et/2;Pt++)if(Pt+1<Et/2){let St=Pt,rr=Pt+1,zt=Et-1-Pt,Wt=Et-2-Pt;St=St===0?Et-1:St-1,rr=rr===0?Et-1:rr-1,zt=zt===0?Et-1:zt-1,Wt=Wt===0?Et-1:Wt-1,Ie.indices.push(zt),Ie.indices.push(rr),Ie.indices.push(St),Ie.indices.push(zt),Ie.indices.push(Wt),Ie.indices.push(rr)}return Ie}(s[0]),s=[W.geometry]}const H=(me,Me)=>me<(Me.length-1)/2||me===Me.length-1,$=this.wallMode?[s]:Wv(s,500);for(let me=$.length-1;me>=0;me--){const Me=$[me];(Me.length===0||(Y=Me[0]).every(ve=>ve.x<=0)||Y.every(ve=>ve.x>=Rt)||Y.every(ve=>ve.y<=0)||Y.every(ve=>ve.y>=Rt))&&$.splice(me,1)}var Y;let ne;if(P)ne=rM($,y,h);else{ne=[];for(const me of $)ne.push({polygon:me,bounds:y})}const oe=A?this.edgeRadius:0,ye=oe>0&&this.zoom<17,pe=(me,Me)=>{if(me.length===0)return!1;const ve=me[me.length-1];return Me.x===ve.x&&Me.y===ve.y};for(const{polygon:me,bounds:Me}of ne){let ve=0,Ie=0;for(const je of me)A&&!je[0].equals(je[je.length-1])&&je.push(je[0]),Ie+=A?je.length-1:je.length;const Oe=this.segments.prepareSegment((A?5:4)*Ie,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const Le={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Fe=new qA;if(Fe.vertexOffset=this.footprintVertices.length,Fe.indexOffset=3*this.footprintIndices.length,Fe.ringIndices=[],A){const je=[],Xe=[];ve=Oe.vertexLength;for(let Ke=0;Ke<me.length;Ke++){const xt=me[Ke];xt.length&&Ke!==0&&Xe.push(je.length/2);const yt=[];let Ut,Et;Ut=xt[1].sub(xt[0])._perp()._unit(),Fe.ringIndices.push(xt.length-1);for(let Pt=1;Pt<xt.length;Pt++){const St=xt[Pt],rr=xt[Pt===xt.length-1?1:Pt+1],zt=St.clone();if(oe){Et=rr.sub(St)._perp()._unit();const Wt=Ut.add(Et)._unit(),cr=oe*Math.min(4,1/(Ut.x*Wt.x+Ut.y*Wt.y));zt.x+=cr*Wt.x,zt.y+=cr*Wt.y,zt.x=Math.round(zt.x),zt.y=Math.round(zt.y),Ut=Et}if(!j||oe!==0&&!ye||pe(yt,zt)||yt.push(zt),Fg(this.layoutVertexArray,zt.x,zt.y,0,0,1,1,0),this.wallMode){const Wt=H(Pt,xt);Bg(this.wallVertexArray,W.joinNormals[Pt],!Wt)}Oe.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),je.push(St.x,St.y),P&&Ug(this.layoutVertexExtArray,E.projectTilePoint(zt.x,zt.y,h),E.upVector(h,zt.x,zt.y))}j&&(oe===0||ye)&&(yt.length!==0&&pe(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,Me,M))}const $e=this.wallMode?W.indices:Ng(je,Xe);for(let Ke=0;Ke<$e.length;Ke+=3)this.footprintIndices.emplaceBack(Fe.vertexOffset+$e[Ke+0],Fe.vertexOffset+$e[Ke+1],Fe.vertexOffset+$e[Ke+2]),this.indexArray.emplaceBack(ve+$e[Ke],ve+$e[Ke+2],ve+$e[Ke+1]),Oe.primitiveLength++;Fe.indexCount+=$e.length,Fe.vertexCount+=this.footprintVertices.length-Fe.vertexOffset}for(let je=0;je<me.length;je++){const Xe=me[je];I.startRing(k,Xe[0]);let $e=Xe.length>4&&QA(Xe[Xe.length-2],Xe[0],Xe[1]),Ke=oe?g5(Xe[Xe.length-2],Xe[0],Xe[1],oe):0;const xt=[];let yt,Ut,Et;Ut=Xe[1].sub(Xe[0])._perp()._unit();let Pt=!0;for(let St=1,rr=0;St<Xe.length;St++){let zt=Xe[St-1],Wt=Xe[St];const cr=Xe[St===Xe.length-1?1:St+1];if(I.appendEdge(k,Wt,zt),Tw(Wt,zt,Me)){oe&&(Ut=cr.sub(Wt)._perp()._unit(),Pt=!Pt);continue}const Mr=Wt.sub(zt)._perp(),fr=Mr.x/(Math.abs(Mr.x)+Math.abs(Mr.y)),Dr=Mr.y>0?1:0,Ar=zt.dist(Wt);if(rr+Ar>32768&&(rr=0),oe){Et=cr.sub(Wt)._perp()._unit();let ur=YA(zt,Wt,cr,KA(Ut,Et),oe);isNaN(ur)&&(ur=0);const $r=Wt.sub(zt)._unit();zt=zt.add($r.mult(Ke))._round(),Wt=Wt.add($r.mult(-ur))._round(),Ke=ur,Ut=Et,j&&this.zoom>=17&&(pe(xt,zt)||xt.push(zt),pe(xt,Wt)||xt.push(Wt))}const Nr=Oe.vertexLength,Xr=Xe.length>4&&QA(zt,Wt,cr);let yn=eM(rr,$e,Pt);if(Fg(this.layoutVertexArray,zt.x,zt.y,fr,Dr,0,0,yn),Fg(this.layoutVertexArray,zt.x,zt.y,fr,Dr,0,1,yn),this.wallMode){const ur=H(St-1,Xe),$r=W.joinNormals[St-1];Bg(this.wallVertexArray,$r,ur),Bg(this.wallVertexArray,$r,ur)}if(rr+=Ar,yn=eM(rr,Xr,!Pt),$e=Xr,Fg(this.layoutVertexArray,Wt.x,Wt.y,fr,Dr,0,0,yn),Fg(this.layoutVertexArray,Wt.x,Wt.y,fr,Dr,0,1,yn),this.wallMode){const ur=H(St,Xe),$r=W.joinNormals[St];Bg(this.wallVertexArray,$r,ur),Bg(this.wallVertexArray,$r,ur)}if(Oe.vertexLength+=4,this.indexArray.emplaceBack(Nr+0,Nr+1,Nr+2),this.indexArray.emplaceBack(Nr+1,Nr+3,Nr+2),Oe.primitiveLength+=2,oe){const ur=ve+(St===1?Xe.length-2:St-2),$r=St===1?ve:ur+1;if(this.indexArray.emplaceBack(Nr+1,ur,Nr+3),this.indexArray.emplaceBack(ur,$r,Nr+3),Oe.primitiveLength+=2,yt===void 0&&(yt=Nr),!Tw(cr,Xe[St],Me)){const In=St===Xe.length-1?yt:Oe.vertexLength;this.indexArray.emplaceBack(Nr+2,Nr+3,In),this.indexArray.emplaceBack(Nr+3,In+1,In),this.indexArray.emplaceBack(Nr+3,$r,In+1),Oe.primitiveLength+=3}Pt=!Pt}if(P){const ur=this.layoutVertexExtArray,$r=E.projectTilePoint(zt.x,zt.y,h),In=E.projectTilePoint(Wt.x,Wt.y,h),Nn=E.upVector(h,zt.x,zt.y),Bn=E.upVector(h,Wt.x,Wt.y);Ug(ur,$r,Nn),Ug(ur,$r,Nn),Ug(ur,In,Bn),Ug(ur,In,Bn)}}A&&(ve+=Xe.length-1),j&&oe&&this.zoom>=17&&(xt.length!==0&&pe(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,Me,M,oe>0))}this.footprintSegments.push(Fe),Le.triangleCount=this.indexArray.length-Le.triangleArrayOffset,this.polygonSegments.push(Le),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=I.borders?GA:this.encodeCentroid(I,k),this.centroidData.push(k),I.borders){this.featuresOnBorder.push(I);const me=this.featuresOnBorder.length-1;for(let Me=0;Me<I.borders.length;Me++)I.borders[Me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Me].push(me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,d,m,h,T),this.groundEffect.addPaintPropertiesData(t,c,d,m,h,T),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((s,c)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let x=0;x<this.centroidData.length;x++){const T=this.centroidData[x],M=+(T.min.y+T.max.y>Rt),y=2*M+(+(T.min.x+T.max.x>Rt)^M);for(let E=0;E<T.polygonSegLen;E++){const P=T.polygonSegIdx+E;t.push({centroidIdx:x,subtile:y,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const s=new ji;t.sort((x,T)=>x.triangleSegmentIdx===T.triangleSegmentIdx?x.subtile-T.subtile:x.triangleSegmentIdx-T.triangleSegmentIdx);let c=0,h=0,d=0;for(const x of t){if(x.triangleSegmentIdx!==c)break;d++}const m=t.length;for(;h!==t.length;){c=t[h].triangleSegmentIdx;let x=0,T=h,M=h;for(let y=T;y<d&&t[y].subtile===x;y++)M++;for(;T!==d;){const y=t[T];x=y.subtile;const E=this.centroidData[y.centroidIdx].min.clone(),P=this.centroidData[y.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let I=T;I<M;I++){const k=t[I],j=this.polygonSegments[k.polygonSegmentIdx],F=this.centroidData[k.centroidIdx].min,W=this.centroidData[k.centroidIdx].max,H=this.indexArray.uint16;for(let $=j.triangleArrayOffset;$<j.triangleArrayOffset+j.triangleCount;$++)s.emplaceBack(H[3*$],H[3*$+1],H[3*$+2]);A.primitiveLength+=j.triangleCount,E.x=Math.min(E.x,F.x),E.y=Math.min(E.y,F.y),P.x=Math.max(P.x,W.x),P.y=Math.max(P.y,W.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:E,max:P}),T=M;for(let I=T;I<d&&t[I].subtile===t[T].subtile;I++)M++}h=d;for(let y=h;y<m&&t[y].triangleSegmentIdx===t[h].triangleSegmentIdx;y++)d++}s._trim(),this.indexArray=s}getVisibleSegments(t,s,c){const h=new Rn;if(this.wallMode){for(const k of this.triangleSubSegments)h.segments.push(k.segment);return h}let d=0,m=0;const x=1<<t.canonical.z;if(s){const k=s.getMinMaxForTile(t);k&&(d=k.min,m=k.max)}m+=this.maxHeight;const T=t.toUnwrapped();let M;const y=[T.canonical.x/x+T.wrap,T.canonical.y/x],E=[(T.canonical.x+1)/x+T.wrap,(T.canonical.y+1)/x],P=(k,j,F)=>[k[0]*(1-F[0])+j[0]*F[0],k[1]*(1-F[1])+j[1]*F[1]],A=[],I=[];for(const k of this.triangleSubSegments){A[0]=k.min.x/Rt,A[1]=k.min.y/Rt,I[0]=k.max.x/Rt,I[1]=k.max.y/Rt;const j=P(y,E,A),F=P(y,E,I);if(new Xt([j[0],j[1],d],[F[0],F[1],m]).intersectsPrecise(c)===0){M&&(h.segments.push(M),M=void 0);continue}const W=k.segment;M&&M.vertexOffset!==W.vertexOffset&&(h.segments.push(M),M=void 0),M?(M.vertexLength+=W.vertexLength,M.primitiveLength+=W.primitiveLength):M={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&h.segments.push(M),h}encodeCentroid(t,s){const c=t.centroid(),h=s.span(),d=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new wt(Tr(c.x,1,Rt-1)<<3|d,Tr(c.y,1,Rt-1)<<3|m)}encodeBorderCentroid(t){if(!t.borders)return new wt(0,0);const s=t.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const h=s[0][0]!==c?0:1;return new wt(6|(s[0][0]!==c?0:65528),(s[h][0]+s[h][1])/2<<3|6)}{const h=s[2][0]!==c?2:3;return new wt((s[h][0]+s[h][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(t){const s=this.centroidData[t.centroidDataIndex];s.flags&=au,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const s=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,h=t.flags&au?GA:t.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==h.y||d!==h.x){for(let m=s;m<c;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(t.toUnwrapped());if(bw(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const d=[];for(const m of this.activeReplacements){if(m.order<c)continue;const x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-t.canonical.z));for(const T of this.centroidData)if(!(T.flags&au||m.min.x>T.max.x||T.min.x>m.max.x||m.min.y>T.max.y||T.min.y>m.max.y))for(let M=0;M<T.footprintSegLen;M++){const y=this.footprintSegments[T.footprintSegIdx+M];if(d.length=0,_5(this.footprintVertices,y.vertexOffset,y.vertexCount,m.footprintTileId.canonical,t.canonical,d),FA(m.footprint,d,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-x)){T.flags|=au;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,s,c){let h=!1;for(let d=0;d<c.footprintSegLen;d++){const m=this.footprintSegments[c.footprintSegIdx+d];let x=0;for(const T of m.ringIndices){for(let M=x,y=T+x-1;M<T+x;y=M++){const E=this.footprintVertices.int16[2*(M+m.vertexOffset)+0],P=this.footprintVertices.int16[2*(M+m.vertexOffset)+1],A=this.footprintVertices.int16[2*(y+m.vertexOffset)+1];P>s!=A>s&&t<(this.footprintVertices.int16[2*(y+m.vertexOffset)+0]-E)*(s-P)/(A-P)+E&&(h=!h)}x=T}}return h}getHeightAtTileCoord(t,s){let c=Number.NEGATIVE_INFINITY,h=!0;const d=4*(t+Rt)*Rt+(s+Rt);if(this.partLookup.hasOwnProperty(d)){const m=this.partLookup[d];return m?{height:m.height,hidden:!!(m.flags&au)}:void 0}for(const m of this.centroidData)t>m.max.x||m.min.x>t||s>m.max.y||m.min.y>s||this.footprintContainsPoint(t,s,m)&&m&&m.height>c&&(c=m.height,this.partLookup[d]=m,h=!!(m.flags&au));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[d]=void 0}}function KA(l,t){const s=l.add(t)._unit();return l.x*s.x+l.y*s.y}function g5(l,t,s,c){const h=t.sub(l)._perp()._unit(),d=s.sub(t)._perp()._unit();return YA(l,t,s,KA(h,d),c)}function YA(l,t,s,c,h){const d=Math.sqrt(1-c*c);return Math.min(l.dist(t)/3,t.dist(s)/3,h*d/c)}function Tw(l,t,s){return l.x<s[0].x&&t.x<s[0].x||l.x>s[1].x&&t.x>s[1].x||l.y<s[0].y&&t.y<s[0].y||l.y>s[1].y&&t.y>s[1].y}function JA(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function QA(l,t,s){if(l.x<0||l.x>=Rt||t.x<0||t.x>=Rt||s.x<0||s.x>=Rt)return!1;const c=s.sub(t),h=c.perp(),d=l.sub(t);return(c.x*d.x+c.y*d.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(d.x*d.x+d.y*d.y))>-.866&&h.x*d.x+h.y*d.y<0}function eM(l,t,s){const c=t?2|l:-3&l;return s?1|c:-2&c}function tM(){const l=Math.PI/32,t=Math.tan(l),s=Jl;return s*Math.sqrt(1+2*t*t)-s}function rM(l,t,s){const c=1<<s.z,h=Ls(s.x/c),d=Ls((s.x+1)/c),m=Fi(s.y/c),x=Fi((s.y+1)/c);return function(T,M,y,E,P=0,A){const I=[];if(!T.length||!y||!E)return I;const k=(ne,oe)=>{for(const ye of ne)I.push({polygon:ye,bounds:oe})},j=Math.ceil(Math.log2(y)),F=Math.ceil(Math.log2(E)),W=j-F,H=[];for(let ne=0;ne<Math.abs(W);ne++)H.push(W>0?0:1);for(let ne=0;ne<Math.min(j,F);ne++)H.push(0),H.push(1);let $=T;if($=Xv($,M[0].y-P,M[1].y+P,1),$=Xv($,M[0].x-P,M[1].x+P,0),!$.length)return I;const Y=[];for(H.length?Y.push({polygons:$,bounds:M,depth:0}):k($,M);Y.length;){const ne=Y.pop(),oe=ne.depth,ye=H[oe],pe=ne.bounds[0],me=ne.bounds[1],Me=ye===0?pe.x:pe.y,ve=ye===0?me.x:me.y,Ie=A?A(ye,Me,ve):.5*(Me+ve),Oe=Xv(ne.polygons,Me-P,Ie+P,ye),Le=Xv(ne.polygons,Ie-P,ve+P,ye);if(Oe.length){const Fe=[pe,new wt(ye===0?Ie:me.x,ye===1?Ie:me.y)];H.length>oe+1?Y.push({polygons:Oe,bounds:Fe,depth:oe+1}):k(Oe,Fe)}if(Le.length){const Fe=[new wt(ye===0?Ie:pe.x,ye===1?Ie:pe.y),me];H.length>oe+1?Y.push({polygons:Le,bounds:Fe,depth:oe+1}):k(Le,Fe)}}return I}(l,t,Math.ceil((d-h)/11.25),Math.ceil((m-x)/11.25),1,(T,M,y)=>{if(T===0)return .5*(M+y);{const E=Fi((s.y+M/Rt)/c);return(Ds(.5*(Fi((s.y+y/Rt)/c)+E))*c-s.y)*Rt}})}function _5(l,t,s,c,h,d){const m=Math.pow(2,c.z-h.z);for(let x=0;x<s;x++){let T=l.int16[2*(x+t)+0],M=l.int16[2*(x+t)+1];T=(T+h.x*Rt)*m-c.x*Rt,M=(M+h.y*Rt)*m-c.y*Rt,d.push(new wt(T,M))}}let nM,iM;function Vg(l,t){return l.x*t.x+l.y*t.y}function sM(l,t){if(l.length===1){let s=0;const c=t[s++];let h;for(;!h||c.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const d=t[s],m=l[0],x=h.sub(c),T=d.sub(c),M=m.sub(c),y=Vg(x,x),E=Vg(x,T),P=Vg(T,T),A=Vg(M,x),I=Vg(M,T),k=y*P-E*E,j=(P*A-E*I)/k,F=(y*I-E*A)/k,W=c.z*(1-j-F)+h.z*j+d.z*F;if(isFinite(W))return W}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}function oM(l,t,s,c,h,d,m,x){const T=m*h.getElevationAt(l,t,!0,!0),M=d[0]!==0,y=M?d[1]===0?m*(d[0]/7-450):m*function(E,P,A){const I=Math.floor(P[0]/8),k=Math.floor(P[1]/8),j=10*(P[0]-8*I),F=10*(P[1]-8*k),W=E.getElevationAt(I,k,!0,!0),H=E.getMeterToDEM(A),$=Math.floor(.5*(j*H-1)),Y=Math.floor(.5*(F*H-1)),ne=E.tileCoordToPixel(I,k),oe=2*$+1,ye=2*Y+1,pe=function(Le,Fe,je,Xe,$e){return[Le.getElevationAtPixel(Fe,je,!0),Le.getElevationAtPixel(Fe+$e,je,!0),Le.getElevationAtPixel(Fe,je+$e,!0),Le.getElevationAtPixel(Fe+Xe,je+$e,!0)]}(E,ne.x-$,ne.y-Y,oe,ye),me=Math.abs(pe[0]-pe[1]),Me=Math.abs(pe[2]-pe[3]),ve=Math.abs(pe[0]-pe[2])+Math.abs(pe[1]-pe[3]),Ie=Math.min(.25,.5*H*(me+Me)/oe),Oe=Math.min(.25,.5*H*ve/ye);return W+Math.max(Ie*j,Oe*F)}(h,d,x):T;return{base:T+(s===0?-1:s),top:M?Math.max(y+c,T+s+2):T+c}}Bt(Qv,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(HA,"PartData"),Bt(qA,"FootprintSegment"),Bt(WA,"BorderCentroidData"),Bt(XA,"GroundEffect");const y5=Jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),v5=Jr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:x5}=y5,b5=Jr([{name:"a_packed",components:3,type:"Float32"}]),{members:w5}=b5,S5=Jr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:T5}=S5;class aM{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new su({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const c=this.getKey(t,s);return this.positions[c]}trim(){const t=this.width,s=this.height=Ao(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,c){const h=[];let d=t.length%2==1?-t[t.length-1]*c:0,m=t[0]*c,x=!0;h.push({left:d,right:m,isDash:x,zeroLength:t[0]===0});let T=t[0];for(let M=1;M<t.length;M++){x=!x;const y=t[M];d=T*c,T+=y,m=T*c,h.push({left:d,right:m,isDash:x,zeroLength:y===0})}return h}addRoundDash(t,s,c){const h=s/2;for(let d=-c;d<=c;d++){const m=this.width*(this.nextRow+c+d);let x=0,T=t[x];for(let M=0;M<this.width;M++){M/T.right>1&&(T=t[++x]);const y=Math.abs(M-T.left),E=Math.abs(M-T.right),P=Math.min(y,E);let A;const I=d/c*(h+1);if(T.isDash){const k=h-Math.abs(I);A=Math.sqrt(P*P+k*k)}else A=h-Math.sqrt(P*P+I*I);this.image.data[m+M]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(t,s){for(let T=t.length-1;T>=0;--T){const M=t[T],y=t[T+1];M.zeroLength?t.splice(T,1):y&&y.isDash===M.isDash&&(y.left=M.left,t.splice(T,1))}const c=t[0],h=t[t.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const d=this.width*this.nextRow;let m=0,x=t[m];for(let T=0;T<this.width;T++){T/x.right>1&&(x=t[++m]);const M=Math.abs(T-x.left),y=Math.abs(T-x.right),E=Math.min(M,y);this.image.data[d+T]=Math.max(0,Math.min(255,(x.isDash?E:-E)+s+128))}}addDash(t,s){const c=this.getKey(t,s);if(this.positions[c])return this.positions[c];const h=s==="round",d=h?7:0,m=2*d+1;if(this.nextRow+m>this.height)return Cn("LineAtlas out of space"),null;t.length===0&&t.push(1);let x=0;for(let y=0;y<t.length;y++)t[y]<0&&(Cn("Negative value is found in line dasharray, replacing values with 0"),t[y]=0),x+=t[y];if(x!==0){const y=this.width/x,E=this.getDashRanges(t,this.width,y);h?this.addRoundDash(E,y,d):this.addRegularDash(E,s==="square"?.5*y:0)}const T=this.nextRow+d;this.nextRow+=m;const M={tl:[T,d],br:[x,0]};return this.positions[c]=M,M}}Bt(aM,"LineAtlas");const E5=ou.VectorTileFeature.types,C5=Math.cos(Math.PI/180*37.5),A5=Math.cos(Math.PI/180*5);class Ew{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new pg,this.layoutVertexArray2=new Lo,this.patternVertexArray=new Lo,this.indexArray=new ji,this.programConfigurations=new _l(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Rn,this.maxLineLength=0,this.zOffsetVertexArray=new Lo,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:Rt/64}updateFootprints(t,s){}populate(t,s,c,h){this.hasPattern=dw("line",this.layers,this.pixelRatio,s);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=p(c);const m=this.layers[0].layout.get("line-z-offset"),x=m.isConstant()&&!m.constantOr(0),T=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=T==="sea"||T==="ground"||!x&&T==="none",this.hasZOffset&&T==="none"&&Cn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const M=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&M!==void 0;const y=[];for(const{feature:I,id:k,index:j,sourceLayerIndex:F}of t){const W=this.layers[0]._featureFilter.needGeometry,H=z(I,W);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),H,c))continue;const $=d?d.evaluate(H,{},c):void 0,Y={id:k,properties:I.properties,type:I.type,sourceLayerIndex:F,index:j,geometry:W?H.geometry:N(I,c,h),patterns:{},sortKey:$};y.push(Y)}d&&y.sort((I,k)=>I.sortKey-k.sortKey);const{lineAtlas:E,featureIndex:P}=s,A=this.addConstantDashes(E);for(const I of y){const{geometry:k,index:j,sourceLayerIndex:F}=I;if(A&&this.addFeatureDashes(I,E),this.hasPattern){const W=hw("line",this.layers,I,this.zoom,this.pixelRatio,s);this.patternFeatures.push(W)}else this.addFeature(I,k,j,c,E.positions,s.availableImages,s.brightness);P.insert(t[j].feature,k,j,F,this.index)}}addConstantDashes(t){let s=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,d=c.layout.get("line-cap").value;if(h.kind!=="constant"||d.kind!=="constant")s=!0;else{const m=d.value,x=h.value;if(!x)continue;t.addDash(x,m)}}return s}addFeatureDashes(t,s){const c=this.zoom;for(const h of this.layers){const d=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let x,T;if(d.kind==="constant"){if(x=d.value,!x)continue}else x=d.evaluate({zoom:c},t);T=m.kind==="constant"?m.value:m.evaluate({zoom:c},t),s.addDash(x,T),t.patterns[h.id]=s.getKey(x,T)}}update(t,s,c,h,d,m,x){this.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x)}addFeatures(t,s,c,h,d,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,w5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,T5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,v5.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x5),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,h,d,m,x){const T=this.layers[0].layout,M=T.get("line-join").evaluate(t,{}),y=T.get("line-cap").evaluate(t,{}),E=T.get("line-miter-limit"),P=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=T.get("line-z-offset").value;const A=this.layers[0].paint.get("line-width").value;A.kind!=="constant"&&A.isLineProgressConstant===!1&&(this.variableWidthValue=A);for(const I of s)this.addLine(I,t,h,M,y,E,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,d,m,h,x)}addLine(t,s,c,h,d,m,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=h==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<t.length-1;H++)this.totalDistance+=t[H].dist(t[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=E5[s.type]==="Polygon";let y=t.length;for(;y>=2&&t[y-1].equals(t[y-2]);)y--;let E=0;for(;E<y-1&&t[E].equals(t[E+1]);)E++;if(y<(M?3:2))return;h==="bevel"&&(m=1.05);const P=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let A,I,k,j,F,W;this.e1=this.e2=-1,M&&(A=t[y-2],F=t[E].sub(A)._unit()._perp());for(let H=E;H<y;H++){if(k=H===y-1?M?t[E+1]:void 0:t[H+1],k&&t[H].equals(k))continue;F&&(j=F),A&&(I=A),A=t[H],W=this.evaluateLineProgressFeatures(I?I.dist(A):0),F=k?k.sub(A)._unit()._perp():j,j=j||F;const $=I&&k;let Y=$?h:M||T?"butt":d;const ne=j.x*F.x+j.y*F.y;if(T){const Oe=function(Le){if(Le.patternJoinNone){const Fe=Le.segmentPoints.length/2,je=Le.lineSoFar-Le.segmentStart;for(let Xe=0;Xe<Fe;++Xe){const $e=Le.segmentPoints[2*Xe+1],Ke=Math.round(Le.segmentPoints[2*Xe])+.5+.25*$e;Le.patternVertexArray.emplaceBack(Ke,je,Le.segmentStart),Le.patternVertexArray.emplaceBack(Ke,je,Le.segmentStart)}Le.segmentPoints.length=0}Le.e1=Le.e2=-1};if($&&ne<A5){this.updateDistance(I,A),this.addCurrentVertex(A,j,1,1,P,W),Oe(this),this.addCurrentVertex(A,F,-1,-1,P,W);continue}if(I){if(!k){this.updateDistance(I,A),this.addCurrentVertex(A,j,1,1,P,W),Oe(this);continue}Y="miter"}}let oe=j.add(F);oe.x===0&&oe.y===0||oe._unit();const ye=oe.x*F.x+oe.y*F.y,pe=ye!==0?1/ye:1/0,me=2*Math.sqrt(2-2*ye),Me=ye<C5&&I&&k,ve=j.x*F.y-j.y*F.x>0,Ie=this.overscaling<=16?15*Rt/(512*this.overscaling):0;if($&&Y==="round"){if(pe<x)Y="miter";else if(pe<=2){const Oe=Cw(A,-10,Rt+10);Y=this.hasZOffset&&(Oe||this.hasCrossSlope)?"miter":"fakeround"}}if(Y==="miter"&&pe>m&&(Y="bevel"),Y==="bevel"&&(pe>2&&(Y="flipbevel"),pe<m&&(Y="miter")),I&&!(Y==="miter"&&Me)&&this.updateDistance(I,A),Y==="miter")if(Me){const Oe=A.dist(I);if(Oe>2*Ie){const Fe=A.sub(A.sub(I)._mult(Ie/Oe)._round());this.updateDistance(I,Fe),this.addCurrentVertex(Fe,j,0,0,P,W),I=Fe}this.updateDistance(I,A),oe._mult(pe),this.addCurrentVertex(A,oe,0,0,P,W);const Le=A.dist(k);if(Le>2*Ie){const Fe=A.add(k.sub(A)._mult(Ie/Le)._round());this.updateDistance(A,Fe),this.addCurrentVertex(Fe,F,0,0,P,W),A=Fe}}else oe._mult(pe),this.addCurrentVertex(A,oe,0,0,P,W);else if(Y==="flipbevel"){if(pe>100)oe=F.mult(-1);else{const Oe=pe*j.add(F).mag()/j.sub(F).mag();oe._perp()._mult(Oe*(ve?-1:1))}this.addCurrentVertex(A,oe,0,0,P,W),this.addCurrentVertex(A,oe.mult(-1),0,0,P,W)}else if(Y==="bevel"||Y==="fakeround"){W!=null&&I&&this.addCurrentVertex(A,j,-1,-1,P,W);const Oe=A.dist(I)<=2*Ie&&Y!=="bevel",Le=oe.mult(ve?1:-1);Le._mult(pe);const Fe=F.mult(ve?-1:1),je=j.mult(ve?-1:1),Xe=this.evaluateLineProgressFeatures(this.distance);if(W==null&&(this.addHalfVertex(A,Le.x,Le.y,!1,!ve,0,P,Xe),Oe||this.addHalfVertex(A,Le.x+2*je.x,Le.y+2*je.y,!1,ve,0,P,Xe)),Y==="fakeround"){const $e=Math.round(180*me/Math.PI/20);this.addHalfVertex(A,je.x,je.y,!1,ve,0,P,Xe);for(let Ke=0;Ke<$e;Ke++){let xt=Ke/$e;if(xt!==.5){const Ut=xt-.5;xt+=xt*Ut*(xt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Ut*Ut+(.848013+ne*(.215638*ne-1.06021)))}const yt=Fe.sub(je)._mult(xt)._add(je)._unit();this.addHalfVertex(A,yt.x,yt.y,!1,ve,0,P,Xe)}this.addHalfVertex(A,Fe.x,Fe.y,!1,ve,0,P,Xe)}Oe||W!=null||this.addHalfVertex(A,Le.x+2*Fe.x,Le.y+2*Fe.y,!1,ve,0,P,Xe),W!=null&&k&&this.addCurrentVertex(A,F,1,1,P,W)}else Y==="butt"?this.addCurrentVertex(A,oe,0,0,P,W):Y==="square"?(I||this.addCurrentVertex(A,oe,-1,-1,P,W),this.addCurrentVertex(A,oe,0,0,P,W),I&&this.addCurrentVertex(A,oe,1,1,P,W)):Y==="round"&&(I&&(this.addCurrentVertex(A,j,0,0,P,W),this.addCurrentVertex(A,j,1,1,P,W,!0)),k&&(this.addCurrentVertex(A,F,-1,-1,P,W,!0),this.addCurrentVertex(A,F,0,0,P,W)))}}addVerticesTo(t,s,c,h,d,m,x,T,M,y){const E=(s.w-t.w)/this.tessellationStep|0;let P=0;const A=this.scaledDistance;if(E>1){this.lineSoFar=t.w;const k=(s.x-t.x)/E,j=(s.y-t.y)/E,F=(s.z-t.z)/E,W=(s.w-t.w)/E;for(let H=1;H<E;++H){t.x+=k,t.y+=j,t.z+=F,this.lineSoFar+=W,P+=W;const $=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(t,c,h,y,!1,x,M,$),this.addHalfVertex(t,d,m,y,!0,-T,M,$)}}this.lineSoFar=s.w,this.scaledDistance=A;const I=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,c,h,y,!1,x,M,I),this.addHalfVertex(s,d,m,y,!0,-T,M,I)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Cn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}:{zOffset:0,variableWidth:s}}addCurrentVertex(t,s,c,h,d,m,x=!1){const T=s.x+s.y*c,M=s.y-s.x*c,y=s.y*h-s.x,E=-s.y-s.x*h;if(m!=null){const P=this.hasZOffset,A=-10,I=Rt+10,k=m.zOffset,j=new DA(t.x,t.y,k,this.lineSoFar),F=!!P&&Cw(t,A,I),W=this.lineSoFar,H=this.distance;if(this.currentVertex)if(F){const $=this.currentVertexIsOutside,Y=this.currentVertex,ne=new DA(t.x,t.y,k,this.lineSoFar);if(NA(Y,ne,A,I),!Cw(ne,A,I)){if($){this.e1=this.e2=-1,this.distance-=Y.dist(j),this.lineSoFar=Y.w;const oe=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,T,M,x,!1,c,d,oe),this.addHalfVertex(Y,y,E,x,!0,-h,d,oe),this.prevDistance=this.distance}this.distance=this.prevDistance+Y.dist(ne),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Y,ne,T,M,y,E,c,h,d,x),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const $=this.currentVertex;if(this.currentVertexIsOutside){NA($,j,A,I),this.e1=this.e2=-1,this.distance-=$.dist(j),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=$.w;const Y=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,T,M,x,!1,c,d,Y),this.addHalfVertex($,y,E,x,!0,-h,d,Y),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo($,j,T,M,y,E,c,h,d,x)}else F||(this.addHalfVertex(t,T,M,x,!1,c,d,m),this.addHalfVertex(t,y,E,x,!0,-h,d,m));this.currentVertex=j,this.currentVertexIsOutside=F,this.lineSoFar=W}else this.addHalfVertex(t,T,M,x,!1,c,d,m),this.addHalfVertex(t,y,E,x,!0,-h,d,m)}addHalfVertex({x:t,y:s},c,h,d,m,x,T,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(s<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=or(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const y=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),T.primitiveLength++),m?this.e2=y:this.e1=y,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,s){this.prevDistance=this.distance,this.distance+=t.dist(s),this.updateScaledDistance()}}function Cw(l,t,s){return l.x<t||l.x>s||l.y<t||l.y>s}let lM,cM;function uM(l,t,s){return t*(Rt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Bt(Ew,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const dM=(l,t,s)=>(1-s)*l+s*t;function hM(l,t){return 1/uM(l,1,t.tileZoom)}function fM(l,t,s,c){return l.translatePosMatrix(c||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const pM=l=>{const t=[];mM(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=l.layout.get("line-join").constantOr("miter")==="none",h=!!l.paint.get("line-pattern").constantOr(1);return c&&h&&t.push("LINE_JOIN_NONE"),t};function mM(l){const t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Aw;const gM=()=>Aw||(Aw={layout:lM||(lM=new Fn({"line-cap":new Ft(Ye.layout_line["line-cap"]),"line-join":new Ft(Ye.layout_line["line-join"]),"line-miter-limit":new It(Ye.layout_line["line-miter-limit"]),"line-round-limit":new It(Ye.layout_line["line-round-limit"]),"line-sort-key":new Ft(Ye.layout_line["line-sort-key"]),"line-z-offset":new Ft(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new It(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new It(Ye.layout_line["line-cross-slope"]),visibility:new It(Ye.layout_line.visibility),"line-width-unit":new It(Ye.layout_line["line-width-unit"])})),paint:cM||(cM=new Fn({"line-opacity":new Ft(Ye.paint_line["line-opacity"]),"line-color":new Ft(Ye.paint_line["line-color"]),"line-translate":new It(Ye.paint_line["line-translate"]),"line-translate-anchor":new It(Ye.paint_line["line-translate-anchor"]),"line-width":new Ft(Ye.paint_line["line-width"]),"line-gap-width":new Ft(Ye.paint_line["line-gap-width"]),"line-offset":new Ft(Ye.paint_line["line-offset"]),"line-blur":new Ft(Ye.paint_line["line-blur"]),"line-dasharray":new Ft(Ye.paint_line["line-dasharray"]),"line-pattern":new Ft(Ye.paint_line["line-pattern"]),"line-gradient":new Xc(Ye.paint_line["line-gradient"]),"line-trim-offset":new It(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new It(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new It(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new It(Ye.paint_line["line-emissive-strength"]),"line-border-width":new Ft(Ye.paint_line["line-border-width"]),"line-border-color":new Ft(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new It(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},Aw);class M5 extends Ft{possiblyEvaluate(t,s){return s=new _n(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,h){return s=gi({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,h)}}let $g;function _M(l,t){return t>0?t+2*l:l}const I5=Jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),P5=Jr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),R5=Jr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const k5=Jr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),D5=Jr([{name:"a_texb",components:2,type:"Uint16"}]),L5=Jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),N5=Jr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yM=Jr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),O5=Jr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Jr([{name:"triangle",components:3,type:"Uint16"}]),Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Jr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Jr([{type:"Float32",name:"offsetX"}]),Jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Wi=24;const La=128;function vM(l,t,s,c,h){if(l.kind==="camera")return l.maxSize;if(l.kind==="composite"){const d=t.possiblyEvaluate(new _n(l.maxZoom),s).evaluate(h,{},s),m=t.possiblyEvaluate(new _n(l.minZoom),s).evaluate(h,{},s);return Math.max(d,m)}return t.possiblyEvaluate(new _n(c)).evaluate(h,{},s)}function Mw(l,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new _n(l+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=s;let d=0;for(;d<c.length&&c[d]<=l;)d++;d=Math.max(0,d-1);let m=d;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);const x=c[d],T=c[m];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:T,minSize:s.evaluate(new _n(x)),maxSize:s.evaluate(new _n(T)),interpolationType:h}}}function e0(l,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:h}){return l.kind==="source"?c/La:l.kind==="composite"?or(c/La,h/La,s):t}function Uf(l,t,s=1){let c=0,h=0;if(l.kind==="constant")h=l.layoutSize*s;else if(l.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:x}=l,T=d?Tr(Ws.interpolationFactor(d,t,m,x),0,1):0;l.kind==="camera"?h=or(l.minSize,l.maxSize,T)*s:c=T*s}return{uSizeT:c,uSize:h}}var z5=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:La,evaluateSizeForFeature:e0,evaluateSizeForZoom:Uf,getRasterizedIconSize:vM,getSizeData:Mw});function j5(l,t,s){return l.sections.forEach(c=>{c.text=function(h,d,m){const x=d.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),mo.applyArabicShaping&&(h=mo.applyArabicShaping(h)),h}(c.text,t,s)}),l}const Gg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function F5(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function B5(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}var xM,Iw,bM,Pw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function U5(){return xM||(xM=1,Pw.read=function(l,t,s,c,h){var d,m,x=8*h-c-1,T=(1<<x)-1,M=T>>1,y=-7,E=s?h-1:0,P=s?-1:1,A=l[t+E];for(E+=P,d=A&(1<<-y)-1,A>>=-y,y+=x;y>0;d=256*d+l[t+E],E+=P,y-=8);for(m=d&(1<<-y)-1,d>>=-y,y+=c;y>0;m=256*m+l[t+E],E+=P,y-=8);if(d===0)d=1-M;else{if(d===T)return m?NaN:1/0*(A?-1:1);m+=Math.pow(2,c),d-=M}return(A?-1:1)*m*Math.pow(2,d-c)},Pw.write=function(l,t,s,c,h,d){var m,x,T,M=8*d-h-1,y=(1<<M)-1,E=y>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=c?0:d-1,I=c?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,m=y):(m=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-m))<1&&(m--,T*=2),(t+=m+E>=1?P/T:P*Math.pow(2,1-E))*T>=2&&(m++,T/=2),m+E>=y?(x=0,m=y):m+E>=1?(x=(t*T-1)*Math.pow(2,h),m+=E):(x=t*Math.pow(2,E-1)*Math.pow(2,h),m=0));h>=8;l[s+A]=255&x,A+=I,x/=256,h-=8);for(m=m<<h|x,M+=h;M>0;l[s+A]=255&m,A+=I,m/=256,M-=8);l[s+A-I]|=128*k}),Pw}function wM(){if(bM)return Iw;bM=1,Iw=t;var l=U5();function t($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var s=4294967296,c=1/s,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d($){return $.type===t.Bytes?$.readVarint()+$.pos:$.pos+1}function m($,Y,ne){return ne?4294967296*Y+($>>>0):4294967296*(Y>>>0)+($>>>0)}function x($,Y,ne){var oe=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));ne.realloc(oe);for(var ye=ne.pos-1;ye>=$;ye--)ne.buf[ye+oe]=ne.buf[ye]}function T($,Y){for(var ne=0;ne<$.length;ne++)Y.writeVarint($[ne])}function M($,Y){for(var ne=0;ne<$.length;ne++)Y.writeSVarint($[ne])}function y($,Y){for(var ne=0;ne<$.length;ne++)Y.writeFloat($[ne])}function E($,Y){for(var ne=0;ne<$.length;ne++)Y.writeDouble($[ne])}function P($,Y){for(var ne=0;ne<$.length;ne++)Y.writeBoolean($[ne])}function A($,Y){for(var ne=0;ne<$.length;ne++)Y.writeFixed32($[ne])}function I($,Y){for(var ne=0;ne<$.length;ne++)Y.writeSFixed32($[ne])}function k($,Y){for(var ne=0;ne<$.length;ne++)Y.writeFixed64($[ne])}function j($,Y){for(var ne=0;ne<$.length;ne++)Y.writeSFixed64($[ne])}function F($,Y){return($[Y]|$[Y+1]<<8|$[Y+2]<<16)+16777216*$[Y+3]}function W($,Y,ne){$[ne]=Y,$[ne+1]=Y>>>8,$[ne+2]=Y>>>16,$[ne+3]=Y>>>24}function H($,Y){return($[Y]|$[Y+1]<<8|$[Y+2]<<16)+($[Y+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function($,Y,ne){for(ne=ne||this.length;this.pos<ne;){var oe=this.readVarint(),ye=oe>>3,pe=this.pos;this.type=7&oe,$(ye,Y,this),this.pos===pe&&this.skip(oe)}return Y},readMessage:function($,Y){return this.readFields($,Y,this.readVarint()+this.pos)},readFixed32:function(){var $=F(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=H(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=F(this.buf,this.pos)+F(this.buf,this.pos+4)*s;return this.pos+=8,$},readSFixed64:function(){var $=F(this.buf,this.pos)+H(this.buf,this.pos+4)*s;return this.pos+=8,$},readFloat:function(){var $=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var Y,ne,oe=this.buf;return Y=127&(ne=oe[this.pos++]),ne<128?Y:(Y|=(127&(ne=oe[this.pos++]))<<7,ne<128?Y:(Y|=(127&(ne=oe[this.pos++]))<<14,ne<128?Y:(Y|=(127&(ne=oe[this.pos++]))<<21,ne<128?Y:function(ye,pe,me){var Me,ve,Ie=me.buf;if(Me=(112&(ve=Ie[me.pos++]))>>4,ve<128||(Me|=(127&(ve=Ie[me.pos++]))<<3,ve<128)||(Me|=(127&(ve=Ie[me.pos++]))<<10,ve<128)||(Me|=(127&(ve=Ie[me.pos++]))<<17,ve<128)||(Me|=(127&(ve=Ie[me.pos++]))<<24,ve<128)||(Me|=(1&(ve=Ie[me.pos++]))<<31,ve<128))return m(ye,Me,pe);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(ne=oe[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,Y=this.pos;return this.pos=$,$-Y>=12&&h?function(ne,oe,ye){return h.decode(ne.subarray(oe,ye))}(this.buf,Y,$):function(ne,oe,ye){for(var pe="",me=oe;me<ye;){var Me,ve,Ie,Oe=ne[me],Le=null,Fe=Oe>239?4:Oe>223?3:Oe>191?2:1;if(me+Fe>ye)break;Fe===1?Oe<128&&(Le=Oe):Fe===2?(192&(Me=ne[me+1]))==128&&(Le=(31&Oe)<<6|63&Me)<=127&&(Le=null):Fe===3?(ve=ne[me+2],(192&(Me=ne[me+1]))==128&&(192&ve)==128&&((Le=(15&Oe)<<12|(63&Me)<<6|63&ve)<=2047||Le>=55296&&Le<=57343)&&(Le=null)):Fe===4&&(ve=ne[me+2],Ie=ne[me+3],(192&(Me=ne[me+1]))==128&&(192&ve)==128&&(192&Ie)==128&&((Le=(15&Oe)<<18|(63&Me)<<12|(63&ve)<<6|63&Ie)<=65535||Le>=1114112)&&(Le=null)),Le===null?(Le=65533,Fe=1):Le>65535&&(Le-=65536,pe+=String.fromCharCode(Le>>>10&1023|55296),Le=56320|1023&Le),pe+=String.fromCharCode(Le),me+=Fe}return pe}(this.buf,Y,$)},readBytes:function(){var $=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,$);return this.pos=$,Y},readPackedVarint:function($,Y){if(this.type!==t.Bytes)return $.push(this.readVarint(Y));var ne=d(this);for($=$||[];this.pos<ne;)$.push(this.readVarint(Y));return $},readPackedSVarint:function($){if(this.type!==t.Bytes)return $.push(this.readSVarint());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==t.Bytes)return $.push(this.readBoolean());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==t.Bytes)return $.push(this.readFloat());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==t.Bytes)return $.push(this.readDouble());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readFixed32());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed32());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readFixed64());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed64());var Y=d(this);for($=$||[];this.pos<Y;)$.push(this.readSFixed64());return $},skip:function($){var Y=7&$;if(Y===t.Varint)for(;this.buf[this.pos++]>127;);else if(Y===t.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===t.Fixed32)this.pos+=4;else{if(Y!==t.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function($,Y){this.writeVarint($<<3|Y)},realloc:function($){for(var Y=this.length||16;Y<this.pos+$;)Y*=2;if(Y!==this.length){var ne=new Uint8Array(Y);ne.set(this.buf),this.buf=ne,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),W(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),W(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),W(this.buf,-1&$,this.pos),W(this.buf,Math.floor($*c),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),W(this.buf,-1&$,this.pos),W(this.buf,Math.floor($*c),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(Y,ne){var oe,ye;if(Y>=0?(oe=Y%4294967296|0,ye=Y/4294967296|0):(ye=~(-Y/4294967296),4294967295^(oe=~(-Y%4294967296))?oe=oe+1|0:(oe=0,ye=ye+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ne.realloc(10),function(pe,me,Me){Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,Me.buf[Me.pos]=127&(pe>>>=7)}(oe,0,ne),function(pe,me){var Me=(7&pe)<<4;me.buf[me.pos++]|=Me|((pe>>>=3)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe)))))}(ye,ne)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var Y=this.pos;this.pos=function(oe,ye,pe){for(var me,Me,ve=0;ve<ye.length;ve++){if((me=ye.charCodeAt(ve))>55295&&me<57344){if(!Me){me>56319||ve+1===ye.length?(oe[pe++]=239,oe[pe++]=191,oe[pe++]=189):Me=me;continue}if(me<56320){oe[pe++]=239,oe[pe++]=191,oe[pe++]=189,Me=me;continue}me=Me-55296<<10|me-56320|65536,Me=null}else Me&&(oe[pe++]=239,oe[pe++]=191,oe[pe++]=189,Me=null);me<128?oe[pe++]=me:(me<2048?oe[pe++]=me>>6|192:(me<65536?oe[pe++]=me>>12|224:(oe[pe++]=me>>18|240,oe[pe++]=me>>12&63|128),oe[pe++]=me>>6&63|128),oe[pe++]=63&me|128)}return pe}(this.buf,$,this.pos);var ne=this.pos-Y;ne>=128&&x(Y,ne,this),this.pos=Y-1,this.writeVarint(ne),this.pos+=ne},writeFloat:function($){this.realloc(4),l.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),l.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var Y=$.length;this.writeVarint(Y),this.realloc(Y);for(var ne=0;ne<Y;ne++)this.buf[this.pos++]=$[ne]},writeRawMessage:function($,Y){this.pos++;var ne=this.pos;$(Y,this);var oe=this.pos-ne;oe>=128&&x(ne,oe,this),this.pos=ne-1,this.writeVarint(oe),this.pos+=oe},writeMessage:function($,Y,ne){this.writeTag($,t.Bytes),this.writeRawMessage(Y,ne)},writePackedVarint:function($,Y){Y.length&&this.writeMessage($,T,Y)},writePackedSVarint:function($,Y){Y.length&&this.writeMessage($,M,Y)},writePackedBoolean:function($,Y){Y.length&&this.writeMessage($,P,Y)},writePackedFloat:function($,Y){Y.length&&this.writeMessage($,y,Y)},writePackedDouble:function($,Y){Y.length&&this.writeMessage($,E,Y)},writePackedFixed32:function($,Y){Y.length&&this.writeMessage($,A,Y)},writePackedSFixed32:function($,Y){Y.length&&this.writeMessage($,I,Y)},writePackedFixed64:function($,Y){Y.length&&this.writeMessage($,k,Y)},writePackedSFixed64:function($,Y){Y.length&&this.writeMessage($,j,Y)},writeBytesField:function($,Y){this.writeTag($,t.Bytes),this.writeBytes(Y)},writeFixed32Field:function($,Y){this.writeTag($,t.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function($,Y){this.writeTag($,t.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function($,Y){this.writeTag($,t.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function($,Y){this.writeTag($,t.Fixed64),this.writeSFixed64(Y)},writeVarintField:function($,Y){this.writeTag($,t.Varint),this.writeVarint(Y)},writeSVarintField:function($,Y){this.writeTag($,t.Varint),this.writeSVarint(Y)},writeStringField:function($,Y){this.writeTag($,t.Bytes),this.writeString(Y)},writeFloatField:function($,Y){this.writeTag($,t.Fixed32),this.writeFloat(Y)},writeDoubleField:function($,Y){this.writeTag($,t.Fixed64),this.writeDouble(Y)},writeBooleanField:function($,Y){this.writeVarintField($,!!Y)}},Iw}var t0=L(wM());const Rw=3;function V5(l,t,s){t.glyphs=[],l===1&&s.readMessage($5,t)}function $5(l,t,s){if(l===3){const{id:c,bitmap:h,width:d,height:m,left:x,top:T,advance:M}=s.readMessage(G5,{});t.glyphs.push({id:c,bitmap:new su({width:d+2*Rw,height:m+2*Rw},h),metrics:{width:d,height:m,left:x,top:T,advance:M}})}else l===4?t.ascender=s.readSVarint():l===5&&(t.descender=s.readSVarint())}function G5(l,t,s){l===1?t.id=s.readVarint():l===2?t.bitmap=s.readBytes():l===3?t.width=s.readVarint():l===4?t.height=s.readVarint():l===5?t.left=s.readSVarint():l===6?t.top=s.readSVarint():l===7&&(t.advance=s.readVarint())}const SM=Rw,Js={horizontal:1,vertical:2,horizontalOnly:3};class qg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,s){const c=new qg;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new qg;return s.image=t,s}}class Vf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s,c){const h=new Vf;for(let d=0;d<t.sections.length;d++){const m=t.sections[d];m.image?h.addImageSection(m,c):h.addTextSection(m,s)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(s,c){let h="";for(let d=0;d<s.length;d++){const m=s.charCodeAt(d+1)||null,x=s.charCodeAt(d-1)||null;h+=!c&&(m&&rg(m)&&!Gg[s[d+1]]||x&&rg(x)&&!Gg[s[d-1]])||!Gg[s[d]]?s[d]:Gg[s[d]]}return h}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&r0[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&r0[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new Vf;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(qg.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(c)}addImageSection(t,s){const c=t.image?t.image.getPrimary():null;if(!c)return void Cn("Can't add FormattedSection with an empty image.");c.scaleSelf(s);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(qg.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Cn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kw(l,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k=1){const j=Vf.fromFeature(l,h,k);E===Js.vertical&&j.verticalizePunctuation(P);let F=[];const W=function(oe,ye,pe,me,Me,ve){if(!oe)return[];const Ie=[],Oe=function(Xe,$e,Ke,xt,yt,Ut){let Et=0;for(let Pt=0;Pt<Xe.length();Pt++){const St=Xe.getSection(Pt);Et+=TM(Xe.getCodePoint(Pt),St,xt,yt,$e,Ut)}return Et/Math.max(1,Math.ceil(Et/Ke))}(oe,ye,pe,me,Me,ve),Le=oe.text.indexOf("​")>=0;let Fe=0;for(let Xe=0;Xe<oe.length();Xe++){const $e=oe.getSection(Xe),Ke=oe.getCodePoint(Xe);if(r0[Ke]||(Fe+=TM(Ke,$e,me,Me,ye,ve)),Xe<oe.length()-1){const xt=!((je=Ke)<11904||!(er["Bopomofo Extended"](je)||er.Bopomofo(je)||er["CJK Compatibility Forms"](je)||er["CJK Compatibility Ideographs"](je)||er["CJK Compatibility"](je)||er["CJK Radicals Supplement"](je)||er["CJK Strokes"](je)||er["CJK Symbols and Punctuation"](je)||er["CJK Unified Ideographs Extension A"](je)||er["CJK Unified Ideographs"](je)||er["Enclosed CJK Letters and Months"](je)||er["Halfwidth and Fullwidth Forms"](je)||er.Hiragana(je)||er["Ideographic Description Characters"](je)||er["Kangxi Radicals"](je)||er["Katakana Phonetic Extensions"](je)||er.Katakana(je)||er["Vertical Forms"](je)||er["Yi Radicals"](je)||er["Yi Syllables"](je)));(q5[Ke]||xt||$e.image)&&Ie.push(CM(Xe+1,Fe,Oe,Ie,H5(Ke,oe.getCodePoint(Xe+1),xt&&Le),!1))}}var je;return AM(CM(oe.length(),Fe,Oe,Ie,0,!0))}(j,M,d,t,c,A),{processBidirectionalText:H,processStyledBidirectionalText:$}=mo;if(H&&j.sections.length===1){const oe=H(j.toString(),W);for(const ye of oe){const pe=new Vf;pe.text=ye,pe.sections=j.sections;for(let me=0;me<ye.length;me++)pe.sectionIndex.push(0);F.push(pe)}}else if($){const oe=$(j.text,j.sectionIndex,W);for(const ye of oe){const pe=new Vf;pe.text=ye[0],pe.sectionIndex=ye[1],pe.sections=j.sections,F.push(pe)}}else F=function(oe,ye){const pe=[],me=oe.text;let Me=0;for(const ve of ye)pe.push(oe.substring(Me,ve)),Me=ve;return Me<me.length&&pe.push(oe.substring(Me,me.length)),pe}(j,W);const Y=[],ne={positionedLines:Y,text:j.toString(),top:y[1],bottom:y[1],left:y[0],right:y[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(oe,ye,pe,me,Me,ve,Ie,Oe,Le,Fe,je,Xe){let $e=0,Ke=0,xt=0;const yt=Oe==="right"?1:Oe==="left"?0:.5;let Ut=!1;for(const Wt of Me){const cr=Wt.getSections();for(const Mr of cr){if(Mr.image)continue;const fr=ye[Mr.fontStack];if(fr&&(Ut=fr.ascender!==void 0&&fr.descender!==void 0,!Ut))break}if(!Ut)break}let Et=0;for(const Wt of Me){Wt.trim();const cr=Wt.getMaxScale(),Mr=(cr-1)*Wi,fr={positionedGlyphs:[],lineOffset:0};oe.positionedLines[Et]=fr;const Dr=fr.positionedGlyphs;let Ar=0;if(!Wt.length()){Ke+=ve,++Et;continue}let Nr=0,Xr=0;for(let ur=0;ur<Wt.length();ur++){const $r=Wt.getSection(ur),In=Wt.getSectionIndex(ur),Nn=Wt.getCodePoint(ur);let Bn=$r.scale,Gn=null,mn=null,xi=null,Es=Wi,ti=0;Le===Js.vertical&&((Pt=Nn)===12312||Pt===12313||Pt===12316||Pt===12540||Pt===12448)&&(Le=Js.horizontal);const oi=!(Le===Js.horizontal||!je&&!yf(Nn)||je&&(r0[Nn]||bv(Nn)));if($r.image){const is=me.get($r.image.toString());if(!is)continue;xi=$r.image,oe.iconsInText=oe.iconsInText||!0,mn=is.paddedRect;const Ui=is.displaySize;Bn=Bn*Wi/Xe,Gn={width:Ui[0],height:Ui[1],left:0,top:-SM,advance:oi?Ui[1]:Ui[0],localGlyph:!1},ti=Ut?-Gn.height*Bn:cr*Wi-17-Ui[1]*Bn,Es=Gn.advance;const zo=(oi?Ui[0]:Ui[1])*Bn-Wi*cr;zo>0&&zo>Ar&&(Ar=zo)}else{const is=pe[$r.fontStack];if(!is)continue;is[Nn]&&(mn=is[Nn]);const Ui=ye[$r.fontStack];if(!Ui)continue;const zo=Ui.glyphs[Nn];if(!zo)continue;if(Gn=zo.metrics,Es=Nn!==8203?Wi:0,Ut){const fu=Ui.ascender!==void 0?Math.abs(Ui.ascender):0,aa=Ui.descender!==void 0?Math.abs(Ui.descender):0,Fa=(fu+aa)*Bn;Nr<Fa&&(Nr=Fa,Xr=(fu-aa)/2*Bn),ti=-fu*Bn}else ti=(cr-Bn)*Wi-17}oi?(oe.verticalizable=!0,Dr.push({glyph:Nn,image:xi,x:$e,y:Ke+ti,vertical:oi,scale:Bn,localGlyph:Gn.localGlyph,fontStack:$r.fontStack,sectionIndex:In,metrics:Gn,rect:mn}),$e+=Es*Bn+Fe):(Dr.push({glyph:Nn,image:xi,x:$e,y:Ke+ti,vertical:oi,scale:Bn,localGlyph:Gn.localGlyph,fontStack:$r.fontStack,sectionIndex:In,metrics:Gn,rect:mn}),$e+=Gn.advance*Bn+Fe)}Dr.length!==0&&(xt=Math.max($e-Fe,xt),Ut?MM(Dr,yt,Ar,Xr,ve*cr/2):MM(Dr,yt,Ar,0,ve/2)),$e=0;const yn=ve*cr+Ar;fr.lineOffset=Math.max(Ar,Mr),Ke+=yn,++Et}var Pt;const St=Ke,{horizontalAlign:rr,verticalAlign:zt}=Dw(Ie);(function(Wt,cr,Mr,fr,Dr,Ar){const Nr=(cr-Mr)*Dr,Xr=-Ar*fr;for(const yn of Wt)for(const ur of yn.positionedGlyphs)ur.x+=Nr,ur.y+=Xr})(oe.positionedLines,yt,rr,zt,xt,St),oe.top+=-zt*St,oe.bottom=oe.top+St,oe.left+=-rr*xt,oe.right=oe.left+xt,oe.hasBaseline=Ut}(ne,t,s,c,F,m,x,T,E,M,P,I),!function(oe){for(const ye of oe)if(ye.positionedGlyphs.length!==0)return!1;return!0}(Y))return ne}const r0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},q5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function TM(l,t,s,c,h,d){if(t.image){const m=c.get(t.image.toString());return m?m.displaySize[0]*t.scale*Wi/d+h:0}{const m=s[t.fontStack],x=m&&m.glyphs[l];return x?x.metrics.advance*t.scale+h:0}}function EM(l,t,s,c){const h=Math.pow(l-t,2);return c?l<t?h/2:2*h:h+Math.abs(s)*s}function H5(l,t,s){let c=0;return l===10&&(c-=1e4),s&&(c+=150),l!==40&&l!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function CM(l,t,s,c,h,d){let m=null,x=EM(t,s,h,d);for(const T of c){const M=EM(t-T.x,s,h,d)+T.badness;M<=x&&(m=T,x=M)}return{index:l,x:t,priorBreak:m,badness:x}}function AM(l){return l?AM(l.priorBreak).concat(l.index):[]}function Dw(l){let t=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function MM(l,t,s,c,h){if(!(t||s||c||h))return;const d=l.length-1,m=l[d],x=(m.x+m.metrics.advance*m.scale)*t;for(let T=0;T<=d;T++)l[T].x-=x,l[T].y+=s+c+h}function W5(l,t,s,c){const{horizontalAlign:h,verticalAlign:d}=Dw(c),m=s[0]-l.displaySize[0]*h,x=s[1]-l.displaySize[1]*d;return{imagePrimary:l,imageSecondary:t,top:x,bottom:x+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function IM(l,t,s,c,h,d){const m=l.imagePrimary;let x;if(m.content){const j=m.content,F=m.pixelRatio||1;x=[j[0]/F,j[1]/F,m.displaySize[0]-j[2]/F,m.displaySize[1]-j[3]/F]}const T=t.left*d,M=t.right*d;let y,E,P,A;s==="width"||s==="both"?(A=h[0]+T-c[3],E=h[0]+M+c[1]):(A=h[0]+(T+M-m.displaySize[0])/2,E=A+m.displaySize[0]);const I=t.top*d,k=t.bottom*d;return s==="height"||s==="both"?(y=h[1]+I-c[0],P=h[1]+k+c[2]):(y=h[1]+(I+k-m.displaySize[1])/2,P=y+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:y,right:E,bottom:P,left:A,collisionPadding:x}}class ec extends wt{constructor(t,s,c,h,d){super(t,s),this.angle=h,this.z=c,d!==void 0&&(this.segment=d)}clone(){return new ec(this.x,this.y,this.z,this.angle,this.segment)}}function PM(l,t,s,c,h){if(t.segment===void 0)return!0;let d=t,m=t.segment+1,x=0;for(;x>-s/2;){if(m--,m<0)return!1;x-=l[m].dist(d),d=l[m]}x+=l[m].dist(l[m+1]),m++;const T=[];let M=0;for(;x<s/2;){const y=l[m],E=l[m+1];if(!E)return!1;let P=l[m-1].angleTo(y)-y.angleTo(E);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:P}),M+=P;x-T[0].distance>c;)M-=T.shift().angleDelta;if(M>h)return!1;m++,x+=y.dist(E)}return!0}function RM(l){let t=0;for(let s=0;s<l.length-1;s++)t+=l[s].dist(l[s+1]);return t}function kM(l,t,s){return l?.6*t*s:0}function DM(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function Z5(l,t,s,c,h,d){const m=kM(s,h,d),x=DM(s,c)*d;let T=0;const M=RM(l)/2;for(let y=0;y<l.length-1;y++){const E=l[y],P=l[y+1],A=E.dist(P);if(T+A>M){const I=(M-T)/A,k=or(E.x,P.x,I),j=or(E.y,P.y,I),F=new ec(k,j,0,P.angleTo(E),y);return!m||PM(l,F,x,m,t)?F:void 0}T+=A}}function X5(l,t,s,c,h,d,m,x,T){const M=kM(c,d,m),y=DM(c,h),E=y*m,P=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return t-E<t/4&&(t=E+t/4),LM(l,P?t/2*x%t:(y/2+2*d)*m*x%t,t,M,s,E,P,!1,T)}function LM(l,t,s,c,h,d,m,x,T){const M=d/2,y=RM(l);let E=0,P=t-s,A=[];for(let I=0;I<l.length-1;I++){const k=l[I],j=l[I+1],F=k.dist(j),W=j.angleTo(k);for(;P+s<E+F;){P+=s;const H=(P-E)/F,$=or(k.x,j.x,H),Y=or(k.y,j.y,H);if($>=0&&$<T&&Y>=0&&Y<T&&P-M>=0&&P+M<=y){const ne=new ec($,Y,0,W,I);c&&!PM(l,ne,d,c,h)||A.push(ne)}}E+=F}return x||A.length||m||(A=LM(l,E/2,s,c,h,d,m,!0,T)),A}function NM(l,t,s,c,h){const d=[];for(let m=0;m<l.length;m++){const x=l[m];let T;for(let M=0;M<x.length-1;M++){let y=x[M],E=x[M+1];y.x<t&&E.x<t||(y.x<t?y=new wt(t,y.y+(t-y.x)/(E.x-y.x)*(E.y-y.y))._round():E.x<t&&(E=new wt(t,y.y+(t-y.x)/(E.x-y.x)*(E.y-y.y))._round()),y.y<s&&E.y<s||(y.y<s?y=new wt(y.x+(s-y.y)/(E.y-y.y)*(E.x-y.x),s)._round():E.y<s&&(E=new wt(y.x+(s-y.y)/(E.y-y.y)*(E.x-y.x),s)._round()),y.x>=c&&E.x>=c||(y.x>=c?y=new wt(c,y.y+(c-y.x)/(E.x-y.x)*(E.y-y.y))._round():E.x>=c&&(E=new wt(c,y.y+(c-y.x)/(E.x-y.x)*(E.y-y.y))._round()),y.y>=h&&E.y>=h||(y.y>=h?y=new wt(y.x+(h-y.y)/(E.y-y.y)*(E.x-y.x),h)._round():E.y>=h&&(E=new wt(y.x+(h-y.y)/(E.y-y.y)*(E.x-y.x),h)._round()),T&&y.equals(T[T.length-1])||(T=[y],d.push(T)),T.push(E)))))}}return d}function OM(l){let t=0,s=0;for(const m of l)t+=m.w*m.h,s=Math.max(s,m.w);l.sort((m,x)=>x.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,d=0;for(const m of l)for(let x=c.length-1;x>=0;x--){const T=c[x];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,d=Math.max(d,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===T.w&&m.h===T.h){const M=c.pop();x<c.length&&(c[x]=M)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(c.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:h,h:d,fill:t/(h*d)||0}}Bt(ec,"Anchor");const $f=1;class Hg{static getImagePositionScale(t,s,c){if(s&&t&&t.options&&t.options.transform){const h=t.options.transform;return{x:h.a,y:h.d}}return{x:c,y:c}}constructor(t,s,c,h){this.paddedRect=t;const{pixelRatio:d,version:m,stretchX:x,stretchY:T,content:M,sdf:y,usvg:E}=s;this.pixelRatio=d,this.stretchX=x,this.stretchY=T,this.content=M,this.version=m,this.padding=c,this.sdf=y,this.scale=Hg.getImagePositionScale(h,E,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function zM(l,t,s){const c=Qo.parse(l),h=function(d,m,x=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*x[0])+2*m,h:(d.data?d.data.height:d.height*x[1])+2*m}}(t,s,[c.options.transform.a,c.options.transform.d]);return{bin:h,imagePosition:new Hg(h,t,s,c),imageVariant:c}}class jM{constructor(t,s,c){const h=new Map,d=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(t,h,$f,m),this.addImages(s,d,2,m);const{w:x,h:T}=OM(m),M=new Hi({width:x||1,height:T||1});for(const[y,E]of t.entries()){const P=h.get(y).paddedRect;Hi.copy(E.data,M,{x:0,y:0},{x:P.x+$f,y:P.y+$f},E.data,c,E.sdf)}for(const[y,E]of s.entries()){const P=d.get(y),A=P.paddedRect;let I=P.padding;const k=A.x+I,j=A.y+I,F=E.data.width,W=E.data.height;I=I>1?I-1:I,Hi.copy(E.data,M,{x:0,y:0},{x:k,y:j},E.data,c),Hi.copy(E.data,M,{x:0,y:W-I},{x:k,y:j-I},{width:F,height:I},c),Hi.copy(E.data,M,{x:0,y:0},{x:k,y:j+W},{width:F,height:I},c),Hi.copy(E.data,M,{x:F-I,y:0},{x:k-I,y:j},{width:I,height:W},c),Hi.copy(E.data,M,{x:0,y:0},{x:k+F,y:j},{width:I,height:W},c),Hi.copy(E.data,M,{x:F-I,y:W-I},{x:k-I,y:j-I},{width:I,height:I},c),Hi.copy(E.data,M,{x:0,y:W-I},{x:k+F,y:j-I},{width:I,height:I},c),Hi.copy(E.data,M,{x:0,y:0},{x:k+F,y:j+W},{width:I,height:I},c),Hi.copy(E.data,M,{x:F-I,y:0},{x:k-I,y:j+W},{width:I,height:I},c)}this.lut=c,this.image=M,this.iconPositions=h,this.patternPositions=d}addImages(t,s,c,h){for(const[d,m]of t.entries()){const{bin:x,imagePosition:T,imageVariant:M}=zM(d,m,c);s.set(d,T),h.push(x),m.hasRenderCallback&&this.haveRenderCallbacks.push(M.id)}}patchUpdatedImages(t,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const h of t.getUpdatedImages(c)){for(const d of this.iconPositions.keys()){const m=Qo.parse(d);if(ws.isEqual(m.id,h)){const x=t.getImage(h,c);this.patchUpdatedImage(this.iconPositions.get(d),x,s)}}for(const d of this.patternPositions.keys()){const m=Qo.parse(d);if(ws.isEqual(m.id,h)){const x=t.getImage(h,c);this.patchUpdatedImage(this.patternPositions.get(d),x,s)}}}}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,d]=t.tl,m=t.sdf;if(this.lut||m){const x={width:s.data.width,height:s.data.height},T=new Hi(x);Hi.copy(s.data,T,{x:0,y:0},{x:0,y:0},x,this.lut,m),c.update(T,{position:{x:h,y:d}})}else c.update(s.data,{position:{x:h,y:d}})}}Bt(Hg,"ImagePosition"),Bt(jM,"ImageAtlas");const Wg=1e20;function FM(l,t,s,c,h,d,m,x,T){for(let M=t;M<t+c;M++)BM(l,s*d+M,d,h,m,x,T);for(let M=s;M<s+h;M++)BM(l,M*d+t,1,c,m,x,T)}function BM(l,t,s,c,h,d,m){d[0]=0,m[0]=-Wg,m[1]=Wg,h[0]=l[t];for(let x=1,T=0,M=0;x<c;x++){h[x]=l[t+x*s];const y=x*x;do{const E=d[T];M=(h[x]-h[E]+y-E*E)/(x-E)/2}while(M<=m[T]&&--T>-1);T++,d[T]=x,m[T]=M,m[T+1]=Wg}for(let x=0,T=0;x<c;x++){for(;m[T+1]<x;)T++;const M=d[T],y=x-M;l[t+x*s]=h[M]+y*y}}const Na=2,Lw={none:0,ideographs:1,all:2};class Gf{constructor(t,s,c){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,s){this.urls[s]=t}getGlyphs(t,s,c){const h=[],d=this.urls[s]||le.GLYPHS_URL;for(const m in t)for(const x of t[m])h.push({stack:m,id:x});Yi(h,({stack:m,id:x},T)=>{let M=this.entries[m];M||(M=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=M.glyphs[x];if(y!==void 0)return void T(null,{stack:m,id:x,glyph:y});if(y=this._tinySDF(M,m,x),y)return M.glyphs[x]=y,void T(null,{stack:m,id:x,glyph:y});const E=Math.floor(x/256);if(256*E>65535)return Cn("glyphs > 65535 not supported"),void T(null,{stack:m,id:x,glyph:y});if(M.ranges[E])return void T(null,{stack:m,id:x,glyph:y});let P=M.requests[E];P||(P=M.requests[E]=[],Gf.loadGlyphRange(m,E,d,this.requestManager,(A,I)=>{if(I){M.ascender=I.ascender,M.descender=I.descender;for(const k in I.glyphs)this._doesCharSupportLocalGlyph(+k)||(M.glyphs[+k]=I.glyphs[+k]);M.ranges[E]=!0}for(const k of P)k(A,I);delete M.requests[E]})),P.push((A,I)=>{A?T(A):I&&T(null,{stack:m,id:x,glyph:I.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){const T={};for(const{stack:M,id:y,glyph:E}of x)T[M]===void 0&&(T[M]={}),T[M].glyphs===void 0&&(T[M].glyphs={}),T[M].glyphs[y]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},T[M].ascender=this.entries[M].ascender,T[M].descender=this.entries[M].descender;c(null,T)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Lw.none&&(this.localGlyphMode===Lw.all?!!this.localFontFamily:!!this.localFontFamily&&(er["CJK Unified Ideographs"](t)||er["Hangul Syllables"](t)||er.Hiragana(t)||er.Katakana(t)||er["CJK Symbols and Punctuation"](t)||er["CJK Unified Ideographs Extension A"](t)||er["CJK Unified Ideographs Extension B"](t)||er.Osage(t)))}_tinySDF(t,s,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let d=t.tinySDF;if(!d){let k="400";/bold/i.test(s)?k="900":/medium/i.test(s)?k="500":/light/i.test(s)&&(k="200"),d=t.tinySDF=new Gf.TinySDF({fontFamily:h,fontWeight:k,fontSize:24*Na,buffer:3*Na,radius:8*Na}),d.fontWeight=k}if(this.localGlyphs[d.fontWeight][c])return this.localGlyphs[d.fontWeight][c];const m=String.fromCodePoint(c),{data:x,width:T,height:M,glyphWidth:y,glyphHeight:E,glyphLeft:P,glyphTop:A,glyphAdvance:I}=d.draw(m);return this.localGlyphs[d.fontWeight][c]={id:c,bitmap:new su({width:T,height:M},x),metrics:{width:y/Na,height:E/Na,left:P/Na,top:A/Na-27,advance:I/Na,localGlyph:!0}}}}Gf.loadGlyphRange=function(l,t,s,c,h){const d=256*t,m=d+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${d}-${m}`),Pi.Glyphs);ga(x,(T,M)=>{if(T)h(T);else if(M){const y={},E=function(P){return new t0(P).readFields(V5,{})}(M);for(const P of E.glyphs)y[P.id]=P;h(null,{glyphs:y,ascender:E.ascender,descender:E.descender})}})},Gf.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const x=this.size=l+4*t,T=this._createCanvas(x),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${m} ${d} ${l}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:d}=this.ctx.measureText(l),m=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-h))),T=Math.min(this.size-this.buffer,m+Math.ceil(c)),M=x+2*this.buffer,y=T+2*this.buffer,E=Math.max(M*y,0),P=new Uint8ClampedArray(E),A={data:P,width:M,height:y,glyphWidth:x,glyphHeight:T,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(x===0||T===0)return A;const{ctx:I,buffer:k,gridInner:j,gridOuter:F}=this;I.clearRect(k,k,x,T),I.fillText(l,k,k+m);const W=I.getImageData(k,k,x,T);F.fill(Wg,0,E),j.fill(0,0,E);for(let H=0;H<T;H++)for(let $=0;$<x;$++){const Y=W.data[4*(H*x+$)+3]/255;if(Y===0)continue;const ne=(H+k)*M+$+k;if(Y===1)F[ne]=0,j[ne]=Wg;else{const oe=.5-Y;F[ne]=oe>0?oe*oe:0,j[ne]=oe<0?oe*oe:0}}FM(F,0,0,M,y,M,this.f,this.v,this.z),FM(j,k,k,x,T,M,this.f,this.v,this.z);for(let H=0;H<E;H++){const $=Math.sqrt(F[H])-Math.sqrt(j[H]);P[H]=Math.round(255-255*($/this.radius+this.cutoff))}return A}};const lu=$f;function UM(l,t){return l+t[1]-t[0]}function VM(l,t,s,c,h=1){const d=[],m=l.imagePrimary,x=m.pixelRatio,T=m.paddedRect.w-2*lu,M=m.paddedRect.h-2*lu,y=(l.right-l.left)*h,E=(l.bottom-l.top)*h,P=m.stretchX||[[0,T]],A=m.stretchY||[[0,M]],I=P.reduce(UM,0),k=A.reduce(UM,0),j=T-I,F=M-k;let W=0,H=I,$=0,Y=k,ne=0,oe=j,ye=0,pe=F;if(m.content&&c){const Me=m.content;W=n0(P,0,Me[0]),$=n0(A,0,Me[1]),H=n0(P,Me[0],Me[2]),Y=n0(A,Me[1],Me[3]),ne=Me[0]-W,ye=Me[1]-$,oe=Me[2]-Me[0]-H,pe=Me[3]-Me[1]-Y}const me=(Me,ve,Ie,Oe)=>{const Le=i0(Me.stretch-W,H,y,l.left*h),Fe=s0(Me.fixed-ne,oe,Me.stretch,I),je=i0(ve.stretch-$,Y,E,l.top*h),Xe=s0(ve.fixed-ye,pe,ve.stretch,k),$e=i0(Ie.stretch-W,H,y,l.left*h),Ke=s0(Ie.fixed-ne,oe,Ie.stretch,I),xt=i0(Oe.stretch-$,Y,E,l.top*h),yt=s0(Oe.fixed-ye,pe,Oe.stretch,k),Ut=new wt(Le,je),Et=new wt($e,je),Pt=new wt($e,xt),St=new wt(Le,xt),rr=new wt(Fe/x,Xe/x),zt=new wt(Ke/x,yt/x),Wt=t*Math.PI/180;if(Wt){const Nr=Math.sin(Wt),Xr=Math.cos(Wt),yn=[Xr,-Nr,Nr,Xr];Ut._matMult(yn),Et._matMult(yn),St._matMult(yn),Pt._matMult(yn)}const cr=Me.stretch+Me.fixed,Mr=Ie.stretch+Ie.fixed,fr=ve.stretch+ve.fixed,Dr=Oe.stretch+Oe.fixed,Ar=l.imageSecondary;return{tl:Ut,tr:Et,bl:St,br:Pt,texPrimary:{x:m.paddedRect.x+lu+cr,y:m.paddedRect.y+lu+fr,w:Mr-cr,h:Dr-fr},texSecondary:Ar?{x:Ar.paddedRect.x+lu+cr,y:Ar.paddedRect.y+lu+fr,w:Mr-cr,h:Dr-fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rr,pixelOffsetBR:zt,minFontScaleX:oe/x/y,minFontScaleY:pe/x/E,isSDF:s}};if(c&&(m.stretchX||m.stretchY)){const Me=$M(P,j,I),ve=$M(A,F,k);for(let Ie=0;Ie<Me.length-1;Ie++){const Oe=Me[Ie],Le=Me[Ie+1];for(let Fe=0;Fe<ve.length-1;Fe++)d.push(me(Oe,ve[Fe],Le,ve[Fe+1]))}}else d.push(me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:M+1}));return d}function n0(l,t,s){let c=0;for(const h of l)c+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return c}function $M(l,t,s){const c=[{fixed:-lu,stretch:0}];for(const[h,d]of l){const m=c[c.length-1];c.push({fixed:h-m.stretch,stretch:m.stretch}),c.push({fixed:h-m.stretch,stretch:m.stretch+(d-h)})}return c.push({fixed:t+lu,stretch:s}),c}function i0(l,t,s,c){return l/t*s+c}function s0(l,t,s,c){return l-t*s/c}function K5(l,t,s,c){const h=t+l.positionedLines[c].lineOffset;return c===0?s+h/2:s+(h+(t+l.positionedLines[c-1].lineOffset))/2}function Y5(l,t=1,s=!1){let c=1/0,h=1/0,d=-1/0,m=-1/0;const x=l[0];for(let A=0;A<x.length;A++){const I=x[A];(!A||I.x<c)&&(c=I.x),(!A||I.y<h)&&(h=I.y),(!A||I.x>d)&&(d=I.x),(!A||I.y>m)&&(m=I.y)}const T=Math.min(d-c,m-h);let M=T/2;const y=new xd([],J5);if(T===0)return new wt(c,h);for(let A=c;A<d;A+=T)for(let I=h;I<m;I+=T)y.push(new qf(A+M,I+M,M,l));let E=function(A){let I=0,k=0,j=0;const F=A[0];for(let W=0,H=F.length,$=H-1;W<H;$=W++){const Y=F[W],ne=F[$],oe=Y.x*ne.y-ne.x*Y.y;k+=(Y.x+ne.x)*oe,j+=(Y.y+ne.y)*oe,I+=3*oe}return new qf(k/I,j/I,0,A)}(l),P=y.length;for(;y.length;){const A=y.pop();(A.d>E.d||!E.d)&&(E=A,s&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,P)),A.max-E.d<=t||(M=A.h/2,y.push(new qf(A.p.x-M,A.p.y-M,M,l)),y.push(new qf(A.p.x+M,A.p.y-M,M,l)),y.push(new qf(A.p.x-M,A.p.y+M,M,l)),y.push(new qf(A.p.x+M,A.p.y+M,M,l)),P+=4)}return s&&(console.log(`num probes: ${P}`),console.log(`best distance: ${E.d}`)),E.p}function J5(l,t){return t.max-l.max}class qf{constructor(t,s,c,h){this.p=new wt(t,s),this.h=c,this.d=function(d,m){let x=!1,T=1/0;for(let M=0;M<m.length;M++){const y=m[M];for(let E=0,P=y.length,A=P-1;E<P;A=E++){const I=y[E],k=y[A];I.y>d.y!=k.y>d.y&&d.x<(k.x-I.x)*(d.y-I.y)/(k.y-I.y)+I.x&&(x=!x),T=Math.min(T,Ae(d,I,k))}}return(x?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Nw=Number.POSITIVE_INFINITY,Q5=Math.sqrt(2);function GM(l,[t,s]){let c=0,h=0;if(s===Nw){t<0&&(t=0);const d=t/Q5;switch(l){case"top-right":case"top-left":h=d-7;break;case"bottom-right":case"bottom-left":h=7-d;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(l){case"top-right":case"bottom-right":c=-d;break;case"top-left":case"bottom-left":c=d;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),s=Math.abs(s),l){case"top-right":case"top-left":case"top":h=s-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-s}switch(l){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,h]}function qM(l,t,s,c,h,d,m,x){if(!l)return;const T=vM(t,s,c,h,d);return l.scaleSelf(T*x*m)}function HM(l,t,s,c,h,d,m,x){return{iconPrimary:qM(l.getPrimary(),t,s,c,h,d,m,x),iconSecondary:qM(l.getSecondary(),t,s,c,h,d,m,x)}}function WM(l,t,s,c){if(!l)return;const h=t.get(s.toString());if(l.imagePrimary=h,c){const d=t.get(c.toString());l.imageSecondary=d}}function eB(l,t){for(const s in l.horizontal)ZM(l.horizontal[s],t);ZM(l.vertical,t)}function ZM(l,t){if(l){for(const s of l.positionedLines)for(const c of s.positionedGlyphs)if(c.image!==null){const h=c.image.toString();c.rect=t.get(h).paddedRect}}}function Ow(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tB(l,t,s,c,h,d,m,x,T){const M=zw(d.horizontal)||d.vertical,y=s.get("icon-text-fit-padding").evaluate(c,{},h);let E,P=t;return t&&T!=="none"&&(l.allowVerticalPlacement&&d.vertical&&(E=IM(t,d.vertical,T,y,x,m)),M&&(P=IM(t,M,T,y,x,m))),{defaultShapedIcon:P,verticallyShapedIcon:E}}function rB(l,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F,W,H){let $=m.textMaxSize.evaluate(t,{},P);$===void 0?$=x*m.textScaleFactor:$*=m.textScaleFactor;const Y=l.layers[0].layout,ne=zw(s.horizontal)||s.vertical,oe=A.name==="globe",ye=Wi,pe=l.tilePixelRatio*$/ye,me=(Fe=l.overscaling,l.zoom>18&&Fe>2&&(Fe>>=1),Math.max(Rt/(512*Fe),1)*Y.get("symbol-spacing")),Me=Y.get("text-padding")*l.tilePixelRatio,ve=Y.get("icon-padding")*l.tilePixelRatio,Ie=wr(Y.get("text-max-angle")),Oe=Y.get("icon-rotation-alignment")==="map"&&H!=="point",Le=me/2;var Fe;l.hasAnyIconTextFit===!1&&j!=="none"&&(l.hasAnyIconTextFit=!0);const je=t.properties?+t.properties[Zd]:null,Xe=je&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(je):65535,$e=(Ke,xt,yt)=>{if(xt.x<0||xt.x>=Rt||xt.y<0||xt.y>=Rt)return;let Ut=null;if(oe){const{x:Et,y:Pt,z:St}=A.projectTilePoint(xt.x,xt.y,yt);Ut={anchor:new ec(Et,Pt,St,0,void 0),up:A.upVector(yt,xt.x,xt.y)}}(function(Et,Pt,St,rr,zt,Wt,cr,Mr,fr,Dr,Ar,Nr,Xr,yn,ur,$r,In,Nn,Bn,Gn,mn,xi,Es,ti,oi,is,Ui,zo,fu){const aa=Et.addToLineVertexArray(Pt,rr);let Fa,pu,mu,th,PP,RP,kP,DP=0,LP=0,NP=0,OP=0,g2=-1,_2=-1;const bl={};let zP=qs("");const rh=St?St.anchor:Pt,y2=zo!=="none";let v2=0,x2=0;if(fr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[v2,x2]=fr.layout.get("text-offset").evaluate(mn,{},oi).map(jo=>jo*Wi):(v2=fr.layout.get("text-radial-offset").evaluate(mn,{},oi)*Wi,x2=Nw),Et.allowVerticalPlacement&&zt.vertical){const jo=zt.vertical;if(ur)RP=jw(jo),Mr&&(kP=jw(Mr));else{const Qs=fr.layout.get("text-rotate").evaluate(mn,{},oi)+90;mu=o0(Dr,rh,Pt,Ar,Nr,Xr,jo,yn,Qs,$r),Mr&&(th=o0(Dr,rh,Pt,Ar,Nr,Xr,Mr,Nn,Qs))}}if(Wt){const jo=Et.iconSizeData,Qs=fr.layout.get("icon-rotate").evaluate(mn,{},oi),h_=VM(Wt,Qs,Es,y2,xi.iconScaleFactor),w2=Mr?VM(Mr,Qs,Es,y2,xi.iconScaleFactor):void 0;pu=o0(Dr,rh,Pt,Ar,Nr,Xr,Wt,Nn,Qs,null),DP=4*h_.length;let nh=null;jo.kind==="source"?(nh=[La*fr.layout.get("icon-size").evaluate(mn,{},oi)*xi.iconScaleFactor],nh[0]>cu&&Cn(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Zg}. Reduce your "icon-size".`)):jo.kind==="composite"&&(nh=[La*xi.compositeIconSizes[0].evaluate(mn,{},oi)*xi.iconScaleFactor,La*xi.compositeIconSizes[1].evaluate(mn,{},oi)*xi.iconScaleFactor],(nh[0]>cu||nh[1]>cu)&&Cn(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Zg}. Reduce your "icon-size".`)),Et.addSymbols(Et.icon,h_,nh,Gn,Bn,mn,!1,St,Pt,aa.lineStartIndex,aa.lineLength,-1,ti,oi,is,Ui),g2=Et.icon.placedSymbolArray.length-1,w2&&(LP=4*w2.length,Et.addSymbols(Et.icon,w2,nh,Gn,Bn,mn,Js.vertical,St,Pt,aa.lineStartIndex,aa.lineLength,-1,ti,oi,is,Ui),_2=Et.icon.placedSymbolArray.length-1)}for(const jo in zt.horizontal){const Qs=zt.horizontal[jo];Fa||(zP=qs(Qs.text),ur?PP=jw(Qs):Fa=o0(Dr,rh,Pt,Ar,Nr,Xr,Qs,yn,fr.layout.get("text-rotate").evaluate(mn,{},oi),$r));const h_=Qs.positionedLines.length===1;if(NP+=XM(Et,St,Pt,Qs,cr,fr,ur,mn,$r,aa,zt.vertical?Js.horizontal:Js.horizontalOnly,h_?Object.keys(zt.horizontal):[jo],bl,g2,xi,ti,oi,is),h_)break}zt.vertical&&(OP+=XM(Et,St,Pt,zt.vertical,cr,fr,ur,mn,$r,aa,Js.vertical,["vertical"],bl,_2,xi,ti,oi,is));let gu=-1;const b2=(jo,Qs)=>jo?Math.max(jo,Qs):Qs;gu=b2(PP,gu),gu=b2(RP,gu),gu=b2(kP,gu);const L6=gu>-1?1:0;Et.glyphOffsetArray.length>=65535&&Cn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),mn.sortKey!==void 0&&Et.addToSortKeyRanges(Et.symbolInstances.length,mn.sortKey),Et.symbolInstances.emplaceBack(Pt.x,Pt.y,rh.x,rh.y,rh.z,bl.right>=0?bl.right:-1,bl.center>=0?bl.center:-1,bl.left>=0?bl.left:-1,bl.vertical>=0?bl.vertical:-1,g2,_2,zP,Fa!==void 0?Fa:Et.collisionBoxArray.length,Fa!==void 0?Fa+1:Et.collisionBoxArray.length,mu!==void 0?mu:Et.collisionBoxArray.length,mu!==void 0?mu+1:Et.collisionBoxArray.length,pu!==void 0?pu:Et.collisionBoxArray.length,pu!==void 0?pu+1:Et.collisionBoxArray.length,th||Et.collisionBoxArray.length,th?th+1:Et.collisionBoxArray.length,Ar,NP,OP,DP,LP,L6,0,v2,x2,gu,0,y2?1:0,fu)})(l,xt,Ut,Ke,s,c,d,h,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,Me,W,M,0,ve,Oe,F,t,m,y,E,P,I,k,j,Xe)};if(H==="line")for(const Ke of NM(t.geometry,0,0,Rt,Rt)){const xt=X5(Ke,me,Ie,s.vertical||ne,c,ye,pe,l.overscaling,Rt);for(const yt of xt)ne&&nB(l,ne.text,Le,yt)||$e(Ke,yt,P)}else if(H==="line-center"){for(const Ke of t.geometry)if(Ke.length>1){const xt=Z5(Ke,Ie,s.vertical||ne,c,ye,pe);xt&&$e(Ke,xt,P)}}else if(t.type==="Polygon")for(const Ke of Wv(t.geometry,0)){const xt=Y5(Ke,16);$e(Ke[0],new ec(xt.x,xt.y,0,0,void 0),P)}else if(t.type==="LineString")for(const Ke of t.geometry)$e(Ke,new ec(Ke[0].x,Ke[0].y,0,0,void 0),P);else if(t.type==="Point")for(const Ke of t.geometry)for(const xt of Ke)$e([xt],new ec(xt.x,xt.y,0,0,void 0),P)}const Zg=255,cu=Zg*La;function XM(l,t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j,F){const W=function(Y,ne,oe,ye,pe,me,Me,ve){const Ie=[];if(ne.positionedLines.length===0)return Ie;const Oe=ye.layout.get("text-rotate").evaluate(me,{})*Math.PI/180,Le=function(Ke){const xt=Ke[0],yt=Ke[1],Ut=xt*yt;return Ut>0?[xt,-yt]:Ut<0?[-xt,yt]:xt===0?[yt,xt]:[yt,-xt]}(oe);let Fe=Math.abs(ne.top-ne.bottom);for(const Ke of ne.positionedLines)Fe-=Ke.lineOffset;const je=ne.positionedLines.length,Xe=Fe/je;let $e=ne.top-oe[1];for(let Ke=0;Ke<je;++Ke){const xt=ne.positionedLines[Ke];$e=K5(ne,Xe,$e,Ke);for(const yt of xt.positionedGlyphs){if(!yt.rect)continue;const Ut=yt.rect||{};let Et=SM+1,Pt=!0,St=1,rr=0;if(yt.image){const mn=Me.get(yt.image.toString());if(!mn)continue;if(mn.sdf){Cn("SDF images are not supported in formatted text and will be ignored.");continue}Pt=!1,St=mn.pixelRatio,Et=$f/St}const zt=(pe||ve)&&yt.vertical,Wt=yt.metrics.advance*yt.scale/2,cr=yt.metrics,Mr=yt.rect;if(Mr===null)continue;ve&&ne.verticalizable&&(rr=yt.image?Wt-yt.metrics.width*yt.scale/2:0);const fr=pe?[yt.x+Wt,yt.y]:[0,0];let Dr=[0,0],Ar=[0,0],Nr=!1;pe||(zt?(Ar=[yt.x+Wt+Le[0],yt.y+Le[1]-rr],Nr=!0):Dr=[yt.x+Wt+oe[0],yt.y+oe[1]-rr]);const Xr=Mr.w*yt.scale/(St*(yt.localGlyph?Na:1)),yn=Mr.h*yt.scale/(St*(yt.localGlyph?Na:1));let ur,$r,In,Nn;if(zt){const mn=yt.y-$e,xi=new wt(-Wt,Wt-mn),Es=-Math.PI/2,ti=new wt(...Ar);ur=new wt(-Wt+Dr[0],Dr[1]),ur._rotateAround(Es,xi)._add(ti),ur.x+=-mn+Wt,ur.y-=(cr.left-Et)*yt.scale;const oi=yt.image?cr.advance*yt.scale:Wi*yt.scale,is=String.fromCodePoint(yt.glyph);F5(is)?ur.x+=(1-Et)*yt.scale:B5(is)?ur.x+=oi-cr.height*yt.scale+(-Et-1)*yt.scale:ur.x+=yt.image||cr.width+2*Et===Mr.w&&cr.height+2*Et===Mr.h?(oi-yn)/2:(oi-(cr.height+2*Et)*yt.scale)/2,$r=new wt(ur.x,ur.y-Xr),In=new wt(ur.x+yn,ur.y),Nn=new wt(ur.x+yn,ur.y-Xr)}else{const mn=(cr.left-Et)*yt.scale-Wt+Dr[0],xi=(-cr.top-Et)*yt.scale+Dr[1],Es=mn+Xr,ti=xi+yn;ur=new wt(mn,xi),$r=new wt(Es,xi),In=new wt(mn,ti),Nn=new wt(Es,ti)}if(Oe){let mn;mn=pe?new wt(0,0):Nr?new wt(Le[0],Le[1]):new wt(oe[0],oe[1]),ur._rotateAround(Oe,mn),$r._rotateAround(Oe,mn),In._rotateAround(Oe,mn),Nn._rotateAround(Oe,mn)}const Bn=new wt(0,0),Gn=new wt(0,0);Ie.push({tl:ur,tr:$r,bl:In,br:Nn,texPrimary:Ut,texSecondary:void 0,writingMode:ne.writingMode,glyphOffset:fr,sectionIndex:yt.sectionIndex,isSDF:Pt,pixelOffsetTL:Bn,pixelOffsetBR:Gn,minFontScaleX:0,minFontScaleY:0})}}return Ie}(0,c,T,d,m,x,h,l.allowVerticalPlacement),H=l.textSizeData;let $=null;H.kind==="source"?($=[La*d.layout.get("text-size").evaluate(x,{},j)*I.textScaleFactor],$[0]>cu&&Cn(`${l.layerIds[0]}: Value for "text-size" is >= ${Zg}. Reduce your "text-size".`)):H.kind==="composite"&&($=[La*I.compositeTextSizes[0].evaluate(x,{},j)*I.textScaleFactor,La*I.compositeTextSizes[1].evaluate(x,{},j)*I.textScaleFactor],($[0]>cu||$[1]>cu)&&Cn(`${l.layerIds[0]}: Value for "text-size" is >= ${Zg}. Reduce your "text-size".`)),l.addSymbols(l.text,W,$,T,m,x,y,t,s,M.lineStartIndex,M.lineLength,A,k,j,F,!1);for(const Y of E)P[Y]=l.text.placedSymbolArray.length-1;return 4*W.length}function zw(l){for(const t in l)return l[t];return null}function o0(l,t,s,c,h,d,m,x,T,M){let y=m.top,E=m.bottom,P=m.left,A=m.right;const I=m.collisionPadding;if(I&&(P-=I[0],y-=I[1],A+=I[2],E+=I[3]),T){const k=new wt(P,y),j=new wt(A,y),F=new wt(P,E),W=new wt(A,E),H=wr(T);let $=new wt(0,0);M&&($=new wt(M[0],M[1])),k._rotateAround(H,$),j._rotateAround(H,$),F._rotateAround(H,$),W._rotateAround(H,$),P=Math.min(k.x,j.x,F.x,W.x),A=Math.max(k.x,j.x,F.x,W.x),y=Math.min(k.y,j.y,F.y,W.y),E=Math.max(k.y,j.y,F.y,W.y)}return l.emplaceBack(t.x,t.y,t.z,s.x,s.y,P,y,A,E,x,c,h,d),l.length-1}function jw(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const t=l.bottom-l.top;return t>0?Math.max(10,t):null}function nB(l,t,s,c){const h=l.compareText;if(t in h){const d=h[t];for(let m=d.length-1;m>=0;m--)if(c.dist(d[m])<s)return!0}else h[t]=[];return h[t].push(c),!1}function KM(l,t){const s=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,h=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),d=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01));let m=Math.sin(l._pitch)*d+h;const x=h*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let T=Math.max(l.zoom-17,0);l.isOrthographic&&(T/=10),m*=1+T}return Math.min(1.01*m,x)}function Xg(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};const s=Math.pow(2,-l.z),c=l.x*s,h=(l.x+1)*s,d=l.y*s,m=(l.y+1)*s,x=Ls(c),T=Ls(h),M=Fi(d),y=Fi(m),E=t.project(x,M),P=t.project(T,M),A=t.project(T,y),I=t.project(x,y);let k=Math.min(E.x,P.x,A.x,I.x),j=Math.min(E.y,P.y,A.y,I.y),F=Math.max(E.x,P.x,A.x,I.x),W=Math.max(E.y,P.y,A.y,I.y);const H=s/16;function $(ne,oe,ye,pe,me,Me){const ve=(ye+me)/2,Ie=(pe+Me)/2,Oe=t.project(Ls(ve),Fi(Ie)),Le=Math.max(0,k-Oe.x,j-Oe.y,Oe.x-F,Oe.y-W);k=Math.min(k,Oe.x),F=Math.max(F,Oe.x),j=Math.min(j,Oe.y),W=Math.max(W,Oe.y),Le>H&&($(ne,Oe,ye,pe,ve,Ie),$(Oe,oe,ve,Ie,me,Me))}$(E,P,c,d,h,d),$(P,A,h,d,h,m),$(A,I,h,m,c,m),$(I,E,c,m,c,d),k-=H,j-=H,F+=H,W+=H;const Y=1/Math.max(F-k,W-j);return{scale:Y,x:k*Y,y:j*Y,x2:F*Y,y2:W*Y,projection:t}}function YM(l,{x:t,y:s},c=0){return new wt(((t-c)*l.scale-l.x)*Rt,(s*l.scale-l.y)*Rt)}const iB=he.mat4.identity(new Float32Array(16));class uu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new Qr(0,0)}projectTilePoint(t,s,c){return{x:t,y:s,z:0}}locationPoint(t,s,c,h=!0){return t._coordinatePoint(t.locationCoordinate(s,c),h)}pixelsPerMeter(t,s){return qi(1,t)*s}pixelSpaceConversion(t,s,c){return 1}farthestPixelDistance(t){return KM(t,t.pixelsPerMeter)}pointCoordinate(t,s,c,h){const d=t.horizonLineFromTop(!1),m=new wt(s,Math.max(d,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,h))}pointCoordinate3D(t,s,c){const h=new wt(s,c);if(t.elevation)return t.elevation.pointCoordinate(h);{const d=this.pointCoordinate(t,h.x,h.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(t,s){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,s.x,s.y);const c=t.horizonLineFromTop();return s.y<c}createInversionMatrix(t,s){return iB}createTileMatrix(t,s,c){let h,d,m;const x=c.canonical,T=he.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Xg(x,this);h=1,d=M.x+c.wrap*M.scale,m=M.y,he.mat4.scale(T,T,[h/M.scale,h/M.scale,t.pixelsPerMeter/s])}else h=s/t.zoomScale(x.z),d=(x.x+Math.pow(2,x.z)*c.wrap)*h,m=x.y*h;return he.mat4.translate(T,T,[d,m,0]),he.mat4.scale(T,T,[h/Rt,h/Rt,1]),T}upVector(t,s,c){return[0,0,1]}upVectorScale(t,s,c){return{metersToTile:1}}}class sB extends uu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,c]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(wr(s));this.n=(h+Math.sin(wr(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:c,c:h,r0:d}=this,m=wr(t-this.center[0]),x=wr(s),T=Math.sqrt(h-2*c*Math.sin(x))/c;return{x:T*Math.sin(m*c),y:T*Math.cos(m*c)-d,z:0}}unproject(t,s){const{n:c,c:h,r0:d}=this,m=d+s;let x=Math.atan2(t,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(t)*Math.sign(m));const T=wr(this.center[0])*c;x=Is(x,-Math.PI-T,Math.PI-T);const M=Tr(Hr(x/c)+this.center[0],-180,180),y=Math.asin(Tr((h-(t*t+m*m)*c*c)/(2*c),-1,1)),E=Tr(Hr(y),-Kn,Kn);return new Qr(M,E)}}const Kg=1.340264,Yg=-.081106,Jg=893e-6,Qg=.003796,a0=Math.sqrt(3)/2;class oB extends uu{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(a0*Math.sin(s)),h=c*c,d=h*h*h;return{x:.5*(t*Math.cos(c)/(a0*(Kg+3*Yg*h+d*(7*Jg+9*Qg*h)))/Math.PI+.5),y:1-.5*(c*(Kg+Yg*h+d*(Jg+Qg*h))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=c*c,d=h*h*h;for(let y,E,P,A=0;A<12&&(E=c*(Kg+Yg*h+d*(Jg+Qg*h))-s,P=Kg+3*Yg*h+d*(7*Jg+9*Qg*h),y=E/P,c=Tr(c-y,-Math.PI/3,Math.PI/3),h=c*c,d=h*h*h,!(Math.abs(y)<1e-12));++A);const m=a0*t*(Kg+3*Yg*h+d*(7*Jg+9*Qg*h))/Math.cos(c),x=Math.asin(Math.sin(c)/a0),T=Tr(180*m/Math.PI,-180,180),M=Tr(180*x/Math.PI,-Kn,Kn);return new Qr(T,M)}}class aB extends uu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const c=360*(t-.5),h=Tr(360*(.5-s),-Kn,Kn);return new Qr(c,h)}}const Hf=Math.PI/2;function l0(l){return Math.tan((Hf+l)/2)}class lB extends uu{constructor(t){super(t),this.center=t.center||[0,30];const[s,c]=this.parallels=t.parallels||[30,30];let h=wr(s),d=wr(c);this.southernCenter=h+d<0,this.southernCenter&&(h=-h,d=-d);const m=Math.cos(h),x=l0(h);this.n=h===d?Math.sin(h):Math.log(m/Math.cos(d))/Math.log(l0(d)/x),this.f=m*Math.pow(l0(h),this.n)/this.n}project(t,s){s=wr(s),this.southernCenter&&(s=-s),t=wr(t-this.center[0]);const c=1e-6,{n:h,f:d}=this;d>0?s<-Hf+c&&(s=-Hf+c):s>Hf-c&&(s=Hf-c);const m=d/Math.pow(l0(s),h);let x=m*Math.sin(h*t),T=d-m*Math.cos(h*t);return x=.5*(x/Math.PI+.5),T=.5*(T/Math.PI+.5),{x,y:this.southernCenter?T:1-T,z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:h}=this,d=h-s,m=Math.sign(d),x=Math.sign(c)*Math.sqrt(t*t+d*d);let T=Math.atan2(t,Math.abs(d))*m;d*c<0&&(T-=Math.PI*Math.sign(t)*m);const M=Tr(Hr(T/c)+this.center[0],-180,180),y=Tr(Hr(2*Math.atan(Math.pow(h/x,1/c))-Hf),-Kn,Kn);return new Qr(M,this.southernCenter?-y:y)}}class JM extends uu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:na(t),y:Ds(s),z:0}}unproject(t,s){const c=Ls(t),h=Fi(s);return new Qr(c,h)}}const QM=wr(Kn);class cB extends uu{project(t,s){const c=(s=wr(s))*s,h=c*c;return{x:.5*((t=wr(t))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,h=25,d=0,m=c*c;do{m=c*c;const M=m*m;d=(c*(1.007226+m*(.015085+M*(.028874*m-.044475-.005916*M)))-s)/(1.007226+m*(.045255+M*(.259866*m-.311325-.005916*11*M))),c=Tr(c-d,-QM,QM)}while(Math.abs(d)>1e-6&&--h>0);m=c*c;const x=Tr(Hr(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),T=Hr(c);return new Qr(x,T)}}const eI=wr(Kn);class uB extends uu{project(t,s){s=wr(s),t=wr(t);const c=Math.cos(s),h=2/Math.PI,d=Math.acos(c*Math.cos(t/2)),m=Math.sin(d)/d,x=.5*(t*h+2*c*Math.sin(t/2)/m)||0,T=.5*(s+Math.sin(s)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(t,s){let c=t=(2*t-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,d=25;const m=1e-6;let x=0,T=0;do{const M=Math.cos(h),y=Math.sin(h),E=2*y*M,P=y*y,A=M*M,I=Math.cos(c/2),k=Math.sin(c/2),j=2*I*k,F=k*k,W=1-A*I*I,H=W?1/W:0,$=W?Math.acos(M*I)*Math.sqrt(1/W):0,Y=.5*(2*$*M*k+2*c/Math.PI)-t,ne=.5*($*y+h)-s,oe=.5*H*(A*F+$*M*I*P)+1/Math.PI,ye=H*(j*E/4-$*y*k),pe=.125*H*(E*k-$*y*A*j),me=.5*H*(P*I+$*F*M)+.5,Me=ye*pe-me*oe;x=(ne*ye-Y*me)/Me,T=(Y*pe-ne*oe)/Me,c=Tr(c-x,-Math.PI,Math.PI),h=Tr(h-T,-eI,eI)}while((Math.abs(x)>m||Math.abs(T)>m)&&--d>0);return new Qr(Hr(c),Hr(h))}}class tI extends uu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:c,cosPhi:h}=this;return{x:wr(t)*h*c+.5,y:-Math.sin(wr(s))/h*c+.5,z:0}}unproject(t,s){const{scale:c,cosPhi:h}=this,d=-(s-.5)/c,m=Tr(Hr((t-.5)/c)/h,-180,180),x=Math.asin(Tr(d*h,-1,1)),T=Tr(Hr(x),-Kn,Kn);return new Qr(m,T)}}class dB extends JM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,s,c){const h=tn(t,s,c),d=Mn(di(c));return he.vec3.transformMat4(h,h,d),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,s,c){const h=Yl(s.lat,s.lng),d=he.vec3.normalize([],h),m=c?t._centerAltitude+c:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude,x=qi(1,0)*Rt*m;he.vec3.scaleAndAdd(h,h,d,x);const T=he.mat4.identity(new Float64Array(16));return he.mat4.multiply(T,t.pixelMatrix,t.globeMatrix),he.vec3.transformMat4(h,h,T),new wt(h[0],h[1])}pixelsPerMeter(t,s){return qi(1,0)*s}pixelSpaceConversion(t,s,c){const h=qi(1,t)*s,d=or(qi(1,45)*s,h,c);return this.pixelsPerMeter(t,s)/d}createTileMatrix(t,s,c){const h=hi(di(c.canonical));return he.mat4.multiply(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,s){const{center:c}=t,h=Mn(di(s));return he.mat4.rotateY(h,h,wr(c.lng)),he.mat4.rotateX(h,h,wr(c.lat)),he.mat4.scale(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,s,c,h){return Zr(t,s,c,!0)||new r(0,0)}pointCoordinate3D(t,s,c){const h=this.pointCoordinate(t,s,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,s){return!Zr(t,s.x,s.y,!1)}farthestPixelDistance(t){const s=function(h,d){const m=h.cameraToCenterDistance,x=h._centerAltitude*d,T=h._camera,M=h._camera.forward(),y=he.vec3.add([],he.vec3.scale([],M,-m),[0,0,x]),E=h.worldSize/(2*Math.PI),P=[0,0,-E],A=h.width/h.height,I=Math.tan(h.fovAboveCenter),k=he.vec3.scale([],T.up(),I),j=he.vec3.scale([],T.right(),I*A),F=he.vec3.normalize([],he.vec3.add([],he.vec3.add([],M,k),j)),W=[];let H;if(new lr(y,F).closestPointOnSphere(P,E,W)){const $=he.vec3.add([],W,P),Y=he.vec3.sub([],$,y);H=Math.cos(h.fovAboveCenter)*he.vec3.length(Y)}else{const $=he.vec3.sub([],y,P),Y=he.vec3.sub([],P,y);he.vec3.normalize(Y,Y);const ne=he.vec3.length($)-E;H=Math.sqrt(ne*(ne+2*E));const oe=Math.acos(H/(E+ne))-Math.acos(he.vec3.dot(M,Y));H*=Math.cos(oe)}return 1.01*H}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=Ts(t.zoom);if(c>0){const h=KM(t,qi(1,t.center.lat)*t.worldSize),d=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return or(s,h+d*(1-Math.cos(m)),Math.pow(c,10))}return s}upVector(t,s,c){return tn(s,c,t,1)}upVectorScale(t){return{metersToTile:Vr(pn(di(t)))}}}function rI(l){const t=l.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new JM(l);case"equirectangular":return new aB(l);case"naturalEarth":return new cB(l);case"equalEarth":return new oB(l);case"winkelTripel":return new uB(l);case"albers":return s?new tI(l):new sB(l);case"lambertConformalConic":return s?new tI(l):new lB(l);case"globe":return new dB(l)}throw new Error(`Invalid projection name: ${l.name}`)}const hB=ou.VectorTileFeature.types,fB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function c0(l,t,s,c,h,d,m,x,T,M,y,E,P){const A=x?Math.min(cu,Math.round(x[0])):0,I=x?Math.min(cu,Math.round(x[1])):0;l.emplaceBack(t,s,Math.round(32*c),Math.round(32*h),d,m,(A<<1)+(T?1:0),I,16*M,16*y,256*E,256*P)}function u0(l,t,s){l.emplaceBack(t,s)}function d0(l,t,s,c,h,d,m){l.emplaceBack(t,s,c,h,d,m)}function h0(l,t,s,c,h){l.emplaceBack(t,s,c,h),l.emplaceBack(t,s,c,h),l.emplaceBack(t,s,c,h),l.emplaceBack(t,s,c,h)}function pB(l){for(const t of l.sections)if(wv(t.text))return!0;return!1}class Fw{constructor(t){this.layoutVertexArray=new mg,this.indexArray=new ji,this.programConfigurations=t,this.segments=new Rn,this.dynamicLayoutVertexArray=new Zl,this.opacityVertexArray=new _g,this.placedSymbolArray=new Rv,this.iconTransitioningVertexArray=new ml,this.globeExtVertexArray=new gg,this.zOffsetVertexArray=new Wl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,s,c,h,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,I5.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,R5.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,fB,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,D5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,P5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,k5.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Bt(Fw,"SymbolBuffers");class Bw{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Rn,this.collisionVertexArray=new xg,this.collisionVertexArrayExt=new Zl}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,L5.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,N5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(Bw,"CollisionBuffers");class f0{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=he.mat4.identity([]),this.placementViewportMatrix=he.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Mw(this.zoom,s["text-size"]),this.iconSizeData=Mw(this.zoom,s["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),d=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Js[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Fw(new _l(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new Fw(new _l(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Lv,this.lineVertexArray=new jd,this.symbolInstances=new Dv}calculateGlyphDependencies(t,s,c,h,d){for(const m of t){const x=m.codePointAt(0);if(x===void 0)break;if(s[x]=!0,h&&d&&x<=65535){const T=Gg[m];T&&(s[T.charCodeAt(0)]=!0)}}}updateFootprints(t,s){}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!bw(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,s,c,h){const d=this.layers[0],m=d.layout,x=this.projection.name==="globe",T=m.get("text-font"),M=m.get("text-field"),y=m.get("icon-image"),[E,P]=m.get("icon-size-scale-range"),A=Tr(s.scaleFactor||1,E,P),I=(M.value.kind!=="constant"||M.value.value instanceof ts&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),k=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,j=m.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const F=s.iconDependencies,W=s.glyphDependencies,H=s.availableImages,$=new _n(this.zoom);for(const{feature:Y,id:ne,index:oe,sourceLayerIndex:ye}of t){const pe=d._featureFilter.needGeometry,me=z(Y,pe);if(!d._featureFilter.filter($,me,c))continue;if(pe||(me.geometry=N(Y,c,h)),x&&Y.type!==1&&c.z<=5){const Le=me.geometry,Fe=.98078528056,je=(Xe,$e)=>{const Ke=tn(Xe.x,Xe.y,c,1),xt=tn($e.x,$e.y,c,1);return he.vec3.dot(Ke,xt)<Fe};for(let Xe=0;Xe<Le.length;Xe++)Le[Xe]=v(Le[Xe],je)}let Me,ve;if(I){const Le=d.getValueAndResolveTokens("text-field",me,c,H),Fe=ts.factory(Le);pB(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||bf()==="unavailable"||this.hasRTLText&&mo.isParsed())&&(Me=j5(Fe,d,me))}if(k){const Le=d.getValueAndResolveTokens("icon-image",me,c,H);ve=Le instanceof rs?Le:rs.build(Le)}if(!Me&&!ve)continue;const Ie=this.sortFeaturesByKey?j.evaluate(me,{},c):void 0,Oe={id:ne,text:Me,icon:ve,index:oe,sourceLayerIndex:ye,geometry:me.geometry,properties:Y.properties,type:hB[Y.type],sortKey:Ie};if(this.features.push(Oe),ve){const Le=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Fe,iconSecondary:je}=HM(ve,this.iconSizeData,Le["icon-size"],c,this.zoom,Oe,this.pixelRatio,A),Xe=Fe.id.toString();if(F.has(Xe)?F.get(Xe).push(Fe):F.set(Xe,[Fe]),je){const $e=je.id.toString();F.has($e)?F.get($e).push(je):F.set($e,[je])}}if(Me){const Le=T.evaluate(me,{},c).join(","),Fe=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Js.vertical)>=0;for(const je of Me.sections)if(je.image){const Xe=je.image.getPrimary().scaleSelf(this.pixelRatio),$e=Xe.id.toString(),Ke=F.get($e)||[];Ke.push(Xe),F.set($e,Ke)}else{const Xe=tg(Me.toString()),$e=je.fontStack||Le,Ke=W[$e]=W[$e]||{};this.calculateGlyphDependencies(je.text,Ke,Fe,this.allowVerticalPlacement,Xe)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(Y){const ne={},oe={},ye=[];let pe=0;function me(Oe){ye.push(Y[Oe]),pe++}function Me(Oe,Le,Fe){const je=oe[Oe];return delete oe[Oe],oe[Le]=je,ye[je].geometry[0].pop(),ye[je].geometry[0]=ye[je].geometry[0].concat(Fe[0]),je}function ve(Oe,Le,Fe){const je=ne[Le];return delete ne[Le],ne[Oe]=je,ye[je].geometry[0].shift(),ye[je].geometry[0]=Fe[0].concat(ye[je].geometry[0]),je}function Ie(Oe,Le,Fe){const je=Fe?Le[0][Le[0].length-1]:Le[0][0];return`${Oe}:${je.x}:${je.y}`}for(let Oe=0;Oe<Y.length;Oe++){const Le=Y[Oe],Fe=Le.geometry,je=Le.text?Le.text.toString():null;if(!je){me(Oe);continue}const Xe=Ie(je,Fe),$e=Ie(je,Fe,!0);if(Xe in oe&&$e in ne&&oe[Xe]!==ne[$e]){const Ke=ve(Xe,$e,Fe),xt=Me(Xe,$e,ye[Ke].geometry);delete ne[Xe],delete oe[$e],oe[Ie(je,ye[xt].geometry,!0)]=xt,ye[Ke].geometry=null}else Xe in oe?Me(Xe,$e,Fe):$e in ne?ve(Xe,$e,Fe):(me(Oe),ne[Xe]=pe-1,oe[$e]=pe-1)}return ye.filter(Oe=>Oe.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Y of s.elevationFeatures)this.elevationFeatureIdToIndex.set(Y.id,this.elevationFeatures.length),this.elevationFeatures.push(Y)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Y,ne)=>Y.sortKey-ne.sortKey)}update(t,s,c,h,d,m,x){this.text.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x),this.icon.programConfigurations.updatePaintArrays(t,s,d,c,h,m,x)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);if(c.elevationFeatureIndex===65535)continue;const h=this.elevationFeatures[c.elevationFeatureIndex];if(h){const d=.05+h.pointElevation(new wt(c.tileAnchorX,c.tileAnchorY));c.zOffset!==d&&(t=!0,c.zOffset=d)}}t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(d,m,x)=>{c+=m,c>d.length&&d.resize(c);for(let T=-m;T<0;T++)d.emplace(T+c,x)},s=(d,m,x)=>{h+=m,h>d.length&&d.resize(h);for(let T=-m;T<0;T++)d.emplace(T+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:T,numIconVertices:M}=m,y=m.zOffset,E=M>0;if((x>0||T>0)&&(t(this.text.zOffsetVertexArray,x,y),t(this.text.zOffsetVertexArray,T,y)),E){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:A}=m;P>=0&&s(this.icon.zOffsetVertexArray,M,y),A>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,y)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:h,y:d}of s)this.lineVertexArray.emplaceBack(h,d);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,h,d,m,x,T,M,y,E,P,A,I,k,j){const F=t.indexArray,W=t.layoutVertexArray,H=t.globeExtVertexArray,$=t.segments.prepareSegment(4*s.length,W,F,this.canOverlap?m.sortKey:void 0),Y=this.glyphOffsetArray.length,ne=$.vertexLength,oe=this.allowVerticalPlacement&&x===Js.vertical?Math.PI/2:0,ye=m.text&&m.text.sections;for(let me=0;me<s.length;me++){const{tl:Me,tr:ve,bl:Ie,br:Oe,texPrimary:Le,texSecondary:Fe,pixelOffsetTL:je,pixelOffsetBR:Xe,minFontScaleX:$e,minFontScaleY:Ke,glyphOffset:xt,isSDF:yt,sectionIndex:Ut}=s[me],Et=$.vertexLength,Pt=xt[1];if(c0(W,M.x,M.y,Me.x,Pt+Me.y,Le.x,Le.y,c,yt,je.x,je.y,$e,Ke),c0(W,M.x,M.y,ve.x,Pt+ve.y,Le.x+Le.w,Le.y,c,yt,Xe.x,je.y,$e,Ke),c0(W,M.x,M.y,Ie.x,Pt+Ie.y,Le.x,Le.y+Le.h,c,yt,je.x,Xe.y,$e,Ke),c0(W,M.x,M.y,Oe.x,Pt+Oe.y,Le.x+Le.w,Le.y+Le.h,c,yt,Xe.x,Xe.y,$e,Ke),T){const{x:St,y:rr,z:zt}=T.anchor,[Wt,cr,Mr]=T.up;d0(H,St,rr,zt,Wt,cr,Mr),d0(H,St,rr,zt,Wt,cr,Mr),d0(H,St,rr,zt,Wt,cr,Mr),d0(H,St,rr,zt,Wt,cr,Mr),h0(t.dynamicLayoutVertexArray,St,rr,zt,oe)}else h0(t.dynamicLayoutVertexArray,M.x,M.y,M.z,oe);if(j){const St=Fe||Le;u0(t.iconTransitioningVertexArray,St.x,St.y),u0(t.iconTransitioningVertexArray,St.x+St.w,St.y),u0(t.iconTransitioningVertexArray,St.x,St.y+St.h),u0(t.iconTransitioningVertexArray,St.x+St.w,St.y+St.h)}F.emplaceBack(Et,Et+1,Et+2),F.emplaceBack(Et+1,Et+2,Et+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),me!==s.length-1&&Ut===s[me+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,m,m.index,{},A,I,k,ye&&ye[Ut])}const pe=T?T.anchor:M;t.placedSymbolArray.emplaceBack(pe.x,pe.y,pe.z,M.x,M.y,Y,this.glyphOffsetArray.length-Y,ne,y,E,M.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(t,s,c,h,d,m,x){t.emplaceBack(s,c,h,d,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,s,c,h,d,m,x){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),M=T.vertexLength,y=x.tileAnchorX,E=x.tileAnchorY;for(let A=0;A<4;A++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,t.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,d,m,y,E,new wt(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,d,m,y,E,new wt(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,d,m,y,E,new wt(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,d,m,y,E,new wt(t.x1,t.y2)),T.vertexLength+=4;const P=c.indexArray;P.emplaceBack(M,M+1),P.emplaceBack(M+1,M+2),P.emplaceBack(M+2,M+3),P.emplaceBack(M+3,M),T.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,c,h,d,m){for(let x=h;x<d;x++){const T=c.get(x),M=this.getSymbolInstanceTextSize(t,m,s,x);this._addCollisionDebugVertices(T,M,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,s,c,h,d,m){for(let x=h;x<d;x++){const T=c.get(x),M=this.getSymbolInstanceIconSize(t,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(T,M,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,s,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bw(Nd,yM.members,ml),this.iconCollisionBox=new Bw(Nd,yM.members,ml);const h=Uf(this.iconSizeData,t),d=Uf(this.textSizeData,t,c);for(let m=0;m<this.symbolInstances.length;m++){const x=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,t,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(d,t,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,t,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,t,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(t,s,c,h){const d=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),m=e0(this.textSizeData,t,d)/Wi;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,s,c){const h=this.icon.placedSymbolArray.get(c),d=e0(this.iconSizeData,t,h);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(t,s,c,h){t.emplaceBack(s,-c,-c,h),t.emplaceBack(s,c,-c,h),t.emplaceBack(s,c,c,h),t.emplaceBack(s,-c,c,h)}_updateTextDebugCollisionBoxes(t,s,c,h,d,m,x){for(let T=h;T<d;T++){const M=c.get(T),y=this.getSymbolInstanceTextSize(t,m,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,M.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(t,s,c,h,d,m,x){for(let T=h;T<d;T++){const M=c.get(T),y=this.getSymbolInstanceIconSize(t,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,M.padding,m.zOffset)}}updateCollisionDebugBuffers(t,s,c,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Uf(this.iconSizeData,t,h),m=Uf(this.textSizeData,t,c);for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,t,s,T.textBoxStartIndex,T.textBoxEndIndex,T,c),this._updateTextDebugCollisionBoxes(m,t,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,c),this._updateIconDebugCollisionBoxes(d,t,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(d,t,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,c,h,d,m,x,T,M){const y={};if(s<c){const{x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Y}=t.get(s);y.textBox={x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},y.textFeatureIndex=Y}if(h<d){const{x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Y}=t.get(h);y.verticalTextBox={x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},y.verticalTextFeatureIndex=Y}if(m<x){const{x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Y}=t.get(m);y.iconBox={x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},y.iconFeatureIndex=Y}if(T<M){const{x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Y}=t.get(T);y.verticalIconBox={x1:E,y1:P,x2:A,y2:I,padding:k,projectedAnchorX:j,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},y.verticalIconFeatureIndex=Y}return y}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),h=c.vertexStartIndex+4*c.numGlyphs;for(let d=c.vertexStartIndex;d<h;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),h=[],d=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const T=this.symbolInstances.get(x);h.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),d.push(T.featureIndex)}return m.sort((x,T)=>h[x]-h[T]||d[T]-d[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:M}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),d>=0&&d!==h&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let nI,iI,Uw;Bt(f0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),f0.addDynamicAttributes=h0;class sI{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Tc,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(sI,"FormatSectionOverride",{omit:["defaultValue"]});const Vw=()=>Uw||(Uw={layout:nI||(nI=new Fn({"symbol-placement":new It(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new It(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new It(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new It(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new It(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new It(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new It(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ft(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(Ye.layout_symbol["icon-image"]),"icon-rotate":new Ft(Ye.layout_symbol["icon-rotate"]),"icon-padding":new It(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new It(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(Ye.layout_symbol["icon-offset"]),"icon-anchor":new Ft(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(Ye.layout_symbol["text-field"]),"text-font":new Ft(Ye.layout_symbol["text-font"]),"text-size":new Ft(Ye.layout_symbol["text-size"]),"text-size-scale-range":new It(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new Ft(Ye.layout_symbol["text-max-width"]),"text-line-height":new Ft(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(Ye.layout_symbol["text-justify"]),"text-radial-offset":new Ft(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Ft(Ye.layout_symbol["text-anchor"]),"text-max-angle":new It(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new It(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(Ye.layout_symbol["text-rotate"]),"text-padding":new It(Ye.layout_symbol["text-padding"]),"text-keep-upright":new It(Ye.layout_symbol["text-keep-upright"]),"text-transform":new Ft(Ye.layout_symbol["text-transform"]),"text-offset":new Ft(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new It(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new It(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new It(Ye.layout_symbol["text-optional"]),visibility:new It(Ye.layout_symbol.visibility)})),paint:iI||(iI=new Fn({"icon-opacity":new Ft(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ft(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ft(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ft(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new Ft(Ye.paint_symbol["icon-color"]),"icon-halo-color":new Ft(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new It(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ft(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ft(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ft(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new Ft(Ye.paint_symbol["text-color"],{runtimeType:es,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ft(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(Ye.paint_symbol["text-halo-blur"]),"text-translate":new It(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new It(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new It(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new It(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new It(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new It(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ft(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},Uw);class p0 extends ki{constructor(t,s,c,h){super(t,Vw(),s,c,h),this._colorAdjustmentMatrix=he.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,s){super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const d of c)h.indexOf(d)<0&&h.push(d);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,s,c,h){return this._saturation===t&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(d,m,x,T){d=at(d),m=dd(m);const M=he.mat4.create(),y=d/3,E=1-2*y,P=[E,y,y,0,y,E,y,0,y,y,E,0,0,0,0,1],A=.5-.5*m,I=T-x;return he.mat4.multiply(M,[I,0,0,0,0,I,0,0,0,0,I,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,A,A,A,1]),he.mat4.multiply(M,M,P),M}(t,s,c,h),this._saturation=t,this._contrast=s,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,s,c,h){const d=this.layout.get(t).evaluate(s,{},c,h),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||pf(m.value)||!d?d:function(x,T){return T.replace(/{([^{}]+)}/g,(M,y)=>y in x?String(x[y]):"")}(s.properties,d)}createBucket(t){return new f0(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Vw().paint.overridableProperties){if(!p0.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new sI(s),h=new Km(c,s.property.specification,this.scope,this.options);let d=null;d=s.value.kind==="constant"||s.value.kind==="source"?new Ym("source",h):new Vc("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new Wc(s.property,d,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&p0.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),h=Vw().paint.properties[s];let d=!1;const m=x=>{for(const T of x)if(h.overrides&&h.overrides.hasOverride(T))return void(d=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ts)m(c.value.value.sections);else if(c.value.kind==="source"){const x=M=>{d||(M instanceof va&&ii(M.value)===pd?m(M.value.sections):M instanceof Mc?m(M.sections):M.eachChild(x))},T=c.value;T._styleExpression&&x(T._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,s,c){return{config:new Kl(this,{zoom:s,lut:c}),overrideFog:!1}}}let oI,aI,lI,cI;var $w=Jr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Gw(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function qw(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Hw{constructor(t,s,c,h){this.context=t,this.format=c,this.useMipmap=h&&h.useMipmap,this.texture=t.gl.createTexture(),this.update(s,{premultiply:h&&h.premultiply})}update(t,s){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,h=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:d}=this,{gl:m}=d,{x,y:T}=s&&s.position?s.position:{x:0,y:0},M=x+c,y=T+h;!this.size||this.size[0]===M&&this.size[1]===y||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!s||s.premultiply!==!1));const E=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&M>0&&y>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(M,y)))+1:1;m.texStorage2D(m.TEXTURE_2D,P,this.format,M,y),this.size=[M,y]}if(this.size)if(E)m.texSubImage2D(m.TEXTURE_2D,0,x,T,Gw(this.format),qw(this.format),t);else{const P=t.data;P&&m.texSubImage2D(m.TEXTURE_2D,0,x,T,c,h,Gw(this.format),qw(this.format),P)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(t,s,c=!1){const{context:h}=this,{gl:d}=h;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(t,s,c,h){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class m0{constructor(t,s){this.context=t,this.texture=s}bind(t,s){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}}function g0(l,t,s,c,h,d,m,x){const T=[l,t,1,s,c,1,h,d,1],M=[m,x,1],y=he.mat3.adjoint([],T),[E,P,A]=he.vec3.transformMat3(M,M,y);return he.mat3.multiply(T,T,[E,0,0,0,P,0,0,0,A])}function uI(l,t,s,c,h,d,m,x){const T=function(M,y,E,P,A,I,k,j){const F=g0(0,0,1,0,1,1,0,1),W=g0(M,y,E,P,A,I,k,j),H=he.mat3.adjoint([],F);return he.mat3.multiply(W,W,H)}(l,t,s,c,h,d,m,x);return[T[2]/T[8]/Rt,T[5]/T[8]/Rt]}function _0(l){return[l[0],Math.min(Math.max(l[1],-Kn),Kn)]}class dI extends Po{constructor(t,s,c,h){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=s,this._dirty=!1}load(t,s){if(this._loaded=s||!1,this.fire(new Ps("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=ym(this.map._requestManager.transformRequest(this.url,Pi.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Sc(c)):h&&(this.image=h instanceof HTMLImageElement?ot.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new m0(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ps("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof m0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=t[0][1],c=t[0][1];for(const d of t)d[1]>c&&(c=d[1]),d[1]<s&&(s=d[1]);const h=(c+s)/2;if(h>Kn?this.onNorthPole=!0:h<-Kn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=t.map(r.fromLngLat);this.tileID=function(m){let x=1/0,T=1/0,M=-1/0,y=-1/0;for(const k of m)x=Math.min(x,k.x),T=Math.min(T,k.y),M=Math.max(M,k.x),y=Math.max(y,k.y);const E=Math.max(M-x,y-T),P=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),A=Math.pow(2,P);let I=Math.floor((x+M)/2*A);return I>1&&(I-=1),new _t(P,I,Math.floor((T+y)/2*A))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ps("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const F in this.tiles){const W=this.tiles[F];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Xg(new _t(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const W=F[1].x-F[0].x,H=F[1].y-F[0].y,$=F[2].x-F[1].x,Y=F[2].y-F[1].y,ne=F[3].x-F[2].x,oe=F[3].y-F[2].y,ye=F[0].x-F[3].x,pe=F[0].y-F[3].y,me=W*Y-$*H,Me=$*oe-ne*Y,ve=ne*pe-ye*oe,Ie=ye*H-W*pe;return me>0&&Me>0&&ve>0&&Ie>0||me<0&&Me<0&&ve<0&&Ie<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Xg(this.tileID,this.map.transform.projection),[d,m,x,T]=this.coordinates.map(F=>{const W=h.projection.project(F[0],F[1]);return YM(h,W)._round()});this.perspectiveTransform=uI(d.x,d.y,m.x,m.y,x.x,x.y,T.x,T.y);const M=this._boundsArray=new Ia;M.emplaceBack(d.x,d.y,0,0),M.emplaceBack(m.x,m.y,Rt,0),M.emplaceBack(T.x,T.y,0,Rt),M.emplaceBack(x.x,x.y,Rt,Rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(M,$w.members),this.boundsSegments=Rn.simpleSegment(0,0,4,2);const y=[],E=[_0((P=this.coordinates)[0]),_0(P[1]),_0(P[2]),_0(P[3])];var P;const[A,I,k,j]=function(F){let W=F[0][0],H=W,$=F[0][1],Y=$;for(let ne=1;ne<F.length;ne++)F[ne][0]<W?W=F[ne][0]:F[ne][0]>H&&(H=F[ne][0]),F[ne][1]<$?$=F[ne][1]:F[ne][1]>Y&&(Y=F[ne][1]);return[W,$,H-W,Y-$]}(E);{const F=new Ia,[W,H,$,Y]=function(je){let Xe=je[0].x,$e=Xe,Ke=je[0].y,xt=Ke;for(let yt=1;yt<je.length;yt++)je[yt].x<Xe?Xe=je[yt].x:je[yt].x>$e&&($e=je[yt].x),je[yt].y<Ke?Ke=je[yt].y:je[yt].y>xt&&(xt=je[yt].y);return[Xe,Ke,$e-Xe,xt-Ke]}(c),ne=je=>[(je.x-W)/$,(je.y-H)/Y],[oe,ye,pe,me]=c.map(ne),Me=function(je,Xe,$e,Ke,xt,yt,Ut,Et){const Pt=g0(0,0,1,0,1,1,0,1),St=g0(je,Xe,$e,Ke,xt,yt,Ut,Et),rr=he.mat3.adjoint([],St);return he.mat3.multiply(Pt,Pt,rr)}(oe[0],oe[1],ye[0],ye[1],pe[0],pe[1],me[0],me[1]);this.elevatedGlobePerspectiveTransform=uI(oe[0],oe[1],ye[0],ye[1],pe[0],pe[1],me[0],me[1]);const ve=(je,Xe)=>{y.push(je.lng);const $e=Math.round((je.lng-A)/k*Rt),Ke=Math.round((je.lat-I)/j*Rt),xt=ne(Xe),yt=he.vec3.transformMat3([],[xt[0],xt[1],1],Me),Ut=Math.round(yt[0]/yt[2]*Rt),Et=Math.round(yt[1]/yt[2]*Rt);F.emplaceBack($e,Ke,Ut,Et)},Ie=c[3].x-c[0].x,Oe=c[3].y-c[0].y,Le=c[2].x-c[1].x,Fe=c[2].y-c[1].y;for(let je=0;je<65;je++){const Xe=je/64,$e=[c[0].x+Xe*Ie,c[0].y+Xe*Oe],Ke=[c[1].x+Xe*Le,c[1].y+Xe*Fe],xt=Ke[0]-$e[0],yt=Ke[1]-$e[1];for(let Ut=0;Ut<65;Ut++){const Et=Ut/64,Pt={x:$e[0]+xt*Et,y:$e[1]+yt*Et,z:0};ve(s.projection.unproject(Pt.x,Pt.y),Pt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(F,$w.members)}{this.maxLongitudeTriangleSize=0;let F=[],W=new ji;const H=($,Y,ne)=>{W.emplaceBack($,Y,ne);const oe=y[$],ye=y[Y],pe=y[ne],me=Math.min(Math.min(oe,ye),pe),Me=Math.max(Math.max(oe,ye),pe)-me;Me>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Me),F.push(me+Me/2)};for(let $=0;$<64;$++)for(let Y=0;Y<64;Y++){const ne=65*$+Y,oe=ne+1,ye=ne+65,pe=ye+1;H(ne,ye,oe),H(oe,ye,pe)}[F,W]=function($,Y){const ne=Array.from({length:$.length},(pe,me)=>me);ne.sort((pe,me)=>$[pe]-$[me]);const oe=[],ye=new ji;for(let pe=0;pe<ne.length;pe++){const me=ne[pe];oe.push($[me]);const Me=3*me,ve=Me+1;ye.emplaceBack(Y.uint16[Me],Y.uint16[ve],Y.uint16[ve+1])}return[oe,ye]}(F,W),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(W)}this.elevatedGlobeSegments=Rn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/Rt,0,j/Rt,0,0,I,A,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof m0||(this.texture?this.texture.update(this.image):(this.texture=new Hw(s,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(s)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let h=(d=t+180)+360*Math.round((c[0]-d)/360);var d;const m=new Rn,x=(E,P)=>{m.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:s.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=T){const E=$h(c,0,c.length,h+T);return E===c.length||x(E,vc(c,E+1,c.length,h+360-T)-E),m}h<c[0]&&(h+=360);const M=vc(c,0,c.length,h-T);if(M===c.length)return x(0,c.length),m;x(0,M-0);const y=$h(c,M+1,c.length,h+T);return y!==c.length&&x(y,c.length-y),m}}const mB=(Math.pow(256,2)-1)/16907520;class hI extends ki{constructor(t,s,c,h){super(t,{layout:lI||(lI=new Fn({visibility:new It(Ye.layout_raster.visibility)})),paint:cI||(cI=new Fn({"raster-opacity":new It(Ye.paint_raster["raster-opacity"]),"raster-color":new Xc(Ye.paint_raster["raster-color"]),"raster-color-mix":new It(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new It(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new It(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new It(Ye.paint_raster["raster-saturation"]),"raster-contrast":new It(Ye.paint_raster["raster-contrast"]),"raster-resampling":new It(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new It(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new It(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new It(Ye.paint_raster["raster-array-band"]),"raster-elevation":new It(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},s,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof dI&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Lg({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let fI,pI,mI,gI,_I;class yI extends ki{constructor(t,s,c,h){super(t,{layout:fI||(fI=new Fn({visibility:new It(Ye["layout_raster-particle"].visibility)})),paint:pI||(pI=new Fn({"raster-particle-array-band":new It(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new It(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Xc(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new It(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new It(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new It(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new It(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new It(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},s,c,h),this._updateColorRamp(),this.lastInvalidatedAt=ot.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Lg({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ot.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class gB extends ki{constructor(t,s){super(t,{},s,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Ww(l,t,s){const c=[0,0,1],h=he.quat.identity([]);return he.quat.rotateY(h,h,s?-wr(l)+Math.PI:wr(l)),he.quat.rotateX(h,h,-wr(t)),he.vec3.transformQuat(c,c,h),he.vec3.normalize(c,c)}function vI(l,t){const s=y0(l.projection,l.zoom,l.width,l.height),c=function(d,m,x,T,M){const y=new Qr(x.lng-180*du,x.lat),E=new Qr(x.lng+180*du,x.lat),P=d.project(y.lng,y.lat),A=d.project(E.lng,E.lat),I=-Math.atan2(A.y-P.y,A.x-P.x),k=r.fromLngLat(x);k.y=Tr(k.y,-1+du,1-du);const j=k.toLngLat(),F=d.project(j.lng,j.lat),W=r.fromLngLat(j);W.x+=du;const H=W.toLngLat(),$=d.project(H.lng,H.lat),Y=bI($.x-F.x,$.y-F.y,I),ne=r.fromLngLat(j);ne.y+=du;const oe=ne.toLngLat(),ye=d.project(oe.lng,oe.lat),pe=bI(ye.x-F.x,ye.y-F.y,I),me=Math.abs(Y.x)/Math.abs(pe.y),Me=he.mat4.identity([]);he.mat4.rotateZ(Me,Me,-I*(1-(M?0:T)));const ve=he.mat4.identity([]);return he.mat4.scale(ve,ve,[1,1-(1-me)*T,1]),ve[4]=-pe.x/pe.y*T,he.mat4.rotateZ(ve,ve,I),he.mat4.multiply(ve,Me,ve),ve}(l.projection,0,l.center,s,t),h=xI(l);return he.mat4.scale(c,c,[h,h,1]),c}function xI(l){const t=l.projection,s=y0(l.projection,l.zoom,l.width,l.height),c=Zw(t,l.center),h=Zw(t,Qr.convert(t.center));return Math.pow(2,c*s+(1-s)*h)}function y0(l,t,s,c,h=1/0){const d=l.range;if(!d)return 0;const m=Math.min(h,Math.max(s,c)),x=Math.log(m/1024)/Math.LN2;return mi(d[0]+x,d[1]+x,t)}const du=1/4e4;function Zw(l,t){const s=Tr(t.lat,-Kn,Kn),c=new Qr(t.lng-180*du,s),h=new Qr(t.lng+180*du,s),d=l.project(c.lng,s),m=l.project(h.lng,s),x=r.fromLngLat(c),T=r.fromLngLat(h),M=m.x-d.x,y=m.y-d.y,E=T.x-x.x,P=T.y-x.y,A=Math.sqrt((E*E+P*P)/(M*M+y*y));return Math.log(A)/Math.LN2}function bI(l,t,s){const c=Math.cos(s),h=Math.sin(s);return{x:l*c-t*h,y:l*h+t*c}}function wI(l,t,s){he.mat4.identity(l),he.mat4.rotateZ(l,l,wr(t[2])),he.mat4.rotateX(l,l,wr(t[0])),he.mat4.rotateY(l,l,wr(t[1])),he.mat4.scale(l,l,s),he.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function v0(l,t,s,c,h,d,m,x){const T=[s[0]-t[0],s[1]-t[1],0],M=[c[0]-t[0],c[1]-t[1],0];if(he.vec3.length(T)<1e-12||he.vec3.length(M)<1e-12)return he.quat.identity(l);const y=he.vec3.cross([],T,M);he.vec3.normalize(y,y),he.vec3.subtract(M,c,t),T[2]=(d-h)*x,M[2]=(m-h)*x;const E=T;return he.vec3.cross(E,T,M),he.vec3.normalize(E,E),he.quat.rotationTo(l,y,E)}function Xw(l,t,s=!1){const c=Ts(t.zoom),h=function(d,m,x){const T=m.worldSize,M=[d[12],d[13],d[14]],y=Fi(M[1]/T),E=Ls(M[0]/T),P=he.mat4.identity([]),A=qi(1,y)*T,I=qi(1,0)*T*vl(y,m.zoom),k=1/ia(T);let j=I*k;if(x){const $=y0(m.projection,m.zoom,m.width,m.height,1024);j=k*m.projection.pixelSpaceConversion(m.center.lat,T,$)}const F=Yl(y,E);he.vec3.add(F,F,he.vec3.scale([],he.vec3.normalize([],F),A*j*M[2]));const W=function($){const Y=[$[0],$[1],$[2]];let ne=[0,1,0];const oe=he.vec3.cross([],ne,Y);return he.vec3.cross(ne,Y,oe),he.vec3.squaredLength(ne)===0&&(ne=[0,1,0],he.vec3.cross(oe,Y,ne)),he.vec3.normalize(oe,oe),he.vec3.normalize(ne,ne),he.vec3.normalize(Y,Y),[oe[0],oe[1],oe[2],0,ne[0],ne[1],ne[2],0,Y[0],Y[1],Y[2],0,$[0],$[1],$[2],1]}(F);he.mat4.scale(P,P,[j,j,j*A]),he.mat4.translate(P,P,[-M[0],-M[1],-M[2]]);const H=he.mat4.multiply([],m.globeMatrix,W);return he.mat4.multiply(H,H,P),he.mat4.multiply(H,H,d),H}(l,t,s);if(c>0){const d=function(m,x){const T=x.worldSize,M=qi(1,0)*T*vl(x.center.lat,x.zoom)/ia(T),y=qi(1,x.center.lat)*T,E=he.mat4.identity([]);return he.mat4.rotateY(E,E,wr(x.center.lng)),he.mat4.rotateX(E,E,wr(x.center.lat)),he.mat4.translate(E,E,[0,0,fs]),he.mat4.scale(E,E,[M,M,M*y]),he.mat4.translate(E,E,[x.point.x-.5*T,x.point.y-.5*T,0]),he.mat4.multiply(E,E,m),he.mat4.multiply(E,x.globeMatrix,E)}(l,t);return function(m,x,T){const M=(I,k,j)=>{const F=he.vec3.length(I),W=he.vec3.length(k),H=yi(I,k,j);return he.vec3.scale(H,H,1/he.vec3.length(H)*or(F,W,j))},y=M([m[0],m[1],m[2]],[x[0],x[1],x[2]],T),E=M([m[4],m[5],m[6]],[x[4],x[5],x[6]],T),P=M([m[8],m[9],m[10]],[x[8],x[9],x[10]],T),A=yi([m[12],m[13],m[14]],[x[12],x[13],x[14]],T);return[y[0],y[1],y[2],0,E[0],E[1],E[2],0,P[0],P[1],P[2],0,A[0],A[1],A[2],1]}(h,d,c)}return h}function SI(l,t,s,c){const h=Xt.projectAabbCorners(c,s);let d=Number.MAX_VALUE,m=-1;for(let M=0;M<h.length;++M){const y=h[M];y[0]=(.5*y[0]+.5)*t.width,y[1]=(.5-.5*y[1])*t.height,y[2]<d&&(m=M,d=y[2])}const x=M=>new wt(h[M][0],h[M][1]);let T;switch(m){case 0:case 6:T=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:T=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:T=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:T=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(se(l,T))return d}const _B=Jr([{name:"a_pos_3f",components:3,type:"Float32"}]),yB=Jr([{name:"a_color_3f",components:3,type:"Float32"}]),vB=Jr([{name:"a_color_4f",components:4,type:"Float32"}]),xB=Jr([{name:"a_uv_2f",components:2,type:"Float32"}]),bB=Jr([{name:"a_normal_3f",components:3,type:"Float32"}]),wB=Jr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),SB=Jr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),TI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class x0{constructor(t,s,c,h){this.message=(t?`${t}: `:"")+c,h&&(this.identifier=h),s!=null&&s.__line__&&(this.line=s.__line__)}}function EI(l,t){const s=l.indexOf("://")===-1;try{return new URL(l,s&&t?"http://example.com":void 0),!0}catch{return!1}}class CI{constructor(t,s){this.feature=t,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class AI{constructor(){this.instancedDataArray=new kf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Kw{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,s){}populate(t,s,c,h){this.tileToMeter=p(c);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:x,index:T,sourceLayerIndex:M}of t){const y=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),E=z(m,d);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),E,c))continue;const P={id:y,sourceLayerIndex:M,index:T,geometry:d?E.geometry:N(m,c,h),properties:m.properties,type:m.type,patterns:{}},A=this.addFeature(P,P.geometry,E);A&&s.featureIndex.insert(m,P.geometry,T,M,this.index,this.instancesPerModel[A].instancedDataArray.length,Rt/32)}this.lookup=null}update(t,s,c,h){for(const d in this.instancesPerModel){const m=this.instancesPerModel[d];for(const x in t)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],t[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const h of c.features){const d=this.layers[0],m=h.feature,x=this.canonical,T=d.paint.get("model-rotation").evaluate(m,{},x),M=d.paint.get("model-scale").evaluate(m,{},x),y=d.paint.get("model-translation").evaluate(m,{},x);he.vec3.exactEquals(h.rotation,T)&&he.vec3.exactEquals(h.scale,M)&&he.vec3.exactEquals(h.translation,y)||(this.evaluate(h,h.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,s,c,h){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(bw(this.activeReplacements,d))return!1;this.activeReplacements=d;let m=!1;for(const x in this.instancesPerModel){const T=this.instancesPerModel[x],M=T.instancedDataArray;for(const y of T.features){const E=y.instancedDataOffset,P=y.instancedDataCount;for(let A=0;A<P;A++){const I=16*(A+E);let k=M.float32[I+0];const j=k>Rt;k=j?k-Rt:k;const F=Math.floor(k),W=M.float32[I+1];let H=!1;for(const $ of this.activeReplacements)if(!OA($,c,TI.Model,h)&&!($.min.x>F||F>$.max.x||$.min.y>W||W>$.max.y)&&(H=VA(UA(F,W,t.canonical,$.footprintTileId.canonical),$.footprint),H))break;M.float32[I]=H?k+Rt:k,m=m||H!==j}}}return m}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,wB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const s of this.modelUris)t.removeModel(s,"")}addFeature(t,s,c){const h=this.layers[0],d=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!d)return Cn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),d;EI(d,!1)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new AI);const m=this.instancesPerModel[d],x=m.instancedDataArray,T=new CI(c,x.length);for(const M of s)for(const y of M){if(y.x<0||y.x>=Rt||y.y<0||y.y>=Rt)continue;const E=(this.lookupDim-1)/Rt,P=this.lookupDim*(y.y*E|0)+y.x*E|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const A=x.length;x.resize(A+1),m.instancesEvaluatedElevation.push(0),x.float32[16*A]=y.x,x.float32[16*A+1]=y.y}return T.instancedDataCount=m.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(t.id&&(m.idToFeaturesIndex[t.id]=m.features.length),m.features.push(T),this.evaluate(T,{},m,!1)),d}getModelUris(){return this.modelUris}evaluate(t,s,c,h){const d=this.layers[0],m=t.feature,x=this.canonical,T=t.rotation=d.paint.get("model-rotation").evaluate(m,s,x),M=t.scale=d.paint.get("model-scale").evaluate(m,s,x),y=t.translation=d.paint.get("model-translation").evaluate(m,s,x),E=d.paint.get("model-color").evaluate(m,s,x);E.a=d.paint.get("model-color-mix-intensity").evaluate(m,s,x);const P=[];this.maxVerticalOffset<y[2]&&(this.maxVerticalOffset=y[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),wI(P,T,M);const A=Math.round(100*E.a)+E.b/1.05;for(let I=0;I<t.instancedDataCount;++I){const k=t.instancedDataOffset+I,j=16*k,F=c.instancedDataArray.float32;let W=0;h&&(W=F[j+6]-c.instancesEvaluatedElevation[k]);const H=0|F[j+1];F[j]=(0|F[j])+E.r/1.05,F[j+1]=H+E.g/1.05,F[j+2]=A,F[j+3]=1/(x.z>10?this.tileToMeter:p(x,H)),F[j+4]=y[0],F[j+5]=y[1],F[j+6]=y[2]+W,F[j+7]=P[0],F[j+8]=P[1],F[j+9]=P[2],F[j+10]=P[4],F[j+11]=P[5],F[j+12]=P[6],F[j+13]=P[8],F[j+14]=P[9],F[j+15]=P[10],c.instancesEvaluatedElevation[k]=y[2]}}}let MI,II;Bt(Kw,"ModelBucket",{omit:["layers"]}),Bt(AI,"PerModelAttributes"),Bt(CI,"ModelFeature");const Yd=64,Wf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function PI(l,t,s,c,h,d,m,x,T,M=!1){const y=s.zoom,E=s.project(c),P=vl(c.lat,y),A=1/P;he.mat4.identity(l),he.mat4.translate(l,l,[E.x+m[0]*A,E.y+m[1]*A,m[2]]);let I=1,k=1;const j=s.worldSize;if(M){if(s.projection.name==="mercator"){let $=0;s.elevation&&($=s.elevation.getAtPointOrZero(new r(E.x/j,E.y/j),0));const Y=he.vec4.transformMat4([],[E.x,E.y,$,1],s.projMatrix)[3]/s.cameraToCenterDistance;I=Y,k=Y*vl(s.center.lat,y)}else if(s.projection.name==="globe"){const $=Xw(l,s),Y=he.mat4.multiply([],s.projMatrix,$),ne=[0,0,0,1];he.vec4.transformMat4(ne,ne,Y);const oe=ne[3]/s.cameraToCenterDistance,ye=Ts(y),pe=s.projection.pixelsPerMeter(c.lat,j)*vl(c.lat,y),me=s.projection.pixelsPerMeter(s.center.lat,j)*vl(s.center.lat,y);I=oe/or(pe,$v(s.center.lat),ye),k=oe*P/pe,I*=me,k*=me}}else I=A;he.mat4.scale(l,l,[I,I,k]);const F=[...l],W=t.orientation,H=[];if(wI(H,[W[0]+h[0],W[1]+h[1],W[2]+h[2]],d),he.mat4.multiply(l,F,H),x&&s.elevation){let $=0;const Y=[];if(T&&s.elevation){$=function(ye,pe,me,Me,ve){const Ie=pe.elevation;if(!Ie)return 0;const Oe=Xt.projectAabbCorners(me,Me),Le=qi(1,ve.lat)*pe.worldSize,Fe=function(rr,zt){const Wt=[0,0,1],cr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Mr of cr){const fr=rr[Mr.corners[0]],Dr=rr[Mr.corners[1]],Ar=rr[Mr.corners[2]],Nr=[Dr[0]-fr[0],Dr[1]-fr[1],zt*(Dr[2]-fr[2])],Xr=he.vec3.cross(Nr,Nr,[Ar[0]-fr[0],Ar[1]-fr[1],zt*(Ar[2]-fr[2])]);he.vec3.normalize(Xr,Xr),Mr.dotProductWithUp=he.vec3.dot(Xr,Wt)}return cr.sort((Mr,fr)=>Mr.dotProductWithUp-fr.dotProductWithUp),cr[0].corners}(Oe,Le),je=Oe[Fe[0]],Xe=Oe[Fe[1]],$e=Oe[Fe[2]],Ke=Oe[Fe[3]],xt=Ie.getAtPointOrZero(new r(je[0]/pe.worldSize,je[1]/pe.worldSize),0),yt=Ie.getAtPointOrZero(new r(Xe[0]/pe.worldSize,Xe[1]/pe.worldSize),0),Ut=Ie.getAtPointOrZero(new r($e[0]/pe.worldSize,$e[1]/pe.worldSize),0),Et=Ie.getAtPointOrZero(new r(Ke[0]/pe.worldSize,Ke[1]/pe.worldSize),0),Pt=(xt+Et)/2,St=(yt+Ut)/2;return Pt>St?yt<Ut?v0(ye,Xe,Ke,je,yt,Et,xt,Le):v0(ye,$e,je,Ke,Ut,xt,Et,Le):xt<Et?v0(ye,je,Xe,$e,xt,yt,Ut,Le):v0(ye,Ke,$e,Xe,Et,Ut,yt,Le),Math.max(Pt,St)}(Y,s,t.aabb,l,c);const ne=he.mat4.fromQuat([],Y),oe=he.mat4.multiply([],ne,H);he.mat4.multiply(l,F,oe)}else $=s.elevation.getAtPointOrZero(new r(E.x/j,E.y/j),0);$!==0&&(l[14]+=$)}}function e_(l,t,s=!1){l.uploaded||(l.gfxTexture=new Hw(t,l.image,s?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function TB(l,t,s){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,_B.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,bB.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,xB.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?yB:vB).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,SB.members,!0)),l.segments=Rn.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const c=l.material;c.pbrMetallicRoughness.baseColorTexture&&e_(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&e_(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&e_(c.normalTexture,t),c.occlusionTexture&&e_(c.occlusionTexture,t,s),c.emissionTexture&&e_(c.emissionTexture,t)}function Yw(l,t,s){if(l.meshes)for(const c of l.meshes)TB(c,t,s);if(l.children)for(const c of l.children)Yw(c,t,s)}function b0(l){if(l.meshes)for(const t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(const t of l.children)b0(t)}function Jw(l){if(l.meshes)for(const s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((t=s.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(const s of l.children)Jw(s)}class Zf{constructor(t,s,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(t,s,c){const h=c||t.findDEMTileFor(s);if(!h||!h.dem)return;const d=h.dem,m=h.tileID,x=1<<s.canonical.z-m.canonical.z;return new Zf(h,d.dim/Rt/x,[(s.canonical.x/x-m.canonical.x)*d.dim,(s.canonical.y/x-m.canonical.y)*d.dim])}tileCoordToPixel(t,s){const c=s*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),d=Math.floor(c);return new wt(h,d)}getElevationAt(t,s,c,h){const d=t*this._scale+this._offset[0],m=s*this._scale+this._offset[1],x=Math.floor(d),T=Math.floor(m),M=this._dem;return h=!!h,c?or(or(M.get(x,T,h),M.get(x,T+1,h),m-T),or(M.get(x+1,T,h),M.get(x+1,T+1,h),m-T),d-x):M.get(x,T,h)}getElevationAtPixel(t,s,c){return this._dem.get(t,s,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*qi(1,t)*this._dem.stride}}const Qw=new Float32Array(262144),Jd=new Uint8Array(262144);function RI(l){let t=0;if(l.meshes)for(const s of l.meshes)t=Math.max(t,s.aabb.max[2]);if(l.children)for(const s of l.children)t=Math.max(t,RI(s));return t}function kI(l,t,s){if(l.meshes)for(const c of l.meshes){if(c.aabb.min[0]===1/0)continue;const h=Xt.applyTransform(c.aabb,l.matrix);s.insert(t,h.min[0],h.min[1],h.max[0],h.max[1])}if(l.children)for(const c of l.children)kI(c,t,s)}const DI=["","wall","door","roof","window","lamp","logo"];class LI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:RI(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const s=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=Xt.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),t++;this.aabb=s}return this.aabb}}class w0{constructor(t,s,c,h,d,m,x){this.id=c,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Wf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Wf.HasMapboxMeshFeatures),d&&(this.modelTraits|=Wf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of s)this.nodesInfo.push(new LI(T)),kI(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,s){for(const c of this.getNodesInfo()){const h=c.node;h.footprint&&s.push({footprint:h.footprint,id:t})}}update(t){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const c=s?this.stateDependentLayers:this.layers;if(!dn(t,this.states))for(const h of c)this.evaluate(h,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const h=c.node;this.uploaded?this.updatePbrBuffer(h):Yw(h,t,!0)}for(const c of s)b0(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let s=!1;if(!t.meshes)return s;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(t,s,c){const h=t.transform.projectionOptions,d=t.style.getBrightness(),m=this.brightness!==d;if(!this.uploaded||this.dirty||h.name!==this.projection.name||t_(c.paint.get("model-color").value,m)||t_(c.paint.get("model-color-mix-intensity").value,m)||t_(c.paint.get("model-roughness").value,m)||t_(c.paint.get("model-emissive-strength").value,m)||t_(c.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=h,this.brightness=d;const x=this.getNodesInfo();for(const T of x)T.state=null;return!0}return!1}evaluateScale(t,s){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),h=this.id.canonical;for(const d of c){const m=d.feature;d.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},h)}}evaluate(t,s){const c=this.getNodesInfo();for(const h of c){if(!h.node.meshes)continue;const d=h.feature,m=s&&s[d.id];if(dn(m,h.state))continue;h.state=structuredClone(m);const x=h.node.meshes&&h.node.meshes[0].featureData,T=h.evaluatedColor[2],M=h.evaluatedRMEA[2],y=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let E=0;E<DI.length;E++){const P=DI[E];P.length&&(d.properties.part=P);const A=t.paint.get("model-color").evaluate(d,m,y).toRenderColor(null),I=t.paint.get("model-color-mix-intensity").evaluate(d,m,y);h.evaluatedColor[E]=[A.r,A.g,A.b,I],h.evaluatedRMEA[E][0]=t.paint.get("model-roughness").evaluate(d,m,y),h.evaluatedRMEA[E][2]=t.paint.get("model-emissive-strength").evaluate(d,m,y),h.evaluatedRMEA[E][3]=A.a,h.emissionHeightBasedParams[E]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,m,y),!h.hasTranslucentParts&&A.a<1&&(h.hasTranslucentParts=!0)}delete d.properties.part,CB(h,T!==h.evaluatedColor[2]||M!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(d,m,y);h.evaluatedScale=t.paint.get("model-scale").evaluate(d,m,y),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,s,c,h){const d=t.findDEMTileFor(c);if(d&&(d.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const m=Zf.create(t,c,d);if(!m)return;this.modelTraits&Wf.HasMapboxMeshFeatures&&this.updateDEM(t,m,c,h);for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const M=T.footprint.vertices;let y=m.getElevationAt(M[0].x,M[0].y,!0,!0);for(let E=1;E<M.length;E++)y=Math.min(y,m.getElevationAt(M[E].x,M[E].y,!0,!0));T.elevation=y}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=s}}updateDEM(t,s,c,h){let d=s._dem._modifiedForSources[h];if(d===void 0&&(s._dem._modifiedForSources[h]=[],d=s._dem._modifiedForSources[h]),d.includes(c.canonical))return;const m=s._dem.dim;d.push(c.canonical);let x=!1;for(const T of this.getNodesInfo()){const M=T.node;if(!M.footprint||!M.footprint.grid)continue;const y=M.footprint.grid,E=s.tileCoordToPixel(y.min.x,y.min.y),P=s.tileCoordToPixel(y.max.x,y.max.y),A=Math.min(Math.min(m-P.y,E.x),Math.min(E.y,m-P.x));if(A<0)continue;const I=Tr(A,2,5);let k=Math.max(0,E.x-I),j=Math.max(0,E.y-I),F=Math.min(P.x+I,m-1),W=Math.min(P.y+I,m-1);for(let ne=j;ne<=W;++ne)for(let oe=k;oe<=F;++oe)Jd[ne*m+oe]=255;let H=0,$=0;for(let ne=0;ne<y.cellsY;++ne)for(let oe=0;oe<y.cellsX;++oe){if(!y.cells[ne*y.cellsX+oe])continue;const ye=s.tileCoordToPixel(y.min.x+oe/y.xScale,y.min.y+ne/y.yScale),pe=s.tileCoordToPixel(y.min.x+(oe+1)/y.xScale,y.min.y+(ne+1)/y.yScale);for(let me=ye.y;me<=Math.min(pe.y+1,m-1);++me)for(let Me=ye.x;Me<=Math.min(pe.x+1,m-1);++Me)Jd[me*m+Me]===255&&(Jd[me*m+Me]=0,H+=s.getElevationAtPixel(Me,me),$++)}const Y=H/$;k=Math.max(1,E.x-I),j=Math.max(1,E.y-I),F=Math.min(P.x+I,m-2),W=Math.min(P.y+I,m-2),x=!0;for(let ne=j;ne<=W;++ne)for(let oe=k;oe<=F;++oe)Jd[ne*m+oe]===0&&(Qw[ne*m+oe]=s._dem.set(oe,ne,Y));for(let ne=1;ne<I;++ne){k=Math.max(1,E.x-ne),j=Math.max(1,E.y-ne),F=Math.min(P.x+ne,m-2),W=Math.min(P.y+ne,m-2);for(let oe=j;oe<=W;++oe)for(let ye=k;ye<=F;++ye){const pe=oe*m+ye;if(Jd[pe]===255){let me=0,Me=0,ve=-1,Ie=-1;for(let Oe=-1;Oe<=1;++Oe)for(let Le=-1;Le<=1;++Le){const Fe=(oe+Oe)*m+ye+Le;if(Jd[Fe]>=ne)continue;const je=Qw[Fe],Xe=Math.abs(je);Xe>Me&&(me=je,Me=Xe,ve=Le,Ie=Oe)}if(Me>.1){const Oe=1-(ne+.5*Math.abs(ve*Ie))/I;let Le=s._dem.get(ye,oe)+me*Oe;const Fe=s._dem.get(ye+ve,oe+Ie),je=s._dem.get(ye-ve,oe-Ie,!0);(Le-Fe)*(Le-je)>0&&(Le=(Fe+je)/2),Qw[pe]=s._dem.set(ye,oe,Le),Jd[pe]=ne}}}}}x&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ot.now())}setFilter(t){this.filter=t?ug(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new _n(this.id.overscaledZ),t.feature,this.id.canonical)):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const s of t)b0(s.node),Jw(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped()),h=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const m=h[d].node;h[d].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(t,s){const c=this.getNodesInfo(),h=[],d=[0,0,0],m=he.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const T=c[x],M=T.node.meshes[0],y=M.transformedAabb;if(t<y.min[0]||s<y.min[1]||t>y.max[0]||s>y.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};he.mat4.invert(m,T.node.matrix),d[0]=t,d[1]=s,he.vec3.transformMat4(d,d,m);const E=(d[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Yd|0,P=Math.min(63,(d[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Yd|0)*Yd+Math.min(63,E),A=M.heightmap[P];if(!(A<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:A,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new wt(t,s),new wt(t,s),h),h.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function t_(l,t){return!l.isLightConstant&&t}function EB(l,t,s,c,h,d,m,x){let T=(61440&t|(61440&t)>>4)>>8,M=(3840&t|(3840&t)>>4)>>4,y=240&t|(240&t)>>4;s[3]>0&&(T=or(T,255*s[0],s[3]),M=or(M,255*s[1],s[3]),y=or(y,255*s[2],s[3]));const E=T<<8|M,P=y<<8|Math.floor(255*c[3]),A=function(ne){const oe=Tr(ne,0,2);return Math.min(Math.round(.5*oe*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],I=Tr(h[0],0,1),k=Tr(h[1],0,1),j=Tr(h[2],0,1),F=Tr(h[3],0,1);let W,H,$,Y;if(I!==k&&m!==d&&k!==I){const ne=m-d;H=1/(ne*(k-I)),$=-(d+ne*I)/(ne*(k-I));const oe=Tr(h[4],-1,1);Y=Math.pow(10,oe),W=255*j<<8|255*F}else W=65535,H=0,$=1,Y=1;if(l.emplaceBack(E,P,A,W,H,$,Y),x){const ne=x.length;x.clear();for(let oe=0;oe<ne;oe++)x.emplaceBack(E,P,A,W,H,$,Y)}}function CB(l,t,s){const c=l.node;let h=0;const d=s&Wf.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new Df,m.featureArray.reserve(m.featureData.length);let x=t;for(const T of m.featureData){const M=d?65535&T:T>>16&65535,y=d?T>>16&65535:65535&T,E=(15&y)<8?15&y:0,P=l.evaluatedRMEA[E],A=l.evaluatedColor[E],I=l.emissionHeightBasedParams[E];let k;if(x&&E===2&&c.lights&&(k=new Df,k.resize(10*c.lights.length)),EB(m.featureArray,M,A,P,I,m.aabb.min[2],m.aabb.max[2],k),k&&x){x=!1;const j=c.meshes[c.lightMeshIndex];j.featureArray=k,j.featureArray._trim()}}m.featureArray._trim(),h++}}function NI(l,t,s,c){const h=1<<l.z;t.lat=Fi((c/Rt+l.y)/h),t.lng=Ls((s/Rt+l.x)/h)}Bt(w0,"Tiled3dModelBucket",{omit:["layers"]}),Bt(LI,"Tiled3dModelFeature");const AB={circle:class extends ki{constructor(l,t,s,c){super(l,{layout:Ge||(Ge=new Fn({"circle-sort-key":new Ft(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new It(Ye.layout_circle["circle-elevation-reference"]),visibility:new It(Ye.layout_circle.visibility)})),paint:ft||(ft=new Fn({"circle-radius":new Ft(Ye.paint_circle["circle-radius"]),"circle-color":new Ft(Ye.paint_circle["circle-color"]),"circle-blur":new Ft(Ye.paint_circle["circle-blur"]),"circle-opacity":new Ft(Ye.paint_circle["circle-opacity"]),"circle-translate":new It(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new It(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new It(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}createBucket(l){return new X(l)}queryRadius(l){const t=l;return We("circle-radius",this,t)+We("circle-stroke-width",this,t)+pt(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,s,c,h,d,m,x){const T=Ct(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return Ff(l,c,d,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,s){const c=iu(this);return{config:new Kl(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends ki{createBucket(l){return new sA(l)}constructor(l,t,s,c){super(l,{layout:oA||(oA=new Fn({visibility:new It(Ye.layout_heatmap.visibility)})),paint:aA||(aA=new Fn({"heatmap-radius":new Ft(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xc(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return We("heatmap-radius",this,l)}queryIntersectsFeature(l,t,s,c,h,d,m,x){const T=this.paint.get("heatmap-radius").evaluate(t,s);return Ff(l,c,d,m,x,!0,!0,new wt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,s){return l==="heatmap"?{config:new Kl(this,{zoom:t,lut:s}),overrideFog:!1}:{}}},hillshade:class extends ki{constructor(l,t,s,c){super(l,{layout:lA||(lA=new Fn({visibility:new It(Ye.layout_hillshade.visibility)})),paint:cA||(cA=new Fn({"hillshade-illumination-direction":new It(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new It(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new It(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}},fill:class extends ki{constructor(l,t,s,c){super(l,{layout:MA||(MA=new Fn({"fill-sort-key":new Ft(Ye.layout_fill["fill-sort-key"]),visibility:new It(Ye.layout_fill.visibility),"fill-elevation-reference":new It(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ft(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:IA||(IA=new Fn({"fill-antialias":new It(Ye.paint_fill["fill-antialias"]),"fill-opacity":new Ft(Ye.paint_fill["fill-opacity"]),"fill-color":new Ft(Ye.paint_fill["fill-color"]),"fill-outline-color":new Ft(Ye.paint_fill["fill-outline-color"]),"fill-translate":new It(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new It(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ft(Ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new It(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ft(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ft(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ft(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}getProgramIds(){const l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,t,s){return{config:new Kl(this,{zoom:t,lut:s}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new yw(l)}queryRadius(){return pt(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,s,c,h,d){return!l.queryGeometry.isAboveHorizon&&ae(gt(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?t&&!l:t}},"fill-extrusion":class extends ki{constructor(l,t,s,c){super(l,{layout:nM||(nM=new Fn({visibility:new It(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new It(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:iM||(iM=new Fn({"fill-extrusion-opacity":new It(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new It(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new It(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new It(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new It(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new It(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new It(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new It(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new It(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new It(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new It(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new It(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new It(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new It(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new It(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new It(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Qv(l)}queryRadius(){return pt(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,s,c,h,d,m,x,T){const M=Ct(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),y=this.paint.get("fill-extrusion-height").evaluate(t,s),E=this.paint.get("fill-extrusion-base").evaluate(t,s),P=[0,0],A=x&&d.elevation,I=d.elevation?d.elevation.exaggeration():1,k=l.tile.getBucket(this);if(A&&k instanceof Qv){const $=k.centroidVertexArray,Y=T+1;Y<$.length&&(P[0]=$.geta_centroid_pos0(Y),P[1]=$.geta_centroid_pos1(Y))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(c=rM([c],[new wt(0,0),new wt(Rt,Rt)],l.tileID.canonical).map($=>$.polygon).flat());const j=A?x:null,[F,W]=function($,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe){return $.projection.name==="globe"?function(Le,Fe,je,Xe,$e,Ke,xt,yt,Ut,Et,Pt){const St=[],rr=[],zt=Le.projection.upVectorScale(Pt,Le.center.lat,Le.worldSize).metersToTile,Wt=[0,0,0,1],cr=[0,0,0,1],Mr=(Dr,Ar,Nr,Xr)=>{Dr[0]=Ar,Dr[1]=Nr,Dr[2]=Xr,Dr[3]=1},fr=tM();je>0&&(je+=fr),Xe+=fr;for(const Dr of Fe){const Ar=[],Nr=[];for(const Xr of Dr){const yn=Xr.x+$e.x,ur=Xr.y+$e.y,$r=Le.projection.projectTilePoint(yn,ur,Pt),In=Le.projection.upVector(Pt,Xr.x,Xr.y);let Nn=je,Bn=Xe;if(xt){const Gn=oM(yn,ur,je,Xe,xt,yt,Ut,Et);Nn+=Gn.base,Bn+=Gn.top}je!==0?Mr(Wt,$r.x+In[0]*zt*Nn,$r.y+In[1]*zt*Nn,$r.z+In[2]*zt*Nn):Mr(Wt,$r.x,$r.y,$r.z),Mr(cr,$r.x+In[0]*zt*Bn,$r.y+In[1]*zt*Bn,$r.z+In[2]*zt*Bn),he.vec3.transformMat4(Wt,Wt,Ke),he.vec3.transformMat4(cr,cr,Ke),Ar.push(new Kd(Wt[0],Wt[1],Wt[2])),Nr.push(new Kd(cr[0],cr[1],cr[2]))}St.push(Ar),rr.push(Nr)}return[St,rr]}($,Y,ne,oe,ye,pe,me,Me,ve,Ie,Oe):me?function(Le,Fe,je,Xe,$e,Ke,xt,yt,Ut){const Et=[],Pt=[],St=[0,0,0,1];for(const rr of Le){const zt=[],Wt=[];for(const cr of rr){const Mr=cr.x+Xe.x,fr=cr.y+Xe.y,Dr=oM(Mr,fr,Fe,je,Ke,xt,yt,Ut);St[0]=Mr,St[1]=fr,St[2]=Dr.base,St[3]=1,he.vec4.transformMat4(St,St,$e),St[3]=Math.max(St[3],1e-5);const Ar=new Kd(St[0]/St[3],St[1]/St[3],St[2]/St[3]);St[0]=Mr,St[1]=fr,St[2]=Dr.top,St[3]=1,he.vec4.transformMat4(St,St,$e),St[3]=Math.max(St[3],1e-5);const Nr=new Kd(St[0]/St[3],St[1]/St[3],St[2]/St[3]);zt.push(Ar),Wt.push(Nr)}Et.push(zt),Pt.push(Wt)}return[Et,Pt]}(Y,ne,oe,ye,pe,me,Me,ve,Ie):function(Le,Fe,je,Xe,$e){const Ke=[],xt=[],yt=$e[8]*Fe,Ut=$e[9]*Fe,Et=$e[10]*Fe,Pt=$e[11]*Fe,St=$e[8]*je,rr=$e[9]*je,zt=$e[10]*je,Wt=$e[11]*je;for(const cr of Le){const Mr=[],fr=[];for(const Dr of cr){const Ar=Dr.x+Xe.x,Nr=Dr.y+Xe.y,Xr=$e[0]*Ar+$e[4]*Nr+$e[12],yn=$e[1]*Ar+$e[5]*Nr+$e[13],ur=$e[2]*Ar+$e[6]*Nr+$e[14],$r=$e[3]*Ar+$e[7]*Nr+$e[15],In=Xr+yt,Nn=yn+Ut,Bn=ur+Et,Gn=Math.max($r+Pt,1e-5),mn=Xr+St,xi=yn+rr,Es=ur+zt,ti=Math.max($r+Wt,1e-5);Mr.push(new Kd(In/Gn,Nn/Gn,Bn/Gn)),fr.push(new Kd(mn/ti,xi/ti,Es/ti))}Ke.push(Mr),xt.push(fr)}return[Ke,xt]}(Y,ne,oe,ye,pe)}(d,c,E,y,M,m,j,P,I,d.center.lat,l.tileID.canonical),H=l.queryGeometry;return function($,Y,ne){let oe=1/0;ae(ne,Y)&&(oe=sM(ne,Y[0]));for(let ye=0;ye<Y.length;ye++){const pe=Y[ye],me=$[ye];for(let Me=0;Me<pe.length-1;Me++){const ve=pe[Me],Ie=[ve,pe[Me+1],me[Me+1],me[Me],ve];se(ne,Ie)&&(oe=Math.min(oe,sM(ne,Ie)))}}return oe!==1/0&&oe}(F,W,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends ki{constructor(l,t,s,c){const h=gM();super(l,h,t,s,c),h.layout&&(this.layout=new Zc(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof ea,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if($g)return $g;const s=gM();return $g=new M5(s.paint.properties["line-width"].specification),$g.useIntegerZoom=!0,$g})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Ew(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,s){const c=pM(this);return{config:new Kl(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}queryRadius(l){const t=l,s=_M(We("line-width",this,t),We("line-gap-width",this,t)),c=We("line-offset",this,t);return s/2+Math.abs(c)+pt(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,s,c,h,d){if(l.queryGeometry.isAboveHorizon)return!1;const m=gt(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*_M(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),T=this.paint.get("line-offset").evaluate(t,s);return T&&(c=function(M,y){const E=[],P=new wt(0,0);for(let A=0;A<M.length;A++){const I=M[A],k=[];for(let j=0;j<I.length;j++){const F=I[j],W=I[j+1],H=j===0?P:F.sub(I[j-1])._unit()._perp(),$=j===I.length-1?P:W.sub(F)._unit()._perp(),Y=H._add($)._unit();Y._mult(1/(Y.x*$.x+Y.y*$.y)),k.push(Y._mult(y)._add(F))}E.push(k)}return E}(c,T*l.pixelToTileUnitsFactor)),function(M,y,E){for(let P=0;P<y.length;P++){const A=y[P];if(M.length>=3){for(let I=0;I<A.length;I++)if(Te(M,A[I]))return!0}if(ce(M,A,E))return!0}return!1}(m,c,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets}},symbol:p0,background:class extends ki{constructor(l,t,s,c){super(l,{layout:oI||(oI=new Fn({visibility:new It(Ye.layout_background.visibility)})),paint:aI||(aI=new Fn({"background-pitch-alignment":new It(Ye.paint_background["background-pitch-alignment"]),"background-color":new It(Ye.paint_background["background-color"]),"background-pattern":new It(Ye.paint_background["background-pattern"]),"background-opacity":new It(Ye.paint_background["background-opacity"]),"background-emissive-strength":new It(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:hI,"raster-particle":yI,sky:class extends ki{constructor(l,t,s,c){super(l,{layout:mI||(mI=new Fn({visibility:new It(Ye.layout_sky.visibility)})),paint:gI||(gI=new Fn({"sky-type":new It(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new It(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new It(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new It(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new It(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xc(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new It(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new It(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new It(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,d=l.style.light,m=d.properties.get("position");return h&&d.properties.get("anchor")==="viewport"&&Cn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Ww(m.azimuthal,90-m.polar,t):Ww(c[0],90-c[1],t)}const s=this.paint.get("sky-gradient-center");return Ww(s[0],90-s[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends ki{constructor(l,t,s,c){super(l,{paint:_I||(_I=new Fn({}))},t,null)}},model:class extends ki{constructor(l,t,s,c){super(l,{layout:MI||(MI=new Fn({visibility:new It(Ye.layout_model.visibility),"model-id":new Ft(Ye.layout_model["model-id"])})),paint:II||(II=new Fn({"model-opacity":new Ft(Ye.paint_model["model-opacity"]),"model-rotation":new Ft(Ye.paint_model["model-rotation"]),"model-scale":new Ft(Ye.paint_model["model-scale"]),"model-translation":new Ft(Ye.paint_model["model-translation"]),"model-color":new Ft(Ye.paint_model["model-color"]),"model-color-mix-intensity":new Ft(Ye.paint_model["model-color-mix-intensity"]),"model-type":new It(Ye.paint_model["model-type"]),"model-cast-shadows":new It(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new It(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new It(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ft(Ye.paint_model["model-emissive-strength"]),"model-roughness":new Ft(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ft(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new It(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new It(Ye.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ft({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Kw(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof w0?Rt-1:0}queryIntersectsFeature(l,t,s,c,h,d){if(!this.modelManager)return!1;const m=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof Kw))return!1;for(const T in x.instancesPerModel){const M=x.instancesPerModel[T],y=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(y)){const E=M.features[M.idToFeaturesIndex[y]],P=m.getModel(T,this.scope);if(!P)return!1;let A=he.mat4.create();const I=new Qr(0,0),k=x.canonical;let j=Number.MAX_VALUE;for(let F=0;F<E.instancedDataCount;++F){const W=16*(E.instancedDataOffset+F),H=M.instancedDataArray.float32,$=[H[W+4],H[W+5],H[W+6]];NI(k,I,H[W],0|H[W+1]),PI(A,P,d,I,E.rotation,E.scale,$,!1,!1,!1),d.projection.name==="globe"&&(A=Xw(A,d));const Y=he.mat4.multiply([],d.projMatrix,A),ne=l.queryGeometry,oe=SI(ne.isPointQuery()?ne.screenBounds:ne.screenGeometry,d,Y,P.aabb);oe!=null&&(j=Math.min(oe,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(l,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Vc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ki{constructor(l,t,s,c){super(l,{layout:PA||(PA=new Fn({"clip-layer-types":new It(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new It(Ye.layout_clip["clip-layer-scope"])})),paint:RA||(RA=new Fn({}))},t,s,c)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new kA(l)}is3D(l){return!0}}};class MB{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class IB{constructor(){this.tasks={},this.taskQueue=[],ao(["process"],this),this.invoker=new MB(this.process),this.nextId=0}add(t,s){const c=this.nextId++,h=function({type:d,isSymbolTile:m,zoom:x}){return x=x||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-x:d==="maybePrepare"&&m?400-x:500:200-x:100-x}(s);if(h===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:s,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const d=this.tasks[this.taskQueue[h]];d.priority<s&&(s=d.priority,t=h)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class OI{constructor(t,s,c){this.target=t,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},ao(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new IB}send(t,s,c,h,d=!1,m){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);const T=new Set;return this.target.postMessage({id:x,type:t,hasCallback:!!c,targetMapId:h,mustQueue:d,sourceMapId:this.mapId,data:dl(s,T)},T),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){const s=t.data;if(!s)return;const c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(s.mustQueue||jn()){const h=this.callbacks[c],d=this.scheduler.add(()=>this.processTask(c,s),h&&h.metadata||{type:"message"});d&&(this.cancelCallbacks[c]=d)}else this.processTask(c,s)}processTask(t,s){if(delete this.cancelCallbacks[t],s.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(s.error?c(Zs(s.error)):c(null,Zs(s.data)))}else{const c=new Set,h=s.hasCallback?(m,x)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:m?dl(m):null,data:dl(x,c)},c)}:()=>{},d=Zs(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,d,h);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],d.source,d.scope)[m[1]](d,h)}else h(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var r_={workerUrl:"",workerClass:null,workerParams:void 0};const e2="mapboxgl_preloaded_worker_pool";class Qd{constructor(){this.active={}}acquire(t,s=Qd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(r_.workerClass!=null?new r_.workerClass:new self.Worker(r_.workerUrl,r_.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[e2]}numActive(){return Object.keys(this.active).length}}Qd.workerCount=2;class Xf{constructor(t,s,c="Worker",h=Qd.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=ui();const d=this.workerPool.acquire(this.id,h);for(let m=0;m<d.length;m++){const x=new Xf.Actor(d[m],s,this.id);x.name=`${c} ${m}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,c){Yi(this.actors,(h,d)=>{h.send(t,s,d)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let n_,t2;function S0(){return n_||(n_=new Qd),n_}Xf.Actor=OI;const r2=new an(0,0,0);var n2=(l=>(l[l.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",l[l.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",l[l.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",l))(n2||{}),T0=(l=>(l[l.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",l[l.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",l[l.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",l[l.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",l))(T0||{}),i_=(l=>(l[l.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",l[l.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",l[l.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",l[l.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",l[l.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",l))(i_||{}),zI=(l=>(l[l.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",l[l.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",l[l.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",l))(zI||{}),Kf=(l=>(l[l.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",l[l.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",l[l.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",l[l.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",l[l.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",l[l.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",l))(Kf||{}),jI=(l=>(l[l.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",l[l.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",l[l.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",l))(jI||{});function PB(l,t,s){l===1&&t.icons.push(function(c,h){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:m}=d;if(m.content_area){const{content_area:x}=m;x.top==null&&(x.top=x.left),x.width==null&&(x.width=d.usvg_tree.width),x.height==null&&(x.height=x.width)}return m.stretch_x&&m.stretch_x.length&&FI(m,"x"),m.stretch_y&&m.stretch_y.length&&FI(m,"y"),d}(c.readFields(RB,{name:void 0},h))}(s,s.readVarint()+s.pos))}function FI(l,t){const s=[],c=l[`stretch_${t}`];let h=null;for(let d=0;d<c.length;d++)h===null?h=s.length===0?c[0]:s[s.length-1][1]+c[d]:(s.push([h,h+c[d]]),h=null);l[`stretch_${t}_areas`]=s}function RB(l,t,s){l===1?t.name=s.readString():l===2?t.metadata=function(c,h){return c.readFields(kB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(s,s.readVarint()+s.pos):l===3&&(t.usvg_tree=function(c,h){return c.readFields(NB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(s,s.readVarint()+s.pos),t.data="usvg_tree")}function kB(l,t,s){l===1?t.stretch_x=s.readPackedVarint():l===2?t.stretch_y=s.readPackedVarint():l===3?t.content_area=function(c,h){return c.readFields(DB,{left:0},h)}(s,s.readVarint()+s.pos):l===4&&t.variables.push(function(c,h){return c.readFields(LB,{name:void 0},h)}(s,s.readVarint()+s.pos))}function DB(l,t,s){l===1?t.left=s.readVarint():l===2?t.width=s.readVarint():l===3?t.top=s.readVarint():l===4&&(t.height=s.readVarint())}function LB(l,t,s){l===1?t.name=s.readString():l===2&&(t.rgb_color=A0(s.readVarint()),t.value="rgb_color")}function NB(l,t,s){l===1?t.width=t.height=s.readVarint():l===2?t.height=s.readVarint():l===3?t.children.push(E0(s,s.readVarint()+s.pos)):l===4?t.linear_gradients.push(function(c,h){return c.readFields(VB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(s,s.readVarint()+s.pos)):l===5?t.radial_gradients.push(function(c,h){return c.readFields(GB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(s,s.readVarint()+s.pos)):l===7?t.clip_paths.push(function(c,h){return c.readFields(qB,{children:[]},h)}(s,s.readVarint()+s.pos)):l===8&&t.masks.push(function(c,h){const d=c.readFields(HB,{left:0,width:20,mask_type:1,children:[]},h);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(s,s.readVarint()+s.pos))}function E0(l,t){return l.readFields(OB,{},t)}function OB(l,t,s){l===1?(t.group=function(c,h){return c.readFields(zB,{opacity:255,children:[]},h)}(s,s.readVarint()+s.pos),t.node="group"):l===2&&(t.path=function(c,h){return c.readFields(FB,{paint_order:1,commands:[],step:1,diffs:[],rule:1},h)}(s,s.readVarint()+s.pos),t.node="path")}function zB(l,t,s){l===1?t.transform=C0(s,s.readVarint()+s.pos):l===2?t.opacity=s.readVarint():l===5?t.clip_path_idx=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(E0(s,s.readVarint()+s.pos))}function C0(l,t){return l.readFields(jB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function jB(l,t,s){l===1?t.sx=s.readFloat():l===2?t.ky=s.readFloat():l===3?t.kx=s.readFloat():l===4?t.sy=s.readFloat():l===5?t.tx=s.readFloat():l===6&&(t.ty=s.readFloat())}function FB(l,t,s){l===1?t.fill=function(c,h){return c.readFields(BB,{rgb_color:r2,paint:"rgb_color",opacity:255},h)}(s,s.readVarint()+s.pos):l===2?t.stroke=function(c,h){return c.readFields(UB,{rgb_color:r2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(s,s.readVarint()+s.pos):l===3?t.paint_order=s.readVarint():l===5?s.readPackedVarint(t.commands):l===6?t.step=s.readFloat():l===7?s.readPackedSVarint(t.diffs):l===8&&(t.rule=s.readVarint())}function BB(l,t,s){l===1?(t.rgb_color=A0(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5&&(t.opacity=s.readVarint())}function A0(l){return new an((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function UB(l,t,s){l===1?(t.rgb_color=A0(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5?s.readPackedFloat(t.dasharray):l===6?t.dashoffset=s.readFloat():l===7?t.miterlimit=s.readFloat():l===8?t.opacity=s.readVarint():l===9?t.width=s.readFloat():l===10?t.linecap=s.readVarint():l===11&&(t.linejoin=s.readVarint())}function VB(l,t,s){l===1?t.transform=C0(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(BI(s,s.readVarint()+s.pos)):l===4?t.x1=s.readFloat():l===5?t.y1=s.readFloat():l===6?t.x2=s.readFloat():l===7&&(t.y2=s.readFloat())}function BI(l,t){return l.readFields($B,{offset:0,opacity:255,rgb_color:r2},t)}function $B(l,t,s){l===1?t.offset=s.readFloat():l===2?t.opacity=s.readVarint():l===3&&(t.rgb_color=A0(s.readVarint()))}function GB(l,t,s){l===1?t.transform=C0(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(BI(s,s.readVarint()+s.pos)):l===4?t.cx=s.readFloat():l===5?t.cy=s.readFloat():l===6?t.r=s.readFloat():l===7?t.fx=s.readFloat():l===8?t.fy=s.readFloat():l===9&&(t.fr=s.readFloat())}function qB(l,t,s){l===1?t.transform=C0(s,s.readVarint()+s.pos):l===2?t.clip_path_idx=s.readVarint():l===3&&t.children.push(E0(s,s.readVarint()+s.pos))}function HB(l,t,s){l===1?t.left=t.top=s.readFloat():l===2?t.width=t.height=s.readFloat():l===3?t.top=s.readFloat():l===4?t.height=s.readFloat():l===5?t.mask_type=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(E0(s,s.readVarint()+s.pos))}class WB{static calculate(t={},s=[]){const c=new Map,h=new Map;if(Object.keys(t).length===0)return c;s.forEach(d=>{h.set(d.name,d.rgb_color||new an(0,0,0))});for(const[d,m]of Object.entries(t))h.has(d)?c.set(h.get(d).toStringPremultipliedAlpha(),m):console.warn(`Ignoring unknown image variable "${d}"`);return c}}function Yf(l,t=255,s){const c=t/255,h=l.toStringPremultipliedAlpha(),d=s.has(h)?s.get(h).clone():l.clone();return d.a*=c,d.toString()}function s_(l,t){if(!ut()){const s=document.createElement("canvas");return s.width=l,s.height=t,s}return new OffscreenCanvas(l,t)}function ZB(l,t){const s=WB.calculate(t.params,l.metadata?l.metadata.variables:[]),c=l.usvg_tree,h=c.width,d=c.height,m=t.transform?t.transform:new DOMMatrix,x=Math.max(1,Math.round(h*m.a)),T=Math.max(1,Math.round(d*m.d)),M=new DOMMatrix([x/h,0,0,T/d,0,0]),y=s_(x,T).getContext("2d");return i2(y,M,c,c,s),y.getImageData(0,0,x,T)}function i2(l,t,s,c,h){for(const d of c.children)UI(l,t,s,d,h)}function UI(l,t,s,c,h){c.group?(l.save(),function(d,m,x,T,M){const y=T.mask_idx!=null?x.masks[T.mask_idx]:null,E=T.clip_path_idx!=null?x.clip_paths[T.clip_path_idx]:null;if(T.transform&&(m=M0(T.transform).preMultiplySelf(m)),!function(I,k,j){return I.opacity!==255||k||j}(T,E!=null,y!=null))return void i2(d,m,x,T,M);const P=s_(d.canvas.width,d.canvas.height),A=P.getContext("2d");i2(A,m,x,T,M),E&&ZI(A,m,x,E),y&&XI(A,m,x,y,M),d.globalAlpha=T.opacity/255,d.drawImage(P,0,0)}(l,t,s,c.group,h),l.restore()):c.path&&(l.save(),function(d,m,x,T,M){const y=KI(T);d.setTransform(m),T.paint_order===zI.PAINT_ORDER_FILL_AND_STROKE?(VI(d,x,T,y,M),GI(d,x,T,y,M)):(GI(d,x,T,y,M),VI(d,x,T,y,M))}(l,t,s,c.path,h),l.restore())}function VI(l,t,s,c,h){const d=s.fill;if(!d)return;const m=d.opacity/255;switch(d.paint){case"rgb_color":l.fillStyle=Yf(d.rgb_color,d.opacity,h);break;case"linear_gradient_idx":l.fillStyle=qI(l,t.linear_gradients[d.linear_gradient_idx],m,h);break;case"radial_gradient_idx":l.fillStyle=HI(l,t.radial_gradients[d.radial_gradient_idx],m,h)}l.fill(c,$I(s))}function $I(l){return l.rule===n2.PATH_RULE_NON_ZERO?"nonzero":l.rule===n2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function GI(l,t,s,c,h){const d=s.stroke;if(!d)return;l.lineWidth=d.width,l.miterLimit=d.miterlimit,l.setLineDash(d.dasharray),l.lineDashOffset=d.dashoffset;const m=d.opacity/255;switch(d.paint){case"rgb_color":l.strokeStyle=Yf(d.rgb_color,d.opacity,h);break;case"linear_gradient_idx":l.strokeStyle=qI(l,t.linear_gradients[d.linear_gradient_idx],m,h);break;case"radial_gradient_idx":l.strokeStyle=HI(l,t.radial_gradients[d.radial_gradient_idx],m,h)}switch(d.linejoin){case i_.LINE_JOIN_MITER_CLIP:case i_.LINE_JOIN_MITER:l.lineJoin="miter";break;case i_.LINE_JOIN_ROUND:l.lineJoin="round";break;case i_.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(d.linecap){case T0.LINE_CAP_BUTT:l.lineCap="butt";break;case T0.LINE_CAP_ROUND:l.lineCap="round";break;case T0.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(c)}function qI(l,t,s,c){if(t.stops.length===1){const P=t.stops[0];return Yf(P.rgb_color,P.opacity*s,c)}const h=M0(t.transform),{x1:d,y1:m,x2:x,y2:T}=t,M=h.transformPoint(new DOMPoint(d,m)),y=h.transformPoint(new DOMPoint(x,T)),E=l.createLinearGradient(M.x,M.y,y.x,y.y);for(const P of t.stops)E.addColorStop(P.offset,Yf(P.rgb_color,P.opacity*s,c));return E}function HI(l,t,s,c){if(t.stops.length===1){const P=t.stops[0];return Yf(P.rgb_color,P.opacity*s,c)}const h=M0(t.transform),{fx:d,fy:m,cx:x,cy:T}=t,M=h.transformPoint(new DOMPoint(d,m)),y=h.transformPoint(new DOMPoint(x,T)),E=l.createRadialGradient(M.x,M.y,0,y.x,y.y,t.r*((h.a+h.d)/2));for(const P of t.stops)E.addColorStop(P.offset,Yf(P.rgb_color,P.opacity*s,c));return E}function WI(l,t,s,c){const h=c.transform?M0(c.transform).preMultiplySelf(t):t,d=s_(l.canvas.width,l.canvas.height),m=d.getContext("2d");for(const T of c.children)if(T.group)WI(m,h,s,T.group);else if(T.path){const M=T.path,y=new Path2D;y.addPath(KI(M),h),m.fill(y,$I(M))}const x=c.clip_path_idx!=null?s.clip_paths[c.clip_path_idx]:null;x&&ZI(m,h,s,x),l.globalCompositeOperation="source-over",l.drawImage(d,0,0)}function ZI(l,t,s,c){const h=s_(l.canvas.width,l.canvas.height);WI(h.getContext("2d"),t,s,c),l.globalCompositeOperation="destination-in",l.drawImage(h,0,0)}function XI(l,t,s,c,h){if(c.children.length===0)return;const d=c.mask_idx!=null?s.masks[c.mask_idx]:null;d&&XI(l,t,s,d,h);const m=l.canvas.width,x=l.canvas.height,T=s_(m,x),M=T.getContext("2d"),y=c.width,E=c.height,P=c.left,A=c.top,I=new Path2D,k=new Path2D;k.rect(P,A,y,E),I.addPath(k,t),M.clip(I);for(const W of c.children)UI(M,t,s,W,h);const j=M.getImageData(0,0,m,x),F=j.data;if(c.mask_type===jI.MASK_TYPE_LUMINANCE)for(let W=0;W<F.length;W+=4)F[W+3]=F[W+3]/255*(.2126*F[W]+.7152*F[W+1]+.0722*F[W+2]);M.putImageData(j,0,0),l.globalCompositeOperation="destination-in",l.drawImage(T,0,0)}function M0(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function KI(l){const t=new Path2D,s=l.step;let c=l.diffs[0]*s,h=l.diffs[1]*s;t.moveTo(c,h);for(let d=0,m=2;d<l.commands.length;d++)switch(l.commands[d]){case Kf.PATH_COMMAND_MOVE:c+=l.diffs[m++]*s,h+=l.diffs[m++]*s,t.moveTo(c,h);break;case Kf.PATH_COMMAND_LINE:c+=l.diffs[m++]*s,h+=l.diffs[m++]*s,t.lineTo(c,h);break;case Kf.PATH_COMMAND_QUAD:{const x=c+l.diffs[m++]*s,T=h+l.diffs[m++]*s;c=x+l.diffs[m++]*s,h=T+l.diffs[m++]*s,t.quadraticCurveTo(x,T,c,h);break}case Kf.PATH_COMMAND_CUBIC:{const x=c+l.diffs[m++]*s,T=h+l.diffs[m++]*s,M=x+l.diffs[m++]*s,y=T+l.diffs[m++]*s;c=M+l.diffs[m++]*s,h=y+l.diffs[m++]*s,t.bezierCurveTo(x,T,M,y,c,h);break}case Kf.PATH_COMMAND_CLOSE:t.closePath()}return t}class I0{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const s=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,s),s}put(t,s){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,s)}delete(t){this.cache.delete(t)}}Bt(I0,"LRUCache");class s2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Hi(t,t.data)}getFromCache(t,s,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new I0(150)),this.cacheMap.get(c).get(Yc(t.toString(),s))}setInCache(t,s,c,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new I0(150));const d=this.cacheDependenciesMap.get(h),m=Yc(t.id.toString(),c);d.get(m)||d.set(m,new Set);const x=this.cacheMap.get(h),T=t.toString();d.get(m).add(T),x.put(Yc(t.toString(),c),s)}removeImagesFromCacheByIds(t,s,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const h=this.cacheMap.get(c),d=this.cacheDependenciesMap.get(c);for(const m of t){const x=Yc(m.toString(),s);if(d.has(x)){for(const T of d.get(x))h.delete(T);d.delete(x)}}}rasterize(t,s,c,h,d=ZB){const m=this.getFromCache(t,c,h);if(m)return m.clone();const x=d(s.icon,t.options),T=s2._getImage(x);return this.setInCache(t,T,c,h),T.clone()}}class YI{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const c=this.toIdx(t,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function JI(l,t,s,c){let h=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(s[m]<l[m]||s[m]>t[m])return null}else{const x=1/c[m];let T=(l[m]-s[m])*x,M=(t[m]-s[m])*x;if(T>M){const y=T;T=M,M=y}if(T>h&&(h=T),M<d&&(d=M),h>d)return null}return h}function QI(l,t,s,c,h,d,m,x,T,M,y){const E=c-l,P=h-t,A=d-s,I=m-l,k=x-t,j=T-s,F=y[1]*j-y[2]*k,W=y[2]*I-y[0]*j,H=y[0]*k-y[1]*I,$=E*F+P*W+A*H;if(Math.abs($)<1e-15)return null;const Y=1/$,ne=M[0]-l,oe=M[1]-t,ye=M[2]-s,pe=(ne*F+oe*W+ye*H)*Y;if(pe<0||pe>1)return null;const me=oe*A-ye*P,Me=ye*E-ne*A,ve=ne*P-oe*E,Ie=(y[0]*me+y[1]*Me+y[2]*ve)*Y;return Ie<0||pe+Ie>1?null:(I*me+k*Me+j*ve)*Y}function eP(l,t,s){return(l-t)/(s-t)}function tP(l,t,s,c,h,d,m,x,T){const M=1<<s,y=d-c,E=m-h,P=(l+1)/M*y+c,A=(t+0)/M*E+h,I=(t+1)/M*E+h;x[0]=(l+0)/M*y+c,x[1]=A,T[0]=P,T[1]=I}class rP{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(d){const m=Math.ceil(Math.log2(d.dim/8)),x=[];let T=Math.ceil(Math.pow(2,m));const M=1/T,y=(A,I,k,j,F)=>{const W=j?1:0,H=(A+1)*k-W,$=I*k,Y=(I+1)*k-W;F[0]=A*k,F[1]=$,F[2]=H,F[3]=Y};let E=new YI(T);const P=[];for(let A=0;A<T*T;A++){y(A%T,Math.floor(A/T),M,!1,P);const I=hu(P[0],P[1],d),k=hu(P[2],P[1],d),j=hu(P[2],P[3],d),F=hu(P[0],P[3],d);E.minimums.push(Math.min(I,k,j,F)),E.maximums.push(Math.max(I,k,j,F)),E.leaves.push(1)}for(x.push(E),T/=2;T>=1;T/=2){const A=x[x.length-1];E=new YI(T);for(let I=0;I<T*T;I++){y(I%T,Math.floor(I/T),2,!0,P);const k=A.getElevation(P[0],P[1]),j=A.getElevation(P[2],P[1]),F=A.getElevation(P[2],P[3]),W=A.getElevation(P[0],P[3]),H=A.isLeaf(P[0],P[1]),$=A.isLeaf(P[2],P[1]),Y=A.isLeaf(P[2],P[3]),ne=A.isLeaf(P[0],P[3]),oe=Math.min(k.min,j.min,F.min,W.min),ye=Math.max(k.max,j.max,F.max,W.max),pe=H&&$&&Y&&ne;E.maximums.push(ye),E.minimums.push(oe),E.leaves.push(ye-oe<=5&&pe?1:0)}x.push(E)}return x}(this.dem),c=s.length-1,h=s[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(t,s,c,h,d,m,x=1){return JI([t,s,-100],[c,h,this.maximums[0]*x],d,m)}raycast(t,s,c,h,d,m,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(t,s,c,h,d,m,x);if(T==null)return null;const M=[],y=[],E=[],P=[],A=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:I,t:k,nodex:j,nodey:F,depth:W}=A.pop();if(this.leaves[I]){tP(j,F,W,t,s,c,h,E,P);const $=1<<W,Y=(j+0)/$,ne=(j+1)/$,oe=(F+0)/$,ye=(F+1)/$,pe=hu(Y,oe,this.dem)*x,me=hu(ne,oe,this.dem)*x,Me=hu(ne,ye,this.dem)*x,ve=hu(Y,ye,this.dem)*x,Ie=QI(E[0],E[1],pe,P[0],E[1],me,P[0],P[1],Me,d,m),Oe=QI(P[0],P[1],Me,E[0],P[1],ve,E[0],E[1],pe,d,m),Le=Math.min(Ie!==null?Ie:Number.MAX_VALUE,Oe!==null?Oe:Number.MAX_VALUE);if(Le!==Number.MAX_VALUE)return Le;{const Fe=he.vec3.scaleAndAdd([],d,m,k);if(nP(pe,me,ve,Me,eP(Fe[0],E[0],P[0]),eP(Fe[1],E[1],P[1]))>=Fe[2])return k}continue}let H=0;for(let $=0;$<this._siblingOffset.length;$++){tP((j<<1)+this._siblingOffset[$][0],(F<<1)+this._siblingOffset[$][1],W+1,t,s,c,h,E,P),E[2]=-100,P[2]=this.maximums[this.childOffsets[I]+$]*x;const Y=JI(E,P,d,m);if(Y!=null){const ne=Y;M[$]=ne;let oe=!1;for(let ye=0;ye<H&&!oe;ye++)ne>=M[y[ye]]&&(y.splice(ye,0,$),oe=!0);oe||(y[H]=$),H++}}for(let $=0;$<H;$++){const Y=y[$];A.push({idx:this.childOffsets[I]+Y,t:M[Y],nodex:(j<<1)+this._siblingOffset[Y][0],nodey:(F<<1)+this._siblingOffset[Y][1],depth:W+1})}}return null}_addNode(t,s,c){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,c,h,d){if(t[h].isLeaf(s,c)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=h-1,x=t[m];let T=0,M=0;for(let y=0;y<this._siblingOffset.length;y++){const E=2*s+this._siblingOffset[y][0],P=2*c+this._siblingOffset[y][1],A=x.getElevation(E,P),I=x.isLeaf(E,P),k=this._addNode(A.min,A.max,I);I&&(T|=1<<y),M||(M=k)}for(let y=0;y<this._siblingOffset.length;y++)T&1<<y||this._construct(t,2*s+this._siblingOffset[y][0],2*c+this._siblingOffset[y][1],m,M+y)}}function nP(l,t,s,c,h,d){return or(or(l,s,d),or(t,c,d),h)}function hu(l,t,s){const c=s.dim,h=Tr(l*c-.5,0,c-1),d=Tr(t*c-.5,0,c-1),m=Math.floor(h),x=Math.floor(d),T=Math.min(m+1,c-1),M=Math.min(x+1,c-1);return nP(s.get(m,x),s.get(T,x),s.get(m,M),s.get(T,M),h-m,d-x)}const XB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function KB(l,t,s){return(256*l*256+256*t+s)/10-1e4}function YB(l,t,s){return 256*l+t+s/256-32768}class P0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,c,h=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Cn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const d=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<d;T++)m[this._idx(-1,T)]=m[this._idx(0,T)],m[this._idx(d,T)]=m[this._idx(d-1,T)],m[this._idx(T,-1)]=m[this._idx(T,0)],m[this._idx(T,d)]=m[this._idx(T,d-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(d,-1)]=m[this._idx(d-1,0)],m[this._idx(-1,d)]=m[this._idx(0,d-1)],m[this._idx(d,d)]=m[this._idx(d-1,d-1)]}const x=c==="terrarium"?YB:KB;for(let T=0;T<m.length;++T){const M=4*T;this.floatView[T]=x(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=ot.now()}_buildQuadTree(){this._tree=new rP(this)}get(t,s,c=!1){c&&(t=Tr(t,-1,this.dim),s=Tr(s,-1,this.dim));const h=this._idx(t,s);return this.floatView[h]}set(t,s,c){const h=this._idx(t,s),d=this.floatView[h];return this.floatView[h]=c,c-d}static getUnpackVector(t){return XB[t]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}static pack(t,s){const c=[0,0,0,0],h=P0.getUnpackVector(s);let d=Math.floor((t+h[3])/h[2]);return c[2]=d%256,d=Math.floor(d/256),c[1]=d%256,d=Math.floor(d/256),c[0]=d,c}getPixels(){return new hA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,d=s*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:h=d-1;break;case 1:d=h+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}const T=-s*this.dim,M=-c*this.dim;for(let y=m;y<x;y++)for(let E=h;E<d;E++){const P=4*this._idx(E,y),A=4*this._idx(E+T,y+M);this.pixels[P+0]=t.pixels[A+0],this.pixels[P+1]=t.pixels[A+1],this.pixels[P+2]=t.pixels[A+2],this.pixels[P+3]=t.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function JB(l,t,s){l===1?t.headerLength=s.readFixed32():l===2?t.x=s.readVarint():l===3?t.y=s.readVarint():l===4?t.z=s.readVarint():l===5&&t.layers.push(function(c,h){return c.readFields(n6,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(s,s.readVarint()+s.pos))}function QB(l,t,s){l===1?(t.delta_filter=function(c,h){return c.readFields(e6,{blockSize:0},h)}(s,s.readVarint()+s.pos),t.filter="delta_filter"):l===2?(s.readVarint(),t.filter="zigzag_filter"):l===3?(s.readVarint(),t.filter="bitshuffle_filter"):l===4&&(s.readVarint(),t.filter="byteshuffle_filter")}function e6(l,t,s){l===1&&(t.blockSize=s.readVarint())}function t6(l,t,s){l===1?(s.readVarint(),t.codec="gzip_data"):l===2?(s.readVarint(),t.codec="jpeg_image"):l===3?(s.readVarint(),t.codec="webp_image"):l===4&&(s.readVarint(),t.codec="png_image")}function r6(l,t,s){let c=0,h=0;l===1?t.firstByte=s.readFixed64():l===2?t.lastByte=s.readFixed64():l===3?t.filters.push(function(d,m){return d.readFields(QB,{},m)}(s,s.readVarint()+s.pos)):l===4?t.codec=function(d,m){return d.readFields(t6,{},m)}(s,s.readVarint()+s.pos):l===5?h=s.readFloat():l===6?c=s.readFloat():l===7?t.bands.push(s.readString()):l===8?t.offset=s.readDouble():l===9&&(t.scale=s.readDouble()),t.offset===0&&(t.offset=h),t.scale===0&&(t.scale=c)}function n6(l,t,s){l===1?t.version=s.readVarint():l===2?t.name=s.readString():l===3?t.units=s.readString():l===4?t.tileSize=s.readVarint():l===5?t.buffer=s.readVarint():l===6?t.pixelFormat=s.readVarint():l===7&&t.dataIndex.push(function(c,h){return c.readFields(r6,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(s,s.readVarint()+s.pos))}function i6(l,t,s){if(l===2)(function(c,h,d){c.readFields(s6,d,h)})(s,s.readVarint()+s.pos,t);else if(l===3)throw new Error("Not implemented")}function s6(l,t,s){if(l===1){let c=0;const h=s.readVarint()+s.pos;for(;s.pos<h;)t[c++]=s.readVarint()}}function o6(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let s=t[3];for(let c=2;c>=1;c--){const h=c===1?1:0,d=c===2?1:0;for(let m=0;m<t[0];m++){const x=t[1]*m;for(let T=h;T<t[1];T++){const M=t[2]*(T+x);for(let y=d;y<t[2];y++){const E=t[3]*(y+M);for(let P=0;P<t[3];P++){const A=E+P;l[A]+=l[A-s]}}}}s*=t[c]}return l}function a6(l){for(let t=0,s=l.length;t<s;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function l6(l,t){switch(t){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){const c=l[s],h=l[s+1];l[s]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,l[s+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){const c=l[s],h=l[s+1],d=l[s+2],m=l[s+3];l[s+0]=(192&c)>>6|(192&h)>>4|(192&d)>>2|192&m,l[s+1]=(48&c)>>4|(48&h)>>2|48&d|(48&m)<<2,l[s+2]=(12&c)>>2|12&h|(12&d)<<2|(12&m)<<4,l[s+3]=3&c|(3&h)<<2|(3&d)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}Bt(P0,"DEMData"),Bt(rP,"DemMinMaxQuadTree",{omit:["dem"]});var Oo=Uint8Array,o_=Uint16Array,c6=Int32Array,iP=new Oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sP=new Oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u6=new Oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oP=function(l,t){for(var s=new o_(31),c=0;c<31;++c)s[c]=t+=1<<l[c-1];var h=new c6(s[30]);for(c=1;c<30;++c)for(var d=s[c];d<s[c+1];++d)h[d]=d-s[c]<<5|c;return{b:s,r:h}},aP=oP(iP,2),lP=aP.b,d6=aP.r;lP[28]=258,d6[258]=28;for(var h6=oP(sP,0).b,cP=new o_(32768),si=0;si<32768;++si){var Jf=(43690&si)>>1|(21845&si)<<1;cP[si]=((65280&(Jf=(61680&(Jf=(52428&Jf)>>2|(13107&Jf)<<2))>>4|(3855&Jf)<<4))>>8|(255&Jf)<<8)>>1}var a_=function(l,t,s){for(var c=l.length,h=0,d=new o_(t);h<c;++h)l[h]&&++d[l[h]-1];var m,x=new o_(t);for(h=1;h<t;++h)x[h]=x[h-1]+d[h-1]<<1;m=new o_(1<<t);var T=15-t;for(h=0;h<c;++h)if(l[h])for(var M=h<<4|l[h],y=t-l[h],E=x[l[h]-1]++<<y,P=E|(1<<y)-1;E<=P;++E)m[cP[E]>>T]=M;return m},l_=new Oo(288);for(si=0;si<144;++si)l_[si]=8;for(si=144;si<256;++si)l_[si]=9;for(si=256;si<280;++si)l_[si]=7;for(si=280;si<288;++si)l_[si]=8;var uP=new Oo(32);for(si=0;si<32;++si)uP[si]=5;var f6=a_(l_,9),p6=a_(uP,5),o2=function(l){for(var t=l[0],s=1;s<l.length;++s)l[s]>t&&(t=l[s]);return t},Oa=function(l,t,s){var c=t/8|0;return(l[c]|l[c+1]<<8)>>(7&t)&s},a2=function(l,t){var s=t/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&t)},m6=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],za=function(l,t,s){var c=new Error(t||m6[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,za),!s)throw c;return c},g6=new Oo(0),_6=typeof TextDecoder<"u"&&new TextDecoder;try{_6.decode(g6,{stream:!0})}catch{}const y6={gzip_data:"gzip"};class oa extends Error{constructor(t){super(t),this.name="MRTError"}}const v6={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},dP={uint32:1,uint16:2,uint8:4},x6={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let l2;class R0{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const s=this.layers[t];if(!s)throw new oa(`Layer '${t}' not found`);return s}getHeaderLength(t){const s=new Uint8Array(t),c=new DataView(t);if(s[0]!==13)throw new oa("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const s=new Uint8Array(t),c=this.getHeaderLength(t);if(s.length<c)throw new oa(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const h=function(d,m){return d.readFields(JB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new l2(s.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new oa(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const d of h.layers)this.layers[d.name]=new hP(d,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const s=[],c=this.getLayer(t.layerName);for(let h of t.blockIndices){const d=c.dataIndex[h],m=d.firstByte-t.firstByte,x=d.lastByte-t.firstByte;if(c._blocksInProgress.has(h))continue;const T={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[d.bands.length].concat(c.bandShape),buffer:c.buffer,codec:d.codec.codec,filters:d.filters.map(M=>M.filter)};c._blocksInProgress.add(h),s.push(T)}return new fP(s,()=>{s.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,d)=>{if(s.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),h)throw h;d.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class hP{constructor({version:t,name:s,units:c,tileSize:h,pixelFormat:d,buffer:m,dataIndex:x},T){if(this.version=t,this.version!==1)throw new oa(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=s,this.units=c,this.tileSize=h,this.buffer=m,this.pixelFormat=v6[d],this.dataIndex=x,this.bandShape=[h+2*m,h+2*m,dP[this.pixelFormat]],this._decodedBlocks=new I0(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return dP[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const s=t.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,t.data)}getBlockForBand(t){let s=0;switch(typeof t){case"string":for(const[c,h]of this.dataIndex.entries()){for(const[d,m]of h.bands.entries())if(m===t)return{bandIndex:s+d,blockIndex:c,blockBandIndex:d};s+=h.bands.length}break;case"number":for(const[c,h]of this.dataIndex.entries()){if(t>=s&&t<s+h.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-s};s+=h.bands.length}break;default:throw new oa(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new oa(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let s=1/0,c=-1/0;const h=[],d=new Set;for(const m of t){const{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new oa(`Invalid band: ${JSON.stringify(m)}`);const T=this.dataIndex[x];h.includes(x)||h.push(x),d.add(x),s=Math.min(s,T.firstByte),c=Math.max(c,T.lastByte)}if(d.size>this.cacheSize)throw new oa(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:h}}hasBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0}hasDataForBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(t){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(t),h=this._decodedBlocks.get(s.toString());if(!h)throw new oa(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[s],m=this.bandShape.reduce((M,y)=>M*y,1),x=c*m,T=h.subarray(x,x+m);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}R0.setPbf=function(l){l2=l};class fP{constructor(t,s,c){this.tasks=t,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,s){this._finalized||(this._onComplete(t,s),this._finalized=!0)}}R0.performDecoding=function(l,t){const s=new Uint8Array(l);return Promise.all(t.tasks.map(c=>{const{layerName:h,firstByte:d,lastByte:m,pixelFormat:x,blockShape:T,blockIndex:M,filters:y,codec:E}=c,P=s.subarray(d,m+1),A=new Uint32Array(T[0]*T[1]*T[2]);let I;if(E!=="gzip_data")throw new oa(`Unhandled codec: ${E}`);return I=function(k,j){if(!globalThis.DecompressionStream&&j==="gzip_data")return Promise.resolve((($=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||za(6,"invalid gzip data");var ye=oe[3],pe=10;4&ye&&(pe+=2+(oe[10]|oe[11]<<8));for(var me=(ye>>3&1)+(ye>>4&1);me>0;me-=!oe[pe++]);return pe+(2&ye)}(H=k))+8>H.length&&za(6,"invalid gzip data"),function(oe,ye,pe,me){var Me=oe.length;if(!Me||ye.f&&!ye.l)return pe||new Oo(0);var ve=!pe,Ie=ve||ye.i!=2,Oe=ye.i;ve&&(pe=new Oo(3*Me));var Le,Fe,je=function(pu){var mu=pe.length;if(pu>mu){var th=new Oo(Math.max(2*mu,pu));th.set(pe),pe=th}},Xe=ye.f||0,$e=ye.p||0,Ke=ye.b||0,xt=ye.l,yt=ye.d,Ut=ye.m,Et=ye.n,Pt=8*Me;do{if(!xt){Xe=Oa(oe,$e,1);var St=Oa(oe,$e+1,3);if($e+=3,!St){var rr=oe[(ur=4+(($e+7)/8|0))-4]|oe[ur-3]<<8,zt=ur+rr;if(zt>Me){Oe&&za(0);break}Ie&&je(Ke+rr),pe.set(oe.subarray(ur,zt),Ke),ye.b=Ke+=rr,ye.p=$e=8*zt,ye.f=Xe;continue}if(St==1)xt=f6,yt=p6,Ut=9,Et=5;else if(St==2){var Wt=Oa(oe,$e,31)+257,cr=Oa(oe,$e+10,15)+4,Mr=Wt+Oa(oe,$e+5,31)+1;$e+=14;for(var fr=new Oo(Mr),Dr=new Oo(19),Ar=0;Ar<cr;++Ar)Dr[u6[Ar]]=Oa(oe,$e+3*Ar,7);$e+=3*cr;var Nr=o2(Dr),Xr=(1<<Nr)-1,yn=a_(Dr,Nr);for(Ar=0;Ar<Mr;){var ur,$r=yn[Oa(oe,$e,Xr)];if($e+=15&$r,(ur=$r>>4)<16)fr[Ar++]=ur;else{var In=0,Nn=0;for(ur==16?(Nn=3+Oa(oe,$e,3),$e+=2,In=fr[Ar-1]):ur==17?(Nn=3+Oa(oe,$e,7),$e+=3):ur==18&&(Nn=11+Oa(oe,$e,127),$e+=7);Nn--;)fr[Ar++]=In}}var Bn=fr.subarray(0,Wt),Gn=fr.subarray(Wt);Ut=o2(Bn),Et=o2(Gn),xt=a_(Bn,Ut),yt=a_(Gn,Et)}else za(1);if($e>Pt){Oe&&za(0);break}}Ie&&je(Ke+131072);for(var mn=(1<<Ut)-1,xi=(1<<Et)-1,Es=$e;;Es=$e){var ti=(In=xt[a2(oe,$e)&mn])>>4;if(($e+=15&In)>Pt){Oe&&za(0);break}if(In||za(2),ti<256)pe[Ke++]=ti;else{if(ti==256){Es=$e,xt=null;break}var oi=ti-254;ti>264&&(oi=Oa(oe,$e,(1<<(zo=iP[Ar=ti-257]))-1)+lP[Ar],$e+=zo);var is=yt[a2(oe,$e)&xi],Ui=is>>4;if(is||za(3),$e+=15&is,Gn=h6[Ui],Ui>3){var zo=sP[Ui];Gn+=a2(oe,$e)&(1<<zo)-1,$e+=zo}if($e>Pt){Oe&&za(0);break}Ie&&je(Ke+131072);var fu=Ke+oi;if(Ke<Gn){var aa=0-Gn,Fa=Math.min(Gn,fu);for(aa+Ke<0&&za(3);Ke<Fa;++Ke)pe[Ke]=(void 0)[aa+Ke]}for(;Ke<fu;++Ke)pe[Ke]=pe[Ke-Gn]}}ye.l=xt,ye.p=Es,ye.b=Ke,ye.f=Xe,xt&&(Xe=1,ye.m=Ut,ye.d=yt,ye.n=Et)}while(!Xe);return Ke!=pe.length&&ve?(Le=pe,((Fe=Ke)==null||Fe>Le.length)&&(Fe=Le.length),new Oo(Le.subarray(0,Fe))):pe.subarray(0,Ke)}(H.subarray($,-8),{i:2},new Oo(((F=H)[(W=F.length)-4]|F[W-3]<<8|F[W-2]<<16|F[W-1]<<24)>>>0))));var F,W,H,$;const Y=y6[j];if(!Y)throw new Error(`Unhandled codec: ${j}`);const ne=new globalThis.DecompressionStream(Y);return new Response(new Blob([k]).stream().pipeThrough(ne)).arrayBuffer().then(oe=>new Uint8Array(oe))}(P,E).then(k=>(function(j,F){j.readFields(i6,F)}(new l2(k),A),new x6[x](A.buffer))),I.then(k=>{for(let j=y.length-1;j>=0;j--)switch(y[j]){case"delta_filter":o6(k,T);break;case"zigzag_filter":a6(k);break;case"bitshuffle_filter":l6(k,x);break;default:throw new oa(`Unhandled filter "${y[j]}"`)}return{layerName:h,blockIndex:M,data:k}}).catch(k=>{throw k})}))},Bt(fP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Bt(R0,"MapboxRasterTile"),Bt(hP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let c_,c2,ja,Qf,u2,ep=null;function pP(){return jn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:c2||le.DRACO_URL}function mP(){if(jn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Qf)return Qf;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Qf=WebAssembly.validate(l)?le.MESHOPT_SIMD_URL:le.MESHOPT_URL,Qf}const k0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},b6={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},u_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gP(l,t,s){const c=s.json.bufferViews.length,h=s.buffers.length;t.bufferView=c,s.json.bufferViews[c]={buffer:h,byteLength:l.byteLength},s.buffers[h]=l}const d2="KHR_draco_mesh_compression";function w6(l,t){const s=l.extensions&&l.extensions[d2];if(!s)return;const c=new ja.Decoder,h=xP(t,s.bufferView),d=new ja.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,d))throw new Error("Failed to decode Draco mesh");const m=t.json.accessors[l.indices],x=k0[m.componentType],T=m.count*x.BYTES_PER_ELEMENT,M=ja._malloc(T);x===Uint16Array?c.GetTrianglesUInt16Array(d,T,M):c.GetTrianglesUInt32Array(d,T,M),gP(ja.memory.buffer.slice(M,M+T),m,t),ja._free(M);for(const y of Object.keys(s.attributes)){const E=c.GetAttributeByUniqueId(d,s.attributes[y]),P=t.json.accessors[l.attributes[y]],A=b6[P.componentType],I=P.count*u_[P.type]*k0[P.componentType].BYTES_PER_ELEMENT,k=ja._malloc(I);c.GetAttributeDataArrayForAllPoints(d,E,ja[A],I,k),gP(ja.memory.buffer.slice(k,k+I),P,t),ja._free(k)}c.destroy(),d.destroy(),delete l.extensions[d2]}const D0="EXT_meshopt_compression";function S6(l,t){if(!l.extensions||!l.extensions[D0])return;const s=l.extensions[D0],c=new Uint8Array(t.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),h=new Uint8Array(s.count*s.byteStride);u2.decodeGltfBuffer(h,s.count,s.byteStride,c,s.mode,s.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=h.buffer,delete l.extensions[D0]}const _P=1179937895,yP=new TextDecoder("utf8");function vP(l,t){return new URL(l,t).href}function T6(l,t,s,c){return fetch(vP(l.uri,c)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[s]=h})}function xP(l,t){const s=l.json.bufferViews[t];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function E6(l,t,s,c){if(l.uri){const h=vP(l.uri,c);return fetch(h).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{t.images[s]=d})}if(l.bufferView!==void 0){const h=xP(t,l.bufferView),d=new Blob([h],{type:l.mimeType});return createImageBitmap(d).then(m=>{t.images[s]=m})}}function bP(l,t=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===_P){const y=new Uint32Array(l,t);let E=2;const P=(y[E++]>>2)-3,A=y[E++]>>2;if(E++,c.json=JSON.parse(yP.decode(y.subarray(E,E+A))),E+=A,E<P){const I=y[E++];E++;const k=t+(E<<2);c.buffers[0]=l.slice(k,k+I)}}else c.json=JSON.parse(yP.decode(new Uint8Array(l,t)));const{buffers:h,images:d,meshes:m,extensionsUsed:x,bufferViews:T}=c.json;let M=Promise.resolve();if(h){const y=[];for(let E=0;E<h.length;E++){const P=h[E];P.uri?y.push(T6(P,c,E,s)):c.buffers[E]||(c.buffers[E]=null)}M=Promise.all(y)}return M.then(()=>{const y=[],E=x&&x.includes(d2),P=x&&x.includes(D0);if(E&&y.push(function(){if(!ja)return c_??(c_=function(A){let I,k=null;function j(){I=new Uint8Array(k.buffer)}function F(){throw new Error("Unexpected Draco error.")}const W={a:{a:F,d:function(H,$,Y){return I.copyWithin(H,$,$+Y)},c:function(H){const $=I.length,Y=Math.max(H>>>0,Math.ceil(1.2*$)),ne=Math.ceil((Y-$)/65536);try{return k.grow(ne),j(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,W):A.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,W))).then(H=>{const{Rb:$,Qb:Y,P:ne,T:oe,X:ye,Ja:pe,La:me,Qa:Me,Va:ve,Wa:Ie,eb:Oe,jb:Le,f:Fe,e:je,yb:Xe,zb:$e,Ab:Ke,Bb:xt,Db:yt,Gb:Ut}=H.instance.exports;k=je;const Et=(()=>{let Pt=0,St=0,rr=0,zt=0;return Wt=>{rr&&($(zt),$(Pt),St+=rr,rr=Pt=0),Pt||(St+=128,Pt=Y(St));const cr=Wt.length+7&-8;let Mr=Pt;cr>=St&&(rr=cr,Mr=zt=Y(cr));for(let fr=0;fr<Wt.length;fr++)I[Mr+fr]=Wt[fr];return Mr}})();return j(),Fe(),{memory:je,_free:$,_malloc:Y,Mesh:class{constructor(){this.ptr=ne()}destroy(){oe(this.ptr)}},Decoder:class{constructor(){this.ptr=pe()}destroy(){Le(this.ptr)}DecodeArrayToMesh(Pt,St,rr){const zt=Et(Pt),Wt=me(this.ptr,zt,St,rr.ptr);return!!ye(Wt)}GetAttributeByUniqueId(Pt,St){return{ptr:Me(this.ptr,Pt.ptr,St)}}GetTrianglesUInt16Array(Pt,St,rr){ve(this.ptr,Pt.ptr,St,rr)}GetTrianglesUInt32Array(Pt,St,rr){Ie(this.ptr,Pt.ptr,St,rr)}GetAttributeDataArrayForAllPoints(Pt,St,rr,zt,Wt){Oe(this.ptr,Pt.ptr,St.ptr,rr,zt,Wt)}},DT_INT8:Xe(),DT_UINT8:$e(),DT_INT16:Ke(),DT_UINT16:xt(),DT_UINT32:yt(),DT_FLOAT32:Ut()}})}(fetch(pP())),c_.then(A=>{ja=A,c_=void 0}))}()),P&&y.push(function(){if(u2)return;const A=function(I){let k;const j=WebAssembly.instantiateStreaming(I,{}).then(H=>{k=H.instance,k.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:j,supported:!0,decodeGltfBuffer(H,$,Y,ne,oe,ye){(function(pe,me,Me,ve,Ie,Oe,Le){const Fe=pe.exports.sbrk,je=ve+3&-4,Xe=Fe(je*Ie),$e=Fe(Oe.length),Ke=new Uint8Array(pe.exports.memory.buffer);Ke.set(Oe,$e);const xt=me(Xe,ve,Ie,$e,Oe.length);if(xt===0&&Le&&Le(Xe,je,Ie),Me.set(Ke.subarray(Xe,Xe+ve*Ie)),Fe(Xe-Fe(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(k,k.exports[W[oe]],H,$,Y,ne,k.exports[F[ye]])}}}(fetch(mP()));return A.ready.then(()=>{u2=A})}()),d)for(let A=0;A<d.length;A++)y.push(E6(d[A],c,A,s));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(E&&m)for(const{primitives:A}of m)for(const I of A)w6(I,c);if(P&&m&&T)for(const A of T)S6(A,c);return c})})}function eh(l,t){const s=l.json.bufferViews[t.bufferView],c=k0[t.componentType];return new c(l.buffers[s.buffer],(t.byteOffset||0)+(s.byteOffset||0),t.count*(s.byteStride&&s.byteStride!==u_[t.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:u_[t.type]))}function h2(l,t,s,c){const h=k0[t.componentType],d=function(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=l.json.bufferViews[t.bufferView],x=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:u_[t.type],T=s.float32,M=T.length/s.capacity;for(let y=0,E=0;y<t.count*x;y+=x,E+=M)for(let P=0;P<M;P++)T[E+P]=c[y+P]*d;s._trim()}function C6(l,t,s){const c=l.indices,h=l.attributes,d={};d.indexArray=new ji;const m=t.json.accessors[c],x=m.count/3;d.indexArray.reserve(x);const T=eh(t,m);for(let P=0;P<x;P++)d.indexArray.emplaceBack(T[3*P],T[3*P+1],T[3*P+2]);d.indexArray._trim(),d.vertexArray=new Lo;const M=t.json.accessors[h.POSITION];d.vertexArray.reserve(M.count);const y=eh(t,M);for(let P=0;P<M.count;P++)d.vertexArray.emplaceBack(y[3*P],y[3*P+1],y[3*P+2]);if(d.vertexArray._trim(),d.aabb=new Xt(M.min,M.max),d.centroid=function(P,A){const I=[0,0,0],k=P.length;if(k>0){for(let j=0;j<k;j++){const F=3*P[j];I[0]+=A[F],I[1]+=A[F+1],I[2]+=A[F+2]}I[0]/=k,I[1]/=k,I[2]/=k}return I}(T,y),h.COLOR_0!==void 0){const P=t.json.accessors[h.COLOR_0],A=u_[P.type],I=eh(t,P);d.colorArray=A===3?new Lo:new Zl,d.colorArray.resize(P.count),h2(t,P,d.colorArray,I)}if(h.NORMAL!==void 0){d.normalArray=new Lo;const P=t.json.accessors[h.NORMAL];d.normalArray.resize(P.count);const A=eh(t,P);h2(t,P,d.normalArray,A)}if(h.TEXCOORD_0!==void 0&&s.length>0){d.texcoordArray=new Qc;const P=t.json.accessors[h.TEXCOORD_0];d.texcoordArray.resize(P.count);const A=eh(t,P);h2(t,P,d.texcoordArray,A)}if(h._FEATURE_ID_RGBA4444!==void 0){const P=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=eh(t,P))}h._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(eh(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));const E=l.material;return d.material=function(P,A){const{emissiveFactor:I=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:j=.5,normalTexture:F,occlusionTexture:W,emissiveTexture:H,doubleSided:$}=P,{baseColorFactor:Y=[1,1,1,1],metallicFactor:ne=1,roughnessFactor:oe=1,baseColorTexture:ye,metallicRoughnessTexture:pe}=P.pbrMetallicRoughness||{},me=W?A[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&me){const Me=W.extensions.KHR_texture_transform;me.offsetScale=[Me.offset[0],Me.offset[1],Me.scale[0],Me.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new an(...Y),metallicFactor:ne,roughnessFactor:oe,baseColorTexture:ye?A[ye.index]:void 0,metallicRoughnessTexture:pe?A[pe.index]:void 0},doubleSided:$,emissiveFactor:I,alphaMode:k,alphaCutoff:j,normalTexture:F?A[F.index]:void 0,occlusionTexture:me,emissionTexture:H?A[H.index]:void 0,defined:P.defined===void 0}}(E!==void 0?t.json.materials[E]:{defined:!1},s),d}function wP(l,t,s){const{matrix:c,rotation:h,translation:d,scale:m,mesh:x,extras:T,children:M}=l,y={};if(y.matrix=c||he.mat4.fromRotationTranslationScale([],h||[0,0,0,1],d||[0,0,0],m||[1,1,1]),x!==void 0){y.meshes=s[x];const E=y.anchor=[0,0];for(const P of y.meshes){const{min:A,max:I}=P.aabb;E[0]+=A[0]+I[0],E[1]+=A[1]+I[1]}E[0]=Math.floor(E[0]/y.meshes.length/2),E[1]=Math.floor(E[1]/y.meshes.length/2)}if(T&&(T.id&&(y.id=T.id),T.lights&&(y.lights=function(E){if(!E.length)return[];const P=function(F){const W=atob(F),H=new Uint8Array(W.length);for(let $=0;$<W.length;$++)H[$]=W.codePointAt($);return H}(E),A=[],I=P.length/24,k=new Uint16Array(P.buffer),j=new Float32Array(P.buffer);for(let F=0;F<I;F++){const W=k[2*F*6]/30,H=k[2*F*6+1]/30,$=k[2*F*6+10]/100,Y=j[6*F+1],ne=j[6*F+2],oe=j[6*F+3],ye=j[6*F+4],pe=oe-Y,me=ye-ne,Me=Math.hypot(pe,me);A.push({pos:[Y+.5*pe,ne+.5*me,H],normal:[me/Me,-pe/Me,0],width:Me,height:W,depth:$,points:[Y,ne,oe,ye]})}return A}(T.lights))),M){const E=[];for(const P of M)E.push(wP(t.json.nodes[P],t,s));y.children=E}return y}function A6(l){if(l.vertices.length===0||l.indices.length===0)return null;const t=new vw(l.vertices,l.indices,8,256),[s,c]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:s,max:c}}function M6(l){if(!l.extras||!l.extras.ground)return null;const t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const s=t[0];if(!s||!Array.isArray(s)||s.length===0)return null;const c=[];for(const m of s){if(!Array.isArray(m)||m.length!==2)continue;const x=m[0],T=m[1];typeof x=="number"&&typeof T=="number"&&c.push(new wt(x,T))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let m=0;m<c.length;m++){const x=c[m],T=c[(m+1)%c.length],M=c[(m+2)%c.length];h+=(x.x-T.x)*(M.y-T.y)-(M.x-T.x)*(x.y-T.y)}h>0&&c.reverse();const d=Ng(c.flatMap(m=>[m.x,m.y]),[]);return d.length===0?null:{vertices:c,indices:d}}function I6(l,t){const s=[],c=[];let h=0;const d=[];for(const m of l){h=s.length;const x=m.vertexArray.float32,T=m.indexArray.uint16;for(let M=0;M<m.vertexArray.length;M++)d[0]=x[3*M+0],d[1]=x[3*M+1],d[2]=x[3*M+2],he.vec3.transformMat4(d,d,t),s.push(new wt(d[0],d[1]));for(let M=0;M<3*m.indexArray.length;M++)c.push(T[M]+h)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const x=s[c[m+0]],T=s[c[m+1]],M=s[c[m+2]];(x.x-T.x)*(M.y-T.y)-(M.x-T.x)*(x.y-T.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:s,indices:c}}function SP(l){const t=function(T,M){const y=[],E=WebGL2RenderingContext;if(T.json.textures)for(const P of T.json.textures){const A={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};P.sampler!==void 0&&Object.assign(A,T.json.samplers[P.sampler]),y.push({image:M[P.source],sampler:A,uploaded:!1})}return y}(l,l.images),s=function(T,M){const y=[];for(const E of T.json.meshes){const P=[];for(const A of E.primitives)P.push(C6(A,T,M));y.push(P)}return y}(l,t),{scenes:c,scene:h,nodes:d}=l.json,m=c?c[h||0].nodes:d,x=[];for(const T of m)x.push(wP(d[T],l,s));return function(T,M,y){const E={},P=new Set;for(let A=0;A<T.length;A++){const I=y[M[A]];if(!I.extras)continue;const k=I.extras["mapbox:footprint:version"],j=I.extras["mapbox:footprint:id"];(k||j)&&P.add(A),k==="1.0.0"&&j&&(E[j]=A)}for(let A=0;A<T.length;A++){if(P.has(A))continue;const I=T[A],k=y[M[A]];if(!k.extras)continue;let j=null;I.id in E&&(j=I6(T[E[I.id]].meshes,I.matrix)),j||(j=M6(k)),j&&(I.footprint=A6(j))}if(P.size>0){const A=Array.from(P.values()).sort((I,k)=>I-k);for(let I=A.length-1;I>=0;I--)T.splice(A[I],1)}}(x,m,l.json.nodes),x}function P6(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const t=l.vertexArray.float32,s=l.aabb.min[0]-1,c=l.aabb.min[1]-1,h=Yd/(l.aabb.max[0]-s+2),d=Yd/(l.aabb.max[1]-c+2);for(let m=0;m<t.length;m+=3){const x=t[m+2],T=(t[m+0]-s)*h|0,M=(t[m+1]-c)*d|0;x>l.heightmap[M*Yd+T]&&(l.heightmap[M*Yd+T]=x)}}function R6(l,t){const s={};s.indexArray=new ji,s.indexArray.reserve(4*l.length),s.vertexArray=new Lo,s.vertexArray.reserve(10*l.length),s.colorArray=new Zl,s.vertexArray.reserve(10*l.length);let c=0;for(const m of l){const x=Math.min(10,Math.max(4,1.3*m.height))*t,T=[-m.normal[1],m.normal[0],0],M=Math.min(.29,.1*m.width/m.depth),y=m.width-2*m.depth*t*(M+.01),E=he.vec3.scaleAndAdd([],m.pos,T,y/2),P=he.vec3.scaleAndAdd([],m.pos,T,-y/2),A=[E[0],E[1],E[2]+m.height],I=[P[0],P[1],P[2]+m.height],k=he.vec3.scaleAndAdd([],m.normal,T,M);he.vec3.scale(k,k,x);const j=he.vec3.scaleAndAdd([],m.normal,T,-M);he.vec3.scale(j,j,x),he.vec3.add(k,E,k),he.vec3.add(j,P,j),E[2]+=.1,P[2]+=.1,s.vertexArray.emplaceBack(k[0],k[1],k[2]),s.vertexArray.emplaceBack(j[0],j[1],j[2]),s.vertexArray.emplaceBack(E[0],E[1],E[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(E[0],E[1],E[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(k[0],k[1],k[2]),s.vertexArray.emplaceBack(j[0],j[1],j[2]);const F=y/x/2;s.colorArray.emplaceBack(-F-M,-1,F,.8),s.colorArray.emplaceBack(F+M,-1,F,.8),s.colorArray.emplaceBack(-F,0,F,1.3),s.colorArray.emplaceBack(F,0,F,1.3),s.colorArray.emplaceBack(F+M,-.8,F,.7),s.colorArray.emplaceBack(F+M,-.8,F,.7),s.colorArray.emplaceBack(0,0,F,1.3),s.colorArray.emplaceBack(0,0,F,1.3),s.colorArray.emplaceBack(F+M,-1.2,F,.8),s.colorArray.emplaceBack(F+M,-1.2,F,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const h={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=an.white,h.pbrMetallicRoughness=d,s.material=h,s.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class TP{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const k6=["id","tile","layer","source","sourceLayer","state"];class tp{constructor(t,s,c,h,d){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=c,this._y=h,this.properties=t.properties,this.id=d}clone(){const t=new tp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of k6)this[s]!==void 0&&(t[s]=this[s]);return t}}class EP{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $c(Rt,16,0),this.featureIndexArray=new ks,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,s,c,h,d,m=0,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,d,m);const M=this.grid;for(let y=0;y<s.length;y++){const E=s[y],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const I=E[A];P[0]=Math.min(P[0],I.x),P[1]=Math.min(P[1],I.y),P[2]=Math.max(P[2],I.x),P[3]=Math.max(P[3],I.y)}x!==0&&(P[0]-=x,P[1]-=x,P[2]+=x,P[3]+=x),P[0]<Rt&&P[1]<Rt&&P[2]>=0&&P[3]>=0&&M.insert(T,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ou.VectorTile(new t0(this.rawTileData)).layers,this.sourceLayerCoder=new TP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s){const{tilespaceGeometry:c,transform:h,tileTransform:d,pixelPosMatrix:m,availableImages:x}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const T=c.bufferedTilespaceBounds,M=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(A,I,k,j)=>Ee(c.bufferedTilespaceGeometry,A,I,k,j));M.sort(D6);let y=null;h.elevation&&M.length>0&&(y=Zf.create(h.elevation,this.tileID));const E={};let P;for(let A=0;A<M.length;A++){const I=M[A];if(I===P)continue;P=I;const k=this.featureIndexArray.get(I);let j=null;this.is3DTile?this.loadMatchingModelFeature(E,k,t,c,h):this.loadMatchingFeature(E,k,t,x,(F,W,H,$=0)=>(j||(j=N(F,this.tileID.canonical,d)),W.queryIntersectsFeature(c,F,H,j,this.z,h,m,y,$)))}return E}loadMatchingFeature(t,s,c,h,d){const{featureIndex:m,bucketIndex:x,sourceLayerIndex:T,layoutVertexArrayOffset:M}=s,y=this.bucketLayerIDs[x],E=c.layers,P=Object.keys(E);if(P.length&&!function(F,W){for(let H=0;H<F.length;H++)if(W.indexOf(F[H])>=0)return!0;return!1}(P,y))return;const A=c.sourceCache,I=this.sourceLayerCoder.decode(T),k=this.vtLayers[I].feature(m),j=this.getId(k,I);for(let F=0;F<y.length;F++){const W=y[F];if(!E[W])continue;const{styleLayer:H,targets:$}=E[W];let Y={};j!==void 0&&(Y=A.getFeatureState(H.sourceLayer,j));const ne=!d||d(k,H,Y,M);if(!ne)continue;const oe=new tp(k,this.z,this.x,this.y,j);oe.tile=this.tileID.canonical,oe.state=Y;let ye=this.serializedLayersCache.get(W);ye||(ye=H.serialize(),ye.id=W,this.serializedLayersCache.set(W,ye)),oe.source=ye.source,oe.sourceLayer=ye["source-layer"],oe.layer=gi({},ye),oe.layer.paint=CP(ye.paint,H.paint,k,Y,h),oe.layer.layout=CP(ye.layout,H.layout,k,Y,h);let pe=!1;for(const me of $){this.updateFeatureProperties(oe,me);const{filter:Me}=me;if(Me){if(k.properties=oe.properties,Me.needGeometry){const ve=z(k,!0);if(!Me.filter(new _n(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!Me.filter(new _n(this.tileID.overscaledZ),k))continue}pe=!0,me.targetId&&this.addFeatureVariant(oe,me)}pe&&this.appendToResult(t,W,m,oe,ne)}}loadMatchingModelFeature(t,s,c,h,d){const m=this.bucketLayerIDs[0][0],x=c.layers;if(!x[m])return;const{styleLayer:T,targets:M}=x[m];if(T.type!=="model")return;const y=h.tile,E=s.featureIndex,P=y.getBucket(T);if(!(P&&P instanceof w0))return;const A=function(ye,pe,me,Me){const ve=ye.getNodesInfo()[pe];if(ve.hiddenByReplacement||!ve.node.meshes)return;let Ie=Number.MAX_VALUE;const Oe=ve.node,Le=me.tile,Fe=Me.calculatePosMatrix(Le.tileID.toUnwrapped(),Me.worldSize),je=ve.evaluatedScale;let Xe=0;Me.elevation&&Oe.elevation&&(Xe=Oe.elevation*Me.elevation.exaggeration()),he.mat4.translate(Fe,Fe,[(Oe.anchor?Oe.anchor[0]:0)*(je[0]-1),(Oe.anchor?Oe.anchor[1]:0)*(je[1]-1),Xe]),he.mat4.scale(Fe,Fe,je);const $e=me.queryGeometry,Ke=$e.isPointQuery()?$e.screenBounds:$e.screenGeometry,xt=function(Ut){const Et=he.mat4.multiply([],Fe,Ut.matrix);he.mat4.multiply(Et,Me.expandedFarZProjMatrix,Et);for(let Pt=0;Pt<Ut.meshes.length;++Pt){const St=Ut.meshes[Pt];if(Pt===Ut.lightMeshIndex)continue;const rr=SI(Ke,Me,Et,St.aabb);rr!=null&&(Ie=Math.min(rr,Ie))}if(Ut.children)for(const Pt of Ut.children)xt(Pt)};if(xt(Oe),Ie===Number.MAX_VALUE)return;const yt=new Qr(0,0);return NI(Le.tileID.canonical,yt,ve.node.anchor[0],ve.node.anchor[1]),{intersectionZ:Ie,position:yt,feature:ve.feature}}(P,E,h,d);if(!A)return;const{z:I,x:k,y:j}=y.tileID.canonical,{feature:F,intersectionZ:W,position:H}=A;let $={};F.id!==void 0&&($=c.sourceCache.getFeatureState(T.sourceLayer,F.id));const Y=new tp({},I,k,j,F.id);Y.tile=this.tileID.canonical,Y.state=$,Y.properties=F.properties,Y.geometry={type:"Point",coordinates:[H.lng,H.lat]};let ne=this.serializedLayersCache.get(m);ne||(ne=T.serialize(),ne.id=m,this.serializedLayersCache.set(m,ne)),Y.source=ne.source,Y.sourceLayer=ne["source-layer"],Y.layer=gi({},ne);let oe=!1;for(const ye of M){this.updateFeatureProperties(Y,ye);const{filter:pe}=ye;if(pe){if(F.properties=Y.properties,pe.needGeometry){if(!pe.filter(new _n(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!pe.filter(new _n(this.tileID.overscaledZ),F))continue}oe=!0,ye.targetId&&this.addFeatureVariant(Y,ye)}oe&&this.appendToResult(t,m,E,Y,W)}updateFeatureProperties(t,s,c){if(s.properties){const h={};for(const d in s.properties){const m=s.properties[d].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);m!=null&&(h[d]=m)}t.properties=h}}addFeatureVariant(t,s,c){const h={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(h.properties=t.properties),t.variants=t.variants||{},t.variants[s.targetId]=t.variants[s.targetId]||[],t.variants[s.targetId].push(h)}appendToResult(t,s,c,h,d){let m=t[s];m===void 0&&(m=t[s]=[]),m.push({featureIndex:c,feature:h,intersectionZ:d})}lookupSymbolFeatures(t,s,c,h,d){const m={};this.loadVTLayers();for(const x of t)this.loadMatchingFeature(m,{bucketIndex:s,sourceLayerIndex:c,featureIndex:x,layoutVertexArrayOffset:0},h,d);return m}loadFeature(t){const{featureIndex:s,sourceLayerIndex:c}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),d=this.vtFeatures[h];if(d[s])return d[s];const m=this.vtLayers[h].feature(s);return d[s]=m,m}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const d=Uc(h);if(d.result!=="success"){const m=d.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Cn(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Zh),c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[h];typeof c=="boolean"&&(c=Number(c))}return c}}function CP(l,t,s,c,h){return bs(l,(d,m)=>{const x=t instanceof Zc?t.get(m):null;return x&&x.evaluate?x.evaluate(s,c,h):x})}function D6(l,t){return t-l}Bt(EP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const AP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class f2{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const d=AP[15&c];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new f2(x,m,d,t)}constructor(t,s=64,c=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=AP.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return p2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:x}=this,T=[0,d.length-1,0],M=[];for(;T.length;){const y=T.pop()||0,E=T.pop()||0,P=T.pop()||0;if(E-P<=x){for(let j=P;j<=E;j++){const F=m[2*j],W=m[2*j+1];F>=t&&F<=c&&W>=s&&W<=h&&M.push(d[j])}continue}const A=P+E>>1,I=m[2*A],k=m[2*A+1];I>=t&&I<=c&&k>=s&&k<=h&&M.push(d[A]),(y===0?t<=I:s<=k)&&(T.push(P),T.push(A-1),T.push(1-y)),(y===0?c>=I:h>=k)&&(T.push(A+1),T.push(E),T.push(1-y))}return M}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:m}=this,x=[0,h.length-1,0],T=[],M=c*c;for(;x.length;){const y=x.pop()||0,E=x.pop()||0,P=x.pop()||0;if(E-P<=m){for(let j=P;j<=E;j++)IP(d[2*j],d[2*j+1],t,s)<=M&&T.push(h[j]);continue}const A=P+E>>1,I=d[2*A],k=d[2*A+1];IP(I,k,t,s)<=M&&T.push(h[A]),(y===0?t-c<=I:s-c<=k)&&(x.push(P),x.push(A-1),x.push(1-y)),(y===0?t+c>=I:s+c>=k)&&(x.push(A+1),x.push(E),x.push(1-y))}return T}}function p2(l,t,s,c,h,d){if(h-c<=s)return;const m=c+h>>1;MP(l,t,m,c,h,d),p2(l,t,s,c,m-1,1-d),p2(l,t,s,m+1,h,1-d)}function MP(l,t,s,c,h,d){for(;h>c;){if(h-c>600){const M=h-c+1,y=s-c+1,E=Math.log(M),P=.5*Math.exp(2*E/3),A=.5*Math.sqrt(E*P*(M-P)/M)*(y-M/2<0?-1:1);MP(l,t,s,Math.max(c,Math.floor(s-y*P/M+A)),Math.min(h,Math.floor(s+(M-y)*P/M+A)),d)}const m=t[2*s+d];let x=c,T=h;for(d_(l,t,c,s),t[2*h+d]>m&&d_(l,t,c,h);x<T;){for(d_(l,t,x,T),x++,T--;t[2*x+d]<m;)x++;for(;t[2*T+d]>m;)T--}t[2*c+d]===m?d_(l,t,c,T):(T++,d_(l,t,T,h)),T<=s&&(c=T+1),s<=T&&(h=T-1)}}function d_(l,t,s,c){m2(l,s,c),m2(t,2*s,2*c),m2(t,2*s+1,2*c+1)}function m2(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function IP(l,t,s,c){const h=l-s,d=t-c;return h*h+d*d}i.$=hs,i.A=Ps,i.B=Qo,i.C=Yc,i.D=Xf,i.E=Po,i.F=2,i.G=Hg,i.H=OM,i.I=ws,i.J=class extends x0{},i.K=xa,i.L=Kr,i.M=Tv,i.N=Zm,i.O=Bc,i.P=wt,i.Q=pv,i.R=Pi,i.S=pf,i.T=Hw,i.U=Sf,i.V=x0,i.W=Jm,i.X=Uc,i.Y=Sd,i.Z=Ea,i._=Nc,i.a=function(l){return le.API_CDN_URL_REGEX.test(l)},i.a$=z,i.a0=ho,i.a1=cg,i.a2=hf,i.a3=df,i.a4=function(l){const t=l.value;let s=[];if(!t)return s;const c=xa(t);return c!=="string"?(s=s.concat([new x0(l.key,t,`string expected, "${c}" found`)]),s):(EI(t,!0)||(s=s.concat([new x0(l.key,t,`invalid url "${t}"`)])),s)},i.a5=Ye,i.a6=lg,i.a7=Fn,i.a8=It,i.a9=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return vn(l.expression.evaluate(t))}interpolate(l,t,s){return{x:or(l.x,t.x,s),y:or(l.y,t.y,s),z:or(l.z,t.z,s),azimuthal:or(l.azimuthal,t.azimuthal,s),polar:or(l.polar,t.polar,s)}}},i.aA=function(l,t){const s={};for(let c=0;c<t.length;c++){const h=t[c];h in l&&(s[h]=l[h])}return s},i.aB=yl,i.aC=Ds,i.aD=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,s,c){const h=this.entries[l]=this.entries[l]||{callbacks:[]};if(h.result){const[d,m]=h.result;return this.scheduler?this.scheduler.add(()=>{c(d,m)},t):c(d,m),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=s((d,m)=>{h.result=[d,m];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(d,m)},t):x(d,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(d=>d!==c),h.callbacks.length||(h.cancel(),delete this.entries[l]))}}},i.aE=function(l,t,s){const c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},h=>{const d=ga(l.request,(m,x,T,M)=>{m?h(m):x&&h(null,{vectorTile:s?void 0:new ou.VectorTile(new t0(x)),rawData:x,cacheControl:T,expires:M})});return()=>{d.cancel(),h()}},t)},i.aF=function(l){sn++,sn>Er&&(l.getActor().send("enforceCacheSizeLimit",yr),sn=0)},i.aG=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},i.aH=vt,i.aI=hI,i.aJ=yI,i.aK=dI,i.aL=function(l,t){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let c=0;c<l.length;c++){const h=document.createElement("source");_m(l[c])||(s.crossOrigin="Anonymous"),h.src=l[c],s.appendChild(h)}return{cancel:()=>{}}},i.aM=m0,i.aN=function(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>bP(t,0,l))},i.aO=SP,i.aP=class{constructor(l,t,s,c){this.id=l,this.position=t!=null?new Qr(t[0],t[1]):new Qr(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,t){if(he.mat4.multiply(l.matrix,t,l.matrix),l.meshes)for(const s of l.meshes){const c=Xt.applyTransformFast(s.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(const s of l.children)this._applyTransformations(s,l.matrix)}computeBoundsAndApplyParent(){const l=he.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,l)}computeModelMatrix(l,t,s,c,h,d,m=!1){PI(this.matrix,this,l.transform,this.position,t,s,c,h,d,m)}upload(l){if(!this.uploaded){for(const t of this.nodes)Yw(t,l);for(const t of this.nodes)b0(t);this.uploaded=!0}}destroy(){for(const l of this.nodes)Jw(l)}},i.aQ=ao,i.aR=Xg,i.aS=Ls,i.aT=Fi,i.aU=Ia,i.aV=ji,i.aW=ui,i.aX=zd,i.aY=f0,i.aZ=function(){mo.isLoading()||mo.isLoaded()||bf()!=="deferred"||Sv()},i.a_=ug,i.aa=_n,i.ab=Vc,i.ac=r,i.ad=he,i.ae=mi,i.af=Zc,i.ag=Ts,i.ah=or,i.ai=Rt,i.aj=Ky,i.ak=wr,i.al=an,i.am=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return function([s,c]){const h=vn([1,s,c]);return{x:h.x,y:h.y,z:h.z}}(l.expression.evaluate(t))}interpolate(l,t,s){return{x:or(l.x,t.x,s),y:or(l.y,t.y,s),z:or(l.z,t.z,s)}}},i.an=function(l,t,s=0,c=!0){const h=new wt(s,s),d=l.sub(h),m=t.add(h),x=[d,new wt(m.x,d.y),m,new wt(d.x,m.y)];return c&&x.push(d.clone()),x},i.ao=function(l,t){const s=[];for(let c=0;c<l.length;c++){const h=Is(c-1,-1,l.length-1),d=Is(c+1,-1,l.length-1),m=l[c],x=l[d],T=l[h].sub(m).unit(),M=x.sub(m).unit(),y=M.angleWithSep(T.x,T.y),E=T.add(M).unit().mult(-1*t/Math.sin(y/2));s.push(m.add(E))}return s},i.ap=YM,i.aq=Ee,i.ar=function(l,t,s=0){return he.vec3.fromValues(((t.x-s)*l.scale-l.x)*Rt,(t.y*l.scale-l.y)*Rt,Rg(t.z,t.y))},i.as=lr,i.at=uM,i.au=function(l){let t=1/0,s=1/0,c=-1/0,h=-1/0;for(const d of l)t=Math.min(t,d.x),s=Math.min(s,d.y),c=Math.max(c,d.x),h=Math.max(h,d.y);return{min:new wt(t,s),max:new wt(c,h)}},i.av=na,i.aw=Te,i.ax=f,i.ay=Tr,i.az=fs,i.b=function(l){return le.API_FONTS_REGEX.test(l)},i.b$=y0,i.b0=tp,i.b1=_i,i.b2=Ew,i.b3=yw,i.b4=N,i.b5=Ma,i.b6=Rf,i.b7=nr,i.b8=Rn,i.b9=Ng,i.bA=VA,i.bB=Ow,i.bC=GM,i.bD=Dw,i.bE=f2,i.bF=Is,i.bG=Mo,i.bH=qi,i.bI=function(l,t,s){l[4*t+0]=s[0],l[4*t+1]=s[1],l[4*t+2]=s[2],l[4*t+3]=s[3]},i.bJ=qd,i.bK=_o,i.bL=eu,i.bM=Qn,i.bN=$d,i.bO=Qr,i.bP=rI,i.bQ=it,i.bR=xr,i.bS=xI,i.bT=_t,i.bU=ns,i.bV=function(l,t,s,c,h,d,m,x,T){if(T.name==="globe")return ns(l,t,new _t(s,c,h),!1);const M=Xg({z:s,x:c,y:h},T);return new Xt([(d+M.x/M.scale)*t,t*(M.y/M.scale),m],[(d+M.x2/M.scale)*t,t*(M.y2/M.scale),x])},i.bW=function(l,t,s){let c=0;for(let h=0;h<2;++h)l[h]>0&&(c+=(l[h]-0)*(l[h]-0)),t[h]<0&&(c+=(0-t[h])*(0-t[h]));return c},i.bX=Kn,i.bY=Uv,i.bZ=function(l){const t=he.mat4.identity(new Float64Array(16));he.mat4.multiply(t,l.pixelMatrix,l.globeMatrix);const s=[0,Xs,0],c=[0,Ks,0];return he.vec3.transformMat4(s,s,t),he.vec3.transformMat4(c,c,t),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!Os(l,new Qr(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!Os(l,new Qr(l.center.lat,-90))]},i.b_=function(l,t){const{scale:s}=l.tileTransform,c=s*Rt/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return he.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},i.ba=$w,i.bb=function(l,t){const s=Ts(t.zoom);if(s===0)return di(l);const c=Gr(l),h=Dn(c),d=na(c.getWest())*t.worldSize,m=na(c.getEast())*t.worldSize,x=Ds(c.getNorth())*t.worldSize,T=Ds(c.getSouth())*t.worldSize,M=[d,x,0],y=[m,x,0],E=[d,T,0],P=[m,T,0],A=he.mat4.invert([],t.globeMatrix);return he.vec3.transformMat4(M,M,A),he.vec3.transformMat4(y,y,A),he.vec3.transformMat4(E,E,A),he.vec3.transformMat4(P,P,A),h[0]=yi(h[0],E,s),h[1]=yi(h[1],P,s),h[2]=yi(h[2],y,s),h[3]=yi(h[3],M,s),Xt.fromPoints(h)},i.bc=Mn,i.bd=tn,i.be=yi,i.bf=Jc,i.bg=gr,i.bh=R0,i.bi=t0,i.bj=ga,i.bk=function(l,t){const s=[];for(const c in l)c in t||s.push(c);return s},i.bl=Yi,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=dn,i.bo=function(l,t){const{x:s,y:c}=l.point,h=yo(s,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return he.mat4.multiply(h,h,hi(di(t)))},i.bp=Uf,i.bq=Js,i.br=e0,i.bs=function(l,t,s,c,h){const d=5*t+2;l.float32[d+0]=s,l.float32[d+1]=c,l.float32[d+2]=h},i.bt=h0,i.bu=NM,i.bv=se,i.bw=Wi,i.bx=OA,i.by=TI,i.bz=UA,i.c=we,i.c$=pM,i.c0=vI,i.c1=function(l){const t=vI(l,!0);return he.mat2.invert([],[t[0],t[1],t[4],t[5]])},i.c2=Fr,i.c3=function(l){const{x:t,y:s}=l.point,{lng:c,lat:h}=l._center;return yo(t,s,l.worldSize,c,h)},i.c4=Hr,i.c5=Lt,i.c6=tu,i.c7=function(l){const t=Math.round((l+45+360)%360/90)%4;return Yn[t]},i.c8=45,i.c9=Yy,i.cA=jv,i.cB=class extends ra{constructor(l){super(l),this.current=Ag}set(l,t,s){if(this.fetchUniformLocation(l,t)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},i.cC=ys,i.cD=function(l,t,s){const c=Ts(s.zoom),h=l.style.map._antialias,d=l.terrain&&l.terrain.exaggeration()>0;return c===0&&!h&&!d},i.cE=function(l){const t=l.pixelsPerMeter,s=t/qi(1,l.center.lat),c=he.mat4.identity(new Float64Array(16));return he.mat4.translate(c,c,[l.point.x,l.point.y,0]),he.mat4.scale(c,c,[s,s,t]),Float32Array.from(c)},i.cF=Gr,i.cG=function(l){const t=Kn-5;l=Tr(l,-t,t)/t*90;const s=Math.pow(Math.abs(Math.sin(wr(l))),3);return Math.round(s*(zf.length-1))},i.cH=function(l,t,s,c){const h=t.getNorth(),d=t.getSouth(),m=t.getWest(),x=t.getEast(),T=1<<l.z,M=x-m,y=h-d,E=M/ru,P=-y/zf[s],A=[0,E,0,P,0,0,h,m,0];if(l.z>0){const I=180/c;he.mat3.multiply(A,A,[I/M+1,0,0,0,I/y+1,0,-.5*I/E,.5*I/P,1])}return A[2]=T,A[5]=l.x,A[8]=l.y,A},i.cI=di,i.cJ=function(l,t,s){const c=he.mat4.identity(new Float64Array(16)),h=(t/(1<<l)-.5)*Math.PI*2;return he.mat4.rotateY(c,s.globeMatrix,h),Float32Array.from(c)},i.cK=class{isDataAvailableAtPoint(l){const t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;const s=t.getSource().maxzoom,c=1<<s,h=Math.floor(l.x),d=Math.floor((l.x-h)*c),m=Math.floor(l.y*c),x=this.findDEMTileFor(new vt(s,h,s,d,m));return!(!x||!x.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,s=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||l.y<0||l.y>1)return t;const h=c.getSource().maxzoom,d=1<<h,m=Math.floor(l.x),x=l.x-m,T=new vt(h,m,h,Math.floor(x*d),Math.floor(l.y*d)),M=this.findDEMTileFor(T);if(!M||!M.dem)return t;const y=M.dem,E=1<<M.tileID.canonical.z,P=(x*E-M.tileID.canonical.x)*y.dim,A=(l.y*E-M.tileID.canonical.y)*y.dim,I=Math.floor(P),k=Math.floor(A);return(s?this.exaggeration():1)*or(or(y.get(I,k),y.get(I,k+1),A-k),or(y.get(I+1,k),y.get(I+1,k+1),A-k),P-I)}getAtTileOffset(l,t,s){const c=1<<l.canonical.z;return this.getAtPointOrZero(new r(l.wrap+(l.canonical.x+t/Rt)/c,(l.canonical.y+s/Rt)/c))}getAtTileOffsetFunc(l,t,s,c){return h=>{const d=this.getAtTileOffset(l,h.x,h.y),m=c.upVector(l.canonical,h.x,h.y),x=c.upVectorScale(l.canonical,t,s).metersToTile;return he.vec3.scale(m,m,d*x),m}}getForTilePoints(l,t,s,c){if(this.isUsingMockSource())return!1;const h=Zf.create(this,l,c);return!!h&&(t.forEach(d=>{d[2]=this.exaggeration()*h.getElevationAt(d[0],d[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(l);if(!t||!t.dem)return null;const s=t.dem.tree,c=t.tileID,h=1<<l.canonical.z-c.canonical.z;let d=l.canonical.x/h-c.canonical.x,m=l.canonical.y/h-c.canonical.y,x=0;for(let T=0;T<l.canonical.z-c.canonical.z&&!s.leaves[x];T++){d*=2,m*=2;const M=2*Math.floor(m)+Math.floor(d);x=s.childOffsets[x]+M,d%=1,m%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const h of l){const d=this.getMinMaxForTile(h.tileID);d&&(s=Math.min(s,d.min),c=Math.max(c,d.max),t=!0)}return t?{min:s,max:c}:null}},i.cL=hA,i.cM=Vr,i.cN=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},i.cO=Ns,i.cP=at,i.cQ=dd,i.cR=256,i.cS=function(l,t){const s=[0,0,0],c=Mn(di(t.canonical));return he.vec3.transformMat4(s,s,c),he.vec3.transformMat4(s,s,l),s},i.cT=l=>({u_camera_to_center_distance:new Qn(l),u_extrude_scale:new Mg(l),u_device_pixel_ratio:new Qn(l),u_matrix:new qd(l),u_inv_rot_matrix:new qd(l),u_merc_center:new _o(l),u_tile_id:new eu(l),u_zoom_transition:new Qn(l),u_up_dir:new eu(l),u_emissive_strength:new Qn(l)}),i.cU=l=>({u_matrix:new qd(l),u_pixels_to_tile_units:new Mg(l),u_device_pixel_ratio:new Qn(l),u_width_scale:new Qn(l),u_floor_width_scale:new Qn(l),u_units_to_pixels:new _o(l),u_dash_image:new $d(l),u_gradient_image:new $d(l),u_image_height:new Qn(l),u_texsize:new _o(l),u_tile_units_to_pixels:new Qn(l),u_alpha_discard_threshold:new Qn(l),u_trim_offset:new _o(l),u_trim_fade_range:new _o(l),u_trim_color:new Gd(l),u_emissive_strength:new Qn(l),u_zbias_factor:new Qn(l),u_tile_to_meter:new Qn(l)}),i.cV=l=>({u_matrix:new qd(l),u_texsize:new _o(l),u_pixels_to_tile_units:new Mg(l),u_device_pixel_ratio:new Qn(l),u_width_scale:new Qn(l),u_floor_width_scale:new Qn(l),u_image:new $d(l),u_units_to_pixels:new _o(l),u_tile_units_to_pixels:new Qn(l),u_alpha_discard_threshold:new Qn(l),u_trim_offset:new _o(l),u_trim_fade_range:new _o(l),u_trim_color:new Gd(l),u_emissive_strength:new Qn(l),u_zbias_factor:new Qn(l),u_tile_to_meter:new Qn(l)}),i.cW=vg,i.cX=O5,i.cY=z5,i.cZ=iu,i.c_=(l,t,s,c,h,d)=>{const m=l.transform,x=m.projection.name==="globe";let T;if(d.paint.get("circle-pitch-alignment")==="map")if(x){const y=Ns(m.zoom,t.canonical)*m._pixelsPerMercatorPixel;T=Float32Array.from([y,0,0,y])}else T=m.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(t.projMatrix,s,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ot.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:kg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(x){M.u_inv_rot_matrix=c,M.u_merc_center=h,M.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],M.u_zoom_transition=Ts(m.zoom);const y=h[0]*Rt,E=h[1]*Rt;M.u_up_dir=m.projection.upVector(new _t(0,0,0),y,E)}return M},i.ca=jf,i.cb=Gd,i.cc=function(l,t,s){const c=Math.sqrt(l*l+t*t+s*s),h=c>0?Math.acos(s/c)*Vn:0;let d=l!==0||t!==0?Math.atan2(-t,-l)*Vn+90:0;return d<0&&(d+=360),[c,d,h]},i.cd=p,i.ce=Xt,i.cf=vn,i.cg=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.ch=function(l,t){return l.readFields(PB,{icons:[]},t)},i.ci=function(l){return l({pluginStatus:Ss,pluginURL:hl}),Gc.on("pluginStateChange",l),l},i.cj=S0,i.ck=Gf,i.cl=Lw,i.cm=xc,i.cn=Rd,i.co=jt,i.cp=qs,i.cq=Oi,i.cr=function(l){const t=l.indexOf(Ef);return t>=0?l.slice(0,t):l},i.cs=function(l){return l.indexOf(Ef)>=0},i.ct=function(l){const t=l.indexOf(Ef);return t>=0?l.slice(t+1):""},i.cu=function(l){const t=[],s=l.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},i.cv=function(l,t,s,c){return l.type==="custom"?new gB(l,t):new AB[l.type](l,t,s,c)},i.cw=$s,i.cx=class extends tp{constructor(l,t){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},i.cy=Gc,i.cz=uo,i.d=function(l){return le.API_TILEJSON_REGEX.test(l)},i.d$=TP,i.d0=rs,i.d1=(l,t,s,c,h,d,m,x)=>{const T=l.transform,M=T.pitch<15?dM(.07,.7,Tr((14-T.zoom)/5,0,1)):.07,y=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:fM(l,t,s,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_width_scale:d,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:hM(t,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(y?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:p(t.tileID.canonical,0)}},i.d2=(l,t,s,c,h,d,m,x,T)=>{const M=l.transform,y=M.calculatePixelsToTileUnitsMatrix(t),E=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=M.pitch<15?dM(.07,.7,Tr((14-M.zoom)/5,0,1)):.07;return{u_matrix:fM(l,t,s,c),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_width_scale:m,u_floor_width_scale:x,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:mM(s)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:hM(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(E?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:p(t.tileID.canonical,0)}},i.d3=Ao,i.d4=Lg,i.d5=Rg,i.d6=tM,i.d7=Nt,i.d8=Qv,i.d9=au,i.dA=Kv,i.dB=vs,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=xs,i.dE=aw,i.dF=Yl,i.dG=function([l,t,s]){const c=Math.hypot(l,t,s),h=Math.atan2(l,s),d=.5*Math.PI-Math.acos(-t/c);return new Qr(Hr(h),Hr(d))},i.dH=Zw,i.dI=function(l){const t=l.navigator?l.navigator.userAgent:null;return!!function(s){if(lo==null){const c=s.navigator?s.navigator.userAgent:null;lo=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return lo}(l)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(l,t){yr=l,Er=t},i.dK=Os,i.dL=vo,i.dM=function(l){const t=[0,0,0],s=he.mat4.identity(new Float64Array(16));return he.mat4.multiply(s,l.pixelMatrix,l.globeMatrix),he.vec3.transformMat4(t,t,s),new wt(t[0],t[1])},i.dN=function(l,t,s=!1){if(Ss===ig||Ss===ta||Ss===sg)throw new Error("setRTLTextPlugin cannot be called multiple times.");hl=ot.resolveURL(l),Ss=ig,og=t,xf(),s||Sv()},i.dO=bf,i.dP=function(){S0().acquire(e2)},i.dQ=function(){const l=n_;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(e2),n_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=Qd,i.dS=function(l){const t=zn();if(!t)return;const s=t.delete(Vt);l&&s.catch(l).then(()=>l())},i.dT=r_,i.dU=pP,i.dV=function(l){c2=ot.resolveURL(l),ep||(ep=new Xf(S0(),new Po)),ep.broadcast("setDracoUrl",c2)},i.dW=mP,i.dX=function(l){Qf=ot.resolveURL(l),ep||(ep=new Xf(S0(),new Po)),ep.broadcast("setMeshoptUrl",Qf)},i.dY=Bt,i.dZ=su,i.d_=Na,i.da=450,i.db=7,i.dc=mB,i.dd=Jr,i.de=Lf,i.df=256,i.dg=hi,i.dh=Lo,i.di=Rs,i.dj=Pf,i.dk=function(l,t,s,c,h){return Tr((l-t)/(s-t)*(h-c)+c,c,h)},i.dl=Gm,i.dm=vl,i.dn=class{constructor(l,t,s,c){this.context=l,this.format=c,this.size=s,this.texture=l.gl.createTexture();const[h,d,m]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,h,d,m,0,Gw(this.format),qw(this.format),t.data)}bind(l,t){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.dp=Xw,i.dq=[1,1,1],i.dr=Zf,i.ds=Wf,i.dt=ml,i.du=Qc,i.dv=Jl,i.dw=wg,i.dx=bg,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){const s=jA(new wt(0,0),new wt(Rt,Rt),l),c=[];if(t&&!xw(s,this._globalClipBounds))return c;for(const h of this._activeRegions){if(h.hiddenByOverlap||!xw(s,h))continue;const d=c5(h.min,h.max,l);c.push({min:d.min,max:d.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return c}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const s=[];for(const c of t.cache.getVisibleCoordinates()){const h=t.cache.getTile(c).buckets[t.layer];h&&h.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){const t=l.getFootprints();if(t.length===0)return;const s=l.getOrder(),c=l.getClipMask(),h=l.getClipScope();for(const d of t){if(!d.footprint)continue;const m=jA(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:s,clipMask:c,clipScope:h})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,s)=>t.priority-s.priority||Yv(t.min,s.min)||Yv(t.max,s.max)||t.order-s.order||t.clipMask-s.clipMask||function(c,h){const d=(m,x)=>m+x;return c.length-h.length||c.reduce(d,"").localeCompare(h.reduce(d,""))}(t.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){const s=this._activeRegions[t],c=this._prevRegions[t];l=s.priority!==c.priority||!zA(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!dn(s.clipScope,c.clipScope),++t}}if(l){++this._updateTime;for(const s of this._activeRegions)s.order!==Kv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const t=s=>{const c=this._activeRegions;if(s>=c.length)return s;const h=c[s].priority;for(;s<c.length&&c[s].priority===h;)++s;return s};if(this._sourceIds.length>1){let s=0,c=t(s);for(;s!==c;){let h=s;const d=s;for(;h!==c;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let x=0;x<d;x++){const T=this._activeRegions[x];if(!T.hiddenByOverlap&&m.order===Kv&&xw(m,T)&&(m.hiddenByOverlap=BA(m.footprint,m.tileId,T.footprint,T.tileId),m.hiddenByOverlap))break}++h}s=c,c=t(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},i.dz=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){const s=new Ma,c=new ji,h=[],d=l+1+2,m=t[0]+1,x=t[0]+1+(1+t.length),T=(M,y,E)=>{let P=M===d-1?M-2:M===0?M:M-1;return P+=E?24575:0,[P,y]};for(let M=0;M<d;++M)s.emplaceBack(...T(M,0,!0));for(let M=0;M<m;++M)for(let y=0;y<d;++y)s.emplaceBack(...T(y,M,(y===0||y===d-1)&&!0));for(let M=0;M<t.length;++M){const y=t[M];for(let E=0;E<d;++E)s.emplaceBack(...T(E,y,!0))}for(let M=0;M<t.length;++M){const y=c.length,E=t[M]+1+2,P=new ji;for(let k=0;k<E-1;k++){const j=k===E-2,F=j?d*(x-t.length+M-k):d;for(let W=0;W<d-1;W++){const H=k*d+W;k===0||j||W===0||W===d-2?(P.emplaceBack(H+1,H,H+F),P.emplaceBack(H+F,H+F+1,H+1)):(c.emplaceBack(H+1,H,H+F),c.emplaceBack(H+F,H+F+1,H+1))}}const A=Rn.simpleSegment(0,y,s.length,c.length-y);for(let k=0;k<P.uint16.length;k+=3)c.emplaceBack(P.uint16[k],P.uint16[k+1],P.uint16[k+2]);const I=Rn.simpleSegment(0,y,s.length,c.length-y);h.push({withoutSkirts:A,withSkirts:I})}return{vertices:s,indices:c,segments:h}}_createGrid(l){const t=this._fillGridMeshWithLods(ru,zf);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,nr.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){const t=new ji;for(let m=0;m<=ru;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);const s=new Rs,c=new Rs,h=new Rs,d=new Rs;this._poleSegments=[];for(let m=0,x=0;m<tu;m++){const T=360/(1<<m);s.emplaceBack(0,-fs,0,.5,0),c.emplaceBack(0,-fs,0,.5,1),h.emplaceBack(0,-fs,0,.5,.5),d.emplaceBack(0,-fs,0,.5,.5);for(let M=0;M<=ru;M++){let y=M/ru,E=0;const P=or(0,T,y),[A,I,k]=nu(sa,ka,P,fs);s.emplaceBack(A,I,k,y,E),c.emplaceBack(A,I,k,y,1-E);const j=wr(P);y=.5+.5*Math.sin(j),E=.5+.5*Math.cos(j),h.emplaceBack(A,I,k,y,E),d.emplaceBack(A,I,k,y,1-E)}this._poleSegments.push(Rn.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,Zt,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,Zt,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(h,Zt,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(d,Zt,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.e=le,i.e0=EP,i.e1=aM,i.e2=Zd,i.e3="hd_road_elevation",i.e4=class{static parseFrom(l,t){const s=Ql.parse(l);if(!s)return[];let{vertices:c,features:h}=s;const d=1/p(t);h.sort((M,y)=>M.id-y.id),c.sort((M,y)=>M.id-y.id||M.idx-y.idx),c=c.filter((M,y,E)=>y===E.findIndex(P=>P.id===M.id&&P.idx===M.idx));const m=new Array;let x=0;const T=c.length;for(const M of h){if(M.constantHeight){m.push(new gw(M.id,M.bounds,M.constantHeight));continue}for(;x!==T&&c[x].id<M.id;)x++;if(x===T||c[x].id!==M.id)continue;const y=new Array,E=new Array,P=x;for(;x!==T&&c[x].id===M.id;){const A=c[x];if(y.push({position:A.position,height:A.height,extent:A.extent}),x!==P&&c[x-1].idx===A.idx-1){const I=x-P;E.push({a:I-1,b:I})}x++}m.push(new gw(M.id,M.bounds,void 0,y,E,d))}return m}},i.e5=bs,i.e6=Xd,i.e7=zM,i.e8=$f,i.e9=function(l,t,s,c,h,d,m,x=1,T){l.createArrays(),l.tilePixelRatio=Rt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const M=l.layers[0].layout,y=l.layers[0]._unevaluatedLayout._values,E={};E.scaleFactor=x,E.textSizeScaleRange=M.get("text-size-scale-range"),E.iconSizeScaleRange=M.get("icon-size-scale-range");const[P,A]=E.textSizeScaleRange,[I,k]=E.iconSizeScaleRange;E.textScaleFactor=Tr(E.scaleFactor,P,A),E.iconScaleFactor=Tr(E.scaleFactor,I,k);const j=y["text-size"],F=y["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:oe,maxZoom:ye}=l.textSizeData;E.compositeTextSizes=[j.possiblyEvaluate(new _n(oe),d),j.possiblyEvaluate(new _n(ye),d)]}if(l.iconSizeData.kind==="composite"){const{minZoom:oe,maxZoom:ye}=l.iconSizeData;E.compositeIconSizes=[F.possiblyEvaluate(new _n(oe),d),F.possiblyEvaluate(new _n(ye),d)]}E.layoutTextSize=j.possiblyEvaluate(new _n(m+1),d),E.layoutIconSize=F.possiblyEvaluate(new _n(m+1),d),E.textMaxSize=j.possiblyEvaluate(new _n(18),d);const W=M.get("symbol-placement"),H=M.get("text-rotation-alignment")==="map"&&W!=="point",$=M.get("text-size");let Y=!1;const ne=[];for(const oe of l.features){const ye=M.get("text-font").evaluate(oe,{},d).join(","),pe=$.evaluate(oe,{},d)*E.textScaleFactor,me=E.layoutTextSize.evaluate(oe,{},d)*E.textScaleFactor,Me=E.layoutIconSize.evaluate(oe,{},d)*E.iconScaleFactor,ve={horizontal:{},vertical:void 0},Ie=oe.text;let Oe,Le=[0,0];if(Ie){const St=Ie.toString(),rr=M.get("text-letter-spacing").evaluate(oe,{},d)*Wi,zt=M.get("text-line-height").evaluate(oe,{},d)*Wi,Wt=Zb(St)?rr:0,cr=M.get("text-anchor").evaluate(oe,{},d),Mr=M.get("text-variable-anchor");if(!Mr){const Xr=M.get("text-radial-offset").evaluate(oe,{},d);Le=Xr?GM(cr,[Xr*Wi,Nw]):M.get("text-offset").evaluate(oe,{},d).map(yn=>yn*Wi)}let fr=H?"center":M.get("text-justify").evaluate(oe,{},d);const Dr=W==="point",Ar=Dr?M.get("text-max-width").evaluate(oe,{},d)*Wi:1/0,Nr=Xr=>{l.allowVerticalPlacement&&tg(St)&&(ve.vertical=kw(Ie,t,s,h,ye,Ar,zt,cr,Xr,Wt,Le,Js.vertical,!0,me,pe,T))};if(!H&&Mr){const Xr=fr==="auto"?Mr.map(ur=>Ow(ur)):[fr];let yn=!1;for(let ur=0;ur<Xr.length;ur++){const $r=Xr[ur];if(!ve.horizontal[$r])if(yn)ve.horizontal[$r]=ve.horizontal[0];else{const In=kw(Ie,t,s,h,ye,Ar,zt,"center",$r,Wt,Le,Js.horizontal,!1,me,pe,T);In&&(ve.horizontal[$r]=In,yn=In.positionedLines.length===1)}}Nr("left")}else{if(fr==="auto"&&(fr=Ow(cr)),Dr||M.get("text-writing-mode").indexOf("horizontal")>=0||!tg(St)){const Xr=kw(Ie,t,s,h,ye,Ar,zt,cr,fr,Wt,Le,Js.horizontal,!1,me,pe,T);Xr&&(ve.horizontal[fr]=Xr)}Nr(Dr?"left":fr)}}let Fe,je,Xe,$e,Ke,xt=!1;if(oe.icon&&oe.icon.hasPrimary()){const St=HM(oe.icon,l.iconSizeData,y["icon-size"],d,l.zoom,oe,T,E.iconScaleFactor);Fe=St.iconPrimary,je=St.iconSecondary;const rr=Fe.toString(),zt=c.get(rr);zt&&(Xe=M.get("icon-offset").evaluate(oe,{},d),$e=M.get("icon-anchor").evaluate(oe,{},d),Ke=M.get("icon-text-fit").evaluate(oe,{},d),Oe=W5(h.get(rr),je?h.get(je.toString()):void 0,Xe,$e),xt=zt.sdf,l.sdfIcons===void 0?l.sdfIcons=zt.sdf:l.sdfIcons!==zt.sdf&&Cn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zt.pixelRatio!==l.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}Y=Y||!(!oe.icon||!oe.icon.hasSecondary());const yt=zw(ve.horizontal)||ve.vertical;l.iconsInText||(l.iconsInText=!!yt&&yt.iconsInText);const Ut=me*E.textScaleFactor/Wi,{defaultShapedIcon:Et,verticallyShapedIcon:Pt}=tB(l,Oe,M,oe,d,ve,Ut,Xe,Ke);Oe=Et,ne.push({feature:oe,shapedTextOrientations:ve,shapedText:yt,shapedIcon:Oe,iconPrimary:Fe,iconSecondary:je,iconOffset:Xe,iconAnchor:$e,verticallyShapedIcon:Pt,layoutTextSize:me,layoutIconSize:Me,textOffset:Le,isSDFIcon:xt,iconTextFit:Ke})}return{featureData:ne,sizes:E,hasAnySecondaryIcon:Y,textAlongLine:H,symbolPlacement:W}},i.ea=jM,i.eb=function(l,t,s,c,h,d,m,x,T,M){const{featureData:y,hasAnySecondaryIcon:E,sizes:P,textAlongLine:A,symbolPlacement:I}=t;for(const k of y){const{shapedIcon:j,verticallyShapedIcon:F,feature:W,shapedTextOrientations:H,shapedText:$,layoutTextSize:Y,textOffset:ne,isSDFIcon:oe,iconPrimary:ye,iconSecondary:pe,iconTextFit:me,iconOffset:Me}=k;WM(j,M.iconPositions,ye,pe),WM(F,M.iconPositions,ye,pe),eB(H,M.iconPositions),($||j)&&rB(l,W,H,j,F,T,P,Y,0,ne,oe,c,h,m,x,E,me,Me,A,I)}s&&l.generateCollisionDebugBuffers(d,l.collisionBoxArray,P.textScaleFactor)},i.ec=ou,i.ed=P0,i.ee=jr,i.ef=TA,i.eg=wM,i.eh=L,i.ei=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==_P){const s=new Uint32Array(l,0,7),[,,c,h,d,m]=s;t=s.byteLength+h+d+m+d,(c!==l.byteLength||t>=l.byteLength)&&Cn("Invalid b3dm header information.")}return bP(l,t)},i.ej=function(l,t){const s=SP(l);for(const c of s){for(const h of c.meshes)P6(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(R6(c.lights,t)))}return s},i.ek=w0,i.el=OI,i.em=mo,i.en=function(l){Lr(),Ir!=null&&Ir.then(t=>{t.keys().then(s=>{for(let c=0;c<s.length-l;c++)t.delete(s[c])})})},i.f=function(l){return l.indexOf("mapbox:")===0},i.g=function(l,t){return uo(gi(l,{method:"GET"}),t)},i.h=de,i.i=function(l){return le.API_STYLE_REGEX.test(l)&&!we(l)},i.j=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(+("0x"+s))))},i.l=gi,i.m=on,i.n=function(l,t){return uo(gi(l,{type:"json"}),t)},i.o=ym,i.p=function(l,t){return uo(gi(l,{method:"POST"}),t)},i.q=ot,i.r=Hi,i.s=function(l){try{const t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=ut,i.u=function(){return function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=Cn,i.x=function(){return t2||(t2=new Qd),t2},i.y=s2,i.z=Sc}),b(["./shared"],function(i){function L(at){const le=at?at.url.toString():void 0;return le?performance.getEntriesByName(le):[]}function O(at){if(typeof at=="number"||typeof at=="boolean"||typeof at=="string"||at==null)return JSON.stringify(at);if(Array.isArray(at)){let de="[";for(const we of at)de+=`${O(we)},`;return`${de}]`}let le="{";for(const de of Object.keys(at).sort())le+=`${de}:${O(at[de])},`;return`${le}}`}function U(at){let le="";for(const de of i.bm)(at.type!=="model"||de!=="minzoom"&&de!=="maxzoom")&&(le+=`/${O(at[de])}`);return le}class q{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,de){this._layerConfigs={},this._layers={},this.update(le,[],de)}update(le,de,we){this._options=we;for(const Pe of le)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=i.cv(Pe,this.scope,null,this._options)).compileFilter(we),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of de)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const De=function(Pe,ze){const tt={};for(let st=0;st<Pe.length;st++){const ut=Pe[st];let ot=ze&&ze[ut.id];!ot&&(ot=U(ut),ut.type==="line"&&ut.paint)&&function jt(Vt){return typeof Vt=="string"&&Vt==="line-progress"||(Array.isArray(Vt)?Vt.some(jt):!(!Vt||typeof Vt!="object")&&Object.values(Vt).some(jt))}(ut.paint["line-width"])&&(ot+=`/${O(ut.paint["line-width"])}`),ze&&(ze[ut.id]=ot);let Mt=tt[ot];Mt||(Mt=tt[ot]=[]),Mt.push(ut)}const Ue=[];for(const st in tt)Ue.push(tt[st]);return Ue}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of De){const ze=Pe.map(Mt=>this._layers[Mt.id]),tt=ze[0];if(tt.visibility==="none")continue;const Ue=tt.source||"";let st=this.familiesBySource[Ue];st||(st=this.familiesBySource[Ue]={});const ut=tt.sourceLayer||"_geojsonTileLayer";let ot=st[ut];ot||(ot=st[ut]=[]),ot.push(ze)}}}const G=1*i.d_;class ie{constructor(le){const de={},we=[];for(const tt in le){const Ue=le[tt],st=de[tt]={};for(const ut in Ue.glyphs){const ot=Ue.glyphs[+ut];if(!ot||ot.bitmap.width===0||ot.bitmap.height===0)continue;const Mt=ot.metrics.localGlyph?G:1,jt={x:0,y:0,w:ot.bitmap.width+2*Mt,h:ot.bitmap.height+2*Mt};we.push(jt),st[ut]=jt}}const{w:De,h:Pe}=i.H(we),ze=new i.dZ({width:De||1,height:Pe||1});for(const tt in le){const Ue=le[tt];for(const st in Ue.glyphs){const ut=Ue.glyphs[+st];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const ot=de[tt][st],Mt=ut.metrics.localGlyph?G:1;i.dZ.copy(ut.bitmap,ze,{x:0,y:0},{x:ot.x+Mt,y:ot.y+Mt},ut.bitmap)}}this.image=ze,this.positions=de}}i.dY(ie,"GlyphAtlas");class J{constructor(le){this.tileID=new i.aH(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.lut=le.lut,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.scope=le.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.request&&le.request.collectResourceTiming,this.promoteId=le.promoteId,this.isSymbolTile=le.isSymbolTile,this.tileTransform=i.aR(le.tileID.canonical,le.projection),this.projection=le.projection,this.worldview=le.worldview,this.localizableLayerIds=le.localizableLayerIds,this.brightness=le.brightness,this.extraShadowCaster=!!le.extraShadowCaster,this.tessellationStep=le.tessellationStep,this.scaleFactor=le.scaleFactor}parse(le,de,we,De,Pe){this.status="parsing",this.data=le,this.collisionBoxArray=new i.aX;const ze=new i.d$(Object.keys(le.layers).sort()),tt=new i.e0(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const Ue={},st=new i.e1(256,256),ut={featureIndex:tt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:st,availableImages:we,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ot=de.familiesBySource[this.source];for(const Lr in ot){const sn=le.layers[Lr];if(!sn)continue;let on=!1,un=!1,Zn=!1;for(const ds of ot[Lr])ds[0].type==="symbol"?on=!0:un=!0,ds[0].is3D()&&ds[0].type!=="model"&&(Zn=!0);if(this.extraShadowCaster&&!Zn||this.isSymbolTile===!0&&!on||this.isSymbolTile===!1&&!un)continue;sn.version===1&&i.w(`Vector tile source "${this.source}" layer "${Lr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ii=ze.encode(Lr),Qi=[];let co=!1;for(let ds=0,Pi=0;ds<sn.length;ds++){const zi=sn.feature(ds),xc=tt.getId(zi,Lr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Lr)){const uo=zi.properties?zi.properties.worldview:null;if(this.worldview&&typeof uo=="string")if(uo==="all")zi.properties.$localized=!0;else{if(!uo.split(",").includes(this.worldview))continue;zi.properties.$localized=!0,zi.properties.worldview=this.worldview}}!co&&zi.properties&&zi.properties.hasOwnProperty(i.e2)&&(co=!0),Qi.push({feature:zi,id:xc,index:Pi,sourceLayerIndex:Ii}),Pi++}co&&!ut.elevationFeatures&&le.layers.hasOwnProperty(i.e3)&&(ut.elevationFeatures=i.e4.parseFrom(le.layers[i.e3],this.canonical));for(const ds of ot[Lr]){const Pi=ds[0];(!this.extraShadowCaster||Pi.is3D()&&Pi.type!=="model")&&(this.isSymbolTile!==void 0&&Pi.type==="symbol"!==this.isSymbolTile||Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(K(ds,this.zoom,ut.brightness,we),(Ue[Pi.id]=Pi.createBucket({index:tt.bucketLayerIDs.length,layers:ds,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ii,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Qi,ut,this.tileID.canonical,this.tileTransform),tt.bucketLayerIDs.push(ds.map(zi=>i.C(zi.id,zi.scope)))))}}let Mt,jt,Vt,yr,Er,Cr;st.trim();const Ir={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},bn=()=>{if(Mt)return this.status="done",Pe(Mt);if(this.extraShadowCaster)this.status="done",Pe(null,{buckets:Object.values(Ue).filter(Lr=>!Lr.isEmpty()),featureIndex:tt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(jt&&Vt&&yr){const Lr=new ie(jt),sn=new Map;for(const[Zn,Ii]of Vt.entries()){const{imagePosition:Qi}=i.e7(Zn,Ii,i.e8);sn.set(Zn,Qi)}const on={};for(const Zn in Ue){const Ii=Ue[Zn];Ii instanceof i.aY&&(K(Ii.layers,this.zoom,ut.brightness,we),on[Zn]=i.e9(Ii,jt,Lr.positions,Vt,sn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const un={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(De,Vt,Er,()=>{un.iconsPending=!1,zn(on,Lr,un)}),this.rasterizeIfNeeded(De,yr,Cr,()=>{un.patternsPending=!1,zn(on,Lr,un)})}},zn=(Lr,sn,on,un)=>{if(on.iconsPending||on.patternsPending)return;const Zn=new i.ea(Vt,yr,this.lut);for(const Ii in Ue){const Qi=Ue[Ii];if(Ii in Lr)i.eb(Qi,Lr[Ii],this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Vt,Zn);else if(Qi.hasPattern&&(Qi instanceof i.b2||Qi instanceof i.b3||Qi instanceof i.d8)){K(Qi.layers,this.zoom,ut.brightness,we);const co=Object.fromEntries(Zn.patternPositions);Qi.addFeatures(ut,this.tileID.canonical,co,we,this.tileTransform,this.brightness)}}this.status="done",Pe(null,{buckets:Object.values(Ue).filter(Ii=>!Ii.isEmpty()),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sn.image,lineAtlas:st,imageAtlas:Zn,brightness:ut.brightness})};if(!this.extraShadowCaster){const Lr=i.e5(ut.glyphDependencies,un=>Object.keys(un).map(Number));Object.keys(Lr).length?De.send("getGlyphs",{uid:this.uid,stacks:Lr,scope:this.scope},(un,Zn)=>{Mt||(Mt=un,jt=Zn,bn())},void 0,!1,Ir):jt={};const sn=Array.from(ut.iconDependencies.keys()).map(un=>i.I.parse(un));sn.length?De.send("getImages",{images:sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(un,Zn)=>{Mt||(Mt=un,Vt=new Map,Er=this.updateImageMapAndGetImageTaskQueue(Vt,Zn,ut.iconDependencies),bn())},void 0,!1,Ir):(Vt=new Map,Er=new Map);const on=Array.from(ut.patternDependencies.keys()).map(un=>i.I.parse(un));on.length?De.send("getImages",{images:on,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(un,Zn)=>{Mt||(Mt=un,yr=new Map,Cr=this.updateImageMapAndGetImageTaskQueue(yr,Zn,ut.patternDependencies),bn())},void 0,!1,Ir):(yr=new Map,Cr=new Map)}if(ut.elevationFeatures&&ut.elevationFeatures.length>0){const Lr=[];for(const on of Object.values(Ue))if(on instanceof i.b3){const un=on.getUnevaluatedPortalGraph();un&&Lr.push(un)}const sn=i.e6.evaluate(Lr);for(const on of Object.values(Ue))on instanceof i.b3&&on.setEvaluatedPortalGraph(sn)}bn()}rasterizeIfNeeded(le,de,we,De){Array.from(de.values()).some(Pe=>Pe.usvg)?this.rasterize(le,de,we,De):De()}updateImageMapAndGetImageTaskQueue(le,de,we){const De=new Map;for(const Pe of de.keys()){const ze=we.get(Pe)||[];for(const tt of ze){const Ue=tt.toString(),st=de.get(tt.id.toString());st.usvg?De.has(Ue)||(De.set(Ue,tt),le.set(Ue,Object.assign({},st))):le.set(Ue,st)}}return De}rasterize(le,de,we,De){this.rasterizeTask=le.send("rasterizeImages",{scope:this.scope,tasks:we},(Pe,ze)=>{if(!Pe)for(const[tt,Ue]of ze.entries()){const st=Object.assign(de.get(tt),{data:Ue});de.set(tt,st)}De()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function K(at,le,de,we){const De=new i.aa(le,{brightness:de});for(const Pe of at)Pe.recalculate(De,we)}class re extends i.E{constructor(le,de,we,De,Pe,ze){super(),this.actor=le,this.layerIndex=de,this.availableImages=we,this.loadVectorData=Pe||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(le.scheduler),this.isSpriteLoaded=De,this.scheduler=le.scheduler,this.brightness=ze}loadTile(le,de){const we=le.uid,De=le&&le.request,Pe=De&&De.collectResourceTiming,ze=this.loading[we]=new J(le);ze.abort=this.loadVectorData(le,(tt,Ue)=>{const st=!this.loading[we];if(delete this.loading[we],ze.cancelRasterize(),st||tt||!Ue)return ze.status="done",st||(this.loaded[we]=ze),de(tt);const ut=Ue.rawData,ot={};Ue.expires&&(ot.expires=Ue.expires),Ue.cacheControl&&(ot.cacheControl=Ue.cacheControl),ze.vectorTile=Ue.vectorTile||new i.ec.VectorTile(new i.bi(ut));const Mt=()=>{ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor,(jt,Vt)=>{if(jt||!Vt)return de(jt);const yr={};if(Pe){const Er=L(De);Er.length>0&&(yr.resourceTiming=JSON.parse(JSON.stringify(Er)))}de(null,i.l({rawTileData:ut.slice(0)},Vt,ot,yr))})};this.isSpriteLoaded?Mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Mt,{type:"parseTile",isSymbolTile:le.isSymbolTile,zoom:le.tileZoom}):Mt()}),this.loaded=this.loaded||{},this.loaded[we]=ze})}reloadTile(le,de){const we=this.loaded,De=le.uid;if(we&&we[De]){const Pe=we[De];Pe.scaleFactor=le.scaleFactor,Pe.showCollisionBoxes=le.showCollisionBoxes,Pe.projection=le.projection,Pe.brightness=le.brightness,Pe.tileTransform=i.aR(le.tileID.canonical,le.projection),Pe.extraShadowCaster=le.extraShadowCaster,Pe.lut=le.lut;const ze=(tt,Ue)=>{const st=Pe.reloadCallback;st&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,st)),de(tt,Ue)};Pe.status==="parsing"?Pe.reloadCallback=ze:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,ze):ze())}else de(null,void 0)}abortTile(le,de){const we=le.uid,De=this.loading[we];De&&(De.abort&&De.abort(),delete this.loading[we]),de()}removeTile(le,de){const we=this.loaded,De=le.uid;we&&we[De]&&delete we[De],de()}}class Q{loadTile(le,de){const{uid:we,encoding:De,rawImageData:Pe,padding:ze}=le,tt=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,ze):Pe;de(null,new i.ed(we,tt,De,ze<1))}reloadTile(le,de){de(null,null)}abortTile(le,de){de()}removeTile(le,de){de()}getImageData(le,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const we=this.offscreenCanvasContext.getImageData(-de,-de,le.width+2*de,le.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}i.bh.setPbf(i.bi);class ee{constructor(le){this._mrt=new i.bh(le.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=le.uid,this.tileID=le.tileID,this.source=le.source}parse(le,de){const we=this._mrt;this.status="parsing",this._entireBuffer=le;try{we.parseHeader(le),this._isHeaderLoaded=!0;const De=[];for(const Pe in we.layers){const ze=we.getLayer(Pe),tt=ze.getDataRange(ze.getBandList()),Ue=we.createDecodingTask(tt),st=le.slice(tt.firstByte,tt.lastByte+1),ut=i.bh.performDecoding(st,Ue).then(ot=>Ue.complete(null,ot)).catch(ot=>Ue.complete(ot,null));De.push(ut)}Promise.allSettled(De).then(()=>de(null,we))}catch(De){de(De)}}}class ue{constructor(le){this.actor=le,this.loading={},this.loaded={}}loadTile(le,de){const we=le.uid,De=le.request,Pe=this.loading[we]=new ee(le),{cancel:ze}=i.bj(De,(tt,Ue,st,ut)=>{const ot=!this.loading[we];if(delete this.loading[we],ot||tt||!Ue)return Pe.status="done",ot||(this.loaded[we]=Pe),de(tt);Pe.parse(Ue,(Mt,jt)=>{if(Mt||!jt)return de(Mt);de(null,jt,st,ut)}),this.loaded[we]=Pe});Pe.abort=ze}reloadTile(le,de){de(null,void 0)}abortTile(le,de){const we=le.uid,De=this.loading[we];De&&(De.abort&&De.abort(),delete this.loading[we]),de()}removeTile(le,de){const we=le.uid;this.loaded[we]&&delete this.loaded[we],de()}decodeRasterArray({task:le,buffer:de},we){i.bh.performDecoding(de,le).then(De=>we(null,De)).catch(De=>we(De))}}const fe=i.ec.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(le){this._feature=le,this.extent=i.ai,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const de of this._feature.geometry)le.push([new i.P(de[0],de[1])]);return le}{const le=[];for(const de of this._feature.geometry){const we=[];for(const De of de)we.push(new i.P(De[0],De[1]));le.push(we)}return le}}toGeoJSON(le,de,we){return fe.call(this,le,de,we)}}class ke{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=le.length,this._features=le}feature(le){return new ge(this._features[le])}}const Ce=64/4096,Be=128;class dt{constructor(){this.features=new Map}clear(){this.features.clear()}load(le=[],de){for(const we of le){const De=we.id;if(De==null)continue;let Pe=this.features.get(De);Pe&&this.updateCache(Pe,de),we.geometry?(Pe=qe(we),this.updateCache(Pe,de),this.features.set(De,Pe)):this.features.delete(De),this.updateCache(Pe,de)}}updateCache(le,de){for(const{canonical:we,uid:De}of Object.values(de)){const{z:Pe,x:ze,y:tt}=we;Qe(le,Math.pow(2,Pe),ze,tt)&&delete de[De]}}getTile(le,de,we){const De=Math.pow(2,le),Pe=[];for(const ze of this.features.values())Qe(ze,De,de,we)&&Pe.push(Ze(ze,De,de,we));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function Qe({minX:at,minY:le,maxX:de,maxY:we},De,Pe,ze){return at<(Pe+1+Ce)/De&&le<(ze+1+Ce)/De&&de>(Pe-Ce)/De&&we>(ze-Ce)/De}function qe(at){const{id:le,geometry:de,properties:we}=at;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Pe}=de,ze={id:le,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},tt=ze.geometry;if(De==="Point")He(Pe,tt,ze);else if(De==="MultiPoint")for(const Ue of Pe)He(Ue,tt,ze);else if(De==="LineString")ze.type=2,et(Pe,tt,ze);else if(De==="MultiLineString")ze.type=2,mt(Pe,tt,ze);else if(De==="Polygon")ze.type=3,mt(Pe,tt,ze,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ze.type=3;for(const Ue of Pe)mt(Ue,tt,ze,!0)}return ze}function He([at,le],de,we){const De=i.av(at);let Pe=i.aC(le);Pe=Pe<0?0:Pe>1?1:Pe,de.push(De,Pe),we.minX=Math.min(we.minX,De),we.minY=Math.min(we.minY,Pe),we.maxX=Math.max(we.maxX,De),we.maxY=Math.max(we.maxY,Pe)}function et(at,le,de,we=!1,De=!1){const Pe=[];for(const ze of at)He(ze,Pe,de);le.push(Pe),we&&function(ze,tt){let Ue=0;for(let st=0,ut=ze.length,ot=ut-2;st<ut;ot=st,st+=2)Ue+=(ze[st]-ze[ot])*(ze[st+1]+ze[ot+1]);if(Ue>0===tt)for(let st=0,ut=ze.length;st<ut/2;st+=2){const ot=ze[st],Mt=ze[st+1];ze[st]=ze[ut-2-st],ze[st+1]=ze[ut-1-st],ze[ut-2-st]=ot,ze[ut-1-st]=Mt}}(Pe,De)}function mt(at,le,de,we=!1){for(let De=0;De<at.length;De++)et(at[De],le,de,we,De===0)}function Ze(at,le,de,we){const{id:De,type:Pe,geometry:ze,tags:tt}=at,Ue=[];if(Pe===1)(function(st,ut,ot,Mt,jt){for(let Vt=0;Vt<st.length;Vt+=2){const yr=Math.round(i.ai*(st[Vt+0]*ut-ot)),Er=Math.round(i.ai*(st[Vt+1]*ut-Mt));jt.push([yr,Er])}})(ze,le,de,we,Ue);else for(const st of ze)Tt(st,le,de,we,Ue);return{id:De,type:Pe,geometry:Ue,tags:tt}}function Tt(at,le,de,we,De){const Pe=-Be,ze=i.ai+Be;let tt;for(let Ue=0;Ue<at.length-2;Ue+=2){let st=Math.round(i.ai*(at[Ue+0]*le-de)),ut=Math.round(i.ai*(at[Ue+1]*le-we)),ot=Math.round(i.ai*(at[Ue+2]*le-de)),Mt=Math.round(i.ai*(at[Ue+3]*le-we));const jt=ot-st,Vt=Mt-ut;st<Pe&&ot<Pe||(st<Pe?(ut+=Math.round(Vt*((Pe-st)/jt)),st=Pe):ot<Pe&&(Mt=ut+Math.round(Vt*((Pe-st)/jt)),ot=Pe),ut<Pe&&Mt<Pe||(ut<Pe?(st+=Math.round(jt*((Pe-ut)/Vt)),ut=Pe):Mt<Pe&&(ot=st+Math.round(jt*((Pe-ut)/Vt)),Mt=Pe),st>=ze&&ot>=ze||(st>=ze?(ut+=Math.round(Vt*((ze-st)/jt)),st=ze):ot>=ze&&(Mt=ut+Math.round(Vt*((ze-st)/jt)),ot=ze),ut>=ze&&Mt>=ze||(ut>=ze?(st+=Math.round(jt*((ze-ut)/Vt)),ut=ze):Mt>=ze&&(ot=st+Math.round(jt*((ze-ut)/Vt)),Mt=ze),tt&&st===tt[tt.length-1][0]&&ut===tt[tt.length-1][1]||(tt=[[st,ut]],De.push(tt)),tt.push([ot,Mt])))))}}var Gt,ct,Je,rt={exports:{}},bt=function(){if(Je)return rt.exports;Je=1;var at=i.eg(),le=function(){if(ct)return Gt;ct=1;var ut=i.ee(),ot=i.ef().VectorTileFeature;function Mt(Vt,yr){this.options=yr||{},this.features=Vt,this.length=Vt.length}function jt(Vt,yr){this.id=typeof Vt.id=="number"?Vt.id:void 0,this.type=Vt.type,this.rawGeometry=Vt.type===1?[Vt.geometry]:Vt.geometry,this.properties=Vt.tags,this.extent=yr||4096}return Gt=Mt,Mt.prototype.feature=function(Vt){return new jt(this.features[Vt],this.options.extent)},jt.prototype.loadGeometry=function(){var Vt=this.rawGeometry;this.geometry=[];for(var yr=0;yr<Vt.length;yr++){for(var Er=Vt[yr],Cr=[],Ir=0;Ir<Er.length;Ir++)Cr.push(new ut(Er[Ir][0],Er[Ir][1]));this.geometry.push(Cr)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Vt=this.geometry,yr=1/0,Er=-1/0,Cr=1/0,Ir=-1/0,bn=0;bn<Vt.length;bn++)for(var zn=Vt[bn],Lr=0;Lr<zn.length;Lr++){var sn=zn[Lr];yr=Math.min(yr,sn.x),Er=Math.max(Er,sn.x),Cr=Math.min(Cr,sn.y),Ir=Math.max(Ir,sn.y)}return[yr,Cr,Er,Ir]},jt.prototype.toGeoJSON=ot.prototype.toGeoJSON,Gt}();function de(ut){var ot=new at;return function(Mt,jt){for(var Vt in Mt.layers)jt.writeMessage(3,we,Mt.layers[Vt])}(ut,ot),ot.finish()}function we(ut,ot){var Mt;ot.writeVarintField(15,ut.version||1),ot.writeStringField(1,ut.name||""),ot.writeVarintField(5,ut.extent||4096);var jt={keys:[],values:[],keycache:{},valuecache:{}};for(Mt=0;Mt<ut.length;Mt++)jt.feature=ut.feature(Mt),ot.writeMessage(2,De,jt);var Vt=jt.keys;for(Mt=0;Mt<Vt.length;Mt++)ot.writeStringField(3,Vt[Mt]);var yr=jt.values;for(Mt=0;Mt<yr.length;Mt++)ot.writeMessage(4,st,yr[Mt])}function De(ut,ot){var Mt=ut.feature;Mt.id!==void 0&&ot.writeVarintField(1,Mt.id),ot.writeMessage(2,Pe,ut),ot.writeVarintField(3,Mt.type),ot.writeMessage(4,Ue,Mt)}function Pe(ut,ot){var Mt=ut.feature,jt=ut.keys,Vt=ut.values,yr=ut.keycache,Er=ut.valuecache;for(var Cr in Mt.properties){var Ir=Mt.properties[Cr],bn=yr[Cr];if(Ir!==null){bn===void 0&&(jt.push(Cr),yr[Cr]=bn=jt.length-1),ot.writeVarint(bn);var zn=typeof Ir;zn!=="string"&&zn!=="boolean"&&zn!=="number"&&(Ir=JSON.stringify(Ir));var Lr=zn+":"+Ir,sn=Er[Lr];sn===void 0&&(Vt.push(Ir),Er[Lr]=sn=Vt.length-1),ot.writeVarint(sn)}}}function ze(ut,ot){return(ot<<3)+(7&ut)}function tt(ut){return ut<<1^ut>>31}function Ue(ut,ot){for(var Mt=ut.loadGeometry(),jt=ut.type,Vt=0,yr=0,Er=Mt.length,Cr=0;Cr<Er;Cr++){var Ir=Mt[Cr],bn=1;jt===1&&(bn=Ir.length),ot.writeVarint(ze(1,bn));for(var zn=jt===3?Ir.length-1:Ir.length,Lr=0;Lr<zn;Lr++){Lr===1&&jt!==1&&ot.writeVarint(ze(2,zn-1));var sn=Ir[Lr].x-Vt,on=Ir[Lr].y-yr;ot.writeVarint(tt(sn)),ot.writeVarint(tt(on)),Vt+=sn,yr+=on}jt===3&&ot.writeVarint(ze(7,1))}}function st(ut,ot){var Mt=typeof ut;Mt==="string"?ot.writeStringField(1,ut):Mt==="boolean"?ot.writeBooleanField(7,ut):Mt==="number"&&(ut%1!=0?ot.writeDoubleField(3,ut):ut<0?ot.writeSVarintField(6,ut):ot.writeVarintField(5,ut))}return rt.exports=de,rt.exports.fromVectorTileJs=de,rt.exports.fromGeojsonVt=function(ut,ot){ot=ot||{};var Mt={};for(var jt in ut)Mt[jt]=new le(ut[jt].features,ot),Mt[jt].name=jt,Mt[jt].version=ot.version,Mt[jt].extent=ot.extent;return de({layers:Mt})},rt.exports.GeoJSONWrapper=le,rt.exports}(),kt=i.eh(bt);const At={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:at=>at},_r=Math.fround||(cn=new Float32Array(1),at=>(cn[0]=+at,cn[0]));var cn;const pr=3,Dt=5,ir=6;class zr{constructor(le){this.options=Object.assign(Object.create(At),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:de,minZoom:we,maxZoom:De}=this.options;de&&console.time("total time");const Pe=`prepare ${le.length} points`;de&&console.time(Pe),this.points=le;const ze=[];for(let Ue=0;Ue<le.length;Ue++){const st=le[Ue];if(!st.geometry)continue;const[ut,ot]=st.geometry.coordinates,Mt=_r(Ht(ut)),jt=_r(jr(ot));ze.push(Mt,jt,1/0,Ue,-1,1),this.options.reduce&&ze.push(0)}let tt=this.trees[De+1]=this._createTree(ze);de&&console.timeEnd(Pe);for(let Ue=De;Ue>=we;Ue--){const st=+Date.now();tt=this.trees[Ue]=this._createTree(this._cluster(tt,Ue)),de&&console.log("z%d: %d clusters in %dms",Ue,tt.numItems,+Date.now()-st)}return de&&console.timeEnd("total time"),this}getClusters(le,de){let we=((le[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,le[1]));let Pe=le[2]===180?180:((le[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)we=-180,Pe=180;else if(we>Pe){const ot=this.getClusters([we,De,180,ze],de),Mt=this.getClusters([-180,De,Pe,ze],de);return ot.concat(Mt)}const tt=this.trees[this._limitZoom(de)],Ue=tt.range(Ht(we),jr(ze),Ht(Pe),jr(De)),st=tt.data,ut=[];for(const ot of Ue){const Mt=this.stride*ot;ut.push(st[Mt+Dt]>1?he(st,Mt,this.clusterProps):this.points[st[Mt+pr]])}return ut}getChildren(le){const de=this._getOriginId(le),we=this._getOriginZoom(le),De="No cluster with the specified id.",Pe=this.trees[we];if(!Pe)throw new Error(De);const ze=Pe.data;if(de*this.stride>=ze.length)throw new Error(De);const tt=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Ue=Pe.within(ze[de*this.stride],ze[de*this.stride+1],tt),st=[];for(const ut of Ue){const ot=ut*this.stride;ze[ot+4]===le&&st.push(ze[ot+Dt]>1?he(ze,ot,this.clusterProps):this.points[ze[ot+pr]])}if(st.length===0)throw new Error(De);return st}getLeaves(le,de,we){const De=[];return this._appendLeaves(De,le,de=de||10,we=we||0,0),De}getTile(le,de,we){const De=this.trees[this._limitZoom(le)],Pe=Math.pow(2,le),{extent:ze,radius:tt}=this.options,Ue=tt/ze,st=(we-Ue)/Pe,ut=(we+1+Ue)/Pe,ot={features:[]};return this._addTileFeatures(De.range((de-Ue)/Pe,st,(de+1+Ue)/Pe,ut),De.data,de,we,Pe,ot),de===0&&this._addTileFeatures(De.range(1-Ue/Pe,st,1,ut),De.data,Pe,we,Pe,ot),de===Pe-1&&this._addTileFeatures(De.range(0,st,Ue/Pe,ut),De.data,-1,we,Pe,ot),ot.features.length?ot:null}getClusterExpansionZoom(le){let de=this._getOriginZoom(le)-1;for(;de<=this.options.maxZoom;){const we=this.getChildren(le);if(de++,we.length!==1)break;le=we[0].properties.cluster_id}return de}_appendLeaves(le,de,we,De,Pe){const ze=this.getChildren(de);for(const tt of ze){const Ue=tt.properties;if(Ue&&Ue.cluster?Pe+Ue.point_count<=De?Pe+=Ue.point_count:Pe=this._appendLeaves(le,Ue.cluster_id,we,De,Pe):Pe<De?Pe++:le.push(tt),le.length===we)break}return Pe}_createTree(le){const de=new i.bE(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<le.length;we+=this.stride)de.add(le[we],le[we+1]);return de.finish(),de.data=le,de}_addTileFeatures(le,de,we,De,Pe,ze){for(const tt of le){const Ue=tt*this.stride,st=de[Ue+Dt]>1;let ut,ot,Mt;if(st)ut=br(de,Ue,this.clusterProps),ot=de[Ue],Mt=de[Ue+1];else{const yr=this.points[de[Ue+pr]];ut=yr.properties;const[Er,Cr]=yr.geometry.coordinates;ot=Ht(Er),Mt=jr(Cr)}const jt={type:1,geometry:[[Math.round(this.options.extent*(ot*Pe-we)),Math.round(this.options.extent*(Mt*Pe-De))]],tags:ut};let Vt;Vt=st||this.options.generateId?de[Ue+pr]:this.points[de[Ue+pr]].id,Vt!==void 0&&(jt.id=Vt),ze.features.push(jt)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,de){const{radius:we,extent:De,reduce:Pe,minPoints:ze}=this.options,tt=we/(De*Math.pow(2,de)),Ue=le.data,st=[],ut=this.stride;for(let ot=0;ot<Ue.length;ot+=ut){if(Ue[ot+2]<=de)continue;Ue[ot+2]=de;const Mt=Ue[ot],jt=Ue[ot+1],Vt=le.within(Ue[ot],Ue[ot+1],tt),yr=Ue[ot+Dt];let Er=yr;for(const Cr of Vt){const Ir=Cr*ut;Ue[Ir+2]>de&&(Er+=Ue[Ir+Dt])}if(Er>yr&&Er>=ze){let Cr,Ir=Mt*yr,bn=jt*yr,zn=-1;const Lr=(ot/ut<<5)+(de+1)+this.points.length;for(const sn of Vt){const on=sn*ut;if(Ue[on+2]<=de)continue;Ue[on+2]=de;const un=Ue[on+Dt];Ir+=Ue[on]*un,bn+=Ue[on+1]*un,Ue[on+4]=Lr,Pe&&(Cr||(Cr=this._map(Ue,ot,!0),zn=this.clusterProps.length,this.clusterProps.push(Cr)),Pe(Cr,this._map(Ue,on)))}Ue[ot+4]=Lr,st.push(Ir/Er,bn/Er,1/0,Lr,-1,Er),Pe&&st.push(zn)}else{for(let Cr=0;Cr<ut;Cr++)st.push(Ue[ot+Cr]);if(Er>1)for(const Cr of Vt){const Ir=Cr*ut;if(!(Ue[Ir+2]<=de)){Ue[Ir+2]=de;for(let bn=0;bn<ut;bn++)st.push(Ue[Ir+bn])}}}}return st}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,de,we){if(le[de+Dt]>1){const ze=this.clusterProps[le[de+ir]];return we?Object.assign({},ze):ze}const De=this.points[le[de+pr]].properties,Pe=this.options.map(De);return we&&Pe===De?Object.assign({},Pe):Pe}}function he(at,le,de){return{type:"Feature",id:at[le+pr],properties:br(at,le,de),geometry:{type:"Point",coordinates:[(we=at[le],360*(we-.5)),wt(at[le+1])]}};var we}function br(at,le,de){const we=at[le+Dt],De=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Pe=at[le+ir],ze=Pe===-1?{}:Object.assign({},de[Pe]);return Object.assign(ze,{cluster:!0,cluster_id:at[le+pr],point_count:we,point_count_abbreviated:De})}function Ht(at){return at/360+.5}function jr(at){const le=Math.sin(at*Math.PI/180),de=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return de<0?0:de>1?1:de}function wt(at){const le=(180-360*at)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function dn(at,le,de,we){let De=we;const Pe=le+(de-le>>1);let ze,tt=de-le;const Ue=at[le],st=at[le+1],ut=at[de],ot=at[de+1];for(let Mt=le+3;Mt<de;Mt+=3){const jt=rn(at[Mt],at[Mt+1],Ue,st,ut,ot);if(jt>De)ze=Mt,De=jt;else if(jt===De){const Vt=Math.abs(Mt-Pe);Vt<tt&&(ze=Mt,tt=Vt)}}De>we&&(ze-le>3&&dn(at,le,ze,we),at[ze+2]=De,de-ze>3&&dn(at,ze,de,we))}function rn(at,le,de,we,De,Pe){let ze=De-de,tt=Pe-we;if(ze!==0||tt!==0){const Ue=((at-de)*ze+(le-we)*tt)/(ze*ze+tt*tt);Ue>1?(de=De,we=Pe):Ue>0&&(de+=ze*Ue,we+=tt*Ue)}return ze=at-de,tt=le-we,ze*ze+tt*tt}function Vn(at,le,de,we){const De={id:at??null,type:le,geometry:de,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(le==="Point"||le==="MultiPoint"||le==="LineString")wr(De,de);else if(le==="Polygon")wr(De,de[0]);else if(le==="MultiLineString")for(const Pe of de)wr(De,Pe);else if(le==="MultiPolygon")for(const Pe of de)wr(De,Pe[0]);return De}function wr(at,le){for(let de=0;de<le.length;de+=3)at.minX=Math.min(at.minX,le[de]),at.minY=Math.min(at.minY,le[de+1]),at.maxX=Math.max(at.maxX,le[de]),at.maxY=Math.max(at.maxY,le[de+1])}function Hr(at,le,de,we){if(!le.geometry)return;const De=le.geometry.coordinates;if(De&&De.length===0)return;const Pe=le.geometry.type,ze=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let tt=[],Ue=le.id;if(de.promoteId?Ue=le.properties[de.promoteId]:de.generateId&&(Ue=we||0),Pe==="Point")Yn(De,tt);else if(Pe==="MultiPoint")for(const st of De)Yn(st,tt);else if(Pe==="LineString")ys(De,tt,ze,!1);else if(Pe==="MultiLineString"){if(de.lineMetrics){for(const st of De)tt=[],ys(st,tt,ze,!1),at.push(Vn(Ue,"LineString",tt,le.properties));return}vs(De,tt,ze,!1)}else if(Pe==="Polygon")vs(De,tt,ze,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const st of le.geometry.geometries)Hr(at,{id:Ue,geometry:st,properties:le.properties},de,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const st of De){const ut=[];vs(st,ut,ze,!0),tt.push(ut)}}at.push(Vn(Ue,Pe,tt,le.properties))}function Yn(at,le){le.push(xs(at[0]),Tr(at[1]),0)}function ys(at,le,de,we){let De,Pe,ze=0;for(let Ue=0;Ue<at.length;Ue++){const st=xs(at[Ue][0]),ut=Tr(at[Ue][1]);le.push(st,ut,0),Ue>0&&(ze+=we?(De*ut-st*Pe)/2:Math.sqrt(Math.pow(st-De,2)+Math.pow(ut-Pe,2))),De=st,Pe=ut}const tt=le.length-3;le[2]=1,dn(le,0,tt,de),le[tt+2]=1,le.size=Math.abs(ze),le.start=0,le.end=le.size}function vs(at,le,de,we){for(let De=0;De<at.length;De++){const Pe=[];ys(at[De],Pe,de,we),le.push(Pe)}}function xs(at){return at/360+.5}function Tr(at){const le=Math.sin(at*Math.PI/180),de=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return de<0?0:de>1?1:de}function mi(at,le,de,we,De,Pe,ze,tt){if(we/=le,Pe>=(de/=le)&&ze<we)return at;if(ze<de||Pe>=we)return null;const Ue=[];for(const st of at){const ut=st.geometry;let ot=st.type;const Mt=De===0?st.minX:st.minY,jt=De===0?st.maxX:st.maxY;if(Mt>=de&&jt<we){Ue.push(st);continue}if(jt<de||Mt>=we)continue;let Vt=[];if(ot==="Point"||ot==="MultiPoint")Is(ut,Vt,de,we,De);else if(ot==="LineString")Yi(ut,Vt,de,we,De,!1,tt.lineMetrics);else if(ot==="MultiLineString")Mi(ut,Vt,de,we,De,!1);else if(ot==="Polygon")Mi(ut,Vt,de,we,De,!0);else if(ot==="MultiPolygon")for(const yr of ut){const Er=[];Mi(yr,Er,de,we,De,!0),Er.length&&Vt.push(Er)}if(Vt.length){if(tt.lineMetrics&&ot==="LineString"){for(const yr of Vt)Ue.push(Vn(st.id,ot,yr,st.tags));continue}ot!=="LineString"&&ot!=="MultiLineString"||(Vt.length===1?(ot="LineString",Vt=Vt[0]):ot="MultiLineString"),ot!=="Point"&&ot!=="MultiPoint"||(ot=Vt.length===3?"Point":"MultiPoint"),Ue.push(Vn(st.id,ot,Vt,st.tags))}}return Ue.length?Ue:null}function Is(at,le,de,we,De){for(let Pe=0;Pe<at.length;Pe+=3){const ze=at[Pe+De];ze>=de&&ze<=we&&ui(le,at[Pe],at[Pe+1],at[Pe+2])}}function Yi(at,le,de,we,De,Pe,ze){let tt=gi(at);const Ue=De===0?Ao:ao;let st,ut,ot=at.start;for(let Er=0;Er<at.length-3;Er+=3){const Cr=at[Er],Ir=at[Er+1],bn=at[Er+2],zn=at[Er+3],Lr=at[Er+4],sn=De===0?Cr:Ir,on=De===0?zn:Lr;let un=!1;ze&&(st=Math.sqrt(Math.pow(Cr-zn,2)+Math.pow(Ir-Lr,2))),sn<de?on>de&&(ut=Ue(tt,Cr,Ir,zn,Lr,de),ze&&(tt.start=ot+st*ut)):sn>we?on<we&&(ut=Ue(tt,Cr,Ir,zn,Lr,we),ze&&(tt.start=ot+st*ut)):ui(tt,Cr,Ir,bn),on<de&&sn>=de&&(ut=Ue(tt,Cr,Ir,zn,Lr,de),un=!0),on>we&&sn<=we&&(ut=Ue(tt,Cr,Ir,zn,Lr,we),un=!0),!Pe&&un&&(ze&&(tt.end=ot+st*ut),le.push(tt),tt=gi(at)),ze&&(ot+=st)}let Mt=at.length-3;const jt=at[Mt],Vt=at[Mt+1],yr=De===0?jt:Vt;yr>=de&&yr<=we&&ui(tt,jt,Vt,at[Mt+2]),Mt=tt.length-3,Pe&&Mt>=3&&(tt[Mt]!==tt[0]||tt[Mt+1]!==tt[1])&&ui(tt,tt[0],tt[1],tt[2]),tt.length&&le.push(tt)}function gi(at){const le=[];return le.size=at.size,le.start=at.start,le.end=at.end,le}function Mi(at,le,de,we,De,Pe){for(const ze of at)Yi(ze,le,de,we,De,Pe,!1)}function ui(at,le,de,we){at.push(le,de,we)}function Ao(at,le,de,we,De,Pe){const ze=(Pe-le)/(we-le);return ui(at,Pe,de+(De-de)*ze,1),ze}function ao(at,le,de,we,De,Pe){const ze=(Pe-de)/(De-de);return ui(at,le+(we-le)*ze,Pe,1),ze}function bs(at,le){const de=[];for(let we=0;we<at.length;we++){const De=at[we],Pe=De.type;let ze;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")ze=$s(De.geometry,le);else if(Pe==="MultiLineString"||Pe==="Polygon"){ze=[];for(const tt of De.geometry)ze.push($s(tt,le))}else if(Pe==="MultiPolygon"){ze=[];for(const tt of De.geometry){const Ue=[];for(const st of tt)Ue.push($s(st,le));ze.push(Ue)}}de.push(Vn(De.id,Pe,ze,De.tags))}return de}function $s(at,le){const de=[];de.size=at.size,at.start!==void 0&&(de.start=at.start,de.end=at.end);for(let we=0;we<at.length;we+=3)de.push(at[we]+le,at[we+1],at[we+2]);return de}function Oi(at,le){if(at.transformed)return at;const de=1<<at.z,we=at.x,De=at.y;for(const Pe of at.features){const ze=Pe.geometry,tt=Pe.type;if(Pe.geometry=[],tt===1)for(let Ue=0;Ue<ze.length;Ue+=2)Pe.geometry.push(Ji(ze[Ue],ze[Ue+1],le,de,we,De));else for(let Ue=0;Ue<ze.length;Ue++){const st=[];for(let ut=0;ut<ze[Ue].length;ut+=2)st.push(Ji(ze[Ue][ut],ze[Ue][ut+1],le,de,we,De));Pe.geometry.push(st)}}return at.transformed=!0,at}function Ji(at,le,de,we,De,Pe){return[Math.round(de*(at*we-De)),Math.round(de*(le*we-Pe))]}function Cn(at,le,de,we,De){const Pe=le===De.maxZoom?0:De.tolerance/((1<<le)*De.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:at.length,source:null,x:de,y:we,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of at)sr(ze,tt,Pe,De);return ze}function sr(at,le,de,we){const De=le.geometry,Pe=le.type,ze=[];if(at.minX=Math.min(at.minX,le.minX),at.minY=Math.min(at.minY,le.minY),at.maxX=Math.max(at.maxX,le.maxX),at.maxY=Math.max(at.maxY,le.maxY),Pe==="Point"||Pe==="MultiPoint")for(let tt=0;tt<De.length;tt+=3)ze.push(De[tt],De[tt+1]),at.numPoints++,at.numSimplified++;else if(Pe==="LineString")An(ze,De,at,de,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let tt=0;tt<De.length;tt++)An(ze,De[tt],at,de,Pe==="Polygon",tt===0);else if(Pe==="MultiPolygon")for(let tt=0;tt<De.length;tt++){const Ue=De[tt];for(let st=0;st<Ue.length;st++)An(ze,Ue[st],at,de,!0,st===0)}if(ze.length){let tt=le.tags||null;if(Pe==="LineString"&&we.lineMetrics){tt={};for(const st in le.tags)tt[st]=le.tags[st];tt.mapbox_clip_start=De.start/De.size,tt.mapbox_clip_end=De.end/De.size}const Ue={geometry:ze,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:tt};le.id!==null&&(Ue.id=le.id),at.features.push(Ue)}}function An(at,le,de,we,De,Pe){const ze=we*we;if(we>0&&le.size<(De?ze:we))return void(de.numPoints+=le.length/3);const tt=[];for(let Ue=0;Ue<le.length;Ue+=3)(we===0||le[Ue+2]>ze)&&(de.numSimplified++,tt.push(le[Ue],le[Ue+1])),de.numPoints++;De&&function(Ue,st){let ut=0;for(let ot=0,Mt=Ue.length,jt=Mt-2;ot<Mt;jt=ot,ot+=2)ut+=(Ue[ot]-Ue[jt])*(Ue[ot+1]+Ue[jt+1]);if(ut>0===st)for(let ot=0,Mt=Ue.length;ot<Mt/2;ot+=2){const jt=Ue[ot],Vt=Ue[ot+1];Ue[ot]=Ue[Mt-2-ot],Ue[ot+1]=Ue[Mt-1-ot],Ue[Mt-2-ot]=jt,Ue[Mt-1-ot]=Vt}}(tt,Pe),at.push(tt)}const vn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class jn{constructor(le,de){const we=(de=this.options=function(Pe,ze){for(const tt in ze)Pe[tt]=ze[tt];return Pe}(Object.create(vn),de)).debug;if(we&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Pe,ze){const tt=[];if(Pe.type==="FeatureCollection")for(let Ue=0;Ue<Pe.features.length;Ue++)Hr(tt,Pe.features[Ue],ze,Ue);else Hr(tt,Pe.type==="Feature"?Pe:{geometry:Pe},ze);return tt}(le,de);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Pe,ze){const tt=ze.buffer/ze.extent;let Ue=Pe;const st=mi(Pe,1,-1-tt,tt,0,-1,2,ze),ut=mi(Pe,1,1-tt,2+tt,0,-1,2,ze);return(st||ut)&&(Ue=mi(Pe,1,-tt,1+tt,0,-1,2,ze)||[],st&&(Ue=bs(st,1).concat(Ue)),ut&&(Ue=Ue.concat(bs(ut,-1)))),Ue}(De,de),De.length&&this.splitTile(De,0,0,0),we&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,de,we,De,Pe,ze,tt){const Ue=[le,de,we,De],st=this.options,ut=st.debug;for(;Ue.length;){De=Ue.pop(),we=Ue.pop(),de=Ue.pop(),le=Ue.pop();const ot=1<<de,Mt=_i(de,we,De);let jt=this.tiles[Mt];if(!jt&&(ut>1&&console.time("creation"),jt=this.tiles[Mt]=Cn(le,de,we,De,st),this.tileCoords.push({z:de,x:we,y:De}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,we,De,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));const un=`z${de}`;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(jt.source=le,Pe==null){if(de===st.indexMaxZoom||jt.numPoints<=st.indexMaxPoints)continue}else{if(de===st.maxZoom||de===Pe)continue;if(Pe!=null){const un=Pe-de;if(we!==ze>>un||De!==tt>>un)continue}}if(jt.source=null,le.length===0)continue;ut>1&&console.time("clipping");const Vt=.5*st.buffer/st.extent,yr=.5-Vt,Er=.5+Vt,Cr=1+Vt;let Ir=null,bn=null,zn=null,Lr=null,sn=mi(le,ot,we-Vt,we+Er,0,jt.minX,jt.maxX,st),on=mi(le,ot,we+yr,we+Cr,0,jt.minX,jt.maxX,st);le=null,sn&&(Ir=mi(sn,ot,De-Vt,De+Er,1,jt.minY,jt.maxY,st),bn=mi(sn,ot,De+yr,De+Cr,1,jt.minY,jt.maxY,st),sn=null),on&&(zn=mi(on,ot,De-Vt,De+Er,1,jt.minY,jt.maxY,st),Lr=mi(on,ot,De+yr,De+Cr,1,jt.minY,jt.maxY,st),on=null),ut>1&&console.timeEnd("clipping"),Ue.push(Ir||[],de+1,2*we,2*De),Ue.push(bn||[],de+1,2*we,2*De+1),Ue.push(zn||[],de+1,2*we+1,2*De),Ue.push(Lr||[],de+1,2*we+1,2*De+1)}}getTile(le,de,we){le=+le,de=+de,we=+we;const De=this.options,{extent:Pe,debug:ze}=De;if(le<0||le>24)return null;const tt=1<<le,Ue=_i(le,de=de+tt&tt-1,we);if(this.tiles[Ue])return Oi(this.tiles[Ue],Pe);ze>1&&console.log("drilling down to z%d-%d-%d",le,de,we);let st,ut=le,ot=de,Mt=we;for(;!st&&ut>0;)ut--,ot>>=1,Mt>>=1,st=this.tiles[_i(ut,ot,Mt)];return st&&st.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",ut,ot,Mt),console.time("drilling down")),this.splitTile(st.source,ut,ot,Mt,le,de,we),ze>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Oi(this.tiles[Ue],Pe):null):null}}function _i(at,le,de){return 32*((1<<at)*de+le)+at}function lo(at,le){const de=at.tileID.canonical;if(!this._geoJSONIndex)return void le(null,null);const we=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!we)return void le(null,null);const De=new ke(we.features);let Pe=kt(De);Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),le(null,{vectorTile:De,rawData:Pe.buffer})}class Mo extends re{constructor(le,de,we,De,Pe,ze){super(le,de,we,De,lo,ze),Pe&&(this.loadGeoJSON=Pe),this._dynamicIndex=new dt}loadData(le,de){const we=le&&le.request,De=we&&we.collectResourceTiming;this.loadGeoJSON(le,(Pe,ze)=>{if(Pe||!ze)return de(Pe);if(typeof ze!="object")return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{try{if(le.filter){const Ue=i.X(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(st=>`${st.key}: ${st.message}`).join(", "));ze.features=ze.features.filter(st=>Ue.value.evaluate({zoom:0},st))}le.dynamic?(ze.type==="Feature"&&(ze={type:"FeatureCollection",features:[ze]}),le.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ze.features,this.loaded),le.cluster&&(ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=le.cluster?new zr(function({superclusterOptions:Ue,clusterProperties:st}){if(!st||!Ue)return Ue;const ut={},ot={},Mt={accumulated:null,zoom:0},jt={properties:null},Vt=Object.keys(st);for(const yr of Vt){const[Er,Cr]=st[yr],Ir=i.X(Cr),bn=i.X(typeof Er=="string"?[Er,["accumulated"],["get",yr]]:Er);ut[yr]=Ir.value,ot[yr]=bn.value}return Ue.map=yr=>{jt.properties=yr;const Er={};for(const Cr of Vt)Er[Cr]=ut[Cr].evaluate(Mt,jt);return Er},Ue.reduce=(yr,Er)=>{jt.properties=Er;for(const Cr of Vt)Mt.accumulated=yr[Cr],yr[Cr]=ot[Cr].evaluate(Mt,jt)},Ue}(le)).load(ze.features):le.dynamic?this._dynamicIndex:function(Ue,st){return new jn(Ue,st)}(ze,le.geojsonVtOptions)}catch(Ue){return de(Ue)}const tt={};if(De){const Ue=L(we);Ue&&(tt.resourceTiming={},tt.resourceTiming[le.source]=JSON.parse(JSON.stringify(Ue)))}de(null,tt)}})}reloadTile(le,de){const we=this.loaded;return we&&we[le.uid]?le.partial?de(null,void 0):super.reloadTile(le,de):this.loadTile(le,de)}loadGeoJSON(le,de){if(le.request)i.n(le.request,de);else{if(typeof le.data!="string")return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(le.data))}catch{return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(we){de(we)}}getClusterChildren(le,de){try{de(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(we){de(we)}}getClusterLeaves(le,de){try{de(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(we){de(we)}}}class vc{constructor(le,de){this.tileID=new i.aH(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=de}parse(le,de,we,De){this.status="parsing";const Pe=new i.aH(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),ze=[],tt=de.familiesBySource[we.source],Ue=new i.e0(Pe,we.promoteId);return Ue.bucketLayerIDs=[],Ue.is3DTile=!0,i.ei(le).then(st=>{if(!st)return De(new Error("Could not parse tile"));const ut=i.ej(st,1/i.cd(we.tileID.canonical)),ot=st.json.extensionsUsed&&st.json.extensionsUsed.includes("MAPBOX_mesh_features")||st.json.asset.extras&&st.json.asset.extras.MAPBOX_mesh_features,Mt=st.json.extensionsUsed&&st.json.extensionsUsed.includes("EXT_meshopt_compression"),jt=new i.aa(this.zoom,{brightness:this.brightness});for(const Vt in tt)for(const yr of tt[Vt]){const Er=yr[0];Ue.bucketLayerIDs.push(yr.map(Ir=>i.C(Ir.id,Ir.scope))),Er.recalculate(jt,[]);const Cr=new i.ek(yr,ut,Pe,ot,Mt,this.brightness,Ue);ot||(Cr.needsUpload=!0),ze.push(Cr),Cr.evaluate(Er)}this.status="done",De(null,{buckets:ze,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(st=>De(new Error(st.message)))}}class $h{constructor(le,de,we,De,Pe,ze){this.actor=le,this.layerIndex=de,this.availableImages=we,this.brightness=ze,this.loading={},this.loaded={}}loadTile(le,de){const we=le.uid,De=this.loading[we]=new vc(le,this.brightness);i.bj(le.request,(Pe,ze)=>{const tt=!this.loading[we];return delete this.loading[we],tt||Pe?(De.status="done",tt||(this.loaded[we]=De),de(Pe)):ze&&ze.byteLength!==0?void De.parse(ze,this.layerIndex,le,(Ue,st)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[we]=De,Ue||!st?de(Ue):de(null,st)}):(De.status="done",this.loaded[we]=De,de())})}reloadTile(le,de){const we=this.loaded,De=le.uid;if(we&&we[De]){const Pe=we[De];Pe.projection=le.projection,Pe.brightness=le.brightness;const ze=(tt,Ue)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(le,de)),de(tt,Ue)};Pe.status==="parsing"?Pe.reloadCallback=ze:Pe.status==="done"&&this.loadTile(le,de)}}abortTile(le,de){const we=le.uid;this.loading[we]&&delete this.loading[we],de()}removeTile(le,de){const we=this.loaded,De=le.uid;we&&we[De]&&delete we[De],de()}}class dd{constructor(le){this.self=le,this.actor=new i.el(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:re,geojson:Mo,"raster-dem":Q,"raster-array":ue,"batched-model":$h},this.workerSources={},this.self.registerWorkerSource=(de,we)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=we},this.self.registerRTLTextPlugin=de=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=de.applyArabicShaping,i.em.processBidirectionalText=de.processBidirectionalText,i.em.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(le,de,we){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],we()}checkIfReady(le,de,we){we()}setReferrer(le,de){this.referrer=de}spriteLoaded(le,{scope:de,isLoaded:we}){if(this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.isSpriteLoaded[le][de]=we,this.workerSources[le]&&this.workerSources[le][de])for(const De in this.workerSources[le][de]){const Pe=this.workerSources[le][de][De];for(const ze in Pe){const tt=Pe[ze];tt instanceof re&&(tt.isSpriteLoaded=we,tt.fire(new i.A("isSpriteLoaded")))}}}setImages(le,{scope:de,images:we},De){if(this.availableImages[le]||(this.availableImages[le]={}),this.availableImages[le][de]=we,this.workerSources[le]&&this.workerSources[le][de]){for(const Pe in this.workerSources[le][de]){const ze=this.workerSources[le][de][Pe];for(const tt in ze)ze[tt].availableImages=we}De()}else De()}setProjection(le,de){this.projections[le]=i.bP(de)}setBrightness(le,de,we){this.brightness=de,we()}setLayers(le,de,we){this.getLayerIndex(le,de.scope).replace(de.layers,de.options),we()}updateLayers(le,de,we){this.getLayerIndex(le,de.scope).update(de.layers,de.removedIds,de.options),we()}loadTile(le,de,we){de.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,de.type,de.source,de.scope).loadTile(de,we)}decodeRasterArray(le,de,we){this.getWorkerSource(le,de.type,de.source,de.scope).decodeRasterArray(de,we)}reloadTile(le,de,we){de.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,de.type,de.source,de.scope).reloadTile(de,we)}abortTile(le,de,we){this.getWorkerSource(le,de.type,de.source,de.scope).abortTile(de,we)}removeTile(le,de,we){this.getWorkerSource(le,de.type,de.source,de.scope).removeTile(de,we)}removeSource(le,de,we){if(!(this.workerSources[le]&&this.workerSources[le][de.scope]&&this.workerSources[le][de.scope][de.type]&&this.workerSources[le][de.scope][de.type][de.source]))return;const De=this.workerSources[le][de.scope][de.type][de.source];delete this.workerSources[le][de.scope][de.type][de.source],De.removeSource!==void 0?De.removeSource(de,we):we()}loadWorkerSource(le,de,we){try{this.self.importScripts(de.url),we()}catch(De){we(De.toString())}}syncRTLPluginState(le,de,we){try{i.em.setState(de);const De=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&De!=null){this.self.importScripts(De);const Pe=i.em.isParsed();we(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${De}`),Pe)}}catch(De){we(De.toString())}}setDracoUrl(le,de){this.dracoUrl=de}getAvailableImages(le,de){this.availableImages[le]||(this.availableImages[le]={});let we=this.availableImages[le][de];return we||(we=[]),we}getLayerIndex(le,de){this.layerIndexes[le]||(this.layerIndexes[le]={});let we=this.layerIndexes[le][de];return we||(we=this.layerIndexes[le][de]=new q,we.scope=de),we}getWorkerSource(le,de,we,De){const Pe=this.workerSources;return Pe[le]||(Pe[le]={}),Pe[le][De]||(Pe[le][De]={}),Pe[le][De][de]||(Pe[le][De][de]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),Pe[le][De][de][we]||(Pe[le][De][de][we]=new this.workerSourceTypes[de]({send:(ze,tt,Ue,st,ut,ot)=>{this.actor.send(ze,tt,Ue,le,ut,ot)},scheduler:this.actor.scheduler},this.getLayerIndex(le,De),this.getAvailableImages(le,De),this.isSpriteLoaded[le][De],void 0,this.brightness)),Pe[le][De][de][we]}rasterizeImages(le,de,we){const De=new Map;for(const[Pe,{image:ze,imageVariant:tt}]of de.tasks.entries()){const Ue=this.imageRasterizer.rasterize(tt,ze,de.scope,le);De.set(Pe,Ue)}we(void 0,De)}removeRasterizedImages(le,de,we){this.imageRasterizer.removeImagesFromCacheByIds(de.imageIds,de.scope,le),we()}enforceCacheSizeLimit(le,de){i.en(de)}getWorkerPerformanceMetrics(le,de,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new dd(self)),dd}),b(["./shared"],function(i){var L="3.11.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},U={mark(p){performance.mark(p)},measure(p,r,a){performance.measure(p,r,a)}};function q(p){const r=p.name.split("?")[0];return i.a(r)&&r.includes("mapbox-gl.js")?"javascript":i.a(r)&&r.includes("mapbox-gl.css")?"css":i.b(r)?"fontRange":i.c(r)?"sprite":i.i(r)?"style":i.d(r)?"tilejson":"other"}var G,ie={},J=function(){if(G)return ie;function p(f){return!r(f)}function r(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,R=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(R);try{S=new Worker(D),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(D),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var R=S.getImageData(0,0,1,1);return R&&R.width===v.width}()?(a[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(a[_]=function(v){var S,R=function(D){var N=document.createElement("canvas"),z=Object.create(p.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=D,N.getContext("webgl2",z)}(v);if(!R)return!1;try{S=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!S||R.isContextLost())&&(R.shaderSource(S,"void main() {}"),R.compileShader(S),R.getShaderParameter(S,R.COMPILE_STATUS)===!0)}(_)),a[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}G=1,ie.supported=p,ie.notSupportedReason=r;var a={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ie}();function K(p,r,a){const f=document.createElement(p);return r!=null&&(f.className=r),a&&a.appendChild(f),f}function re(p,r,a){const f=document.createElementNS("http://www.w3.org/2000/svg",p);for(const _ of Object.keys(r))f.setAttributeNS(null,_,String(r[_]));return a&&a.appendChild(f),f}const Q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ee=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function fe(){Q&&ee&&(ue=Q[ee],Q[ee]="none")}function ge(){Q&&ee&&(Q[ee]=ue)}function ke(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",ke,!0)}function Ce(){window.addEventListener("click",ke,!0),window.setTimeout(()=>{window.removeEventListener("click",ke,!0)},0)}function Be(p,r){const a=p.getBoundingClientRect();return qe(p,a,r)}function dt(p,r){const a=p.getBoundingClientRect(),f=[];for(let _=0;_<r.length;_++)f.push(qe(p,a,r[_]));return f}function Qe(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function qe(p,r,a){const f=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new i.P((a.clientX-r.left)*f,(a.clientY-r.top)*f)}const He="01",et="NO_ACCESS_TOKEN";class mt{constructor(r,a,f){this._transformRequestFn=r,this._customAccessToken=a,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const r=function(){let a="";for(let f=0;f<10;f++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",He,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,a){return this._transformRequestFn&&this._transformRequestFn(r,a)||{url:r}}normalizeStyleURL(r,a){if(!i.f(r))return r;const f=Tt(r);return f.params.push(`sdk=js-${L}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeGlyphsURL(r,a){if(!i.f(r))return r;const f=Tt(r);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeModelURL(r,a){if(!i.f(r))return r;const f=Tt(r);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeSourceURL(r,a,f,_){if(!i.f(r))return r;const v=Tt(r);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),_&&v.params.push(`worldview=${_}`),this._makeAPIURL(v,this._customAccessToken||a)}normalizeIconsetURL(r,a){const f=Tt(r);return i.f(r)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||a)):Gt(f)}normalizeSpriteURL(r,a,f,_){const v=Tt(r);return i.f(r)?(v.path=`/styles/v1${v.path}/sprite${a}${f}`,this._makeAPIURL(v,this._customAccessToken||_)):(v.path+=`${a}${f}`,Gt(v))}normalizeTileURL(r,a,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!i.f(r))return r;const _=Tt(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||f&&_.authority!=="raster"&&f===512?"@2x":""}${i.m.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${i.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${i.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${i.e.TILE_URL_VERSION}${_.path}`);const v=this._customAccessToken||function(S){for(const R of S){const D=R.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(_.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,v)}canonicalizeTileURL(r,a){const f=Tt(r);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return r;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return a&&(v=v.filter(S=>!S.match(/^access_token=/))),v.length&&(_+=`?${v.join("&")}`),_}canonicalizeTileset(r,a){const f=!!a&&i.f(a),_=[];for(const v of r.tiles||[])i.h(v)?_.push(this.canonicalizeTileURL(v,f)):_.push(v);return _}_makeAPIURL(r,a){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Tt(i.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){const v=r.params.indexOf("secure");v>=0&&r.params.splice(v,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Gt(r);if(a=a||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return r.params=r.params.filter(v=>v.indexOf("access_token")===-1),r.params.push(`access_token=${a||""}`),Gt(r)}}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tt(p){const r=p.match(Ze);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Gt(p){const r=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${r}`}const ct="mapbox.eventData";function Je(p){if(!p)return null;const r=p.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(i.j(r[1]))}catch{return null}}class rt{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=Je(i.e.ACCESS_TOKEN);let f="";return f=a&&a.u?i.k(a.u):i.e.ACCESS_TOKEN||"",r?`${ct}.${r}:${f}`:`${ct}:${f}`}fetchEventData(){const r=i.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(r)try{const _=localStorage.getItem(a);_&&(this.eventData=JSON.parse(_));const v=localStorage.getItem(f);v&&(this.anonId=v)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const r=i.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.anonId;if(r&&_)try{localStorage.setItem(f,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,f,_){if(!i.e.EVENTS_URL)return;const v=Tt(i.e.EVENTS_URL);v.params.push(`access_token=${_||i.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(r).toISOString()},R=a?i.l(S,a):S,D={url:Gt(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=i.p(D,N=>{this.pendingRequest=null,f(N),this.saveEventData(),this.processRequests(_)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const bt=new class extends rt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,r){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(a=>i.f(a)||i.h(a))&&this.queueRequest(Date.now(),r)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Je(i.e.ACCESS_TOKEN),a=r?r.u:i.e.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),S=new Date(_),R=(_-this.eventData.lastSuccess)/864e5;f=f||R>=1||R<-1||v.getDate()!==S.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:He,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=_,this.eventData.tokenU=a)},p):this.processRequests()}},kt=bt.postTurnstileEvent.bind(bt),At=new class extends rt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,r,a,f){this.skuToken=r,this.errorCb=f,i.e.EVENTS_URL&&(a||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},a):this.errorCb(new Error(et)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:He,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},p))}remove(){this.errorCb=null}},_r=At.postMapLoadEvent.bind(At),cn=new class extends rt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let r=this.mapInstanceIdMap.get(p);return r||(r=i.u(),this.mapInstanceIdMap.set(p,r)),r}getEventId(p){const r=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,r+1),r}postStyleLoadEvent(p,r){const{map:a,style:f,importedStyles:_}=r;if(!i.e.EVENTS_URL||!p&&!i.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(a),S={mapInstanceId:v,eventId:this.getEventId(v),style:f};_.length&&(S.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:S},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:a}=this.queue.shift();this.postEvent(r,a,()=>{},p)}},pr=cn.postStyleLoadEvent.bind(cn),Dt=new class extends rt{constructor(){super("gljs.performance")}postPerformanceEvent(p,r){i.e.EVENTS_URL&&(p||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:a}=this.queue.shift(),f=function(_){const v=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),R=function(X){const se={};if(X){for(const te in X)if(te!=="other")for(const ae of X[te]){const ce=`${te}ResolveRangeMin`,_e=`${te}ResolveRangeMax`,be=`${te}RequestCount`,xe=`${te}RequestCachedCount`;se[ce]=Math.min(se[ce]||1/0,ae.startTime),se[_e]=Math.max(se[_e]||-1/0,ae.responseEnd);const Ae=Se=>{se[Se]===void 0&&(se[Se]=0),++se[Se]};ae.transferSize!==void 0&&ae.transferSize===0&&Ae(xe),Ae(be)}}return se}(function(X,se){const te={};if(X)for(const ae of X){const ce=se(ae);te[ce]===void 0&&(te[ce]=[]),te[ce].push(ae)}return te}(v,q)),D=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=N?N.effectiveType:void 0,B={counters:[],metadata:[],attributes:[]},V=(X,se,te)=>{te!=null&&X.push({name:se,value:te.toString()})};for(const X in R)V(B.counters,X,R[X]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(V(B.counters,"interactionRangeMin",_.interactionRange[0]),V(B.counters,"interactionRangeMax",_.interactionRange[1])),S)for(const X of Object.keys(O)){const se=O[X],te=S.find(ae=>ae.name===se);te&&V(B.counters,se,te.startTime)}return V(B.counters,"visibilityHidden",_.visibilityHidden),V(B.attributes,"style",function(X){if(X)for(const se of X){const te=se.name.split("?")[0];if(i.i(te)){const ae=te.split("/").slice(-2);if(ae.length===2)return`mapbox://styles/${ae[0]}/${ae[1]}`}}}(v)),V(B.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),V(B.attributes,"fogEnabled",_.fogEnabled?"true":"false"),V(B.attributes,"projection",_.projection),V(B.attributes,"zoom",_.zoom),V(B.metadata,"devicePixelRatio",D),V(B.metadata,"connectionEffectiveType",z),V(B.metadata,"navigatorUserAgent",navigator.userAgent),V(B.metadata,"screenWidth",window.screen.width),V(B.metadata,"screenHeight",window.screen.height),V(B.metadata,"windowWidth",window.innerWidth),V(B.metadata,"windowHeight",window.innerHeight),V(B.metadata,"mapWidth",_.width/D),V(B.metadata,"mapHeight",_.height/D),V(B.metadata,"webglRenderer",_.renderer),V(B.metadata,"webglVendor",_.vendor),V(B.metadata,"sdkVersion",L),V(B.metadata,"sdkIdentifier","mapbox-gl-js"),B}(a);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(r,f,()=>{},p)}},ir=Dt.postPerformanceEvent.bind(Dt),zr=new class extends rt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,r,a,f){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const _=Tt(i.e.API_URL+i.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${f||i.e.ACCESS_TOKEN||""}`);const v={url:Gt(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(v,S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(f)})}getSessionAPI(p,r,a,f){this.skuToken=r,this.errorCb=f,i.e.SESSION_PATH&&i.e.API_URL&&(a||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},a):this.errorCb(new Error(et)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},p)}remove(){this.errorCb=null}},he=zr.getSessionAPI.bind(zr),br=new Set;function Ht(p,r){r?br.add(p):br.delete(p)}class jr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,a){this._updatedSourceCaches[r]=a,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const a=r.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(r.id),this.setDirty()}removeLayer(r){const a=r.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][r.id]=r,this._updatedLayers[a].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const a in this._updatedLayers)r[a]=r[a]||{},r[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)r[a]=r[a]||{},r[a].removedIds=Object.keys(this._removedLayers[a]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(i.I.toString(r)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function wt(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class dn extends i.E{constructor(r){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=r,r!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(r){this._images[r]={},this._iconsets[r]={},this.loaded[r]=!1,this.updatedImages[r]=new Set,this.patterns[r]={},this.callbackDispatchedThisFrame[r]=new Set,this.atlasImage[r]=new i.r({width:1,height:1})}createIconset(r,a){this._iconsets[r][a]={}}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,a){if(this.loaded[a]!==r&&(this.loaded[a]=r,r)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,a,_);this.requestors=[]}}hasImage(r,a){return!!this.getImage(r,a)}getImage(r,a){return(r.iconsetId?this._iconsets[a][r.iconsetId]:this._images[a])[r.name]}addImage(r,a,f){const _=r.iconsetId?this._iconsets[a][r.iconsetId]:this._images[a];this._validate(r,f)&&(_[r.name]=f)}_validate(r,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "content" value`))),f=!1),f}_validateStretch(r,a){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||a<_[1])return!1;f=_[1]}return!0}_validateContent(r,a){return r?r.length!==4||!a.usvg&&(r[0]<0||a.data.width<r[0]||r[1]<0||a.data.height<r[1]||r[2]<0||a.data.width<r[2]||r[3]<0||a.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,a,f){const _=r.iconsetId?this._iconsets[a][r.iconsetId]:this._images[a];f.version=_[r.name].version+1,_[r.name]=f,this.updatedImages[a].add(r),this.removeFromImageRasterizerCache(r,a)}clearUpdatedImages(r){this.updatedImages[r].clear()}removeFromImageRasterizerCache(r,a){if(this.spriteFormat!=="raster")if(i.t()){const f={imageIds:[r],scope:a};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",f)}else this.imageRasterizer.removeImagesFromCacheByIds([r],a)}removeImage(r,a){const f=r.iconsetId?this._iconsets[a][r.iconsetId]:this._images[a],_=f[r.name];delete f[r.name],delete this.patterns[a][r.name],this.removeFromImageRasterizerCache(r,a),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(r){const a=[];for(const f of Object.keys(this._images[r]))a.push(new i.I(f));for(const f in this._iconsets[r])for(const _ of Object.keys(this._iconsets[r][f]))a.push(new i.I({name:_,iconsetId:f}));return a}getImages(r,a,f){let _=!0;const v=!!this.loaded[a];if(!v)for(const S of r)(S.iconsetId?this._iconsets[a][S.iconsetId]:this._images[a])[S.name]||(_=!1);v||_?this._notify(r,a,f):this.requestors.push({ids:r,scope:a,callback:f})}rasterizeImages({scope:r,tasks:a},f){const _=new Map;for(const[v,S]of a.entries()){const R=this.getImage(S.id,r);R&&_.set(v,{image:R,imageVariant:S})}this._rasterizeImages(r,_,f)}_rasterizeImages(r,a,f){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:a,scope:r},f);else{const _=new Map;for(const[v,{image:S,imageVariant:R}]of a.entries())_.set(v,this.imageRasterizer.rasterize(R,S,r,0));f(void 0,_)}}getUpdatedImages(r){return this.updatedImages[r]||new Set}_notify(r,a,f){const _=new Map;for(const v of r){v.iconsetId&&(this._iconsets[a][v.iconsetId]=this._iconsets[a][v.iconsetId]||{});const S=(v.iconsetId?this._iconsets[a][v.iconsetId]:this._images[a])[v.name];if(!S){if(v.iconsetId)continue;i.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:v.name}));continue}const R={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(R,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),_.set(i.I.toString(v),R)}f(null,_)}getPixelSize(r){const{width:a,height:f}=this.atlasImage[r];return{width:a,height:f}}getPattern(r,a,f){const _=this.patterns[a][r.name],v=this.getImage(r,a);if(!v)return null;if(_){if(_.position.version===v.version)return _.position;_.position.version=v.version}else{if(v.usvg&&!v.data){const S=this.getPatternInFlightId(r.toString(),a);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);const R=new i.B(r).scaleSelf(i.q.devicePixelRatio),D=new Map([[R.toString(),{image:v,imageVariant:R}]]);return this._rasterizeImages(a,D,(N,z)=>this.storePatternImage(R,a,v,f,z)),null}this.storePattern(r,a,v)}return this._updatePatternAtlas(a,f),this.patterns[a][r.name].position}getPatternInFlightId(r,a){return i.C(r,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,a,f,_,v){const S=r.toString(),R=v?v.get(S):void 0;R&&(f.data=R,this.storePattern(r.id,a,f),this._updatePatternAtlas(a,_),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),a)))}storePattern(r,a,f){const _={w:f.data.width+2*i.F,h:f.data.height+2*i.F,x:0,y:0},v=new i.G(_,f,i.F);this.patterns[a][r.name]={bin:_,position:v}}bind(r,a){const f=r.gl;let _=this.atlasTexture[a];_?this.dirty&&(_.update(this.atlasImage[a]),this.dirty=!1):(_=new i.T(r,this.atlasImage[a],f.RGBA8),this.atlasTexture[a]=_),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,a){const f=[];for(const R in this.patterns[r])f.push(this.patterns[r][R].bin);const{w:_,h:v}=i.H(f),S=this.atlasImage[r];S.resize({width:_||1,height:v||1});for(const R in this.patterns[r]){const{bin:D,position:N}=this.patterns[r][R];let z=N.padding;const B=D.x+z,V=D.y+z,X=this._images[r][R].data,se=X.width,te=X.height;z=z>1?z-1:z,i.r.copy(X,S,{x:0,y:0},{x:B,y:V},{width:se,height:te},a),i.r.copy(X,S,{x:0,y:te-z},{x:B,y:V-z},{width:se,height:z},a),i.r.copy(X,S,{x:0,y:0},{x:B,y:V+te},{width:se,height:z},a),i.r.copy(X,S,{x:se-z,y:0},{x:B-z,y:V},{width:z,height:te},a),i.r.copy(X,S,{x:0,y:0},{x:B+se,y:V},{width:z,height:te},a),i.r.copy(X,S,{x:se-z,y:te-z},{x:B-z,y:V-z},{width:z,height:z},a),i.r.copy(X,S,{x:0,y:te-z},{x:B+se,y:V-z},{width:z,height:z},a),i.r.copy(X,S,{x:0,y:0},{x:B+se,y:V+te},{width:z,height:z},a),i.r.copy(X,S,{x:se-z,y:0},{x:B-z,y:V+te},{width:z,height:z},a)}this.dirty=!0}beginFrame(){for(const r in this._images)this.callbackDispatchedThisFrame[r]=new Set}dispatchRenderCallbacks(r,a){for(const f of r){if(this.callbackDispatchedThisFrame[a].has(f.toString()))continue;this.callbackDispatchedThisFrame[a].add(f.toString());const _=(f.iconsetId?this._iconsets[a][f.iconsetId]:this._images[a])[f.name];wt(_)&&this.updateImage(f,a,_)}}}function rn(p){const r=p.key,a=p.value,f=p.valueSpec||{},_=p.objectElementValidators||{},v=p.style,S=p.styleSpec;let R=[];const D=i.K(a);if(D!=="object")return[new i.V(r,a,`object expected, ${D} found`)];for(const N in a){const z=N.split(".")[0];let B;_[z]?B=_[z]:f[z]?B=sr:_["*"]?B=_["*"]:f["*"]&&(B=sr),B?R=R.concat(B({key:(r&&`${r}.`)+N,value:a[N],valueSpec:f[z]||f["*"],style:v,styleSpec:S,object:a,objectKey:N},a)):R.push(new i.J(r,a[N],`unknown property "${N}"`))}for(const N in f)_[N]||f[N].required&&f[N].default===void 0&&a[N]===void 0&&R.push(new i.V(r,a,`missing required property "${N}"`));return R}function Vn(p){const r=p.value,a=p.valueSpec,f=p.style,_=p.styleSpec,v=p.key,S=p.arrayElementValidator||sr;if(i.K(r)!=="array")return[new i.V(v,r,`array expected, ${i.K(r)} found`)];if(a.length&&r.length!==a.length)return[new i.V(v,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new i.V(v,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let R={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};_.$version<7&&(R.function=a.function),i.K(a.value)==="object"&&(R=a.value);let D=[];for(let N=0;N<r.length;N++)D=D.concat(S({array:r,arrayIndex:N,value:r[N],valueSpec:R,style:f,styleSpec:_,key:`${v}[${N}]`},!0));return D}function wr(p){const r=p.key,a=p.value,f=p.valueSpec;let _=i.K(a);if(_==="number"&&a!=a&&(_="NaN"),_!=="number")return[new i.V(r,a,`number expected, ${_} found`)];if("minimum"in f){let v=f.minimum;if(i.K(f.minimum)==="array"&&(v=f.minimum[p.arrayIndex]),a<v)return[new i.V(r,a,`${a} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(i.K(f.maximum)==="array"&&(v=f.maximum[p.arrayIndex]),a>v)return[new i.V(r,a,`${a} is greater than the maximum value ${v}`)]}return[]}function Hr(p){const r=p.valueSpec,a=i.M(p.value.type);let f,_,v,S={};const R=a!=="categorical"&&p.value.property===void 0,D=!R,N=i.K(p.value.stops)==="array"&&i.K(p.value.stops[0])==="array"&&i.K(p.value.stops[0][0])==="object",z=rn({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(X){if(a==="identity")return[new i.V(X.key,X.value,'identity function may not have a "stops" property')];let se=[];const te=X.value;return se=se.concat(Vn({key:X.key,value:te,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:B})),i.K(te)==="array"&&te.length===0&&se.push(new i.V(X.key,te,"array must have at least one stop")),se},default:function(X){return sr({key:X.key,value:X.value,valueSpec:r,style:X.style,styleSpec:X.styleSpec})}}});return a==="identity"&&R&&z.push(new i.V(p.key,p.value,'missing required property "property"')),a==="identity"||p.value.stops||z.push(new i.V(p.key,p.value,'missing required property "stops"')),a==="exponential"&&p.valueSpec.expression&&!i.N(p.valueSpec)&&z.push(new i.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(D&&!i.O(p.valueSpec)?z.push(new i.V(p.key,p.value,"property functions not supported")):R&&!i.Q(p.valueSpec)&&z.push(new i.V(p.key,p.value,"zoom functions not supported"))),a!=="categorical"&&!N||p.value.property!==void 0||z.push(new i.V(p.key,p.value,'"property" property is required')),z;function B(X){let se=[];const te=X.value,ae=X.key;if(i.K(te)!=="array")return[new i.V(ae,te,`array expected, ${i.K(te)} found`)];if(te.length!==2)return[new i.V(ae,te,`array length 2 expected, length ${te.length} found`)];if(N){if(i.K(te[0])!=="object")return[new i.V(ae,te,`object expected, ${i.K(te[0])} found`)];if(te[0].zoom===void 0)return[new i.V(ae,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new i.V(ae,te,"object stop key must have value")];const ce=i.M(te[0].zoom);if(typeof ce!="number")return[new i.V(ae,te[0].zoom,"stop zoom values must be numbers")];if(v&&v>ce)return[new i.V(ae,te[0].zoom,"stop zoom values must appear in ascending order")];ce!==v&&(v=ce,_=void 0,S={}),se=se.concat(rn({key:`${ae}[0]`,value:te[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:wr,value:V}}))}else se=se.concat(V({key:`${ae}[0]`,value:te[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},te));return i.S(i.U(te[1]))?se.concat([new i.V(`${ae}[1]`,te[1],"expressions are not allowed in function stops.")]):se.concat(sr({key:`${ae}[1]`,value:te[1],valueSpec:r,style:X.style,styleSpec:X.styleSpec}))}function V(X,se){const te=i.K(X.value),ae=i.M(X.value),ce=X.value!==null?X.value:se;if(f){if(te!==f)return[new i.V(X.key,ce,`${te} stop domain type must match previous stop domain type ${f}`)]}else f=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new i.V(X.key,ce,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&a!=="categorical"){let _e=`number expected, ${te} found`;return i.O(r)&&a===void 0&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(X.key,ce,_e)]}return a!=="categorical"||te!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?a!=="categorical"&&te==="number"&&typeof ae=="number"&&typeof _=="number"&&_!==void 0&&ae<_?[new i.V(X.key,ce,"stop domain values must appear in ascending order")]:(_=ae,a==="categorical"&&ae in S?[new i.V(X.key,ce,"stop domain values must be unique")]:(S[ae]=!0,[])):[new i.V(X.key,ce,`integer expected, found ${String(ae)}`)]}}function Yn(p){const r=(p.expressionContext==="property"?i.W:i.X)(i.U(p.value),p.valueSpec);if(r.result==="error")return r.value.map(f=>new i.V(`${p.key}${f.key}`,p.value,f.message));const a=r.value.expression||r.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!a.outputDefined())return[new i.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!i.Y(a))return[new i.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return ys(a,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!i.Z(a,["zoom","feature-state"]))return[new i.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!i._(a))return[new i.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ys(p,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)a.delete(_);if(a.size===0)return[];const f=[];return p instanceof i.$&&a.has(p.name)?[new i.V(r.key,r.value,`["${p.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(p.eachChild(_=>{f.push(...ys(_,r))}),f)}function vs(p){const r=p.key,a=p.value,f=p.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(i.M(a))===-1&&_.push(new i.V(r,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(i.M(a))===-1&&_.push(new i.V(r,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),_}function xs(p){return i.a1(i.U(p.value))?Yn(i.L({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Tr(p)}function Tr(p){const r=p.value,a=p.key;if(i.K(r)!=="array")return[new i.V(a,r,`array expected, ${i.K(r)} found`)];const f=p.styleSpec;let _,v=[];if(r.length<1)return[new i.V(a,r,"filter array must have at least 1 element")];switch(v=v.concat(vs({key:`${a}[0]`,value:r[0],valueSpec:f.filter_operator,style:p.style,styleSpec:p.styleSpec})),i.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.M(r[1])==="$type"&&v.push(new i.V(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new i.V(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(_=i.K(r[1]),_!=="string"&&v.push(new i.V(`${a}[1]`,r[1],`string expected, ${_} found`)));for(let S=2;S<r.length;S++)_=i.K(r[S]),i.M(r[1])==="$type"?v=v.concat(vs({key:`${a}[${S}]`,value:r[S],valueSpec:f.geometry_type,style:p.style,styleSpec:p.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new i.V(`${a}[${S}]`,r[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<r.length;S++)v=v.concat(Tr({key:`${a}[${S}]`,value:r[S],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":_=i.K(r[1]),r.length!==2?v.push(new i.V(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new i.V(`${a}[1]`,r[1],`string expected, ${_} found`))}return v}function mi(p,r){const a=p.key,f=p.style,_=p.layer,v=p.styleSpec,S=p.value,R=p.objectKey,D=v[`${r}_${p.layerType}`];if(!D)return[];const N=R.match(/^(.*)-use-theme$/);if(r==="paint"&&N&&D[N[1]])return i.S(S)?[].concat(sr({key:p.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:R})):sr({key:a,value:S,valueSpec:{type:"string"},style:f,styleSpec:v});const z=R.match(/^(.*)-transition$/);if(r==="paint"&&z&&D[z[1]]&&D[z[1]].transition)return sr({key:a,value:S,valueSpec:v.transition,style:f,styleSpec:v});const B=p.valueSpec||D[R];if(!B)return[new i.J(a,S,`unknown property "${R}"`)];let V;if(i.K(S)==="string"&&i.O(B)&&!B.tokens&&(V=/^{([^}]+)}$/.exec(S))){const se=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new i.V(a,S,`"${R}" does not support interpolation syntax
Use an identity property function instead: ${se}.`)]}const X=[];if(p.layerType==="symbol")R!=="text-field"||!f||f.glyphs||f.imports||X.push(new i.V(a,S,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&i.a2(i.U(S))&&i.M(S.type)==="identity"&&X.push(new i.V(a,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&i.O(B)&&(i.a3(B)||i.Q(B))){const se=i.W(i.U(S),B),te=se.value.expression||se.value._styleExpression.expression;te&&!i.Z(te,["measure-light"])&&(R==="model-emissive-strength"&&i._(te)&&i.Y(te)||X.push(new i.V(a,S,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return X.concat(sr({key:p.key,value:S,valueSpec:B,style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:R}))}function Is(p){return mi(p,"paint")}function Yi(p){return mi(p,"layout")}function gi(p){let r=[];const a=p.value,f=p.key,_=p.style,v=p.styleSpec;a.type||a.ref||r.push(new i.V(f,a,'either "type" or "ref" is required'));let S=i.M(a.type);const R=i.M(a.ref);if(a.id){const D=i.M(a.id);for(let N=0;N<p.arrayIndex;N++){const z=_.layers[N];i.M(z.id)===D&&r.push(new i.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${z.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(N=>{N in a&&r.push(new i.V(f,a[N],`"${N}" is prohibited for ref layers`))}),_.layers.forEach(N=>{i.M(N.id)===R&&(D=N)}),D?D.ref?r.push(new i.V(f,a.ref,"ref cannot reference another ref layer")):S=i.M(D.type):typeof R=="string"&&r.push(new i.V(f,a.ref,`ref layer "${R}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(a.source){const D=_.sources&&_.sources[a.source],N=D&&i.M(D.type);D?N==="vector"&&S==="raster"?r.push(new i.V(f,a.source,`layer "${a.id}" requires a raster source`)):N==="raster"&&S!=="raster"?r.push(new i.V(f,a.source,`layer "${a.id}" requires a vector source`)):N!=="vector"||a["source-layer"]?N==="raster-dem"&&S!=="hillshade"?r.push(new i.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||N==="geojson"&&D.lineMetrics?S==="raster-particle"&&N!=="raster-array"&&r.push(new i.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):r.push(new i.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new i.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new i.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new i.V(f,a.source,`source "${a.source}" not found`))}else r.push(new i.V(f,a,'missing required property "source"'));return r=r.concat(rn({key:f,value:a,valueSpec:v.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>sr({key:`${f}.type`,value:a.type,valueSpec:v.layer.type,style:p.style,styleSpec:p.styleSpec,object:a,objectKey:"type"}),filter:D=>xs(i.L({layerType:S},D)),layout:D=>rn({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>Yi(i.L({layerType:S},N))}}),paint:D=>rn({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>Is(i.L({layerType:S,layer:a},N))}})}})),r}function Mi(p){const r=p.value,a=p.key,f=i.K(r);return f!=="string"?[new i.V(a,r,`string expected, ${f} found`)]:[]}const ui={promoteId:function p({key:r,value:a}){if(i.K(a)==="string")return Mi({key:r,value:a});if(Array.isArray(a)){const f=[],_=i.U(a),v=i.X(_);return v.result==="error"&&v.value.forEach(S=>{f.push(new i.V(`${r}${S.key}`,null,`${S.message}`))}),i.Z(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new i.V(`${r}`,null,"promoteId expression should be only feature dependent")),f}{const f=[];for(const _ in a)f.push(...p({key:`${r}.${_}`,value:a[_]}));return f}}};function Ao(p){const r=p.value,a=p.key,f=p.styleSpec,_=p.style;if(!r.type)return[new i.V(a,r,'"type" is required')];const v=i.M(r.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||S.push(new i.J(a,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(rn({key:a,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:ui})),S;case"geojson":if(S=rn({key:a,value:r,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:ui}),r.cluster)for(const R in r.clusterProperties){const[D,N]=r.clusterProperties[R],z=typeof D=="string"?[D,["accumulated"],["get",R]]:D;S.push(...Yn({key:`${a}.${R}.map`,value:N,expressionContext:"cluster-map"})),S.push(...Yn({key:`${a}.${R}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return rn({key:a,value:r,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return rn({key:a,value:r,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new i.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${a}.type`,value:r.type,valueSpec:{values:ao(f)},style:_,styleSpec:f})}}function ao(p){return p.source.reduce((r,a)=>{const f=p[a];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function bs(p){const r=p.value,a=p.styleSpec,f=a.light,_=p.style;let v=[];const S=i.K(r);if(r===void 0)return v;if(S!=="object")return v=v.concat([new i.V("light",r,`object expected, ${S} found`)]),v;for(const R in r){const D=R.match(/^(.*)-transition$/),N=R.match(/^(.*)-use-theme$/);v=v.concat(N&&f[N[1]]?sr({key:R,value:r[R],valueSpec:{type:"string"},style:_,styleSpec:a}):D&&f[D[1]]&&f[D[1]].transition?sr({key:R,value:r[R],valueSpec:a.transition,style:_,styleSpec:a}):f[R]?sr({key:R,value:r[R],valueSpec:f[R],style:_,styleSpec:a}):[new i.V(R,r[R],`unknown property "${R}"`)])}return v}function $s(p){const r=p.value;let a=[];if(!r)return a;const f=i.K(r);if(f!=="object")return a=a.concat([new i.V("light-3d",r,`object expected, ${f} found`)]),a;const _=p.styleSpec,v=_["light-3d"],S=p.key,R=p.style,D=p.style.lights;for(const B of["type","id"])if(!(B in r))return a=a.concat([new i.V("light-3d",r,`missing property ${B} on light`)]),a;if(r.type&&D)for(let B=0;B<p.arrayIndex;B++){const V=i.M(r.type),X=D[B];i.M(X.type)===V&&a.push(new i.V(S,r.id,`duplicate light type "${r.type}", previously defined at line ${X.id.__line__}`))}const N=`properties_light_${r.type}`;if(!(N in _))return a=a.concat([new i.V("light-3d",r,`Invalid light type ${r.type}`)]),a;const z=_[N];for(const B in r)if(B==="properties"){const V=r[B],X=i.K(V);if(X!=="object")return a=a.concat([new i.V("properties",V,`object expected, ${X} found`)]),a;for(const se in V)a=a.concat(z[se]?sr({key:se,value:V[se],valueSpec:z[se],style:R,styleSpec:_}):[new i.J(p.key,V[se],`unknown property "${se}"`)])}else{const V=B.match(/^(.*)-transition$/),X=B.match(/^(.*)-use-theme$/);a=a.concat(X&&v[X[1]]?sr({key:B,value:r[B],valueSpec:{type:"string"},style:R,styleSpec:_}):V&&v[V[1]]&&v[V[1]].transition?sr({key:B,value:r[B],valueSpec:_.transition,style:R,styleSpec:_}):v[B]?sr({key:B,value:r[B],valueSpec:v[B],style:R,styleSpec:_}):[new i.J(B,r[B],`unknown property "${B}"`)])}return a}function Oi(p){const r=p.value,a=p.key,f=p.style,_=p.styleSpec,v=_.terrain;let S=[];const R=i.K(r);if(r===void 0||R==="null")return S;if(R!=="object")return S=S.concat([new i.V("terrain",r,`object expected, ${R} found`)]),S;for(const D in r){const N=D.match(/^(.*)-transition$/),z=D.match(/^(.*)-use-theme$/);S=S.concat(z&&v[z[1]]?sr({key:D,value:r[D],valueSpec:{type:"string"},style:f,styleSpec:_}):N&&v[N[1]]&&v[N[1]].transition?sr({key:D,value:r[D],valueSpec:_.transition,style:f,styleSpec:_}):v[D]?sr({key:D,value:r[D],valueSpec:v[D],style:f,styleSpec:_}):[new i.J(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=f.sources&&f.sources[r.source],N=D&&i.M(D.type);D?N!=="raster-dem"&&S.push(new i.V(a,r.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):S.push(new i.V(a,r.source,`source "${r.source}" not found`))}else S.push(new i.V(a,r,'terrain is missing required property "source"'));return S}function Ji(p){const r=p.value,a=p.style,f=p.styleSpec,_=f.fog;let v=[];const S=i.K(r);if(r===void 0)return v;if(S!=="object")return v=v.concat([new i.V("fog",r,`object expected, ${S} found`)]),v;for(const R in r){const D=R.match(/^(.*)-transition$/),N=R.match(/^(.*)-use-theme$/);v=v.concat(N&&_[N[1]]?sr({key:R,value:r[R],valueSpec:{type:"string"},style:a,styleSpec:f}):D&&_[D[1]]&&_[D[1]].transition?sr({key:R,value:r[R],valueSpec:f.transition,style:a,styleSpec:f}):_[R]?sr({key:R,value:r[R],valueSpec:_[R],style:a,styleSpec:f}):[new i.J(R,r[R],`unknown property "${R}"`)])}return v}const Cn={"*":()=>[],array:Vn,boolean:function(p){const r=p.value,a=p.key,f=i.K(r);return f!=="boolean"?[new i.V(a,r,`boolean expected, ${f} found`)]:[]},number:wr,color:function(p){const r=p.key,a=p.value,f=i.K(a);return f!=="string"?[new i.V(r,a,`color expected, ${f} found`)]:i.a0.parseCSSColor(a)===null?[new i.V(r,a,`color expected, "${a}" found`)]:[]},enum:vs,filter:xs,function:Hr,layer:gi,object:rn,source:Ao,model:i.a4,light:bs,"light-3d":$s,terrain:Oi,fog:Ji,string:Mi,formatted:function(p){return Mi(p).length===0?[]:Yn(p)},resolvedImage:function(p){return Mi(p).length===0?[]:Yn(p)},projection:function(p){const r=p.value,a=p.styleSpec,f=a.projection,_=p.style;let v=[];const S=i.K(r);if(S==="object")for(const R in r)v=v.concat(sr({key:R,value:r[R],valueSpec:f[R],style:_,styleSpec:a}));else S!=="string"&&(v=v.concat([new i.V("projection",r,`object or string expected, ${S} found`)]));return v},import:function(p){const{value:r,styleSpec:a}=p,{data:f,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let v=rn(i.L({},p,{value:_,valueSpec:a.import}));return i.M(_.id)===""&&v.push(new i.V(`${p.key}.id`,_,"import id can't be an empty string")),f&&(v=v.concat(vn(f,a,{key:`${p.key}.data`}))),v},iconset:function(p){const r=p.value,a=p.key,f=p.styleSpec,_=p.style;if(!r.type)return[new i.V(a,r,'"type" is required')];const v=i.M(r.type);let S=[];if(S=S.concat(rn({key:a,value:r,valueSpec:f[`iconset_${v}`],style:_,styleSpec:f})),v==="source"&&r.source){const R=_.sources&&_.sources[r.source],D=R&&i.M(R.type);R?D!=="raster-array"&&S.push(new i.V(a,r.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):S.push(new i.V(a,r.source,`source "${r.source}" not found`))}return S}};function sr(p,r=!1){const a=p.value,f=p.valueSpec,_=p.styleSpec;if(f.expression&&i.a2(i.M(a)))return Hr(p);if(f.expression&&i.S(i.U(a)))return Yn(p);if(f.type&&Cn[f.type]){const v=Cn[f.type](p);return r===!0&&v.length>0&&i.K(p.value)==="array"?Yn(p):v}return rn(i.L({},p,{valueSpec:f.type?_[f.type]:f}))}function An(p){const r=p.value,a=p.key,f=Mi(p);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new i.V(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new i.V(a,r,'"glyphs" url must include a "{range}" token'))),f}function vn(p,r=i.a5,a={}){return sr({key:a.key||"",value:p,valueSpec:r.$root,styleSpec:r,style:p,objectElementValidators:{glyphs:An,"*":()=>[]}})}function jn(p,r=i.a5){return ze(vn(p,r))}const _i=p=>ze(Ao(p)),lo=p=>ze(bs(p)),Mo=p=>ze($s(p)),vc=p=>ze(Oi(p)),$h=p=>ze(Ji(p)),dd=p=>ze(function(r){const a=r.value,f=r.style,_=r.styleSpec,v=_.snow;let S=[];const R=i.K(a);if(a===void 0)return S;if(R!=="object")return S=S.concat([new i.V("snow",a,`object expected, ${R} found`)]),S;for(const D in a){const N=D.match(/^(.*)-transition$/);S=S.concat(N&&v[N[1]]&&v[N[1]].transition?sr({key:D,value:a[D],valueSpec:_.transition,style:f,styleSpec:_}):v[D]?sr({key:D,value:a[D],valueSpec:v[D],style:f,styleSpec:_}):[new i.J(D,a[D],`unknown property "${D}"`)])}return S}(p)),at=p=>ze(function(r){const a=r.value,f=r.style,_=r.styleSpec,v=_.rain;let S=[];const R=i.K(a);if(a===void 0)return S;if(R!=="object")return S=S.concat([new i.V("rain",a,`object expected, ${R} found`)]),S;for(const D in a){const N=D.match(/^(.*)-transition$/);S=S.concat(N&&v[N[1]]&&v[N[1]].transition?sr({key:D,value:a[D],valueSpec:_.transition,style:f,styleSpec:_}):v[D]?sr({key:D,value:a[D],valueSpec:v[D],style:f,styleSpec:_}):[new i.J(D,a[D],`unknown property "${D}"`)])}return S}(p)),le=p=>ze(gi(p)),de=p=>ze(xs(p)),we=p=>ze(Is(p)),De=p=>ze(Yi(p)),Pe=p=>ze(i.a4(p));function ze(p){return p.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function tt(p,r){let a=!1;if(r&&r.length)for(const f of r)f instanceof i.J?i.w(f.message):(p.fire(new i.z(new Error(f.message))),a=!0);return a}let Ue;class st extends i.E{constructor(r,a="flat"){super(),this._transitionable=new i.a6(Ue||(Ue=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(r,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,a,f={}){this._validate(lo,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=a)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&tt(this,r.call(jn,i.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let ut=class extends i.E{constructor(p,r,a,f){super(),this.scope=a,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),a,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(p,r){this._transitionable.setTransitionOrValue(p,r)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new i.aa(p)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const r=p.value.expression;if(!r)return null;let a=-1,f=-1,_=1;for(const v of r.zoomStops)_=r.evaluate(new i.aa(v)),_>.01?(a=v,f=-1):f=v;return _<.01&&a>0&&f>a?[a,f]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof i.ab}};const ot=45,Mt=65,jt=.05;function Vt(p,r,a,f){const _=i.ae(ot,Mt,a),[v,S]=yr(p,f);let R=1-Math.min(1,Math.exp((r-v)/(S-v)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*_*p.alpha}function yr(p,r){const a=.5/Math.tan(.5*r);return[p.range[0]+a,p.range[1]+a]}function Er(p,r,a,f,_){const v=i.ad.vec3.transformMat4([],[r,a,f],_.mercatorFogMatrix);return Vt(p,i.ad.vec3.length(v),_.pitch,_._fov)}function Cr(p,r,a,f,_,v,S){const R=[[a,f,0],[_,f,0],[_,v,0],[a,v,0]];let D=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const z of R){const B=i.ad.vec3.transformMat4([],z,r),V=i.ad.vec3.length(B);D=Math.min(D,V),N=Math.max(N,V)}return[Vt(p,D,S.pitch,S._fov),Vt(p,N,S.pitch,S._fov)]}class Ir extends i.E{constructor(r,a,f,_){super();const v=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(v,f,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new i.af(v),this.scope=f}get state(){const r=this._transform,a=r.projection.name==="globe",f=i.ag(r.zoom),_=this.properties.get("range"),v=[.5,3];return{range:a?[i.ah(v[0],_[0],f),i.ah(v[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,a,f={}){if(this._validate($h,r,f))return;const _=i.l({},r);for(const v of Object.keys(i.a5.fog))_[v]===void 0&&(_[v]=i.a5.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(ot,Mt,r))*a.a}getOpacityAtLatLng(r,a){return this._transform.projection.supportsFog?function(f,_,v){const S=i.ac.fromLngLat(_),R=v.elevation?v.elevation.getAtPointOrZero(S):0;return Er(f,S.x,S.y,R,v)}(this.state,r,a):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Cr(this.state,a,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(r,a,f,_,v){return this._transform.projection.supportsFog?Cr(this.state,r,a,f,_,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?yr(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const f of a){const _=r.points[f];let v;if(_[2]>=0)v=_;else{const S=r.points[f-4];v=i.aj(S,_,S[2]/(S[2]-_[2]))}if(Er(this.state,v[0],v[1],0,this._transform)>=jt)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,a,f){return(!f||f.validate!==!1)&&tt(this,r.call(jn,i.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let bn,zn,Lr,sn,on=class extends i.E{constructor(p,r,a,f){super();const _=bn||(bn=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(_,a,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(_),this.scope=a}get state(){const p=this.properties.get("opacity"),r=this.properties.get("color"),a=this.properties.get("direction"),f=i.ak(a[0]),_=-Math.max(i.ak(a[1]),.01),v=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette"),R=this.properties.get("vignette-color");return R.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(r.r,r.g,r.b,r.a*p),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:R}}get(){return this._transitionable.serialize()}set(p,r,a={}){if(this._validate(dd,p,a))return;const f=i.l({},p);for(const _ of Object.keys(i.a5.snow))f[_]===void 0&&(f[_]=i.a5.snow[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,r,a){return(!a||a.validate!==!1)&&tt(this,p.call(jn,i.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},un=class extends i.E{constructor(p,r,a,f){super();const _=zn||(zn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(_,a,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(_),this.scope=a}get state(){const p=this.properties.get("opacity"),r=this.properties.get("color"),a=this.properties.get("direction"),f=i.ak(a[0]),_=-Math.max(i.ak(a[1]),.01),v=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(r.r,r.g,r.b,r.a*p),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(p,r,a={}){if(this._validate(at,p,a))return;const f=i.l({},p);for(const _ of Object.keys(i.a5.rain))f[_]===void 0&&(f[_]=i.a5.rain[_].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,r,a){return(!a||a.validate!==!1)&&tt(this,p.call(jn,i.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Zn extends i.E{constructor(r,a,f,_){super(),this.scope=f,this._options=r,this.properties=new i.af(a),this._transitionable=new i.a6(a,f,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,a){this._options=r,this._transitionable.setTransitionOrValue(r.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ii{constructor(r,a,f,_){this.screenBounds=r,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,a){let f,_;if(r instanceof i.P||typeof r[0]=="number"){const v=i.P.convert(r);f=[v],_=a.isPointAboveHorizon(v)}else{const v=i.P.convert(r[0]),S=i.P.convert(r[1]);f=[v,S],_=i.an(v,S).every(R=>a.isPointAboveHorizon(R))}return new Ii(f,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.an(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),i.ao(_,r)}bufferedCameraGeometryGlobe(r){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],_=i.an(a,f,r),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>f.y))+((v.x>a.x)+(v.x>f.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(r,a,f,_=0){const v=r.queryPadding/a._pixelsPerMercatorPixel+1,S=f?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a);let R=r.tileID.wrap+(S.unwrapped?_:0);const D=S.polygon.map(ae=>i.ap(r.tileTransform,ae,R));if(!i.aq(D,0,0,i.ai,i.ai))return;R=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const N=this.screenGeometryMercator.polygon.map(ae=>i.ar(r.tileTransform,ae,R)),z=N.map(ae=>new i.P(ae[0],ae[1])),B=a.getFreeCameraOptions().position||new i.ac(0,0,0),V=i.ar(r.tileTransform,B,R),X=N.map(ae=>{const ce=i.ad.vec3.sub(ae,ae,V);return i.ad.vec3.normalize(ce,ce),new i.as(V,ce)}),se=i.at(r,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:X,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(te=i.au(D),te.min.x=i.ay(te.min.x,0,i.ai),te.min.y=i.ay(te.min.y,0,i.ai),te.max.x=i.ay(te.max.x,0,i.ai),te.max.y=i.ay(te.max.y,0,i.ai),te),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:se};var te}_bufferedScreenMercator(r,a){const f=ds(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),a):{polygon:this.bufferedScreenGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(r,a){const f=ds(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),a):{polygon:this.bufferedCameraGeometry(r).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(r,a){const f=function(v,S){const R=i.ad.mat4.multiply([],S.pixelMatrix,S.globeMatrix),D=[0,-i.az,0,1],N=[0,i.az,0,1],z=[0,0,0,1];i.ad.vec4.transformMat4(D,D,R),i.ad.vec4.transformMat4(N,N,R),i.ad.vec4.transformMat4(z,z,R);const B=new i.P(D[0]/D[3],D[1]/D[3]),V=new i.P(N[0]/N[3],N[1]/N[3]),X=i.aw(v,B)&&D[3]<z[3],se=i.aw(v,V)&&N[3]<z[3];if(!X&&!se)return null;const te=function(Te,Ee,Re){for(let Ne=1;Ne<Te.length;Ne++){const nt=co(Ee.pointCoordinate3D(Te[Ne-1]).x),We=co(Ee.pointCoordinate3D(Te[Ne]).x);if(Re<0){if(nt<We)return{idx:Ne,t:-nt/(We-1-nt)}}else if(We<nt)return{idx:Ne,t:(1-nt)/(We+1-nt)}}return null}(v,S,X?-1:1);if(!te)return null;const{idx:ae,t:ce}=te;let _e=ae>1?Qi(v.slice(0,ae),S):[],be=ae<v.length?Qi(v.slice(ae),S):[];_e=_e.map(Te=>new i.P(co(Te.x),Te.y)),be=be.map(Te=>new i.P(co(Te.x),Te.y));const xe=[..._e];xe.length===0&&xe.push(be[be.length-1]);const Ae=i.ah(xe[xe.length-1].y,(be.length===0?_e[0]:be[0]).y,ce);let Se;return Se=X?[new i.P(0,Ae),new i.P(0,0),new i.P(1,0),new i.P(1,Ae)]:[new i.P(1,Ae),new i.P(1,1),new i.P(0,1),new i.P(0,Ae)],xe.push(...Se),be.length===0?xe.push(_e[0]):xe.push(...be),{polygon:xe.map(Te=>new i.ac(Te.x,Te.y)),unwrapped:!1}}(r,a);if(f)return f;const _=function(v,S){let R=!1,D=-1/0,N=0;for(let B=0;B<v.length-1;B++)v[B].x>D&&(D=v[B].x,N=B);for(let B=0;B<v.length-1;B++){const V=(N+B)%(v.length-1),X=v[V],se=v[V+1];Math.abs(X.x-se.x)>.5&&(X.x<se.x?(X.x+=1,V===0&&(v[v.length-1].x+=1)):(se.x+=1,V+1===v.length-1&&(v[0].x+=1)),R=!0)}const z=i.av(S.center.lng);return R&&z<Math.abs(z-1)&&v.forEach(B=>{B.x-=1}),{polygon:v,unwrapped:R}}(Qi(r,a).map(v=>new i.P(co(v.x),v.y)),a);return{polygon:_.polygon.map(v=>new i.ac(v.x,v.y)),unwrapped:_.unwrapped}}}function Qi(p,r){return i.ax(p,a=>{const f=r.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function co(p){return p<0?1+p%1:p%1}function ds(p){return 100*p|0}function Pi(p,r,a,f,_){const v=function(R,D){if(R)return _(R);if(D){if(p.url&&D.tiles&&p.tiles&&delete p.tiles,D.variants){if(!Array.isArray(D.variants))return _(new Error("variants must be an array"));for(const z of D.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return _(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){D=i.l(D,z);break}}}const N=i.aA(i.l({},D,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=r.canonicalizeTileset(N,p.url),_(null,N)}},S=function(R,D,N){if(!R)return null;if(!D&&!N)return R;N=N||R.worldview_default;const z=Object.values(R.language||{});if(z.length===0)return null;const B=Object.values(R.worldview||{});if(B.length===0)return null;const V=z.every(se=>se===D),X=B.every(se=>se===N);return V&&X?R:D in(R.language_options||{})||N in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(p.data,a,f);return S?i.q.frame(()=>v(null,S)):p.url?i.n(r.transformRequest(r.normalizeSourceURL(p.url,null,a,f),i.R.Source),v):i.q.frame(()=>{const{data:R,...D}=p;v(null,D)})}class zi{constructor(r,a,f){this.bounds=i.aB.convert(this.validateBounds(r)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const a=Math.pow(2,r.z),f=Math.floor(i.av(this.bounds.getWest())*a),_=Math.floor(i.aC(this.bounds.getNorth())*a),v=Math.ceil(i.av(this.bounds.getEast())*a),S=Math.ceil(i.aC(this.bounds.getSouth())*a);return r.x>=f&&r.x<v&&r.y>=_&&r.y<S}}class xc extends i.E{constructor(r,a,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(a,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new i.aD}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Pi(this._options,this.map._requestManager,a,f,(_,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new i.z(_));else if(v){if(i.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of v.vector_layers)this.vectorLayerIds.push(S.id),v.worldview&&v.worldview[S.source]&&this.localizableLayerIds.add(S.id)}v.bounds&&(this.tileBounds=new zi(v.bounds,this.minzoom,this.maxzoom)),kt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(r,a){const f=r.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),v=this.map._requestManager.transformRequest(_,i.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,R=S?{image:S.image.clone()}:null,D={request:v,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:R,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(f)&&(D.worldview=this.map.getWorldview()||this.worldviewDefault,D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=a:r.request=r.actor.send("reloadTile",D,N.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",D,N.bind(this),void 0,!0);else{const z=i.aE.call({deduped:this._deduped},D,(B,V)=>{B||!V?N.call(this,B):(D.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},r.actor&&r.actor.send("loadTile",D,N.bind(this),void 0,!0))},!0);r.request={cancel:z}}function N(z,B){return delete r.request,r.aborted?a(null):z&&z.status!==404?a(z):(B&&B.resourceTiming&&(r.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&r.setExpiryData(B),r.loadVectorData(B,this.map.painter),i.aF(this.dispatcher),a(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,a){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class uo extends i.E{constructor(r,a,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},a),i.l(this,i.aA(a,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Pi(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new i.z(a)):f&&(i.l(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),f.bounds&&(this.tileBounds=new zi(f.bounds,this.minzoom,this.maxzoom)),kt(f.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(a)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,a){const f=i.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=i.o(this.map._requestManager.transformRequest(_,i.R.Tile),(v,S,R,D)=>(delete r.request,r.aborted?(r.state="unloaded",a(null)):v?(r.state="errored",a(v)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:R,expires:D}),r.setTexture(S,this.map.painter),r.state="loaded",i.aF(this.dispatcher),void a(null)):a(null)))}abortTile(r,a){r.request&&(r.request.cancel(),delete r.request),a&&a()}unloadTile(r,a){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ga extends uo{constructor(r,a,f,_){super(r,a,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},a)}triggerRepaint(r){const a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,a){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,i.R.Tile),v={request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor());const S=(R,D,N,z)=>{if(delete r.request,r.aborted)return r.state="unloaded",a(null);if(R)return R.name==="AbortError"?void 0:(r.state="errored",a(R));if(this.map._refreshExpiredTiles&&D&&r.setExpiryData({cacheControl:N,expires:z}),this.partial)r.state="empty";else{if(!D)return a(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=D;const B=new Map;for(const V in r._mrt.layers){const X=r.getLayer(V);if(X)for(const se of X.getBandList()){const{bytes:te,tileSize:ae,buffer:ce}=X.getBandView(se),_e=ae+2*ce,be={data:new i.r({width:_e,height:_e},te),pixelRatio:2,sdf:!1,usvg:!1,version:0};B.set(`${V}/${se}`,be)}}for(const V in this.iconsets)this.iconsets[V].addIcons(B)}a(null)};r.request=this.partial?r.fetchHeader(void 0,S.bind(this)):r.actor.send("loadTile",v,S.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,a){const f=r.texture;f&&f instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(f)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,a,f){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(a,f,(_,v)=>{if(_)return r.state="errored",this.fire(new i.z(_)),void this.triggerRepaint(r);v&&(r._isHeaderLoaded=!0,r.setTexture(v,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:v})=>v===r),f=a&&a.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(r,a,f){if(!r)return;const _=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;a instanceof i.aI?v=a.paint.get("raster-array-band"):a instanceof i.aJ&&(v=a.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(_);if(S!=null)if(r.textureDescriptor){if(!r.updateNeeded(_,S)||f)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,_,S)}addIconset(r,a){this.iconsets[r]=a,this.partial=!1}}const _m={vector:xc,raster:uo,"raster-dem":class extends uo{constructor(p,r,a,f){super(p,r,a,f),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,v){_&&(p.state="errored",r(_)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=i.o(this.map._requestManager.transformRequest(a,i.R.Tile),(function(_,v,S,R){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(_)p.state="errored",r(_);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:R});const D=ImageBitmap&&v instanceof ImageBitmap&&i.t(),N=1-(v.width-i.aG(v.width))/2;N<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const z=D?v:i.q.getImageData(v,N),B={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:N};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",B,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const r=p.canonical,a=Math.pow(2,r.z),f=(r.x-1+a)%a,_=r.x===0?p.wrap-1:p.wrap,v=(r.x+1+a)%a,S=r.x+1===a?p.wrap+1:p.wrap,R={};return R[new i.aH(p.overscaledZ,_,r.z,f,r.y).key]={backfilled:!1},R[new i.aH(p.overscaledZ,S,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(R[new i.aH(p.overscaledZ,_,r.z,f,r.y-1).key]={backfilled:!1},R[new i.aH(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},R[new i.aH(p.overscaledZ,S,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<a&&(R[new i.aH(p.overscaledZ,_,r.z,f,r.y+1).key]={backfilled:!1},R[new i.aH(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},R[new i.aH(p.overscaledZ,S,r.z,v,r.y+1).key]={backfilled:!1}),R}},"raster-array":ga,geojson:class extends i.E{constructor(p,r,a,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=r.data,this._options=i.l({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.ai,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const a of this._data.features)r.set(a.id,a);for(const a of p.features)r.set(a.id,a);this._data.features=[...r.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterLeaves(p,r,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:r,offset:a},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=i.l({append:p},this.workerOptions);r.scope=this.scope;const a=this._data;typeof a=="string"?(r.request=this.map._requestManager.transformRequest(i.q.resolveURL(a),i.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new i.z(f));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new i.A("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=i.C(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,r){const a=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,v=this._partialReload,S={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};p.request=this.actor.send(a,S,(R,D)=>v&&!D?(p.state="loaded",r(null)):(delete p.request,p.destroy(),p.aborted?r(null):R?r(R):(p.loadVectorData(D,this.map.painter,a==="reloadTile"),r(null))),void 0,a==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,r){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(p,r,a,f){super(p,r,a,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.aL(this.urls,(r,a)=>{this._loaded=!0,r?this.fire(new i.z(r)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(p,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(p,r,a,f){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const p=[];for(const r in this._options.models){const a=this._options.models[r],f=i.aN(this.map._requestManager.transformRequest(a.uri,i.R.Model).url).then(_=>{if(!_)return;const v=i.aO(_),S=new i.aP(r,a.position,a.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(_=>{this.fire(new i.z(new Error(`Could not load model ${r} from ${a.uri}: ${_.message}`)))});p.push(f)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new i.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,r){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(p,r,a,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Pi(this._options,this.map._requestManager,r,a,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new i.z(f))):_&&(i.l(this,_),_.bounds&&(this.tileBounds=new zi(_.bounds,this.minzoom,this.maxzoom)),kt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,r){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,i.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=r;else{if(p.buckets){const v=Object.values(p.buckets);for(const S of v)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,_.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(v,S){return p.aborted?r(null):v&&v.status!==404?r(v):(this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadModelData(S,this.map.painter),p.state="loaded",void r(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(p,r,a,f){super(p,r,a,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new i.z(new i.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends i.E{constructor(p,r,a,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zi(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:a,z:f}=p.canonical;return this._implementation.hasTile({x:r,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:a,y:f,z:_}=p.tileID.canonical,v=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:_},{signal:v.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",r(null)):S===void 0?(p.state="errored",r(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(p.state="errored",r(S))}),p.request.cancel=()=>v.abort()}loadTileData(p,r){p.setTexture(r,this.map.painter)}unloadTile(p,r){if(p.texture&&p.texture instanceof i.T?(p.destroy(!0),p.texture&&p.texture instanceof i.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:a,y:f,z:_}=p.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:_})}r&&r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=i.C(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Gh=function(p,r,a,f){const _=new _m[r.type](p,r,a,f);if(_.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${_.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],_),_};function hd(p,r,a=""){return`${a}:${r.id||""}:${r.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:_,importId:v}=f;return`featureset:${_}${v?`:import:${v}`:""}`}}(p.target)}`}function bc(p,r,a,f=""){if(p.uniqueFeatureID){const _=hd(p,r,f);if(a.has(_))return!0;a.add(_)}return!1}function ym(p,r,a,f,_=!1){const v=r.sourceCache.transform,S=r.sourceCache.tilesIn(p,r.has3DLayers,_);S.sort(vm);const R=[];for(const D of S){const N=D.tile.queryRenderedFeatures(r,D,a,f,v,_);Object.keys(N).length&&R.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:N})}return R.length===0?{}:function(D){const N={},z={};for(const B of D){const V=B.queryResults,X=B.wrappedTileID,se=z[X]=z[X]||{};for(const te in V){const ae=V[te],ce=se[te]=se[te]||{},_e=N[te]=N[te]||[];for(const be of ae)ce[be.featureIndex]||(ce[be.featureIndex]=!0,_e.push(be))}}return N}(R)}function Wy(p,r,a,f,_){const v={},S=f.queryRenderedSymbols(p),R=[];for(const D of Object.keys(S).map(Number))R.push(_[D]);R.sort(vm);for(const D of R){const N=D.featureIndex.lookupSymbolFeatures(S[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,r,a);for(const z in N){const B=v[z]=v[z]||[],V=N[z];V.sort((X,se)=>{const te=D.featureSortOrder;if(te){const ae=te.indexOf(X.featureIndex);return te.indexOf(se.featureIndex)-ae}return se.featureIndex-X.featureIndex});for(const X of V)B.push(X)}}return v}function Zy(p,r){const a=p.getRenderableIds().map(v=>p.getTileByID(v)),f=[],_={};for(let v=0;v<a.length;v++){const S=a[v],R=S.tileID.canonical.key;_[R]||(_[R]=!0,S.querySourceFeatures(f,r))}return f}function vm(p,r){const a=p.tileID,f=r.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}function wc(p,r){const a={};if(!r)return a;for(const f of p){const _=f.layerIds.map(v=>r.getLayer(v)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>_.filter(S=>S.id===v)[0]));for(const v of _)a[v.fqid]=f}}return a}const Gs=32,Io=33,sl=new Uint16Array(8184);for(let p=0;p<2046;p++){let r=p+2,a=0,f=0,_=0,v=0,S=0,R=0;for(1&r?_=v=S=Gs:a=f=R=Gs;(r>>=1)>1;){const N=a+_>>1,z=f+v>>1;1&r?(_=a,v=f,a=S,f=R):(a=_,f=v,_=S,v=R),S=N,R=z}const D=4*p;sl[D+0]=a,sl[D+1]=f,sl[D+2]=_,sl[D+3]=v}const qs=new Uint16Array(2178),Ps=new Uint8Array(1089),Sc=new Uint16Array(1089);function xm(p){return p===0?-.03125:p===32?.03125:0}const qh={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class Po{constructor(r,a,f,_,v){this.tileID=r,this.uid=i.aW(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<i.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=wc(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof i.aY){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof i.aY&&v.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_],S=a.style.getOwnLayer(_);if(!S)continue;const R=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,R)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,a,f){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,wc(r.buckets,a.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const _ in this.buckets){const v=this.buckets[_];v.uploadPending()&&v.upload(r)}const a=r.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new i.T(r,f.image,a.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(r,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(r,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(r,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=a.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(r,a,f,_,v,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=function(D,N){const z=i.ad.mat4.fromScaling([],[.5*D.width,.5*-D.height,1]);return i.ad.mat4.translate(z,z,[1,-1,0]),i.ad.mat4.multiply(z,z,D.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(z)}(v,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:a,pixelPosMatrix:R,transform:_,availableImages:f,tileTransform:this.tileTransform})}querySourceFeatures(r,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),v=a?a.sourceLayer:"",S=_._geojsonTileLayer||_[v];if(!S)return;const R=i.a_(a&&a.filter),{z:D,x:N,y:z}=this.tileID.canonical,B={z:D,x:N,y:z};for(let V=0;V<S.length;V++){const X=S.feature(V);if(R.needGeometry){const ae=i.a$(X,!0);if(!R.filter(new i.aa(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!R.filter(new i.aa(this.tileID.overscaledZ),X))continue;const se=f.getId(X,v),te=new i.b0(X,D,N,z,se);te.tile=B,r.push(te)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const f=i.b1(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(a)if(this.expirationTime<a)_=!0;else{const v=this.expirationTime-a;v?this.expirationTime=f+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,a){if(!this.latestFeatureIndex||!r.style)return;const f=this.latestFeatureIndex.loadVTLayers(),_=r.style.listImages(),v=r.style.getBrightness();for(const S in this.buckets){if(!r.style.hasLayer(S))continue;const R=this.buckets[S],D=R.layers[0],N=D.sourceLayer||"_geojsonTileLayer",z=f[N],B=r.style.getLayerSourceCache(D);let V={};B&&(V=B._state.getState(N,void 0));const X=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},se=Object.keys(V).length>0&&!a;se&&!R.stateDependentLayers.length&&!a||R.update(V,z,_,X,se?R.stateDependentLayers:R.layers,a,v),(R instanceof i.b2||R instanceof i.b3)&&r._terrain&&r._terrain.enabled&&B&&R.uploadPending()&&r._terrain._clearRenderCacheForTile(B.id,this.tileID);const te=r&&r.style&&r.style.getOwnLayer(S);te&&(this.queryPadding=Math.max(this.queryPadding,te.queryRadius(R)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.q.now()+r}setTexture(r,a){const f=a.context,_=f.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r):(this.texture=new i.T(f,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,a){const f={};for(const _ of a)f[_]=!0;this.dependencies[r]=f}hasDependency(r,a){for(const f of r){const _=this.dependencies[f];if(_){for(const v of a)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const f=i.b4(qh,this.tileID.canonical,this.tileTransform)[0],_=new i.b5,v=new i.b6;for(let S=0;S<f.length;S++){const{x:R,y:D}=f[S];_.emplaceBack(R,D),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(_,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const f=i.b4(qh,this.tileID.canonical,this.tileTransform)[0];let _,v;if(this.isRaster){const S=function(R,D){const N=i.aR(R,D),z=Math.pow(2,R.z);for(let ae=0;ae<Io;ae++)for(let ce=0;ce<Io;ce++){const _e=i.aS((R.x+(ce+xm(ce))/Gs)/z),be=i.aT((R.y+(ae+xm(ae))/Gs)/z),xe=D.project(_e,be),Ae=ae*Io+ce;qs[2*Ae+0]=Math.round((xe.x*N.scale-N.x)*i.ai),qs[2*Ae+1]=Math.round((xe.y*N.scale-N.y)*i.ai)}Ps.fill(0),Sc.fill(0);for(let ae=2045;ae>=0;ae--){const ce=4*ae,_e=sl[ce+0],be=sl[ce+1],xe=sl[ce+2],Ae=sl[ce+3],Se=_e+xe>>1,Te=be+Ae>>1,Ee=Se+Te-be,Re=Te+_e-Se,Ne=be*Io+_e,nt=Ae*Io+xe,We=Te*Io+Se,pt=Math.hypot((qs[2*Ne+0]+qs[2*nt+0])/2-qs[2*We+0],(qs[2*Ne+1]+qs[2*nt+1])/2-qs[2*We+1])>=16;Ps[We]=Ps[We]||(pt?1:0),ae<1022&&(Ps[We]=Ps[We]||Ps[(be+Re>>1)*Io+(_e+Ee>>1)]||Ps[(Ae+Re>>1)*Io+(xe+Ee>>1)])}const B=new i.aU,V=new i.aV;let X=0;function se(ae,ce){const _e=ce*Io+ae;return Sc[_e]===0&&(B.emplaceBack(qs[2*_e+0],qs[2*_e+1],ae*i.ai/Gs,ce*i.ai/Gs),Sc[_e]=++X),Sc[_e]-1}function te(ae,ce,_e,be,xe,Ae){const Se=ae+_e>>1,Te=ce+be>>1;if(Math.abs(ae-xe)+Math.abs(ce-Ae)>1&&Ps[Te*Io+Se])te(xe,Ae,ae,ce,Se,Te),te(_e,be,xe,Ae,Se,Te);else{const Ee=se(ae,ce),Re=se(_e,be),Ne=se(xe,Ae);V.emplaceBack(Ee,Re,Ne)}}return te(0,0,Gs,Gs,Gs,0),te(Gs,Gs,0,0,0,Gs),{vertices:B,indices:V}}(this.tileID.canonical,a);_=S.vertices,v=S.indices}else{_=new i.aU,v=new i.aV;for(const{x:R,y:D}of f)_.emplaceBack(R,D,0,0);const S=i.b9(_.int16,void 0,4);for(let R=0;R<S.length;R+=3)v.emplaceBack(S[R],S[R+1],S[R+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,i.ba.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=i.b8.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(r,a){const f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;const _=this.tileID.canonical,v=i.bb(_,a),S=i.bc(v),R=i.ag(a.zoom);let D;R>0&&(D=i.ad.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,a,S,D,R),this._makeGlobeTileDebugTextBuffer(r,_,a,S,D,R)}_globePoint(r,a,f,_,v,S,R){let D=i.bd(r,a,f);if(S){const N=1<<f.z,z=i.av(_.center.lng),B=i.aC(_.center.lat),V=(f.x+.5)/N-z;let X=0;V>.5?X=-1:V<-.5&&(X=1);let se=(r/i.ai+f.x)/N+X,te=(a/i.ai+f.y)/N;se=(se-z)*_._pixelsPerMercatorPixel+z,te=(te-B)*_._pixelsPerMercatorPixel+B;const ae=[se*_.worldSize,te*_.worldSize,0];i.ad.vec3.transformMat4(ae,ae,S),D=i.be(D,ae,R)}return i.ad.vec3.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(r,a,f,_,v,S){const R=new i.b5,D=new i.b6,N=new i.bf,z=(V,X,se,te,ae)=>{const ce=(se-V)/(ae-1),_e=(te-X)/(ae-1),be=R.length;for(let xe=0;xe<ae;xe++){const Ae=V+xe*ce,Se=X+xe*_e;R.emplaceBack(Ae,Se);const Te=this._globePoint(Ae,Se,a,f,_,v,S);N.emplaceBack(Te[0],Te[1],Te[2]),D.emplaceBack(be+xe)}},B=i.ai;z(0,0,B,0,16),z(B,0,B,B,16),z(B,B,0,B,16),z(0,B,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(R,i.b7.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(N,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,R.length,D.length)}_makeGlobeTileDebugTextBuffer(r,a,f,_,v,S){const R=i.ai/4,D=new i.b5,N=new i.aV,z=new i.bf,B=25;N.reserve(32),D.reserve(B),z.reserve(B);const V=(X,se)=>B*X+se;for(let X=0;X<B;X++){const se=X*R;for(let te=0;te<B;te++){const ae=te*R;D.emplaceBack(ae,se);const ce=this._globePoint(ae,se,a,f,_,v,S);z.emplaceBack(ce[0],ce[1],ce[2])}}for(let X=0;X<4;X++)for(let se=0;se<4;se++){const te=V(X,se),ae=V(X,se+1),ce=V(X+1,se),_e=V(X+1,se+1);N.emplaceBack(te,ae,ce),N.emplaceBack(ce,ae,_e)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(N),this._tileDebugTextBuffer=r.createVertexBuffer(D,i.b7.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(z,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,B,32)}destroy(r=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class ws extends Po{constructor(r,a,f,_,v){super(r,a,f,_,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexture(r,a){const f=a.context,_=f.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{premultiply:!1}):this.texture=new i.T(f,r,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,a){const f=this._mrt=new i.bh(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=i.bj(_,(v,S,R,D)=>{if(v)a(v);else try{const N=f.getHeaderLength(S);if(N>r)return void(this.request=this.fetchHeader(N,a));f.parseHeader(S),this._isHeaderLoaded=!0;let z=0;for(const B of Object.values(f.layers))z=Math.max(z,B.dataIndex[B.dataIndex.length-1].lastByte);S.byteLength>=z&&(this.entireBuffer=S),a(null,this.entireBuffer||S,R,D)}catch(N){a(N)}}),this.request}fetchBand(r,a,f){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void f(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let S;const R=(B,V)=>{S.complete(B,V),B?f(B):(this.updateTextureDescriptor(r,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(B,V)=>{if(B)return f(B);const X=v.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:V,task:S},R,void 0,!0);this._workQueue.push(()=>{X&&X.cancel(),S.cancel()})},N=_.getLayer(r);if(!N)return void f(new Error(`Unknown sourceLayer "${r}"`));if(N.hasDataForBand(a))return this.updateTextureDescriptor(r,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=N.getDataRange([a]);if(S=_.createDecodingTask(z),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),V=i.bj(B,D);this._fetchQueue.push(()=>{V.cancel(),S.cancel()})}else f(null)}updateNeeded(r,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,a){if(!this._mrt)return;const f=this._mrt.getLayer(r);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;const{bytes:_,tileSize:v,buffer:S,offset:R,scale:D}=f.getBandView(a),N=v+2*S,z=new i.r({width:N,height:N},_),B=this.texture;B&&B instanceof i.T&&B.update(z,{premultiply:!1}),this.textureDescriptor={layer:r,band:a,img:z,buffer:S,offset:R,tileSize:v,format:f.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class Xy{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:a,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},f)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const f=r.wrapped().key,_=a===void 0?0:this.data[f].indexOf(a),v=this.data[f][_];return this.data[f].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||a.push(_);for(const f of a)this.remove(f.value.tileID,f)}}class bm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,f){const _=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},i.l(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==_&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const v in this.state[r][_])f[v]||(this.deletedStates[r][_][v]=null)}else for(const v in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][v]===null&&delete this.deletedStates[r][_][v]}removeFeatureState(r,a,f){if(this.deletedStates[r]===null)return;const _=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&a!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(a!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,a){const f=this.state[r]||{},_=this.stateChanges[r]||{},v=this.deletedStates[r];if(v===null)return{};if(a!==void 0){const R=String(a),D=i.l({},f[R],_[R]);if(v){const N=v[a];if(N===null)return{};for(const z in N)delete D[z]}return D}const S=i.l({},f,_);if(v)for(const R in v)delete S[R];return S}initializeTileState(r,a){r.refreshFeatureState(a)}coalesceChanges(r,a){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const S in this.stateChanges[_])this.state[_][S]||(this.state[_][S]={}),i.l(this.state[_][S],this.stateChanges[_][S]),v[S]=this.state[_][S];f[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const S in this.state[_])v[S]={},this.state[_][S]={};else for(const S in this.deletedStates[_]){if(this.deletedStates[_][S]===null)this.state[_][S]={};else if(this.state[_][S])for(const R of Object.keys(this.deletedStates[_][S]))delete this.state[_][S][R];v[S]=this.state[_][S]}f[_]=f[_]||{},i.l(f[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].refreshFeatureState(a)}}class ho extends i.E{constructor(r,a,f){super(),this.id=r,this._onlySymbols=f,a.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Xy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new bm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(r),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(an).map(r=>r.key)}getRenderableIds(r,a){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,r,a)&&f.push(this._tiles[_]);return r?f.sort((_,v)=>{const S=_.tileID,R=v.tileID,D=new i.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),N=new i.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-R.overscaledZ||N.y-D.y||N.x-D.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(an).map(_=>_.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,r,a)))}_tileLoaded(r,a,f,_){if(_)if(r.state="errored",_.status!==404)this._source.fire(new i.z(_,{tile:r}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=i.q.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let _=0;_<a.length;_++){const v=a[_];if(r.neighboringTiles&&r.neighboringTiles[v]){const S=this.getTileByID(v);f(r,S),f(S,r)}}function f(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-_.tileID.canonical.x;const R=v.tileID.canonical.y-_.tileID.canonical.y,D=Math.pow(2,_.tileID.canonical.z),N=v.tileID.key;S===0&&R===0||Math.abs(R)>1||(Math.abs(S)>1&&(Math.abs(S+D)===1?S+=D:Math.abs(S-D)===1&&(S-=D)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,S,R),_.neighboringTiles&&_.neighboringTiles[N]&&(_.neighboringTiles[N].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,f,_){for(const v in this._tiles){let S=this._tiles[v];if(_[v]||!S.hasData()||S.tileID.overscaledZ<=a||S.tileID.overscaledZ>f)continue;let R=S.tileID;for(;S&&S.tileID.overscaledZ>a+1;){const N=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[N.key],S&&S.hasData()&&(R=N)}let D=R;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){_[R.key]=R;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=r.overscaledZ-1;f>=a;f--){const _=r.scaledTo(f),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const f=Math.ceil(r.width/a)+1,_=Math.ceil(r.height/a)+1,v=Math.floor(f*_*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(R)}handleWrapJump(r){const a=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,a){const f={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+a),f[v.tileID.key]=v}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,a,f,_){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(r,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let S,R=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const B=D.attenuationRange()[0],V=Math.floor(B)-Math.log2(D.getDemUpscale());R>V&&(R=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new i.aH(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=r.clone();B.tileCoverLift=this.tileCoverLift,S=B.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&r.projection.name==="globe"&&(S.push(new i.aH(1,0,1,0,0)),S.push(new i.aH(1,0,1,1,0)),S.push(new i.aH(1,0,1,0,1)),S.push(new i.aH(1,0,1,1,1)))}else if(S=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);S=S.filter(V=>B(V))}}else S=[];if(S.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!wm(this._source.type)){const B=r.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),V=Math.min(B,this._source.maxzoom);if(v){const X=r.extendTileCover(S,V);for(const se of X)S.push(se)}else{const X=r.extendTileCover(S,V,_);for(const se of X)this._shadowCasterTiles[se.key]=!0,S.push(se)}}const N=this._updateRetainedTiles(S);if(wm(this._source.type)&&S.length!==0){const B={},V={},X=Object.keys(N);for(const te of X){const ae=N[te],ce=this._tiles[te];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=i.q.now())continue;const _e=this.findLoadedParent(ae,Math.max(ae.overscaledZ-ho.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),B[_e.tileID.key]=_e.tileID),V[te]=ae}const se=S[S.length-1].overscaledZ;for(const te in this._tiles){const ae=this._tiles[te];if(N[te]||!ae.hasData())continue;let ce=ae.tileID;for(;ce.overscaledZ>se;){ce=ce.scaledTo(ce.overscaledZ-1);const _e=this._tiles[ce.key];if(_e&&_e.hasData()&&V[ce.key]){N[te]=ae.tileID;break}}}for(const te in B)N[te]||(this._coveredTiles[te]=!0,N[te]=B[te])}for(const B in N)this._tiles[B].clearFadeHold();const z=i.bk(this._tiles,N);for(const B of z){const V=this._tiles[B];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(r.length===0)return a;const f={},_=r.reduce((N,z)=>Math.min(N,z.overscaledZ),1/0),v=r[0].overscaledZ,S=Math.max(v-ho.maxOverzooming,this._source.minzoom),R=Math.max(v+ho.maxUnderzooming,this._source.minzoom),D={};for(const N of r){const z=this._addTile(N);a[N.key]=N,z.hasData()||_<this._source.maxzoom&&(D[N.key]=N)}this._retainLoadedChildren(D,_,R,a);for(const N of r){let z=this._tiles[N.key];if(z.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const V=N.children(this._source.maxzoom)[0],X=this.getTile(V);if(X&&X.hasData()){a[V.key]=V;continue}}else{const V=N.children(this._source.maxzoom);if(a[V[0].key]&&a[V[1].key]&&a[V[2].key]&&a[V[3].key])continue}let B=z.wasRequested();for(let V=N.overscaledZ-1;V>=S;--V){const X=N.scaledTo(V);if(f[X.key]||(f[X.key]=!0,z=this.getTile(X),!z&&B&&(z=this._addTile(X)),z&&(a[X.key]=X,B=z.wasRequested(),z.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}a.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;_=v}for(const v of a)this._loadedParentTiles[v]=f}}_addTile(r){let a=this._tiles[r.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const f=!!a;if(!f){const _=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();a=this._source.type==="raster-array"?new ws(r,v,this.transform.tileZoom,_,this._isRaster):new Po(r,v,this.transform.tileZoom,_,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,f||this._source.fire(new i.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=a.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,f){const _=[],v=this.transform;if(!v)return _;const S=v.projection.name==="globe",R=i.av(v.center.lng);for(const D in this._tiles){const N=this._tiles[D];if(f&&N.clearQueryDebugViz(),N.holdingForFade())continue;let z;if(S){const B=N.tileID.canonical;if(B.z===0){const V=[Math.abs(i.ay(R,...or(B,-1))-R),Math.abs(i.ay(R,...or(B,1))-R)];z=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(i.ay(R,...or(B,-1))-R),Math.abs(i.ay(R,...or(B,0))-R),Math.abs(i.ay(R,...or(B,1))-R)];z=[V.indexOf(Math.min(...V))-1]}}else z=[0];for(const B of z){const V=r.containsTile(N,v,a,B);V&&_.push(V)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,a){const f=this.getRenderableIds(r,a).map(v=>this._tiles[v].tileID),_=this.transform.projection.name==="globe";for(const v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(r){const a=r.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(const S of a){const R=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*R+S.wrap-f[0])*_[0]+((S.canonical.y+.5)*R-f[1])*_[1]-f[2]*_[2]}return a.sort((S,R)=>v[S.key]-v[R.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(wm(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(r,a,f){this._state.updateState(r=r||"_geojsonTileLayer",a,f)}removeFeatureState(r,a,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,f)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,f){const _=this._tiles[r];_&&_.setDependencies(a,f)}reloadTilesForDependencies(r,a){for(const f in this._tiles)this._tiles[f].hasDependency(r,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(r,a))};return void this._source.on("data",D)}const f=new Map,_=Array.isArray(r)?r:[r],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const D of _){const N=D.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of N)f.set(z.key,z);this.usedForTerrain&&D.updateElevation(!1)}const R=Array.from(f.values());i.bl(R,(D,N)=>{const z=new Po(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,B=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),N(B,z)})},a)}}function an(p,r){const a=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return p.overscaledZ-r.overscaledZ||f-a||r.canonical.y-p.canonical.y||r.canonical.x-p.canonical.x}function wm(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function or(p,r){const a=1<<p.z;return[p.x/a+r,(p.x+1)/a+r]}ho.maxOverzooming=10,ho.maxUnderzooming=3;class Ky{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,a=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:r,visibilityChanged:a});else if(_.type==="model"){const v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:a})}}}onNewFrame(r){this.layersGotHidden=!1;for(const a of this.layers){const f=a.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(_=!f.isHidden(r)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&a.visible,a.visible=_}}updateZOffset(r,a){this.currentBuildingBuckets=[];for(const _ of this.layers){const v=_.layer,S=this.style.getLayerSourceCache(v);let R=1;v.type==="fill-extrusion"&&(R=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=S?S.getTile(a):null;if(!D&&S&&a.canonical.z>S.getSource().minzoom){let N=a.scaledTo(Math.min(S.getSource().maxzoom,a.overscaledZ-1));for(;N.overscaledZ>=S.getSource().minzoom&&(D=S.getTile(N),!D&&N.overscaledZ!==0);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:a,verticalScale:R})}r.hasAnyZOffset=!1;let f=!1;for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_),S=v.zOffset,R=this._getHeightAtTileOffset(a,v.tileAnchorX,v.tileAnchorY);v.zOffset=R!==Number.NEGATIVE_INFINITY?R:S,f||S===v.zOffset||(f=!0),r.hasAnyZOffset||v.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,a,f,_){let v=a,S=f;if(r.canonical.z!==_.canonical.z){const R=_.canonical,D=1/(1<<r.canonical.z-R.z);v=(a+r.canonical.x*i.ai)*D-R.x*i.ai|0,S=(f+r.canonical.y*i.ai)*D-R.y*i.ai|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(r,a,f){let _,v;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:R,tileID:D,verticalScale:N}=this.currentBuildingBuckets[S];if(!R)continue;const{tileX:z,tileY:B}=this._mapCoordToOverlappingTile(r,a,f,D),V=R.getHeightAtTileCoord(z,B);V&&V.height!==void 0&&(V.hidden?_=V.height:v=Math.max(V.height*N,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const R=this.layers[S];if(R.layer.type!=="model"||!R.visible)continue;const{bucket:D,tileID:N}=this.currentBuildingBuckets[S];if(!D)continue;const{tileX:z,tileY:B}=this._mapCoordToOverlappingTile(r,a,f,N),V=D.getHeightAtTileCoord(z,B);if(V&&!V.hidden)return V.height===void 0&&_!==void 0?Math.min(V.maxHeight,_)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Yy(p,r){const a={};for(const f in p)f!=="ref"&&(a[f]=p[f]);return i.bm.forEach(f=>{f in r&&(a[f]=r[f])}),a}function fd(p){p=p.slice();const r=Object.create(null);for(let a=0;a<p.length;a++)r[p[a].id]=p[a];for(let a=0;a<p.length;a++)"ref"in p[a]&&(p[a]=Yy(p[a],r[p[a].ref]));return p}const Kr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function fo(p,r,a){a.push({command:Kr.addSource,args:[p,r[p]]})}function Hh(p,r,a){r.push({command:Kr.removeSource,args:[p]}),a[p]=!0}function Tc(p,r,a,f){Hh(p,a,f),fo(p,r,a)}function Kt(p,r,a){let f;for(f in p[a])if(p[a].hasOwnProperty(f)&&f!=="data"&&!i.bn(p[a][f],r[a][f]))return!1;for(f in r[a])if(r[a].hasOwnProperty(f)&&f!=="data"&&!i.bn(p[a][f],r[a][f]))return!1;return!0}function nn(p,r,a,f,_,v){let S;for(S in r=r||{},p=p||{})p.hasOwnProperty(S)&&(i.bn(p[S],r[S])||a.push({command:v,args:[f,S,r[S],_]}));for(S in r)r.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(i.bn(p[S],r[S])||a.push({command:v,args:[f,S,r[S],_]}))}function Wr(p){return p.id}function es(p,r){return p[r.id]=r,p}class Ec{constructor(r,a){this.reset(r,a)}reset(r,a){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.ay(r,0,1);let a=1,f=this._distances[a];const _=r*this.paddedLength+this.padding;for(;f<_&&a<this._distances.length;)f=this._distances[++a];const v=a-1,S=this._distances[v],R=f-S,D=R>0?(_-S)/R:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}class Yr{constructor(r,a,f){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(a/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=a,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,a,f,_,v){this._forEachCell(a,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(r,a,f,_){this._forEachCell(a-_,f-_,a+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(a),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,a,f,_,v,S){this.boxCells[v].push(S)}_insertCircleCell(r,a,f,_,v,S){this.circleCells[v].push(S)}_query(r,a,f,_,v,S){if(f<0||r>this.width||_<0||a>this.height)return!v&&[];const R=[];if(r<=0&&a<=0&&this.width<=f&&this.height<=_){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)R.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const N=this.circles[3*D],z=this.circles[3*D+1],B=this.circles[3*D+2];R.push({key:this.circleKeys[D],x1:N-B,y1:z-B,x2:N+B,y2:z+B})}return S?R.filter(S):R}return this._forEachCell(r,a,f,_,this._queryCell,R,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?R.length>0:R}_queryCircle(r,a,f,_,v){const S=r-f,R=r+f,D=a-f,N=a+f;if(R<0||S>this.width||N<0||D>this.height)return!_&&[];const z=[];return this._forEachCell(S,D,R,N,this._queryCellCircle,z,{hitTest:_,circle:{x:r,y:a,radius:f},seenUids:{box:{},circle:{}}},v),_?z.length>0:z}query(r,a,f,_,v){return this._query(r,a,f,_,!1,v)}hitTest(r,a,f,_,v){return this._query(r,a,f,_,!0,v)}hitTestCircle(r,a,f,_){return this._queryCircle(r,a,f,!0,_)}_queryCell(r,a,f,_,v,S,R,D){const N=R.seenUids,z=this.boxCells[v];if(z!==null){const V=this.bboxes;for(const X of z)if(!N.box[X]){N.box[X]=!0;const se=4*X;if(r<=V[se+2]&&a<=V[se+3]&&f>=V[se+0]&&_>=V[se+1]&&(!D||D(this.boxKeys[X]))){if(R.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[X],x1:V[se],y1:V[se+1],x2:V[se+2],y2:V[se+3]})}}}const B=this.circleCells[v];if(B!==null){const V=this.circles;for(const X of B)if(!N.circle[X]){N.circle[X]=!0;const se=3*X;if(this._circleAndRectCollide(V[se],V[se+1],V[se+2],r,a,f,_)&&(!D||D(this.circleKeys[X]))){if(R.hitTest)return S.push(!0),!0;{const te=V[se],ae=V[se+1],ce=V[se+2];S.push({key:this.circleKeys[X],x1:te-ce,y1:ae-ce,x2:te+ce,y2:ae+ce})}}}}}_queryCellCircle(r,a,f,_,v,S,R,D){const N=R.circle,z=R.seenUids,B=this.boxCells[v];if(B!==null){const X=this.bboxes;for(const se of B)if(!z.box[se]){z.box[se]=!0;const te=4*se;if(this._circleAndRectCollide(N.x,N.y,N.radius,X[te+0],X[te+1],X[te+2],X[te+3])&&(!D||D(this.boxKeys[se])))return S.push(!0),!0}}const V=this.circleCells[v];if(V!==null){const X=this.circles;for(const se of V)if(!z.circle[se]){z.circle[se]=!0;const te=3*se;if(this._circlesCollide(X[te],X[te+1],X[te+2],N.x,N.y,N.radius)&&(!D||D(this.circleKeys[se])))return S.push(!0),!0}}}_forEachCell(r,a,f,_,v,S,R,D){const N=this._convertToXCellCoord(r),z=this._convertToYCellCoord(a),B=this._convertToXCellCoord(f),V=this._convertToYCellCoord(_);for(let X=N;X<=B;X++)for(let se=z;se<=V;se++)if(v.call(this,r,a,f,_,this.xCellCount*se+X,S,R,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,a,f,_,v,S){const R=_-r,D=v-a,N=f+S;return N*N>R*R+D*D}_circleAndRectCollide(r,a,f,_,v,S,R){const D=(S-_)/2,N=Math.abs(r-(_+D));if(N>D+f)return!1;const z=(R-v)/2,B=Math.abs(a-(v+z));if(B>z+f)return!1;if(N<=D||B<=z)return!0;const V=N-D,X=B-z;return V*V+X*X<=f*f}}const _a={unknown:0,flipRequired:1,flipNotRequired:2},pd=Math.tan(85*Math.PI/180);function ya(p,r,a,f,_,v,S){const R=i.ad.mat4.create();if(a)if(v.name==="globe"){const D=i.bo(_,r);i.ad.mat4.multiply(R,R,D)}else{const D=i.ad.mat2.invert([],S);R[0]=D[0],R[1]=D[1],R[4]=D[2],R[5]=D[3],f||i.ad.mat4.rotateZ(R,R,_.angle)}else i.ad.mat4.multiply(R,_.labelPlaneMatrix,p);return R}function $i(p,r,a,f,_,v,S){const R=ya(p,r,a,f,_,v,S);return v.name==="globe"&&a||(R[2]=R[6]=R[10]=R[14]=0),R}function Xn(p,r,a,f,_,v,S){if(a){if(v.name==="globe"){const R=ya(p,r,a,f,_,v,S);return i.ad.mat4.invert(R,R),i.ad.mat4.multiply(R,p,R),R}{const R=i.ad.mat4.clone(p),D=i.ad.mat4.identity([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],i.ad.mat4.multiply(R,R,D),f||i.ad.mat4.rotateZ(R,R,-_.angle),R}}return _.glCoordMatrix}function Ro(p,r,a,f){const _=[p,r,a,1];a?i.ad.vec4.transformMat4(_,_,f):ii(_,_,f);const v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function Cc(p,r){return Math.min(.5+p/r*.5,1.5)}function Sm(p,r){const a=p[0]/p[3],f=p[1]/p[3];return a>=-r[0]&&a<=r[0]&&f>=-r[1]&&f<=r[1]}function Ac(p,r,a,f,_,v,S,R,D,N){const z=a.transform,B=f?p.textSizeData:p.iconSizeData,V=i.bp(B,a.transform.zoom),X=z.projection.name==="globe",se=[256/a.width*2+1,256/a.height*2+1],te=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;te.clear();let ae=null;X&&(ae=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ce=p.lineVertexArray,_e=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,be=a.transform.width/a.transform.height;let xe,Ae=!1;for(let Se=0;Se<_e.length;Se++){const Te=_e.get(Se),{numGlyphs:Ee,writingMode:Re}=Te;if(Re!==i.bq.vertical||Ae||xe===i.bq.horizontal||(Ae=!0),xe=Re,(Te.hidden||Re===i.bq.vertical)&&!Ae){ko(Ee,te);continue}Ae=!1;const Ne=new i.P(Te.tileAnchorX,Te.tileAnchorY);let{x:nt,y:We,z:pt}=z.projection.projectTilePoint(Ne.x,Ne.y,N.canonical);if(D){const[Nt,Ot,Zt]=D(Ne);nt+=Nt,We+=Ot,pt+=Zt}const gt=[nt,We,pt,1];if(i.ad.vec4.transformMat4(gt,gt,r),!Sm(gt,se)){ko(Ee,te);continue}const Ct=gt[3],Ge=Cc(a.transform.getCameraToCenterDistance(z.projection),Ct),ft=i.br(B,V,Te),Ve=S?ft/Ge:ft*Ge,ht=Ro(nt,We,pt,_);if(ht[3]<=0){ko(Ee,te);continue}let lt={};const _t=i.ak(p.layers[0].layout.get("text-max-angle")),it=Math.cos(_t),vt=S?null:D,Lt=ts(Te,Ve,!1,R,r,_,v,p.glyphOffsetArray,ce,te,ae,ht,Ne,lt,be,vt,z.projection,N,S,it);Ae=Lt.useVertical,vt&&Lt.needsFlipping&&(lt={}),(Lt.notEnoughRoom||Ae||Lt.needsFlipping&&ts(Te,Ve,!0,R,r,_,v,p.glyphOffsetArray,ce,te,ae,ht,Ne,lt,be,vt,z.projection,N,S,it).notEnoughRoom)&&ko(Ee,te)}f?(p.text.dynamicLayoutVertexBuffer.updateData(te),ae&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ae)):(p.icon.dynamicLayoutVertexBuffer.updateData(te),ae&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ae))}function Wh(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae){const{lineStartIndex:ce,glyphStartIndex:_e,segment:be}=R,xe=_e+R.numGlyphs,Ae=ce+R.lineLength,Se=r.getoffsetX(_e),Te=r.getoffsetX(xe-1),Ee=gd(p*Se,a,f,_,v,S,be,ce,Ae,D,N,z,B,V,!0,X,se,te,ae);if(!Ee)return null;const Re=gd(p*Te,a,f,_,v,S,be,ce,Ae,D,N,z,B,V,!0,X,se,te,ae);return Re?{first:Ee,last:Re}:null}function md(p,r,a,f){return p===i.bq.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:p===i.bq.vertical?f>0?{needsFlipping:!0}:null:r!==_a.unknown&&function(_,v){return _===0||Math.abs(v/_)>pd}(a,f)?r===_a.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function ts(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e,be){const xe=r/24,Ae=p.lineOffsetX*xe,Se=p.lineOffsetY*xe,{lineStartIndex:Te,glyphStartIndex:Ee,numGlyphs:Re,segment:Ne,writingMode:nt,flipState:We}=p,pt=Te+p.lineLength,gt=Ct=>{if(z){const[ht,lt,_t]=Ct.up,it=N.length;i.bs(z,it+0,ht,lt,_t),i.bs(z,it+1,ht,lt,_t),i.bs(z,it+2,ht,lt,_t),i.bs(z,it+3,ht,lt,_t)}const[Ge,ft,Ve]=Ct.point;i.bt(N,Ge,ft,Ve,Ct.angle)};if(Re>1){const Ct=Wh(xe,R,Ae,Se,a,B,V,p,D,v,X,te,!1,ae,ce,_e,be);if(!Ct)return{notEnoughRoom:!0};if(f&&!a){let[Ge,ft,Ve]=Ct.first.point,[ht,lt,_t]=Ct.last.point;[Ge,ft]=Ro(Ge,ft,Ve,S),[ht,lt]=Ro(ht,lt,_t,S);const it=md(nt,We,(ht-Ge)*se,lt-ft);if(p.flipState=it&&it.needsFlipping?_a.flipRequired:_a.flipNotRequired,it)return it}gt(Ct.first);for(let Ge=Ee+1;Ge<Ee+Re-1;Ge++){const ft=gd(xe*R.getoffsetX(Ge),Ae,Se,a,B,V,Ne,Te,pt,D,v,X,te,!1,!1,ae,ce,_e,be);if(!ft)return N.length-=4*(Ge-Ee),{notEnoughRoom:!0};gt(ft)}gt(Ct.last)}else{if(f&&!a){const Ge=Ro(V.x,V.y,0,_),ft=Te+Ne+1,Ve=new i.P(D.getx(ft),D.gety(ft)),ht=Ro(Ve.x,Ve.y,0,_),lt=ht[3]>0?ht:rs(V,Ve,Ge,1,_,void 0,ae,ce.canonical),_t=md(nt,We,(lt[0]-Ge[0])*se,lt[1]-Ge[1]);if(p.flipState=_t&&_t.needsFlipping?_a.flipRequired:_a.flipNotRequired,_t)return _t}const Ct=gd(xe*R.getoffsetX(Ee),Ae,Se,a,B,V,Ne,Te,pt,D,v,X,te,!1,!1,ae,ce,_e,be);if(!Ct)return{notEnoughRoom:!0};gt(Ct)}return{}}function Qo(p,r,a,f,_){const{x:v,y:S,z:R}=f.projectTilePoint(p.x,p.y,r);if(!_)return Ro(v,S,R,a);const[D,N,z]=_(p);return Ro(v+D,S+N,R+z,a)}function rs(p,r,a,f,_,v,S,R){const D=Qo(p.sub(r)._unit()._add(p),R,_,S,v);return i.ad.vec3.sub(D,a,D),i.ad.vec3.normalize(D,D),i.ad.vec3.scaleAndAdd(D,a,D,f)}function gd(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e){const be=f?p-r:p+r;let xe=be>0?1:-1,Ae=0;f&&(xe*=-1,Ae=Math.PI),xe<0&&(Ae+=Math.PI);let Se=R+S+(xe>0?0:1)|0,Te=_,Ee=_,Re=0,Ne=0;const nt=Math.abs(be),We=[],pt=[];let gt=v,Ct=gt,Ge=i.ad.vec3.zero([]);const ft=()=>rs(Ct,gt,Ee,nt-Re+1,z,V,te,ae.canonical);for(;Re+Ne<=nt;){if(Se+=xe,Se<R||Se>=D)return null;if(Ee=Te,Ct=gt,We.push(Ee),X&&pt.push(Ct),gt=new i.P(N.getx(Se),N.gety(Se)),Te=B[Se],!Te){const Zt=Qo(gt,ae.canonical,z,te,V);Te=Zt[3]>0?B[Se]=Zt:ft()}Re+=Ne;const Nt=i.ad.vec3.sub([],Te,Ee),Ot=i.ad.vec3.distance(Ee,Te);if(a&&Ot>0&&Ne>0&&i.ad.vec3.dot(Ge,Nt)/(Ne*Ot)<_e)return null;Ne=Ot,Ge=Nt}se&&V&&(B[Se]&&(Te=ft(),Ne=i.ad.vec3.distance(Ee,Te),Ge=i.ad.vec3.sub([],Te,Ee)),B[Se]=Te);const Ve=(nt-Re)/Ne,ht=gt.sub(Ct)._mult(Ve)._add(Ct),lt=i.ad.vec3.scaleAndAdd([],Ee,Ge,Ve);let _t=[0,0,1],it=Ge[0],vt=Ge[1];if(ce&&(_t=te.upVector(ae.canonical,ht.x,ht.y),_t[0]!==0||_t[1]!==0||_t[2]!==1)){const Nt=[_t[2],0,-_t[0]],Ot=i.ad.vec3.cross([],_t,Nt);i.ad.vec3.normalize(Nt,Nt),i.ad.vec3.normalize(Ot,Ot),it=i.ad.vec3.dot(Ge,Nt),vt=i.ad.vec3.dot(Ge,Ot)}if(a){const Nt=i.ad.vec3.cross([],_t,Ge);i.ad.vec3.normalize(Nt,Nt),i.ad.vec3.scaleAndAdd(lt,lt,Nt,a*xe)}const Lt=Ae+Math.atan2(vt,it);return We.push(lt),X&&pt.push(ht),{point:lt,angle:Lt,path:We,tilePath:pt,up:_t}}function ko(p,r){const a=r.length,f=a+4*p;r.resize(f),r.float32.fill(-1/0,4*a,4*f)}function ii(p,r,a){const f=r[0],_=r[1];return p[0]=a[0]*f+a[4]*_+a[12],p[1]=a[1]*f+a[5]*_+a[13],p[3]=a[3]*f+a[7]*_+a[15],p}const Ri=100;class va{constructor(r,a,f=new Yr(r.width+200,r.height+200,25),_=new Yr(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ri,this.screenBottomBoundary=r.height+Ri,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=a}placeCollisionBox(r,a,f,_,v,S,R,D){let N=f.projectedAnchorX,z=f.projectedAnchorY,B=f.projectedAnchorZ;const V=f.elevation,X=f.tileID,se=r.getProjection();if(V&&X){const[Se,Te,Ee]=se.upVector(X.canonical,f.tileAnchorX,f.tileAnchorY),Re=se.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Se*V*Re,z+=Te*V*Re,B+=Ee*V*Re}const te=this.projectAndGetPerspectiveRatio(R,N,z,B,f.tileID,se.name==="globe"||!!V||this.transform.pitch>0,se),ae=S*te.perspectiveRatio,ce=(f.x1*a+_.x-f.padding)*ae+te.point.x,_e=(f.y1*a+_.y-f.padding)*ae+te.point.y,be=(f.x2*a+_.x+f.padding)*ae+te.point.x,xe=(f.y2*a+_.y+f.padding)*ae+te.point.y,Ae=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(ce,_e,be,xe)||!v&&this.grid.hitTest(ce,_e,be,xe,D)||Ae?{box:[],offscreen:!1,occluded:te.occluded}:{box:[ce,_e,be,xe],offscreen:this.isOffscreen(ce,_e,be,xe),occluded:!1}}placeCollisionCircles(r,a,f,_,v,S,R,D,N,z,B,V,X,se,te){const ae=[],ce=this.transform.elevation,_e=r.getProjection(),be=ce?ce.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,_e):null,xe=new i.P(f.tileAnchorX,f.tileAnchorY);let{x:Ae,y:Se,z:Te}=_e.projectTilePoint(xe.x,xe.y,te.canonical);if(be){const[_t,it,vt]=be(xe);Ae+=_t,Se+=it,Te+=vt}const Ee=_e.name==="globe",Re=this.projectAndGetPerspectiveRatio(R,Ae,Se,Te,te,Ee||!!ce||this.transform.pitch>0,_e),{perspectiveRatio:Ne}=Re,nt=(B?S/Ne:S*Ne)/i.bw,We=Ro(Ae,Se,Te,D),pt=f.lineOffsetX*nt,gt=f.lineOffsetY*nt,Ct=i.ak(r.layers[0].layout.get("text-max-angle")),Ge=Math.cos(Ct),ft=Re.signedDistanceFromCamera>0?Wh(nt,v,pt,gt,!1,We,xe,f,_,D,{},ce&&!B?be:null,B&&!!ce,_e,te,B,Ge):null;let Ve=!1,ht=!1,lt=!0;if(ft&&!Re.occluded){const _t=.5*X*Ne+se,it=new i.P(-100,-100),vt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new Ec,{first:Nt,last:Ot}=ft,Zt=Nt.path.length;let gr=[];for(let lr=Zt-1;lr>=1;lr--)gr.push(Nt.path[lr]);for(let lr=1;lr<Ot.path.length;lr++)gr.push(Ot.path[lr]);const nr=2.5*_t;N&&(gr=gr.map(([lr,Fr,en],xn)=>(be&&!Ee&&(en=be(xn<Zt-1?Nt.tilePath[Zt-1-xn]:Ot.tilePath[xn-Zt+2])[2]),Ro(lr,Fr,en,N))),gr.some(lr=>lr[3]<=0)&&(gr=[]));let hr=[];if(gr.length>0){let lr=1/0,Fr=-1/0,en=1/0,xn=-1/0;for(const Pr of gr)lr=Math.min(lr,Pr[0]),en=Math.min(en,Pr[1]),Fr=Math.max(Fr,Pr[0]),xn=Math.max(xn,Pr[1]);Fr>=it.x&&lr<=vt.x&&xn>=it.y&&en<=vt.y&&(hr=[gr.map(Pr=>new i.P(Pr[0],Pr[1]))],(lr<it.x||Fr>vt.x||en<it.y||xn>vt.y)&&(hr=i.bu(hr,it.x,it.y,vt.x,vt.y)))}for(const lr of hr){Lt.reset(lr,.25*_t);let Fr=0;Fr=Lt.length<=.5*_t?1:Math.ceil(Lt.paddedLength/nr)+1;for(let en=0;en<Fr;en++){const xn=en/Math.max(Fr-1,1),Pr=Lt.lerp(xn),kn=Pr.x+Ri,xr=Pr.y+Ri;ae.push(kn,xr,_t,0);const Xt=kn-_t,Vr=xr-_t,ln=kn+_t,Zr=xr+_t;if(lt=lt&&this.isOffscreen(Xt,Vr,ln,Zr),ht=ht||this.isInsideGrid(Xt,Vr,ln,Zr),!a&&this.grid.hitTestCircle(kn,xr,_t,V)&&(Ve=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!z&&Ve||!ht?[]:ae,offscreen:lt,collisionDetected:Ve,occluded:Re.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,_=1/0,v=-1/0,S=-1/0;for(const z of r){const B=new i.P(z.x+Ri,z.y+Ri);f=Math.min(f,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),S=Math.max(S,B.y),a.push(B)}const R=this.grid.query(f,_,v,S).concat(this.ignoredGrid.query(f,_,v,S)),D={},N={};for(const z of R){const B=z.key;if(D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]={}),D[B.bucketInstanceId][B.featureIndex])continue;const V=[new i.P(z.x1,z.y1),new i.P(z.x2,z.y1),new i.P(z.x2,z.y2),new i.P(z.x1,z.y2)];i.bv(a,V)&&(D[B.bucketInstanceId][B.featureIndex]=!0,N[B.bucketInstanceId]===void 0&&(N[B.bucketInstanceId]=[]),N[B.bucketInstanceId].push(B.featureIndex))}return N}insertCollisionBox(r,a,f,_,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,a,f,_,v){const S=a?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:_,collisionGroupID:v};for(let D=0;D<r.length;D+=4)S.insertCircle(R,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,a,f,_,v,S,R){const D=[a,f,_,1];let N=!1;_||this.transform.pitch>0?(i.ad.vec4.transformMat4(D,D,r),this.fogState&&v&&R.name!=="globe"&&(N=function(V,X,se,te,ae,ce){const _e=ce.calculateFogTileMatrix(ae),be=[X,se,te];return i.ad.vec3.transformMat4(be,be,_e),Vt(V,i.ad.vec3.length(be),ce.pitch,ce._fov)}(this.fogState,a,f,_,v.toUnwrapped(),this.transform)>.9)):ii(D,D,r);const z=D[3];return{point:new i.P((D[0]/z+1)/2*this.transform.width+Ri,(-D[1]/z+1)/2*this.transform.height+Ri),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/z*.5,1.5),signedDistanceFromCamera:z,occluded:S&&D[2]>z||N}}isOffscreen(r,a,f,_){return f<Ri||r>=this.screenRightBoundary||_<Ri||a>this.screenBottomBoundary}isInsideGrid(r,a,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const r=i.ad.mat4.identity([]);return i.ad.mat4.translate(r,r,[-100,-100,0]),r}}function Jn(p,r,a){const f=r.createTileMatrix(p,p.worldSize,a.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),p.projMatrix,f)}function Tm(p,r,a){if(r.projection.name===a.projection.name)return p.projMatrix;const f=a.clone();return f.setProjection(r.projection),Jn(f,r.getProjection(),p)}function Hs(p,r,a){return r.name===a.projection.name?p.projMatrix:Jn(a,r,p)}class Mc{constructor(r,a,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?a:-a))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ol{constructor(r,a,f,_,v,S=!1){this.text=new Mc(r?r.text:null,a,f,v),this.icon=new Mc(r?r.icon:null,a,_,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xa{constructor(r,a,f,_=!1){this.text=r,this.icon=a,this.skipFade=f,this.clipped=_}}class Tb{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class ba{constructor(r,a,f,_,v){this.bucketInstanceId=r,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class Eb{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const a=++this.maxGroupID;this.collisionGroups[r]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[r]}}function Zh(p,r,a,f,_){const{horizontalAlign:v,verticalAlign:S}=i.bD(p),R=-(v-.5)*r,D=-(S-.5)*a,N=i.bC(p,f);return new i.P(R+N[0]*_,D+N[1]*_)}function hs(p,r,a,f,_){const v=new i.P(p,r);return a&&v._rotate(f?_:-_),v}class Cb{constructor(r,a,f,_,v,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new va(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Eb(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,a,f,_,v=1){const S=f.getBucket(a),R=f.latestFeatureIndex;if(!S||!R||a.fqid!==S.layerIds[0])return;const D=S.layers[0].layout,N=S.layers[0].paint,z=f.collisionBoxArray,B=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),V=f.tileSize/i.ai,X=f.tileID.toUnwrapped();this.transform.setProjection(S.projection);const se=(te=f.tileID,ae=S.getProjection(),ce=this.transform,ae.name===this.projection?ce.calculateProjMatrix(te.toUnwrapped()):Jn(ce,ae,te));var te,ae,ce;const _e=D.get("text-pitch-alignment")==="map",be=D.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const xe=a.dynamicFilter(),Ae=a.dynamicFilterNeedsFeature(),Se=this.transform.calculatePixelsToTileUnitsMatrix(f),Te=$i(se,f.tileID.canonical,_e,be,this.transform,S.getProjection(),Se);let Ee=null;if(_e){const ft=Xn(se,f.tileID.canonical,_e,be,this.transform,S.getProjection(),Se);Ee=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,ft)}let Re=null;xe&&f.latestFeatureIndex&&(Re={unwrappedTileID:X,dynamicFilter:xe,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[S.bucketInstanceId]=new ba(S.bucketInstanceId,R,S.sourceLayerIndex,S.index,f.tileID);const[Ne,nt]=S.layers[0].layout.get("text-size-scale-range"),We=i.ay(v,Ne,nt),[pt,gt]=D.get("icon-size-scale-range"),Ct=i.ay(v,pt,gt),Ge={bucket:S,layout:D,paint:N,posMatrix:se,textLabelPlaneMatrix:Te,labelToScreenMatrix:Ee,clippingData:Re,scale:B,textPixelRatio:V,holdingForFade:f.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:i.bp(S.textSizeData,this.transform.zoom,We),partiallyEvaluatedIconSize:i.bp(S.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const ft of S.sortKeyRanges){const{sortKey:Ve,symbolInstanceStart:ht,symbolInstanceEnd:lt}=ft;r.push({sortKey:Ve,symbolInstanceStart:ht,symbolInstanceEnd:lt,parameters:Ge})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e){const{textOffset0:be,textOffset1:xe,crossTileID:Ae}=V,Se=[be,xe],Te=Zh(r,f,_,Se,v),Ee=this.collisionIndex.placeCollisionBox(se,v,a,hs(Te.x,Te.y,S,R,this.transform.angle),B,D,N,z.predicate);if(ae){const Re=se.getSymbolInstanceIconSize(_e,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(se,Re,ae,hs(Te.x,Te.y,S,R,this.transform.angle),B,D,N,z.predicate).box.length===0)return}if(Ee.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Re=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Se,width:f,height:_,anchor:r,textScale:v,prevAnchor:Re},this.markUsedJustification(se,r,V,te),se.allowVerticalPlacement&&(this.markUsedOrientation(se,te,V),this.placedOrientations[Ae]=te),{shift:Te,placedGlyphBoxes:Ee}}}placeLayerBucketPart(r,a,f,_,v=1){const{bucket:S,layout:R,paint:D,posMatrix:N,textLabelPlaneMatrix:z,labelToScreenMatrix:B,clippingData:V,textPixelRatio:X,holdingForFade:se,collisionBoxArray:te,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:ce,collisionGroup:_e,latestFeatureIndex:be}=r.parameters,xe=R.get("text-optional"),Ae=R.get("icon-optional"),Se=R.get("text-allow-overlap"),Te=R.get("icon-allow-overlap"),Ee=R.get("text-rotation-alignment")==="map",Re=R.get("text-pitch-alignment")==="map",Ne=D.get("symbol-z-offset"),nt=R.get("symbol-elevation-reference")==="sea",[We,pt]=R.get("text-size-scale-range"),[gt,Ct]=R.get("icon-size-scale-range"),Ge=i.ay(v,We,pt),ft=i.ay(v,gt,Ct);this.transform.setProjection(S.projection);let Ve=Se&&(Te||!S.hasIconData()||Ae),ht=Te&&(Se||!S.hasTextData()||xe);const lt=!Ne.isConstant();!S.collisionArrays&&te&&S.deserializeCollisionBoxes(te),f&&_&&S.updateCollisionDebugBuffers(this.transform.zoom,te,Ge,ft);const _t=(it,vt,Lt)=>{const{crossTileID:Nt,numVerticalGlyphVertices:Ot}=it;let Zt=null;if(V&&V.dynamicFilterNeedsFeature||lt){const Gr=this.retainedQueryData[S.bucketInstanceId];Zt=be.loadFeature({featureIndex:it.featureIndex,bucketIndex:Gr.bucketIndex,sourceLayerIndex:Gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Zt,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new i.P(it.tileAnchorX,it.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Nt]=new xa(!1,!1,!1,!0),void a.add(Nt);const gr=Ne.evaluate(Zt,{});if(a.has(Nt))return;if(se)return void(this.placements[Nt]=new xa(!1,!1,!1));let nr=!1,hr=!1,lr=!0,Fr=!1,en=!1,xn=null,Pr={box:null,offscreen:null,occluded:null},kn={box:null,offscreen:null,occluded:null},xr=null,Xt=null,Vr=null,ln=0,Zr=0,$n=0;Lt.textFeatureIndex?ln=Lt.textFeatureIndex:it.useRuntimeCollisionCircles&&(ln=it.featureIndex),Lt.verticalTextFeatureIndex&&(Zr=Lt.verticalTextFeatureIndex);const ei=Gr=>{Gr.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Dn=this.transform.elevation;Gr.elevation=nt?gr:gr+(Dn?Dn.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0),Gr.elevation+=it.zOffset},di=Lt.textBox;if(di){ei(di);const Gr=tn=>{let pn=i.bq.horizontal;if(S.allowVerticalPlacement&&!tn&&this.prevPlacement){const Bi=this.prevPlacement.placedOrientations[Nt];Bi&&(this.placedOrientations[Nt]=Bi,pn=Bi,this.markUsedOrientation(S,pn,it))}return pn},Dn=(tn,pn)=>{if(S.allowVerticalPlacement&&Ot>0&&Lt.verticalTextBox){for(const Bi of S.writingModes)if(Bi===i.bq.vertical?(Pr=pn(),kn=Pr):Pr=tn(),Pr&&Pr.box&&Pr.box.length)break}else Pr=tn()};if(R.get("text-variable-anchor")){let tn=R.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Nt]){const Mn=this.prevPlacement.variableOffsets[Nt];tn.indexOf(Mn.anchor)>0&&(tn=tn.filter(hi=>hi!==Mn.anchor),tn.unshift(Mn.anchor))}const pn=(Mn,hi,ia)=>{const Ns=S.getSymbolInstanceTextSize(ae,it,this.transform.zoom,vt),yo=(Mn.x2-Mn.x1)*Ns+2*Mn.padding,Ts=(Mn.y2-Mn.y1)*Ns+2*Mn.padding,vo=it.hasIconTextFit&&!Te?hi:null;vo&&ei(vo);let Os={box:[],offscreen:!1,occluded:!1};const Ra=Se?2*tn.length:tn.length;for(let sa=0;sa<Ra;++sa){const ka=this.attemptAnchorPlacement(tn[sa%tn.length],Mn,yo,Ts,Ns,Ee,Re,X,N,_e,sa>=tn.length,it,vt,S,ia,vo,ae,ce);if(ka&&(Os=ka.placedGlyphBoxes,Os&&Os.box&&Os.box.length)){nr=!0,xn=ka.shift;break}}return Os};Dn(()=>pn(di,Lt.iconBox,i.bq.horizontal),()=>{const Mn=Lt.verticalTextBox;return Mn&&ei(Mn),S.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&Ot>0&&Mn?pn(Mn,Lt.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),Pr&&(nr=Pr.box,lr=Pr.offscreen,Fr=Pr.occluded);const Bi=Gr(!(!Pr||!Pr.box));if(!nr&&this.prevPlacement){const Mn=this.prevPlacement.variableOffsets[Nt];Mn&&(this.variableOffsets[Nt]=Mn,this.markUsedJustification(S,Mn.anchor,it,Bi))}}else{const tn=(pn,Bi)=>{const Mn=S.getSymbolInstanceTextSize(ae,it,this.transform.zoom,vt,v),hi=this.collisionIndex.placeCollisionBox(S,Mn,pn,new i.P(0,0),Se,X,N,_e.predicate);return hi&&hi.box&&hi.box.length&&(this.markUsedOrientation(S,Bi,it),this.placedOrientations[Nt]=Bi),hi};Dn(()=>tn(di,i.bq.horizontal),()=>{const pn=Lt.verticalTextBox;return S.allowVerticalPlacement&&Ot>0&&pn?(ei(pn),tn(pn,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(!!(Pr&&Pr.box&&Pr.box.length))}}if(xr=Pr,nr=xr&&xr.box&&xr.box.length>0,lr=xr&&xr.offscreen,Fr=xr&&xr.occluded,it.useRuntimeCollisionCircles){const Gr=S.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex>=0?it.centerJustifiedTextSymbolIndex:it.verticalPlacedTextSymbolIndex),Dn=i.br(S.textSizeData,ae,Gr),tn=R.get("text-padding");Xt=this.collisionIndex.placeCollisionCircles(S,Se,Gr,S.lineVertexArray,S.glyphOffsetArray,Dn,N,z,B,f,Re,_e.predicate,it.collisionCircleDiameter*Dn/i.bw,tn,this.retainedQueryData[S.bucketInstanceId].tileID),nr=Se||Xt.circles.length>0&&!Xt.collisionDetected,lr=lr&&Xt.offscreen,Fr=Xt.occluded}if(Lt.iconFeatureIndex&&($n=Lt.iconFeatureIndex),Lt.iconBox){const Gr=Dn=>{ei(Dn);const tn=it.hasIconTextFit&&xn?hs(xn.x,xn.y,Ee,Re,this.transform.angle):new i.P(0,0),pn=S.getSymbolInstanceIconSize(ce,this.transform.zoom,it.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,pn,Dn,tn,Te,X,N,_e.predicate)};kn&&kn.box&&kn.box.length&&Lt.verticalIconBox?(Vr=Gr(Lt.verticalIconBox),hr=Vr.box.length>0):(Vr=Gr(Lt.iconBox),hr=Vr.box.length>0),lr=lr&&Vr.offscreen,en=Vr.occluded}const yi=xe||it.numHorizontalGlyphVertices===0&&Ot===0,Ys=Ae||it.numIconVertices===0;if(yi||Ys?Ys?yi||(hr=hr&&nr):nr=hr&&nr:hr=nr=hr&&nr,nr&&xr&&xr.box&&this.collisionIndex.insertCollisionBox(xr.box,R.get("text-ignore-placement"),S.bucketInstanceId,kn&&kn.box&&Zr?Zr:ln,_e.ID),hr&&Vr&&this.collisionIndex.insertCollisionBox(Vr.box,R.get("icon-ignore-placement"),S.bucketInstanceId,$n,_e.ID),Xt&&(nr&&this.collisionIndex.insertCollisionCircles(Xt.circles,R.get("text-ignore-placement"),S.bucketInstanceId,ln,_e.ID),f)){const Gr=S.bucketInstanceId;let Dn=this.collisionCircleArrays[Gr];Dn===void 0&&(Dn=this.collisionCircleArrays[Gr]=new Tb);for(let tn=0;tn<Xt.circles.length;tn+=4)Dn.circles.push(Xt.circles[tn+0]),Dn.circles.push(Xt.circles[tn+1]),Dn.circles.push(Xt.circles[tn+2]),Dn.circles.push(Xt.collisionDetected?1:0)}const ns=S.projection.name!=="globe";Ve=Ve&&(ns||!Fr),ht=ht&&(ns||!en),this.placements[Nt]=new xa(nr||Ve,hr||ht,lr||S.justReloaded),a.add(Nt)};if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.elevationType==="road"&&S.updateRoadElevation(),S.updateZOffset(),S.sortFeaturesByY){const it=S.getSortedSymbolIndexes(this.transform.angle);for(let vt=it.length-1;vt>=0;--vt){const Lt=it[vt];_t(S.symbolInstances.get(Lt),Lt,S.collisionArrays[Lt])}S.hasAnyZOffset&&i.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const it=S.getSortedIndexesByZOffset();for(let vt=0;vt<it.length;++vt){const Lt=it[vt];_t(S.symbolInstances.get(Lt),Lt,S.collisionArrays[Lt])}}else for(let it=r.symbolInstanceStart;it<r.symbolInstanceEnd;it++)_t(S.symbolInstances.get(it),it,S.collisionArrays[it]);if(f&&S.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[S.bucketInstanceId];i.ad.mat4.invert(it.invProjMatrix,N),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(r,a,f,_){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:D,crossTileID:N}=f,z=i.bB(a),B=_===i.bq.vertical?D:z==="left"?v:z==="center"?S:z==="right"?R:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=B>=0&&v!==B?0:N),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:N),R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=B>=0&&R!==B?0:N),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=B>=0&&D!==B?0:N)}markUsedOrientation(r,a,f){const _=a===i.bq.horizontal||a===i.bq.horizontalOnly?a:0,v=a===i.bq.vertical?a:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:N}=f,z=r.text.placedSymbolArray;S>=0&&(z.get(S).placedOrientation=_),R>=0&&(z.get(R).placedOrientation=_),D>=0&&(z.get(D).placedOrientation=_),N>=0&&(z.get(N).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(r):1,v=a?a.opacities:{},S=a?a.variableOffsets:{},R=a?a.placedOrientations:{};for(const D in this.placements){const N=this.placements[D],z=v[D];z?(this.opacities[D]=new ol(z,_,N.text,N.icon,null,N.clipped),f=f||N.text!==z.text.placed||N.icon!==z.icon.placed):(this.opacities[D]=new ol(null,_,N.text,N.icon,N.skipFade,N.clipped),f=f||N.text||N.icon)}for(const D in v){const N=v[D];if(!this.opacities[D]){const z=new ol(N,_,!1,!1);z.isHidden()||(this.opacities[D]=z,f=f||N.text.placed||N.icon.placed)}}for(const D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(const D in R)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=R[D]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:r)}updateLayerOpacities(r,a,f,_){const v=new Set;for(const S of a){const R=S.getBucket(r);R&&S.latestFeatureIndex&&r.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,v,S,S.collisionBoxArray,f,_,S.tileID,r.scope),R.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(R,S.tileID),R.elevationType==="road"&&R.updateRoadElevation(),R.updateZOffset())}}updateBucketOpacities(r,a,f,_,v,S,R,D){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const N=r.layers[0].layout,z=r.layers[0].paint,B=!!r.layers[0].dynamicFilter(),V=new ol(null,0,!1,!1,!0),X=N.get("text-allow-overlap"),se=N.get("icon-allow-overlap"),te=N.get("text-variable-anchor"),ae=N.get("text-rotation-alignment")==="map",ce=N.get("text-pitch-alignment")==="map",_e=z.get("symbol-z-offset"),be=N.get("symbol-elevation-reference")==="sea",xe=!_e.isConstant(),Ae=new ol(null,0,X&&(se||!r.hasIconData()||N.get("icon-optional")),se&&(X||!r.hasTextData()||N.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const Se=(Ee,Re,Ne)=>{for(let nt=0;nt<Re/4;nt++)Ee.opacityVertexArray.emplaceBack(Ne)};let Te=0;S&&r.updateReplacement(R,S);for(let Ee=0;Ee<r.symbolInstances.length;Ee++){const Re=r.symbolInstances.get(Ee),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:nt,crossTileID:We,numIconVertices:pt,tileAnchorX:gt,tileAnchorY:Ct}=Re;let Ge=null;const ft=this.retainedQueryData[r.bucketInstanceId];xe&&Re&&ft&&(Ge=f.latestFeatureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:ft.bucketIndex,sourceLayerIndex:ft.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ve=_e.evaluate(Ge,{}),ht=a.has(We);let lt=this.opacities[We];ht?lt=V:lt||(lt=Ae,this.opacities[We]=lt),a.add(We);const _t=Ne>0||nt>0,it=pt>0,vt=this.placedOrientations[We],Lt=vt===i.bq.vertical,Nt=vt===i.bq.horizontal||vt===i.bq.horizontalOnly;!_t&&!it||lt.isHidden()||Te++;let Ot=!1;if((_t||it)&&S)for(const Zt of r.activeReplacements){if(i.bx(Zt,v,i.by.Symbol,D)||Zt.min.x>gt||gt>Zt.max.x||Zt.min.y>Ct||Ct>Zt.max.y)continue;const gr=i.bz(gt,Ct,R.canonical,Zt.footprintTileId.canonical);if(Ot=i.bA(gr,Zt.footprint),Ot)break}if(_t){const Zt=Ot?Ul:Bl(lt.text);Se(r.text,Ne,Lt?Ul:Zt),Se(r.text,nt,Nt?Ul:Zt);const gr=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:hr,rightJustifiedTextSymbolIndex:lr,verticalPlacedTextSymbolIndex:Fr}=Re,en=r.text.placedSymbolArray,xn=gr||Lt?1:0;nr>=0&&(en.get(nr).hidden=xn),hr>=0&&(en.get(hr).hidden=xn),lr>=0&&(en.get(lr).hidden=xn),Fr>=0&&(en.get(Fr).hidden=gr||Nt?1:0);const Pr=this.variableOffsets[We];Pr&&this.markUsedJustification(r,Pr.anchor,Re,vt);const kn=this.placedOrientations[We];kn&&(this.markUsedJustification(r,"left",Re,kn),this.markUsedOrientation(r,kn,Re))}if(it){const Zt=Ot?Ul:Bl(lt.icon),{placedIconSymbolIndex:gr,verticalPlacedIconSymbolIndex:nr}=Re,hr=r.icon.placedSymbolArray,lr=lt.icon.isHidden()?1:0;gr>=0&&(Se(r.icon,pt,Lt?Ul:Zt),hr.get(gr).hidden=lr),nr>=0&&(Se(r.icon,Re.numVerticalIconVertices,Nt?Ul:Zt),hr.get(nr).hidden=lr)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Zt=r.collisionArrays[Ee];if(Zt){let gr=new i.P(0,0),nr=!0;if(Zt.textBox||Zt.verticalTextBox){if(te){const lr=this.variableOffsets[We];lr?(gr=Zh(lr.anchor,lr.width,lr.height,lr.textOffset,lr.textScale),ae&&gr._rotate(ce?this.transform.angle:-this.transform.angle)):nr=!1}B&&(nr=!lt.clipped),Zt.textBox&&Fl(r.textCollisionBox.collisionVertexArray,lt.text.placed,!nr||Lt,Ve,be,gr.x,gr.y),Zt.verticalTextBox&&Fl(r.textCollisionBox.collisionVertexArray,lt.text.placed,!nr||Nt,Ve,be,gr.x,gr.y)}const hr=nr&&!!(!Nt&&Zt.verticalIconBox);Zt.iconBox&&Fl(r.iconCollisionBox.collisionVertexArray,lt.icon.placed,hr,Ve,be,Re.hasIconTextFit?gr.x:0,Re.hasIconTextFit?gr.y:0),Zt.verticalIconBox&&Fl(r.iconCollisionBox.collisionVertexArray,lt.icon.placed,!hr,Ve,be,Re.hasIconTextFit?gr.x:0,Re.hasIconTextFit?gr.y:0)}}}if(r.fullyClipped=Te===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Ee.invProjMatrix,r.placementViewportMatrix=Ee.viewportMatrix,r.collisionCircleArray=Ee.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Fl(p,r,a,f,_,v,S){p.emplaceBack(r?1:0,a?1:0,v||0,S||0,f,_?1:0),p.emplaceBack(r?1:0,a?1:0,v||0,S||0,f,_?1:0),p.emplaceBack(r?1:0,a?1:0,v||0,S||0,f,_?1:0),p.emplaceBack(r?1:0,a?1:0,v||0,S||0,f,_?1:0)}const Jy=Math.pow(2,25),_d=Math.pow(2,24),Ab=Math.pow(2,17),Mb=Math.pow(2,16),yd=Math.pow(2,9),vd=Math.pow(2,8),Ib=Math.pow(2,1);function Bl(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const r=p.placed?1:0,a=Math.floor(127*p.opacity);return a*Jy+r*_d+a*Ab+r*Mb+a*yd+r*vd+a*Ib+r}const Ul=0;class Xh{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,a,f,_,v,S){const R=this._bucketParts;for(;this._currentTileIndex<r.length;)if(a.getBucketParts(R,_,r[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,N)=>D.sortKey-N.sortKey));this._currentPartIndex<R.length;){const D=R[this._currentPartIndex];if(a.placeLayerBucketPart(D,this._seenCrossTileIDs,f,D.symbolInstanceStart===0,S),this._currentPartIndex++,v())return!0}return!1}}class al{constructor(r,a,f,_,v,S,R,D,N){this.placement=new Cb(r,v,S,R,D,N),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,a,f,_,v){const S=i.q.now(),R=()=>{const D=i.q.now()-S;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=a[r[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=N)&&(!D.maxzoom||D.maxzoom>N)){const z=D,B=z.layout.get("symbol-z-elevate"),V=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,X=z.layout.get("symbol-z-order"),se=X==="viewport-y"||X==="auto"&&!(X!=="viewport-y"&&V),te=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),ae=se&&te,ce=this._inProgressLayer=this._inProgressLayer||new Xh(z),_e=i.C(D.source,D.scope);if(ce.continuePlacement(B||ae?_[_e]:f[_e],this.placement,this._showCollisionBoxes,D,R,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Em=512/i.ai/2;class Pb{constructor(r,a,f){this.tileID=r,this.bucketInstanceId=f,this.index=new i.bE(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*i.ai,v=r.canonical.y*i.ai;for(let S=0;S<a.length;S++){const{key:R,crossTileID:D,tileAnchorX:N,tileAnchorY:z}=a.get(S),B=Math.floor((_+N)*Em),V=Math.floor((v+z)*Em);this.index.add(B,V),this.keys.push(R),this.crossTileIDs.push(D)}this.index.finish()}findMatches(r,a,f){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=Em/Math.pow(2,a.canonical.z-this.tileID.canonical.z),S=a.canonical.x*i.ai,R=a.canonical.y*i.ai;for(let D=0;D<r.length;D++){const N=r.get(D);if(N.crossTileID)continue;const{key:z,tileAnchorX:B,tileAnchorY:V}=N,X=Math.floor((S+B)*v),se=Math.floor((R+V)*v),te=this.index.range(X-_,se-_,X+_,se+_);for(const ae of te){const ce=this.crossTileIDs[ae];if(this.keys[ae]===z&&!f.has(ce)){f.add(ce),N.crossTileID=ce;break}}}}}class Rb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const a=Math.round((r-this.lng)/360);if(a!==0)for(const f in this.indexes){const _=this.indexes[f],v={};for(const S in _){const R=_[S];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+a),v[R.tileID.key]=R}this.indexes[f]=v}this.lng=r}addBucket(r,a,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>r.overscaledZ)for(const R in S){const D=S[R];D.tileID.isChildOf(r)&&D.findMatches(a.symbolInstances,r,_)}else{const R=S[r.scaledTo(Number(v)).key];R&&R.findMatches(a.symbolInstances,r,_)}}for(let v=0;v<a.symbolInstances.length;v++){const S=a.symbolInstances.get(v);S.crossTileID||(S.crossTileID=f.generate(),_.add(S.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Pb(r,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(r,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let a=!1;for(const f in this.indexes){const _=this.indexes[f];for(const v in _)r[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],a=!0)}return a}}class kb{constructor(){this.layerIndexes={},this.crossTileIDs=new Rb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,a,f,_){let v=this.layerIndexes[r.fqid];v===void 0&&(v=this.layerIndexes[r.fqid]=new Qy);let S=!1;const R={};_.name!=="globe"&&v.handleWrapJump(f);for(const D of a){const N=D.getBucket(r);N&&r.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,N,this.crossTileIDs)&&(S=!0),R[N.bucketInstanceId]=!0)}return v.removeStaleBuckets(R)&&(S=!0),S}pruneUnusedLayers(r){const a={};r.forEach(f=>{a[f]=!0});for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}const ll=771;class kr{constructor(r,a,f,_){this.blendFunction=r,this.blendColor=a,this.mask=f,this.blendEquation=_}}kr.Replace=[1,0,1,0],kr.disabled=new kr(kr.Replace,i.al.transparent,[!1,!1,!1,!1]),kr.unblended=new kr(kr.Replace,i.al.transparent,[!0,!0,!0,!0]),kr.alphaBlended=new kr([1,ll,1,ll],i.al.transparent,[!0,!0,!0,!0]),kr.alphaBlendedNonPremultiplied=new kr([770,ll,770,ll],i.al.transparent,[!0,!0,!0,!0]),kr.multiply=new kr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class Jt{constructor(r,a,f){this.func=r,this.mask=a,this.range=f}}Jt.ReadOnly=!1,Jt.ReadWrite=!0,Jt.disabled=new Jt(519,Jt.ReadOnly,[0,1]);const Kh=7680;class vr{constructor(r,a,f,_,v,S){this.test=r,this.ref=a,this.mask=f,this.fail=_,this.depthFail=v,this.pass=S}}vr.disabled=new vr({func:519,mask:0},0,0,Kh,Kh,Kh);const wa=1029,Ic=2305;class mr{constructor(r,a,f){this.enable=r,this.mode=a,this.frontFace=f}}function Cm(p,r){const a=i.bG(p,3);i.ad.mat4.fromQuat(p,r),i.bI(p,3,a)}function Vl(p,r){const a=i.ad.quat.identity([]);return i.ad.quat.rotateZ(a,a,-r),i.ad.quat.rotateX(a,a,-p),a}function Pc(p,r){const a=[p[0],p[1],0],f=[r[0],r[1],0];if(i.ad.vec3.length(a)>=1e-15){const S=i.ad.vec3.normalize([],a);i.ad.vec3.scale(f,S,i.ad.vec3.dot(f,S)),r[0]=f[0],r[1]=f[1]}const _=i.ad.vec3.cross([],r,p);if(i.ad.vec3.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return Vl(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}mr.disabled=new mr(!1,wa,Ic),mr.backCCW=new mr(!0,wa,Ic),mr.backCW=new mr(!0,wa,2304),mr.frontCW=new mr(!0,1028,2304),mr.frontCCW=new mr(!0,1028,Ic);class Am{constructor(r,a){this.position=r,this.orientation=a}get position(){return this._position}set position(r){if(r){const a=r instanceof i.ac?r:new i.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(a.x=i.bF(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(r,a){if(this.orientation=null,!this.position)return;const f=this.position,_=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(r)):0,v=i.ac.fromLngLat(r,_),S=[v.x-f.x,v.y-f.y,v.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Pc(S,a)}setPitchBearing(r,a){this.orientation=Vl(i.ak(r),i.ak(-a))}}class Rc{constructor(r,a){this._transform=i.ad.mat4.identity([]),this.orientation=a,this.position=r}get mercatorPosition(){const r=this.position;return new i.ac(r[0],r[1],r[2])}get position(){const r=i.bG(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var a;r&&i.bI(this._transform,3,[(a=r)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.ad.quat.identity([]),r&&Cm(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,a){this._orientation=Vl(r,a),Cm(this._transform,this._orientation)}forward(){const r=i.bG(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=i.bG(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=i.bG(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,a){const f=new Float64Array(16);return i.ad.mat4.invert(f,this.getWorldToCamera(r,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,a,f){const _=this.position;i.ad.vec3.scale(_,_,-r);const v=new Float64Array(16);return i.ad.mat4.fromScaling(v,[f,f,f]),i.ad.mat4.translate(v,v,_),v[10]*=a,v}getWorldToCamera(r,a){const f=new Float64Array(16),_=new Float64Array(4),v=this.position;return i.ad.quat.conjugate(_,this._orientation),i.ad.vec3.scale(v,v,-r),i.ad.mat4.fromQuat(f,_),i.ad.mat4.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(r,a,f,_){const v=new Float64Array(16);return i.ad.mat4.perspective(v,r,a,f,_),v}getCameraToClipOrthographic(r,a,f,_,v,S){const R=new Float64Array(16);return i.ad.mat4.ortho(R,r,a,f,_,v,S),R}getDistanceToElevation(r,a=!1){const f=r===0?0:i.bH(r,a?i.aT(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Rc([...this.position],[...this.orientation])}}const Hn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class xd{constructor(r=0,a=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=a,this.left=f,this.right=_}interpolate(r,a,f){return a.top!=null&&r.top!=null&&(this.top=i.ah(r.top,a.top,f)),a.bottom!=null&&r.bottom!=null&&(this.bottom=i.ah(r.bottom,a.bottom,f)),a.left!=null&&r.left!=null&&(this.left=i.ah(r.left,a.left,f)),a.right!=null&&r.right!=null&&(this.right=i.ah(r.right,a.right,f)),this}getCenter(r,a){const f=i.ay((this.left+r-this.right)/2,0,r),_=i.ay((this.top+a-this.bottom)/2,0,a);return new i.P(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new xd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Rt=15;class Yh{constructor(r,a,f,_,v,S,R){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(S),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Rc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new Yh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Rt}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const f=this.getProjection(),_=!i.bn(a,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const a=r!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const a=-r*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const a=i.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.ak(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const a=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,v=0;for(let S=0;S<a.length;S++){const R=new i.P(a[S][0]*this.width,f+a[S][1]*(this.height-f)),D=r.pointCoordinate(R);if(!D)continue;const N=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);_+=D[3]*N,v+=N}return v===0?NaN:_/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(_-f,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[a.x,a.y,a.z]:[r.x,r.y,r.z];const _=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,f));return i.ay(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let a=!1;if(r.orientation&&!i.ad.quat.exactEquals(r.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];i.ad.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,a=new Am;return a.position=new i.ac(r[0],r[1],r[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(r){if(!i.ad.quat.length(r))return!1;i.ad.quat.normalize(r,r);const a=i.ad.vec3.transformQuat([],[0,0,-1],r),f=i.ad.vec3.transformQuat([],[0,-1,0],r);if(f[2]<0)return!1;const _=Pc(a,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=i.ay(r[2],_/f,_/a),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,a,f){this._unmodified=!1,this._edgeInsets.interpolate(r,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const a=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(r){const a=[new i.bQ(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new i.P(0,0)),_=this.pointCoordinate(new i.P(this.width,0)),v=this.pointCoordinate(new i.P(this.width,this.height)),S=this.pointCoordinate(new i.P(0,this.height)),R=Math.floor(Math.min(f.x,_.x,v.x,S.x)),D=Math.floor(Math.max(f.x,_.x,v.x,S.x)),N=1;for(let z=R-N;z<=D+N;z++)z!==0&&a.push(new i.bQ(z,r))}return a}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,a,f){let _=[];const v=f!==void 0,S=!v;if(S&&this.zoom<a||v&&f[0]===0&&f[1]===0)return _;const R=new Set,D=(z,B,V,X,se)=>{const te=i.c5(B,z,V,X,se);R.has(te)||(_.push(new i.aH(z,B,V,X,se)),R.add(te))};for(let z=0;z<r.length;z++){const B=r[z];if(S&&B.canonical.z!==a)continue;const V=B.canonical,X=B.overscaledZ,se=B.wrap,te=1<<V.z,ae=V.x+1<te,ce=V.x>0,_e=V.y+1<te,be=V.y>0,xe=B.wrap-(ce?0:1),Ae=B.wrap+(ae?0:1),Se=ce?V.x-1:te-1,Te=ae?V.x+1:0;if(v)f[0]<0?(D(X,Ae,V.z,Te,V.y),f[1]<0&&_e&&(D(X,se,V.z,V.x,V.y+1),D(X,Ae,V.z,Te,V.y+1)),f[1]>0&&be&&(D(X,se,V.z,V.x,V.y-1),D(X,Ae,V.z,Te,V.y-1))):f[0]>0?(D(X,xe,V.z,Se,V.y),f[1]<0&&_e&&(D(X,se,V.z,V.x,V.y+1),D(X,xe,V.z,Se,V.y+1)),f[1]>0&&be&&(D(X,se,V.z,V.x,V.y-1),D(X,xe,V.z,Se,V.y-1))):f[1]<0&&_e?D(X,se,V.z,V.x,V.y+1):be&&D(X,se,V.z,V.x,V.y-1);else{const Ee=B.visibleQuadrants;1&Ee&&(D(X,xe,V.z,Se,V.y),be&&(D(X,se,V.z,V.x,V.y-1),D(X,xe,V.z,Se,V.y-1))),2&Ee&&(D(X,Ae,V.z,Te,V.y),be&&(D(X,se,V.z,V.x,V.y-1),D(X,Ae,V.z,Te,V.y-1))),4&Ee&&(D(X,xe,V.z,Se,V.y),_e&&(D(X,se,V.z,V.x,V.y+1),D(X,xe,V.z,Se,V.y+1))),8&Ee&&(D(X,Ae,V.z,Te,V.y),_e&&(D(X,se,V.z,V.x,V.y+1),D(X,Ae,V.z,Te,V.y+1)))}}const N=[];for(const z of _)_.some(B=>z.isChildOf(B))||N.push(z);if(_=N.filter(z=>!r.some(B=>!!(z.overscaledZ<a&&B.isChildOf(z))||z.equals(B)||z.isChildOf(B))),S){const z=1<<a,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[z*B.x,z*B.y],X=4,se=X*X;_=_.filter(te=>{const ae=te.canonical.x+.5-V[0],ce=te.canonical.y+.5-V[1];return ae*ae+ce*ce<se})}return _}coveringTiles(r){let a=this.coveringZoomLevel(r);const f=a,_=this.elevation&&this.elevation.exaggeration(),v=_&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&a<r.minzoom)return[];r.maxzoom!==void 0&&a>r.maxzoom&&(a=r.maxzoom);const R=this.locationCoordinate(this.center),D=this.center.lat,N=1<<a,z=[N*R.x,N*R.y,0],B=this.projection.name==="globe",V=!B,X=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,V),se=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=N*i.bH(1,this.center.lat),ae=this._camera.position[2]/i.bH(1,this.center.lat),ce=[N*se.x,N*se.y,ae*(V?1:te)],_e=B||_,be=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),xe=this.isLODDisabled(!0)?a:0;let Ae;if(this._elevation&&r.isTerrainDEM)Ae=1e4*this._elevation.exaggeration();else if(this._elevation){const Ve=this._elevation.getMinMaxForVisibleTiles();Ae=Ve?Ve.max:this._centerAltitude}else Ae=this._centerAltitude;const Se=r.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?i.bS(this):1,Ee=Ve=>{const lt=new i.ac(Ve.x+25e-6,Ve.y,Ve.z),_t=new i.ac(Ve.x,Ve.y+25e-6,Ve.z),it=Ve.toLngLat(),vt=lt.toLngLat(),Lt=_t.toLngLat(),Nt=this.locationCoordinate(it),Ot=this.locationCoordinate(vt),Zt=this.locationCoordinate(Lt),gr=Math.hypot(Ot.x-Nt.x,Ot.y-Nt.y),nr=Math.hypot(Zt.x-Nt.x,Zt.y-Nt.y);return Math.sqrt(gr*nr)*Te/25e-6},Re=Ve=>{const ht=Ae,lt=Se;return{aabb:i.bV(this,N,0,0,0,Ve,lt,ht,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:ht,wrap:Ve,fullyVisible:!1}},Ne=[];let nt=[];const We=a,pt=r.reparseOverscaled?f:a,gt=(ae-this._centerAltitude)*te,Ct=Ve=>{if(!this._elevation||!Ve.tileID||!S)return;const ht=this._elevation.getMinMaxForTile(Ve.tileID),lt=Ve.aabb;ht?(lt.min[2]=ht.min,lt.max[2]=ht.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Ve.shouldSplit=ft(Ve),Ve.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},Ge=(Ve,ht)=>{if(.707*ht<Ve)return 1;const lt=ht/Ve;return lt/(1.4144271570014144+(Math.pow(1.1,lt-1.4144271570014144+1)-1)/(1.1-1)-1)},ft=Ve=>{if(Ve.zoom<xe)return!0;if(Ve.zoom===We)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const ht=Ve.aabb.distanceX(ce),lt=Ve.aabb.distanceY(ce);let _t=gt,it=1;if(B){_t=Ve.aabb.distanceZ(ce);const nr=Math.pow(2,Ve.zoom),hr=i.aT((Ve.y+1)/nr),lr=i.aT(Ve.y/nr),Fr=Math.min(Math.max(D,hr),lr),en=i.ca(Fr)/i.ca(D);if(it=Fr===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,en/this._mercatorScaleRatio),this.zoom<=i.c6&&Ve.zoom===We-1&&en>=.9)return!0}else if(v&&(_t=Ve.aabb.distanceZ(ce)*te),this.projection.isReprojectedInTileSpace&&f<=5){const nr=Math.pow(2,Ve.zoom),hr=Ee(new i.ac((Ve.x+.5)/nr,(Ve.y+.5)/nr));it=hr>.85?1:hr}if(!S){const nr=Math.sqrt(ht*ht+lt*lt+_t*_t);let hr=(1<<We-Ve.zoom)*be*it;return hr*=Ge(Math.max(_t,gt),nr),nr<hr}let vt=Number.MAX_VALUE,Lt=0;const Nt=Ve.aabb.getCorners(),Ot=[];for(const nr of Nt){i.ad.vec3.sub(Ot,nr,ce),B||(v?Ot[2]*=te:Ot[2]=gt);const hr=i.ad.vec3.dot(Ot,this._camera.forward());hr<vt&&(vt=hr,Lt=Math.abs(Ot[2]))}let Zt=(1<<We-Ve.zoom)*be*it;if(Zt*=Ge(Math.max(Lt,gt),vt),vt<Zt)return!0;const gr=Ve.aabb.closestPoint(z);return gr[0]===z[0]&&gr[1]===z[1]};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)Ne.push(Re(-Ve)),Ne.push(Re(Ve));for(Ne.push(Re(0));Ne.length>0;){const Ve=Ne.pop(),ht=Ve.x,lt=Ve.y;let _t=Ve.fullyVisible;const it=()=>this.projection.name==="globe"&&(Ve.y===0||Ve.y===(1<<Ve.zoom)-1);if(!_t){let vt=_e?Ve.aabb.intersects(X):Ve.aabb.intersectsFlat(X);if(vt===0&&it()){const Lt=new i.bT(Ve.zoom,ht,lt);vt=i.bU(this,N,Lt,!0).intersects(X)}if(vt===0)continue;_t=vt===2}if(Ve.zoom!==We&&ft(Ve))for(let vt=0;vt<4;vt++){const Lt=(ht<<1)+vt%2,Nt=(lt<<1)+(vt>>1),Ot={aabb:S?Ve.aabb.quadrant(vt):i.bV(this,N,Ve.zoom+1,Lt,Nt,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:Lt,y:Nt,wrap:Ve.wrap,fullyVisible:_t,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};v&&!B&&(Ot.tileID=new i.aH(Ve.zoom+1===We?pt:Ve.zoom+1,Ve.wrap,Ve.zoom+1,Lt,Nt),Ct(Ot)),Ne.push(Ot)}else{const vt=Ve.zoom===We?pt:Ve.zoom;if(r.minzoom&&r.minzoom>vt)continue;let Lt=0;if(!_t){let gr=_e?Ve.aabb.intersectsPrecise(X):Ve.aabb.intersectsPreciseFlat(X);if(gr===0&&it()){const nr=new i.bT(Ve.zoom,ht,lt);gr=i.bU(this,N,nr,!0).intersectsPrecise(X)}if(gr===0)continue;if(r.calculateQuadrantVisibility)if(X.containsPoint(Ve.aabb.center))Lt=15;else for(let nr=0;nr<4;nr++)Ve.aabb.quadrant(nr).intersects(X)!==0&&(Lt|=1<<nr)}const Nt=z[0]-(.5+ht+(Ve.wrap<<Ve.zoom))*(1<<a-Ve.zoom),Ot=z[1]-.5-lt,Zt=Ve.tileID?Ve.tileID:new i.aH(vt,Ve.wrap,Ve.zoom,ht,lt);r.calculateQuadrantVisibility&&(Zt.visibleQuadrants=Lt),nt.push({tileID:Zt,distanceSq:Nt*Nt+Ot*Ot})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,ht=this.horizonLineFromTop();nt=nt.filter(lt=>{const _t=[0,0,0,1],it=[i.ai,i.ai,0,1],vt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());i.ad.vec4.transformMat4(_t,_t,vt),i.ad.vec4.transformMat4(it,it,vt);const Lt=i.ad.vec4.min([],_t,it),Nt=i.ad.vec4.max([],_t,it),Ot=i.bW(Lt,Nt);if(Ot===0)return!0;let Zt=!1;const gr=this._elevation;if(gr&&Ot>Ve&&ht!==0){const nr=this.calculateProjMatrix(lt.tileID.toUnwrapped());let hr;r.isTerrainDEM||(hr=gr.getMinMaxForTile(lt.tileID)),hr||(hr={min:Se,max:Ae});const lr=i.c7(this.rotation),Fr=[lr[0]*i.ai,lr[1]*i.ai,hr.max];i.ad.vec3.transformMat4(Fr,Fr,nr),Zt=(1-Fr[1])*this.height*.5<ht}return Ot<Ve||Zt})}return nt.sort((Ve,ht)=>Ve.distanceSq-ht.distanceSq).map(Ve=>Ve.tileID)}resize(r,a){this.width=r,this.height=a,this.pixelsToGLUnits=[2/r,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const a=i.ay(r.lat,-i.bX,i.bX),f=this.projection.project(r.lng,a);return new i.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,a){let f,_;const v=this.centerPoint;if(this.projection.name==="globe"){const R=this.worldSize;f=(a.x-v.x)/R,_=(a.y-v.y)/R}else{const R=this.pointCoordinate(a),D=this.pointCoordinate(v);f=R.x-D.x,_=R.y-D.y}const S=this.locationCoordinate(r);this.setLocation(new i.ac(S.x-f,S.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,a){return this.projection.locationPoint(this,r,a)}locationPoint3D(r,a){return this.projection.locationPoint(this,r,a,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,a){return this.coordinateLocation(this.pointCoordinate3D(r,a))}locationCoordinate(r,a){const f=a?i.bH(a,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new i.ac(_.x,_.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,a){const f=a??this._centerAltitude,_=[r.x,r.y,0,1],v=[r.x,r.y,1,1];i.ad.vec4.transformMat4(_,_,this.pixelMatrixInverse),i.ad.vec4.transformMat4(v,v,this.pixelMatrixInverse);const S=v[3];i.ad.vec4.scale(_,_,1/_[3]),i.ad.vec4.scale(v,v,1/S);const R=_[2],D=v[2];return{p0:_,p1:v,t:R===D?0:(f-R)/(D-R)}}screenPointToMercatorRay(r){const a=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return i.ad.vec4.transformMat4(a,a,this.pixelMatrixInverse),i.ad.vec4.transformMat4(f,f,this.pixelMatrixInverse),i.ad.vec4.scale(a,a,1/a[3]),i.ad.vec4.scale(f,f,1/f[3]),a[2]=i.bH(a[2],this._center.lat)*this.worldSize,f[2]=i.bH(f[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(a,a,1/this.worldSize),i.ad.vec4.scale(f,f,1/this.worldSize),new i.as([a[0],a[1],a[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],f,a)))}rayIntersectionCoordinate(r){const{p0:a,p1:f,t:_}=r,v=i.bH(a[2],this._center.lat),S=i.bH(f[2],this._center.lat);return new i.ac(i.ah(a[0],f[0],_)/this.worldSize,i.ah(a[1],f[1],_)/this.worldSize,i.ah(v,S,_))}pointCoordinate(r,a=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,a)}pointCoordinate3D(r,a){if(!this.elevation)return this.pointCoordinate(r,a);let f=this.projection.pointCoordinate3D(this,r.x,r.y);if(f)return new i.ac(f[0],f[1],f[2]);let _=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r,a);const S=.02*v,R=r.clone();for(let D=0;D<10&&v-_>S;D++){R.y=i.ah(_,v,.66);const N=this.projection.pointCoordinate3D(this,R.x,R.y);N?(v=R.y,f=N):_=R.y}return f?new i.ac(f[0],f[1],f[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(r);const a=this.pointCoordinate(r);return a.y>=0&&a.y<=1}_coordinatePoint(r,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return i.ad.vec4.transformMat4(_,_,this.pixelMatrix),_[3]>0?new i.P(_[0]/_[3],_[1]/_[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new i.P(a,r)),S=this.pointLocation3D(new i.P(_,r)),R=this.pointLocation3D(new i.P(_,f)),D=this.pointLocation3D(new i.P(a,f));let N=Math.min(v.lng,S.lng,R.lng,D.lng),z=Math.max(v.lng,S.lng,R.lng,D.lng),B=Math.min(v.lat,S.lat,R.lat,D.lat),V=Math.max(v.lat,S.lat,R.lat,D.lat);const X=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,te=(ae,ce,_e,be,xe)=>{const Ae=(ae+_e)/2,Se=(ce+be)/2,Te=new i.P(Ae,Se),{lng:Ee,lat:Re}=this.pointLocation3D(Te),Ne=Math.max(0,N-Ee,B-Re,Ee-z,Re-V);N=Math.min(N,Ee),z=Math.max(z,Ee),B=Math.min(B,Re),V=Math.max(V,Re),(xe<se||Ne>X)&&(te(ae,ce,Ae,Se,xe+1),te(Ae,Se,_e,be,xe+1))};if(te(a,r,_,r,1),te(_,r,_,f,1),te(_,f,a,f,1),te(a,f,a,r,1),this.projection.name==="globe"){const[ae,ce]=i.bZ(this);ae?(V=90,z=180,N=-180):ce&&(B=-90,z=180,N=-180)}return new i.aB(new i.bO(N,B),new i.bO(z,V))}_getBoundsRectangular(r,a){const{top:f,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,R=new i.P(_,f),D=new i.P(S,f),N=new i.P(S,v),z=new i.P(_,v);let B=this.pointCoordinate(R,r),V=this.pointCoordinate(D,r);const X=this.pointCoordinate(N,a),se=this.pointCoordinate(z,a),te=(ae,ce)=>(ce.y-ae.y)/(ce.x-ae.x);return B.y>1&&V.y>=0?B=new i.ac((1-se.y)/te(se,B)+se.x,1):B.y<0&&V.y<=1&&(B=new i.ac(-se.y/te(se,B)+se.x,0)),V.y>1&&B.y>=0?V=new i.ac((1-X.y)/te(X,V)+X.x,1):V.y<0&&B.y<=1&&(V=new i.ac(-X.y/te(X,V)+X.x,0)),new i.aB().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=r.visibleDemTiles.reduce((f,_)=>{if(_.dem){const v=_.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*r.exaggeration(),a.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,a){return this.projection.createTileMatrix(this,a,r)}calculateDistanceTileData(r){const a=r.key,f=this._distanceTileDataCache;if(f[a])return f[a];const _=r.canonical,v=1/this.height,S=this.cameraWorldSize,R=S/this.zoomScale(_.z),D=(_.x+Math.pow(2,_.z)*r.wrap)*R,N=_.y*R,z=this.point;z.x*=S/this.worldSize,z.y*=S/this.worldSize;const B=this.angle,V=Math.sin(-B),X=-Math.cos(-B);return f[a]={bearing:[V,X],center:[(z.x-D)*v,(z.y-N)*v],scale:R/i.ai*v},f[a]}calculateFogTileMatrix(r){const a=r.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.ad.mat4.multiply(_,this.worldToFogMatrix,_),f[a]=new Float32Array(_),f[a]}calculateProjMatrix(r,a=!1,f=!1){const _=r.key;let v;if(v=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];const S=this.calculatePosMatrix(r,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(S,R,S),v[_]=new Float32Array(S),v[_]}calculatePixelsToTileUnitsMatrix(r){const a=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const _=i.b_(r,this);return f[a]=_,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,a=i.ad.mat4.fromScaling([],[r,r,r]);return i.ad.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const a=i.bH(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),_=this._camera.forward(),v=i.bH(1,this._center.lat);f[2]/=v,_[2]/=v,i.ad.vec3.normalize(_,_);const S=r.raycast(f,_,r.exaggeration());if(S){const R=i.ad.vec3.scaleAndAdd([],f,_,S),D=new i.ac(R[0],R[1],i.bH(R[2],i.aT(R[1]))),N=(D.z+i.ad.vec3.length([D.x-f[0],D.y-f[1],D.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const a=this._elevation,f=i.bH(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),v=a.getAtPointOrZero(new i.ac(..._)),S=this.pixelsPerMeter/this.worldSize*v,R=this._minimumHeightOverTerrain(),D=_[2]-S;if(D<=R)if(D<0||r){const N=this.locationCoordinate(this._center,this._centerAltitude),z=[_[0],_[1],N.z-_[2]],B=i.ad.vec3.length(z);z[2]-=(R-D)/this._pixelsPerMercatorPixel;const V=i.ad.vec3.length(z);if(V===0)return;i.ad.vec3.scale(z,z,B/V*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],N.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const V=this.center;return V.lat=i.ay(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(V.lng=i.ay(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:_}=this.point;let v=0,S=f,R=_;const D=this.width/2,N=this.height/2,z=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(_-N<z&&(R=z+N),_+N>B&&(R=B-N),B-z<this.height&&(v=Math.max(v,this.height/(B-z)),R=(B+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,se=this.worldSize/2-(V+X)/2;S=(f+se+this.worldSize)%this.worldSize-se,S-D<V&&(S=V+D),S+D>X&&(S=X-D),X-V<this.width&&(v=Math.max(v,this.width/(X-V)),S=(X+V)/2)}S===f&&R===_||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(S,R))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const _=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?f:1,S=this._camera.getWorldToCamera(this.worldSize,v);let R;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height,this.isOrthographic){let Re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ne=Re*this.aspect,nt=-Ne,We=-Re;Ne-=r.x,nt-=r.x,Re+=r.y,We+=r.y,R=this._camera.getCameraToClipOrthographic(nt,Ne,We,Re,this._nearZ,this._farZ),((pt,gt,Ct,Ge)=>{for(let ft=0;ft<16;ft++)pt[ft]=i.ah(gt[ft],Ct[ft],Ge)})(R,R,D,i.c9(this.pitch>=Rt?1:this.pitch/Rt))}else R=D;const N=i.ad.mat4.mul([],D,S);let z=i.ad.mat4.mul([],R,S);if(this.projection.isReprojectedInTileSpace){const Re=this.locationCoordinate(this.center),Ne=i.ad.mat4.identity([]);i.ad.mat4.translate(Ne,Ne,[Re.x*this.worldSize,Re.y*this.worldSize,0]),i.ad.mat4.multiply(Ne,Ne,i.c0(this)),i.ad.mat4.translate(Ne,Ne,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),i.ad.mat4.multiply(z,z,Ne),i.ad.mat4.multiply(N,N,Ne),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],z,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=z,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),a){const Re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Re[8]=2*-r.x/this.width,Re[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],Re,S)}else this.expandedFarZProjMatrix=this.projMatrix;const B=i.ad.mat4.invert([],R);this.frustumCorners=i.c2.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const V=new Float32Array(16);i.ad.mat4.identity(V),i.ad.mat4.scale(V,V,[1,-1,1]),i.ad.mat4.rotateX(V,V,this._pitch),i.ad.mat4.rotateZ(V,V,this.angle);const X=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(X);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-r.x/this.width,X[9]=2*(r.y+se)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(V,X,V);const te=this.point,ae=te.x,ce=te.y,_e=this.width%2/2,be=this.height%2/2,xe=Math.cos(this.angle),Ae=Math.sin(this.angle),Se=ae-Math.round(ae)+xe*_e+Ae*be,Te=ce-Math.round(ce)+xe*be+Ae*_e,Ee=new Float64Array(z);if(i.ad.mat4.translate(Ee,Ee,[Se>.5?Se-1:Se,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=Ee,z=i.ad.mat4.create(),i.ad.mat4.scale(z,z,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=i.ad.mat4.create(),i.ad.mat4.scale(z,z,[1,-1,1]),i.ad.mat4.translate(z,z,[-1,-1,0]),i.ad.mat4.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},z=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(Re,Re,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,a];i.ad.vec3.scale(v,v,_),i.ad.vec3.scale(f,f,-1),i.ad.vec3.multiply(f,f,v);const S=i.ad.mat4.create();i.ad.mat4.translate(S,S,f),i.ad.mat4.scale(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,a,_)}_computeCameraPosition(r){const a=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*v,_.y/this.worldSize-f[1]*v,r/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=r[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((a-f)/_,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),v=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),R=Math.max((r[2]-v)/Math.cos(f),S),D=this._zoomFromMercatorZ(R);i.ad.vec3.scaleAndAdd(r,r,a,R),this._pitch=i.ay(f,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(_,-Math.PI,Math.PI),this._setZoom(i.ay(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let a=0,f=i.bY,_=0,v=1/0;for(;f-a>1e-6&&f>a;){const S=a+.5*(f-a),R=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,R),N=this.scaleZoom(D/(r*this.tileSize)),z=Math.abs(S-N);z<v&&(v=z,_=S),S<N?a=S:f=S}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,a){const f=Math.min(r.x,a.x),_=Math.max(r.x,a.x),v=Math.min(r.y,a.y),S=Math.max(r.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const R=[new i.P(f,v),new i.P(_,S),new i.P(f,S),new i.P(_,v)],D=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const z of R){const B=this.pointRayIntersection(z);if(B.t<0)return!0;const V=this.rayIntersectionCoordinate(B);if(V.x<D||V.y<0||V.x>N||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,a){const f=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([a,f,_],v){const S=[a,f,_,1];i.ad.vec4.transformMat4(S,S,v);const R=S[3]=Math.max(S[3],1e-6);return S[0]/=R,S[1]/=R,S[2]/=R,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,a=this.zoom,f=this.worldSize){const _=i.b$(r,a,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,f,_);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=i.ah(1,S,i.c9(this.pitch>=Rt?1:this.pitch/Rt))),S}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(r,r,this.globeMatrix),r}getFrustum(r){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const Sa=(p,r)=>{if(r>0&&p.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=p.transform,f=Math.max(Math.abs(a._zoom-(p.minCutoffZoom-1)),1),_=a.isLODDisabled(!1)?i.ae(60,45,a.pitch):i.ae(30,15,a.pitch),v=a._farZ-a._nearZ,S=r*a.height,R=((1-(D=_))*a.cameraToCenterDistance+D*(a._farZ+S))*f;var D;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(R-a._nearZ)/v,(R-S-a._nearZ)/v]}}},Gi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class ev{constructor(r,a){this.aabb=r,this.lastCascade=a}}class Jh{add(r,a){const f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[r.key]=new ev(a,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,a,f){const _=i.ce.fromPoints(r.points);let v=0;for(const S in this.receivers){const R=this.receivers[S];if(!R||!_.intersectsAabb(R.aabb))continue;R.aabb.min=_.closestPoint(R.aabb.min),R.aabb.max=_.closestPoint(R.aabb.max);const D=R.aabb.getCorners();for(let N=0;N<f.length;N++){let z=!0;for(const B of D){const V=[B[0]*a,B[1]*a,B[2]];if(i.ad.vec3.transformMat4(V,V,f[N].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){z=!1;break}}if(R.lastCascade=N,v=Math.max(v,N),z)break}}return v+1}}class Ta{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Jh,this._depthMode=new Jt(r.context.gl.LEQUAL,Jt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Gi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Gi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(Gi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,a){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const _=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((se,te)=>{const ae=f.style._mergedLayers[te];return se+(ae.hasShadowPass()&&!ae.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=f.context,S=Gi.shadowMapResolution,R=Gi.shadowMapResolution;if(this._cascades.length===0||Gi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<Gi.cascadeCount;++se){const te=f._shadowMapDebug,ae=v.gl,ce=v.createFramebuffer(S,R,te,"texture"),_e=new i.T(v,{width:S,height:R,data:null},ae.DEPTH_COMPONENT16);if(ce.depthAttachment.set(_e.texture),te){const be=new i.T(v,{width:S,height:R,data:null},ae.RGBA8);ce.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:ce,texture:_e,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=cl(a);let D=0;if(r.elevation){const se=r.elevation,te=[1e4,-1e4];se.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const ce=ae.dem.tree;te[0]=Math.min(te[0],ce.minimums[0]),te[1]=Math.max(te[1],ce.maximums[0])}),te[0]!==1e4&&(D=(te[1]-te[0])*se.exaggeration())}const N=1.5*r.cameraToCenterDistance,z=3*N,B=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const te=this._cascades[se];let ae=r.height/50,ce=1;Gi.cascadeCount===1?ce=z:se===0?ce=N:(ae=N,ce=z);const[_e,be]=Lc(r,this.shadowDirection,ae,ce,Gi.shadowMapResolution,D);te.scale=r.scale,te.matrix=_e,te.boundingSphereRadius=be,i.ad.mat4.invert(B,te.matrix),te.frustum=i.bR.fromInvProjectionMatrix(B,1,0,!0),te.far=ce}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Gi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Gi.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hn.ShadowMap0,this._uniformValues.u_shadowmap_1=Hn.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=f.transform.elevation;for(const se of this._groundShadowTiles){let te={min:0,max:0};if(X){const ae=X.getMinMaxForTile(se);ae&&(te=ae)}this.addShadowReceiver(se.toUnwrapped(),te.min,te.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,a){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,Gi.shadowMapResolution,Gi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:i.al.white,depth:1});for(const S of r.order){const R=r._mergedLayers[S];if(!R.hasShadowPass()||R.isHidden(f.transform.zoom))continue;const D=r.getLayerSourceCache(R),N=D?a[D.id]:void 0;(R.type==="model"||N&&N.length)&&f.renderLayer(f,D,R,N)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,a=r.style,f=r.context,_=a.directionalLight,v=a.ambientLight;if(!_||!v)return;const S=[],R=Sa(r,r.longestCutoffRange);R.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const D=Dc(a,_,v),N=new Jt(f.gl.LEQUAL,Jt.ReadOnly,r.depthRangeFor3D);for(const z of this._groundShadowTiles){const B=z.toUnwrapped(),V=r.isTileAffectedByFog(z),X=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:V});this.setupShadows(B,X),r.uploadCommonUniforms(f,X,B,null,R);const se={u_matrix:r.transform.calculateProjMatrix(B),u_ground_shadow_factor:D};X.draw(r,f.gl.TRIANGLES,N,vr.disabled,kr.multiply,mr.disabled,se,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?kr.unblended:kr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const a=this.painter.transform,f=a.calculatePosMatrix(r,a.worldSize);return i.ad.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return i.ad.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,a,f,_=0){if(!this.enabled)return;const v=this.painter.transform,S=this.painter.context,R=S.gl,D=this._uniformValues,N=new Float64Array(16),z=v.calculatePosMatrix(r,v.worldSize);for(let B=0;B<this._cascades.length;B++)i.ad.mat4.multiply(N,this._cascades[B].matrix,z),D[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),S.activeTexture.set(R.TEXTURE0+Hn.ShadowMap0+B),this._cascades[B].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const B=i.cd(r.canonical),V=2/v.tileSize*i.ai/Gi.shadowMapResolution,X=V*this._cascades[0].boundingSphereRadius,se=V*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(f==="vector-tile"?1:3)/Math.pow(2,_-r.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[B,X*te,se*te],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(S,D)}setupShadowsFromMatrix(r,a,f=!1){if(!this.enabled)return;const _=this.painter.context,v=_.gl,S=this._uniformValues,R=new Float64Array(16);for(let D=0;D<Gi.cascadeCount;D++)i.ad.mat4.multiply(R,this._cascades[D].matrix,r),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),_.activeTexture.set(v.TEXTURE0+Hn.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){const D=Gi.normalOffset;S.u_shadow_normal_offset=[1,D,D],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(_,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,a,f,_){if(_[2]>=0)return{};const v=function(D,N,z){const B=z/(1<<D.canonical.z);return new i.ce([D.canonical.x*B+D.wrap*z,D.canonical.y*B+D.wrap*z,0],[(D.canonical.x+1)*B+D.wrap*z,(D.canonical.y+1)*B+D.wrap*z,N])}(r,a,f).getCorners(),S=a/-_[2];_[0]<0?(i.ad.vec3.add(v[0],v[0],[_[0]*S,0,0]),i.ad.vec3.add(v[3],v[3],[_[0]*S,0,0])):_[0]>0&&(i.ad.vec3.add(v[1],v[1],[_[0]*S,0,0]),i.ad.vec3.add(v[2],v[2],[_[0]*S,0,0])),_[1]<0?(i.ad.vec3.add(v[0],v[0],[0,_[1]*S,0]),i.ad.vec3.add(v[1],v[1],[0,_[1]*S,0])):_[1]>0&&(i.ad.vec3.add(v[2],v[2],[0,_[1]*S,0]),i.ad.vec3.add(v[3],v[3],[0,_[1]*S,0]));const R={};return R.vertices=v,R.planes=[kc(v[1],v[0],v[4]),kc(v[2],v[1],v[5]),kc(v[3],v[2],v[6]),kc(v[0],v[3],v[7])],R}addShadowReceiver(r,a,f){this._receivers.add(r,i.ce.fromTileIdAndHeight(r,a,f))}getMaxCascadeForTile(r){const a=this._receivers.get(r);return a&&a.lastCascade?a.lastCascade:0}}function kc(p,r,a){const f=i.ad.vec3.sub([],a,r),_=i.ad.vec3.sub([],p,r),v=i.ad.vec3.cross([],f,_),S=i.ad.vec3.length(v);return S===0?[0,0,1,0]:(i.ad.vec3.scale(v,v,1/S),[v[0],v[1],v[2],-i.ad.vec3.dot(v,r)])}function cl(p){const r=p.properties.get("direction"),a=i.cc(r.x,r.y,r.z);a[2]=i.ay(a[2],0,75);const f=i.cf([a[0],a[1],a[2]]);return i.ad.vec3.fromValues(f.x,f.y,f.z)}function Dc(p,r,a){const f=r.properties.get("color-use-theme")==="none",_=r.properties.get("color"),v=r.properties.get("intensity"),S=r.properties.get("direction"),R=[S.x,S.y,S.z],D=a.properties.get("color-use-theme")==="none",N=a.properties.get("color"),z=a.properties.get("intensity"),B=Math.max(i.ad.vec3.dot([0,0,1],R),0),V=[0,0,0];i.ad.vec3.scale(V,N.toRenderColor(D?null:p.getLut(r.scope)).toArray01Linear().slice(0,3),z);const X=[0,0,0];return i.ad.vec3.scale(X,_.toRenderColor(f?null:p.getLut(a.scope)).toArray01Linear().slice(0,3),B*v),i.cg([V[0]>0?V[0]/(V[0]+X[0]):0,V[1]>0?V[1]/(V[1]+X[1]):0,V[2]>0?V[2]/(V[2]+X[2]):0])}function Lc(p,r,a,f,_,v){const S=p.zoom,R=p.scale,D=p.worldSize,N=1/D,z=p.aspect,B=Math.sqrt(1+z*z)*Math.tan(.5*p.fovX),V=B*B,X=f-a,se=f+a;let te,ae;V>X/se?(te=f,ae=f*B):(te=.5*se*(1+V),ae=.5*Math.sqrt(X*X+2*(f*f+a*a)*V+se*se*V*V));const ce=p.projection.pixelsPerMeter(p.center.lat,D),_e=p._camera.getCameraToWorldMercator(),be=[0,0,-te*N];i.ad.vec3.transformMat4(be,be,_e);let xe=ae*N;const Ae=p._edgeInsets;if(!(Ae.left===0&&Ae.top===0&&Ae.right===0&&Ae.bottom===0||Ae.left===Ae.right&&Ae.top===Ae.bottom)){const _t=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ce:1),it=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,a,f);it[8]=2*-p.centerOffset.x/p.width,it[9]=2*p.centerOffset.y/p.height;const vt=new Float64Array(16);i.ad.mat4.mul(vt,it,_t);const Lt=new Float64Array(16);i.ad.mat4.invert(Lt,vt);const Nt=i.bR.fromInvProjectionMatrix(Lt,D,S,!0);for(const Ot of Nt.points){const Zt=((Se=Ot)[0]/=R,Se[1]/=R,Se[2]=i.bH(Se[2],p._center.lat),Se);xe=Math.max(xe,i.ad.vec3.len(i.ad.vec3.subtract([],be,Zt)))}}var Se;xe*=_/(_-1);const Te=Math.acos(r[2]),Ee=Math.atan2(-r[0],-r[1]),Re=new Rc;Re.position=be,Re.setPitchBearing(Te,Ee);const Ne=Re.getWorldToCamera(D,ce),nt=xe*D,We=Math.min(p._mercatorZfromZoom(17)*D*-2,-2*nt),pt=Re.getCameraToClipOrthographic(-nt,nt,-nt,nt,We,(nt+v*ce)/r[2]),gt=new Float64Array(16);i.ad.mat4.multiply(gt,pt,Ne);const Ct=i.ad.vec3.fromValues(Math.floor(1e6*be[0])/1e6*D,Math.floor(1e6*be[1])/1e6*D,0),Ge=.5*_,ft=[0,0,0];i.ad.vec3.transformMat4(ft,Ct,gt),i.ad.vec3.scale(ft,ft,Ge);const Ve=[Math.floor(ft[0]),Math.floor(ft[1]),Math.floor(ft[2])],ht=[0,0,0];i.ad.vec3.sub(ht,ft,Ve),i.ad.vec3.scale(ht,ht,-1/Ge);const lt=new Float64Array(16);return i.ad.mat4.identity(lt),i.ad.mat4.translate(lt,lt,ht),i.ad.mat4.multiply(gt,lt,gt),[gt,nt]}class Db extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(r,a){return i.aN(this.requestManager.transformRequest(a,i.R.Model).url).then(f=>{if(!f)return;const _=i.aO(f),v=new i.aP(r,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${r} from ${a}: ${f.message}`)))})}load(r,a,f={keepNumReferences:!1}){this.models[a]||(this.models[a]={});const _=Object.keys(r);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+_.length;const v=[];for(const S of _)v.push(this.loadModel(S,r[S]));Promise.allSettled(v).then(S=>{for(let R=0;R<S.length;R++){const{status:D,value:N}=S[R];if(D==="fulfilled"&&N){const z=this.models[a][_[R]];this.models[a][_[R]]={model:N,numReferences:f.keepNumReferences&&z?z.numReferences:1}}}this.numModelsLoading[a]-=_.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(S=>{this.fire(new i.z(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,a){return!!this.getModel(r,a)}getModel(r,a){return this.models[a]||(this.models[a]={}),this.models[a][r]?this.models[a][r].model:void 0}addModel(r,a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={}),this.hasModel(r,f)&&this.models[f][r].numReferences++,this.modelUris[f][r]=this.requestManager.normalizeModelURL(a),this.load({[r]:this.modelUris[f][r]},f)}addModels(r,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f=this.modelUris[a];for(const _ in r)this.models[a][_]={},f[_]=this.requestManager.normalizeModelURL(r[_]);this.load(f,a,{keepNumReferences:!0})}reloadModels(r){this.load(this.modelUris[r],r)}addModelsFromBucket(r,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f={};for(const _ of r)this.hasModel(_,a)?this.models[a][_].numReferences++:(this.modelUris[a][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[a][_]);this.load(f,a)}removeModel(r,a){if(this.models[a]&&this.models[a][r]&&(this.models[a][r].numReferences--,this.models[a][r].numReferences===0)){const f=this.models[a][r].model;delete this.models[a][r],delete this.modelUris[a][r],f.destroy()}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,a){this.models[a]||(this.models[a]={});for(const f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(r.context)}}const Lb=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),Mm={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function tv(p){return p=p||{},Object.assign(p,Mm)}class rv extends i.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(r){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,R){const[D,N]=S,{center:z,radius:B}=R,[V,X]=z,se=Math.abs(D-V);return Math.sqrt((se>180?360-se:se)**2+(N-X)**2)<=B}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=new i.P(this._map.transform.width/2,this._map.transform.height/2),_=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(r?_:f,a);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(r){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){const[[S,R],[D,N]]=v,z=(D-S+360)%360,B=z>180?360-z:z;return{center:[(S+B/2+360)%360,(R+N)/2],radius:Math.sqrt(B**2+(N-R)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const a=this._floorplanStates[this._indoorData.id].selectedBuilding,f=this._floorplanStates[this._indoorData.id].selectedLevel;let _;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const v of this._indoorData.levels)v.id===this._selectedLevel.id&&(_=v.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:_})),a){const v=this._indoorData.buildings.find(S=>S.id===a);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(f){const v=this._indoorData.levels.find(S=>S.id===f);this._updateLevels(v,r)}else r&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(r,a){a&&r&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const f=this._indoorData.levels.filter(_=>r.levels.includes(_.id));this.fire(new i.A("buildingselected",{buildingId:r.id,levels:f}))}_levelSelected(r){if(r==="overview")this._updateLevels(void 0,!0);else{const a=this._indoorData.levels.find(f=>f.id===r);this._updateLevels(a,!0)}this.fire(new i.A("levelselected",{levelId:r==="overview"?void 0:r}))}_updateLevels(r,a){if(!r)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(a&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function f(N){const z=N.indexOf("/floor/");if(z===-1)return N;const B=z+7,V=N.indexOf("/",B);return V===-1?N.slice(B):N.slice(B,V)}this._selectedLevel=r,this._floorplanStates[this._indoorData.id].selectedLevel=r?r.id:void 0;const _=[],v={},S={},R={},D={};for(const N of this._indoorData.levels)if(_.push(N.id),v[N.id]=N.height,S[N.id]=N.base,r){if(this.mergeFloors){const z=f(r.id),B=f(N.id);R[N.id]=B===z?"true":"false"}else R[N.id]=N.id===r.id?"true":"false";D[N.id]=N.base<r.base?"true":"false"}else D[N.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",D]),r&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!r.isUnderground),a&&r.extent)){const N=this._map.cameraForBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),z=this._map.getZoom(),B=N.zoom?Math.abs(z-N.zoom):0;this._map.fitBounds(r.extent,B>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:z})}}selectFloorplan(r){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(f,a);if(_.length>0){for(const v of _)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(r)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(r){const a=this._indoorData.buildings.find(f=>f.id===r);this._buildingSelected(a,!0)}selectLevel(r){this._levelSelected(r)}}function nv(p){if(!p.metadata||!p.metadata.content_area)return;const r=i.q.devicePixelRatio,{left:a,top:f,width:_,height:v}=p.metadata.content_area,S=a*r,R=f*r;return[S,R,S+_*r,R+v*r]}function Qh(p){if(p)return p.map(([r,a])=>[r*i.q.devicePixelRatio,a*i.q.devicePixelRatio])}class Nb{constructor(r,a){this.id=r,this.style=a}addIcons(r){const a=new Map;for(const[f,_]of r.entries()){const v=i.I.from({name:f,iconsetId:this.id});a.set(v,_)}this.style.addImages(a)}}const $l=(p,r)=>tt(p,r&&r.filter(a=>a.identifier!=="source.canvas")),Ob=i.aA(Kr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),zb=i.aA(Kr,["setCenter","setZoom","setBearing","setPitch"]),ef=new Set(["background","sky","slot","custom"]),iv={version:8,layers:[],sources:{}},bd={duration:300,delay:0};class Do extends i.E{constructor(r,a={}){super(),this.map=r,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=i.l({},bd),this._buildingIndex=new Ky(this),this.crossTileSymbolIndex=new kb,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new jr,this.dispatcher=a.dispatcher?a.dispatcher:new i.D(i.cj(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new dn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new i.ck(r._requestManager,a.localFontFamily?i.cl.all:a.localIdeographFontFamily?i.cl.ideographs:i.cl.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Db(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const f=this;this._rtlTextPluginCallback=Do.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,S)=>{if(i.cn(v),S&&S.every(R=>R))for(const R in f._sourceCaches){const D=f._sourceCaches[R],N=D.getSource().type;N!=="vector"&&N!=="geojson"||D.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const R=this._layers[S];R.source===v.id&&this._validateLayer(R)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(i.f(r))return r;const a=i.co(r);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${i.cp(JSON.stringify(r))}`}_diffStyle(r,a,f){this.globalId=this._getGlobalId(r);const _=(v,S)=>{try{S(null,this.setState(v,f))}catch(R){S(R,!1)}};if(typeof r=="string"){const v=this.map._requestManager.normalizeStyleURL(r),S=this.map._requestManager.transformRequest(v,i.R.Style);i.n(S,(R,D)=>{R?this.fire(new i.z(R)):D&&_(D,a)})}else typeof r=="object"&&_(r,a)}loadURL(r,a={}){this.fire(new i.A("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!i.f(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,a.accessToken),this.resolvedImports.add(r);const _=this.importsCache.get(r);if(_)return this._load(_,f);const v=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.n(v,(S,R)=>{if(this._request=null,S)this.fire(new i.z(S));else if(R)return this.importsCache.set(r,R),this._load(R,f)})}loadJSON(r,a={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=i.q.frame(()=>{this._request=null,this._load(r,a.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(iv,!1)}_loadImports(r,a,f){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const v of r){const S=this._createFragmentStyle(v),R=new Promise(z=>{S.once("style.import.load",z),S.once("error",z)}).then(()=>this.mergeAll());if(_.push(R),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const D=v.data||this.importsCache.get(v.url);D?(S.loadJSON(D,{validate:a}),this._isInternalStyle(D)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:a}):S.loadEmpty();const N={style:S,id:v.id,config:v.config};if(f){const z=this.fragments.findIndex(({id:B})=>B===f);this.fragments=this.fragments.slice(0,z).concat(N).concat(this.fragments.slice(z))}else this.fragments.push(N)}return Promise.allSettled(_)}getImportGlobalIds(r=this,a=new Set){for(const f of r.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(r){const a=this.scope?i.C(r.id,this.scope):r.id;let f;const _=this._initialConfig&&this._initialConfig[a];(r.config||_)&&(f=i.l({},r.config,_));const v=new Do(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,a){const f=r.indoor?tv(r.schema):r.schema;if(this._isInternalStyle(r)){const S=i.l({},iv,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(S,a)}if(this.updateConfig(this._config,f),a&&$l(this,jn(r)))return;this._loaded=!0,this.stylesheet=i.cq(r);const _=()=>{for(const N in r.sources)this.addSource(N,r.sources[N],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const N in r.iconsets)this.addIconset(N,r.iconsets[N]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(r.glyphs);const S=fd(this.stylesheet.layers);if(this._order=S.map(N=>N.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const N=this.stylesheet.lights[0];this.light=new st(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new st(this.stylesheet.light)),this._layers={};for(const N of S){const z=i.cv(N,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const B=this.getOwnLayerSourceCache(z),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&z.canCastShadows()&&V&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const R=this.stylesheet.terrain;R&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(R,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const D=this.isRootStyle();r.imports?this._loadImports(r.imports,a).then(()=>{this._reloadImports(),this.fire(new i.A(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{_()}).catch(R=>{i.w(`Couldn't load color theme from the stylesheet: ${R}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,a,f,_,v,S,R,D,N,z;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(r=V.light),V.stylesheet.lights)for(const X of V.stylesheet.lights)X.type==="ambient"&&V.ambientLight!=null&&(a=V.ambientLight),X.type==="directional"&&V.directionalLight!=null&&(f=V.directionalLight);_=this._prioritizeTerrain(_,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(v=V.fog),V.stylesheet.snow&&V.snow!=null&&(S=V.snow),V.stylesheet.rain&&V.rain!=null&&(R=V.rain),V.stylesheet.camera!=null&&(z=V.stylesheet.camera),V.stylesheet.projection!=null&&(D=V.stylesheet.projection),V.stylesheet.transition!=null&&(N=V.stylesheet.transition),B[V.scope]=V._styleColorTheme}}),this.light=r,this.ambientLight=a,this.directionalLight=f,this.fog=v,this.snow=S,this.rain=R,this._styleColorThemeForScope=B,_===null?delete this.terrain:this.terrain=_,this.camera=z||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=i.l({},bd,N),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const a=f=>{for(const _ of f.fragments)a(_.style);r(f)};a(this)}_prioritizeTerrain(r,a,f){const _=r&&r.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:_?r:null:a!=null&&(!r||_||a&&a.drapeRenderMode===1)?a:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{r=this._prioritizeTerrain(r,a.terrain,a.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(r=a.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},a={},f={};this.forEachFragmentStyle(_=>{for(const v in _._sourceCaches){const S=i.C(v,_.scope);r[S]=_._sourceCaches[v]}for(const v in _._otherSourceCaches){const S=i.C(v,_.scope);a[S]=_._otherSourceCaches[v]}for(const v in _._symbolSourceCaches){const S=i.C(v,_.scope);f[S]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){const r={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const S of v._order){const R=v._layers[S];if(R.type==="slot"){const D=i.cr(S);if(r[D])continue;r[D]=[]}R.slot&&r[R.slot]?r[R.slot].push(R):a.push(R)}}),this._mergedOrder=[];const _=(v=[])=>{for(const S of v)if(S.type==="slot"){const R=i.cr(S.id);r[R]&&_(r[R]),this._mergedSlots.push(R)}else{const R=i.C(S.id,S.scope);this._mergedOrder.push(R),f[R]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};_(a),this._mergedOrder.sort((v,S)=>{const R=f[v],D=f[S];return R.hasInitialOcclusionOpacityProperties?D.is3D(!!this.terrain)?1:0:R.is3D(!!this.terrain)&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.l({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(a,f,_){const v=i.l({},f);for(const R of Object.keys(i.a5.colorTheme))v[R]===void 0&&(v[R]=i.a5.colorTheme[R].default);const S=new i.a6(Lb,a,new Map(_));return S.setTransitionOrValue(v,_),S.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const v="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let S=r;S.startsWith(v)||(S=v+S);const R=i.I.from("mapbox-reserved-lut"),D=new Image;D.src=S,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;const{width:N,height:z,data:B}=i.q.getImageData(D);if(z>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==z*z)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(R)&&this.removeImage(R),this.addImage(R,{data:new i.r({width:N,height:z},B),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(R,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:r},f()):_(new Error("Missing LUT image."))}})}getLut(r){const a=this._styleColorThemeForScope[r];return a?a.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(a,f,_){let v,S,R;const D=i.q.devicePixelRatio>1?"@2x":"";let N=i.n(f.transformRequest(f.normalizeSpriteURL(a,D,".json"),i.R.SpriteJSON),(V,X)=>{N=null,R||(R=V,v=X,B())}),z=i.o(f.transformRequest(f.normalizeSpriteURL(a,D,".png"),i.R.SpriteImage),(V,X)=>{z=null,R||(R=V,S=X,B())});function B(){if(R)_(R);else if(v&&S){const V=i.q.getImageData(S),X={};for(const se in v){const{width:te,height:ae,x:ce,y:_e,sdf:be,pixelRatio:xe,stretchX:Ae,stretchY:Se,content:Te}=v[se],Ee=new i.r({width:te,height:ae});i.r.copy(V,Ee,{x:ce,y:_e},{x:0,y:0},{width:te,height:ae},null),X[se]={data:Ee,pixelRatio:xe,sdf:be,stretchX:Ae,stretchY:Se,content:Te,usvg:!1}}_(null,X)}}return{cancel(){N&&(N.cancel(),N=null),z&&(z.cancel(),z=null)}}}(r,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new i.z(a));else if(f){const _=new Map;for(const v in f)_.set(i.I.from(v),f[v]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(r,a){if(a.type==="sprite")return void this._loadSprite(a.url);const f=this.getOwnSource(a.source);if(!f)return void this.fire(new i.z(new Error(`Source "${a.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));if(f.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${a.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,r);const _=new Nb(r,this);f.addIconset(r,_)}_loadIconset(r){if(!i.f(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const a=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(v,S)=>{if(this._spriteRequest=null,v)a?this._loadSprite(r):this.fire(new i.z(v));else if(S){const R=new Map;for(const D in S)R.set(i.I.from(D),S[D]);this.addImages(R)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(r),i.R.Iconset),(v,S)=>{if(v)return void _(v);const R={},D=i.ch(new i.bi(S));for(const N of D.icons){const z={version:1,pixelRatio:i.q.devicePixelRatio,content:nv(N),stretchX:N.metadata?Qh(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?Qh(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};R[N.name]=z}_(null,R)}))}_validateLayer(r){const a=this.getOwnSource(r.source);if(!a)return;const f=r.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new i.z(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,a)=>{const f=this.fragments[a];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){const r={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){const a=[];for(const f of r){const _=this._layers[f];_&&_.type!=="custom"&&a.push(_.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const a=this.getOwnLayer(r);if(a)return a;this.fire(new i.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const a=this.getOwnSource(r);if(a)return a;this.fire(new i.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,a){const f=this.map.painter;if(f)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){const v=r.getProgramIds();if(v)for(const S of v){const R=r.getDefaultProgramParams(S,a.zoom,this._styleColorTheme.lut);R&&(f.style=this,this.fog&&(f._fogVisible=!0,R.overrideFog=!0,f.getOrCreateProgram(S,R)),f._fogVisible=!1,R.overrideFog=!1,f.getOrCreateProgram(S,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,f.getOrCreateProgram(S,R)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const a=this.calculateLightsBrightness();r.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const R in S){const{updatedIds:D,removedIds:N}=S[R];(D||N)&&(this._updateWorkerLayers(R,D,N),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const v={};for(const S in this._mergedSourceCaches){const R=this._mergedSourceCaches[S];v[S]=R.used,R.used=!1,R.tileCoverLift=0}for(const S of this._mergedOrder){const R=this._mergedLayers[S];if(R.recalculate(r,this._availableImages),!R.isHidden(r.zoom)){const D=this.getLayerSourceCache(R);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,r)}):this.precompilePrograms(R,r))}for(const S in this._mergedSourceCaches){const R=this._mergedSourceCaches[S];if(!R)continue;const D=R._source;D.type==="raster-array"&&D.iconsets&&(R.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();for(const S in v){const R=this._mergedSourceCaches[S];v[S]!==R.used&&R.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,a,f){const _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:a?_._serializeLayers(a):[],scope:r,removedIds:f||[],options:_.options})}setState(r,a){if(this._checkLoaded(),$l(this,jn(r)))return!1;(r=i.cq(r)).layers=fd(r.layers);const f=function(S,R){if(!S)return[{command:Kr.setStyle,args:[R]}];let D=[];try{if(!i.bn(S.version,R.version))return[{command:Kr.setStyle,args:[R]}];if(i.bn(S.center,R.center)||D.push({command:Kr.setCenter,args:[R.center]}),i.bn(S.zoom,R.zoom)||D.push({command:Kr.setZoom,args:[R.zoom]}),i.bn(S.bearing,R.bearing)||D.push({command:Kr.setBearing,args:[R.bearing]}),i.bn(S.pitch,R.pitch)||D.push({command:Kr.setPitch,args:[R.pitch]}),i.bn(S.sprite,R.sprite)||D.push({command:Kr.setSprite,args:[R.sprite]}),i.bn(S.glyphs,R.glyphs)||D.push({command:Kr.setGlyphs,args:[R.glyphs]}),i.bn(S.imports,R.imports)||function(X=[],se=[],te){se=se||[];const ae=(X=X||[]).map(Wr),ce=se.map(Wr),_e=X.reduce(es,{}),be=se.reduce(es,{}),xe=ae.slice();let Ae,Se,Te,Ee;for(Ae=0,Se=0;Ae<ae.length;Ae++)Te=ae[Ae],be.hasOwnProperty(Te)?Se++:(te.push({command:Kr.removeImport,args:[Te]}),xe.splice(xe.indexOf(Te,Se),1));for(Ae=0,Se=0;Ae<ce.length;Ae++)Te=ce[ce.length-1-Ae],xe[xe.length-1-Ae]!==Te&&(_e.hasOwnProperty(Te)?(te.push({command:Kr.removeImport,args:[Te]}),xe.splice(xe.lastIndexOf(Te,xe.length-Se),1)):Se++,Ee=xe[xe.length-Ae],te.push({command:Kr.addImport,args:[be[Te],Ee]}),xe.splice(xe.length-Ae,0,Te));for(const Re of se){const Ne=_e[Re.id];Ne&&!i.bn(Ne,Re)&&te.push({command:Kr.updateImport,args:[Re.id,Re]})}}(S.imports,R.imports,D),i.bn(S.transition,R.transition)||D.push({command:Kr.setTransition,args:[R.transition]}),i.bn(S.light,R.light)||D.push({command:Kr.setLight,args:[R.light]}),i.bn(S.fog,R.fog)||D.push({command:Kr.setFog,args:[R.fog]}),i.bn(S.snow,R.snow)||D.push({command:Kr.setSnow,args:[R.snow]}),i.bn(S.rain,R.rain)||D.push({command:Kr.setRain,args:[R.rain]}),i.bn(S.projection,R.projection)||D.push({command:Kr.setProjection,args:[R.projection]}),i.bn(S.lights,R.lights)||D.push({command:Kr.setLights,args:[R.lights]}),i.bn(S.camera,R.camera)||D.push({command:Kr.setCamera,args:[R.camera]}),!i.bn(S["color-theme"],R["color-theme"]))return[{command:Kr.setStyle,args:[R]}];const N={},z=[];(function(X,se,te,ae){let ce;for(ce in se=se||{},X=X||{})X.hasOwnProperty(ce)&&(se.hasOwnProperty(ce)||Hh(ce,te,ae));for(ce in se){if(!se.hasOwnProperty(ce))continue;const _e=se[ce];X.hasOwnProperty(ce)?i.bn(X[ce],_e)||(X[ce].type==="geojson"&&_e.type==="geojson"&&Kt(X,se,ce)?te.push({command:Kr.setGeoJSONSourceData,args:[ce,_e.data]}):Tc(ce,se,te,ae)):fo(ce,se,te)}})(S.sources,R.sources,z,N);const B=[];S.layers&&S.layers.forEach(X=>{X.source&&N[X.source]?D.push({command:Kr.removeLayer,args:[X.id]}):B.push(X)});let V=S.terrain;V&&N[V.source]&&(D.push({command:Kr.setTerrain,args:[void 0]}),V=void 0),D=D.concat(z),i.bn(V,R.terrain)||D.push({command:Kr.setTerrain,args:[R.terrain]}),function(X,se,te){se=se||[];const ae=(X=X||[]).map(Wr),ce=se.map(Wr),_e=X.reduce(es,{}),be=se.reduce(es,{}),xe=ae.slice(),Ae=Object.create(null);let Se,Te,Ee,Re,Ne,nt,We;for(Se=0,Te=0;Se<ae.length;Se++)Ee=ae[Se],be.hasOwnProperty(Ee)?Te++:(te.push({command:Kr.removeLayer,args:[Ee]}),xe.splice(xe.indexOf(Ee,Te),1));for(Se=0,Te=0;Se<ce.length;Se++)Ee=ce[ce.length-1-Se],xe[xe.length-1-Se]!==Ee&&(_e.hasOwnProperty(Ee)?(te.push({command:Kr.removeLayer,args:[Ee]}),xe.splice(xe.lastIndexOf(Ee,xe.length-Te),1)):Te++,nt=xe[xe.length-Se],te.push({command:Kr.addLayer,args:[be[Ee],nt]}),xe.splice(xe.length-Se,0,Ee),Ae[Ee]=!0);for(Se=0;Se<ce.length;Se++)if(Ee=ce[Se],Re=_e[Ee],Ne=be[Ee],!Ae[Ee]&&!i.bn(Re,Ne))if(i.bn(Re.source,Ne.source)&&i.bn(Re["source-layer"],Ne["source-layer"])&&i.bn(Re.type,Ne.type)){for(We in nn(Re.layout,Ne.layout,te,Ee,null,Kr.setLayoutProperty),nn(Re.paint,Ne.paint,te,Ee,null,Kr.setPaintProperty),i.bn(Re.slot,Ne.slot)||te.push({command:Kr.setSlot,args:[Ee,Ne.slot]}),i.bn(Re.filter,Ne.filter)||te.push({command:Kr.setFilter,args:[Ee,Ne.filter]}),i.bn(Re.minzoom,Ne.minzoom)&&i.bn(Re.maxzoom,Ne.maxzoom)||te.push({command:Kr.setLayerZoomRange,args:[Ee,Ne.minzoom,Ne.maxzoom]}),Re)Re.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?nn(Re[We],Ne[We],te,Ee,We.slice(6),Kr.setPaintProperty):i.bn(Re[We],Ne[We])||te.push({command:Kr.setLayerProperty,args:[Ee,We,Ne[We]]}));for(We in Ne)Ne.hasOwnProperty(We)&&!Re.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?nn(Re[We],Ne[We],te,Ee,We.slice(6),Kr.setPaintProperty):i.bn(Re[We],Ne[We])||te.push({command:Kr.setLayerProperty,args:[Ee,We,Ne[We]]}))}else te.push({command:Kr.removeLayer,args:[Ee]}),nt=xe[xe.lastIndexOf(Ee)+1],te.push({command:Kr.addLayer,args:[Ne,nt]})}(B,R.layers,D)}catch(N){console.warn("Unable to compute style diff:",N),D=[{command:Kr.setStyle,args:[R]}]}return D}(this.serialize(),r).filter(S=>!(S.command in zb));if(f.length===0)return!1;const _=f.filter(S=>!(S.command in Ob));if(_.length>0)throw new Error(`Unimplemented: ${_.map(S=>S.command).join(", ")}.`);const v=[];return f.forEach(S=>{v.push(this[S.command].apply(this,S.args))}),a&&Promise.all(v).then(a),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(r){for(const[a,f]of r.entries()){if(this.getImage(a)&&!a.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,f),this._changes.updateImage(a)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(r,a){return this.getImage(r)&&!r.iconsetId?this.fire(new i.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,a),this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(r,a,f=!1){this.imageManager.updateImage(r,this.scope,a),f&&(this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,a,f={}){return this._checkLoaded(),this._validate(Pe,`models.${r}`,a,null,f)||(this.modelManager.addModel(r,a,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,a,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(_i,`sources.${r}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=Gh(r,a,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const v=S=>{const R=(S?"symbol:":"other:")+_.id,D=i.C(R,this.scope),N=this._sourceCaches[R]=new ho(D,_,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=N,N.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const a=this.getOwnSource(r);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(r);for(const _ of f){const v=i.cr(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,a){this._checkLoaded(),this.getOwnSource(r).setData(a),this._changes.setDirty()}getOwnSource(r){const a=this.getOwnSourceCache(r);return a&&a.getSource()}getOwnSources(){const r=[];for(const a in this._otherSourceCaches){const f=this.getOwnSourceCache(a);f&&r.push(f.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const a in r){const f=r[a]._tiles;for(const _ in f){const v=f[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const _ of r){if(this._validate(Mo,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(_),v.updateTransitions(a)}else this.ambientLight=new Zn(_,Lr||(Lr=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(_),v.updateTransitions(a)}else this.directionalLight=new Zn(_,sn||(sn=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=new i.aa(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,a=this.ambientLight;if(!r||!a)return;const f=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),_=r.properties.get("color").toRenderColor(null).toArray01(),v=r.properties.get("intensity"),S=r.properties.get("direction"),R=1-i.cc(S.x,S.y,S.z)[2]/90,D=f(_)*v*R,N=a.properties.get("color").toRenderColor(null).toArray01(),z=a.properties.get("intensity"),B=f(N)*z;return Number(((D+B)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(i.cs(r)){const a=i.ct(r),f=this.fragments.find(({id:v})=>v===a);if(!f)throw new Error(`Style import '${r}' not found`);const _=i.cr(r);return f.style.getFragmentStyle(_)}{const a=this.fragments.find(({id:f})=>f===r);return a?a.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const a={},f=(_,v="")=>`${_}::${v}`;this._featuresetSelectors={};for(const _ in r){const v=this._featuresetSelectors[_]=[];for(const S of r[_].selectors){if(S.featureNamespace){const D=this.getOwnLayer(S.layer);if(!D){i.w(`Layer is undefined for selector: ${S.layer}`);continue}const N=f(D.source,D.sourceLayer);if(N in a&&a[N]!==S.featureNamespace){i.w(`"featureNamespace ${S.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}a[N]=S.featureNamespace}let R;if(S.properties)for(const D in S.properties){const N=i.X(S.properties[D]);N.result==="success"&&(R=R||{},R[D]=N.value)}v.push({layerId:S.layer,namespace:S.featureNamespace,properties:R,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const a=this.getFragmentStyle(r);if(!a||!a.stylesheet.featuresets)return[];const f=[];for(const _ in a.stylesheet.featuresets)f.push({featuresetId:_,importId:a.scope?a.scope:void 0});return f}getFeaturesetLayers(r,a){const f=this.getFragmentStyle(a),_=f.stylesheet.featuresets;if(!_||!_[r])return this.fire(new i.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const S of _[r].selectors){const R=f.getOwnLayer(S.layer);R&&v.push(R)}return v}getConfigProperty(r,a){const f=this.getFragmentStyle(r);if(!f)return null;const _=i.C(a,f.scope),v=f.options.get(_),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(r,a,f){const _=this.getFragmentStyle(r);if(!_)return;const v=_.stylesheet.indoor?tv(_.stylesheet.schema):_.stylesheet.schema;if(!v||!v[a])return;const S=i.X(f);if(S.result!=="success")return void $l(this,S.value);const R=S.value.expression,D=i.C(a,_.scope),N=_.options.get(D);if(!N)return;let z;const{minValue:B,maxValue:V,stepValue:X,type:se,values:te}=v[a],ae=i.X(v[a].default);ae.result==="success"&&(z=ae.value.expression),z?(this.options.set(D,Object.assign({},N,{value:R,default:z,minValue:B,maxValue:V,stepValue:X,type:se,values:te})),this.updateConfigDependencies(a)):this.fire(new i.z(new Error(`No schema defined for the config option "${a}" in the "${r}" fragment.`)))}getConfig(r){const a=this.getFragmentStyle(r);if(!a)return null;const f=a.stylesheet.schema;if(!f)return null;const _={};for(const v in f){const S=i.C(v,a.scope),R=a.options.get(S),D=R?R.value||R.default:null;_[v]=D?D.serialize():null}return _}setConfig(r,a){const f=this.getFragmentStyle(r);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const a=this.getFragmentStyle(r);return a?a.stylesheet.schema:null}setSchema(r,a){const f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(r,a){if(this._config=r,r||a)if(a)for(const f in a){let _,v;const S=i.X(a[f].default);if(S.result==="success"&&(_=S.value.expression),r&&r[f]!==void 0){const V=i.X(r[f]);V.result==="success"&&(v=V.value.expression)}const{minValue:R,maxValue:D,stepValue:N,type:z,values:B}=a[f];if(_){const V=i.C(f,this.scope);this.options.set(V,{default:_,value:v,minValue:R,maxValue:D,stepValue:N,type:z,values:B})}else this.fire(new i.z(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const a of this._configDependentLayers){const f=this.getLayer(a);if(f){if(r&&!f.configDependencies.has(r))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const f=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(f){const _=a._evaluateColorThemeData(f);(!a._styleColorTheme.lut&&_!==""||a._styleColorTheme.lut&&_!==a._styleColorTheme.lut.data)&&a.setColorTheme(f)}}),this._changes.setDirty()}addLayer(r,a,f={}){this._checkLoaded();const _=r.id;if(this._layers[_])return void this.fire(new i.z(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(r.type==="custom"){if($l(this,i.cu(r)))return;v=i.cv(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=i.cq(r),r=i.l(r,{source:_})),this._validate(le,`layers.${_}`,r,{arrayIndex:-1},f))return;v=i.cv(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(a){const z=this._order.indexOf(a);if(z===-1)return void this.fire(new i.z(new Error(`Layer with id "${a}" does not exist on this map.`)));v.slot===this._layers[a].slot?S=z:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const R=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&v.canCastShadows()&&D&&(R.castsShadows=!0);const N=this._changes.getRemovedLayer(v);if(N&&v.source&&R&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const z=i.C(v.source,v.scope);N.type!==v.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),R.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,a){this._checkLoaded();const f=this._checkLayer(r);if(!f||r===a)return;const _=this._order.indexOf(r);this._order.splice(_,1);let v=this._order.length;if(a){const S=this._order.indexOf(a);if(S===-1)return void this.fire(new i.z(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?v=S:i.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const a=this._checkLayer(r);if(!a)return;a.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const _=this.getOwnLayerSourceCache(a);if(_&&_.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===a.source&&this._layers[S].canCastShadows()){v=!0;break}_.castsShadows=v}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const a in this._layers)if(this._layers[a].type===r)return!0;return!1}setLayerZoomRange(r,a,f){this._checkLoaded();const _=this._checkLayer(r);_&&(_.minzoom===a&&_.maxzoom===f||(a!=null&&(_.minzoom=a),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,a){this._checkLoaded();const f=this._checkLayer(r);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(r,a,f={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!i.bn(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(de,`layers.${_.id}.filter`,a,{layerType:_.type},f)||(_.filter=i.cq(a),this._updateLayer(_)))}getFilter(r){const a=this._checkLayer(r);if(a)return i.cq(a.filter)}setLayoutProperty(r,a,f,_={}){this._checkLoaded();const v=this._checkLayer(r);if(v&&!i.bn(v.getLayoutProperty(a),f)){if(f!=null&&(!_||_.validate!==!1)&&$l(v,De.call(jn,{key:`layers.${r}.layout.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(a,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,a){const f=this._checkLayer(r);if(f)return f.getLayoutProperty(a)}setPaintProperty(r,a,f,_={}){this._checkLoaded();const v=this._checkLayer(r);if(!v||i.bn(v.getPaintProperty(a),f)||f!=null&&(!_||_.validate!==!1)&&$l(v,we.call(jn,{key:`layers.${r}.paint.${a}`,layerType:v.type,objectKey:a,value:f,styleSpec:i.a5})))return;const S=v.setPaintProperty(a,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,a){const f=this._checkLayer(r);if(f)return f.getPaintProperty(a)}setFeatureState(r,a){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:D,importId:N}=r.target,z=this.getFragmentStyle(N),B=z.getFeaturesetLayers(D);for(const{source:V,sourceLayer:X}of B)z.setFeatureState({id:r.id,source:V,sourceLayer:X},a)}else if("layerId"in r.target){const{layerId:D}=r.target,N=this.getLayer(D);this.setFeatureState({id:r.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const f=r.source,_=r.sourceLayer,v=this._checkSource(f);if(!v)return;const S=v.type;if(S==="geojson"&&_)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!_)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(f);for(const D of R)D.setFeatureState(_,r.id,a)}removeFeatureState(r,a){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:D,importId:N}=r.target,z=this.getFragmentStyle(N),B=z.getFeaturesetLayers(D);for(const{source:V,sourceLayer:X}of B)z.removeFeatureState({id:r.id,source:V,sourceLayer:X},a)}else if("layerId"in r.target){const{layerId:D}=r.target,N=this.getLayer(D);this.removeFeatureState({id:r.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const f=r.source,_=this._checkSource(f);if(!_)return;const v=_.type,S=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(f);for(const D of R)D.removeFeatureState(S,r.id,a)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let v;if("featuresetId"in r.target){const{featuresetId:S,importId:R}=r.target,D=this.getFragmentStyle(R),N=D.getFeaturesetLayers(S);for(const{source:z,sourceLayer:B}of N){const V=D.getFeatureState({id:r.id,source:z,sourceLayer:B});if(V&&!v)v=V;else if(!i.bn(v,V))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:S}=r.target,R=this.getLayer(S);v=this.getFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer})}return v}const a=r.source,f=r.sourceLayer,_=this._checkSource(a);if(_){if(_.type!=="vector"||f)return r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,r.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.l({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),a=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(r){for(const a of Object.values(this._mergedLayers))r(a)&&this._updateLayer(a)}_updateLayer(r){this._changes.updateLayer(r);const a=this.getLayerSourceCache(r),f=i.C(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const a=R=>this._mergedLayers[R].is3D(!!this.terrain),f=this.order,_={},v=[];for(let R=f.length-1;R>=0;R--){const D=f[R];if(a(D)){_[D]=R;for(const N of r){const z=N[D];if(z)for(const B of z)v.push(B)}}}v.sort((R,D)=>D.intersectionZ-R.intersectionZ);const S=[];for(let R=f.length-1;R>=0;R--){const D=f[R];if(a(D))for(let N=v.length-1;N>=0;N--){const z=v[N].feature;if(z.layer&&_[z.layer.id]<R)break;S.push(z),v.pop()}else for(const N of r){const z=N[D];if(z)for(const B of z)S.push(B.feature)}}return S}queryRenderedFeatures(r,a,f){let _;a&&!Array.isArray(a)&&a.filter&&(this._validate(de,"queryRenderedFeatures.filter",a.filter,null,a),_=i.a_(a.filter));const v={},S=z=>{if(ef.has(z.type))return;const B=this.getOwnLayerSourceCache(z),V=v[B.id]=v[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[z.fqid]=V.layers[z.fqid]||{styleLayer:z,targets:[]},V.layers[z.fqid].targets.push({filter:_})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const z of a.layers){const B=this._layers[z];if(!B)return this.fire(new i.z(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];S(B)}}else for(const z in this._layers)S(this._layers[z]);const R=this._queryRenderedFeatures(r,v,f),D=this._flattenAndSortRenderedFeatures(R),N=[];for(const z of D)i.ct(z.layer.id)===this.scope&&N.push(z);return N}queryRenderedFeatureset(r,a,f){let _;a&&!Array.isArray(a)&&a.filter&&(this._validate(de,"queryRenderedFeatures.filter",a.filter,null,a),_=i.a_(a.filter));const v="mock",S=[];if(a&&a.target)S.push(Object.assign({},a,{targetId:v,filter:_}));else{const z=this.getFeaturesetDescriptors();for(const B of z)S.push({targetId:v,filter:_,target:B});for(const{style:B}of this.fragments){const V=B.getFeaturesetDescriptors();for(const X of V)S.push({targetId:v,filter:_,target:X})}}const R=this.queryRenderedTargets(r,S,f),D=[],N=new Set;for(const z of R)for(const B of z.variants[v])bc(B,z,N)||D.push(new i.cx(z,B));return D}queryRenderedTargets(r,a,f){const _={},v=(R,D,N,z)=>{const B=_[D.id]=_[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(B.layers[R.fqid]=B.layers[R.fqid]||{styleLayer:R,targets:[]},R.is3D(!!this.terrain)&&(B.has3DLayers=!0),!z)return N.uniqueFeatureID=!1,void B.layers[R.fqid].targets.push(N);B.layers[R.fqid].targets.push(Object.assign({},N,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const R of a)if("featuresetId"in R.target){const{featuresetId:D,importId:N}=R.target,z=this.getFragmentStyle(N);if(!z||!z._featuresetSelectors)continue;const B=z._featuresetSelectors[D];if(!B){this.fire(new i.z(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of B){const X=z.getOwnLayer(V.layerId);X&&!ef.has(X.type)&&v(X,z.getOwnLayerSourceCache(X),R,V)}}else if("layerId"in R.target){const{layerId:D}=R.target,N=this.getLayer(D);if(!N||ef.has(N.type))continue;v(N,this.getLayerSourceCache(N),R)}const S=this._queryRenderedFeatures(r,_,f);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(r,a,f){const _=[],v=!!this.map._showQueryGeometry,S=Ii.createFromScreenPoints(r,f);for(const R in a){const D=ym(S,a[R],this._availableImages,f,v);Object.keys(D).length&&_.push(D)}if(this.placement)for(const R in a){if(!a[R].sourceCache._onlySymbols)continue;const D=Wy(S.screenGeometry,a[R],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(D).length&&_.push(D)}return _}querySourceFeatures(r,a){const f=a&&a.filter;f&&this._validate(de,"querySourceFeatures.filter",f,null,a);let _=[];const v=this.getOwnSourceCaches(r);for(const S of v)_=_.concat(Zy(S,a));return _}addSourceType(r,a,f){return Do.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(Do.setSourceType(r,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,a,f={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const R in r)if(!i.bn(r[R],_[R])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(r,a,f),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,a=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r;const _=r.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const R="terrain-dem-src";this.addSource(R,f.source),f=i.cq(f),f=i.l(f,{source:R})}const v=i.l({},f),S={};if(this.terrain&&_){v.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(S.style=R.serialize())}if(this._validate(vc,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new i.A("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const R of Object.keys(i.a5.terrain))!f.hasOwnProperty(R)&&i.a5.terrain[R].default&&(f[R]=i.a5.terrain[R].default);for(const R in r)if(!i.bn(r[R],S[R])){v.set(r,this.options),this.stylesheet.terrain=r;const D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const a=this.fog=new Ir(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createSnow(r){const a=this.snow=new on(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createRain(r){const a=this.rain=new un(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!i.bn(a.get(),r)){a.set(r,this.options),this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!i.bn(a.get(),r)){a.set(r,this.options),this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!i.bn(a.get(),r)){a.set(r,this.options),this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void r();const f=this._evaluateColorThemeData(a);this._loadColorTheme(f).then(()=>{this.fire(new i.A("colorthemeset")),r()}).catch(_=>{i.w(`Couldn't set color theme: ${_}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,a){const f=this.getFragmentStyle(r);f&&(f._styleColorTheme.colorThemeOverride=a,f._reloadColorTheme())}_getTransitionParameters(r){return{now:i.q.now(),transition:i.l(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],a=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?r.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...a)}_createTerrain(r,a){const f=this.terrain=new ut(r,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const a=this._layers[r];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const a=this._layers[r];a.type==="symbol"&&this._updateLayer(a)}}_validate(r,a,f,_,v={}){if(v&&v.validate===!1)return!1;const S=i.l({},this.serialize());return $l(this,r.call(jn,i.l({key:a,style:S,value:f,styleSpec:i.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const a=this.getSourceCaches(r);for(const f of a)f.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const a=this.getSourceCaches(r);for(const f of a)f.resume(),f.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let a;this.directionalLight&&(a=cl(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(r,void 0,void 0,a)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const a=this._sourceCaches[r];a.resume(),a.reload()}}_updatePlacement(r,a,f,_,v,S,R=!1){let D=!1,N=!1;const z={},B={};for(const V of this._mergedOrder){const X=this._mergedLayers[V];if(X.type!=="symbol")continue;const se=i.C(X.source,X.scope);let te=z[se];if(!te){const ce=this.getLayerSourceCache(X);if(!ce)continue;const _e=ce.getRenderableIds(!0).map(be=>ce.getTileByID(be));B[se]=_e.slice(),te=z[se]=_e.sort((be,xe)=>xe.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(xe.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(X,te,a.center.lng,a.projection);D=D||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),a.zoom))&&(this.pauseablePlacement=new al(a,this._mergedOrder,R,f,_,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,B,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),N=!0),D&&this.pauseablePlacement.placement.setStale()),N||D){this._buildingIndex.onNewFrame(a.zoom);for(let V=0;V<this._mergedOrder.length;V++){const X=this._mergedLayers[this._mergedOrder[V]];if(X.type!=="symbol")continue;const se=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,z[i.C(X.source,X.scope)],V,se?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,a){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===r.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!a)return f.push(r),this._loadImports([r],!0);const _=f.findIndex(({id:v})=>v===a);return _===-1&&this.fire(new i.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(r).concat(f.slice(_)),this._loadImports([r],!0,a)}updateImport(r,a){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof a=="string"?(this.setImportUrl(r,a),this):(a.url&&a.url!==f[_].url&&this.setImportUrl(r,a.url),i.bn(a.config,f[_].config)||this.setImportConfig(r,a.config,a.data.schema),i.bn(a.data,f[_].data)||this.setImportData(r,a.data),this)}moveImport(r,a){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(r);if(_===-1)return this;const v=this.getImportIndex(a);if(v===-1)return this;const S=f[_],R=this.fragments[_];return f=f.filter(({id:D})=>D!==r),this.fragments=this.fragments.filter(({id:D})=>D!==r),this.stylesheet.imports=f.slice(0,v).concat(S).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(R).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,a){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;f[_].url=a;const v=this.fragments[_];return v.style=this._createFragmentStyle(f[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(a),this}setImportData(r,a){this._checkLoaded();const f=this.getImportIndex(r),_=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(r,_[f].url))}setImportConfig(r,a,f){this._checkLoaded();const _=this.getImportIndex(r),v=this.stylesheet.imports||[];if(_===-1)return this;a?v[_].config=a:delete v[_].config;const S=this.fragments[_];f&&S.style.stylesheet&&(S.style.stylesheet.schema=f);const R=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=a,S.style.updateConfig(a,R),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const a=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){const a=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return a===-1&&this.fire(new i.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),a}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const a in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[a];f&&r.push(f.getSource())}return r}getSource(r,a){const f=this.getSourceCache(r,a);return f&&f.getSource()}getLayerSource(r){const a=this.getLayerSourceCache(r);return a&&a.getSource()}getSourceCache(r,a){const f=i.C(r,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){const a=i.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[r]&&a.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&a.push(this._mergedSymbolSourceCaches[r]),a}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const a in r){const f=r[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(r){const a=this._changes.getUpdatedPaintProperties();for(const f of a){const _=this.getLayer(f);_&&_.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r,this.scope)}getImages(r,a,f){this.imageManager.getImages(a.images,a.scope,f),this._updateTilesForChangedImages();const _=S=>{if(S){const R=a.images.map(D=>i.I.toString(D));S.setDependencies(a.tileID.key,a.type,R)}},v=i.C(a.source,a.scope);_(this._mergedOtherSourceCaches[v]),_(this._mergedSymbolSourceCaches[v])}rasterizeImages(r,a,f){this.imageManager.rasterizeImages(a,f)}getGlyphs(r,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(r,a,f){return i.cz(a,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const a=[];return this._otherSourceCaches[r]&&a.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&a.push(this._symbolSourceCaches[r]),a}_isSourceCacheLoaded(r){const a=this.getOwnSourceCaches(r);return a.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${r}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,a){if(!this._clipLayerPresent&&r.type!=="fill-extrusion")return!1;const f=r.type==="fill-extrusion"&&r.sourceLayer==="building";if(r.is3D(!!this.terrain)){if(f||a&&a.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Do.getSourceType=function(p){return _m[p]},Do.setSourceType=function(p,r){_m[p]=r},Do.registerForPluginStateChange=i.ci;var Im=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,tf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,wd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,rf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ul=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,nf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Gl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Sd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Td=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ea=[];ea(Im,Ea),ea(wd,Ea),ea(tf,Ea);const ql={"_prelude_fog.vertex.glsl":nf,"_prelude_terrain.vertex.glsl":ul,"_prelude_shadow.vertex.glsl":Sd,"_prelude_fog.fragment.glsl":Pm,"_prelude_shadow.fragment.glsl":Td,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Gl,"_prelude_raster_particle.glsl":Nc},Oc={};Ur("",ul),Ur(Pm,nf),Ur(Td,Sd),Ur(Gl,""),Ur(Nc,"");const Rm=Ur(tf,wd),sf=Im;var Ed={background:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ur("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ur(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ur("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ur("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ur(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ur(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ur(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ur(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ur(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ur("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ur("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ur(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ur(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ur("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ur(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rf),skyboxGradient:Ur(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rf),skyboxCapture:Ur(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ur(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ur(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ur("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ur("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ur("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ur("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ea(p,r){const a=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const v of _)r.includes(v)||r.push(v)}}function Ur(p,r){const a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(N=>{const z=N.split(" ");return z[z.length-1]}),_=[...new Set(_)]);const v={},S=[],R=[];if(p=p.replace(a,(N,z)=>(R.push(z),"")),(r=r.replace(a,(N,z)=>(S.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Ea];ea(p,D),ea(r,D);for(const N of[...S,...R])ql[N]||console.error(`Undefined include: ${N}`),Oc[N]||(Oc[N]=[],ea(ql[N],Oc[N])),D=[...D,...Oc[N]];return{fragmentSource:p=p.replace(f,(N,z,B,V,X)=>(v[X]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${B} ${V} ${X};
#else
uniform ${B} ${V} u_${X};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${B} ${V} ${X} = u_${X};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${B} ${V} ${X};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(N,z,B,V,X)=>{const se=V==="float"?"vec2":V,te=X.match(/color/)?"color":se;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${B} ${V} a_${X};
#endif
`:v[X]?z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${B} ${se} a_${X};
out ${B} ${V} ${X};
#else
uniform ${B} ${V} u_${X};
#endif
`:z==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${B} ${V} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${te}(a_${X}, u_${X}_t);
#else
    ${B} ${V} ${X} = u_${X};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${B} ${V} a_${X};
    out ${B} ${V} ${X};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${B} ${se} a_${X};
#else
uniform ${B} ${V} u_${X};
#endif
`:z==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${B} ${V} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${se} a_${X};
#else
uniform ${B} ${V} u_${X};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${B} ${V} ${X} = a_${X};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${B} ${V} ${X} = a_${X};
#else
    ${B} ${V} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${B} ${V} ${X} = unpack_mix_${te}(a_${X}, u_${X}_t);
#else
    ${B} ${V} ${X} = u_${X};
#endif
`}),staticAttributes:_,usedDefines:D,vertexIncludes:S,fragmentIncludes:R}}class sv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,a,f,_,v,S,R,D){this.context=r;let N=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!N&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(N=!0);let z=this.boundDynamicVertexBuffers.length!==R.length;for(let B=0;!z&&B<R.length;B++)this.boundDynamicVertexBuffers[B]!==R[B]&&(z=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||N||z||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(a,f,_,v,S,R,D);else{r.bindVertexArrayOES.set(this.vao);for(const B of R)B&&(B.bind(),D&&B.instanceCount&&B.setVertexAttribDivisor(r.gl,a,D));v&&v.dynamicDraw&&v.bind()}}freshBind(r,a,f,_,v,S,R){const D=r.numAttributes,N=this.context,z=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,a.enableAttributes(z,r),a.bind(),a.setVertexAttribPointers(z,r,v);for(const B of f)B.enableAttributes(z,r),B.bind(),B.setVertexAttribPointers(z,r,v);for(const B of S)B&&(B.enableAttributes(z,r),B.bind(),B.setVertexAttribPointers(z,r,v),R&&B.instanceCount&&B.setVertexAttribDivisor(z,r,R));_&&_.bind(),N.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ov(p,r){const a=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new i.ac(0,f/a).toLngLat().lat,new i.ac(0,(f+1)/a).toLngLat().lat]}function zc(p,r,a,f,_,v,S){const R=p.context,D=R.gl,N=a.hillshadeFBO;if(!N)return;p.prepareDrawTile();const z=p.isTileAffectedByFog(r),B=p.getOrCreateProgram("hillshade",{overrideFog:z});R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,N.colorAttachment.get());const V=((ae,ce,_e,be)=>{const xe=_e.paint.get("hillshade-shadow-color"),Ae=_e.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=_e.paint.get("hillshade-highlight-color"),Te=_e.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ee=_e.paint.get("hillshade-accent-color"),Re=_e.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ne=_e.paint.get("hillshade-emissive-strength");let nt=i.ak(_e.paint.get("hillshade-illumination-direction"));if(_e.paint.get("hillshade-illumination-anchor")==="viewport")nt-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const pt=ae.style.directionalLight.properties.get("direction"),gt=i.cc(pt.x,pt.y,pt.z);nt=i.ak(gt[1])}const We=!ae.options.moving;return{u_matrix:be||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),We),u_image:0,u_latrange:ov(0,ce.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),nt],u_shadow:xe.toRenderColor(Ae?null:_e.lut),u_highlight:Se.toRenderColor(Te?null:_e.lut),u_emissive_strength:Ne,u_accent:Ee.toRenderColor(Re?null:_e.lut)}})(p,a,f,p.terrain?r.projMatrix:null);p.uploadCommonUniforms(R,B,r.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:se,tileBoundsSegments:te}=p.getTileBoundsBuffers(a);B.draw(p,D.TRIANGLES,_,v,S,mr.disabled,V,f.id,X,se,te)}function km(p,r,a){if(!r.needsDEMTextureUpload)return;const f=p.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(a.stride);const v=a.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new i.T(f,v,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function jb(p,r,a){const f=p.context,_=f.gl;if(!r.dem)return;const v=r.dem;if(f.activeTexture.set(_.TEXTURE1),km(p,r,v),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const S=v.dim;f.activeTexture.set(_.TEXTURE0);let R=r.hillshadeFBO;if(!R){const V=new i.T(f,{width:S,height:S,data:null},_.RGBA8);V.bind(_.LINEAR,_.CLAMP_TO_EDGE),R=r.hillshadeFBO=f.createFramebuffer(S,S,!0,"renderbuffer"),R.colorAttachment.set(V.texture)}f.bindFramebuffer.set(R.framebuffer),f.viewport.set([0,0,S,S]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:N,tileBoundsSegments:z}=p.getMercatorTileBoundsBuffers(),B=[];p.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(p,_.TRIANGLES,Jt.disabled,vr.disabled,kr.unblended,mr.disabled,((V,X)=>{const se=X.stride,te=i.ad.mat4.create();return i.ad.mat4.ortho(te,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(te,te,[0,-i.ai,0]),{u_matrix:te,u_image:1,u_dimension:[se,se],u_zoom:V.overscaledZ}})(r.tileID,v),a.id,D,N,z),r.needsHillshadePrepare=!1}class Pn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fb extends Pn{getDefault(){return i.al.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Dm extends Pn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Lm extends Pn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Nm extends Pn{getDefault(){return[!0,!0,!0,!0]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Om extends Pn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class av extends Pn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class lv extends Pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const a=this.current;(r.func!==a.func||r.ref!==a.ref||r.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Bb extends Pn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Cd extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ad extends Pn{getDefault(){return[0,1]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class cv extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ws extends Pn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class zm extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.BLEND):a.disable(a.BLEND),this.current=r,this.dirty=!1}}class of extends Pn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class af extends Pn{getDefault(){return i.al.transparent}set(r){const a=this.current;(r.r!==a.r||r.g!==a.g||r.b!==a.b||r.a!==a.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class jm extends Pn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Fm extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;r?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=r,this.dirty=!1}}class Bm extends Pn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class lf extends Pn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Um=class extends Pn{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Vm extends Pn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class cf extends Pn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const a=this.current;(r[0]!==a[0]||r[1]!==a[1]||r[2]!==a[2]||r[3]!==a[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class uv extends Pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class dv extends Pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class jc extends Pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ub extends Pn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Vb extends Pn{getDefault(){return null}set(r){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class $b extends Pn{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Gb extends Pn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class qb extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Hb extends Pn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Md extends Pn{constructor(r,a){super(r),this.context=r,this.parent=a}getDefault(){return null}}class $m extends Md{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Gm extends Md{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Fc extends Md{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class hv extends Gm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const fv=(p,r,a)=>({u_matrix:p,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:a}),qm=(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:R,u_frustum_br:D,u_frustum_bl:N,u_globe_pos:z,u_globe_radius:B,u_viewport:V,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:se});function uf(p,r){return p!=null&&r!=null&&!(!p.hasData()||!r.hasData())&&p.demTexture!=null&&r.demTexture!=null&&p.tileID.key!==r.tileID.key}const po=new class{constructor(){this.operations={}}newMorphing(p,r,a,f,_){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[p]={startTime:f,phase:0,duration:_,from:r,to:a,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const a=this.operations[r];for(a.phase=(p-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Hm={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ca(p,r,a){if(r===0)return 0;const f=r<1&&a===514?.25/r:1;return 6*Math.pow(1.5,22-p)*Math.max(r,1)*f}function Wm(p,r){const a=1<<p.z;return!r&&(p.x===0||p.x===a-1)||p.y===0||p.y===a-1}const Bc=p=>({u_matrix:p});function df(p,r,a,f,_){if(_>0){const v=i.q.now(),S=(v-p.timeAdded)/_,R=r?(v-r.timeAdded)/_:-1,D=a.getSource(),N=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),z=!r||Math.abs(r.tileID.overscaledZ-N)>Math.abs(p.tileID.overscaledZ-N),B=z&&p.refreshedUponExpiration?1:i.ay(z?S:1-R,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class pv extends ho{constructor(r){const a={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new i.D(i.cj(),null),_=Gh("mock-dem",a,f,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,a){r.state="loaded",a(null)}}class Zm extends ho{constructor(r){const a=Gh("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.D(i.cj(),null),r.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,a,f){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const R=new Po(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom);R.state="loaded",this._tiles[S.key]=R}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const a=this.proxyCachedFBO[r];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hf extends i.aH{constructor(r,a,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class mv extends i.cK{constructor(r,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,v]=function(D){const N=new i.b5,z=new i.aV,B=131;N.reserve(17161),z.reserve(33800);const V=i.ai/128,X=i.ai+V/2,se=X+V;for(let ae=-V;ae<se;ae+=V)for(let ce=-V;ce<se;ce+=V){const _e=ce<0||ce>X||ae<0||ae>X?24575:0,be=i.ay(Math.round(ce),0,i.ai),xe=i.ay(Math.round(ae),0,i.ai);N.emplaceBack(be+_e,xe)}const te=(ae,ce)=>{const _e=ce*B+ae;z.emplaceBack(_e+1,_e,_e+B),z.emplaceBack(_e+B,_e+B+1,_e+1)};for(let ae=1;ae<129;ae++)for(let ce=1;ce<129;ce++)te(ce,ae);return[0,129].forEach(ae=>{for(let ce=0;ce<130;ce++)te(ce,ae),te(ae,ce)}),[N,z,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(f,i.b7.members),this.gridIndexBuffer=S.createIndexBuffer(_),this.gridSegments=i.b8.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Zm(a.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const R=S.gl;this._overlapStencilMode=new vr({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pv(a.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,a,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const _=r.terrain.properties,v=r.terrain.drapeRenderMode===0,S=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const R=r.terrain&&r.terrain.scope,D=_.get("source"),N=v?this._mockSourceCache:r.getSourceCache(D,R);if(!N)return void i.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=N,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(a):_.get("exaggeration"),!a.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(a,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const a=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;const _=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const v=r.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let R=v-this._previousZoom;const D=this._previousUpdateTimestamp;let N=v;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(v-N)>.5&&(R=.5*(v-N+R)),R*_<0&&(N+=R)),this._evaluationZoom=N;const z=S.getExaggeration(N),B=z===S.getExaggeration(Math.max(0,N-.1));if(B&&Math.abs(z-this._exaggeration)<.01)return z;let V=Math.min(.1,.00375*(this._updateTimestamp-D));return(B||z<.1||Math.abs(R)<1e-4)&&(V=Math.min(.2,4*V)),i.ah(this._exaggeration,z,V)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(D=>{const N=a.getTileByID(D).tileID;return N.projMatrix=f.calculateProjMatrix(N.toUnwrapped()),N});(function(D,N){const z=N.transform.pointCoordinate(N.transform.getCameraPoint()),B=new i.P(z.x,z.y);D.sort((V,X)=>{if(X.overscaledZ-V.overscaledZ)return X.overscaledZ-V.overscaledZ;const se=new i.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),te=new i.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ae=B.mult(1<<V.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(se)-ae.distSqr(te)})})(_,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const D in S){const N=S[D];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,r[D],v),N.usedForTerrain))continue;const z=r[D];N.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=_.map(D=>new hf(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const N=this.terrainTileForTile[D.key];if(!N)continue;const z=N.tileID.key;z in R||(this._visibleDemTiles.push(N),R[z]=z)}}_assignTerrainTiles(r){this._initializing||r.forEach(a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,a=r.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(a.TEXTURE1),km(this.painter,_,v))}}_prepareDemTileUniforms(r,a,f,_){if(!a||a.demTexture==null)return!1;const v=r.tileID.canonical,S=Math.pow(2,a.tileID.canonical.z-v.z),R=_||"";return f[`u_dem_tl${R}`]=[v.x*S%1,v.y*S%1],f[`u_dem_scale${R}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const a=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const v=_.dem.tree.minimums[0];return v>0&&r++,f+v},0);return r?a/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,a=r.gl;r.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new i.cL({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new i.T(r,_,a.R32F,{premultiply:!1}),v}setupElevationDraw(r,a,f){const _=this.painter.context,v=_.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let R=null,D=null,N=1;if(f&&f.morphing&&this._useVertexMorphing){const X=f.morphing.srcDemTile,se=f.morphing.dstDemTile;N=f.morphing.phase,X&&se&&(this._prepareDemTileUniforms(r,X,S,"_prev")&&(D=X),this._prepareDemTileUniforms(r,se,S)&&(R=se))}const z=X=>X&&X.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let B=null;var V;if(this.enabled?D&&R?(B=R.demTexture,_.activeTexture.set(v.TEXTURE4),D.demTexture.bind(z(D),v.CLAMP_TO_EDGE),S.u_dem_lerp=N):(R=this.terrainTileForTile[r.tileID.key],B=this._prepareDemTileUniforms(r,R,S)?R.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,_.activeTexture.set(v.TEXTURE2),B&&(S.u_dem_size=(V=B).size[0]===1?1:V.size[0]-2,B.bind(z(R),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,S),f&&f.useMeterToDem&&R){const X=(1<<R.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=X}if(f&&f.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(_,S),this.painter.transform.projection.name==="globe"){const X=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(_,X)}}globeUniformValues(r,a,f){const _=r.projection;return{u_tile_tl_up:_.upVector(a,0,0),u_tile_tr_up:_.upVector(a,i.ai,0),u_tile_br_up:_.upVector(a,i.ai,i.ai),u_tile_bl_up:_.upVector(a,0,i.ai),u_tile_up_scale:f?i.cM(1):_.upVectorScale(a,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const a=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,S,R,D){if(_.transform.projection.name==="globe")(function(N,z,B,V,X){const se=N.context,te=se.gl;let ae,ce;const _e=N.transform,be=i.cD(N,se,_e),xe=(pt,gt)=>{if(ce===gt)return;const Ct=[Hm[gt],"PROJECTION_GLOBE_VIEW"];be&&Ct.push("CUSTOM_ANTIALIASING");const Ge=N.isTileAffectedByFog(pt);ae=N.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:Ge}),ce=gt},Ae=N.colorModeForRenderPass(),Se=new Jt(te.LEQUAL,Jt.ReadWrite,N.depthRangeFor3D);po.update(X);const Te=i.cE(_e),Ee=[i.av(_e.center.lng),i.aC(_e.center.lat)],Re=N.globeSharedBuffers,Ne=[_e.width*i.q.devicePixelRatio,_e.height*i.q.devicePixelRatio],nt=Float32Array.from(_e.globeMatrix),We={useDenormalizedUpVectorScale:!0};{const pt=N.transform,gt=Ca(pt.zoom,z.exaggeration(),z.sourceCache._source.tileSize);ce=-1;const Ct=te.TRIANGLES;for(const Ge of V){const ft=B.getTile(Ge),Ve=vr.disabled,ht=z.prevTerrainTileForTile[Ge.key],lt=z.terrainTileForTile[Ge.key];uf(ht,lt)&&po.newMorphing(Ge.key,ht,lt,X,250),se.activeTexture.set(te.TEXTURE0),ft.texture&&ft.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const _t=po.getMorphValuesForProxy(Ge.key),it=_t?1:0;_t&&i.L(We,{morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:i.cC(_t.phase)}});const vt=i.cF(Ge.canonical),Lt=i.cG(vt.getCenter().lat),Nt=i.cH(Ge.canonical,vt,Lt,pt.worldSize/pt._pixelsPerMercatorPixel),Ot=i.bc(i.cI(Ge.canonical)),Zt=qm(pt.expandedFarZProjMatrix,nt,Te,Ot,i.ag(pt.zoom),Ee,pt.frustumCorners.TL,pt.frustumCorners.TR,pt.frustumCorners.BR,pt.frustumCorners.BL,pt.globeCenterInViewSpace,pt.globeRadius,Ne,gt,pt._farZ,Nt);if(xe(Ge,it),ae&&(z.setupElevationDraw(ft,ae,We),N.uploadCommonUniforms(se,ae,Ge.toUnwrapped()),Re)){const[gr,nr,hr]=Re.getGridBuffers(Lt,gt!==0);ae.draw(N,Ct,Se,Ve,Ae,mr.backCCW,Zt,"globe_raster",gr,nr,hr)}}}if(Re&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&pt.push("CUSTOM_ANTIALIASING"),ae=N.getOrCreateProgram("globeRaster",{defines:pt});for(const gt of V){const{x:Ct,y:Ge,z:ft}=gt.canonical,Ve=Ge===0,ht=Ge===(1<<ft)-1,[lt,_t,it,vt]=Re.getPoleBuffers(ft,!1);if(vt&&(Ve||ht)){const Lt=B.getTile(gt);se.activeTexture.set(te.TEXTURE0),Lt.texture&&Lt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let Nt=i.cJ(ft,Ct,_e);const Ot=i.bc(i.cI(gt.canonical)),Zt=(gr,nr)=>gr.draw(N,te.TRIANGLES,Se,vr.disabled,Ae,mr.disabled,qm(_e.expandedFarZProjMatrix,Nt,Nt,Ot,0,Ee,_e.frustumCorners.TL,_e.frustumCorners.TR,_e.frustumCorners.BR,_e.frustumCorners.BL,_e.globeCenterInViewSpace,_e.globeRadius,Ne,0,_e._farZ),"globe_pole_raster",nr,it,vt);z.setupElevationDraw(Lt,ae,We),N.uploadCommonUniforms(se,ae,gt.toUnwrapped()),Ve&&N.renderDefaultNorthPole&&Zt(ae,lt),ht&&N.renderDefaultSouthPole&&(Nt=i.ad.mat4.scale(i.ad.mat4.create(),Nt,[1,-1,1]),Zt(ae,_t))}}}})(_,v,S,R,D);else{const N=_.context,z=N.gl;let B,V;const X=_.shadowRenderer,se=Sa(_,_.longestCutoffRange),te=Ae=>{if(V===Ae)return;const Se=[];Se.push(Hm[Ae]),se.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),X&&(Se.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&Se.push("NORMAL_OFFSET")),B=_.getOrCreateProgram("terrainRaster",{defines:Se}),V=Ae},ae=_.colorModeForRenderPass(),ce=new Jt(z.LEQUAL,Jt.ReadWrite,_.depthRangeFor3D);po.update(D);const _e=_.transform,be=Ca(_e.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let xe=[0,0,0];if(X){const Ae=_.style.directionalLight,Se=_.style.ambientLight;Ae&&Se&&(xe=Dc(_.style,Ae,Se))}{V=-1;const Ae=z.TRIANGLES,[Se,Te]=[v.gridIndexBuffer,v.gridSegments];for(const Ee of R){const Re=S.getTile(Ee),Ne=vr.disabled,nt=v.prevTerrainTileForTile[Ee.key],We=v.terrainTileForTile[Ee.key];uf(nt,We)&&po.newMorphing(Ee.key,nt,We,D,250),N.activeTexture.set(z.TEXTURE0),Re.texture&&Re.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const pt=po.getMorphValuesForProxy(Ee.key),gt=pt?1:0;let Ct;pt&&(Ct={morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:i.cC(pt.phase)}});const Ge=fv(Ee.projMatrix,Wm(Ee.canonical,_e.renderWorldCopies)?be/10:be,xe);if(te(gt),!B)continue;v.setupElevationDraw(Re,B,Ct);const ft=Ee.toUnwrapped();X&&X.setupShadows(ft,B),_.uploadCommonUniforms(N,B,ft,null,se),B.draw(_,Ae,ce,Ne,ae,mr.backCCW,Ge,"terrain_raster",v.gridBuffer,Se,Te)}}}}(a,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],S=this._drapedRenderBatches.shift(),R=a.style.order,D=[];let N=0;for(const z of v){const B=_.getTileByID(z.proxyTileKey),V=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][r]:void 0,X=V!==void 0?_.renderCache[V]:this.pool[N++],se=V!==void 0;if(B.texture=X.tex,se&&!X.dirty){D.push(B.tileID);continue}let te;f.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(f.clear({color:i.al.transparent,stencil:0}),X.dirty=!1);for(let ae=S.start;ae<=S.end;++ae){const ce=a.style._mergedLayers[R[ae]];if(ce.isHidden(a.transform.zoom))continue;const _e=a.style.getLayerSourceCache(ce),be=_e?this.proxyToSource[z.key][_e.id]:[z];if(!be)continue;const xe=be;f.viewport.set([0,0,X.fb.width,X.fb.height]),te!==(_e?_e.id:null)&&(this._setupStencil(X,be,ce,_e),te=_e?_e.id:null),a.renderLayer(a,_e,ce,xe)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const ce=a.style._mergedLayers[R[ae]];if(ce.isHidden(a.transform.zoom))continue;const _e=a.style.getLayerSourceCache(ce),be=_e?this.proxyToSource[z.key][_e.id]:[z];if(!be)continue;const xe=be;f.viewport.set([0,0,X.fb.width,X.fb.height]),te!==(_e?_e.id:null)&&(this._setupStencil(X,be,ce,_e),te=_e?_e.id:null),a.renderLayer(a,_e,ce,xe)}this.renderedToTile?(X.dirty=!0,D.push(B.tileID)):se||--N,N===5&&(N=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),S.end+1}postRender(){}isLayerOrderingCorrect(r){const a=r.order.length;let f=-1,_=a;for(let v=0;v<a;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?f=Math.max(f,v):_=Math.min(_,v);return _>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{r=Math.min(r,a.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,a,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,R=1<<S.overscaledZ,{x:D,y:N}=S.canonical,z=D/R,B=(D+1)/R,V=N/R,X=(N+1)/R;return{minx:z,miny:V,maxx:B,maxy:X,t:v.dem.tree.raycastRoot(z,V,B,X,r,a,f),tile:v}});_.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of _){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,a,f);if(S!=null)return S}return null}_createFBO(){const r=this.painter.context,a=r.gl,f=this.drapeBufferSize;r.activeTexture.set(a.TEXTURE0);const _=new i.T(r,{width:f[0],height:f[1],data:null},a.RGBA8);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=r.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new hv(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const a=this._style._mergedLayers[r],f=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const f of this._style.getSources())if(f instanceof xc){r=!0;break}if(!r)return;const a={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(v&&!a[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof i.ab){a[v.id]=!0;for(const S of this.proxyCoords){const R=this.proxyToSource[S.key][v.id];if(R)for(const D of R)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof uo){r=!0;break}if(!r)return;const a={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(_);if(!v||a[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const S=_.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const D=this.proxyToSource[R.key][v.id];if(D)for(const N of D){const z=df(v.getTile(N),v.findLoadedParent(N,0),v,this.painter.transform,S);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(v.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,a=r.length;if(a===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,v=0,S=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<a;)S=this._style._mergedLayers[r[v]];for(;v<a;++v){const R=this._style._mergedLayers[r[v]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?_===void 0&&(_=v):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(f.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:v-1}),f.length!==0){const R=f[f.length-1];this._pendingGroundEffectLayers.every(D=>D>R.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const S=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let R=0;R<S.length;++R){const D=Object.values(S[R]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let S=f.length-1;S>=0;S--){const R=f[S];if(a.getTileByID(R.key),a.proxyCachedFBO[R.key]!==void 0){const D=r[R.key],N=this.proxyToSource[R.key];let z=0;for(const B in N){const V=N[B],X=D[B];if(!X||X.length!==V.length||V.some((se,te)=>se!==X[te]||_[B]&&_[B].hasOwnProperty(se.key))){z=-1;break}++z}for(const B in a.proxyCachedFBO[R.key])a.renderCache[a.proxyCachedFBO[R.key][B]].dirty=z<0||z!==Object.values(D).length}}const v=[...this._drapedRenderBatches];v.sort((S,R)=>R.end-R.start-(S.end-S.start));for(const S of v)for(const R of f){if(a.proxyCachedFBO[R.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[R.key]={},a.proxyCachedFBO[R.key][S.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(r,a,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let R;if(f.isTileClipped())R=a.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):vr.disabled}_renderTileClippingMasks(r,a){const f=this.painter,_=this.painter.context,v=_.gl;f._tileClippingMaskIDs={},_.setColorMode(kr.disabled),_.setDepthMode(Jt.disabled);const S=f.getOrCreateProgram("clippingMask");for(const R of r){const D=f._tileClippingMaskIDs[R.key]=--a;S.draw(f,v.TRIANGLES,Jt.disabled,new vr({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),kr.disabled,mr.disabled,Bc(R.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const a=this.painter.transform;if(r.x<0||r.x>a.width||r.y<0||r.y>a.height)return null;const f=[r.x,r.y,1,1];i.ad.vec4.transformMat4(f,f,a.pixelMatrixInverse),i.ad.vec4.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const _=a._camera.position,v=i.bH(1,a.center.lat),S=[_[0],_[1],_[2]/v,0],R=i.ad.vec3.subtract([],f.slice(0,3),S);i.ad.vec3.normalize(R,R);const D=this.raycast(S,R,this._exaggeration);return D!==null&&D?(i.ad.vec3.scaleAndAdd(S,S,R,D),S[3]=S[2],S[2]*=v,S):null}_setupProxiedCoordsForOrtho(r,a,f){if(r.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(r,a,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){const N=v[D],z=this._findTileCoveringTileID(N,r);if(z){const B=this._createProxiedId(N,z,f[N.key]&&f[N.key][r.id]);_.push(B),this.proxyToSource[N.key][r.id]=[B]}}let S=!1;const R=new Set;for(let D=0;D<a.length;D++){const N=r.getTile(a[D]);if(!N||!N.hasData())continue;const z=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==N.tileID.canonical.z){const B=this.proxyToSource[z.tileID.key][r.id],V=this._createProxiedId(z.tileID,N,f[z.tileID.key]&&f[z.tileID.key][r.id]);B?B.splice(B.length-1,0,V):this.proxyToSource[z.tileID.key][r.id]=[V];const X=this.proxyToSource[z.tileID.key][r.id];R.has(X)||R.add(X),_.push(V),S=!0}}if(this._sourceTilesOverlap[r.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const D of R)D.sort((N,z)=>z.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(r,a,f){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords,S=r.getSource(),R=S.tileID;if(!R)return;const D=new i.P(R.x,R.y)._div(1<<R.z),N=S.coordinates.map(i.ac.fromLngLat).reduce((B,V)=>(B.min.x=Math.min(B.min.x,V.x-D.x),B.min.y=Math.min(B.min.y,V.y-D.y),B.max.x=Math.max(B.max.x,V.x-D.x),B.max.y=Math.max(B.max.y,V.y-D.y),B),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(B,V)=>{const X=B.wrap+B.canonical.x/(1<<B.canonical.z),se=B.canonical.y/(1<<B.canonical.z),te=i.ai/(1<<B.canonical.z),ae=V.wrap+V.canonical.x/(1<<V.canonical.z),ce=V.canonical.y/(1<<V.canonical.z);return X+te<ae+N.min.x||X>ae+N.max.x||se+te<ce+N.min.y||se>ce+N.max.y};for(let B=0;B<v.length;B++){const V=v[B];for(let X=0;X<a.length;X++){const se=r.getTile(a[X]);if(!se||!se.hasData()||z(V,se.tileID))continue;const te=this._createProxiedId(V,se,f[V.key]&&f[V.key][r.id]),ae=this.proxyToSource[V.key][r.id];ae?ae.push(te):this.proxyToSource[V.key][r.id]=[te],_.push(te)}}}_createProxiedId(r,a,f){let _=this.orthoMatrix;if(f){const v=f.find(S=>S.key===a.tileID.key);if(v)return v}if(a.tileID.key!==r.key){const v=r.canonical.z-a.tileID.canonical.z;let S,R,D;_=i.ad.mat4.create();const N=a.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(S=i.ai>>v,R=S*((a.tileID.canonical.x<<v)-r.canonical.x+N),D=S*((a.tileID.canonical.y<<v)-r.canonical.y)):(S=i.ai<<-v,R=i.ai*(a.tileID.canonical.x-(r.canonical.x+N<<-v)),D=i.ai*(a.tileID.canonical.y-(r.canonical.y<<-v))),i.ad.mat4.ortho(_,0,S,0,S,0,1),i.ad.mat4.translate(_,_,[R,D,0])}return new hf(a.tileID,r.key,_)}_findTileCoveringTileID(r,a){let f=a.getTile(r);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[a.id],v=_[r.key];if(f=v?a.getTileByID(v):null,f&&f.hasData()||v===null)return f;let S=f?f.tileID:r,R=S.overscaledZ;const D=a.getSource().minzoom,N=[];if(!v){const B=a.getSource().maxzoom;if(r.canonical.z>=B){const V=r.canonical.z-B;a.getSource().reparseOverscaled?(R=Math.max(r.canonical.z+2,a.transform.tileZoom),S=new i.aH(R,r.wrap,B,r.canonical.x>>V,r.canonical.y>>V)):V!==0&&(R=B,S=new i.aH(R,r.wrap,B,r.canonical.x>>V,r.canonical.y>>V))}S.key!==r.key&&(N.push(S.key),f=a.getTile(S))}const z=B=>{N.forEach(V=>{_[V]=B}),N.length=0};for(R-=1;R>=D&&(!f||!f.hasData());R--){f&&z(f.tileID.key);const B=S.calculateScaledKey(R);if(f=a.getTileByID(B),f&&f.hasData())break;const V=_[B];if(V===null)break;V===void 0?N.push(B):f=a.getTileByID(V)}return z(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,a){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[a.key]=!0}}function gv(p,r,a){const f=function(R,D,N){const z=i.ad.vec3.dot(D,R),B=i.ad.vec3.dot(N,[.2126,.7152,.0722]),V=(se,te,ae)=>(1-ae)*se+ae*te,X=V(1-.3*Math.min(B,1),1,Math.min(z+1,1));return V(.92,1,Math.asin(i.ay(D[2],-1,1))/Math.PI+.5)*X}(p,[0,0,1],r),_=[0,0,0];i.ad.vec3.scale(_,a.slice(0,3),f);const v=[0,0,0];i.ad.vec3.scale(v,r.slice(0,3),p[2]);const S=[0,0,0];return i.ad.vec3.add(S,_,v),i.cg(S)}const Id=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Wb=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class _v{static cacheKey(r,a,f,_){let v=`${a}${_?_.cacheKey:""}`;for(const S of f)r.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(r,a,f,_,v,S){const R=r.gl;this.program=R.createProgram(),this.configuration=_,this.name=a,this.fixedDefines=[...S];const D=_?_.getBinderAttributes():[],N=(f.staticAttributes||[]).concat(D);let z=_?_.defines():[];z=z.concat(S.map(ae=>`#define ${ae}`));const B=`#version 300 es
`;let V=B+z.concat("precision mediump float;",sf,Rm.fragmentSource).join(`
`);for(const ae of f.fragmentIncludes)V+=`
${ql[ae]}`;V+=`
${f.fragmentSource}`;let X=B+z.concat("precision highp float;",sf,Rm.vertexSource).join(`
`);for(const ae of f.vertexIncludes)X+=`
${ql[ae]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(X+=`
uniform int u_instanceID;
`),X+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const se=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(se,V),R.compileShader(se),R.attachShader(this.program,se);const te=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(te,X),R.compileShader(te),R.attachShader(this.program,te),this.attributes={},this.numAttributes=N.length;for(let ae=0;ae<this.numAttributes;ae++)if(N[ae]){const ce=N[ae].startsWith("a_")?N[ae]:`a_${N[ae]}`;R.bindAttribLocation(this.program,ae,ce),this.attributes[ce]=ae}R.linkProgram(this.program),R.deleteShader(te),R.deleteShader(se),this.fixedUniforms=v(r),this.binderUniforms=_?_.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ae=>({u_instanceID:new i.bN(ae)}))(r)),(S.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new i.bN(ae),u_dem_prev:new i.bN(ae),u_dem_tl:new i.bK(ae),u_dem_scale:new i.bM(ae),u_dem_tl_prev:new i.bK(ae),u_dem_scale_prev:new i.bM(ae),u_dem_size:new i.bM(ae),u_dem_lerp:new i.bM(ae),u_exaggeration:new i.bM(ae),u_depth:new i.bN(ae),u_depth_size_inv:new i.bK(ae),u_depth_range_unpack:new i.bK(ae),u_occluder_half_size:new i.bM(ae),u_occlusion_depth_offset:new i.bM(ae),u_meter_to_dem:new i.bM(ae),u_label_plane_matrix_inv:new i.bJ(ae)}))(r)),S.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new i.bL(ae),u_tile_tr_up:new i.bL(ae),u_tile_br_up:new i.bL(ae),u_tile_bl_up:new i.bL(ae),u_tile_up_scale:new i.bM(ae)}))(r)),S.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new i.bJ(ae),u_fog_range:new i.bK(ae),u_fog_color:new i.cb(ae),u_fog_horizon_blend:new i.bM(ae),u_fog_vertical_limit:new i.bK(ae),u_fog_temporal_offset:new i.bM(ae),u_frustum_tl:new i.bL(ae),u_frustum_tr:new i.bL(ae),u_frustum_br:new i.bL(ae),u_frustum_bl:new i.bL(ae),u_globe_pos:new i.bL(ae),u_globe_radius:new i.bM(ae),u_globe_transition:new i.bM(ae),u_is_globe:new i.bN(ae),u_viewport:new i.bK(ae)}))(r)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new i.cb(ae)}))(r)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new i.bL(ae),u_lighting_directional_dir:new i.bL(ae),u_lighting_directional_color:new i.bL(ae),u_ground_radiance:new i.bL(ae)}))(r)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new i.bJ(ae),u_light_matrix_1:new i.bJ(ae),u_fade_range:new i.bK(ae),u_shadow_normal_offset:new i.bL(ae),u_shadow_intensity:new i.bM(ae),u_shadow_texel_size:new i.bM(ae),u_shadow_map_resolution:new i.bM(ae),u_shadow_direction:new i.bL(ae),u_shadow_bias:new i.bL(ae),u_shadowmap_0:new i.bN(ae),u_shadowmap_1:new i.bN(ae)}))(r))}}setTerrainUniformValues(r,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setGlobeUniformValues(r,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_]&&f[_].set(this.program,_,a[_])}}setFogUniformValues(r,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setCutoffUniformValues(r,a){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setLightsUniformValues(r,a){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}}setShadowUniformValues(r,a){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;r.program.set(this.program);for(const _ in a)f[_].set(this.program,_,a[_])}_drawDebugWireframe(r,a,f,_,v,S,R,D,N,z){const B=r.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const V=r.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||r._terrain&&r._terrain.renderingToTexture||!Id.includes(this.name))||!(!B.layers3D||!Wb.includes(this.name))))return;const X=V.gl,se=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,V);if(!se)return;const te=[...this.fixedDefines];te.push("DEBUG_WIREFRAME");const ae=r.getOrCreateProgram(this.name,{config:this.configuration,defines:te});V.program.set(ae.program);const ce=(xe,Ae,Se)=>{if(Ae[xe]&&Se[xe])for(const Te in Ae[xe])Se[xe][Te]&&Se[xe][Te].set(Se.program,Te,Ae[xe][Te].current)};N&&N.setUniforms(ae.program,V,ae.binderUniforms,R,{zoom:D}),ce("fixedUniforms",this,ae),ce("terrainUniforms",this,ae),ce("globeUniforms",this,ae),ce("fogUniforms",this,ae),ce("lightsUniforms",this,ae),ce("shadowUniforms",this,ae),se.bind(),V.setColorMode(new kr([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],i.al.transparent,[!0,!0,!0,!1])),V.setDepthMode(new Jt(a.func===X.LESS?X.LEQUAL:a.func,Jt.ReadOnly,a.range)),V.setStencilMode(vr.disabled);const _e=3*S.primitiveLength*2,be=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const xe=z||1;for(let Ae=0;Ae<xe;++Ae)ae.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),X.drawElements(X.LINES,_e,X.UNSIGNED_SHORT,be)}else z&&z>1?X.drawElementsInstanced(X.LINES,_e,X.UNSIGNED_SHORT,be,z):X.drawElements(X.LINES,_e,X.UNSIGNED_SHORT,be);v.bind(),V.program.set(this.program),V.setDepthMode(a),V.setStencilMode(f),V.setColorMode(_)}checkUniforms(r,a,f){if(this.fixedDefines.includes(a)){for(const _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${_} not set but required by ${a} being defined`)}}draw(r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae){const ce=r.context,_e=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(f),ce.setStencilMode(_),ce.setColorMode(v),ce.setCullFace(S);for(const Ae of Object.keys(this.fixedUniforms))this.fixedUniforms[Ae].set(this.program,Ae,R[Ae]);se&&se.setUniforms(this.program,ce,this.binderUniforms,V,{zoom:X});const be={[_e.POINTS]:1,[_e.LINES]:2,[_e.TRIANGLES]:3,[_e.LINE_STRIP]:1}[a];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const xe=ae&&ae>0?1:void 0;for(const Ae of B.get()){const Se=Ae.vaos||(Ae.vaos={});if((Se[D]||(Se[D]=new sv)).bind(ce,this,N,se?se.getPaintVertexBuffers():[],z,Ae.vertexOffset,te||[],xe),this.forceManualRenderingForInstanceIDShaders){const Te=ae||1;for(let Ee=0;Ee<Te;++Ee)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),z?_e.drawElements(a,Ae.primitiveLength*be,_e.UNSIGNED_SHORT,Ae.primitiveOffset*be*2):_e.drawArrays(a,Ae.vertexOffset,Ae.vertexLength)}else ae&&ae>1?_e.drawElementsInstanced(a,Ae.primitiveLength*be,_e.UNSIGNED_SHORT,Ae.primitiveOffset*be*2,ae):z?_e.drawElements(a,Ae.primitiveLength*be,_e.UNSIGNED_SHORT,Ae.primitiveOffset*be*2):_e.drawArrays(a,Ae.vertexOffset,Ae.vertexLength);a===_e.TRIANGLES&&z&&this._drawDebugWireframe(r,f,_,v,z,Ae,V,X,se,ae)}}}function Xm(p,r){const a=Math.pow(2,r.tileID.overscaledZ),f=r.tileSize*Math.pow(2,p.transform.tileZoom)/a,_=f*(r.tileID.canonical.x+r.tileID.wrap*a),v=f*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(r,1,p.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const ff={terrain:0,flat:1},Km=i.ad.mat4.create(),pf=(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce)=>{const _e=r.style.light,be=_e.properties.get("position"),xe=[be.x,be.y,be.z],Ae=i.ad.mat3.create();_e.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(Ae,-r.transform.angle),i.ad.vec3.transformMat3(xe,xe,Ae));const Se=_e.properties.get("color"),Te=r.transform,Ee={u_matrix:p,u_lightpos:xe,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Km,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ff[N],u_base_type:ff[z],u_ao:_,u_edge_radius:v,u_width_scale:S,u_flood_light_color:se,u_vertical_scale:te,u_flood_light_intensity:ae,u_ground_shadow_factor:ce};return Te.projection.name==="globe"&&(Ee.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],Ee.u_zoom_transition=B,Ee.u_inv_rot_matrix=X,Ee.u_merc_center=V,Ee.u_up_dir=Te.projection.upVector(new i.bT(0,0,0),V[0]*i.ai,V[1]*i.ai),Ee.u_height_lift=D),Ee},Uc=(p,r,a,f,_,v)=>({u_matrix:p,u_edge_radius:r,u_width_scale:a,u_vertical_scale:f,u_height_type:ff[_],u_base_type:ff[v]}),Ym=(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae)=>{const ce=pf(p,r,a,f,_,v,S,R,N,z,B,V,X,se,te,ae,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,R.overscaledZ)/D.tileSize/8};return i.l(ce,Xm(r,D),_e)},Vc=(p,r)=>({u_matrix:p,u_emissive_strength:r}),Jm=(p,r,a,f)=>i.l(Vc(p,r),Xm(a,f)),mf=(p,r,a)=>({u_matrix:p,u_world:a,u_emissive_strength:r}),gf=(p,r,a,f,_)=>i.l(Jm(p,r,a,f),{u_world:_}),Pd=(p,r,a,f,_)=>({u_matrix:p,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:a,u_height_scale:f,u_reset_depth:_}),yv=(p,r,a,f)=>{const _=i.ai/a.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(f),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},vv=(p,r,a=1)=>({u_matrix:p,u_color:r.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),$c=i.ad.mat4.create(),_f=(p,r,a,f,_,v,S)=>{const R=p.transform,D=R.projection.name==="globe",N=D?i.cO(R.zoom,r.canonical)*R._pixelsPerMercatorPixel:i.at(a,1,v),z={u_matrix:r.projMatrix,u_extrude_scale:N,u_intensity:S,u_inv_rot_matrix:$c,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){z.u_inv_rot_matrix=f,z.u_merc_center=_,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=i.ag(R.zoom);const B=_[0]*i.ai,V=_[1]*i.ai;z.u_up_dir=R.projection.upVector(new i.bT(0,0,0),B,V)}return z};function Bt(p,[r,a,f,_],[v,S]){if(v===S)return[0,0,0,0];const R=255*(p-1)/(p*(S-v));return[r*R,a*R,f*R,_*R]}function Qm(p,r,[a,f]){return a===f?0:.5/p+(r-a)*(p-1)/(p*(f-a))}const eg=(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e,be,xe)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:N,u_fade_t:z.mix,u_opacity:z.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(B.paint.get("raster-saturation")),u_contrast_factor:i.cQ(B.paint.get("raster-contrast")),u_spin_weights:dl(B.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:X,u_zoom_transition:S,u_merc_center:R,u_cutoff_params:D,u_colorization_mix:Bt(i.cR,te,ce),u_colorization_offset:Qm(i.cR,ae,ce),u_color_ramp:se,u_texture_offset:[be/(_e+2*be),_e/(_e+2*be)],u_texture_res:[_e+2*be,_e+2*be],u_emissive_strength:xe});function dl(p){p*=Math.PI/180;const r=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*r-a+1)/3,(Math.sqrt(3)*r-a+1)/3]}const Zs=.05,er=(p,r,a,f,_,v,S,R,D,N,z,B)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:N,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:S,u_merc_center:R,u_cutoff_params:D}),tg=(p,r,a,f,_,v,S,R,D,N)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_tile_offset:a,u_velocity:f,u_color_ramp:v,u_velocity_res:_,u_max_speed:S,u_uv_offset:R,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Zs,Zs]}),Zb=(p,r,a,f,_,v,S,R,D,N)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_velocity:a,u_velocity_res:f,u_max_speed:_,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Zs,Zs]}),xv=i.ad.mat4.create(),yf=(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e,be,xe,Ae)=>{const Se=_.transform,Te={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Se.getCameraToCenterDistance(_e),u_rotate_symbol:+a,u_aspect_ratio:Se.width/Se.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:R,u_is_text:+N,u_elevation_from_sea:D?1:0,u_pitch_with_map:+f,u_texsize:z,u_texsize_icon:B,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xv,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xv,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:xe||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(_e)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:+V,u_scale_factor:Ae||1};return _e.name==="globe"&&(Te.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],Te.u_zoom_transition=se,Te.u_inv_rot_matrix=ae,Te.u_merc_center=te,Te.u_camera_forward=Se._camera.forward(),Te.u_ecef_origin=i.cS(Se.globeMatrix,X.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Se.globeMatrix),Te.u_up_vector=ce),Te},rg=(p,r,a,f)=>({u_matrix:p,u_emissive_strength:r,u_opacity:a,u_color:f}),bv=(p,r,a,f,_,v,S,R,D)=>i.l(function(N,z,B,V,X,se){const{width:te,height:ae}=V.imageManager.getPixelSize(z),ce=Math.pow(2,se.tileID.overscaledZ),_e=se.tileSize*Math.pow(2,V.transform.tileZoom)/ce,be=_e*(se.tileID.canonical.x+se.tileID.wrap*ce),xe=_e*se.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[te,ae],u_pattern_size:B.displaySize,u_pattern_units_to_pixels:X?[V.transform.width,-1*V.transform.height]:[1/i.at(se,1,V.transform.tileZoom),1/i.at(se,1,V.transform.tileZoom)],u_pixel_coord_upper:[be>>16,xe>>16],u_pixel_coord_lower:[65535&be,65535&xe]}}(0,v,S,f,R,D),{u_matrix:p,u_emissive_strength:r,u_opacity:a}),vf=new Float32Array(i.ad.mat4.identity([])),ng=(p,r,a,f,_,v,S,R,D,N,z,B,V,X=[0,0,0],se)=>{const te=_.style.light,ae=te.properties.get("position"),ce=[-ae.x,-ae.y,ae.z],_e=i.ad.mat3.create();te.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(_e,-_.transform.angle),i.ad.vec3.transformMat3(ce,ce,_e));const be=z.alphaMode==="MASK",xe=te.properties.get("color").toRenderColor(null),Ae=V.paint.get("model-ambient-occlusion-intensity"),Se=V.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),Te=V.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:r,u_normal_matrix:a,u_node_matrix:f||vf,u_lightpos:ce,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_camera_pos:X,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[R[0],R[1],R[2],1],u_metallicFactor:D,u_roughnessFactor:N,u_baseColorTexture:Hn.BaseColor,u_metallicRoughnessTexture:Hn.MetallicRoughness,u_normalTexture:Hn.Normal,u_occlusionTexture:Hn.Occlusion,u_emissionTexture:Hn.Emission,u_lutTexture:Hn.LUT,u_color_mix:[Se.r,Se.g,Se.b,Te],u_aoIntensity:Ae,u_emissive_strength:B,u_occlusionTextureTransform:se||[0,0,0,0]}},wv=(p,r=vf,a=vf)=>({u_matrix:p,u_instance:r,u_node_matrix:a}),ig={fillExtrusion:p=>({u_matrix:new i.bJ(p),u_lightpos:new i.bL(p),u_lightintensity:new i.bM(p),u_lightcolor:new i.bL(p),u_vertical_gradient:new i.bM(p),u_opacity:new i.bM(p),u_edge_radius:new i.bM(p),u_width_scale:new i.bM(p),u_ao:new i.bK(p),u_height_type:new i.bN(p),u_base_type:new i.bN(p),u_tile_id:new i.bL(p),u_zoom_transition:new i.bM(p),u_inv_rot_matrix:new i.bJ(p),u_merc_center:new i.bK(p),u_up_dir:new i.bL(p),u_height_lift:new i.bM(p),u_flood_light_color:new i.bL(p),u_vertical_scale:new i.bM(p),u_flood_light_intensity:new i.bM(p),u_ground_shadow_factor:new i.bL(p)}),fillExtrusionDepth:p=>({u_matrix:new i.bJ(p),u_edge_radius:new i.bM(p),u_width_scale:new i.bM(p),u_vertical_scale:new i.bM(p),u_height_type:new i.bN(p),u_base_type:new i.bN(p)}),fillExtrusionPattern:p=>({u_matrix:new i.bJ(p),u_lightpos:new i.bL(p),u_lightintensity:new i.bM(p),u_lightcolor:new i.bL(p),u_vertical_gradient:new i.bM(p),u_height_factor:new i.bM(p),u_edge_radius:new i.bM(p),u_width_scale:new i.bM(p),u_ao:new i.bK(p),u_height_type:new i.bN(p),u_base_type:new i.bN(p),u_tile_id:new i.bL(p),u_zoom_transition:new i.bM(p),u_inv_rot_matrix:new i.bJ(p),u_merc_center:new i.bK(p),u_up_dir:new i.bL(p),u_height_lift:new i.bM(p),u_image:new i.bN(p),u_texsize:new i.bK(p),u_pixel_coord_upper:new i.bK(p),u_pixel_coord_lower:new i.bK(p),u_tile_units_to_pixels:new i.bM(p),u_opacity:new i.bM(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new i.bJ(p),u_opacity:new i.bM(p),u_ao_pass:new i.bM(p),u_meter_to_tile:new i.bM(p),u_ao:new i.bK(p),u_flood_light_intensity:new i.bM(p),u_flood_light_color:new i.bL(p),u_attenuation:new i.bM(p),u_edge_radius:new i.bM(p),u_fb:new i.bN(p),u_fb_size:new i.bM(p),u_dynamic_offset:new i.bM(p)}),fill:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p)}),fillPattern:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p),u_image:new i.bN(p),u_texsize:new i.bK(p),u_pixel_coord_upper:new i.bK(p),u_pixel_coord_lower:new i.bK(p),u_tile_units_to_pixels:new i.bM(p)}),fillOutline:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p),u_world:new i.bK(p)}),fillOutlinePattern:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p),u_world:new i.bK(p),u_image:new i.bN(p),u_texsize:new i.bK(p),u_pixel_coord_upper:new i.bK(p),u_pixel_coord_lower:new i.bK(p),u_tile_units_to_pixels:new i.bM(p)}),elevatedStructures:p=>({u_matrix:new i.bJ(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new i.bJ(p),u_camera_pos:new i.bL(p),u_depth_bias:new i.bM(p),u_height_scale:new i.bM(p),u_reset_depth:new i.bM(p)}),circle:i.cT,collisionBox:p=>({u_matrix:new i.bJ(p),u_camera_to_center_distance:new i.bM(p),u_extrude_scale:new i.bK(p)}),collisionCircle:p=>({u_matrix:new i.bJ(p),u_inv_matrix:new i.bJ(p),u_camera_to_center_distance:new i.bM(p),u_viewport_size:new i.bK(p)}),debug:p=>({u_color:new i.cA(p),u_matrix:new i.bJ(p),u_overlay:new i.bN(p),u_overlay_scale:new i.bM(p)}),clippingMask:p=>({u_matrix:new i.bJ(p)}),heatmap:p=>({u_extrude_scale:new i.bM(p),u_intensity:new i.bM(p),u_matrix:new i.bJ(p),u_inv_rot_matrix:new i.bJ(p),u_merc_center:new i.bK(p),u_tile_id:new i.bL(p),u_zoom_transition:new i.bM(p),u_up_dir:new i.bL(p)}),heatmapTexture:p=>({u_image:new i.bN(p),u_color_ramp:new i.bN(p),u_opacity:new i.bM(p)}),hillshade:p=>({u_matrix:new i.bJ(p),u_image:new i.bN(p),u_latrange:new i.bK(p),u_light:new i.bK(p),u_shadow:new i.cA(p),u_highlight:new i.cA(p),u_emissive_strength:new i.bM(p),u_accent:new i.cA(p)}),hillshadePrepare:p=>({u_matrix:new i.bJ(p),u_image:new i.bN(p),u_dimension:new i.bK(p),u_zoom:new i.bM(p)}),line:i.cU,linePattern:i.cV,raster:p=>({u_matrix:new i.bJ(p),u_normalize_matrix:new i.bJ(p),u_globe_matrix:new i.bJ(p),u_merc_matrix:new i.bJ(p),u_grid_matrix:new i.cB(p),u_tl_parent:new i.bK(p),u_scale_parent:new i.bM(p),u_fade_t:new i.bM(p),u_opacity:new i.bM(p),u_image0:new i.bN(p),u_image1:new i.bN(p),u_brightness_low:new i.bM(p),u_brightness_high:new i.bM(p),u_saturation_factor:new i.bM(p),u_contrast_factor:new i.bM(p),u_spin_weights:new i.bL(p),u_perspective_transform:new i.bK(p),u_raster_elevation:new i.bM(p),u_zoom_transition:new i.bM(p),u_merc_center:new i.bK(p),u_cutoff_params:new i.cb(p),u_colorization_mix:new i.cb(p),u_colorization_offset:new i.bM(p),u_color_ramp:new i.bN(p),u_texture_offset:new i.bK(p),u_texture_res:new i.bK(p),u_emissive_strength:new i.bM(p)}),rasterParticle:p=>({u_matrix:new i.bJ(p),u_normalize_matrix:new i.bJ(p),u_globe_matrix:new i.bJ(p),u_merc_matrix:new i.bJ(p),u_grid_matrix:new i.cB(p),u_tl_parent:new i.bK(p),u_scale_parent:new i.bM(p),u_fade_t:new i.bM(p),u_opacity:new i.bM(p),u_image0:new i.bN(p),u_image1:new i.bN(p),u_raster_elevation:new i.bM(p),u_zoom_transition:new i.bM(p),u_merc_center:new i.bK(p),u_cutoff_params:new i.cb(p)}),rasterParticleTexture:p=>({u_texture:new i.bN(p),u_opacity:new i.bM(p)}),rasterParticleDraw:p=>({u_particle_texture:new i.bN(p),u_particle_texture_side_len:new i.bM(p),u_tile_offset:new i.bK(p),u_velocity:new i.bN(p),u_color_ramp:new i.bN(p),u_velocity_res:new i.bK(p),u_max_speed:new i.bM(p),u_uv_offset:new i.bK(p),u_data_scale:new i.bK(p),u_data_offset:new i.bM(p),u_particle_pos_scale:new i.bM(p),u_particle_pos_offset:new i.bK(p)}),rasterParticleUpdate:p=>({u_particle_texture:new i.bN(p),u_particle_texture_side_len:new i.bM(p),u_velocity:new i.bN(p),u_velocity_res:new i.bK(p),u_max_speed:new i.bM(p),u_speed_factor:new i.bM(p),u_reset_rate:new i.bM(p),u_rand_seed:new i.bM(p),u_uv_offset:new i.bK(p),u_data_scale:new i.bK(p),u_data_offset:new i.bM(p),u_particle_pos_scale:new i.bM(p),u_particle_pos_offset:new i.bK(p)}),symbol:p=>({u_is_size_zoom_constant:new i.bN(p),u_is_size_feature_constant:new i.bN(p),u_size_t:new i.bM(p),u_size:new i.bM(p),u_camera_to_center_distance:new i.bM(p),u_rotate_symbol:new i.bN(p),u_aspect_ratio:new i.bM(p),u_fade_change:new i.bM(p),u_matrix:new i.bJ(p),u_label_plane_matrix:new i.bJ(p),u_coord_matrix:new i.bJ(p),u_is_text:new i.bN(p),u_elevation_from_sea:new i.bN(p),u_pitch_with_map:new i.bN(p),u_texsize:new i.bK(p),u_texsize_icon:new i.bK(p),u_texture:new i.bN(p),u_texture_icon:new i.bN(p),u_gamma_scale:new i.bM(p),u_device_pixel_ratio:new i.bM(p),u_tile_id:new i.bL(p),u_zoom_transition:new i.bM(p),u_inv_rot_matrix:new i.bJ(p),u_merc_center:new i.bK(p),u_camera_forward:new i.bL(p),u_tile_matrix:new i.bJ(p),u_up_vector:new i.bL(p),u_ecef_origin:new i.bL(p),u_is_halo:new i.bN(p),u_icon_transition:new i.bM(p),u_color_adj_mat:new i.bJ(p),u_scale_factor:new i.bM(p)}),background:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p),u_opacity:new i.bM(p),u_color:new i.cA(p)}),backgroundPattern:p=>({u_matrix:new i.bJ(p),u_emissive_strength:new i.bM(p),u_opacity:new i.bM(p),u_image:new i.bN(p),u_pattern_tl:new i.bK(p),u_pattern_br:new i.bK(p),u_texsize:new i.bK(p),u_pattern_size:new i.bK(p),u_pixel_coord_upper:new i.bK(p),u_pixel_coord_lower:new i.bK(p),u_pattern_units_to_pixels:new i.bK(p)}),terrainRaster:p=>({u_matrix:new i.bJ(p),u_image0:new i.bN(p),u_skirt_height:new i.bM(p),u_ground_shadow_factor:new i.bL(p)}),skybox:p=>({u_matrix:new i.bJ(p),u_sun_direction:new i.bL(p),u_cubemap:new i.bN(p),u_opacity:new i.bM(p),u_temporal_offset:new i.bM(p)}),skyboxGradient:p=>({u_matrix:new i.bJ(p),u_color_ramp:new i.bN(p),u_center_direction:new i.bL(p),u_radius:new i.bM(p),u_opacity:new i.bM(p),u_temporal_offset:new i.bM(p)}),skyboxCapture:p=>({u_matrix_3f:new i.cB(p),u_sun_direction:new i.bL(p),u_sun_intensity:new i.bM(p),u_color_tint_r:new i.cb(p),u_color_tint_m:new i.cb(p),u_luminance:new i.bM(p)}),globeRaster:p=>({u_proj_matrix:new i.bJ(p),u_globe_matrix:new i.bJ(p),u_normalize_matrix:new i.bJ(p),u_merc_matrix:new i.bJ(p),u_zoom_transition:new i.bM(p),u_merc_center:new i.bK(p),u_image0:new i.bN(p),u_grid_matrix:new i.cB(p),u_skirt_height:new i.bM(p),u_far_z_cutoff:new i.bM(p),u_frustum_tl:new i.bL(p),u_frustum_tr:new i.bL(p),u_frustum_br:new i.bL(p),u_frustum_bl:new i.bL(p),u_globe_pos:new i.bL(p),u_globe_radius:new i.bM(p),u_viewport:new i.bK(p)}),globeAtmosphere:p=>({u_frustum_tl:new i.bL(p),u_frustum_tr:new i.bL(p),u_frustum_br:new i.bL(p),u_frustum_bl:new i.bL(p),u_horizon:new i.bM(p),u_transition:new i.bM(p),u_fadeout_range:new i.bM(p),u_color:new i.cb(p),u_high_color:new i.cb(p),u_space_color:new i.cb(p),u_temporal_offset:new i.bM(p),u_horizon_angle:new i.bM(p)}),model:p=>({u_matrix:new i.bJ(p),u_lighting_matrix:new i.bJ(p),u_normal_matrix:new i.bJ(p),u_node_matrix:new i.bJ(p),u_lightpos:new i.bL(p),u_lightintensity:new i.bM(p),u_lightcolor:new i.bL(p),u_camera_pos:new i.bL(p),u_opacity:new i.bM(p),u_baseColorFactor:new i.cb(p),u_emissiveFactor:new i.cb(p),u_metallicFactor:new i.bM(p),u_roughnessFactor:new i.bM(p),u_baseTextureIsAlpha:new i.bN(p),u_alphaMask:new i.bN(p),u_alphaCutoff:new i.bM(p),u_baseColorTexture:new i.bN(p),u_metallicRoughnessTexture:new i.bN(p),u_normalTexture:new i.bN(p),u_occlusionTexture:new i.bN(p),u_emissionTexture:new i.bN(p),u_lutTexture:new i.bN(p),u_color_mix:new i.cb(p),u_aoIntensity:new i.bM(p),u_emissive_strength:new i.bM(p),u_occlusionTextureTransform:new i.cb(p)}),modelDepth:p=>({u_matrix:new i.bJ(p),u_instance:new i.bJ(p),u_node_matrix:new i.bJ(p)}),groundShadow:p=>({u_matrix:new i.bJ(p),u_ground_shadow_factor:new i.bL(p)}),stars:p=>({u_matrix:new i.bJ(p),u_up:new i.bL(p),u_right:new i.bL(p),u_intensity_multiplier:new i.bM(p)}),snowParticle:p=>({u_modelview:new i.bJ(p),u_projection:new i.bJ(p),u_time:new i.bM(p),u_cam_pos:new i.bL(p),u_velocityConeAperture:new i.bM(p),u_velocity:new i.bM(p),u_horizontalOscillationRadius:new i.bM(p),u_horizontalOscillationRate:new i.bM(p),u_boxSize:new i.bM(p),u_billboardSize:new i.bM(p),u_simpleShapeParameters:new i.bK(p),u_screenSize:new i.bK(p),u_thinningCenterPos:new i.bK(p),u_thinningShape:new i.bL(p),u_thinningAffectedRatio:new i.bM(p),u_thinningParticleOffset:new i.bM(p),u_particleColor:new i.cb(p),u_direction:new i.bL(p)}),rainParticle:p=>({u_modelview:new i.bJ(p),u_projection:new i.bJ(p),u_time:new i.bM(p),u_cam_pos:new i.bL(p),u_texScreen:new i.bN(p),u_velocityConeAperture:new i.bM(p),u_velocity:new i.bM(p),u_boxSize:new i.bM(p),u_rainDropletSize:new i.bK(p),u_distortionStrength:new i.bM(p),u_rainDirection:new i.bL(p),u_color:new i.cb(p),u_screenSize:new i.bK(p),u_thinningCenterPos:new i.bK(p),u_thinningShape:new i.bL(p),u_thinningAffectedRatio:new i.bM(p),u_thinningParticleOffset:new i.bM(p),u_shapeDirectionalPower:new i.bM(p),u_shapeNormalPower:new i.bM(p),u_mode:new i.bM(p)}),vignette:p=>({u_vignetteShape:new i.bL(p),u_vignetteColor:new i.cb(p)}),occlusion:p=>({u_matrix:new i.bJ(p),u_anchorPos:new i.bL(p),u_screenSizePx:new i.bK(p),u_occluderSizePx:new i.bK(p),u_color:new i.cb(p)})};class ta{constructor(r,a,f,_){this.id=ta.uniqueIdxCounter,ta.uniqueIdxCounter++,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||_||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=ta.uniqueIdxCounter,ta.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ta.uniqueIdxCounter=0;const sg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class og{constructor(r,a,f,_,v,S){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.instanceCount=S,this.context=r;const R=r.gl;this.buffer=R.createBuffer(),r.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,a){for(let f=0;f<this.attributes.length;f++){const _=a.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,a,f){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],S=a.attributes[v.name];S!==void 0&&r.vertexAttribPointer(S,v.components,r[sg[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,a,f){for(let _=0;_<this.attributes.length;_++){const v=a.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ss{constructor(r,a,f,_,v){this.context=r,this.width=a,this.height=f;const S=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new $m(r,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Gm(r,S):new Fc(r,S))}destroy(){const r=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&r.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&r.deleteTexture(a)}r.deleteFramebuffer(this.framebuffer)}}class hl{constructor(r,a){this.gl=r,this.clearColor=new Fb(this),this.clearDepth=new Dm(this),this.clearStencil=new Lm(this),this.colorMask=new Nm(this),this.depthMask=new Om(this),this.stencilMask=new av(this),this.stencilFunc=new lv(this),this.stencilOp=new Bb(this),this.stencilTest=new Cd(this),this.depthRange=new Ad(this),this.depthTest=new cv(this),this.depthFunc=new Ws(this),this.blend=new zm(this),this.blendFunc=new of(this),this.blendColor=new af(this),this.blendEquation=new jm(this),this.cullFace=new Fm(this),this.cullFaceSide=new Bm(this),this.frontFace=new lf(this),this.program=new Um(this),this.activeTexture=new Vm(this),this.viewport=new cf(this),this.bindFramebuffer=new uv(this),this.bindRenderbuffer=new dv(this),this.bindTexture=new jc(this),this.bindVertexBuffer=new Ub(this),this.bindElementBuffer=new Vb(this),this.bindVertexArrayOES=new $b(this),this.pixelStoreUnpack=new Gb(this),this.pixelStoreUnpackPremultiplyAlpha=new qb(this),this.pixelStoreUnpackFlipY=new Hb(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,a,f){return new ta(this,r,a,f)}createVertexBuffer(r,a,f,_,v){return new og(this,r,a,f,_,v)}createRenderbuffer(r,a,f){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,r,a,f),this.bindRenderbuffer.set(null),v}createFramebuffer(r,a,f,_){return new Ss(this,r,a,f,_)}clear({color:r,depth:a,stencil:f,colorMask:_}){const v=this.gl;let S=0;r&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(_||[!0,!0,!0,!0])),a!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){i.bn(r.blendFunction,kr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Rd;function xf(p,r,a,f,_,v,S){const R=p.context,D=R.gl,N=p.transform,z=p.getOrCreateProgram("collisionBox"),B=[];let V=0,X=0;for(let xe=0;xe<f.length;xe++){const Ae=f[xe],Se=r.getTile(Ae),Te=Se.getBucket(a);if(!Te)continue;const Ee=Tm(Ae,Te,N);let Re=Ee;_[0]===0&&_[1]===0||(Re=p.translatePosMatrix(Ee,Se,_,v));const Ne=S?Te.textCollisionBox:Te.iconCollisionBox,nt=Te.collisionCircleArray;if(nt.length>0){const We=i.ad.mat4.create(),pt=Re;i.ad.mat4.mul(We,Te.placementInvProjMatrix,N.glCoordMatrix),i.ad.mat4.mul(We,We,Te.placementViewportMatrix),B.push({circleArray:nt,circleOffset:X,transform:pt,invTransform:We,projection:Te.getProjection()}),V+=nt.length/4,X=V}Ne&&(p.terrain&&p.terrain.setupElevationDraw(Se,z),z.draw(p,D.LINES,Jt.disabled,vr.disabled,p.colorModeForRenderPass(),mr.disabled,yv(Re,N,Se,Te.getProjection()),a.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,N.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!S||!B.length)return;const se=p.getOrCreateProgram("collisionCircle"),te=new i.cW;te.resize(4*V),te._trim();let ae=0;for(const xe of B)for(let Ae=0;Ae<xe.circleArray.length/4;Ae++){const Se=4*Ae,Te=xe.circleArray[Se+0],Ee=xe.circleArray[Se+1],Re=xe.circleArray[Se+2],Ne=xe.circleArray[Se+3];te.emplace(ae++,Te,Ee,Re,Ne,0),te.emplace(ae++,Te,Ee,Re,Ne,1),te.emplace(ae++,Te,Ee,Re,Ne,2),te.emplace(ae++,Te,Ee,Re,Ne,3)}(!Rd||Rd.length<2*V)&&(Rd=function(xe){const Ae=2*xe,Se=new i.aV;Se.resize(Ae),Se._trim();for(let Te=0;Te<Ae;Te++){const Ee=6*Te;Se.uint16[Ee+0]=4*Te+0,Se.uint16[Ee+1]=4*Te+1,Se.uint16[Ee+2]=4*Te+2,Se.uint16[Ee+3]=4*Te+2,Se.uint16[Ee+4]=4*Te+3,Se.uint16[Ee+5]=4*Te+0}return Se}(V));const ce=R.createIndexBuffer(Rd,!0),_e=R.createVertexBuffer(te,i.cX.members,!0);for(const xe of B){const Ae={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(be=N).getCameraToCenterDistance(xe.projection),u_viewport_size:[be.width,be.height]};se.draw(p,D.TRIANGLES,Jt.disabled,vr.disabled,p.colorModeForRenderPass(),mr.disabled,Ae,a.id,_e,ce,i.b8.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,N.zoom)}var be;_e.destroy(),ce.destroy()}const Gc=i.ad.mat4.create();function bf(p){const r=p._camera.getWorldToCamera(p.worldSize,1),a=i.ad.mat4.multiply([],r,p.globeMatrix);i.ad.mat4.invert(a,a);const f=[0,0,0],_=[0,1,0,0];return i.ad.vec4.transformMat4(_,_,a),f[0]=_[0],f[1]=_[1],f[2]=_[2],i.ad.vec3.normalize(f,f),f}function Sv({width:p,height:r,anchor:a,textOffset:f,textScale:_},v){const{horizontalAlign:S,verticalAlign:R}=i.bD(a),D=-(S-.5)*p,N=-(R-.5)*r,z=i.bC(a,f);return new i.P((D/_+z[0])*v,(N/_+z[1])*v)}function mo(p,r,a,f,_,v,S,R,D,N,z){const B=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,se={},te=p.getProjection(),ae=Hs(R,te,v),ce=v.elevation,_e=te.upVectorScale(R.canonical,v.center.lat,v.worldSize).metersToTile;V.clear();for(let be=0;be<B.length;be++){const xe=B.get(be),{tileAnchorX:Ae,tileAnchorY:Se,numGlyphs:Te}=xe,Ee=xe.hidden||!xe.crossTileID||p.allowVerticalPlacement&&!xe.placedOrientation?null:f[xe.crossTileID];if(Ee){let Re=0,Ne=0,nt=0;if(ce){const lt=ce?ce.getAtTileOffset(R,Ae,Se):0,[_t,it,vt]=te.upVector(R.canonical,Ae,Se);Re=lt*_t*_e,Ne=lt*it*_e,nt=lt*vt*_e}let[We,pt,gt,Ct]=Ro(xe.projectedAnchorX+Re,xe.projectedAnchorY+Ne,xe.projectedAnchorZ+nt,a?ae:S);const Ge=Cc(v.getCameraToCenterDistance(te),Ct);let ft=_.evaluateSizeForFeature(p.textSizeData,N,xe)*Ge/i.bw;a&&(ft*=p.tilePixelRatio/D);const Ve=Sv(Ee,ft);a?({x:We,y:pt,z:gt}=te.projectTilePoint(Ae+Ve.x,Se+Ve.y,R.canonical),[We,pt,gt]=Ro(We+Re,pt+Ne,gt+nt,S)):(r&&Ve._rotate(-v.angle),We+=Ve.x,pt+=Ve.y,gt=0);const ht=p.allowVerticalPlacement&&xe.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let lt=0;lt<Te;lt++)i.bt(V,We,pt,gt,ht);z&&xe.associatedIconIndex>=0&&(se[xe.associatedIconIndex]={x:We,y:pt,z:gt,angle:ht})}else ko(Te,V)}if(z){X.clear();const be=p.icon.placedSymbolArray;for(let xe=0;xe<be.length;xe++){const Ae=be.get(xe),{numGlyphs:Se}=Ae,Te=se[xe];if(Ae.hidden||!Te)ko(Se,X);else{const{x:Ee,y:Re,z:Ne,angle:nt}=Te;for(let We=0;We<Se;We++)i.bt(X,Ee,Re,Ne,nt)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function _n(p,r,a,f,_,v,S={}){const R=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),N=a.paint.get("icon-translate-anchor"),z=a.paint.get("text-translate-anchor"),B=a.layout.get("icon-rotation-alignment"),V=a.layout.get("text-rotation-alignment"),X=a.layout.get("icon-pitch-alignment"),se=a.layout.get("text-pitch-alignment"),te=a.layout.get("icon-keep-upright"),ae=a.layout.get("text-keep-upright"),ce=a.paint.get("icon-color-saturation"),_e=a.paint.get("icon-color-contrast"),be=a.paint.get("icon-color-brightness-min"),xe=a.paint.get("icon-color-brightness-max"),Ae=a.layout.get("symbol-elevation-reference")==="sea",Se=p.context,Te=Se.gl,Ee=p.transform,Re=B==="map",Ne=V==="map",nt=X==="map",We=se==="map",pt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let gt=!1;const Ct=p.depthModeForSublayer(0,Jt.ReadOnly),Ge=[i.av(Ee.center.lng),i.aC(Ee.center.lat)],ft=a.layout.get("text-variable-anchor"),Ve=Ee.projection.name==="globe",ht=[],lt=[0,-1,0];for(const _t of f){const it=r.getTile(_t),vt=it.getBucket(a);if(!vt||vt.projection.name==="mercator"&&Ve||vt.fullyClipped)continue;const Lt=vt.projection.name==="globe",Nt=Lt?i.ag(Ee.zoom):0,Ot=Hs(_t,vt.getProjection(),Ee),Zt=Ee.calculatePixelsToTileUnitsMatrix(it),gr=ft&&vt.hasTextData(),nr=vt.hasIconTextFit()&&gr&&vt.hasIconData(),hr=vt.getProjection().createInversionMatrix(Ee,_t.canonical),lr=ln=>{Ee.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||p.terrain)&&(ln.push("DEPTH_D24"),ln.push("DEPTH_OCCLUSION"))},Fr=()=>{const ln=Re&&a.layout.get("symbol-placement")!=="point",Zr=[];lr(Zr);const $n=ln||nr,ei=a.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&nt&&Zr.push("PITCH_WITH_MAP_TERRAIN"),Lt&&(Zr.push("PROJECTION_GLOBE_VIEW"),$n&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),ei>0&&Zr.push("ICON_TRANSITION"),vt.icon.zOffsetVertexBuffer&&Zr.push("Z_OFFSET"),ce===0&&_e===0&&be===0&&xe===1||Zr.push("COLOR_ADJUSTMENT"),vt.sdfIcons&&Zr.push("RENDER_SDF");const di=vt.icon.programConfigurations.get(a.id),yi=p.getOrCreateProgram("symbol",{config:di,defines:Zr}),Ys=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],ns=vt.iconSizeData,Gr=i.bp(ns,Ee.zoom),Dn=nt||Ee.pitch!==0,tn=ya(Ot,it.tileID.canonical,nt,Re,Ee,vt.getProjection(),Zt),pn=Xn(Ot,it.tileID.canonical,nt,Re,Ee,vt.getProjection(),Zt),Bi=p.translatePosMatrix(pn,it,R,N,!0),Mn=p.translatePosMatrix(Ot,it,R,N),hi=$n?Gc:tn,ia=Re&&!nt&&!ln;let Ns=lt;!Ve&&!Ee.mercatorFromTransition||Re||(Ns=bf(Ee));const yo=Lt?Ns:lt,Ts=a.getColorAdjustmentMatrix(ce,_e,be,xe),vo=yf(ns.kind,Gr,ia,nt,p,Mn,hi,Bi,Ae,!1,Ys,[0,0],!0,_t,Nt,Ge,hr,yo,vt.getProjection(),Ts,ei),Os=it.imageAtlasTexture?it.imageAtlasTexture:null,Ra=a.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear,sa=vt.sdfIcons||p.options.rotating||p.options.zooming||Ra||Dn?Te.LINEAR:Te.NEAREST,ka=vt.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,kg=p.terrain&&nt&&ln?i.ad.mat4.invert(i.ad.mat4.create(),tn):Gc;if(ln&&vt.icon){const iu=Ee.elevation,Ff=iu?iu.getAtTileOffsetFunc(_t,Ee.center.lat,Ee.worldSize,vt.getProjection()):null,Dg=$i(Ot,it.tileID.canonical,nt,Re,Ee,vt.getProjection(),Zt);Ac(vt,Ot,p,!1,Dg,pn,nt,te,Ff,_t)}return{program:yi,buffers:vt.icon,uniformValues:vo,atlasTexture:Os,atlasTextureIcon:null,atlasInterpolation:sa,atlasInterpolationIcon:null,isSDF:vt.sdfIcons,hasHalo:ka,tile:it,labelPlaneMatrixInv:kg}},en=()=>{const ln=Ne&&a.layout.get("symbol-placement")!=="point",Zr=[],$n=ln||ft||nr;p.terrainRenderModeElevated()&&We&&Zr.push("PITCH_WITH_MAP_TERRAIN"),Lt&&(Zr.push("PROJECTION_GLOBE_VIEW"),$n&&Zr.push("PROJECTED_POS_ON_VIEWPORT")),vt.text.zOffsetVertexBuffer&&Zr.push("Z_OFFSET"),vt.iconsInText&&Zr.push("RENDER_TEXT_AND_SYMBOL"),Zr.push("RENDER_SDF"),lr(Zr);const ei=vt.text.programConfigurations.get(a.id),di=p.getOrCreateProgram("symbol",{config:ei,defines:Zr});let yi,Ys=[0,0],ns=null;const Gr=vt.textSizeData;vt.iconsInText&&(Ys=it.imageAtlasTexture?it.imageAtlasTexture.size:[0,0],ns=it.imageAtlasTexture?it.imageAtlasTexture:null,yi=We||Ee.pitch!==0||p.options.rotating||p.options.zooming||Gr.kind==="composite"||Gr.kind==="camera"?Te.LINEAR:Te.NEAREST);const Dn=it.glyphAtlasTexture?it.glyphAtlasTexture.size:[0,0],tn=a.layout.get("text-size-scale-range"),pn=i.ay(p.scaleFactor,tn[0],tn[1]),Bi=i.bp(Gr,Ee.zoom,pn),Mn=ya(Ot,it.tileID.canonical,We,Ne,Ee,vt.getProjection(),Zt),hi=Xn(Ot,it.tileID.canonical,We,Ne,Ee,vt.getProjection(),Zt),ia=p.translatePosMatrix(hi,it,D,z,!0),Ns=p.translatePosMatrix(Ot,it,D,z),yo=$n?Gc:Mn,Ts=Ne&&!We&&!ln;let vo=lt;!Ve&&!Ee.mercatorFromTransition||Ne||(vo=bf(Ee));const Os=yf(Gr.kind,Bi,Ts,We,p,Ns,yo,ia,Ae,!0,Dn,Ys,!0,_t,Nt,Ge,hr,Lt?vo:lt,vt.getProjection(),null,null,pn),Ra=it.glyphAtlasTexture?it.glyphAtlasTexture:null,sa=Te.LINEAR,ka=a.paint.get("text-halo-width").constantOr(1)!==0,kg=p.terrain&&We&&ln?i.ad.mat4.invert(i.ad.mat4.create(),Mn):Gc;if(ln&&vt.text){const iu=Ee.elevation,Ff=iu?iu.getAtTileOffsetFunc(_t,Ee.center.lat,Ee.worldSize,vt.getProjection()):null,Dg=$i(Ot,it.tileID.canonical,We,Ne,Ee,vt.getProjection(),Zt);Ac(vt,Ot,p,!0,Dg,hi,We,ae,Ff,_t)}return{program:di,buffers:vt.text,uniformValues:Os,atlasTexture:Ra,atlasTextureIcon:ns,atlasInterpolation:sa,atlasInterpolationIcon:yi,isSDF:!0,hasHalo:ka,tile:it,labelPlaneMatrixInv:kg}},xn=vt.icon.segments.get().length,Pr=vt.text.segments.get().length,kn=xn&&!S.onlyText?Fr():null,xr=Pr&&!S.onlyIcons?en():null,Xt=a.paint.get("icon-opacity").constantOr(1),Vr=a.paint.get("text-opacity").constantOr(1);if(pt&&vt.canOverlap){gt=!0;const ln=Xt&&!S.onlyText?vt.icon.segments.get():[],Zr=Vr&&!S.onlyIcons?vt.text.segments.get():[];for(const $n of ln)ht.push({segments:new i.b8([$n]),sortKey:$n.sortKey,state:kn});for(const $n of Zr)ht.push({segments:new i.b8([$n]),sortKey:$n.sortKey,state:xr})}else S.onlyText||ht.push({segments:Xt?vt.icon.segments:new i.b8([]),sortKey:0,state:kn}),S.onlyIcons||ht.push({segments:Vr?vt.text.segments:new i.b8([]),sortKey:0,state:xr})}gt&&ht.sort((_t,it)=>_t.sortKey-it.sortKey);for(const _t of ht){const it=_t.state;if(it)if(p.terrain?p.terrain.setupElevationDraw(it.tile,it.program,{useDepthForOcclusion:Ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:it.labelPlaneMatrixInv}):p.setupDepthForOcclusion(Ee.depthOcclusionForSymbolsAndCircles,it.program),Se.activeTexture.set(Te.TEXTURE0),it.atlasTexture&&it.atlasTexture.bind(it.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),it.atlasTextureIcon&&(Se.activeTexture.set(Te.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,it.program),it.hasHalo){const vt=it.uniformValues;vt.u_is_halo=1,qc(it.buffers,_t.segments,a,p,it.program,Ct,_,v,vt,2),vt.u_is_halo=0}else{if(it.isSDF){const vt=it.uniformValues;it.hasHalo&&(vt.u_is_halo=1,qc(it.buffers,_t.segments,a,p,it.program,Ct,_,v,vt,1)),vt.u_is_halo=0}qc(it.buffers,_t.segments,a,p,it.program,Ct,_,v,it.uniformValues,1)}}}function qc(p,r,a,f,_,v,S,R,D,N){const z=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,v,S,R,mr.disabled,D,a.id,p.layoutVertexBuffer,p.indexBuffer,r,a.paint,f.transform.zoom,p.programConfigurations.get(a.id),z,N)}function ag(p,r){const a=1<<p.canonical.z,f=(r.x*a-p.canonical.x-p.wrap*a)*i.ai,_=(r.y*a-p.canonical.y)*i.ai,v=i.d5(r.z,r.y);return i.ad.vec3.fromValues(f,_,v)}function lg(p,r,a,f,_){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const v=p.context.gl,S=new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D),R=new Jt(p.context.gl.GREATER,Jt.ReadWrite,p.depthRangeFor3D),D=function(X){const se=i.c4(X.pitch);let te=.01;return X.isOrthographic&&(te=i.ah(1e-4,te,i.c9(se>=Rt?1:se/Rt))),2*te}(p.transform),N=p.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",B=p.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),V=p.getOrCreateProgram(z);for(const X of f){const se=r.getTile(X),te=se.getBucket(a);if(!te)continue;const ae=te.elevatedStructures;if(!ae)continue;const ce=te.elevationBufferData.heightRange,_e=ag(X.toUnwrapped(),N),be=p.translatePosMatrix(X.projMatrix,se,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let xe,Ae,Se,Te;if(_==="initialize"){if(!ce||ce.min>=1||ae.depthSegments.segments[0].primitiveLength===0)continue;xe=Pd(be,_e,D,1,0),Ae=S,Se=ae.depthSegments,Te=B}else if(_==="reset"){if(!ce||ce.min>=0||ae.maskSegments.segments[0].primitiveLength===0)continue;xe=Pd(be,_e,0,0,1),Ae=R,Se=ae.maskSegments,Te=B}else if(_==="geometry"){if(ae.depthSegments.segments[0].primitiveLength===0)continue;xe=Pd(be,_e,D,1,0),Ae=S,Se=ae.depthSegments,Te=V}Te.draw(p,v.TRIANGLES,Ae,vr.disabled,kr.disabled,mr.disabled,xe,a.id,ae.vertexBuffer,ae.indexBuffer,Se,a.paint,p.transform.zoom)}}function wf(p,r,a){const{painter:f,sourceCache:_,layer:v,coords:S,colorMode:R,elevationType:D,terrainEnabled:N,pass:z}=p,B=f.context.gl,V=v.paint.get("fill-pattern");let X=D;D!=="road"||r&&!N||(X="none");const se=X==="road",te=new Jt(f.context.gl.LEQUAL,Jt.ReadWrite,f.depthRangeFor3D),ae=V&&V.constantOr(1),ce=(_e,be)=>{let xe,Ae,Se,Te,Ee;be?(Ae=ae&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",xe=B.LINES):(Ae=ae?"fillPattern":"fill",xe=B.TRIANGLES);for(const Re of S){const Ne=_.getTile(Re);if(ae&&!Ne.patternsLoaded())continue;const nt=Ne.getBucket(v);if(!nt)continue;const We=r?nt.elevationBufferData:nt.bufferData;if(We.isEmpty())continue;f.prepareDrawTile();const pt=We.programConfigurations.get(v.id),gt=f.isTileAffectedByFog(Re),Ct=[],Ge=[];se&&(Ct.push("ELEVATED_ROADS"),Ge.push(We.elevatedLayoutVertexBuffer));const ft=f.getOrCreateProgram(Ae,{config:pt,overrideFog:gt,defines:Ct});ae&&(f.context.activeTexture.set(B.TEXTURE0),Ne.imageAtlasTexture&&Ne.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),pt.updatePaintBuffers());const Ve=V.constantOr(null);if(Ve&&Ne.imageAtlas){const _t=Ne.imageAtlas,it=i.d0.from(Ve).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),vt=_t.patternPositions.get(it);vt&&pt.setConstantPatternPositions(vt)}const ht=f.translatePosMatrix(Re.projMatrix,Ne,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor")),lt=v.paint.get("fill-emissive-strength");if(be){Te=We.lineIndexBuffer,Ee=We.lineSegments;const _t=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Se=Ae==="fillOutlinePattern"&&ae?gf(ht,lt,f,Ne,_t):mf(ht,lt,_t)}else Te=We.indexBuffer,Ee=We.triangleSegments,Se=ae?Jm(ht,lt,f,Ne):Vc(ht,lt);f.uploadCommonUniforms(f.context,ft,Re.toUnwrapped()),ft.draw(f,xe,X!=="none"?te:_e,a||f.stencilModeForClipping(Re),R,mr.disabled,Se,v.id,We.layoutVertexBuffer,Te,Ee,v.paint,f.transform.zoom,pt,Ge)}};f.renderPass===z&&ce(f.depthModeForSublayer(1,f.renderPass==="opaque"?Jt.ReadWrite:Jt.ReadOnly),!1),X==="none"&&f.renderPass==="translucent"&&v.paint.get("fill-antialias")&&ce(f.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,Jt.ReadOnly),!0)}function kd(p,r,a,f,_,v,S,R){a.resetLayerRenderingStats(p);const D=p.context,N=D.gl,z=p.transform,B=a.paint.get("fill-extrusion-pattern"),V=B.constantOr(1),X=a.paint.get("fill-extrusion-opacity"),se=p.style.enable3dLights(),te=a.paint.get(se&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],ce=a.layout.get("fill-extrusion-edge-radius"),_e=ce>0&&!a.paint.get("fill-extrusion-rounded-roof"),be=_e?0:ce,xe=z.projection.name==="globe"?i.d6():0,Ae=z.projection.name==="globe",Se=Ae?i.ag(z.zoom):0,Te=[i.av(z.center.lng),i.aC(z.center.lat)],Ee=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Re=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ee?null:a.lut).toArray01().slice(0,3),Ne=a.paint.get("fill-extrusion-flood-light-intensity"),nt=a.paint.get("fill-extrusion-vertical-scale"),We=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=a.paint.get("fill-extrusion-height-alignment"),gt=a.paint.get("fill-extrusion-base-alignment"),Ct=Sa(p,a.paint.get("fill-extrusion-cutoff-fade-range")),Ge=[];let ft;Ae&&Ge.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Ge.push("FAUX_AO"),_e&&Ge.push("ZERO_ROOF_RADIUS"),R&&Ge.push("HAS_CENTROID"),Ne>0&&Ge.push("FLOOD_LIGHT"),Ct.shouldRenderCutoff&&Ge.push("RENDER_CUTOFF"),We&&Ge.push("RENDER_WALL_MODE");const Ve=p.renderPass==="shadow",ht=p.shadowRenderer,lt=Ve&&!!ht;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let _t=[0,0,0];if(ht){const Lt=p.style.directionalLight,Nt=p.style.ambientLight;Lt&&Nt&&(_t=Dc(p.style,Lt,Nt)),Ve||(Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ht.useNormalOffset&&Ge.push("NORMAL_OFFSET")),ft=Ge.concat(["SHADOWS_SINGLE_CASCADE"])}const it=lt?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",vt=a.getLayerRenderingStats();for(const Lt of f){const Nt=r.getTile(Lt),Ot=Nt.getBucket(a);if(!Ot||Ot.projection.name!==z.projection.name)continue;let Zt=!1;ht&&(Zt=ht.getMaxCascadeForTile(Lt.toUnwrapped())===0);const gr=p.isTileAffectedByFog(Lt),nr=Ot.programConfigurations.get(a.id),hr=p.getOrCreateProgram(it,{config:nr,defines:Zt?ft:Ge,overrideFog:gr});if(p.terrain&&p.terrain.setupElevationDraw(Nt,hr,{useMeterToDem:!0}),!Ot.centroidVertexBuffer){const xr=hr.attributes.a_centroid_pos;xr!==void 0&&N.vertexAttrib2f(xr,0,0)}!Ve&&ht&&ht.setupShadows(Nt.tileID.toUnwrapped(),hr,"vector-tile",Nt.tileID.overscaledZ),V&&(p.context.activeTexture.set(N.TEXTURE0),Nt.imageAtlasTexture&&Nt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),nr.updatePaintBuffers());const lr=B.constantOr(null);if(lr&&Nt.imageAtlas){const xr=Nt.imageAtlas,Xt=i.d0.from(lr).getPrimary().scaleSelf(i.q.devicePixelRatio),Vr=xr.patternPositions.get(Xt.toString());Vr&&nr.setConstantPatternPositions(Vr)}const Fr=a.paint.get("fill-extrusion-vertical-gradient"),en=1/Ot.tileToMeter;let xn;if(Ve&&ht){if(Xc(Nt.tileID,Ot,p))continue;const xr=ht.calculateShadowPassMatrixFromTile(Nt.tileID.toUnwrapped());xn=Uc(xr,be,en,nt,pt,gt)}else{const xr=p.translatePosMatrix(Lt.expandedProjMatrix,Nt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xt=z.projection.createInversionMatrix(z,Lt.canonical);xn=V?Ym(xr,p,Fr,X,ae,be,en,Lt,Nt,xe,pt,gt,Se,Te,Xt,Re,nt):pf(xr,p,Fr,X,ae,be,en,Lt,xe,pt,gt,Se,Te,Xt,Re,nt,Ne,_t)}p.uploadCommonUniforms(D,hr,Lt.toUnwrapped(),null,Ct);let Pr=Ot.segments;if(z.projection.name==="mercator"&&!Ve&&(Pr=Ot.getVisibleSegments(Nt.tileID,p.terrain,p.transform.getFrustum(0)),!Pr.get().length))continue;if(vt)if(Ve)for(const xr of Pr.get())vt.numRenderedVerticesInShadowPass+=xr.primitiveLength;else for(const xr of Pr.get())vt.numRenderedVerticesInTransparentPass+=xr.primitiveLength;const kn=[];(p.terrain||R)&&kn.push(Ot.centroidVertexBuffer),Ae&&kn.push(Ot.layoutVertexExtBuffer),We&&kn.push(Ot.wallVertexBuffer),hr.draw(p,D.gl.TRIANGLES,_,v,S,mr.backCCW,xn,a.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Pr,a.paint,p.transform.zoom,nr,kn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function Hc(p,r,a,f,_,v,S,R,D,N,z,B,V,X,se,te,ae,ce,_e){const be=p.context,xe=be.gl,Ae=p.transform,Se=p.transform.zoom,Te=[],Ee=Sa(p,a.paint.get("fill-extrusion-cutoff-fade-range"));N==="clear"?(Te.push("CLEAR_SUBPASS"),_e&&(Te.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(xe.TEXTURE0),_e.bind(xe.LINEAR,xe.CLAMP_TO_EDGE))):N==="sdf"&&Te.push("SDF_SUBPASS"),ae&&Te.push("HAS_CENTROID"),Ee.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const Re=a.layout.get("fill-extrusion-edge-radius"),Ne=(nt,We,pt,gt,Ct)=>{const Ge=We.programConfigurations.get(a.id),ft=p.isTileAffectedByFog(nt),Ve=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ge,defines:Te,overrideFog:ft}),ht=((_t,it,vt,Lt,Nt,Ot,Zt,gr,nr,hr,lr)=>({u_matrix:it,u_opacity:vt,u_ao_pass:Lt?1:0,u_meter_to_tile:Nt,u_ao:Ot,u_flood_light_intensity:Zt,u_flood_light_color:gr,u_attenuation:nr,u_edge_radius:hr,u_fb:0,u_fb_size:lr,u_dynamic_offset:1}))(0,gt,z,D,Ct,[B,V*Ct],X,se,te,Se>=17?0:Re*Ct,_e?_e.size[0]:0),lt=[];ae&&lt.push(We.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(be,Ve,nt.toUnwrapped(),null,Ee),Ve.draw(p,be.gl.TRIANGLES,_,v,S,R,ht,a.id,We.vertexBuffer,We.indexBuffer,pt,a.paint,Se,Ge,lt)};for(const nt of f){const We=r.getTile(nt),pt=We.getBucket(a);if(!pt||pt.projection.name!==Ae.projection.name||!pt.groundEffect||pt.groundEffect&&!pt.groundEffect.hasData())continue;const gt=pt.groundEffect,Ct=1/pt.tileToMeter;{const Ge=p.translatePosMatrix(nt.projMatrix,We,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ft=gt.getDefaultSegment();Ne(nt,gt,ft,Ge,Ct)}if(ce)for(let Ge=0;Ge<4;Ge++){const ft=i.d7[Ge](nt),Ve=r.getTile(ft);if(!Ve)continue;const ht=Ve.getBucket(a);if(!ht||ht.projection.name!==Ae.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const lt=ht.groundEffect;let _t,it;Ge===0?(_t=[-i.ai,0,0],it=1):Ge===1?(_t=[i.ai,0,0],it=0):Ge===2?(_t=[0,-i.ai,0],it=3):(_t=[0,i.ai,0],it=2);const vt=lt.regionSegments[it];if(!vt)continue;const Lt=new Float32Array(16);i.ad.mat4.translate(Lt,nt.projMatrix,_t),Ne(nt,lt,vt,p.translatePosMatrix(Lt,We,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function Wc(p,r,a,f,_,v,S){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const R=v?v.findDEMTileFor(a):null;if(!(R&&R.dem||S))return;v&&R&&R.dem&&f.selfDEMTileTimestamp!==R.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=R.dem._timestamp);const D=ce=>new i.P(Math.ceil((ce+i.da)*i.db),0),N=ce=>{const _e=r.getSource().minzoom,be=Ae=>{const Se=r.getTileByID(Ae);if(Se&&Se.hasData())return Se.getBucket(_)},xe=[0,-1,1];for(const Ae of xe){if(ce.overscaledZ+Ae<_e)continue;const Se=be(ce.calculateScaledKey(ce.overscaledZ+Ae));if(Se)return Se}},z=[0,0,0],B=(ce,_e)=>(z[0]=Math.min(ce.min.y,_e.min.y),z[1]=Math.max(ce.max.y,_e.max.y),z[2]=i.ai-_e.min.x>ce.max.x?_e.min.x-i.ai:ce.max.x,z),V=(ce,_e)=>(z[0]=Math.min(ce.min.x,_e.min.x),z[1]=Math.max(ce.max.x,_e.max.x),z[2]=i.ai-_e.min.y>ce.max.y?_e.min.y-i.ai:ce.max.y,z),X=[(ce,_e)=>B(ce,_e),(ce,_e)=>B(_e,ce),(ce,_e)=>V(ce,_e),(ce,_e)=>V(_e,ce)],se=(ce,_e,be,xe,Ae,Se,Te)=>{if(!v)return 0;const Ee=[[Se?be:ce,Se?ce:be,0],[Se?be:_e,Se?_e:be,0]],Re=Te<0?i.ai+Te:Te,Ne=[Se?Re:(ce+_e)/2,Se?(ce+_e)/2:Re,0];return be===0&&Te<0||be!==0&&Te>0?v.getForTilePoints(Ae,[Ne],!0,xe):Ee.push(Ne),v.getForTilePoints(a,Ee,!0,R),Math.max(Ee[0][2],Ee[1][2],Ne[2])/v.exaggeration()};for(let ce=0;ce<4;ce++){const _e=f.borderFeatureIndices[ce];if(_e.length===0)continue;const be=i.d7[ce](a),xe=N(be);if(!(xe&&xe instanceof i.d8))continue;const Ae=v?v.findDEMTileFor(be):null;if(!(Ae&&Ae.dem||S)||(v&&Ae&&Ae.dem&&f.borderDEMTileTimestamp[ce]!==Ae.dem._timestamp&&(f.borderDoneWithNeighborZ[ce]=-1,f.borderDEMTileTimestamp[ce]=Ae.dem._timestamp),f.borderDoneWithNeighborZ[ce]===xe.canonical.z))continue;xe.centroidVertexArray.length===0&&xe.createCentroidsBuffer();const Se=(ce<2?1:5)-ce,Te=xe.borderDoneWithNeighborZ[Se]!==f.canonical.z,Ee=xe.borderFeatureIndices[Se];let Re=0;if(f.canonical.z!==xe.canonical.z){for(const Ne of _e)f.showCentroid(f.featuresOnBorder[Ne]);if(Te)for(const Ne of Ee)xe.showCentroid(xe.featuresOnBorder[Ne]);f.borderDoneWithNeighborZ[ce]=xe.canonical.z,xe.borderDoneWithNeighborZ[Se]=f.canonical.z}for(const Ne of _e){const nt=f.featuresOnBorder[Ne],We=f.centroidData[nt.centroidDataIndex],pt=nt.borders[ce];let gt;for(;Re<Ee.length;){gt=xe.featuresOnBorder[Ee[Re]];const Ct=gt.borders[Se];if(Ct[1]>pt[0]+3||Ct[0]>pt[0]-3)break;xe.showCentroid(gt),Re++}if(gt&&Re<Ee.length){const Ct=Re;let Ge=0;for(;!(gt.borders[Se][0]>pt[1]-3)&&(Ge++,++Re!==Ee.length);)gt=xe.featuresOnBorder[Ee[Re]];gt=xe.featuresOnBorder[Ee[Ct]];let ft=!1;if(Ge>=1){const lt=gt.borders[Se];Math.abs(pt[0]-lt[0])<3&&Math.abs(pt[1]-lt[1])<3&&(Ge=1,ft=!0,Re=Ct+1)}else if(Ge===0){f.showCentroid(nt);continue}const Ve=xe.centroidData[gt.centroidDataIndex];S&&ft&&(((te=We).flags|(ae=Ve).flags)&i.d9?(te.flags|=i.d9,ae.flags|=i.d9):(te.flags&=~i.d9,ae.flags&=~i.d9));const ht=nt.intersectsCount()>1||gt.intersectsCount()>1;if(Ge>1)Re=Ct,We.centroidXY=Ve.centroidXY=new i.P(0,0);else if(Ae&&Ae.dem&&!ht){const lt=X[ce](We,Ve),_t=ce%2?i.ai-1:0,it=se(lt[0],Math.min(i.ai-1,lt[1]),_t,Ae,be,ce<2,lt[2]);We.centroidXY=Ve.centroidXY=D(it)}else ht?We.centroidXY=Ve.centroidXY=new i.P(0,0):(We.centroidXY=f.encodeBorderCentroid(nt),Ve.centroidXY=xe.encodeBorderCentroid(gt));f.writeCentroidToBuffer(We),xe.writeCentroidToBuffer(Ve)}else f.showCentroid(nt)}f.borderDoneWithNeighborZ[ce]=xe.canonical.z,xe.borderDoneWithNeighborZ[Se]=f.canonical.z}var te,ae;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}const Zc=[1,0,0],It=[0,1,0],Ft=[0,0,1];function Xc(p,r,a){const f=a.transform,_=a.shadowRenderer;if(!_)return!0;const v=p.toUnwrapped(),S=f.tileSize*_._cascades[a.currentShadowCascade].scale;let R=r.maxHeight;if(f.elevation){const te=f.elevation.getMinMaxForTile(p);te&&(R+=te.max)}const D=[..._.shadowDirection];D[2]=-D[2];const N=_.computeSimplifiedTileShadowVolume(v,R,S,D);if(!N)return!1;const z=[Zc,It,Ft,D,[D[0],0,D[2]],[0,D[1],D[2]]],B=f.projection.name==="globe",V=f.scaleZoom(S),X=i.bR.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,V,!B),se=_.getCurrentCascadeFrustum();return X.intersectsPrecise(N.vertices,N.planes,z)===0||se.intersectsPrecise(N.vertices,N.planes,z)===0}function Fn(p){return[p[0]*i.dc,p[1]*i.dc,p[2]*i.dc,0]}function Ye(p,r,a,f,_,v,S,R,D){const N=f.getSource(),z=a.globeSharedBuffers;if(!z)return;let B,V,X;if(r&&(B=f.getTile(r)),N instanceof i.aK?(V=N.texture,X=i.cJ(0,0,a.transform)):B&&r&&(V=B.texture,X=i.cJ(r.canonical.z,r.canonical.x,a.transform)),!V||!X)return;p||(X=i.ad.mat4.scale(i.ad.mat4.create(),X,[1,-1,1]));const se=a.context,te=se.gl,ae=_.paint.get("raster-resampling")==="nearest"?te.NEAREST:te.LINEAR,ce=a.colorModeForDrapableLayerRenderPass(v),_e=S.defines;_e.push("GLOBE_POLES");const be=new Jt(te.LEQUAL,Jt.ReadWrite,a.depthRangeFor3D),xe=Float32Array.from(a.transform.expandedFarZProjMatrix),Ae=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),se.activeTexture.set(te.TEXTURE0),V.bind(ae,te.CLAMP_TO_EDGE),se.activeTexture.set(te.TEXTURE1),V.bind(ae,te.CLAMP_TO_EDGE),"useMipmap"in V&&se.extTextureFilterAnisotropic&&a.transform.pitch>20&&te.texParameterf(te.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Se,Te,Ee,Re]=r?z.getPoleBuffers(r.canonical.z,!1):z.getPoleBuffers(0,!0),Ne=_.paint.get("raster-elevation");let nt;p?(nt=Se,a.renderDefaultNorthPole=Ne!==0):(nt=Te,a.renderDefaultSouthPole=Ne!==0);const We=Fn(S.mix),pt=((Ct,Ge,ft,Ve,ht,lt,_t,it,vt,Lt,Nt,Ot,Zt)=>eg(Ct,Ge,ft,new Float32Array(16),new Float32Array(9),[0,0],Ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},lt,[0,0],it,2,Lt,Nt,Ot,1,0,Zt))(xe,Ae,X,i.ag(a.transform.zoom),0,_,0,Ne,0,We,S.offset,S.range,v),gt=a.getOrCreateProgram("raster",{defines:_e});a.uploadCommonUniforms(se,gt,null),gt.draw(a,te.TRIANGLES,be,D,ce,R,pt,_.id,nt,Ee,Re)}function Tv(p){const r=p._nearZ,a=p.projection.farthestPixelDistance(p),f=a-r,_=.2*p.height,v=r+_;return[r,a,(v-_-r)/f,(v-r)/f]}function Sf(p,r,a,f){if(p)return r instanceof ga&&p instanceof ws?r.getTextureDescriptor(p,a,!0):{texture:p.texture,mix:Fn(f.mix),offset:f.offset,buffer:0,tileSize:1}}var cg=i.dd([{name:"a_index",type:"Int16",components:1}]);class ug{constructor(r,a,f,_){const v={width:f[0],height:f[1],data:null},S=r.gl;this.targetColorTexture=new i.T(r,v,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,v,S.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(a,_),this.lastInvalidatedAt=0}updateParticleTexture(r,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=a.width*a.height;this.particleTexture0=new i.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1});const v=new i.de;v.reserve(_);for(let S=0;S<_;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,cg.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ev(p,r,a){if(!p)return null;const f=r.getTextureDescriptor(p,a,!0);if(!f)return null;let{texture:_,mix:v,offset:S,tileSize:R,buffer:D,format:N}=f;if(!_||!N)return null;let z=!1;return N==="uint32"&&(z=!0,v[3]=0,v=Bt(i.df,v,[0,a.paint.get("raster-particle-max-speed")]),S=Qm(i.df,S,[0,a.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[D/(R+2*D),R/(R+2*D)],tileSize:R,scalarData:z,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function Cv(p){const r=p._nearZ,a=p.projection.farthestPixelDistance(p),f=a-r,_=.2*p.height,v=r+_;return[r,a,(v-_-r)/f,(v-r)/f]}const Kc=new i.al(1,0,0,1),Xb=new i.al(0,1,0,1),Kb=new i.al(0,0,1,1),Av=new i.al(1,0,1,1),Tf=new i.al(0,1,1,1);function fl(p,r,a,f,_,v,S){const R=p.context,D=p.transform,N=R.gl,z=D.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[];let V=i.ad.mat4.clone(a.projMatrix);if(z&&i.ag(D.zoom)>0){const We=i.bb(a.canonical,D),pt=i.dg(We);V=i.ad.mat4.multiply(new Float32Array(16),D.globeMatrix,pt),i.ad.mat4.multiply(V,D.projMatrix,V)}const X=i.ad.mat4.create();X[12]+=2*_/(i.q.devicePixelRatio*D.width),X[13]+=2*v/(i.q.devicePixelRatio*D.height),i.ad.mat4.multiply(V,X,V);const se=p.getOrCreateProgram("debug",{defines:B}),te=r.getTileByID(a.key);p.terrain&&p.terrain.setupElevationDraw(te,se);const ae=Jt.disabled,ce=vr.disabled,_e=p.colorModeForRenderPass(),be="$debug";R.activeTexture.set(N.TEXTURE0),p.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),z?te._makeGlobeTileDebugBuffers(p.context,D):te._makeDebugTileBoundsBuffers(p.context,D.projection);const xe=te._tileDebugBuffer||p.debugBuffer,Ae=te._tileDebugIndexBuffer||p.debugIndexBuffer,Se=te._tileDebugSegments||p.debugSegments;if(se.draw(p,N.LINE_STRIP,ae,ce,_e,mr.disabled,vv(V,f),be,xe,Ae,Se,null,null,null,[te._globeTileDebugBorderBuffer]),S){const We=te.latestRawTileData,pt=Math.floor((We&&We.byteLength||0)/1024);let gt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(gt+=` => ${a.overscaledZ}`),gt+=` ${te.state}`,gt+=` ${pt}kb`,function(Ct,Ge){Ct.initDebugOverlayCanvas();const ft=Ct.debugOverlayCanvas,Ve=Ct.context.gl,ht=Ct.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,ft.width,ft.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(Ge,5,5),ht.strokeText(Ge,5,5),Ct.debugOverlayTexture.update(ft),Ct.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(p,gt)}const Te=r.getTile(a).tileSize,Ee=512/Math.min(Te,512)*(a.overscaledZ/D.zoom)*.5,Re=te._tileDebugTextBuffer||p.debugBuffer,Ne=te._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,nt=te._tileDebugTextSegments||p.debugSegments;se.draw(p,N.TRIANGLES,ae,ce,kr.alphaBlended,mr.disabled,vv(V,i.al.transparent,Ee),be,Re,Ne,nt,null,null,null,[te._globeTileDebugTextBuffer])}function dg(p,r,a,f){Hl(p,0,r+a/2,p.transform.width,a,f)}function hg(p,r,a,f){Hl(p,r-a/2,0,a,p.transform.height,f)}function Hl(p,r,a,f,_,v){const S=p.context,R=S.gl;R.enable(R.SCISSOR_TEST),R.scissor(r*i.q.devicePixelRatio,a*i.q.devicePixelRatio,f*i.q.devicePixelRatio,_*i.q.devicePixelRatio),S.clear({color:v}),R.disable(R.SCISSOR_TEST)}const Ef=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Yc}=Ef;function Aa(p,r,a,f){p.emplaceBack(r,a,f)}class Mv{constructor(r){this.vertexArray=new i.dh,this.indices=new i.aV,Aa(this.vertexArray,-1,-1,1),Aa(this.vertexArray,1,-1,1),Aa(this.vertexArray,-1,1,1),Aa(this.vertexArray,1,1,1),Aa(this.vertexArray,-1,-1,-1),Aa(this.vertexArray,1,-1,-1),Aa(this.vertexArray,-1,1,-1),Aa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Yc),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function ki(p,r,a,f,_,v){const S=p.context.gl,R=r.paint.get("sky-atmosphere-color"),D=r.paint.get("sky-atmosphere-halo-color"),N=r.paint.get("sky-atmosphere-sun-intensity"),z=((B,V,X,se,te)=>({u_matrix_3f:B,u_sun_direction:V,u_sun_intensity:X,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),f),_,N,R,D);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),a.draw(p,S.TRIANGLES,Jt.disabled,vr.disabled,kr.unblended,mr.frontCW,z,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Yb=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Dd{constructor(r){const a=new i.di;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new i.aV;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(a,Yb.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wn=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Jr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Iv{constructor(r){this.colorModeAlphaBlendedWriteRGB=new kr([1,ll,1,ll],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new kr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new Jr,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const a=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Dd(a);const f=this.params.sizeRange,_=this.params.intensityRange,v=function(z){const B=i.dl(30),V=[];for(let X=0;X<z;++X){const se=2*Math.PI*B(),te=Math.acos(1-2*B())-.5*Math.PI;V.push(i.ad.vec3.fromValues(Math.cos(te)*Math.cos(se),Math.cos(te)*Math.sin(se),Math.sin(te)))}return V}(this.params.starsCount),S=i.dl(300),R=new i.dj,D=new i.aV;let N=0;for(let z=0;z<v.length;++z){const B=i.ad.vec3.scale([],v[z],200),V=Math.max(0,1+.01*f*(1*S()-.5)),X=Math.max(0,1+.01*_*(1*S()-.5));R.emplaceBack(B[0],B[1],B[2],-1,-1,V,X),R.emplaceBack(B[0],B[1],B[2],1,-1,V,X),R.emplaceBack(B[0],B[1],B[2],1,1,V,X),R.emplaceBack(B[0],B[1],B[2],-1,1,V,X),D.emplaceBack(N+0,N+1,N+2),D.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=a.createVertexBuffer(R,wn.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=i.b8.simpleSegment(0,0,R.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,a){const f=r.context,_=f.gl,v=r.transform,S=new Jt(_.LEQUAL,Jt.ReadOnly,[0,1]),R=i.ag(v.zoom),D=r.style.getLut(a.scope),N=a.properties.get("color-use-theme")==="none",z=a.properties.get("color").toRenderColor(N?null:D).toArray01(),B=a.properties.get("high-color-use-theme")==="none",V=a.properties.get("high-color").toRenderColor(B?null:D).toArray01(),X=a.properties.get("space-color-use-theme")==="none",se=a.properties.get("space-color").toRenderColor(X?null:D).toArray01PremultipliedAlpha(),te=5e-4,ae=i.dk(a.properties.get("horizon-blend"),0,1,te,.25),ce=i.cD(r,f,v)&&ae===te?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,_e=r.frameCounter/1e3%1,be=i.ad.vec3.length(v.globeCenterInViewSpace),xe=Math.sqrt(Math.pow(be,2)-Math.pow(ce,2)),Ae=Math.acos(xe/be),Se=Te=>{const Ee=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&Ee.push("ALPHA_PASS");const Re=r.getOrCreateProgram("globeAtmosphere",{defines:Ee}),Ne=((We,pt,gt,Ct,Ge,ft,Ve,ht,lt,_t,it,vt)=>({u_frustum_tl:We,u_frustum_tr:pt,u_frustum_br:gt,u_frustum_bl:Ct,u_horizon:Ge,u_transition:ft,u_fadeout_range:Ve,u_color:ht,u_high_color:lt,u_space_color:_t,u_temporal_offset:it,u_horizon_angle:vt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,R,ae,z,V,se,_e,Ae);r.uploadCommonUniforms(f,Re);const nt=this.atmosphereBuffer;nt&&Re.draw(r,_.TRIANGLES,S,vr.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mr.backCW,Ne,Te?"atmosphere_glow_alpha":"atmosphere_glow",nt.vertexBuffer,nt.indexBuffer,nt.segments)};Se(!1),Se(!0)}drawStars(r,a){const f=i.ay(a.properties.get("star-intensity"),0,1);if(f===0)return;const _=r.context,v=_.gl,S=r.transform,R=r.getOrCreateProgram("stars"),D=i.ad.quat.identity([]);i.ad.quat.rotateX(D,D,-S._pitch),i.ad.quat.rotateZ(D,D,-S.angle),i.ad.quat.rotateX(D,D,i.ak(S._center.lat)),i.ad.quat.rotateY(D,D,-i.ak(S._center.lng));const N=i.ad.mat4.fromQuat(new Float32Array(16),D),z=i.ad.mat4.multiply([],S.starsProjMatrix,N),B=i.ad.mat3.fromMat4([],N),V=i.ad.mat3.invert([],B),X=[0,1,0];i.ad.vec3.transformMat3(X,X,V),i.ad.vec3.scale(X,X,this.params.sizeMultiplier);const se=[1,0,0];i.ad.vec3.transformMat3(se,se,V),i.ad.vec3.scale(se,se,this.params.sizeMultiplier);const te=(ae=X,ce=se,_e=f,{u_matrix:Float32Array.from(z),u_up:ae,u_right:ce,u_intensity_multiplier:_e});var ae,ce,_e;r.uploadCommonUniforms(_,R),this.starsVx&&this.starsIdx&&R.draw(r,v.TRIANGLES,Jt.disabled,vr.disabled,this.colorModeAlphaBlendedWriteRGB,mr.disabled,te,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ma(p,r){const a=[...p],f=r.cameraWorldSizeForFog/r.worldSize,_=i.ad.mat4.identity([]);return i.ad.mat4.scale(_,_,[f,f,1]),i.ad.mat4.multiply(a,_,a),i.ad.mat4.multiply(a,r.worldToFogMatrix,a),a}function Jc(p,r,a,f,_){const v=a.material,S=f.context,{baseColorTexture:R,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:z,emissionTexture:B}=v;function V(se,te,ae){if(se&&(p.push(te),S.activeTexture.set(S.gl.TEXTURE0+ae),se.gfxTexture)){const{minFilter:ce,magFilter:_e,wrapS:be,wrapT:xe}=se.sampler;se.gfxTexture.bindExtraParam(ce,_e,be,xe)}}V(R,"HAS_TEXTURE_u_baseColorTexture",Hn.BaseColor),V(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Hn.MetallicRoughness),V(N,"HAS_TEXTURE_u_normalTexture",Hn.Normal),V(z,"HAS_TEXTURE_u_occlusionTexture",Hn.Occlusion),V(B,"HAS_TEXTURE_u_emissionTexture",Hn.Emission),_&&(_.texture||(_.texture=new i.dn(f.context,_.image,[_.image.height,_.image.height,_.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+Hn.LUT),_.texture&&_.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(a.texcoordBuffer)),a.colorBuffer&&(p.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(a.colorBuffer)),a.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(a.normalBuffer)),a.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(a.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||p.push("DIFFUSE_SHADED");const X=f.shadowRenderer;X&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&p.push("NORMAL_OFFSET"))}function Ia(p,r,a,f,_,v){const S=a.paint.get("model-opacity").constantOr(1),R=r.context,D=new Jt(r.context.gl.LEQUAL,Jt.ReadWrite,r.depthRangeFor3D),N=r.transform,z=p.mesh,B=z.material,V=B.pbrMetallicRoughness,X=r.style.fog;let se;se=r.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:i.ad.mat4.multiply([],f.zScaleMatrix,p.nodeModelMatrix),i.ad.mat4.multiply(se,f.negCameraPosMatrix,se);const te=i.ad.mat4.invert([],se);i.ad.mat4.transpose(te,te);const ae=a.paint.get("model-color-use-theme").constantOr("default")==="none",ce=a.paint.get("model-emissive-strength").constantOr(0),_e=ng(new Float32Array(p.worldViewProjection),new Float32Array(se),new Float32Array(te),null,r,S,V.baseColorFactor.toRenderColor(null),B.emissiveFactor,V.metallicFactor,V.roughnessFactor,B,ce,a),be={defines:[]},xe=[],Ae=r.shadowRenderer;Ae&&(Ae.useNormalOffset=!1),Jc(be.defines,xe,z,r,ae?null:a.lut);let Se=null;if(X){const Re=Ma(p.nodeModelMatrix,r.transform);if(Se=new Float32Array(Re),N.projection.name!=="globe"){const Ne=z.aabb.min,nt=z.aabb.max,[We,pt]=X.getOpacityForBounds(Re,Ne[0],Ne[1],nt[0],nt[1]);be.overrideFog=We>=jt||pt>=jt}}const Te=Sa(r,a.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&be.defines.push("RENDER_CUTOFF");const Ee=r.getOrCreateProgram("model",be);r.uploadCommonUniforms(R,Ee,null,Se,Te),r.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(p.nodeModelMatrix,Ee),Ee.draw(r,R.gl.TRIANGLES,D,_,v,z.material.doubleSided?mr.disabled:mr.backCCW,_e,a.id,z.vertexBuffer,z.indexBuffer,z.segments,a.paint,r.transform.zoom,void 0,xe)}function Wl(p,r,a,f,_,v,S){let R;R=p.projection.name==="globe"?i.dp(a,p):[...a],i.ad.mat4.multiply(R,R,r.matrix);const D=i.ad.mat4.multiply([],f,R);if(r.meshes)for(const N of r.meshes){if(N.material.alphaMode!=="BLEND"){S.push({mesh:N,depth:0,modelIndex:_,worldViewProjection:D,nodeModelMatrix:R});continue}const z=i.ad.vec3.transformMat4([],N.centroid,D);!p.isOrthographic&&z[2]<=0||v.push({mesh:N,depth:z[2],modelIndex:_,worldViewProjection:D,nodeModelMatrix:R})}if(r.children)for(const N of r.children)Wl(p,N,a,f,_,v,S)}function Ld(p,r,a,f){const _=a.shadowRenderer;if(!_)return;const v=_.getShadowPassDepthMode(),S=_.getShadowPassColorMode(),R=_.calculateShadowPassMatrixFromMatrix(r),D=wv(R);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,v,vr.disabled,S,mr.backCCW,D,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,a.transform.zoom,void 0,void 0)}function fg(p,r,a){const f=r.updateZoomBasedPaintProperties(),_=function(v,S,R){let D,N,z,B=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&B>0){const V=v.terrain,X=V.findDEMTileFor(R);X&&X.dem?D=i.dr.create(V,R,X):B=0}if(B===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),B===S.validForExaggeration&&(B===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const V in S.instancesPerModel){const X=S.instancesPerModel[V];for(let se=0;se<X.instancedDataArray.length;++se){const te=(D?B*D.getElevationAt(0|X.instancedDataArray.float32[16*se],0|X.instancedDataArray.float32[16*se+1],!0,!0):0)+X.instancesEvaluatedElevation[se];X.instancedDataArray.float32[16*se+6]=te,N=N?Math.min(S.terrainElevationMin,te):te,z=z?Math.max(S.terrainElevationMax,te):te}}return S.terrainElevationMin=N||0,S.terrainElevationMax=z||0,S.validForExaggeration=B,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,r,a);(f||_)&&(r.uploaded=!1,r.upload(p.context))}const go={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function pg(p,r){const a=1<<p.canonical.z,f=r.getFreeCameraOptions().position,_=r.elevation,v=p.canonical.x/a,S=(p.canonical.x+1)/a,R=p.canonical.y/a,D=(p.canonical.y+1)/a;let N=r._centerAltitude;if(_){const X=_.getMinMaxForTile(p);X&&X.max>N&&(N=X.max)}const z=i.ay(f.x,v,S)-f.x,B=i.ay(f.y,R,D)-f.y,V=i.bH(N,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(z*z+B*B+V*V))}function Lo(p,r,a,f,_,v,S){const R=p.context,D=p.renderPass==="shadow",N=p.shadowRenderer,z=D&&N?N.getShadowPassDepthMode():new Jt(R.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D),B=p.isTileAffectedByFog(v);if(a.meshes)for(const V of a.meshes){const X=["MODEL_POSITION_ON_GPU"],se=[];let te,ae,ce;f.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");const _e=Sa(p,r.paint.get("model-cutoff-fade-range"));if(_e.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),D&&N)te=p.getOrCreateProgram("modelDepth",{defines:X}),ae=wv(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(a.matrix)),ce=N.getShadowPassColorMode();else{Jc(X,se,V,p,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),te=p.getOrCreateProgram("model",{defines:X,overrideFog:B});const xe=V.material,Ae=xe.pbrMetallicRoughness,Se=r.paint.get("model-opacity").constantOr(1),Te=r.paint.get("model-emissive-strength").constantOr(0);ae=ng(v.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,p,Se,Ae.baseColorFactor.toRenderColor(null),xe.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,xe,Te,r,_),N&&(S.shadowUniformsInitialized?te.setShadowUniformValues(R,N.getShadowUniformValues()):(N.setupShadows(v.toUnwrapped(),te,"model-tile",v.overscaledZ),S.shadowUniformsInitialized=!0)),ce=_e.shouldRenderCutoff||Se<1||xe.alphaMode!=="OPAQUE"?kr.alphaBlended:kr.unblended}p.uploadCommonUniforms(R,te,v.toUnwrapped(),null,_e);const be=V.material.doubleSided?mr.disabled:mr.backCCW;if(f.instancedDataArray.length>20)se.push(f.instancedDataBuffer),te.draw(p,R.gl.TRIANGLES,z,vr.disabled,ce,be,ae,r.id,V.vertexBuffer,V.indexBuffer,V.segments,r.paint,p.transform.zoom,void 0,se,f.instancedDataArray.length);else{const xe=D?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<f.instancedDataArray.length;++Ae)ae[xe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*Ae,16),te.draw(p,R.gl.TRIANGLES,z,vr.disabled,ce,be,ae,r.id,V.vertexBuffer,V.indexBuffer,V.segments,r.paint,p.transform.zoom,void 0,se)}}if(a.children)for(const V of a.children)Lo(p,r,V,f,_,v,S)}const pl=[1,-1,1];function Cf(p,r,a,f){if(!a.modelManager)return!0;const _=a.modelManager;if(!a.shadowRenderer)return!0;const v=a.shadowRenderer,S=r.aabb;let R=!0,D=p.maxHeight;if(D===0){let z=0;for(const B in p.instancesPerModel){const V=_.getModel(B,f);V?z=Math.max(z,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):R=!1}D=p.maxScale*z*1.41+p.maxVerticalOffset,R&&(p.maxHeight=D)}S.max[2]=D,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,i.ad.vec3.transformMat4(S.min,S.min,r.tileMatrix),i.ad.vec3.transformMat4(S.max,S.max,r.tileMatrix);const N=S.intersects(v.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=N===2),N===0}function Af(p,r){const a=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],_=p.uniformValues.u_cutoff_params[2],v=p.uniformValues.u_cutoff_params[3];return f===a||v===_?1:i.ay(((r-a)/(f-a)-_)/(v-_),0,1)}function mg(p,r,a,f){if(r.pitch<20)return 1;const _=r.getWorldToCameraMatrix();i.ad.mat4.multiply(_,_,p);const v=i.ad.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let S=i.ad.vec4.transformMat4(i.ad.vec4.create(),v,_),R=S,D=S;v[1]=a.max[1],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),v,_),R=S[1]<R[1]?S:R,D=S[1]>D[1]?S:D,v[0]=a.max[0],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),v,_),R=S[1]<R[1]?S:R,D=S[1]>D[1]?S:D,v[1]=a.min[1],S=i.ad.vec4.transformMat4(i.ad.vec4.create(),v,_),R=S[1]<R[1]?S:R,D=S[1]>D[1]?S:D;const N=i.ay(f[0],0,1),z=100*r.pixelsPerMeter*i.ay(f[1],0,1),B=i.ay(f[2],0,1),V=i.ad.vec4.lerp(i.ad.vec4.create(),R,D,N),X=Math.tan(.5*r.fovX),se=-V[2]*X;if(z===0)return V[1]<-Math.abs(se)?B:1;const te=(-Math.abs(se)-V[1])/z,ae=(_e,be,xe)=>(1-xe)*_e+xe*be,ce=i.ay(ae(1,B,te),B,1);return ae(1,ce,i.ay((r.pitch-20)/20,0,1))}class gg{}class Zl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,a,f){{const B=this._storage.get(a.id);if(B)return B.lastUsedFrameIdx=r,B.buf}const _=f.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),S=new ArrayBuffer(v),R=new Int16Array(S);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const D=new i.dt;for(let B=0;B<v/2;B+=3){const V=R[B],X=R[B+1],se=R[B+2];D.emplaceBack(V,X),D.emplaceBack(X,se),D.emplaceBack(se,V)}const N=f.bindVertexArrayOES.current,z=new gg;return z.buf=new ta(f,D),z.lastUsedFrameIdx=r,this._storage.set(a.id,z),f.bindVertexArrayOES.set(N),z.buf}update(r){for(const[a,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(const[r,a]of this._storage)a.buf.destroy(),this._storage.delete(r)}}class _g{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ml=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class yg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Nd{constructor(r,a){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const vg=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class xg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,a){const f=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new i.du,R=new i.aV;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),R.emplaceBack(0,1,2),R.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(S,vg.members),this.vignetteIdx=r.context.createIndexBuffer(R)}const _=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,f);const S={u_vignetteShape:(v={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};f.draw(r,r.context.gl.TRIANGLES,Jt.disabled,vr.disabled,kr.alphaBlended,mr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,_)}var v}}class ji{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,a){const f=r.getFreeCameraOptions().position,_=f.toAltitude(),v=f.toLngLat(),S=i.ak(v.lng),R=i.ak(v.lat),D=r.pixelsPerMeter/a,N=S*i.dv,z=i.dv*Math.log(Math.tan(Math.PI/4+R/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const B=-this._offsetYPrev+z,V=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*D,this._accumulatedOffsetY+=B*D,this._accumulatedElevation+=V*D,this._offsetXPrev=N,this._offsetYPrev=z,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Mf(p,r){return[-(p[0]-Math.floor(p[0]/r)*r),-(p[1]-Math.floor(p[1]/r)*r),-(p[2]-Math.floor(p[2]/r)*r)]}function If(p){const r=i.dl(1323123451230),a=[];for(let f=0;f<p;++f){const _=2*r()-1,v=2*r()-1,S=2*r()-1;a.push(i.ad.vec3.fromValues(_,v,S))}return a}function Rs(p,r,a,f,_){const v=i.ay((_-a)/(f-a),0,1);return(1-v)*p+v*r}class Pf{constructor(r){this._movement=new ji,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new xg,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,a){const f=r.transform;this._movement.update(f,this._ppmScaleFactor);const _=f.starsProjMatrix,v=i.ad.quat.identity([]);i.ad.quat.rotateX(v,v,i.ak(90)-f._pitch),i.ad.quat.rotateZ(v,v,-f.angle);const S=i.ad.mat4.fromQuat(new Float32Array(16),v),R=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=i.ad.mat4.transpose([],R),N=i.ad.mat4.multiply([],D,S),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*a,this._prevTime=z,{projectionMatrix:_,modelviewMatrix:N}}}class bg extends Pf{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Nd(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const a=r.context;if(!this.particlesVx){const f=If(this.particlesCount),_=new i.dw,v=new i.aV;let S=0;const R=i.dl(1323123451230);for(let D=0;D<f.length;++D){const N=f[D],z=[2*R()-1,R(),R(),R()];_.emplaceBack(N[0],N[1],N[2],-1,-1,...z),_.emplaceBack(N[0],N[1],N[2],1,-1,...z),_.emplaceBack(N[0],N[1],N[2],1,1,...z),_.emplaceBack(N[0],N[1],N[2],-1,1,...z),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(_,ml.members),this.particlesIdx=a.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=r.transform.zoom;if(a.revealStart>f)return;const _=Rs(0,1,a.revealStart,a.revealStart+a.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let S=[-v.direction.x,v.direction.y,-100];i.ad.vec3.normalize(S,S);const R=structuredClone(this._vignetteParams);R.strength*=_,v.overrideStyleParameters||(v.intensity=r.style.rain.state.density,v.timeFactor=r.style.rain.state.intensity,v.color=structuredClone(r.style.rain.state.color),S=structuredClone(r.style.rain.state.direction),v.screenThinning.intensity=r.style.rain.state.centerThinning,v.dropletSizeX=r.style.rain.state.dropletSize[0],v.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],v.distortionStrength=100*r.style.rain.state.distortionStrength,R.strength=1,R.color=structuredClone(r.style.rain.state.vignetteColor));const D=this.updateOnRender(r,v.timeFactor),N=r.context,z=N.gl,B=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new i.T(N,{width:r.width,height:r.height,data:null},z.RGBA8)),v.distortionStrength>0&&(N.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const V=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(N,V),N.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const X=[v.color.r,v.color.g,v.color.b,v.color.a],se=(te,ae)=>{const ce=Mf(this._movement.getPosition(),te),_e=v.dropletSizeX,be=v.dropletSizeX*v.dropletSizeYScale,xe=r.width/2,Ae=r.height/2,Se=Rs(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Te=Rs(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),Ee=Rs(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Re=(Ne={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ce,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:te,rainDropletSize:[_e,be],distortionStrength:v.distortionStrength,rainDirection:S,color:X,screenSize:[B.width,B.height],thinningCenterPos:[xe,Ae],thinningShape:[Se,Te,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:Ee,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:ae?0:1},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_texScreen:0,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_boxSize:Ne.boxSize,u_rainDropletSize:Ne.rainDropletSize,u_distortionStrength:Ne.distortionStrength,u_rainDirection:Ne.rainDirection,u_color:Ne.color,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_shapeDirectionalPower:Ne.shapeDirectionalPower,u_shapeNormalPower:Ne.shapeNormalPower,u_mode:Ne.mode});var Ne;const nt=Math.round(v.intensity*this.particlesCount),We=i.b8.simpleSegment(0,0,4*nt,2*nt);V.draw(r,z.TRIANGLES,Jt.disabled,vr.disabled,kr.alphaBlended,mr.disabled,Re,"rain_particles",this.particlesVx,this.particlesIdx,We)};v.distortionStrength>0&&se(v.boxSize,!0),se(v.boxSize,!1),this._vignette.draw(r,R)}}const wg=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Qc extends Pf{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Nd(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const a=r.context;if(!this.particlesVx){const f=If(this.particlesCount),_=new i.dx,v=new i.aV;let S=0;const R=i.dl(1323123451230);for(let D=0;D<f.length;++D){const N=f[D],z=R(),B=R(),V=R(),X=[D/f.length,z,B,V],se=[R(),R()];_.emplaceBack(N[0],N[1],N[2],-1,-1,...X,...se),_.emplaceBack(N[0],N[1],N[2],1,-1,...X,...se),_.emplaceBack(N[0],N[1],N[2],1,1,...X,...se),_.emplaceBack(N[0],N[1],N[2],-1,1,...X,...se),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(_,wg.members),this.particlesIdx=a.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const a=structuredClone(this._params);let f=[-a.direction.x,a.direction.y,-100];i.ad.vec3.normalize(f,f);const _=structuredClone(this._vignetteParams),v=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=r.transform.zoom;if(v.revealStart>S)return;const R=Rs(0,1,v.revealStart,v.revealStart+v.revealRange,S);_.strength*=R,a.overrideStyleParameters||(a.intensity=r.style.snow.state.density,a.timeFactor=r.style.snow.state.intensity,a.color=structuredClone(r.style.snow.state.color),f=structuredClone(r.style.snow.state.direction),a.screenThinning.intensity=r.style.snow.state.centerThinning,a.billboardSize=2.79*r.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(r.style.snow.state.vignetteColor));const D=this.updateOnRender(r,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=r.context,z=N.gl,B=r.transform,V=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(N,V),((X,se,te)=>{const ae=Mf(this._movement.getPosition(),X),ce=B.width/2,_e=B.height/2,be=Rs(0,te.screenThinning.start,0,1,te.screenThinning.intensity),xe=Rs(.001,te.screenThinning.range,0,1,te.screenThinning.intensity),Ae=Rs(0,te.screenThinning.particleOffset,0,1,te.screenThinning.intensity),Se=(Te={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:te.velocityConeAperture,velocity:te.velocity,horizontalOscillationRadius:te.horizontalOscillationRadius,horizontalOscillationRate:te.horizontalOscillationRate,boxSize:X,billboardSize:1*te.billboardSize,simpleShapeParameters:[te.shapeFadeStart,te.shapeFadePower],screenSize:[B.width,B.height],thinningCenterPos:[ce,_e],thinningShape:[be,xe,Math.pow(10,te.screenThinning.fadePower)],thinningAffectedRatio:te.screenThinning.affectedRatio,thinningParticleOffset:Ae,color:[te.color.r,te.color.g,te.color.b,te.color.a],direction:f},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const Ee=Math.round(te.intensity*this.particlesCount),Re=i.b8.simpleSegment(0,0,4*Ee,2*Ee);this.particlesVx&&this.particlesIdx&&V.draw(r,z.TRIANGLES,Jt.disabled,vr.disabled,kr.alphaBlended,mr.disabled,Se,"snow_particles",this.particlesVx,this.particlesIdx,Re)})(a.boxSize,0,a),this._vignette.draw(r,_)}}const Od={symbol:function(p,r,a,f,_){if(p.renderPass!=="translucent")return;const v=vr.disabled,S=p.colorModeForRenderPass(),R=a.layout.get("text-variable-anchor"),D=a.layout.get("text-size-scale-range"),N=i.ay(p.scaleFactor,D[0],D[1]);R&&function(V,X,se,te,ae,ce,_e,be){const xe=X.transform,Ae=ae==="map",Se=ce==="map";for(const Te of V){const Ee=te.getTile(Te),Re=Ee.getBucket(se);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Ne=i.bp(Re.textSizeData,xe.zoom,be),nt=Hs(Te,Re.getProjection(),xe),We=xe.calculatePixelsToTileUnitsMatrix(Ee),pt=ya(nt,Ee.tileID.canonical,Se,Ae,xe,Re.getProjection(),We),gt=Re.hasIconTextFit()&&Re.hasIconData();if(Ne){const Ct=Math.pow(2,xe.zoom-Ee.tileID.overscaledZ);mo(Re,Ae,Se,_e,i.cY,xe,pt,Te,Ct,Ne,gt)}}}(f,p,a,r,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_,N);const z=a.paint.get("icon-opacity").constantOr(1)!==0,B=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||B)?_n(p,r,a,f,v,S):(z&&_n(p,r,a,f,v,S,{onlyIcons:!0}),B&&_n(p,r,a,f,v,S,{onlyText:!0})),r.map.showCollisionBoxes&&(xf(p,r,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),xf(p,r,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,a,f){if(p.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),S=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const N=p.context,z=N.gl,B=p.transform,V=p.depthModeForSublayer(0,Jt.ReadOnly),X=vr.disabled,se=p.colorModeForDrapableLayerRenderPass(D),te=B.projection.name==="globe",ae=[i.av(B.center.lng),i.aC(B.center.lat)],ce=[];for(let be=0;be<f.length;be++){const xe=f[be],Ae=r.getTile(xe),Se=Ae.getBucket(a);if(!Se||Se.projection.name!==B.projection.name)continue;const Te=Se.programConfigurations.get(a.id),Ee=i.cZ(a),Re=p.isTileAffectedByFog(xe);te&&Ee.push("PROJECTION_GLOBE_VIEW"),Ee.push("DEPTH_D24"),p.terrain&&B.depthOcclusionForSymbolsAndCircles&&Ee.push("DEPTH_OCCLUSION");const Ne=p.getOrCreateProgram("circle",{config:Te,defines:Ee,overrideFog:Re}),nt=Se.layoutVertexBuffer,We=Se.globeExtVertexBuffer,pt=Se.indexBuffer,gt=B.projection.createInversionMatrix(B,xe.canonical),Ct={programConfiguration:Te,program:Ne,layoutVertexBuffer:nt,globeExtVertexBuffer:We,indexBuffer:pt,uniformValues:i.c_(p,xe,Ae,gt,ae,a),tile:Ae};if(R){const Ge=Se.segments.get();for(const ft of Ge)ce.push({segments:new i.b8([ft]),sortKey:ft.sortKey,state:Ct})}else ce.push({segments:Se.segments,sortKey:0,state:Ct})}R&&ce.sort((be,xe)=>be.sortKey-xe.sortKey);const _e={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const be of ce){const{programConfiguration:xe,program:Ae,layoutVertexBuffer:Se,globeExtVertexBuffer:Te,indexBuffer:Ee,uniformValues:Re,tile:Ne}=be.state,nt=be.segments;p.terrain&&p.terrain.setupElevationDraw(Ne,Ae,_e),p.uploadCommonUniforms(N,Ae,Ne.tileID.toUnwrapped()),Ae.draw(p,z.TRIANGLES,V,X,se,mr.disabled,Re,a.id,Se,Ee,nt,a.paint,B.zoom,xe,[Te])}},heatmap:function(p,r,a,f){if(a.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const _=p.context,v=_.gl,S=vr.disabled,R=new kr([v.ONE,v.ONE,v.ONE,v.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(X,se,te,ae){const ce=X.gl,_e=se.width*ae,be=se.height*ae;X.activeTexture.set(ce.TEXTURE1),X.viewport.set([0,0,_e,be]);let xe=te.heatmapFbo;if(!xe||xe&&(xe.width!==_e||xe.height!==be)){xe&&xe.destroy();const Ae=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Ae),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),xe=te.heatmapFbo=X.createFramebuffer(_e,be,!0,null),function(Se,Te,Ee,Re,Ne,nt){const We=Se.gl;We.texImage2D(We.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?We.RGBA16F:We.RGBA,Ne,nt,0,We.RGBA,Se.extRenderToTextureHalfFloat?We.HALF_FLOAT:We.UNSIGNED_BYTE,null),Re.colorAttachment.set(Ee)}(X,0,Ae,xe,_e,be)}else ce.bindTexture(ce.TEXTURE_2D,xe.colorAttachment.get()),X.bindFramebuffer.set(xe.framebuffer)})(_,p,a,p.transform.projection.name==="globe"?.5:.25),_.clear({color:i.al.transparent});const D=p.transform,N=D.projection.name==="globe",z=N?["PROJECTION_GLOBE_VIEW"]:[],B=N?mr.frontCCW:mr.disabled,V=[i.av(D.center.lng),i.aC(D.center.lat)];for(let X=0;X<f.length;X++){const se=f[X];if(r.hasRenderableParent(se))continue;const te=r.getTile(se),ae=te.getBucket(a);if(!ae||ae.projection.name!==D.projection.name)continue;const ce=p.isTileAffectedByFog(se),_e=ae.programConfigurations.get(a.id),be=p.getOrCreateProgram("heatmap",{config:_e,defines:z,overrideFog:ce}),{zoom:xe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(te,be),p.uploadCommonUniforms(_,be,se.toUnwrapped());const Ae=D.projection.createInversionMatrix(D,se.canonical);be.draw(p,v.TRIANGLES,Jt.disabled,S,R,B,_f(p,se,te,Ae,V,xe,a.paint.get("heatmap-intensity")),a.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,a.paint,p.transform.zoom,_e,N?[ae.globeExtVertexBuffer]:null)}_.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(_,v){const S=_.context,R=S.gl,D=v.heatmapFbo;if(!D)return;S.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,D.colorAttachment.get()),S.activeTexture.set(R.TEXTURE1);let N=v.colorRampTexture;N||(N=v.colorRampTexture=new i.T(S,v.colorRamp,R.RGBA8)),N.bind(R.LINEAR,R.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,R.TRIANGLES,Jt.disabled,vr.disabled,_.colorModeForRenderPass(),mr.disabled,((z,B,V,X)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(p,a))},line:function(p,r,a,f){if(p.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const S=a.paint.get("line-emissive-strength"),R=a.paint.get("line-occlusion-opacity"),D=a.layout.get("line-elevation-reference"),N=a.layout.get("line-width-unit")==="meters",z=D==="sea",B=p.context,V=B.gl;if(a.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const X=a.layout.get("line-cross-slope"),se=X!==void 0,te=X<1,ae=p.colorModeForDrapableLayerRenderPass(S),ce=p.terrain&&p.terrain.renderingToTexture,_e=ce?1:i.q.devicePixelRatio,be=a.paint.get("line-dasharray"),xe=be.constantOr(1),Ae=a.layout.get("line-cap"),Se=be.constantOr(null),Te=Ae.constantOr(null),Ee=a.paint.get("line-pattern"),Re=Ee.constantOr(1),Ne=Ee.constantOr(null),nt=a.paint.get("line-opacity").constantOr(1);let We=!Re&&nt!==1||p.depthOcclusion&&R>0&&R<1;const pt=a.paint.get("line-gradient"),gt=Re?"linePattern":"line",Ct=i.c$(a);let Ge;if(ce&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(We=!1),R!==0&&p.depthOcclusion){const Ve=a.paint._values["line-opacity"];Ve&&Ve.value&&Ve.value.kind==="constant"?Ge=Ve.value:i.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&Ct.push("VARIABLE_LINE_WIDTH");const ft=(Ve,ht,lt,_t,it,vt)=>{for(const Lt of Ve){const Nt=r.getTile(Lt);if(Re&&!Nt.patternsLoaded())continue;const Ot=Nt.getBucket(a);if(!Ot||Ot.hasZOffset&&!it||!Ot.hasZOffset&&it)continue;p.prepareDrawTile();const Zt=Ot.programConfigurations.get(a.id),gr=p.isTileAffectedByFog(Lt),nr=p.getOrCreateProgram(gt,{config:Zt,defines:ht,overrideFog:gr,overrideRtt:!it&&void 0});if(Ne&&Nt.imageAtlas){const xr=i.d0.from(Ne).getPrimary().scaleSelf(_e).toString(),Xt=Nt.imageAtlas.patternPositions.get(xr);Xt&&Zt.setConstantPatternPositions(Xt)}if(!Re&&Se&&Te&&Nt.lineAtlas){const xr=Nt.lineAtlas.getDash(Se,Te);xr&&Zt.setConstantPatternPositions(xr)}let[hr,lr]=a.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&hr!==lr&&(hr===0&&(hr-=1),lr===1&&(lr+=1));const Fr=ce?Lt.projMatrix:null,en=N?1/Ot.tileToMeter/i.at(Nt,1,p.transform.zoom):1,xn=N?1/Ot.tileToMeter/i.at(Nt,1,Math.floor(p.transform.zoom)):1,Pr=Re?i.d1(p,Nt,a,Fr,_e,en,xn,[hr,lr]):i.d2(p,Nt,a,Fr,Ot.lineClipsArray.length,_e,en,xn,[hr,lr]);if(pt){const xr=Ot.gradients[a.id];let Xt=xr.texture;if(a.gradientVersion!==xr.version){let Vr=256;if(a.stepInterpolant){const ln=r.getSource().maxzoom,Zr=Lt.canonical.z===ln?Math.ceil(1<<p.transform.maxZoom-Lt.canonical.z):1;Vr=i.ay(i.d3(Ot.maxLineLength/i.ai*1024*Zr),256,B.maxTextureSize)}xr.gradient=i.d4({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Vr,image:xr.gradient||void 0,clips:Ot.lineClipsArray}),xr.texture?xr.texture.update(xr.gradient):xr.texture=new i.T(B,xr.gradient,V.RGBA8),xr.version=a.gradientVersion,Xt=xr.texture}B.activeTexture.set(V.TEXTURE1),Xt.bind(a.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}xe&&(B.activeTexture.set(V.TEXTURE0),Nt.lineAtlasTexture&&Nt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),Zt.updatePaintBuffers()),Re&&(B.activeTexture.set(V.TEXTURE0),Nt.imageAtlasTexture&&Nt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Zt.updatePaintBuffers()),it&&!z&&p.terrain.setupElevationDraw(Nt,nr),p.uploadCommonUniforms(B,nr,Lt.toUnwrapped());const kn=xr=>{Ge!=null&&(Ge.value=nt*R),nr.draw(p,V.TRIANGLES,lt,xr,ae,mr.disabled,Pr,a.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,a.paint,p.transform.zoom,Zt,[Ot.layoutVertexBuffer2,Ot.patternVertexBuffer,Ot.zOffsetVertexBuffer]),Ge!=null&&(Ge.value=nt)};if(We&&!it){const xr=p.stencilModeForClipping(Lt).ref;xr===0&&ce&&B.clear({stencil:0});const Xt={func:V.EQUAL,mask:255};Pr.u_alpha_discard_threshold=.8,kn(new vr(Xt,xr,255,V.KEEP,V.KEEP,V.INVERT)),Pr.u_alpha_discard_threshold=0,kn(new vr(Xt,xr,255,V.KEEP,V.KEEP,V.KEEP))}else Pr.u_alpha_discard_threshold=We&&it&&vt?.8:0,kn(it?_t:p.stencilModeForClipping(Lt))}};if(a.hasNonElevatedBuckets){const Ve=!ce&&p.terrain;R!==0&&Ve?i.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ve?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):ft(f,Ct,p.depthModeForSublayer(0,Jt.ReadOnly),vr.disabled,!1,!0)}if(a.hasElevatedBuckets){Ct.push("ELEVATED"),se&&Ct.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&Ct.push("ELEVATION_REFERENCE_SEA");const Ve=We?p.stencilModeFor3D():vr.disabled,ht=new Jt(p.depthOcclusion?V.GREATER:V.LEQUAL,Jt.ReadOnly,p.depthRangeFor3D);p.forceTerrainMode=!0,ft(f,Ct,ht,Ve,!0,!0),We&&ft(f,Ct,ht,Ve,!0,!1),p.forceTerrainMode=!1}We&&(p.resetStencilClippingMasks(),ce&&B.clear({stencil:0})),R===0||p.depthOcclusion||ce||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,r,a,f){const _=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const S=a.paint.get("fill-emissive-strength"),R=p.colorModeForDrapableLayerRenderPass(S),D=a.paint.get("fill-pattern"),N=p.opaquePassEnabledForLayer()&&!D.constantOr(1)&&_.constantOr(i.al.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let z="none";a.layout.get("fill-elevation-reference")!=="none"?z="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const B=!(!p.terrain||!p.terrain.enabled),V={painter:p,sourceCache:r,layer:a,coords:f,colorMode:R,elevationType:z,terrainEnabled:B,pass:N};if(z!=="offset"){if(wf(V,!1),z==="road"){const X=!B&&p.renderPass==="translucent";X&&lg(p,r,a,f,"geometry"),wf(V,!0,vr.disabled),X&&function(se){const{painter:te,sourceCache:ae,layer:ce,coords:_e,colorMode:be}=se,xe=te.context.gl,Ae=new Jt(te.context.gl.LEQUAL,Jt.ReadOnly,te.depthRangeFor3D);for(const Se of _e){const Te=ae.getTile(Se),Ee=Te.getBucket(ce);if(!Ee)continue;const Re=Ee.elevatedStructures;if(!Re||!Re.renderableSegments||Re.renderableSegments.segments[0].primitiveLength===0)continue;te.prepareDrawTile();const Ne=Ee.bufferData.programConfigurations.get(ce.id),nt=te.isTileAffectedByFog(Se),We=te.getOrCreateProgram("elevatedStructures",{config:Ne,overrideFog:nt,defines:["NORMAL_OFFSET"]}),pt={u_matrix:te.translatePosMatrix(Se.projMatrix,Te,ce.paint.get("fill-translate"),ce.paint.get("fill-translate-anchor"))};te.uploadCommonUniforms(te.context,We,Se.toUnwrapped()),We.draw(te,xe.TRIANGLES,Ae,vr.disabled,be,mr.backCCW,pt,ce.id,Re.vertexBuffer,Re.indexBuffer,Re.renderableSegments,ce.paint,te.transform.zoom,Ne,[Re.vertexBufferNormal])}}(V)}}else wf(V,!1,p.stencilModeFor3D())},"fill-extrusion":function(p,r,a,f){const _=a.paint.get("fill-extrusion-opacity"),v=p.context,S=v.gl,R=p.terrain,D=R&&R.renderingToTexture;if(_===0)return;const N=p.conflationActive&&p.style.isLayerClipped(a,r.getSource()),z=p.style.order.indexOf(a.fqid);if(N&&function(B,V,X,se,te){for(const ae of se){const ce=V.getTile(ae).getBucket(X);ce&&(ce.updateReplacement(ae,B.replacementSource,te),ce.uploadCentroid(B.context))}}(p,r,a,f,z),R||N)for(const B of f){const V=r.getTile(B).getBucket(a);V&&Wc(p.context,r,B,V,a,R,N)}if(p.renderPass==="shadow"&&p.shadowRenderer){const B=p.shadowRenderer;if(R&&_<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const V=B.getShadowPassDepthMode(),X=B.getShadowPassColorMode();kd(p,r,a,f,V,vr.disabled,X,N)}else if(p.renderPass==="translucent"){const B=!a.paint.get("fill-extrusion-pattern").constantOr(1),V=a.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!D&&V.a!==0){const X=new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D);_===1&&B?kd(p,r,a,f,X,vr.disabled,kr.unblended,N):(kd(p,r,a,f,X,vr.disabled,kr.disabled,N),kd(p,r,a,f,X,p.stencilModeFor3D(),p.colorModeForRenderPass(),N),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&B&&(!R&&p.transform.projection.name!=="globe"||D)){const X=a.paint.get("fill-extrusion-opacity"),se=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),te=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=a.paint.get("fill-extrusion-flood-light-intensity"),ce=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",_e=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(ce?null:a.lut).toArray01().slice(0,3),be=se>0&&te>0,xe=ae>0,Ae=(Te,Ee,Re)=>(1-Re)*Te+Re*Ee,Se=Te=>{const Ee=p.depthModeForSublayer(1,Jt.ReadOnly,S.LEQUAL,!0),Re=a.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=Ae(.1,3,Re),nt=p._showOverdrawInspector;if(!nt){const We=new vr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),pt=new kr([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0],S.MIN);Hc(p,r,a,f,Ee,We,pt,mr.disabled,Te,"sdf",X,se,te,ae,_e,Ne,N,!1)}{const We=nt?vr.disabled:new vr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),pt=nt?p.colorModeForRenderPass():new kr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],i.al.transparent,[!0,!0,!0,!0]);Hc(p,r,a,f,Ee,We,pt,mr.disabled,Te,"color",X,se,te,ae,_e,Ne,N,!1)}};if(D){const Te=(Ee,Re,Ne)=>{const nt=p.depthModeForSublayer(1,Jt.ReadOnly,S.LEQUAL,!1),We=a.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pt=Ae(.1,3,We);{const gt=new kr([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0]);Hc(p,r,a,f,nt,vr.disabled,gt,mr.disabled,Ee,"clear",X,se,te,ae,_e,pt,N,Re)}{const gt=new vr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ct=new kr([S.ONE,S.ONE,S.ONE,S.ONE],i.al.transparent,[!1,!1,!1,!0],S.MIN);Hc(p,r,a,f,nt,gt,Ct,mr.disabled,Ee,"sdf",X,se,te,ae,_e,pt,N,Re)}{const gt=Ee?S.ZERO:S.ONE_MINUS_DST_ALPHA,Ct=new vr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ge=new kr([gt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],i.al.transparent,[!0,!0,!0,!0]);Hc(p,r,a,f,nt,Ct,Ge,mr.disabled,Ee,"color",X,se,te,ae,_e,pt,N,Re)}{const gt=new kr([S.ONE,S.ONE,S.ONE,Ee?S.ZERO:S.ONE],i.al.transparent,[!1,!1,!1,!0],Ee?S.FUNC_ADD:S.MAX);Hc(p,r,a,f,nt,vr.disabled,gt,mr.disabled,Ee,"clear",X,se,te,ae,_e,pt,N,Re,Ne)}};if(be||xe){let Ee;if(p.prepareDrawTile(),R){const Re=R.drapeBufferSize[0],Ne=R.drapeBufferSize[1];Ee=R.framebufferCopyTexture,Ee&&(!Ee||Ee.size[0]===Re&&Ee.size[1]===Ne)||(Ee&&Ee.destroy(),Ee=R.framebufferCopyTexture=new i.T(v,new i.r({width:Re,height:Ne}),S.RGBA8)),Ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Re,Ne)}be&&Te(!0,!1,Ee),xe&&Te(!1,!0,Ee)}}else be&&Se(!0),xe&&Se(!1),(be||xe)&&p.resetStencilClippingMasks()}}},hillshade:function(p,r,a,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const _=p.context,v=p.terrain&&p.terrain.renderingToTexture,[S,R]=p.renderPass!=="translucent"||v?[{},f]:p.stencilConfigForOverlap(f);for(const D of R){const N=r.getTile(D);if(N.needsHillshadePrepare&&p.renderPass==="offscreen")jb(p,N,a);else if(p.renderPass==="translucent"){const z=p.depthModeForSublayer(0,Jt.ReadOnly),B=a.paint.get("hillshade-emissive-strength"),V=p.colorModeForDrapableLayerRenderPass(B),X=v&&p.terrain?p.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];zc(p,D,N,a,z,X,V)}}_.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,a,f,_,v){if(p.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",R=a.paint.get("raster-elevation")!==0,D=R&&S;if(p.renderElevatedRasterBackface&&!D)return;const N=p.context,z=N.gl,B=r.getSource(),V=function(Se,Te,Ee,Re){const Ne=Te.paint.get("raster-color"),nt=Se.type==="raster-array",We=[],pt=Te.paint.get("raster-resampling"),gt=Te.paint.get("raster-color-mix");let Ct=Te.paint.get("raster-color-range");const Ge=[gt[0],gt[1],gt[2],0],ft=gt[3];let Ve=pt==="nearest"?Re.NEAREST:Re.LINEAR;if(nt&&(We.push("RASTER_ARRAY"),Ne||We.push("RASTER_COLOR"),pt==="linear"&&We.push("RASTER_ARRAY_LINEAR"),Ve=Re.NEAREST,!Ct&&Se.rasterLayers)){const ht=Se.rasterLayers.find(({id:lt})=>lt===Te.sourceLayer);ht&&ht.fields&&ht.fields.range&&(Ct=ht.fields.range)}if(Ct=Ct||[0,1],Ne){We.push("RASTER_COLOR"),Ee.activeTexture.set(Re.TEXTURE2),Te.updateColorRamp(Ct);let ht=Te.colorRampTexture;ht||(ht=Te.colorRampTexture=new i.T(Ee,Te.colorRamp,Re.RGBA8)),ht.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}return{mix:Ge,range:Ct,offset:ft,defines:We,resampling:Ve}}(B,a,N,z);if(B instanceof i.aK&&!f.length&&!S)return;const X=a.paint.get("raster-emissive-strength"),se=p.colorModeForDrapableLayerRenderPass(X),te=p.terrain&&p.terrain.renderingToTexture,ae=!p.options.moving,ce=a.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(B instanceof i.aK&&!f.length&&(B.onNorthPole||B.onSouthPole)){const Se=R?p.stencilModeFor3D():vr.disabled;return void Ye(!!B.onNorthPole,null,p,r,a,X,V,mr.disabled,Se)}if(!f.length)return;const[_e,be]=B instanceof i.aK||te?[{},f]:p.stencilConfigForOverlap(f),xe=be[be.length-1].overscaledZ;D&&V.defines.push("PROJECTION_GLOBE_VIEW"),R&&V.defines.push("RENDER_CUTOFF");const Ae=(Se,Te,Ee)=>{for(const Re of Se){const Ne=Re.toUnwrapped(),nt=r.getTile(Re);if(te&&(!nt||!nt.hasData()))continue;N.activeTexture.set(z.TEXTURE0);const We=Sf(nt,B,a,V);if(!We||!We.texture)continue;const{texture:pt,mix:gt,offset:Ct,tileSize:Ge,buffer:ft}=We;let Ve,ht;te?(Ve=Jt.disabled,ht=Re.projMatrix):R?(Ve=new Jt(z.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D),ht=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Ne,ae)):(Ve=p.depthModeForSublayer(Re.overscaledZ-xe,a.paint.get("raster-opacity")===1?Jt.ReadWrite:Jt.ReadOnly,z.LESS),ht=p.transform.calculateProjMatrix(Ne,ae));const lt=p.terrain&&te?p.terrain.stencilModeForRTTOverlap(Re):_e[Re.overscaledZ],_t=v?0:a.paint.get("raster-fade-duration");nt.registerFadeDuration(_t);const it=r.findLoadedParent(Re,0),vt=df(nt,it,r,p.transform,_t);let Lt,Nt;p.terrain&&p.terrain.prepareDrawTile(),N.activeTexture.set(z.TEXTURE0),pt.bind(ce,z.CLAMP_TO_EDGE),N.activeTexture.set(z.TEXTURE1),it?(it.texture&&it.texture.bind(ce,z.CLAMP_TO_EDGE),Lt=Math.pow(2,it.tileID.overscaledZ-nt.tileID.overscaledZ),Nt=[nt.tileID.canonical.x*Lt%1,nt.tileID.canonical.y*Lt%1]):pt.bind(ce,z.CLAMP_TO_EDGE),"useMipmap"in pt&&N.extTextureFilterAnisotropic&&p.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ot=p.transform;let Zt;const gr=R?Tv(Ot):[0,0,0,0];let nr,hr,lr,Fr,en,xn=0;if(D&&B instanceof i.aK&&B.coordinates.length>3)nr=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),hr=Float32Array.from(Ot.globeMatrix),lr=Float32Array.from(i.cE(Ot)),Fr=[i.av(Ot.center.lng),i.aC(Ot.center.lat)],Zt=B.elevatedGlobePerspectiveTransform,en=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Xt=i.cF(Re.canonical);xn=i.cG(Xt.getCenter().lat),nr=Float32Array.from(i.bc(i.cI(Re.canonical))),hr=Float32Array.from(Ot.globeMatrix),lr=Float32Array.from(i.cE(Ot)),Fr=[i.av(Ot.center.lng),i.aC(Ot.center.lat)],Zt=[0,0],en=Float32Array.from(i.cH(Re.canonical,Xt,xn,Ot.worldSize/Ot._pixelsPerMercatorPixel))}else Zt=B instanceof i.aK?B.perspectiveTransform:[0,0],nr=new Float32Array(16),hr=new Float32Array(9),lr=new Float32Array(16),Fr=[0,0],en=new Float32Array(9);const Pr=eg(ht,nr,hr,lr,en,Nt||[0,0],i.ag(p.transform.zoom),Fr,gr,Lt||1,vt,a,Zt,R?a.paint.get("raster-elevation"):0,2,gt,Ct,V.range,Ge,ft,X),kn=p.isTileAffectedByFog(Re),xr=p.getOrCreateProgram("raster",{defines:V.defines,overrideFog:kn});if(p.uploadCommonUniforms(N,xr,Ne),B instanceof i.aK){const Xt=B.elevatedGlobeVertexBuffer,Vr=B.elevatedGlobeIndexBuffer;if(te||!S)B.boundsBuffer&&B.boundsSegments&&xr.draw(p,z.TRIANGLES,Ve,vr.disabled,se,mr.disabled,Pr,a.id,B.boundsBuffer,p.quadTriangleIndexBuffer,B.boundsSegments);else if(Xt&&Vr){const ln=Ot.zoom<=i.c6?B.elevatedGlobeSegments:B.getSegmentsForLongitude(Ot.center.lng);ln&&xr.draw(p,z.TRIANGLES,Ve,vr.disabled,se,Te,Pr,a.id,Xt,Vr,ln)}}else if(D){Ve=new Jt(z.LEQUAL,Jt.ReadOnly,p.depthRangeFor3D);const Xt=p.globeSharedBuffers;if(Xt){const[Vr,ln,Zr]=Xt.getGridBuffers(xn,!1);xr.draw(p,z.TRIANGLES,Ve,Ee||lt,p.colorModeForRenderPass(),Te,Pr,a.id,Vr,ln,Zr)}}else{const{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:Vr,tileBoundsSegments:ln}=p.getTileBoundsBuffers(nt);xr.draw(p,z.TRIANGLES,Ve,lt,se,mr.disabled,Pr,a.id,Xt,Vr,ln)}}if(!(B instanceof i.aK)&&D)for(const Re of Se){const Ne=Re.canonical.y===(1<<Re.canonical.z)-1;Re.canonical.y===0&&Ye(!0,Re,p,r,a,X,V,Te,Ee||vr.disabled),Ne&&Ye(!1,Re,p,r,a,X,V,Te===mr.frontCW?mr.backCW:mr.frontCW,Ee||vr.disabled)}};D?Ae(be,p.renderElevatedRasterBackface?mr.backCW:mr.frontCW,p.stencilModeFor3D()):Ae(be,mr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,r,a,f,_,v){p.renderPass==="offscreen"&&function(S,R,D,N){if(!N.length)return;const z=S.context,B=z.gl,V=R.getSource();if(!(V instanceof ga))return;const X=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let se=D.particlePositionRGBAImage;if(!se||se.width!==X){const be=function(xe){const Ae=xe*xe,Se=new Uint8Array(4*Ae),Te=function(Re){return Re|=0,Re=Math.imul(2747636419^Re,2654435769),Re=Math.imul(Re^Re>>>16,2654435769),((Re=Math.imul(Re^Re>>>16,2654435769))>>>0)/4294967296},Ee=1/1.1;for(let Re=0;Re<Ae;Re++){const Ne=Ee*(Te(2*Re+0)+Zs),nt=Ee*(Te(2*Re+1)+Zs),We=255*Ne%1,pt=255*nt%1,gt=We,Ct=nt-pt/255,Ge=pt;Se[4*Re+0]=255*(Ne-We/255),Se[4*Re+1]=255*gt,Se[4*Re+2]=255*Ct,Se[4*Re+3]=255*Ge}return Se}(X);se=D.particlePositionRGBAImage=new i.r({width:X,height:X},be)}let te=D.particleFramebuffer;te?te.width!==X&&(te.destroy(),te=D.particleFramebuffer=z.createFramebuffer(X,X,!0,null)):te=D.particleFramebuffer=z.createFramebuffer(X,X,!0,null);const ae=[];for(const be of N){const xe=R.getTile(be);if(!(xe instanceof ws))continue;const Ae=Ev(xe,V,D);if(!Ae)continue;const Se=[xe.tileSize,xe.tileSize];let Te=D.tileFramebuffer;Te||(Te=D.tileFramebuffer=z.createFramebuffer(Se[0],Se[1],!0,null));let Ee=xe.rasterParticleState;Ee||(Ee=xe.rasterParticleState=new ug(z,be,Se,se));const Re=Ee.update(D.lastInvalidatedAt);Ee.particleTextureDimension!==X&&Ee.updateParticleTexture(be,se);const Ne=Ee.targetColorTexture;Ee.targetColorTexture=Ee.backgroundColorTexture,Ee.backgroundColorTexture=Ne;const nt=Ee.particleTexture0;Ee.particleTexture0=Ee.particleTexture1,Ee.particleTexture1=nt,ae.push([be,Ae,Ee,Re])}if(ae.length===0)return;const ce=i.q.now(),_e=D.previousDrawTimestamp?.001*(ce-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=ce,D.hasColorMap()){z.activeTexture.set(B.TEXTURE0+2);let be=D.colorRampTexture;be||(be=D.colorRampTexture=new i.T(z,D.colorRamp,B.RGBA8)),be.bind(B.LINEAR,B.CLAMP_TO_EDGE)}z.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(be,xe,Ae){const Se=be.context,Te=Se.gl,Ee=xe.tileFramebuffer;Se.activeTexture.set(Te.TEXTURE0);const Re={u_texture:0,u_opacity:1.05*(nt=xe.paint.get("raster-particle-fade-opacity-factor"))/(nt+.05)},Ne=be.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var nt;for(const We of Ae){const[,,pt,gt]=We;Ee.colorAttachment.set(pt.targetColorTexture.texture),Se.viewport.set([0,0,Ee.width,Ee.height]),Se.clear({color:i.al.transparent}),gt&&(pt.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Ne.draw(be,Te.TRIANGLES,Jt.disabled,vr.disabled,kr.alphaBlended,mr.disabled,Re,xe.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments))}}(S,D,ae),function(be,xe,Ae,Se){const Te=be.context,Ee=Te.gl,Re=Ae.tileFramebuffer,Ne=be.transform.projection.name==="globe",nt=Ae.paint.get("raster-particle-max-speed");for(const We of Se){const[pt,gt,Ct]=We;Te.activeTexture.set(Ee.TEXTURE0+0),gt.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Re.colorAttachment.set(Ct.targetColorTexture.texture);const Ge=be.getOrCreateProgram("rasterParticleDraw",{defines:gt.defines,overrideFog:!1});Te.activeTexture.set(Ee.TEXTURE0+1);const ft=gt.scalarData?[]:[0,1,2,3].map(lt=>i.d7[lt](pt));ft.push(pt);const Ve=pt.canonical.x,ht=pt.canonical.y;for(const lt of ft){const _t=xe.getTile(Ne?lt.wrapped():lt);if(!_t)continue;const it=_t.rasterParticleState;if(!it)continue;const vt=lt.canonical.x+(1<<lt.canonical.z)*(lt.wrap-pt.wrap),Lt=lt.canonical.y;it.particleTexture0.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const Nt=tg(1,it.particleTexture0.size[0],[vt-Ve,Lt-ht],0,gt.texture.size,2,nt,gt.textureOffset,gt.scale,gt.offset);Ge.draw(be,Ee.POINTS,Jt.disabled,vr.disabled,kr.alphaBlended,mr.disabled,Nt,Ae.id,it.particleIndexBuffer,void 0,it.particleSegment)}}}(S,R,D,ae),z.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(be,xe,Ae,Se){const Te=be.context,Ee=Te.gl,Re=xe.paint.get("raster-particle-max-speed"),Ne=Se*xe.paint.get("raster-particle-speed-factor")*.15,nt=function(pt){return Math.pow(pt,6)}(.01+1*xe.paint.get("raster-particle-reset-rate-factor")),We=xe.particleFramebuffer;Te.viewport.set([0,0,We.width,We.height]);for(const pt of Ae){const[,gt,Ct]=pt;Te.activeTexture.set(Ee.TEXTURE0+0),gt.texture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Te.activeTexture.set(Ee.TEXTURE0+1);const Ge=Ct.particleTexture0;Ge.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);const ft=Zb(1,Ge.size[0],0,gt.texture.size,Re,Ne,nt,gt.textureOffset,gt.scale,gt.offset);We.colorAttachment.set(Ct.particleTexture1.texture),Te.clear({color:i.al.transparent}),be.getOrCreateProgram("rasterParticleUpdate",{defines:gt.defines}).draw(be,Ee.TRIANGLES,Jt.disabled,vr.disabled,kr.unblended,mr.disabled,ft,xe.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments)}}(S,D,ae,_e)}(p,r,a,f),p.renderPass==="translucent"&&(function(S,R,D,N,z){const B=S.context,V=B.gl,X=R.getSource().tileSize,se=5*(1-i.ae(i.bY,i.bY+1,S.transform.zoom))*X+D.paint.get("raster-particle-elevation"),te=!S.options.moving,ae=S.transform.projection.name==="globe";if(!N.length)return;const[ce,_e]=S.stencilConfigForOverlap(N),be=[];ae&&be.push("PROJECTION_GLOBE_VIEW");const xe=S.stencilModeFor3D();for(const Ae of _e){const Se=Ae.toUnwrapped(),Te=R.getTile(Ae);if(!Te.rasterParticleState)continue;const Ee=Te.rasterParticleState,Re=100;Te.registerFadeDuration(Re);const Ne=R.findLoadedParent(Ae,0),nt=df(Te,Ne,R,S.transform,Re);let We,pt;S.terrain&&S.terrain.prepareDrawTile(),B.activeTexture.set(V.TEXTURE0),Ee.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),B.activeTexture.set(V.TEXTURE1),Ne&&Ne.rasterParticleState?(Ne.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),We=Math.pow(2,Ne.tileID.overscaledZ-Te.tileID.overscaledZ),pt=[Te.tileID.canonical.x*We%1,Te.tileID.canonical.y*We%1]):Ee.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const gt=ae?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Se,te),Ct=S.transform,Ge=Cv(Ct),ft=i.cF(Ae.canonical),Ve=i.cG(ft.getCenter().lat);let ht,lt,_t,it,vt;ae?(ht=Float32Array.from(i.bc(i.cI(Ae.canonical))),lt=Float32Array.from(Ct.globeMatrix),_t=Float32Array.from(i.cE(Ct)),it=[i.av(Ct.center.lng),i.aC(Ct.center.lat)],vt=Float32Array.from(i.cH(Ae.canonical,ft,Ve,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(ht=new Float32Array(16),lt=new Float32Array(9),_t=new Float32Array(16),it=[0,0],vt=new Float32Array(9));const Lt=er(gt,ht,lt,_t,vt,pt||[0,0],i.ag(S.transform.zoom),it,Ge,We||1,nt,se),Nt=S.isTileAffectedByFog(Ae),Ot=S.getOrCreateProgram("rasterParticle",{defines:be,overrideFog:Nt});if(S.uploadCommonUniforms(B,Ot,Se),ae){const Zt=new Jt(V.LEQUAL,Jt.ReadOnly,S.depthRangeFor3D),gr=0,nr=S.globeSharedBuffers;if(nr){const[hr,lr,Fr]=nr.getGridBuffers(Ve,gr!==0);Ot.draw(S,V.TRIANGLES,Zt,xe,kr.alphaBlended,S.renderElevatedRasterBackface?mr.frontCCW:mr.backCCW,Lt,D.id,hr,lr,Fr)}}else{const Zt=S.depthModeForSublayer(0,Jt.ReadOnly),gr=ce[Ae.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:hr,tileBoundsSegments:lr}=S.getTileBoundsBuffers(Te);Ot.draw(S,V.TRIANGLES,Zt,gr,kr.alphaBlended,mr.disabled,Lt,D.id,nr,hr,lr)}}S.resetStencilClippingMasks()}(p,r,a,f),p.style.map.triggerRepaint())},background:function(p,r,a,f){const _=a.paint.get("background-color"),v=a.paint.get("background-color-use-theme").constantOr("default")==="none",S=a.paint.get("background-opacity"),R=a.paint.get("background-emissive-strength"),D=a.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const N=p.context,z=N.gl,B=p.transform,V=B.tileSize,X=a.paint.get("background-pattern");let se;if(X!==void 0&&(X===null||(se=p.imageManager.getPattern(i.I.from(X.toString()),a.scope,p.style.getLut(a.scope)),!se)))return;const te=!X&&_.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==te)return;const ae=vr.disabled,ce=p.depthModeForSublayer(0,te==="opaque"?Jt.ReadWrite:Jt.ReadOnly),_e=p.colorModeForDrapableLayerRenderPass(R),be=X?"backgroundPattern":"background";let xe,Ae=f;if(Ae||(xe=p.getBackgroundTiles(),Ae=Object.values(xe).map(Se=>Se.tileID)),X&&(N.activeTexture.set(z.TEXTURE0),p.imageManager.bind(p.context,a.scope)),D){const Se=p.getOrCreateProgram(be,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(i.ad.mat4.identity([])),Ee=new i.aH(0,0,0,0,0),Re=X?bv(Te,R,S,p,0,a.scope,se,D,{tileID:Ee,tileSize:V}):rg(Te,R,S,_.toRenderColor(v?null:a.lut));Se.draw(p,z.TRIANGLES,ce,ae,_e,mr.disabled,Re,a.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Se of Ae){const Te=p.isTileAffectedByFog(Se),Ee=p.getOrCreateProgram(be,{overrideFog:Te}),Re=Se.toUnwrapped(),Ne=f?Se.projMatrix:p.transform.calculateProjMatrix(Re);p.prepareDrawTile();const nt=r?r.getTile(Se):xe?xe[Se.key]:new Po(Se,V,B.zoom,p),We=X?bv(Ne,R,S,p,0,a.scope,se,D,{tileID:Se,tileSize:V}):rg(Ne,R,S,_.toRenderColor(v?null:a.lut));p.uploadCommonUniforms(N,Ee,Re);const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:gt,tileBoundsSegments:Ct}=p.getTileBoundsBuffers(nt);Ee.draw(p,z.TRIANGLES,ce,ae,_e,mr.disabled,We,a.id,pt,gt,Ct)}},sky:function(p,r,a){const f=p._atmosphere?i.ag(p.transform.zoom):1,_=a.paint.get("sky-opacity")*f;if(_===0)return;const v=p.context,S=a.paint.get("sky-type"),R=new Jt(v.gl.LEQUAL,Jt.ReadOnly,[0,1]),D=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?a.needsSkyboxCapture(p)&&(function(N,z,B,V){const X=N.context,se=X.gl;let te=z.skyboxFbo;if(!te){te=z.skyboxFbo=X.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Mv(X),z.skyboxTexture=X.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,z.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let be=0;be<6;++be)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(te.framebuffer),X.viewport.set([0,0,32,32]);const ae=z.getCenter(N,!0),ce=N.getOrCreateProgram("skyboxCapture"),_e=new Float64Array(16);i.ad.mat4.identity(_e),i.ad.mat4.rotateY(_e,_e,.5*-Math.PI),ki(N,z,ce,_e,ae,0),i.ad.mat4.identity(_e),i.ad.mat4.rotateY(_e,_e,.5*Math.PI),ki(N,z,ce,_e,ae,1),i.ad.mat4.identity(_e),i.ad.mat4.rotateX(_e,_e,.5*-Math.PI),ki(N,z,ce,_e,ae,2),i.ad.mat4.identity(_e),i.ad.mat4.rotateX(_e,_e,.5*Math.PI),ki(N,z,ce,_e,ae,3),i.ad.mat4.identity(_e),ki(N,z,ce,_e,ae,4),i.ad.mat4.identity(_e),i.ad.mat4.rotateY(_e,_e,Math.PI),ki(N,z,ce,_e,ae,5),X.viewport.set([0,0,N.width,N.height])}(p,a),a.markSkyboxValid(p)):p.renderPass==="sky"&&function(N,z,B,V,X){const se=N.context,te=se.gl,ae=N.transform,ce=N.getOrCreateProgram("skybox");se.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,z.skyboxTexture);const _e=((be,xe,Ae,Se,Te)=>({u_matrix:be,u_sun_direction:xe,u_cubemap:0,u_opacity:Se,u_temporal_offset:Te}))(ae.skyboxMatrix,z.getCenter(N,!1),0,V,X);N.uploadCommonUniforms(se,ce),ce.draw(N,te.TRIANGLES,B,vr.disabled,N.colorModeForRenderPass(),mr.backCW,_e,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,a,R,_,D):S==="gradient"&&p.renderPass==="sky"&&function(N,z,B,V,X){const se=N.context,te=se.gl,ae=N.transform,ce=N.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Mv(se)),se.activeTexture.set(te.TEXTURE0);let _e=z.colorRampTexture;_e||(_e=z.colorRampTexture=new i.T(se,z.colorRamp,te.RGBA8)),_e.bind(te.LINEAR,te.CLAMP_TO_EDGE);const be=((xe,Ae,Se,Te,Ee)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:Ae,u_radius:i.ak(Se),u_opacity:Te,u_temporal_offset:Ee}))(ae.skyboxMatrix,z.getCenter(N,!1),z.paint.get("sky-gradient-radius"),V,X);N.uploadCommonUniforms(se,ce),ce.draw(N,te.TRIANGLES,B,vr.disabled,N.colorModeForRenderPass(),mr.backCW,be,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,a,R,_,D)},debug:function(p,r,a,f,_,v){for(let S=0;S<a.length;S++)if(_){const N=new i.al(f.r*.8,f.g*.8,f.b*.8,1);fl(p,r,a[S],f,-1,-1,v),fl(p,r,a[S],f,-1,1,v),fl(p,r,a[S],f,1,1,v),fl(p,r,a[S],f,1,-1,v),fl(p,r,a[S],N,0,0,v)}else fl(p,r,a[S],f,0,0,v)},custom:function(p,r,a,f){const _=p.context,v=a.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&a.isDraped(r)){if(p.renderPass==="offscreen"){const S=v.prerender;if(S){if(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const R=p.transform.pointMerc;S.call(v,_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.ag(p.transform.zoom),[R.x,R.y],p.transform.pixelsPerMeterRatio)}else S.call(v,_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const R=v.renderToTile;if(R){const D=f[0].canonical,N=new i.ac(D.x+f[0].wrap*(1<<D.z),D.y,D.z);_.setDepthMode(Jt.disabled),_.setStencilMode(vr.disabled),_.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),R.call(v,_.gl,N),_.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(vr.disabled);const S=v.renderingMode==="3d"?new Jt(p.context.gl.LEQUAL,Jt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Jt.ReadOnly);if(_.setDepthMode(S),p.transform.projection.name==="globe"){const R=p.transform.pointMerc;v.render(_.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.ag(p.transform.zoom),[R.x,R.y],p.transform.pixelsPerMeterRatio)}else v.render(_.gl,p.transform.customLayerMatrix());_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,r,a,f){if(p.renderPass==="opaque")return;const _=a.paint.get("model-opacity").constantOr(1);if(_===0)return;const v=a.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!v||p.terrain&&_<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const S=p.shadowRenderer,R=a.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,R||(S.enabled=!1));const D=()=>{S&&(S.useNormalOffset=!0,R||(S.enabled=!0))},N=r.getSource();if(p.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(ce,_e,be,xe,Ae){const Se=ce.transform;if(Se.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Te=Se.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ee=ce.modelManager;be.modelManager=Ee;const Re=ce.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ne=be._unevaluatedLayout._values["model-id"],nt=Object.assign({},be.layout.get("model-id").parameters),We=ce.style.order.indexOf(be.fqid);for(const pt of xe){const gt=_e.getTile(pt).getBucket(be);if(!gt||gt.projection.name!==Se.projection.name)continue;const Ct=gt.getModelUris();Ct&&!gt.modelsRequested&&(Ee.addModelsFromBucket(Ct,Ae),gt.modelsRequested=!0);const Ge=pg(pt,Se);nt.zoom=Ge;const ft=Ne.possiblyEvaluate(nt);if(fg(ce,gt,pt),go.shadowUniformsInitialized=!1,go.useSingleShadowCascade=!!Re&&Re.getMaxCascadeForTile(pt.toUnwrapped())===0,ce.renderPass==="shadow"&&Re){if(ce.currentShadowCascade===1&&gt.isInsideFirstShadowMapFrustum)continue;const lt=Se.calculatePosMatrix(pt.toUnwrapped(),Se.worldSize);if(go.tileMatrix.set(lt),go.shadowTileMatrix=Float32Array.from(Re.calculateShadowPassMatrixFromMatrix(lt)),go.aabb.min.fill(0),go.aabb.max[0]=go.aabb.max[1]=i.ai,go.aabb.max[2]=0,Cf(gt,go,ce,be.scope))continue}const Ve=1<<pt.canonical.z,ht=[((Te.x-pt.wrap)*Ve-pt.canonical.x)*i.ai,(Te.y*Ve-pt.canonical.y)*i.ai,Te.z*Ve*i.ai];ce.conflationActive&&Object.keys(gt.instancesPerModel).length>0&&ce.style.isLayerClipped(be,_e.getSource())&&gt.updateReplacement(pt,ce.replacementSource,We,Ae)&&(gt.uploaded=!1,gt.upload(ce.context));for(let lt in gt.instancesPerModel){const _t=gt.instancesPerModel[lt];_t.features.length>0&&(lt=ft.evaluate(_t.features[0].feature,{}));const it=Ee.getModel(lt,Ae);if(it&&it.uploaded)for(const vt of it.nodes)Lo(ce,be,vt,_t,ht,pt,go)}}}(p,r,a,f,N.type==="vector"?a.scope:""),void D();if(!N.loaded())return;if(N.type==="batched-model")return function(ce,_e,be,xe){be.resetLayerRenderingStats(ce);const Ae=ce.context,Se=ce.transform,Te=ce.style.fog,Ee=ce.shadowRenderer;if(Se.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Re=ce.transform.getFreeCameraOptions().position,Ne=i.ad.vec3.scale([],[Re.x,Re.y,Re.z],ce.transform.worldSize),nt=i.ad.vec3.negate([],Ne),We=i.ad.mat4.identity([]),pt=i.dm(Se.center.lat,Se.zoom),gt=i.ad.mat4.fromScaling([],[1,1,1/pt]);i.ad.mat4.translate(We,We,nt);const Ct=be.paint.get("model-opacity").constantOr(1),Ge=new Jt(Ae.gl.LEQUAL,Jt.ReadWrite,ce.depthRangeFor3D),ft=new Jt(Ae.gl.LEQUAL,Jt.ReadOnly,ce.depthRangeFor3D),Ve=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ht=ce.renderPass==="shadow",lt=ht&&Ee?Ee.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),_t=be.paint.get("model-front-cutoff"),it=_t[2]<1,vt=Sa(ce,be.paint.get("model-cutoff-fade-range")),Lt=be.getLayerRenderingStats();(function(Nt,Ot,Zt,gr){const nr=Nt.terrain?Nt.terrain.exaggeration():0,hr=Nt.transform.zoom;for(const lr of gr){const Fr=Ot.getTile(lr).getBucket(Zt);Fr&&(Fr.setFilter(Zt.filter),Nt.conflationActive&&Fr.updateReplacement(lr,Nt.replacementSource),Fr.evaluateScale(Nt,Zt),Nt.terrain&&nr>0&&Fr.elevationUpdate(Nt.terrain,nr,lr,Zt.source),Fr.needsReEvaluation(Nt,hr,Zt)&&Fr.evaluate(Zt))}})(ce,_e,be,xe),function(){let Nt,Ot,Zt;it?(Nt=xe.length-1,Ot=-1,Zt=-1):(Nt=0,Ot=xe.length,Zt=1);const gr=new Float64Array(16),nr=i.ad.vec3.create(),hr=new i.P(0,0);for(let lr=Nt;lr!==Ot;lr+=Zt){const Fr=xe[lr],en=_e.getTile(Fr).getBucket(be);if(!en||!en.uploaded)continue;let xn=!1;Ee&&(xn=Ee.getMaxCascadeForTile(Fr.toUnwrapped())===0);const Pr=Se.calculatePosMatrix(Fr.toUnwrapped(),Se.worldSize),kn=en.modelTraits;!ht&&it&&(i.ad.mat4.invert(gr,Pr),i.ad.vec3.transformMat4(nr,Ne,gr),hr.x=nr[0],hr.y=nr[1]);const xr=[];en.setFilter(be.filter);for(const Xt of en.getNodesInfo()){if(Xt.hiddenByReplacement||!Xt.node.meshes)continue;const Vr=Xt.node;let ln=0;ce.terrain&&Vr.elevation&&(ln=Vr.elevation*ce.terrain.exaggeration());const Zr=(()=>{const pn=Xt.aabb;return Ve.min=[...pn.min],Ve.max=[...pn.max],Ve.min[2]+=ln,Ve.max[2]+=ln,i.ad.vec3.transformMat4(Ve.min,Ve.min,Pr),i.ad.vec3.transformMat4(Ve.max,Ve.max,Pr),Ve})(),$n=Xt.evaluatedScale;if($n[0]<=1&&$n[1]<=1&&$n[2]<=1&&Zr.intersects(lt)===0)continue;if(!ht&&it){const pn=.16666666666666666;Xt.cameraCollisionOpacity=Ne[0]>Zr.min[0]&&Ne[0]<Zr.max[0]&&Ne[1]>Zr.min[1]&&Ne[1]<Zr.max[1]&&Ne[2]*pt<Zr.max[2]&&Vr.footprint&&i.bA(hr,Vr.footprint)?Math.max(Xt.cameraCollisionOpacity-pn,0):Math.min(1,Xt.cameraCollisionOpacity+pn)}const ei=[...Pr],di=Vr.anchor?Vr.anchor[0]:0,yi=Vr.anchor?Vr.anchor[1]:0;i.ad.mat4.translate(ei,ei,[di*($n[0]-1),yi*($n[1]-1),ln]),i.ad.vec3.exactEquals($n,i.dq)||i.ad.mat4.scale(ei,ei,$n);const Ys=i.ad.mat4.multiply([],ei,Vr.matrix),ns=i.ad.mat4.multiply([],Se.expandedFarZProjMatrix,Ys),Gr=i.ad.mat4.multiply([],Se.expandedFarZProjMatrix,ei),Dn=i.ad.vec4.transformMat4([],[di,yi,ln,1],ns)[2];Vr.hidden=!1;let tn=Ct;ht||(it&&(tn*=Xt.cameraCollisionOpacity,tn*=mg(ei,Se,Xt.aabb,_t)),tn*=Af(vt,Dn)),tn!==0?xr.push({nodeInfo:Xt,depth:Dn,opacity:tn,wvpForNode:ns,wvpForTile:Gr,nodeModelMatrix:Ys,tileModelMatrix:ei}):Vr.hidden=!0}ht||xr.sort((Xt,Vr)=>!it||Xt.opacity===1&&Vr.opacity===1?Xt.depth<Vr.depth?-1:1:Xt.opacity===1?-1:Vr.opacity===1?1:Xt.depth>Vr.depth?-1:1);for(const Xt of xr){const Vr=Xt.nodeInfo,ln=Vr.node;let Zr=i.ad.mat4.multiply([],gt,Xt.tileModelMatrix);i.ad.mat4.multiply(Zr,We,Zr);const $n=i.ad.mat4.invert([],Zr);i.ad.mat4.transpose($n,$n),i.ad.mat4.scale($n,$n,pl),Zr=i.ad.mat4.multiply(Zr,Zr,ln.matrix);const ei=ce.renderPass==="light-beam",di=be.paint.get("model-color-use-theme").constantOr("default")==="none",yi=kn&i.ds.HasMapboxMeshFeatures,Ys=yi?0:Vr.evaluatedRMEA[0][2];for(let ns=0;ns<ln.meshes.length;++ns){const Gr=ln.meshes[ns],Dn=ns===ln.lightMeshIndex;let tn=Xt.wvpForNode;if(Dn){if(!ei&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}tn=Xt.wvpForTile}else if(ei)continue;const pn={defines:[]},Bi=[];if(!ht&&Ee&&(Ee.useNormalOffset=!!Gr.normalBuffer),Jc(pn.defines,Bi,Gr,ce,di?null:be.lut),yi||pn.defines.push("DIFFUSE_SHADED"),xn&&pn.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(ht?Lt.numRenderedVerticesInShadowPass+=Gr.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=Gr.vertexArray.length),ht){Ld(Gr,Xt.nodeModelMatrix,ce,be);continue}let Mn=null;if(Te){const vo=Ma(Xt.nodeModelMatrix,ce.transform);if(Mn=new Float32Array(vo),Se.projection.name!=="globe"){const Os=Gr.aabb.min,Ra=Gr.aabb.max,[sa,ka]=Te.getOpacityForBounds(vo,Os[0],Os[1],Ra[0],Ra[1]);pn.overrideFog=sa>=jt||ka>=jt}}const hi=Gr.material;let ia;hi.occlusionTexture&&hi.occlusionTexture.offsetScale&&(ia=hi.occlusionTexture.offsetScale,pn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ns=ce.getOrCreateProgram("model",pn);!ht&&Ee&&Ee.setupShadowsFromMatrix(Xt.tileModelMatrix,Ns,Ee.useNormalOffset),ce.uploadCommonUniforms(Ae,Ns,null,Mn);const yo=hi.pbrMetallicRoughness;yo.metallicFactor=.9,yo.roughnessFactor=.5;const Ts=ng(new Float32Array(tn),new Float32Array(Zr),new Float32Array($n),new Float32Array(ln.matrix),ce,Xt.opacity,yo.baseColorFactor.toRenderColor(null),hi.emissiveFactor,yo.metallicFactor,yo.roughnessFactor,hi,Ys,be,[0,0,0],ia);!Dn&&(Vr.hasTranslucentParts||Xt.opacity<1)&&Ns.draw(ce,Ae.gl.TRIANGLES,Ge,vr.disabled,kr.disabled,mr.backCCW,Ts,be.id,Gr.vertexBuffer,Gr.indexBuffer,Gr.segments,be.paint,ce.transform.zoom,void 0,Bi),Ns.draw(ce,Ae.gl.TRIANGLES,Dn?ft:Ge,vr.disabled,Dn||Xt.opacity<1||Vr.hasTranslucentParts?kr.alphaBlended:kr.unblended,mr.backCCW,Ts,be.id,Gr.vertexBuffer,Gr.indexBuffer,Gr.segments,be.paint,ce.transform.zoom,void 0,Bi)}}}}()}(p,r,a,f),void D();if(N.type!=="model")return;const z=N.getModels(),B=[],V=p.transform.getFreeCameraOptions().position,X=i.ad.vec3.scale([],[V.x,V.y,V.z],p.transform.worldSize);i.ad.vec3.negate(X,X);const se=[],te=[];let ae=0;for(const ce of z){const _e=a.paint.get("model-rotation").constantOr(null),be=a.paint.get("model-scale").constantOr(null),xe=a.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(p,_e,be,xe,!0,!0,!1);const Ae=i.ad.mat4.identity([]),Se=i.dm(ce.position.lat,p.transform.zoom),Te=i.ad.mat4.fromScaling([],[1,1,1/Se]);i.ad.mat4.translate(Ae,Ae,X),B.push({zScaleMatrix:Te,negCameraPosMatrix:Ae});for(const Ee of ce.nodes)Wl(p.transform,Ee,ce.matrix,p.transform.expandedFarZProjMatrix,ae,se,te);ae++}if(se.sort((ce,_e)=>_e.depth-ce.depth),p.renderPass!=="shadow"){if(_===1)for(const ce of te)Ia(ce,p,a,B[ce.modelIndex],vr.disabled,p.colorModeForRenderPass());else{for(const ce of te)Ia(ce,p,a,B[ce.modelIndex],vr.disabled,kr.disabled);for(const ce of te)Ia(ce,p,a,B[ce.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const ce of se)Ia(ce,p,a,B[ce.modelIndex],vr.disabled,p.colorModeForRenderPass());D()}else{for(const ce of te)Ld(ce.mesh,ce.nodeModelMatrix,p,a);for(const ce of se)Ld(ce.mesh,ce.nodeModelMatrix,p,a);D()}}},Rf={line:function(p,r,a){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const f=r.getVisibleCoordinates();for(const _ of f){const v=r.getTile(_).getBucket(p);if(v&&(v.hasZOffset?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,r,a){const f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?p.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const v of _)v.upload(a.context)},raster:function(p,r,a){const f=r.getSource();if(!(f instanceof ga&&f.loaded()))return;const _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=p.paint.get("raster-array-band")||f.getInitialBand(_);if(v==null)return;const S=r.getIds().map(R=>r.getTileByID(R));for(const R of S)R.updateNeeded(_,v)&&f.prepareTile(R,_,v)},"raster-particle":function(p,r,a){const f=r.getSource();if(!(f instanceof ga&&f.loaded()))return;const _=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const v=p.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(v==null)return;const S=r.getIds().map(R=>r.getTileByID(R));for(const R of S)R.updateNeeded(_,v)&&f.prepareTile(R,_,v)}},kf={fill:lg};class Df{constructor(r,a,f,_,v){this.context=new hl(r,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const D of S)this._debugParams.enabledLayers[D]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of S)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new _g(v),this.setup(),this.numSublayers=ho.maxUnderzooming+ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ta(this),this._wireframeDebugCache=new Zl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,R,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_}updateTerrain(r,a){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mv(this,r));const _=this._terrain;this.transform.elevation=f?_:null,_.update(r,this.transform,a),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){const a=r.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=a.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const v=f+.78*(_-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new mv(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,a){if(this.width=r*i.q.devicePixelRatio,this.height=a*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const r=this.context,a=new i.b5;a.emplaceBack(0,0),a.emplaceBack(i.ai,0),a.emplaceBack(0,i.ai),a.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=r.createVertexBuffer(a,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const f=new i.b5;f.emplaceBack(0,0),f.emplaceBack(i.ai,0),f.emplaceBack(0,i.ai),f.emplaceBack(i.ai,i.ai),this.debugBuffer=r.createVertexBuffer(f,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const _=new i.b5;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const v=new i.aU;v.emplaceBack(0,0,0,0),v.emplaceBack(i.ai,0,i.ai,0),v.emplaceBack(0,i.ai,0,i.ai),v.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=r.createVertexBuffer(v,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const S=new i.aV;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const R=new i.b6;for(const N of[0,1,3,2,0])R.emplaceBack(N);this.debugIndexBuffer=r.createIndexBuffer(R),this.emptyTexture=new i.T(r,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=i.ad.mat4.create();const D=this.context.gl;this.stencilClearMode=new vr({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Jt.disabled,this.stencilClearMode,kr.disabled,mr.disabled,Bc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,a,f){if(!a||this.currentStencilSource===a.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const D of f)if(this._tileClippingMaskIDs[D.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=a.id;const _=this.context,v=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(kr.disabled),_.setDepthMode(Jt.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const D=a.getTile(R),N=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:B,tileBoundsSegments:V}=this.getTileBoundsBuffers(D);S.draw(this,v.TRIANGLES,Jt.disabled,new vr({func:v.ALWAYS,mask:0},N,255,v.KEEP,v.KEEP,v.REPLACE),kr.disabled,mr.disabled,Bc(R.projMatrix),"$clipping",z,B,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,a=this.context.gl;return new vr({func:a.NOTEQUAL,mask:255},r,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const a=this.context.gl;return new vr({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(r){const a=this.context.gl,f=r.sort((S,R)=>R.overscaledZ-S.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let R=0;R<v;R++)S[R+_]=new vr({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[S,f]}return[{[_]:vr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new kr([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kr.unblended:kr.alphaBlended}colorModeForDrapableLayerRenderPass(r){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new kr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,a,f,_=!1){if(this.depthOcclusion)return new Jt(this.context.gl.GREATER,Jt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Jt.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Jt(f||this.context.gl.LEQUAL,a,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),v=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new Ss(this.context,a,f,!1,"texture"),this.depthTexture=new i.T(this.context,{width:a,height:f,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,v),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,a,f,0,0,a,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,a)=>r+a/this._fpsHistory.length,0))}render(r,a){const f=i.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=a;const _=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(v).filter(Ge=>{const ft=_[Ge];return!(ft.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ft.type]});let R=S(),D=!1,N=!1;for(const Ge of R){const ft=_[Ge];ft.type==="circle"&&(D=!0),ft.type==="symbol"&&(ft.hasInitialOcclusionOpacityProperties?N=!0:D=!0)}let z=R.map(Ge=>_[Ge]);const B=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let V=0,X=!1;for(const Ge in B){const ft=B[Ge];ft.used&&(ft.prepare(this.context),ft.getSource().usedInConflation&&++V)}let se=!1;for(const Ge of z)Ge.isHidden(this.transform.zoom)||(Ge.type==="clip"&&(se=!0),this.prepareLayer(Ge));const te={},ae={},ce={},_e={},be={};for(const Ge in B){const ft=B[Ge];te[Ge]=ft.getVisibleCoordinates(),ae[Ge]=te[Ge].slice().reverse(),ce[Ge]=ft.getVisibleCoordinates(!0).reverse(),_e[Ge]=ft.getShadowCasterCoordinates(),be[Ge]=ft.sortCoordinatesByDistance(te[Ge])}const xe=Ge=>{const ft=this.style.getLayerSourceCache(Ge);return ft&&ft.used?ft.getSource():null};if(V||se||this._clippingActiveLastFrame){const Ge=[],ft=[];let Ve=0;for(const ht of z)this.isSourceForClippingOrConflation(ht,xe(ht))&&(Ge.push(ht),ft.push(Ve)),Ve++;if(Ge&&(se||Ge.length>1)||this._clippingActiveLastFrame){se=!1;const ht=[];for(let lt=0;lt<Ge.length;lt++){const _t=Ge[lt],it=ft[lt],vt=this.style.getLayerSourceCache(_t);if(!vt||!vt.used||!vt.getSource().usedInConflation&&_t.type!=="clip")continue;let Lt=i.dA,Nt=i.by.None;const Ot=[];let Zt=!0;if(_t.type==="clip"){Lt=it;for(const gr of _t.layout.get("clip-layer-types"))Nt|=gr==="model"?i.by.Model:gr==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const gr of _t.layout.get("clip-layer-scope"))Ot.push(gr);_t.isHidden(this.transform.zoom)?Zt=!1:se=!0}Zt&&ht.push({layer:_t.fqid,cache:vt,order:Lt,clipMask:Nt,clipScope:Ot})}this.replacementSource.setSources(ht),X=!0}}this._clippingActiveLastFrame=se,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ge=0;Ge<z.length;Ge++){const ft=z[Ge],Ve=ft.cutoffRange();if(this.longestCutoffRange=Math.max(Ve,this.longestCutoffRange),Ve>0){const ht=xe(ft);ht&&(this.minCutoffZoom=Math.max(ht.minzoom,this.minCutoffZoom)),ft.minzoom&&(this.minCutoffZoom=Math.max(ft.minzoom,this.minCutoffZoom))}ft.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ge),this._lastOcclusionLayer=Ge)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ce),this.opaquePassCutoff=0,R=S(),z=R.map(Ge=>_[Ge]));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ge in B)for(const ft of te[Ge]){let Ve={min:0,max:0};this.terrain&&(Ve=this.terrain.getMinMaxForTile(ft)||Ve),Se.addShadowReceiver(ft.toUnwrapped(),Ve.min,Ve.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Iv(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ee=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new Qc(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),Ee&&!this._rain&&(this._rain=new bg(this)),!Ee&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!br.has(this.context.gl))return;this.renderPass="offscreen";for(const Ge of z){const ft=r.getLayerSourceCache(Ge);if(!Ge.hasOffscreenPass()||Ge.isHidden(this.transform.zoom))continue;const Ve=ft?ae[ft.id]:void 0;(Ge.type==="custom"||Ge.type==="raster"||Ge.type==="raster-particle"||Ge.isSky()||Ve&&Ve.length)&&this.renderLayer(this,ft,Ge,Ve)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Re=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ne=(()=>{if(a.showOverdrawInspector)return i.al.black;const Ge=this.style.fog;if(Ge&&this.transform.projection.supportsFog){const ft=this.style.getLut(Ge.scope);if(!Re){const Ve=Ge.properties.get("color-use-theme")==="none",ht=Ge.properties.get("color").toRenderColor(Ve?null:ft).toArray01();return new i.al(...ht)}if(Re){const Ve=Ge.properties.get("space-color-use-theme")==="none",ht=Ge.properties.get("space-color").toRenderColor(Ve?null:ft).toArray01();return new i.al(...ht)}}return i.al.transparent})();if(this.context.clear({color:Ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=R.length-1;this.currentLayer>=0;this.currentLayer--){const Ge=z[this.currentLayer],ft=r.getLayerSourceCache(Ge);if(Ge.isSky())continue;const Ve=ft?(Ge.is3D(v)?be:ae)[ft.id]:void 0;this._renderTileClippingMasks(Ge,ft,Ve),this.renderLayer(this,ft,Ge,Ve)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const Ge=z[this.currentLayer],ft=r.getLayerSourceCache(Ge);Ge.isSky()&&this.renderLayer(this,ft,Ge,ft?ae[ft.id]:void 0)}function nt(Ge,ft){let Ve;return ft&&(Ve=(Ge.type==="symbol"?ce:Ge.is3D(v)?be:ae)[ft.id]),Ve}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<R.length;){const Ge=z[this.currentLayer];if(Ge.type==="raster"||Ge.type==="raster-particle"){const ft=r.getLayerSourceCache(Ge);this.renderLayer(this,ft,Ge,nt(Ge,ft))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let We=0;Se&&(We=Se.getShadowCastingLayerCount());let pt=!1,gt=-1;for(let Ge=0;Ge<R.length;++Ge){const ft=z[Ge];ft.isHidden(this.transform.zoom)||ft.is3D(v)&&(gt=Ge)}N&&gt===-1&&(D=!0);let Ct=!1;for(;this.currentLayer<R.length;){const Ge=z[this.currentLayer],ft=r.getLayerSourceCache(Ge);if(Ge.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ge)){if(Ge.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&Ge.is3D(v)&&!v){const Ve=this.currentLayer,ht=lt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const _t=z[this.currentLayer];if(kf[_t.type]){const it=this.style.getLayerSourceCache(_t);kf[_t.type](this,it,_t,nt(_t,it),lt)}}};ht("initialize"),ht("reset"),this.currentLayer=Ve,Ct=!0}if(D&&!pt&&this.terrain&&!this.transform.isOrthographic&&(pt=!0,this.blitDepth()),N&&gt!==-1&&this.currentLayer===gt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ge,ft,ft?te[ft.id]:void 0),this.renderLayer(this,ft,Ge,nt(Ge,ft)),!this.terrain&&Se&&We>0&&Ge.hasShadowPass()&&--We==0&&(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ve=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ve;this.currentLayer++){const ht=z[this.currentLayer];if(!ht.hasLightBeamPass())continue;const lt=r.getLayerSourceCache(ht);this.renderLayer(this,lt,ht,lt?ae[lt.id]:void 0)}this.currentLayer=Ve,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ve=this.currentLayer;this.depthOcclusion=!0;for(const ht of this.layersWithOcclusionOpacity){this.currentLayer=ht;const lt=z[this.currentLayer],_t=r.getLayerSourceCache(lt),it=_t?ae[_t.id]:void 0;this.terrain||this._renderTileClippingMasks(lt,_t,_t?te[_t.id]:void 0),this.renderLayer(this,_t,lt,it)}this.depthOcclusion=!1,this.currentLayer=Ve,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ge=null;z.forEach(ft=>{const Ve=r.getLayerSourceCache(ft);Ve&&!ft.isHidden(this.transform.zoom)&&Ve.getVisibleCoordinates().length&&(!Ge||Ge.getSource().maxzoom<Ve.getSource().maxzoom)&&(Ge=Ve)}),Ge&&this.options.showTileBoundaries&&Od.debug(this,Ge,Ge.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Od.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ge){const ft=Ge.transform.padding;dg(Ge,Ge.transform.height-(ft.top||0),3,Kc),dg(Ge,ft.bottom||0,3,Xb),hg(Ge,ft.left||0,3,Kb),hg(Ge,Ge.transform.width-(ft.right||0),3,Av);const Ve=Ge.transform.centerPoint;(function(ht,lt,_t,it){Hl(ht,lt-1,_t-10,2,20,it),Hl(ht,lt-10,_t-1,20,2,it)})(Ge,Ve.x,Ge.transform.height-Ve.y,Tf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(r.type);if(Rf[r.type]&&(f||this.terrain&&r.type==="custom")){const _=this.style.getLayerSourceCache(r);Rf[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,a,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||Od[f.type](r,a,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const a={};for(const f in r){const _=r[f],v=this.context.extTimerQuery,S=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),a[f]=S}return a}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let f=0;for(const _ of r)f+=a.getQueryParameter(_,a.QUERY_RESULT)/1e6,a.deleteQuery(_);return f}translatePosMatrix(r,a,f,_,v){if(!f[0]&&!f[1])return r;const S=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(S){const N=Math.sin(S),z=Math.cos(S);f=[f[0]*z-f[1]*N,f[0]*N+f[1]*z]}const R=[v?f[0]:i.at(a,f[0],this.transform.zoom),v?f[1]:i.at(a,f[1],this.transform.zoom),0],D=new Float32Array(16);return i.ad.mat4.translate(D,r,R),D}saveTileTexture(r){const a=r.size[0],f=this._tileTextures[a];f?f.push(r):this._tileTextures[a]=[r]}getTileTexture(r){const a=this._tileTextures[r];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,a,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||_||a!==void 0&&!a||v.push("FOG","FOG_DITHERING"),_&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(r,a){this.cache=this.cache||{};const f=a&&a.defines||[],_=a&&a.config,v=this.currentGlobalDefines(r,a&&a.overrideFog,a&&a.overrideRtt).concat(f),S=_v.cacheKey(Ed[r],r,v,_);return this.cache[S]||(this.cache[S]=new _v(this.context,r,Ed[r],_,ig[r],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,a){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const v=((S,R,D)=>{const N=S.properties.get("direction"),z=S.properties.get("color-use-theme")==="none",B=S.properties.get("color").toRenderColor(z?null:D.getLut(S.scope)).toArray01(),V=S.properties.get("intensity"),X=R.properties.get("color-use-theme")==="none",se=R.properties.get("color").toRenderColor(X?null:D.getLut(R.scope)).toArray01(),te=R.properties.get("intensity"),ae=[N.x,N.y,N.z],ce=i.cN(se,te),_e=i.cN(B,V);return{u_lighting_ambient_color:ce,u_lighting_directional_dir:ae,u_lighting_directional_color:_e,u_ground_radiance:gv(ae,_e,ce)}})(f,_,this.style);a.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,a,f,_,v){if(this.uploadCommonLightUniforms(r,a),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const R=S.getOpacity(this.transform.pitch),D=((N,z,B,V,X,se,te,ae,ce,_e,be,xe)=>{const Ae=N.transform,Se=z.properties.get("color-use-theme")==="none",Te=z.properties.get("color").toRenderColor(Se?null:N.style.getLut(z.scope)).toArray01();Te[3]=V;const Ee=N.frameCounter/1e3%1,[Re,Ne]=z.properties.get("vertical-range");return{u_fog_matrix:B?Ae.calculateFogTileMatrix(B):xe||N.identityMat,u_fog_range:z.getFovAdjustedRange(Ae._fov),u_fog_color:Te,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Re,Ne),Ne],u_fog_temporal_offset:Ee,u_frustum_tl:X,u_frustum_tr:se,u_frustum_br:te,u_frustum_bl:ae,u_globe_pos:ce,u_globe_radius:_e,u_viewport:be,u_globe_transition:i.ag(Ae.zoom),u_is_globe:+(Ae.projection.name==="globe")}})(this,S,f,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],_);a.setFogUniformValues(r,D)}v&&a.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)a[_.key]=r[_.key]||new Po(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,a){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[r.key];return a||(this._cachedTileFogOpacities[r.key]=a=this.style.fog.getOpacityForTile(r)),a[0]>=jt||a[1]>=jt}setupDepthForOcclusion(r,a,f){const _=this.context,v=_.gl,S=!!f;var R;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(v.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE0),S||a.setTerrainUniformValues(_,f)}}function Lf(p,r){let a=!1,f=null;const _=()=>{f=null,a&&(p(),f=setTimeout(_,r),a=!1)};return()=>(a=!0,f||_(),f)}class Sg{constructor(r){this._hashName=r&&encodeURIComponent(r),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Lf(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const a=Tg(r);if(this._hashName){const f=this._hashName;let _=!1;const v=location.hash.slice(1).split("&").map(S=>{const R=S.split("=")[0];return R===f?(_=!0,`${R}=${a}`):S}).filter(S=>S);return _||v.push(`${f}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){const f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(a[3]||0):r.getBearing();return r.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Tg(p,r){const a=p.getCenter(),f=Math.round(100*p.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),S=Math.round(a.lng*v)/v,R=Math.round(a.lat*v)/v,D=p.getBearing(),N=p.getPitch();let z=r?`/${S}/${R}/${f}`:`${f}/${R}/${S}`;return(D||N)&&(z+="/"+Math.round(10*D)/10),N&&(z+=`/${Math.round(N)}`),z}const zd={linearity:.3,easing:i.dB(0,0,.3,1)},Pv=i.l({deceleration:2500,maxSpeed:1400},zd),Rv=i.l({deceleration:20,maxSpeed:1400},zd),kv=i.l({deceleration:1e3,maxSpeed:360},zd),Dv=i.l({deceleration:1e3,maxSpeed:90},zd);class Lv{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,a=i.q.now();for(;r.length>0&&a-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const v=Fd(a.pan.mag(),f,i.l({},Pv,r||{}));_.offset=a.pan.mult(v.amount/a.pan.mag()),_.center=this._map.transform.center,jd(_,v)}if(a.zoom){const v=Fd(a.zoom,f,Rv);_.zoom=this._map.transform.zoom+v.amount,jd(_,v)}if(a.bearing){const v=Fd(a.bearing,f,kv);_.bearing=this._map.transform.bearing+i.ay(v.amount,-179,179),jd(_,v)}if(a.pitch){const v=Fd(a.pitch,f,Dv);_.pitch=this._map.transform.pitch+v.amount,jd(_,v)}if(_.zoom||_.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function jd(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function Fd(p,r,a){const{maxSpeed:f,linearity:_,deceleration:v}=a,S=i.ay(p*_/(r/1e3),-f,f),R=Math.abs(S)/(v*_);return{easing:a.easing,duration:1e3*R,amount:S*(R/2)}}class ks extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f,_={}){const v=Be(a.getCanvasContainer(),f),S=a.unproject(v);super(r,i.l({point:v,lngLat:S,originalEvent:f},_)),this._defaultPrevented=!1,this.target=a}}class Bd extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a,f){const _=r==="touchend"?f.changedTouches:f.touches,v=dt(a.getCanvasContainer(),_),S=v.map(D=>a.unproject(D)),R=v.reduce((D,N,z,B)=>D.add(N.div(B.length)),new i.P(0,0));super(r,{points:v,point:R,lngLats:S,lngLat:a.unproject(R),originalEvent:f}),this._defaultPrevented=!1}}class Nv extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Ov{constructor(r,a){this._map=r,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Nv(this._map,r))}mousedown(r,a){return this._mousedownPos=a,this._firePreventable(new ks(r.type,this._map,r))}mouseup(r){this._map.fire(new ks(r.type,this._map,r))}preclick(r){const a=i.l({},r);a.type="preclick",this._map.fire(new ks(a.type,this._map,a))}click(r,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ks(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ks(r.type,this._map,r))}mouseover(r){this._map.fire(new ks(r.type,this._map,r))}mouseout(r){this._map.fire(new ks(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Bd(r.type,this._map,r))}touchmove(r){this._map.fire(new Bd(r.type,this._map,r))}touchend(r){this._map.fire(new Bd(r.type,this._map,r))}touchcancel(r){this._map.fire(new Bd(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jb{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new ks(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ks("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ks(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qb{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,a){this.isEnabled()&&r.shiftKey&&r.button===0&&(fe(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(r,a){if(!this._active)return;const f=a,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=K("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(_.x,f.x),R=Math.max(_.x,f.x),D=Math.min(_.y,f.y),N=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=R-S+"px",this._box.style.height=N-D+"px")})}mouseupWindow(r,a){if(!this._active)return;const f=this._startPos,_=a;if(f&&r.button===0){if(this.reset(),Ce(),f.x!==_.x||f.y!==_.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ge(),delete this._startPos,delete this._lastPos}_fireEvent(r,a){return this._map.fire(new i.A(r,{originalEvent:a}))}}function Rn(p,r){const a={};for(let f=0;f<p.length;f++)a[p[f].identifier]=r[f];return a}class zv{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const v=new i.P(0,0);for(const S of _)v._add(S);return v.div(_.length)}(a),this.touches=Rn(f,a)))}touchmove(r,a,f){if(this.aborted||!this.centroid)return;const _=Rn(f,a);for(const v in this.touches){const S=_[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,a,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Eg{constructor(r){this.singleTap=new zv(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,a,f){this.singleTap.touchstart(r,a,f)}touchmove(r,a,f){this.singleTap.touchmove(r,a,f)}touchend(r,a,f){const _=this.singleTap.touchend(r,a,f);if(_){const v=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(_)<30;if(v&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class ew{constructor(){this._zoomIn=new Eg({numTouches:1,numTaps:2}),this._zoomOut=new Eg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,a,f){this._zoomIn.touchstart(r,a,f),this._zoomOut.touchstart(r,a,f)}touchmove(r,a,f){this._zoomIn.touchmove(r,a,f),this._zoomOut.touchmove(r,a,f)}touchend(r,a,f){const _=this._zoomIn.touchend(r,a,f),v=this._zoomOut.touchend(r,a,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(_)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ud={0:1,2:2},Cg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Vd{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,a){return!1}_move(r,a){return{}}mousedown(r,a){if(this._lastPoint)return;const f=Qe(r);this._correctButton(r,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(r,a){const f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(_,v){const S=Ud[v];return _.buttons===void 0||(_.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(r){this._lastPoint&&Qe(r)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nf extends Vd{mousedown(r,a){super.mousedown(r,a),this._lastPoint&&(this._active=!0)}_correctButton(r,a){return a===0&&!r.ctrlKey}_move(r,a){return{around:a,panDelta:a.sub(r)}}}class ra extends Vd{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Cg[r.pitchRotateKey]:void 0}_correctButton(r,a){return this._pitchRotateKey?a===0&&r[this._pitchRotateKey]:a===0&&r.ctrlKey||a===2}_move(r,a){const f=.8*(a.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class $d extends Vd{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Cg[r.pitchRotateKey]:void 0}_correctButton(r,a){return this._pitchRotateKey?a===0&&r[this._pitchRotateKey]:a===0&&r.ctrlKey||a===2}_move(r,a){const f=-.5*(a.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Qn{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,a,f){return this._calculateTransform(r,a,f)}touchmove(r,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,a,f)}}touchend(r,a,f){this._calculateTransform(r,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,a,f){f.length>0&&(this._active=!0);const _=Rn(f,a),v=new i.P(0,0),S=new i.P(0,0);let R=0;for(const N in _){const z=_[N],B=this._touches[N];B&&(v._add(z),S._add(z.sub(B)),R++,_[N]=z)}if(this._touches=_,R<this._minTouches||!S.mag())return;const D=S.div(R);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(R),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class _o{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,a,f){return{}}touchstart(r,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(r,a,f){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[v,S]=_,R=eu(f,a,v),D=eu(f,a,S);if(!R||!D)return;const N=this._aroundCenter?null:R.add(D).div(2);return this._move([R,D],N,r)}touchend(r,a,f){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,S=eu(f,a,_),R=eu(f,a,v);S&&R||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function eu(p,r,a){for(let f=0;f<p.length;f++)if(p[f].identifier===a)return r[f]}function Gd(p,r){return Math.log(p/r)/Math.LN2}class jv extends _o{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,a){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Gd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gd(this._distance,f),pinchAround:a}}}function Fv(p,r){return 180*p.angleWith(r)/Math.PI}class qd extends _o{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,a){const f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Fv(this._vector,f),pinchAround:a}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=Fv(r,f);return Math.abs(_)<a}}function Ag(p){return Math.abs(p.y)>Math.abs(p.x)}class tw extends _o{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ag(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,a,f){const _=this._lastPoints;if(!_)return;const v=r[0].sub(_[0]),S=r[1].sub(_[1]);return this._map._cooperativeGestures&&!i.dC()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(r,a,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,v=a.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=r.y>0==a.y>0;return Ag(r)&&Ag(a)&&S}}const Mg={panStep:100,bearingStep:15,pitchStep:10};class Ig{constructor(){const r=Mg;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let a=0,f=0,_=0,v=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:R=>{const D=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Hd,zoom:a?Math.round(D)+a*(r.shiftKey?2:1):D,bearing:R.getBearing()+f*this._bearingStep,pitch:R.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:R.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hd(p){return p*(2-p)}const Xl=4.000244140625,Pa=1/450;class No{constructor(r,a){this._map=r,this._el=r.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Pa,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=i.q.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%Xl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),r.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=r,this._delta-=a,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Be(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Xl?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&z!==0&&(z=1/z);const B=a(),V=Math.pow(2,B),X=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(X*z))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,v=this._easing;let S,R=!1;if(this._type==="wheel"&&_&&v){const N=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),z=v(N);S=i.ah(_,f,z),N<1?this._frameId||(this._frameId=!0):R=!0}else S=f,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=S-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let a=i.dD;if(this._prevEase){const f=this._prevEase,_=(i.q.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),S=.27/Math.sqrt(v*v+1e-4)*.01,R=Math.sqrt(.0729-S*S);a=i.dB(S,R,.25,1)}return this._prevEase={start:i.q.now(),duration:r,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class gl{constructor(r,a){this._clickZoom=r,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,a){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _l{constructor(){this._tap=new Eg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,a,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,a,f))}touchmove(r,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=a[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,a,f)}touchend(r,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,a,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rw{constructor(r,a,f){this._el=r,this._mousePan=a,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class nw{constructor(r,a,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class iw{constructor(r,a,f,_){this._el=r,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Of=p=>p.zoom||p.drag||p.pitch||p.rotate;class Bv extends i.A{}class fs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,a){const f=i.ad.vec3.sub([],a,r);this.radius=i.ad.vec3.length(f[2]<0?i.ad.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(r){i.ad.vec3.div(r,r,this.constants),i.ad.vec3.normalize(r,r),i.ad.vec3.mul(r,r,this.constants);const a=i.ad.vec3.scale([],r,this.radius);if(a[2]>0){const f=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(a,[0,0,1])),_=i.ad.vec3.scale([],i.ad.vec3.normalize([],[a[0],a[1],0]),this.radius),v=i.ad.vec3.add([],a,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],_,f),a),2));a[0]=v[0],a[1]=v[1]}return a}}function tu(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Uv{constructor(r,a){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lv(r),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),i.aQ(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,S]of this._listeners){const R=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,R,S)}}destroy(){for(const[r,a,f]of this._listeners){const _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(a,_,f)}}_addDefaultHandlers(r){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new Ov(a,r));const _=a.boxZoom=new Qb(a,r);this._add("boxZoom",_);const v=new ew,S=new Kl;a.doubleClickZoom=new gl(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const R=new _l;this._add("tapDragZoom",R);const D=a.touchPitch=new tw(a);this._add("touchPitch",D);const N=new ra(r),z=new $d(r);a.dragRotate=new nw(r,N,z),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new Nf(r),V=new Qn(a,r);a.dragPan=new rw(f,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]);const X=new qd,se=new jv;a.touchZoomRotate=new iw(f,se,X,R),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Jb(a));const te=a.scrollZoom=new No(a,this);this._add("scrollZoom",te,["mousePan"]);const ae=a.keyboard=new Ig;this._add("keyboard",ae);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ce]&&a[ce].enable(r[ce])}_add(r,a,f){this._handlers.push({handlerName:r,handler:a,allowed:f}),this._handlersById[r]=a}stop(r){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Of(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,a,f){for(const _ in r)if(_!==f&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const a=[];for(const f of r)this._el.contains(f.target)&&a.push(f);return a}handleEvent(r,a){this._updatingCamera=!0;const f=r.type==="renderFrame",_=f?void 0:r,v={needsRenderFrame:!1},S={},R={},D=r.touches?this._getMapTouches(r.touches):void 0,N=D?dt(this._el,D):f?void 0:Be(this._el,r);for(const{handlerName:V,handler:X,allowed:se}of this._handlers){if(!X.isEnabled())continue;let te;this._blockedByActive(R,se,V)?X.reset():X[a||r.type]&&(te=X[a||r.type](r,N,D),this.mergeHandlerResult(v,S,te,V,_),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||X.isActive())&&(R[V]=X)}const z={};for(const V in this._previousActiveHandlers)R[V]||(z[V]=_);this._previousActiveHandlers=R,(Object.keys(z).length||tu(v))&&(this._changes.push([v,S,z]),this._triggerRenderFrame()),(Object.keys(R).length||tu(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=v;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(r,a,f,_,v){if(!f)return;i.l(r,f);const S={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(a.zoom=S),f.panDelta!==void 0&&(a.drag=S),f.pitchDelta!==void 0&&(a.pitch=S),f.bearingDelta!==void 0&&(a.rotate=S)}_applyChanges(){const r={},a={},f={};for(const[_,v,S]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),i.l(a,v),i.l(f,S);this._updateMapTransform(r,a,f),this._changes=[]}_updateMapTransform(r,a,f){const _=this._map,v=_.transform,S=_e=>[_e.x,_e.y,_e.z];if((_e=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!tu(r)){const _e=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),_e!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!tu(r))return void this._fireEvents(a,f,!0);let{panDelta:R,zoomDelta:D,bearingDelta:N,pitchDelta:z,around:B,aroundCoord:V,pinchAround:X}=r;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),X!==void 0&&(B=X),(D||(_e=>a[_e]&&!this._eventsInProgress[_e])("drag"))&&B&&(this._dragOrigin=S(v.pointCoordinate3D(B)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),B=B||_.transform.centerPoint,N&&(v.bearing+=N),z&&(v.pitch+=z),v._updateCameraState();const se=[0,0,0];if(R)if(v.projection.name==="mercator"){const _e=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B).dir),be=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B.sub(R)).dir);se[0]=be[0]-_e[0],se[1]=be[1]-_e[1]}else{const _e=v.pointCoordinate(B);if(v.projection.name==="globe"){R=R.rotate(-v.angle);const be=v._pixelsPerMercatorPixel/v.worldSize;se[0]=-R.x*i.dE(i.aT(_e.y))*be,se[1]=-R.y*i.dE(v.center.lat)*be}else{const be=v.pointCoordinate(B.sub(R));_e&&be&&(se[0]=be.x-_e.x,se[1]=be.y-_e.y)}}const te=v.zoom,ae=[0,0,0];if(D){const _e=S(V||v.pointCoordinate3D(B)),be={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],_e,v._camera.position))};if(be.dir[2]<0){const xe=v.zoomDeltaToMovement(_e,D);i.ad.vec3.scale(ae,be.dir,xe)}}const ce=i.ad.vec3.add(se,se,ae);v._translateCameraConstrained(ce),D&&Math.abs(v.zoom-te)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(a,f,!0)}_fireEvents(r,a,f){const _=Of(this._eventsInProgress),v=Of(r),S={};for(const z in r){const{originalEvent:B}=r[z];this._eventsInProgress[z]||(S[`${z}start`]=B),this._eventsInProgress[z]=r[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in S)this._fireEvent(z,S[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in r){const{originalEvent:B}=r[z];this._fireEvent(z,B)}const R={};let D;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],D=a[B]||V,R[`${z}end`]=D)}for(const z in R)this._fireEvent(z,R[z]);const N=Of(this._eventsInProgress);if(f&&(_||v)&&!N){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:D})):(this._map.fire(new i.A("moveend",{originalEvent:D})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,a){this._map.fire(new i.A(r,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Bv("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ru extends i.E{constructor(r,a){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(r,a){return this.jumpTo({center:r},a)}panBy(r,a,f){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.l({offset:r},a),f)}panTo(r,a,f){return this.easeTo(i.l({center:r},a),f)}getZoom(){return this.transform.zoom}setZoom(r,a){return this.jumpTo({zoom:r},a),this}zoomTo(r,a,f){return this.easeTo(i.l({zoom:r},a),f)}zoomIn(r,a){return this.zoomTo(this.getZoom()+1,r,a),this}zoomOut(r,a){return this.zoomTo(this.getZoom()-1,r,a),this}getBearing(){return this.transform.bearing}setBearing(r,a){return this.jumpTo({bearing:r},a),this}getPadding(){return this.transform.padding}setPadding(r,a){return this.jumpTo({padding:r},a),this}rotateTo(r,a,f){return this.easeTo(i.l({bearing:r},a),f)}resetNorth(r,a){return this.rotateTo(0,i.l({duration:1e3},r),a),this}resetNorthPitch(r,a){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},r),a),this}snapToNorth(r,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,a):this}getPitch(){return this.transform.pitch}setPitch(r,a){return this.jumpTo({pitch:r},a),this}cameraForBounds(r,a){r=i.aB.convert(r);const f=a&&a.bearing||0,_=a&&a.pitch||0,v=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,v,S,f,_,a)}_extendPadding(r){const a={top:0,right:0,bottom:0,left:0};return r==null?i.l({},a,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:i.l({},a,r)}_extendCameraOptions(r){return(r=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,a){const f=a.max[0]-a.min[0],_=a.max[1]-a.min[1];return f/_>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,a,f,_,v,S){const R=r.clone(),D=this._extendCameraOptions(S);R.bearing=_,R.pitch=v;const N=i.bO.convert(a),z=i.bO.convert(f),B=.5*(N.lat+z.lat),V=.5*(N.lng+z.lng),X=i.dF(B,V),se=i.ad.vec3.normalize([],X),te=i.ad.vec3.normalize([],i.ad.vec3.cross([],se,[0,1,0])),ae=i.ad.vec3.cross([],te,se),ce=[te[0],te[1],te[2],0,ae[0],ae[1],ae[2],0,se[0],se[1],se[2],0,0,0,0,1],_e=[X,i.dF(N.lat,N.lng),i.dF(z.lat,N.lng),i.dF(z.lat,z.lng),i.dF(N.lat,z.lng),i.dF(B,N.lng),i.dF(B,z.lng),i.dF(N.lat,V),i.dF(z.lat,V)];let be=i.ce.fromPoints(_e.map(lt=>[i.ad.vec3.dot(te,lt),i.ad.vec3.dot(ae,lt),i.ad.vec3.dot(se,lt)]));const xe=i.ad.vec3.transformMat4([],be.center,ce);i.ad.vec3.squaredLength(xe)===0&&i.ad.vec3.set(xe,0,0,1),i.ad.vec3.normalize(xe,xe),i.ad.vec3.scale(xe,xe,i.az),R.center=i.dG(xe);const Ae=R.getWorldToCameraMatrix(),Se=i.ad.mat4.invert(new Float64Array(16),Ae);be=i.ce.applyTransform(be,i.ad.mat4.multiply([],Ae,ce));const Te=this._extendAABB(be,R,D,_);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=Te,i.ad.vec3.transformMat4(xe,xe,Ae);const Ee=.5*(be.max[2]-be.min[2]),Re=this._minimumAABBFrustumDistance(R,be),Ne=i.ad.vec3.scale([],[0,0,1],Ee),nt=i.ad.vec3.add(Ne,xe,Ne),We=Re+(R.pitch===0?0:i.ad.vec3.distance(xe,nt)),pt=R.globeCenterInViewSpace,gt=i.ad.vec3.sub([],xe,[pt[0],pt[1],pt[2]]);i.ad.vec3.normalize(gt,gt),i.ad.vec3.scale(gt,gt,We);const Ct=i.ad.vec3.add([],xe,gt);i.ad.vec3.transformMat4(Ct,Ct,Se);const Ge=i.dv/i.az,ft=i.ad.vec3.length(Ct),Ve=i.bH(Math.max(ft*Ge-i.dv,Number.EPSILON),0),ht=Math.min(R.zoomFromMercatorZAdjusted(Ve),D.maxZoom);return ht>.5*(i.c6+i.bY)?(R.setProjection({name:"mercator"}),R.zoom=ht,this._cameraForBounds(R,a,f,_,v,S)):{center:R.center,zoom:ht,bearing:_,pitch:v}}_extendAABB(r,a,f,_){const v=.5*((f.padding.left||0)+(f.padding.right||0)),S=.5*((f.padding.top||0)+(f.padding.bottom||0)),R=S,D=v,N=v,z=S,B=a.width-(D+N),V=a.height-(R+z),X=i.ad.vec3.sub([],r.max,r.min),se=Math.min(B/X[0],V/X[1]),te=Math.min(a.scaleZoom(a.scale*se),f.maxZoom);if(isNaN(te))return null;const ae=a.scale/a.zoomScale(te),ce=new i.ce([r.min[0]-D*ae,r.min[1]-z*ae,r.min[2]],[r.max[0]+N*ae,r.max[1]+R*ae,r.max[2]]),_e=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new i.P(f.offset.x,f.offset.y):i.P.convert(f.offset)).rotate(-i.ak(_));return ce.center[0]-=_e.x*ae,ce.center[1]+=_e.y*ae,ce}queryTerrainElevation(r,a){const f=this.transform.elevation;return f?(a=i.l({},{exaggerated:!0},a),f.getAtPoint(i.ac.fromLngLat(r),null,a.exaggerated)):null}_cameraForBounds(r,a,f,_,v,S){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,a,f,_,v,S);const R=r.clone(),D=this._extendCameraOptions(S);R.bearing=_,R.pitch=v;const N=i.bO.convert(a),z=i.bO.convert(f),B=new i.bO(N.lng,z.lat),V=new i.bO(z.lng,N.lat),X=R.project(N),se=R.project(z),te=this.queryTerrainElevation(N),ae=this.queryTerrainElevation(z),ce=this.queryTerrainElevation(B),_e=this.queryTerrainElevation(V),be=[[X.x,X.y,Math.min(te||0,ae||0,ce||0,_e||0)],[se.x,se.y,Math.max(te||0,ae||0,ce||0,_e||0)]];let xe=i.ce.fromPoints(be);const Ae=R.getWorldToCameraMatrix(),Se=i.ad.mat4.invert(new Float64Array(16),Ae);xe=i.ce.applyTransform(xe,Ae);const Te=this._extendAABB(xe,R,D,_);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=Te;const Ee=.5*i.ad.vec3.sub([],xe.max,xe.min)[2],Re=this._minimumAABBFrustumDistance(R,xe),Ne=[0,0,1,0];i.ad.vec4.transformMat4(Ne,Ne,Ae),i.ad.vec4.normalize(Ne,Ne);const nt=i.ad.vec3.scale([],Ne,Re+Ee),We=i.ad.vec3.add([],xe.center,nt);i.ad.vec3.transformMat4(xe.center,xe.center,Se),i.ad.vec3.transformMat4(We,We,Se);const pt=R.unproject(new i.P(xe.center[0],xe.center[1])),gt=i.dH(R.projection,pt),Ct=Math.pow(2,gt),Ge=Math.min(R._zoomFromMercatorZ(We[2]*R.pixelsPerMeter*Ct/R.worldSize),D.maxZoom);return R.mercatorFromTransition&&Ge<.5*(i.c6+i.bY)?(R.setProjection({name:"globe"}),R.zoom=Ge,this._cameraForBounds(R,a,f,_,v,S)):{center:pt,zoom:Ge,bearing:_,pitch:v}}fitBounds(r,a,f){const _=this.cameraForBounds(r,a);return this._fitInternal(_,a,f)}fitScreenCoordinates(r,a,f,_,v){const S=i.P.convert(r),R=i.P.convert(a),D=new i.P(Math.min(S.x,R.x),Math.min(S.y,R.y)),N=new i.P(Math.max(S.x,R.x),Math.max(S.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,R))return this;const z=this.transform.pointLocation3D(D),B=this.transform.pointLocation3D(N),V=this.transform.pointLocation3D(new i.P(D.x,N.y)),X=this.transform.pointLocation3D(new i.P(N.x,D.y)),se=[Math.min(z.lng,B.lng,V.lng,X.lng),Math.min(z.lat,B.lat,V.lat,X.lat)],te=[Math.max(z.lng,B.lng,V.lng,X.lng),Math.max(z.lat,B.lat,V.lat,X.lat)],ae=_&&_.pitch?_.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,se,te,f,ae,_);return this._fitInternal(ce,_,v)}_fitInternal(r,a,f){return r?(a=i.l(r,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(r,a){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,S=!1;"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=i.bO.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(v=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(S=!0,f.pitch=+r.pitch);const R=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!f.isPaddingEqual(R))if(r.retainPadding===!1){const D=f.clone();D.padding=R,f.setLocationAtPoint(f.center,D.centerPoint)}else f.padding=R;return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new i.A("movestart",a)).fire(new i.A("move",a)),_&&this.fire(new i.A("zoomstart",a)).fire(new i.A("zoom",a)).fire(new i.A("zoomend",a)),v&&this.fire(new i.A("rotatestart",a)).fire(new i.A("rotate",a)).fire(new i.A("rotateend",a)),S&&this.fire(new i.A("pitchstart",a)).fire(new i.A("pitch",a)).fire(new i.A("pitchend",a)),this.fire(new i.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Vv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return i.w(Vv),this;this.stop();const _=f.zoom,v=f.pitch,S=f.bearing;f.setFreeCameraOptions(r);const R=_!==f.zoom,D=v!==f.pitch,N=S!==f.bearing;return this.fire(new i.A("movestart",a)).fire(new i.A("move",a)),R&&this.fire(new i.A("zoomstart",a)).fire(new i.A("zoom",a)).fire(new i.A("zoomend",a)),N&&this.fire(new i.A("rotatestart",a)).fire(new i.A("rotate",a)).fire(new i.A("rotateend",a)),D&&this.fire(new i.A("pitchstart",a)).fire(new i.A("pitch",a)).fire(new i.A("pitchend",a)),this.fire(new i.A("moveend",a)),this}easeTo(r,a){this._stop(!1,r.easeId),((r=i.l({offset:[0,0],duration:500,easing:i.dD},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const f=this.transform,_=this.getZoom(),v=this.getBearing(),S=this.getPitch(),R=this.getPadding(),D="zoom"in r?+r.zoom:_,N="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:S,B=this._extendPadding(r.padding),V=i.P.convert(r.offset);let X,se,te;if(f.projection.name==="globe"){const Ne=i.ac.fromLngLat(f.center),nt=V.rotate(-f.angle);Ne.x+=nt.x/f.worldSize,Ne.y+=nt.y/f.worldSize;const We=Ne.toLngLat(),pt=i.bO.convert(r.center||We);this._normalizeCenter(pt),X=f.centerPoint.add(nt),se=new i.P(Ne.x,Ne.y).mult(f.worldSize),te=new i.P(i.av(pt.lng),i.aC(pt.lat)).mult(f.worldSize).sub(se)}else{X=f.centerPoint.add(V);const Ne=f.pointLocation(X),nt=i.bO.convert(r.center||Ne);this._normalizeCenter(nt),se=f.project(Ne),te=f.project(nt).sub(se)}const ae=f.zoomScale(D-_);let ce,_e;r.around&&(ce=i.bO.convert(r.around),_e=f.locationPoint(ce));const be=this._zooming||D!==_,xe=this._rotating||v!==N,Ae=this._pitching||z!==S,Se=!f.isPaddingEqual(B),Te=r.retainPadding===!1?f.clone():f,Ee=Ne=>nt=>{if(be&&(Ne.zoom=i.ah(_,D,nt)),xe&&(Ne.bearing=i.ah(v,N,nt)),Ae&&(Ne.pitch=i.ah(S,z,nt)),Se&&(Te.interpolatePadding(R,B,nt),X=Te.centerPoint.add(V)),ce)Ne.setLocationAtPoint(ce,_e);else{const We=Ne.zoomScale(Ne.zoom-_),pt=D>_?Math.min(2,ae):Math.max(.5,ae),gt=Math.pow(pt,1-nt),Ct=Ne.unproject(se.add(te.mult(nt*gt)).mult(We));Ne.setLocationAtPoint(Ne.renderWorldCopies?Ct.wrap():Ct,X)}return r.preloadOnly||this._fireMoveEvents(a),Ne};if(r.preloadOnly){const Ne=this._emulate(Ee,r.duration,f);return this._preloadTiles(Ne),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=xe,this._pitching=Ae,this._padding=Se,this._easeId=r.easeId,this._prepareEase(a,r.noMoveStart,Re),this._ease(Ee(f),Ne=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,Ne)},r),this}_prepareEase(r,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new i.A("movestart",r)),this._zooming&&!f.zooming&&this.fire(new i.A("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new i.A("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new i.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.A("move",r)),this._zooming&&this.fire(new i.A("zoom",r)),this._rotating&&this.fire(new i.A("rotate",r)),this._pitching&&this.fire(new i.A("pitch",r))}_afterEase(r,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new i.A("zoomend",r)),_&&this.fire(new i.A("rotateend",r)),v&&this.fire(new i.A("pitchend",r)),this.fire(new i.A("moveend",r))}flyTo(r,a){if(this._prefersReducedMotion(r)){const lt=i.aA(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(lt,a)}this.stop(),r=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},r);const f=this.transform,_=this.getZoom(),v=this.getBearing(),S=this.getPitch(),R=this.getPadding(),D="zoom"in r?i.ay(+r.zoom,f.minZoom,f.maxZoom):_,N="bearing"in r?this._normalizeBearing(r.bearing,v):v,z="pitch"in r?+r.pitch:S,B=this._extendPadding(r.padding),V=f.zoomScale(D-_),X=i.P.convert(r.offset);let se=f.centerPoint.add(X);const te=f.pointLocation(se),ae=i.bO.convert(r.center||te);this._normalizeCenter(ae);const ce=f.project(te),_e=f.project(ae).sub(ce);let be=r.curve;const xe=Math.max(f.width,f.height),Ae=xe/V,Se=_e.mag();if("minZoom"in r){const lt=i.ay(Math.min(r.minZoom,_,D),f.minZoom,f.maxZoom),_t=xe/f.zoomScale(lt-_);be=Math.sqrt(_t/Se*2)}const Te=be*be;function Ee(lt){const _t=(Ae*Ae-xe*xe+(lt?-1:1)*Te*Te*Se*Se)/(2*(lt?Ae:xe)*Te*Se);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Re(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Ne(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const nt=Ee(0);let We=function(lt){return Ne(nt)/Ne(nt+be*lt)},pt=function(lt){return xe*((Ne(nt)*(Re(_t=nt+be*lt)/Ne(_t))-Re(nt))/Te)/Se;var _t},gt=(Ee(1)-nt)/be;if(Math.abs(Se)<1e-6||!isFinite(gt)){if(Math.abs(xe-Ae)<1e-6)return this.easeTo(r,a);const lt=Ae<xe?-1:1;gt=Math.abs(Math.log(Ae/xe))/be,pt=function(){return 0},We=function(_t){return Math.exp(lt*be*_t)}}r.duration="duration"in r?+r.duration:1e3*gt/("screenSpeed"in r?+r.screenSpeed/be:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ct=v!==N,Ge=z!==S,ft=!f.isPaddingEqual(B),Ve=r.retainPadding===!1?f.clone():f,ht=lt=>_t=>{const it=_t*gt,vt=1/We(it);lt.zoom=_t===1?D:_+lt.scaleZoom(vt),Ct&&(lt.bearing=i.ah(v,N,_t)),Ge&&(lt.pitch=i.ah(S,z,_t)),ft&&(Ve.interpolatePadding(R,B,_t),se=Ve.centerPoint.add(X));const Lt=_t===1?ae:lt.unproject(ce.add(_e.mult(pt(it))).mult(vt));return lt.setLocationAtPoint(lt.renderWorldCopies?Lt.wrap():Lt,se),lt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(a),lt};if(r.preloadOnly){const lt=this._emulate(ht,r.duration,f);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=Ct,this._pitching=Ge,this._padding=ft,this._prepareEase(a,!1),this._ease(ht(f),()=>this._afterEase(a),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,a,f){f.animate===!1||f.duration===0?(r(1),a()):(this._easeStart=i.q.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,a){r=i.bF(r,-180,180);const f=Math.abs(r-a);return Math.abs(r-360-a)<f&&(r-=360),Math.abs(r+360-a)<f&&(r+=360),r}_normalizeCenter(r){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const f=r.lng-a.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,a,f){const _=Math.ceil(15*a/1e3),v=[],S=r(f.clone());for(let R=0;R<=_;R++){const D=S(R/_);v.push(D.clone())}return v}_preloadTiles(r,a){}}class zf{constructor(r={}){this.options=r,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const a=this.options&&this.options.compact,f=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=K("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=K("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(r){const f=a.reduce((_,v,S)=>(v.value&&(_+=`${v.key}=${v.value}${S<a.length-1?"&":""}`),_),"?");r.href=`${i.e.FEEDBACK_URL}/${f}#${Tg(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._mergedSourceCaches;for(const _ in a){const v=a[_];if(v.used){const S=v.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((_,v)=>_.length-v.length),r=r.filter((_,v)=>{for(let S=v+1;S<r.length;S++)if(r[S].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xs{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=K("div","mapboxgl-ctrl");const a=K("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const a in r){const f=r[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Ks{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const a=++this._id;return this._queue.push({callback:r,id:a,cancelled:!1}),a}remove(r){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class nu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const a=i.cC((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,a,f){this._start=this.getValue(a),this._end=r,this._startTime=a,this._endTime=a+f}}const Yl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Jl extends i.A{constructor(r,a,f,_){const{point:v,lngLat:S,originalEvent:R,target:D}=r;super(r.type,{point:v,lngLat:S,originalEvent:R,target:D}),this.preventDefault=()=>{r.preventDefault()},this.id=a,this.interaction=f,this.feature=_}}class Pg{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,a){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const f=a.filter;let _=a.type;f&&this.filters.set(r,i.a_(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const v=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,a)):v.size===0&&this.map.on(_,this.handleType),v.size===0&&this.interactionsByType.set(_,v),v.set(r,a),this.typeById.set(r,_)}get(r){const a=this.typeById.get(r);if(!a)return;const f=this.interactionsByType.get(a);return f?f.get(r):void 0}remove(r){const a=this.typeById.get(r);if(!a)return;this.typeById.delete(r),this.filters.delete(r);const f=this.interactionsByType.get(a);f&&(f.delete(r),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(a,this.handleType))}queryTargets(r,a){const f=[];for(const[_,v]of a)v.target&&f.push({targetId:_,target:v.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(r,f,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());a.length&&(r.type="mouseenter",this.handleType(r,a));const f=new Map;for(const[_,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(v.id,v);f.size&&(r.type="mouseleave",this.handleType(r,Array.from(f.values())))}handleOut(r){const a=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);a.length&&(r.type="mouseleave",this.handleType(r,a)),this.hoveredFeatures.clear()}handleType(r,a){const f=Array.from(this.interactionsByType.get(r.type)).reverse(),_=!!a;a=a||this.queryTargets(r.point,f);const v=r.type==="mouseenter";let S=!1;const R=new Set;for(const D of a){for(const[N,z]of f){if(!z.target)continue;const B=D.variants?D.variants[N]:null;if(B){for(const V of B){if(bc(V,D,R,N))continue;const X=new i.cx(D,V),se=hd(V,D,N);_&&(X.state=this.map.getFeatureState(X));const te=v?this.prevHoveredFeatures.get(se):null,ae=new Jl(r,N,z,X),ce=te?te.stop:z.handler(ae);if(v&&this.hoveredFeatures.set(se,{feature:D,stop:ce}),ce!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[D,N]of f){const{handler:z,target:B}=N;if(!B&&z(new Jl(r,D,N,null))!==!1)break}}}function Qr(p,r){if(Array.isArray(p)&&Array.isArray(r)){const a=new Set(p),f=new Set(r);return a.size===f.size&&p.every(_=>f.has(_))}return i.bn(p,r)}const yl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},sw={showCompass:!0,showZoom:!0,visualizePitch:!1};class ow{constructor(r,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new ra({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new $d({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(r,a){this.mouseRotate.mousedown(r,a),this.mousePitch&&this.mousePitch.mousedown(r,a),fe()}move(r,a){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,a),v=_&&_.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(r,a),R=S&&S.pitchDelta;R&&f.setPitch(f.getPitch()+R)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ge(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.l({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Be(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Be(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=dt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=dt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function jf(p,r,a){if(p=new i.bO(p.lng,p.lat),r){const f=new i.bO(p.lng-360,p.lat),_=new i.bO(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-a.center.lng)/360),S=a.locationPoint3D(p).distSqr(r),R=r.x<0||r.y<0||r.x>a.width||r.y>a.height;a.locationPoint3D(f).distSqr(r)<S&&(R||Math.abs(f.lng-a.center.lng)<v)?p=f:a.locationPoint3D(_).distSqr(r)<S&&(R||Math.abs(_.lng-a.center.lng)<v)&&(p=_)}for(;Math.abs(p.lng-a.center.lng)>180;){const f=a.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p}const na={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ds={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class qi extends i.E{constructor(r,a){super(),(r instanceof HTMLElement||a)&&(r=i.l({element:r},a)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),r=i.l({},Ds,r),this._anchor=r.anchor,this._color=r.color,this._scale=r.scale,this._draggable=r.draggable,this._clickTolerance=r.clickTolerance,this._rotation=r.rotation,this._rotationAlignment=r.rotationAlignment,this._pitchAlignment=r.pitchAlignment,this._occludedOpacity=r.occludedOpacity,this._altitude=r.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const f=this._element.classList;for(const v in na)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const _=r&&r.className?r.className.trim().split(/\s+/):[];f.add(..._),this._popup=null}_createDefaultMarker(){const r=K("div"),a=re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const f=re("radialGradient",{id:"shadowGradient"},re("defs",{},a));re("stop",{offset:"10%","stop-opacity":.4},f),re("stop",{offset:"100%","stop-opacity":.05},f),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.bO.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Ds.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const a=r.code,f=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const a=r.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,a=this._pos;if(!r||!a)return!1;const f=r.unproject(a,this._altitude),_=r.getFreeCameraOptions();if(!_.position)return!1;const v=_.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const a=this._pos;if(!a||a.x<0||a.x>r.transform.width||a.y<0||a.y>r.transform.height)return void this._clearFadeTimer();const f=r.unproject(a,this._altitude);let _;r._showingGlobe()&&i.dK(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${na[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const r=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!r||f!=="map")return"";if(!a._showingGlobe()){const D=a.getPitch();return D?`rotateX(${D}deg)`:""}const _=i.c4(i.dL(a.transform,this._lngLat)),v=r.sub(i.dM(a.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const R=_/S;return`rotateX(${-v.y*R}deg) rotateY(${v.x*R}deg)`}_calculateZTransform(){const r=this._pos,a=this._map;if(!a||!r)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const v=a.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=a.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);f=i.c4(Math.atan2(S.y,S.x))-90}else f=-a.getBearing();else if(_==="horizon"){const v=i.ae(4,6,a.getZoom()),S=i.dM(a.transform);S.y+=v*a.transform.height;const R=r.sub(S),D=i.c4(Math.atan2(R.y,R.x));f=(D>90?D-270:D+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=jf(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const a=this._map;if(!a)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const v=this._clickTolerance||a._clickTolerance;if(r.point.dist(f)<v)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(r){const a=this._map,f=this._pos;a&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const a=this._map;return a&&(r?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Ds.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Ds.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Ds.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Ds.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ls={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Fi={maxWidth:100,unit:"metric"},Rg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},$v=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vl(p=new i.P(0,0),r="bottom"){if(typeof p=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new i.P(0,p);case"top-left":return new i.P(a,a);case"top-right":return new i.P(-a,a);case"bottom":return new i.P(0,-p);case"bottom-left":return new i.P(a,-a);case"bottom-right":return new i.P(-a,-a);case"left":return new i.P(p,0);case"right":return new i.P(-p,0)}return new i.P(0,0)}return p instanceof i.P||Array.isArray(p)?i.P.convert(p):i.P.convert(p[r]||[0,0])}return{version:L,supported:J.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends ru{constructor(p){U.mark(O.create);const r=p;if((p=i.l({},yl,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&i.dI(window)&&(p.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yh(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Ks,this._domRenderTaskQueue=new Ks,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},Yl,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new mt(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const a=document.getElementById(p.container);if(!a)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=a}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new yg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Uv(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||i.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this.indoor=new rv(this),p.hash&&(this._hash=new Sg(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const a=p.bounds;a&&(this.resize(),this.fitBounds(a,i.l({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new zf({customAttribution:p.customAttribution})),this._logoControl=new Xs,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new i.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new i.A(`${a.dataType}dataloading`,a))}),this._interactions=new Pg(this)}_getMapId(){return this._mapId}addControl(p,r){if(r===void 0&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new i.A("movestart",p)).fire(new i.A("move",p)),this.fire(new i.A("resize",p)),r&&this.fire(new i.A("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(i.aB.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(r=>r==="auto"?navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,r=p.projection.name;let a;r==="globe"&&p.zoom>=i.bY?(p.setMercatorFromTransition(),a=!0):r==="mercator"&&p.zoom<i.bY&&(p.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;return r=p.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,r){return this.transform.locationPoint3D(i.bO.convert(p),r)}unproject(p,r){return this.transform.pointLocation3D(i.P.convert(p),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,a){const f=_=>{let v=[];if(Array.isArray(r)){const S=r.filter(R=>this.getLayer(R));v=S.length?this.queryRenderedFeatures(_,{layers:S}):[]}else v=this.queryRenderedFeatures(_,{target:r});return v};if(p==="mouseenter"||p==="mouseover"){let _=!1;return{listener:a,targets:r,delegates:{mousemove:S=>{const R=f(S.point);R.length?_||(_=!0,a.call(this,new ks(p,this,S.originalEvent,{features:R}))):_=!1},mouseout:()=>{_=!1}}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;return{listener:a,targets:r,delegates:{mousemove:R=>{f(R.point).length?_=!0:_&&(_=!1,a.call(this,new ks(p,this,R.originalEvent)))},mouseout:R=>{_&&(_=!1,a.call(this,new ks(p,this,R.originalEvent)))}}}}{const _=v=>{const S=f(v.point);S.length&&(v.features=S,a.call(this,v),delete v.features)};return{listener:a,targets:r,delegates:{[p]:_}}}}on(p,r,a){if(typeof r=="function"||a===void 0)return super.on(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(p,r,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(p,r,a){if(typeof r=="function"||a===void 0)return super.once(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(p,r,a);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(p,r,a){if(typeof r=="function"||a===void 0)return super.off(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(_=>{for(let v=0;v<_.length;v++){const S=_[v];if(S.listener===a&&Qr(S.targets,r)){for(const R in S.delegates)this.off(R,S.delegates[R]);return _.splice(v,1),this}}})(f),this}queryRenderedFeatures(p,r){if(!this.style)return[];if(p===void 0||p instanceof i.P||Array.isArray(p)||r!==void 0||(r=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!r){const v=this.style.queryRenderedFeatures(p,void 0,this.transform),S=this.style.queryRenderedFeatureset(p,void 0,this.transform);return v.concat(S)}let a=!0;if(r.target&&(a=this._isTargetValid(r.target),a&&!r.layers))return this.style.queryRenderedFeatureset(p,r,this.transform);let f=!0;if(r.layers&&Array.isArray(r.layers)){for(const v of r.layers)if(!this._isValidId(v)){f=!1;break}if(f&&!r.target)return this.style.queryRenderedFeatures(p,r,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(p,r,this.transform))),a&&(_=_.concat(this.style.queryRenderedFeatureset(p,r,this.transform))),_}querySourceFeatures(p,r){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,r)}isPointOnSurface(p){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(p))}addInteraction(p,r){return this._interactions.add(p,r),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,r){return r=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&p&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(p,(a,f)=>{a?(i.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(p,r)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(r==null)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const a=i.l({},r);r&&r.config&&(a.initialConfig=r.config,delete a.config),this.style=new Do(this,a).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(p)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const r of p)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(p)}addSource(p,r){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,r,a){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,a)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,r,{pixelRatio:a=1,sdf:f=!1,stretchX:_,stretchY:v,content:S}={}){this._lazyInitEmptyStyle();const R=i.I.from(p);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:D,height:N,data:z}=i.q.getImageData(r);this.style.addImage(R,{data:new i.r({width:D,height:N},z),pixelRatio:a,stretchX:_,stretchY:v,content:S,sdf:f,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:N}=r,z=r;this.style.addImage(R,{data:new i.r({width:D,height:N},new Uint8Array(z.data)),pixelRatio:a,stretchX:_,stretchY:v,content:S,sdf:f,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p)}}updateImage(p,r){this._lazyInitEmptyStyle();const a=i.I.from(p),f=this.style.getImage(a);if(!f)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.q.getImageData(r):r,{width:v,height:S,data:R}=_;if(v===void 0||S===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||S!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${v}, ${S})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const D=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let N=!1;f.usvg?(f.data=new i.r({width:v,height:S},new Uint8Array(R)),f.usvg=!1,f.icon=void 0,N=!0):f.data.replace(R,D),this.style.updateImage(a,f,N)}hasImage(p){return p?!!this.style&&!!this.style.getImage(i.I.from(p)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(i.I.from(p))}loadImage(p,r){i.o(this._requestManager.transformRequest(p,i.R.Image),(a,f)=>{r(a,f instanceof HTMLImageElement?i.q.getImageData(f):f)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,r){this._lazyInitEmptyStyle(),this.style.addModel(p,r)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,r){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)):this}getSlot(p){const r=this.getLayer(p);return r&&r.slot||null}setSlot(p,r){return this.style.setSlot(p,r),this.style.mergeLayers(),this._update(!0)}addImport(p,r){return this.style.addImport(p,r),this}updateImport(p,r){return typeof r!="string"&&r.id!==p?(this.removeImport(p),this.addImport(r)):(this.style.updateImport(p,r),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,r){return this.style.moveImport(p,r),this._update(!0)}moveLayer(p,r){return this._isValidId(p)?(this.style.moveLayer(p,r),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const r=this.style.getOwnLayer(p);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,r,a){return this._isValidId(p)?(this.style.setLayerZoomRange(p,r,a),this._update(!0)):this}setFilter(p,r,a={}){return this._isValidId(p)?(this.style.setFilter(p,r,a),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,r,a,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,r,a,f),this._update(!0)):this}getPaintProperty(p,r){return this._isValidId(p)?this.style.getPaintProperty(p,r):null}setLayoutProperty(p,r,a,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,r,a,f),this._update(!0)):this}getLayoutProperty(p,r){return this._isValidId(p)?this.style.getLayoutProperty(p,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,r){return this.style.setSchema(p,r),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,r){return this.style.setConfig(p,r),this._update(!0)}getConfigProperty(p,r){return this.style.getConfigProperty(p,r)}setConfigProperty(p,r,a){return this.style.setConfigProperty(p,r,a),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const r=p[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,r),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(p),this.transform):0}setFeatureState(p,r){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,r),this._update())}removeFeatureState(p,r){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,r),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let a,f,_,v=this._container;for(;v&&(!f||!_);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(a=S.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),v=v.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=K("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=K("div","mapboxgl-canvas-container",p);this._canvas=K("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=K("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=K("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const a=i.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(p),this._canvas.height=a*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);r!==-1&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const p=i.l({},J.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",p);r?(Ht(r,!0),this.painter=new Df(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(r)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;this.fire(new i.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,f=i.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(a.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,z=this.transform.pitch,B=i.q.now(),V=new i.aa(N,{now:B,fadeDuration:v,pitch:z,transition:this.style.transition});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(f);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,U.mark(O.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const N=i.q.now()-f;_.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const z=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new i.A("gpu-timing-frame",{cpuTime:N,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(N);this.fire(new i.A("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(N);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:z}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(D||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(S=this._updateAverageElevation(f,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,U.mark(O.fullLoad),this._performanceMetricsCollection&&ir(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const a=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const S=Math.abs(_-v);if(S>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),a(v);this._averageElevation.easeTo(v,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),a(v)}return!!this._averageElevation.isEasing(p)&&a(this._averageElevation.getValue(p))}_authenticate(){he(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===et||p.status===401)){const r=this.painter.context.gl;Ht(r,!1),this._logoControl instanceof Xs&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),_r(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&pr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function _(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);const S=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,S),S}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(_(p),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(p,r,a){let f=a[1]-a[0];const _=p.length/4;for(let v=0;v<r.length;v++){const S=r[v];let R=0;for(let D=0;D<S.length;D+=4)S[D]===p[D]&&S[D+1]===p[D+1]&&S[D+2]===p[D+2]&&S[D+3]===p[D+3]&&(R+=1);f+=(a[v+2]-a[v+1])*(1-R/_)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),br.delete(this.painter.context.gl),zr.remove(),At.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=i.q.frame(r=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(r)}))}_preloadTiles(p){const r=this.style?this.style.getSourceCaches():[];return i.bl(r,(a,f)=>a._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,r){i.dJ(p,r)}get version(){return L}},NavigationControl:class{constructor(p={}){this.options=i.l({},sw,p),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),K("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),K("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:r}):a.resetNorth({},{originalEvent:r}))}),this._compassIcon=K("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),a=r===p.getMaxZoom(),f=r===p.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ow(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const a=K("button",p,this._container);return a.type="button",a.addEventListener("click",r),a}_setButtonTitle(p,r){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",a),p.firstElementChild&&p.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends i.E{constructor(p={}){super();const r=navigator.geolocation;this.options=i.l({geolocation:r},Ls,p),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Lf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,p(a)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>r(a.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),a=p.coords;return!!r&&(a.longitude<r.getWest()||a.longitude>r.getEast()||a.latitude<r.getSouth()||a.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",p)),this._finish()}}_updateCamera(p){const r=new i.bO(p.coords.longitude,p.coords.latitude),a=p.coords.accuracy,f=this._map.getBearing(),_=i.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(a),_,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new i.bO(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=i.bH(1,p._center.lat)*p.worldSize,a=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=K("button","mapboxgl-ctrl-geolocate",this._container),K("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K("div","mapboxgl-user-location"),this._dotElement.appendChild(K("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(K("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new qi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=K("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zf,ScaleControl:class{constructor(p={}){this.options=i.l({},Fi,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,a=r._containerHeight/2,f=r._containerWidth/2-p/2,_=r.unproject([f,a]),v=r.unproject([f+p,a]),S=_.distanceTo(v);if(this.options.unit==="imperial"){const R=3.2808*S;R>5280?this._setScale(p,R/5280,"mile"):this._setScale(p,R,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,r,a){this._map._requestDomTask(()=>{const f=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let R=v/S;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(D){const N=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*N)/N}(R),S*R}(r),_=f/r;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${Rg[a]}`,this._container.style.width=p*_+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=K("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(p){super(),this.options=i.l(Object.create(Kn),p),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=i.bO.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const r=document.createDocumentFragment(),a=document.createElement("body");let f;for(a.innerHTML=p;f=a.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=K("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const a=this._closeButton=K("button","mapboxgl-popup-close-button",r);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,a=this._container,f=this._pos;if(!r||!a||!f)return"bottom";const _=a.offsetWidth,v=a.offsetHeight,S=f.x<_/2,R=f.x>r.transform.width-_/2;if(f.y+p<v)return S?"top-left":R?"top-right":"top";if(f.y>r.transform.height-v){if(S)return"bottom-left";if(R)return"bottom-right"}return S?"left":R?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,a=this._content;if(!r||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=K("div","mapboxgl-popup",r.getContainer()),this._tip=K("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jf(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const _=this._pos=this._trackPointer&&p instanceof i.P?p:r.project(this._lngLat,this._altitude),v=vl(this.options.offset),S=this._anchor=this._getAnchor(v.y),R=vl(this.options.offset,S),D=_.add(R).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${na[S]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=i.dK(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector($v);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:qi,Style:Do,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Am,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(p){i.e.ACCESS_TOKEN=p},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(p){i.e.API_URL=p},get workerCount(){return i.dR.workerCount},set workerCount(p){i.dR.workerCount=p},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){i.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){i.dS(p)},get workerUrl(){return i.dT.workerUrl},set workerUrl(p){i.dT.workerUrl=p},get workerClass(){return i.dT.workerClass},set workerClass(p){i.dT.workerClass=p},get workerParams(){return i.dT.workerParams},set workerParams(p){i.dT.workerParams=p},get dracoUrl(){return i.dU()},set dracoUrl(p){i.dV(p)},get meshoptUrl(){return i.dW()},set meshoptUrl(p){i.dX(p)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var C=g;return C})})(y4);var oJ=y4.exports;const Tl=nE(oJ);Tl.accessToken="pk.eyJ1IjoiMDA3am9jaCIsImEiOiJjbTk5ejE1eHMwYWY5MmlxNHpqM2YwdzY2In0.NIWCLXm9mhaIaTCMvbusNQ";const wS={lat:-14.7952,lng:-39.2763,address:"R. Nova, 325 - Califórnia, Itabuna - BA, 45603-652"},aJ={lat:-14.8042,lng:-39.2697,address:"Shopping Jequitibá, Av. Aziz Maron, s/n - Góes Calmon, Itabuna - BA, 45605-412"},f3=({isTracking:e=!1,onRouteComplete:n=()=>{},testMode:o=!1})=>{const u=Z.useRef(null),g=Z.useRef(null),b=Z.useRef(null),C=Z.useRef(null),[i,L]=Z.useState(!0),[O,U]=Z.useState([{...wS},{...aJ}]),[q,G]=Z.useState(0),[ie,J]=Z.useState([]),K=Z.useRef(null),re=Z.useRef(null),Q=Z.useRef(o?.5:.2),ee=async(ge,ke)=>{try{const Be=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${ge[0]},${ge[1]};${ke[0]},${ke[1]}?steps=true&geometries=geojson&access_token=${Tl.accessToken}`)).json();return!Be.routes||Be.routes.length===0?(console.error("Nenhuma rota encontrada"),null):Be.routes[0].geometry.coordinates}catch(Ce){return console.error("Erro ao buscar rota:",Ce),null}},ue=ge=>{if(!g.current)return;const ke={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:ge}};g.current.getSource("route")?g.current.getSource("route").setData(ke):(g.current.addSource("route",{type:"geojson",data:ke}),g.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#4285F4","line-width":5,"line-opacity":.75}}))},fe=async()=>{if(!re.current)return;const ge=[O[1].lng,O[1].lat],ke=await ee(re.current,ge);return ke?(J(ke),ue(ke),ke):null};return Z.useEffect(()=>{if(!o||!e)return;const ge=setInterval(()=>{if(re.current){const Ce=[re.current[0]+(Math.random()*2e-4-1e-4),re.current[1]+(Math.random()*2e-4-1e-4)];re.current=Ce,b.current&&b.current.setLngLat(Ce),fe()}},1e4);return()=>{clearInterval(ge)}},[o,e]),Z.useEffect(()=>{if(!u.current)return;g.current=new Tl.Map({container:u.current,style:"mapbox://styles/mapbox/streets-v12",center:[wS.lng,wS.lat],zoom:15,pitch:45,maxZoom:17,minZoom:13}),g.current.dragRotate.disable(),g.current.touchZoomRotate.disableRotation(),g.current.addControl(new Tl.NavigationControl({showCompass:!1}),"top-right");const ge=document.createElement("div");ge.className="delivery-bike-marker",ge.innerHTML='<div class="bike-wrapper"></div>';const ke=ge.querySelector(".bike-wrapper");if(ke){const He=document.createElement("div");He.innerHTML=`
        <svg width="48" height="48" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="256" cy="460" rx="120" ry="20" fill="rgba(0,0,0,0.2)" />
          <path d="M170 380 L340 380 L360 430 L150 430" fill="#ff1744" />
          <path d="M200 430 L310 430 L290 460 L220 460" fill="#333333" />
          <circle cx="180" cy="440" r="30" fill="#333333" stroke="#555555" strokeWidth="4" />
          <circle cx="330" cy="440" r="30" fill="#333333" stroke="#555555" strokeWidth="4" />
          <circle cx="180" cy="440" r="15" fill="#555555" />
          <circle cx="330" cy="440" r="15" fill="#555555" />
          <path d="M210 380 L300 380 L290 300 L220 300" fill="#78909c" />
          <path d="M220 300 L290 300 L280 230 L230 230" fill="#78909c" />
          <path d="M280 230 L230 230 L240 160 L270 160" fill="#78909c" />
          <path d="M290 280 L340 250" stroke="#78909c" strokeWidth="20" strokeLinecap="round" />
          <path d="M220 280 L170 250" stroke="#78909c" strokeWidth="20" strokeLinecap="round" />
          <rect x="155" y="240" width="30" height="20" rx="5" fill="#333333" />
          <rect x="325" y="240" width="30" height="20" rx="5" fill="#333333" />
          <path d="M140 240 L155 250" stroke="#e57373" strokeWidth="20" strokeLinecap="round" />
          <path d="M355 240 L340 250" stroke="#e57373" strokeWidth="20" strokeLinecap="round" />
          <circle cx="255" cy="140" r="40" fill="#333333" />
          <path d="M215 140 L295 140 L285 190 L225 190 Z" fill="#ff1744" />
          <path d="M235 140 L275 140 L265 110 L245 110 Z" fill="#ff1744" />
          <ellipse cx="255" cy="140" rx="25" ry="15" fill="white" />
          <rect x="210" y="350" width="90" height="70" rx="5" fill="#deb887" />
          <path d="M210 350 L300 350 L270 380 L240 380 Z" fill="#c19a6b" />
        </svg>
      `,ke.appendChild(He)}const Ce=document.createElement("div");Ce.className="destination-marker",Ce.innerHTML=`<div class="pulse"></div>
      <svg width="24" height="36" viewBox="0 0 24 36" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.382 0 0 5.382 0 12C0 20 12 36 12 36C12 36 24 20 24 12C24 5.382 18.618 0 12 0ZM12 16C9.791 16 8 14.209 8 12C8 9.791 9.791 8 12 8C14.209 8 16 9.791 16 12C16 14.209 14.209 16 12 16Z" fill="#E53935"/>
      </svg>`;const Be=document.createElement("style");Be.innerHTML=`
      .delivery-bike-marker {
        width: 48px;
        height: 48px;
        position: relative;
        top: -24px;
        left: -24px;
        z-index: 1000;
      }
      
      .bike-wrapper {
        width: 100%;
        height: 100%;
        transform-origin: center center;
      }
      
      .destination-marker {
        position: relative;
        top: -36px;
        left: -12px;
      }
      
      .pulse {
        display: block;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: rgba(229, 57, 53, 0.4);
        position: absolute;
        top: 0;
        left: 1px;
        animation: pulse 1.5s ease-out infinite;
        transform-origin: center center;
      }

      @keyframes pulse {
        0% {
          transform: scale(0.1);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: scale(1.2);
          opacity: 0;
        }
      }
    `,document.head.appendChild(Be),b.current=new Tl.Marker({element:ge,anchor:"center",offset:[0,0]}).setLngLat([O[0].lng,O[0].lat]).addTo(g.current),re.current=[O[0].lng,O[0].lat],C.current=new Tl.Marker({element:Ce}).setLngLat([O[1].lng,O[1].lat]).addTo(g.current);const dt=new Tl.Popup({closeButton:!1,offset:25}).setHTML('<div class="p-2 bg-white rounded"><strong>Restaurante</strong><br>Origem do pedido</div>');new Tl.Marker({color:"#3FB1CE"}).setLngLat([O[0].lng,O[0].lat]).setPopup(dt).addTo(g.current);const Qe=new Tl.Popup({closeButton:!1,offset:25}).setHTML('<div class="p-2 bg-white rounded"><strong>Seu endereço</strong><br>Destino da entrega</div>');C.current.setPopup(Qe);const qe=async()=>{const He=await ee([O[0].lng,O[0].lat],[O[1].lng,O[1].lat]);He&&(J(He),ue(He))};return g.current.on("load",()=>{var et;L(!1),qe();const He=new Tl.LngLatBounds().extend([O[0].lng,O[0].lat]).extend([O[1].lng,O[1].lat]);(et=g.current)==null||et.fitBounds(He,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:15})}),()=>{K.current&&cancelAnimationFrame(K.current),g.current&&g.current.remove()}},[]),Z.useEffect(()=>{if(!e||!g.current||!b.current||ie.length===0)return;let ge=0,ke=0;const Ce=()=>{var He;if(ke>=ie.length-1){o&&n();return}const Be=ie[ke],dt=ie[ke+1];if(!Be||!dt)return;const Qe=Be[0]+(dt[0]-Be[0])*ge,qe=Be[1]+(dt[1]-Be[1])*ge;if(b.current){b.current.setLngLat([Qe,qe]),re.current=[Qe,qe];const et=dt[0]-Be[0],mt=dt[1]-Be[1];if(et!==0||mt!==0){const Ze=Math.atan2(mt,et)*(180/Math.PI)+90;G(Ze);const Gt=b.current.getElement().querySelector(".bike-wrapper");Gt&&(Gt.style.transform=`rotate(${Ze}deg)`)}}ke%5===0&&((He=g.current)==null||He.easeTo({center:[Qe,qe],duration:2e3,essential:!0,easing:et=>et<.5?2*et*et:-1+(4-2*et)*et})),ge+=Q.current*.002,ge>=1&&(ke++,ge=0),K.current=requestAnimationFrame(Ce)};return K.current=requestAnimationFrame(Ce),()=>{K.current&&(cancelAnimationFrame(K.current),K.current=null)}},[e,ie,o,n]),w.jsxs("div",{className:"w-full h-[300px] bg-gray-100 rounded-lg overflow-hidden",children:[w.jsxs("div",{className:"w-full h-full relative",children:[w.jsx("div",{ref:u,className:"absolute inset-0"}),i&&w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:w.jsx(r1,{className:"h-8 w-8 animate-spin text-menu-primary"})})]}),w.jsx("div",{className:"p-2 bg-yellow-50 text-center",children:w.jsx("p",{className:"text-xs",children:e?"Acompanhando em tempo real a localização do entregador.":"Essa é uma versão demonstrativa do mapa. Na versão final, a localização em tempo real do entregador será mostrada."})})]})},lJ=({statusStep:e,estimatedTime:n})=>w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"font-medium",children:"Status do Pedido"}),w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute top-4 left-4 right-4 h-0.5 bg-gray-200"}),w.jsxs("div",{className:"relative flex justify-between",children:[w.jsxs("div",{className:"flex flex-col items-center",children:[w.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${e>=0?"border-menu-primary bg-menu-primary text-white":"border-gray-300 bg-white"}`,children:e>0?w.jsx(wp,{className:"w-5 h-5"}):1}),w.jsx("span",{className:"text-xs mt-1",children:"Recebido"})]}),w.jsxs("div",{className:"flex flex-col items-center",children:[w.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${e>=1?"border-menu-primary bg-menu-primary text-white":"border-gray-300 bg-white"}`,children:e>1?w.jsx(wp,{className:"w-5 h-5"}):e===1?w.jsx(r1,{className:"w-5 h-5 animate-spin"}):2}),w.jsx("span",{className:"text-xs mt-1",children:"Preparando"})]}),w.jsxs("div",{className:"flex flex-col items-center",children:[w.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${e>=2?"border-menu-primary bg-menu-primary text-white":"border-gray-300 bg-white"}`,children:e>2?w.jsx(wp,{className:"w-5 h-5"}):3}),w.jsx("span",{className:"text-xs mt-1",children:"Pronto"})]}),w.jsxs("div",{className:"flex flex-col items-center",children:[w.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${e>=3?"border-menu-primary bg-menu-primary text-white":"border-gray-300 bg-white"}`,children:e>3?w.jsx(wp,{className:"w-5 h-5"}):w.jsx(TN,{className:"w-5 h-5"})}),w.jsx("span",{className:"text-xs mt-1",children:"Entregue"})]})]})]}),w.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 rounded-md text-center",children:[e===0&&"Aguardando confirmação do restaurante...",e===1&&`Seu pedido está sendo preparado. Tempo estimado: ${n} minutos.`,e===2&&"Seu pedido está pronto e será entregue em breve!",e===3&&"Seu pedido está a caminho! Fique atento.",e===4&&"Pedido entregue. Bom apetite!"]})]}),cJ=({items:e,total:n})=>w.jsxs("div",{children:[w.jsx("h3",{className:"font-bold mb-3",children:"Resumo do Pedido"}),w.jsx("ul",{className:"space-y-2",children:e.map((o,u)=>w.jsxs("li",{className:"flex flex-col",children:[w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsxs("span",{children:[o.quantity,"x ",o.name]}),w.jsxs("span",{children:["R$ ",(o.price*o.quantity).toFixed(2)]})]}),o.notes&&w.jsx("span",{className:"text-xs text-red-500 italic",children:o.notes})]},u))}),w.jsx("div",{className:"border-t mt-4 pt-4",children:w.jsxs("div",{className:"flex justify-between font-medium",children:[w.jsx("span",{children:"Total"}),w.jsxs("span",{children:["R$ ",n.toFixed(2)]})]})})]}),p3=()=>{const e=nl(),n=c9(),[o,u]=Z.useState(!1),[g,b]=Z.useState(!1),[C,i]=Z.useState(!1),[L,O]=Z.useState(!1),[U,q]=Z.useState(!0),[G,ie]=Z.useState(!1),J={id:n.orderId||"#ORD123456",status:"in_transit",createdAt:new Date().toISOString(),estimatedTime:25,items:[{name:"X-Burguer",quantity:2,price:15.9,notes:"Sem ketchup"},{name:"Batata Frita",quantity:1,price:10.5}],total:42.3},re=(ge=>{switch(ge){case"pending":return 0;case"preparing":return 1;case"ready":return 2;case"in_transit":return 3;case"delivered":return 4;default:return 0}})(J.status),Q=()=>{i(!0),u(!0),q(!1),setTimeout(()=>{C&&(O(!0),q(!0),ar({title:"Entregador chegou ao destino",description:"Seu pedido foi entregue com sucesso!"}))},9e4)},ee=()=>{ie(!0),i(!0),q(!1),ar({title:"Modo de teste ativado",description:"Simulando rota de entrega por 90 segundos..."}),setTimeout(()=>{ie(!1),O(!0),q(!0),i(!1),ar({title:"Teste concluído",description:"A simulação de entrega foi finalizada."})},9e4)},ue=()=>{b(!0),ar({title:"Pedido confirmado",description:"Obrigado por confirmar o recebimento do seu pedido!"})},fe=()=>{G&&(O(!0),q(!0),i(!1),ie(!1),ar({title:"Teste concluído",description:"A simulação de entrega foi finalizada com sucesso."}))};return w.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16",children:[w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs("div",{className:"max-w-md mx-auto",children:[w.jsx($t,{variant:"outline",className:"mb-4",onClick:()=>e("/"),children:"Voltar ao menu"}),w.jsxs(Un,{children:[w.jsxs(wi,{children:[w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs(Si,{children:["Seu Pedido ",J.id]}),w.jsx(n1,{className:"h-5 w-5 text-menu-primary"})]}),w.jsxs(ls,{className:"flex items-center gap-1",children:[w.jsx(iC,{className:"h-4 w-4"}),new Date(J.createdAt).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),w.jsxs(fi,{className:"space-y-6",children:[w.jsx(lJ,{statusStep:re,estimatedTime:J.estimatedTime}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsx("h3",{className:"font-medium",children:"Local de entrega"}),(re===3||re===4)&&w.jsx($t,{variant:"outline",size:"sm",onClick:ee,disabled:C,className:"text-xs h-8",children:"Testar rastreio"})]}),w.jsx("div",{className:"w-full h-[300px] relative",children:w.jsx(f3,{isTracking:L?!1:C,onRouteComplete:fe,testMode:G})}),(re===3||re===4)&&w.jsxs("div",{className:"space-y-3 pt-2",children:[w.jsxs($t,{variant:"outline",className:"w-full flex items-center justify-center gap-2",onClick:Q,disabled:L||C,children:[w.jsx(sC,{className:"h-4 w-4"}),L?"Rota concluída":C?"Rastreando...":"Rastrear pedido"]}),w.jsxs($t,{className:"w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",onClick:ue,disabled:g,children:[w.jsx(rC,{className:"h-4 w-4"}),g?"Pedido confirmado":"Confirmar recebimento"]})]})]}),w.jsx(cJ,{items:J.items,total:J.total})]}),w.jsx(by,{children:w.jsx($t,{variant:"outline",className:"w-full",onClick:()=>window.location.href="tel:+551199999999",children:"Entrar em contato"})})]})]})}),w.jsx(Nl,{open:o,onOpenChange:u,children:w.jsxs(tl,{className:"sm:max-w-md",children:[w.jsx("h2",{className:"text-lg font-medium mb-2",children:"Rastreamento do pedido"}),w.jsx("div",{className:"w-full h-[300px] relative",children:w.jsx(f3,{isTracking:C,onRouteComplete:fe,testMode:G})})]})})]})},uJ=({order:e,open:n,onOpenChange:o,onStartPreparation:u,onFinishPreparation:g,onCancelOrder:b})=>{const[C,i]=Z.useState(e.status),L=["https://images.unsplash.com/photo-1618160702438-9b02ab6515c9","https://images.unsplash.com/photo-1568901346375-23c9450c58cd","https://images.unsplash.com/photo-1565299624946-b28f40a0ae38"],O=()=>{u&&u(e.id),i("in_progress"),ar({title:"Preparo iniciado",description:`Você começou a preparar o pedido #${e.id}`})},U=()=>{g&&g(e.id),i("ready"),ar({title:"Pedido pronto",description:`O pedido #${e.id} está pronto para entrega`})},q=()=>{b&&b(e.id),o(!1),ar({title:"Pedido cancelado",description:`O pedido #${e.id} foi cancelado`,variant:"destructive"})},G=re=>{switch(re){case"queued":case"pending":return"Pendente";case"in_progress":return"Em preparo";case"ready":return"Pronto";case"delivered":return"Entregue";default:return"Desconhecido"}},ie=re=>{switch(re){case"queued":case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"ready":return"bg-green-100 text-green-800";case"delivered":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},J=re=>{const Q=new Date(re),ee=new Date;if(Q.toDateString()===ee.toDateString()){const ue=ee.getTime()-Q.getTime(),fe=Math.round(ue/6e4);if(fe<1)return"agora mesmo";if(fe<60)return`há ${fe} ${fe===1?"minuto":"minutos"}`;const ge=Math.floor(fe/60);return`há ${ge} ${ge===1?"hora":"horas"}`}return Q.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})},K=e.total-(e.deliveryFee||0);return w.jsx(Nl,{open:n,onOpenChange:o,children:w.jsxs(tl,{className:"sm:max-w-[600px] overflow-y-auto max-h-[90vh]",children:[w.jsx(Ol,{children:w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(Ti,{className:ie(C),children:G(C)}),w.jsxs(zl,{className:"text-2xl flex items-center gap-2",children:[e.isDelivery?"Pedido Delivery":e.table_name||e.table||"Mesa",e.isDelivery&&w.jsx(Ti,{className:"bg-indigo-100 text-indigo-800",children:"Delivery"})]})]}),w.jsx("span",{className:"text-sm text-gray-500",children:J(e.createdAt)})]})}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[w.jsx(xT,{className:"h-5 w-5 text-gray-600"}),w.jsx("h2",{className:"text-xl font-semibold",children:"Itens do Pedido"})]}),w.jsx("div",{className:"space-y-5 max-h-[300px] overflow-y-auto pr-2",children:e.items.map((re,Q)=>w.jsxs("div",{className:"flex gap-3",children:[w.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-md overflow-hidden flex-shrink-0",children:w.jsx("img",{src:re.image||L[Q%L.length],alt:re.name,className:"w-full h-full object-cover"})}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsxs("div",{children:[re.quantity>1&&w.jsxs("span",{className:"font-medium text-lg mr-1",children:[re.quantity,"x"]}),w.jsx("span",{className:"font-semibold",children:re.name})]}),w.jsxs("span",{className:"font-medium",children:["R$ ",(re.price*re.quantity).toFixed(2)]})]}),re.notes&&w.jsx("p",{className:"text-sm text-red-500 italic mt-1",children:re.notes})]})]},Q))}),w.jsx(pm,{className:"my-4"}),w.jsxs("div",{children:[w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{children:["R$ ",K.toFixed(2)]})]}),e.isDelivery&&e.deliveryFee&&w.jsxs("div",{className:"flex justify-between text-sm mt-1",children:[w.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),w.jsxs("span",{children:["R$ ",e.deliveryFee.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2",children:[w.jsx("span",{children:"Total"}),w.jsxs("span",{children:["R$ ",e.total.toFixed(2)]})]})]})]}),w.jsxs("div",{children:[w.jsx("div",{className:"flex items-center gap-2 mb-4",children:e.customer?w.jsxs(w.Fragment,{children:[w.jsx(Ti,{className:"bg-indigo-100 text-indigo-800 px-2 py-1",children:"Delivery"}),w.jsx("h2",{className:"text-xl font-semibold",children:"Detalhes do Cliente"})]}):w.jsxs(w.Fragment,{children:[w.jsx(Ti,{className:"bg-blue-100 text-blue-800 px-2 py-1",children:"Cliente local"}),w.jsx("h2",{className:"text-xl font-semibold",children:e.table_name||e.table||"Mesa"})]})}),e.customer?w.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-md",children:[w.jsx("div",{children:w.jsx("h3",{className:"font-medium",children:e.customer.name})}),e.customer.phone&&w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(x$,{className:"h-4 w-4 text-gray-600"}),w.jsx("span",{children:e.customer.phone})]}),e.customer.address&&w.jsxs("div",{className:"flex items-start gap-2",children:[w.jsx(sC,{className:"h-4 w-4 text-gray-600 mt-1"}),w.jsx("span",{children:e.customer.address})]})]}):w.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[w.jsxs("p",{children:["Cliente em loja: ",e.table_name||e.table||"Mesa"]}),w.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Pedido para consumo no local."})]}),w.jsxs("div",{className:"mt-6",children:[w.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[w.jsx(l$,{className:"h-5 w-5 text-gray-600"}),w.jsx("h2",{className:"text-lg font-semibold",children:"Status do Pedido"})]}),w.jsx(Ti,{className:`${ie(C)} text-base px-3 py-1`,children:G(C)}),e.assignedTo&&w.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Atribuído a: ",w.jsx("span",{className:"font-semibold",children:e.assignedTo})]})]}),w.jsxs("div",{className:"mt-6 space-y-3",children:[(C==="queued"||C==="pending")&&w.jsx($t,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:O,children:"Iniciar preparo"}),C==="in_progress"&&w.jsx($t,{className:"w-full bg-green-600 hover:bg-green-700",onClick:U,children:"Marcar como pronto"}),w.jsx($t,{variant:"destructive",className:"w-full",onClick:q,children:"Cancelar pedido"})]})]})]}),w.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[w.jsx(xT,{className:"h-4 w-4"}),w.jsxs("span",{children:["Pedido #",e.id]})]})]})})},m3=()=>{const{currentUser:e}=Fh(),{getOrders:n}=YC(),[o,u]=Z.useState([]),[g,b]=Z.useState("preparing"),[C,i]=Z.useState(null),[L,O]=Z.useState(!1),[U,q]=Z.useState("all"),[G,ie]=Z.useState("all"),[J,K]=Z.useState("all"),[re,Q]=Z.useState("all"),ee=nl();if(!["admin","restaurant_owner","chef"].includes((e==null?void 0:e.role)||""))return w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs(Un,{className:"w-full max-w-md mx-auto",children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Acesso restrito"}),w.jsx(ls,{children:"Você não tem permissão para acessar esta página"})]}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-500",children:"Esta página é destinada apenas para funcionários da cozinha."}),w.jsx($t,{className:"mt-4",onClick:()=>ee("/"),children:"Voltar para o início"})]})]})})});const fe=async rt=>{var bt;try{await Qt.from("orders").update({status:"in_progress",assigned_to:(e==null?void 0:e.name)||null}).eq("id",rt),u(At=>At.map(_r=>_r.id===rt?{..._r,status:"in_progress",assignedTo:(e==null?void 0:e.name)||null}:_r));const kt=(bt=o.find(At=>At.id===rt))==null?void 0:bt.table;ar({title:"Preparo iniciado",description:`Você começou a preparar o pedido de ${kt}`}),O(!1)}catch(kt){console.error("Erro ao iniciar preparo:",kt),ar({title:"Erro ao iniciar preparo",description:kt instanceof Error?kt.message:String(kt),variant:"destructive"})}},ge=async rt=>{var bt;try{await Qt.from("orders").update({status:"ready"}).eq("id",rt),u(At=>At.map(_r=>_r.id===rt?{..._r,status:"ready"}:_r));const kt=(bt=o.find(At=>At.id===rt))==null?void 0:bt.table;ar({title:"Pedido pronto",description:`O pedido de ${kt} está pronto para entrega`}),O(!1)}catch(kt){console.error("Erro ao finalizar preparo:",kt),ar({title:"Erro ao finalizar preparo",description:kt instanceof Error?kt.message:String(kt),variant:"destructive"})}},ke=async rt=>{var bt;try{await Qt.from("orders").update({status:"picked_up"}).eq("id",rt),u(At=>At.map(_r=>_r.id===rt?{..._r,status:"picked_up"}:_r));const kt=(bt=o.find(At=>At.id===rt))==null?void 0:bt.table;ar({title:"Pedido retirado",description:`O pedido de ${kt} foi retirado com sucesso`})}catch(kt){console.error("Erro ao marcar como retirado:",kt),ar({title:"Erro ao marcar como retirado",description:kt instanceof Error?kt.message:String(kt),variant:"destructive"})}},Ce=async rt=>{try{const{data:bt,error:kt}=await Qt.from("order_items").select("order_id, quantity, price, notes, product_id").eq("order_id",rt.id);if(kt||!bt)throw kt;const At=Array.from(new Set(bt.map(ir=>ir.product_id))),{data:_r,error:cn}=await Qt.from("products").select("id, name, image_url").in("id",At);if(cn||!_r)throw cn;const pr={};_r.forEach(ir=>{pr[ir.id]={name:ir.name,image_url:ir.image_url??void 0}});const Dt=bt.map(ir=>{var zr,he;return{name:((zr=pr[ir.product_id])==null?void 0:zr.name)||"Produto Desconhecido",image:(he=pr[ir.product_id])==null?void 0:he.image_url,quantity:ir.quantity,price:ir.price,notes:ir.notes||void 0}});i({...rt,items:Dt}),O(!0)}catch(bt){console.error("Erro ao carregar detalhes do pedido:",bt),ar({title:"Erro ao carregar detalhes",description:bt instanceof Error?bt.message:String(bt),variant:"destructive"})}},Be=rt=>{u(bt=>bt.filter(kt=>kt.id!==rt))},dt=o.filter(rt=>rt.status==="preparing"||rt.status==="queued"||rt.status==="pending"?!!(U==="all"||U==="store"&&!rt.isDelivery||U==="delivery"&&rt.isDelivery):!1),Qe=o.filter(rt=>rt.status==="in_progress"?!!(G==="all"||G==="store"&&!rt.isDelivery||G==="delivery"&&rt.isDelivery):!1),qe=o.filter(rt=>rt.status==="ready"?!!(J==="all"||J==="store"&&!rt.isDelivery||J==="delivery"&&rt.isDelivery):!1),He=o.filter(rt=>rt.status==="picked_up"?!!(re==="all"||re==="store"&&!rt.isDelivery||re==="delivery"&&rt.isDelivery):!1),et=async()=>{try{console.log("Buscando pedidos da cozinha...");const rt=await n({status:void 0});let bt=[];if(rt&&Array.isArray(rt))bt=rt;else if(rt&&typeof rt=="object"&&"data"in rt&&Array.isArray(rt.data))bt=rt.data;else{console.warn("Dados de pedidos inválidos:",rt),u([]);return}if(console.log("Pedidos encontrados:",bt.length),bt.length===0){u([]);return}const kt=bt.filter(At=>At&&At.status&&["preparing","in_progress","ready","picked_up","pending"].includes(At.status));console.log("Pedidos relevantes para cozinha:",kt.length),u(kt.map(At=>{var cn;const _r=((cn=At.order_items)==null?void 0:cn.map(pr=>({name:pr.name||"Produto Desconhecido",quantity:pr.quantity,price:pr.price,notes:pr.notes||void 0,image:pr.image_url})))||[];return{...At,items:_r}}))}catch(rt){console.error("Erro ao buscar pedidos:",rt),ar({title:"Erro ao buscar pedidos",description:rt instanceof Error?rt.message:String(rt),variant:"destructive"});const bt=JSON.parse(localStorage.getItem("kitchenOrders")||"[]");u(bt)}};Z.useEffect(()=>{const rt=()=>{try{const bt=localStorage.getItem(`kitchen_filters_${e==null?void 0:e.id}`);if(bt){const kt=JSON.parse(bt);q(kt.queueFilter||"all"),ie(kt.inProgressFilter||"all"),K(kt.readyFilter||"all"),Q(kt.pickedUpFilter||"all")}}catch(bt){console.error("Erro ao processar filtros:",bt)}};e!=null&&e.id&&rt(),et()},[e==null?void 0:e.id]);const mt=(rt,bt)=>{if(e!=null&&e.id)try{const kt=localStorage.getItem(`kitchen_filters_${e.id}`),_r={...kt?JSON.parse(kt):{},[rt+"Filter"]:bt};localStorage.setItem(`kitchen_filters_${e.id}`,JSON.stringify(_r))}catch(kt){console.error("Erro ao processar salvamento de filtro:",kt)}},Ze=rt=>{q(rt),mt("queue",rt)},Tt=rt=>{ie(rt),mt("inProgress",rt)},Gt=rt=>{K(rt),mt("ready",rt)},ct=rt=>{Q(rt),mt("pickedUp",rt)},Je=rt=>w.jsxs(Un,{className:"overflow-hidden mb-4",children:[w.jsx("div",{className:`h-2 ${rt.status==="preparing"||rt.status==="queued"?"bg-yellow-500":rt.status==="in_progress"?"bg-blue-500":rt.status==="ready"?"bg-green-500":"bg-gray-500"}`}),w.jsxs(wi,{className:"pb-2",children:[w.jsxs("div",{className:"flex justify-between items-start",children:[w.jsxs(Si,{className:"flex items-center gap-2",children:["#",rt.id," ",!rt.isDelivery&&rt.table&&w.jsxs("span",{className:"font-medium",children:["Mesa ",rt.table]}),rt.isDelivery&&w.jsx(Ti,{className:"bg-indigo-100 text-indigo-800",children:"Delivery"})]}),w.jsx(Ti,{className:`${rt.status==="preparing"||rt.status==="queued"?"bg-yellow-100 text-yellow-800":rt.status==="in_progress"?"bg-blue-100 text-blue-800":rt.status==="ready"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:rt.status==="preparing"||rt.status==="queued"?"Na fila":rt.status==="in_progress"?"Em preparo":rt.status==="ready"?"Pronto":"Retirado"})]}),w.jsxs(ls,{className:"flex items-center gap-1",children:[w.jsx(iC,{className:"w-4 h-4"}),new Date(rt.createdAt).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),w.jsx(fi,{children:w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Itens"}),w.jsx("ul",{className:"space-y-2",children:rt.items.map((bt,kt)=>w.jsxs("li",{className:"flex flex-col",children:[w.jsxs("div",{className:"flex justify-between text-sm",children:[w.jsxs("span",{children:[bt.quantity,"x ",bt.name]}),w.jsxs("span",{children:["R$ ",(bt.price*bt.quantity).toFixed(2)]})]}),bt.notes&&w.jsx("span",{className:"text-xs text-red-500 italic",children:bt.notes})]},kt))})]}),w.jsx(pm,{}),w.jsxs("div",{className:"pt-2 space-y-2",children:[w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsxs("span",{className:"font-semibold",children:["Total: R$ ",rt.total.toFixed(2)]}),w.jsxs($t,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>Ce(rt),children:[w.jsx(xT,{className:"h-4 w-4"}),"Detalhes"]})]}),(rt.status==="preparing"||rt.status==="queued")&&w.jsx($t,{className:"w-full",onClick:()=>fe(rt.id),children:"Iniciar Preparo"}),rt.status==="in_progress"&&w.jsx($t,{className:"w-full bg-green-600 hover:bg-green-700",onClick:()=>ge(rt.id),children:"Marcar como Pronto"}),rt.status==="ready"&&w.jsx($t,{className:"w-full",variant:"outline",onClick:()=>ke(rt.id),children:"Confirmar Retirada"})]})]})})]},rt.id);return w.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16",children:[w.jsxs("div",{className:"container mx-auto px-4 py-8",children:[w.jsxs("div",{className:"flex items-center justify-between mb-6",children:[w.jsx("h1",{className:"text-2xl font-bold",children:"Gerenciamento de Cozinha"}),w.jsx($t,{variant:"outline",onClick:()=>ee("/order-management"),children:"Ver Mesas"})]}),w.jsxs(Vh,{value:g,onValueChange:b,className:"w-full",children:[w.jsxs(ld,{className:"w-full grid grid-cols-4",children:[w.jsxs(cs,{value:"preparing",className:"flex items-center gap-2",children:["Na Fila",dt.length>0&&w.jsx(Ti,{variant:"outline",className:"ml-1",children:dt.length})]}),w.jsxs(cs,{value:"in_progress",className:"flex items-center gap-2",children:["Em Preparo",Qe.length>0&&w.jsx(Ti,{variant:"outline",className:"ml-1",children:Qe.length})]}),w.jsxs(cs,{value:"ready",className:"flex items-center gap-2",children:["Prontos",qe.length>0&&w.jsx(Ti,{variant:"outline",className:"ml-1",children:qe.length})]}),w.jsxs(cs,{value:"picked_up",className:"flex items-center gap-2",children:["Retirados",He.length>0&&w.jsx(Ti,{variant:"outline",className:"ml-1",children:He.length})]})]}),w.jsxs(us,{value:"preparing",className:"mt-4",children:[w.jsxs("div",{className:"flex justify-between items-center mb-4",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Pedidos na Fila"}),w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"flex gap-2 items-center",children:[w.jsx(ex,{className:"h-4 w-4"}),U==="all"?"Todos os Pedidos":U==="store"?"Pedidos da Loja":"Pedidos Delivery"]})}),w.jsxs(hh,{align:"end",children:[w.jsx(fh,{children:"Filtrar Pedidos"}),w.jsx(cc,{}),w.jsxs(hx,{value:U,onValueChange:rt=>Ze(rt),children:[w.jsx(Fo,{value:"all",children:"Todos os Pedidos"}),w.jsx(Fo,{value:"store",children:"Pedidos da Loja"}),w.jsx(Fo,{value:"delivery",children:"Pedidos Delivery"})]})]})]})]}),dt.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(ET,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("p",{className:"mt-2 text-gray-500",children:"Não há pedidos na fila no momento"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:dt.map(Je)})]}),w.jsxs(us,{value:"in_progress",className:"mt-4",children:[w.jsxs("div",{className:"flex justify-between items-center mb-4",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Pedidos em Preparo"}),w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"flex gap-2 items-center",children:[w.jsx(ex,{className:"h-4 w-4"}),G==="all"?"Todos os Pedidos":G==="store"?"Pedidos da Loja":"Pedidos Delivery"]})}),w.jsxs(hh,{align:"end",children:[w.jsx(fh,{children:"Filtrar Pedidos"}),w.jsx(cc,{}),w.jsxs(hx,{value:G,onValueChange:rt=>Tt(rt),children:[w.jsx(Fo,{value:"all",children:"Todos os Pedidos"}),w.jsx(Fo,{value:"store",children:"Pedidos da Loja"}),w.jsx(Fo,{value:"delivery",children:"Pedidos Delivery"})]})]})]})]}),Qe.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(ET,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("p",{className:"mt-2 text-gray-500",children:"Não há pedidos em preparo no momento"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Qe.map(Je)})]}),w.jsxs(us,{value:"ready",className:"mt-4",children:[w.jsxs("div",{className:"flex justify-between items-center mb-4",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Pedidos Prontos"}),w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"flex gap-2 items-center",children:[w.jsx(ex,{className:"h-4 w-4"}),J==="all"?"Todos os Pedidos":J==="store"?"Pedidos da Loja":"Pedidos Delivery"]})}),w.jsxs(hh,{align:"end",children:[w.jsx(fh,{children:"Filtrar Pedidos"}),w.jsx(cc,{}),w.jsxs(hx,{value:J,onValueChange:rt=>Gt(rt),children:[w.jsx(Fo,{value:"all",children:"Todos os Pedidos"}),w.jsx(Fo,{value:"store",children:"Pedidos da Loja"}),w.jsx(Fo,{value:"delivery",children:"Pedidos Delivery"})]})]})]})]}),qe.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(wp,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("p",{className:"mt-2 text-gray-500",children:"Não há pedidos prontos para retirada"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:qe.map(Je)})]}),w.jsxs(us,{value:"picked_up",className:"mt-4",children:[w.jsxs("div",{className:"flex justify-between items-center mb-4",children:[w.jsx("h2",{className:"text-lg font-semibold",children:"Pedidos Retirados"}),w.jsxs(Sp,{children:[w.jsx(Tp,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",className:"flex gap-2 items-center",children:[w.jsx(ex,{className:"h-4 w-4"}),re==="all"?"Todos os Pedidos":re==="store"?"Pedidos da Loja":"Pedidos Delivery"]})}),w.jsxs(hh,{align:"end",children:[w.jsx(fh,{children:"Filtrar Pedidos"}),w.jsx(cc,{}),w.jsxs(hx,{value:re,onValueChange:rt=>ct(rt),children:[w.jsx(Fo,{value:"all",children:"Todos os Pedidos"}),w.jsx(Fo,{value:"store",children:"Pedidos da Loja"}),w.jsx(Fo,{value:"delivery",children:"Pedidos Delivery"})]})]})]})]}),He.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(wp,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("p",{className:"mt-2 text-gray-500",children:"Não há pedidos retirados recentemente"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:He.map(Je)})]})]})]}),C&&w.jsx(uJ,{order:C,open:L,onOpenChange:O,onStartPreparation:fe,onFinishPreparation:ge,onCancelOrder:Be})]})};var dJ="Label",x4=Z.forwardRef((e,n)=>w.jsx(qr.label,{...e,ref:n,onMouseDown:o=>{var g;o.target.closest("button, input, select, textarea")||((g=e.onMouseDown)==null||g.call(e,o),!o.defaultPrevented&&o.detail>1&&o.preventDefault())}}));x4.displayName=dJ;var b4=x4;const hJ=Ny("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Br=Z.forwardRef(({className:e,...n},o)=>w.jsx(b4,{ref:o,className:Rr(hJ(),e),...n}));Br.displayName=b4.displayName;function JC(e){const n=Z.useRef({value:e,previous:e});return Z.useMemo(()=>(n.current.value!==e&&(n.current.previous=n.current.value,n.current.value=e),n.current.previous),[e])}var QC="Switch",[fJ,jQ]=Jo(QC),[pJ,mJ]=fJ(QC),w4=Z.forwardRef((e,n)=>{const{__scopeSwitch:o,name:u,checked:g,defaultChecked:b,required:C,disabled:i,value:L="on",onCheckedChange:O,form:U,...q}=e,[G,ie]=Z.useState(null),J=Ln(n,ue=>ie(ue)),K=Z.useRef(!1),re=G?U||!!G.closest("form"):!0,[Q=!1,ee]=Dl({prop:g,defaultProp:b,onChange:O});return w.jsxs(pJ,{scope:o,checked:Q,disabled:i,children:[w.jsx(qr.button,{type:"button",role:"switch","aria-checked":Q,"aria-required":C,"data-state":E4(Q),"data-disabled":i?"":void 0,disabled:i,value:L,...q,ref:J,onClick:dr(e.onClick,ue=>{ee(fe=>!fe),re&&(K.current=ue.isPropagationStopped(),K.current||ue.stopPropagation())})}),re&&w.jsx(gJ,{control:G,bubbles:!K.current,name:u,value:L,checked:Q,required:C,disabled:i,form:U,style:{transform:"translateX(-100%)"}})]})});w4.displayName=QC;var S4="SwitchThumb",T4=Z.forwardRef((e,n)=>{const{__scopeSwitch:o,...u}=e,g=mJ(S4,o);return w.jsx(qr.span,{"data-state":E4(g.checked),"data-disabled":g.disabled?"":void 0,...u,ref:n})});T4.displayName=S4;var gJ=e=>{const{control:n,checked:o,bubbles:u=!0,...g}=e,b=Z.useRef(null),C=JC(o),i=pC(n);return Z.useEffect(()=>{const L=b.current,O=window.HTMLInputElement.prototype,q=Object.getOwnPropertyDescriptor(O,"checked").set;if(C!==o&&q){const G=new Event("click",{bubbles:u});q.call(L,o),L.dispatchEvent(G)}},[C,o,u]),w.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...g,tabIndex:-1,ref:b,style:{...e.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function E4(e){return e?"checked":"unchecked"}var C4=w4,_J=T4;const v1=Z.forwardRef(({className:e,...n},o)=>w.jsx(C4,{className:Rr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...n,ref:o,children:w.jsx(_J,{className:Rr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));v1.displayName=C4.displayName;const yJ=({onImagesUpload:e,values:n=[],label:o="Selecionar imagens",maxSizeInMB:u=5,maxImages:g=5,acceptedFileTypes:b="image/*"})=>{const[C,i]=Z.useState(!1),[L,O]=Z.useState(n),[U,q]=Z.useState([]),G=async J=>{const K=J.target.files;if(!K||K.length===0)return;if(L.length+K.length>g){ar({title:"Muitas imagens",description:`Você pode fazer upload de no máximo ${g} imagens`,variant:"destructive"});return}i(!0);const re=Array.from(K).map(async Q=>{const ee=URL.createObjectURL(Q);q(ue=>[...ue,ee]);try{const ue=Q.name.split(".").pop(),ge=`${`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${ue}`}`,{error:ke}=await Qt.storage.from("produtos").upload(ge,Q);if(ke)throw ke;const{data:Ce}=Qt.storage.from("produtos").getPublicUrl(ge);if(!(Ce!=null&&Ce.publicUrl))throw new Error("URL pública não gerada");return Ce.publicUrl}catch{return ar({title:"Erro no upload",description:`Não foi possível carregar a imagem ${Q.name}`,variant:"destructive"}),null}});try{const ee=(await Promise.all(re)).filter(fe=>!!fe),ue=[...L,...ee];O(ue),e(ue),ar({title:"Upload concluído",description:`${ee.length} imagens carregadas com sucesso!`})}finally{i(!1),q([])}},ie=J=>{const K=[...L];K.splice(J,1),O(K),e(K)};return w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[L.map((J,K)=>w.jsxs("div",{className:"relative rounded-md overflow-hidden h-40 bg-gray-100",children:[w.jsx("img",{src:J,alt:`Preview ${K+1}`,className:"w-full h-full object-cover",onError:re=>{re.target.src="/placeholder.svg"}}),w.jsx($t,{type:"button",size:"icon",variant:"destructive",className:"absolute top-2 right-2",onClick:()=>ie(K),children:w.jsx(Yu,{className:"h-4 w-4"})})]},K)),U.map((J,K)=>w.jsx("div",{className:"relative rounded-md overflow-hidden h-40 bg-gray-100",children:w.jsx("img",{src:J,alt:`Preview ${K+1}`,className:"w-full h-full object-cover",onError:re=>{re.target.src="/placeholder.svg"}})},K)),L.length+U.length<g&&w.jsxs("div",{className:"relative flex items-center justify-center border-2 border-dashed border-gray-300 rounded-md h-40 bg-gray-50",children:[w.jsxs("div",{className:"space-y-2 text-center",children:[w.jsx(Ah,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("div",{className:"text-gray-500 text-sm",children:"Adicionar imagem"})]}),w.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:G,accept:b,disabled:C,multiple:!0})]})]}),w.jsx("div",{className:"flex justify-center",children:!C&&L.length+U.length<g&&w.jsxs("div",{className:"relative",children:[w.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:G,accept:b,multiple:!0}),w.jsxs($t,{type:"button",variant:"outline",disabled:C,className:"w-full",children:[w.jsx(EN,{className:"h-4 w-4 mr-2"}),o," (",L.length+U.length,"/",g,")"]})]})})]})},g3=()=>{const e=nl(),{currentUser:n}=Fh(),[o,u]=Z.useState([...D_]),[g,b]=Z.useState(""),[C,i]=Z.useState(!1),[L,O]=Z.useState(!1),[U,q]=Z.useState(null),[G,ie]=Z.useState({name:"",price:"",description:"",category:"pratos_principais",available:!0,featured:!1,images:[""],ingredients:""}),J=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="restaurant_owner";Z.useEffect(()=>{K()},[]);const K=async()=>{try{const{data:qe,error:He}=await Qt.from("products").select("*");if(He){console.error("Erro ao buscar produtos do Supabase:",He);return}if(qe&&qe.length>0){const et=qe.map(mt=>({...mt,restaurant_id:mt.restaurant_id||1,team_id:mt.team_id||"default_team_id",images:Array.isArray(mt.images)&&mt.images.length>0?mt.images:mt.image_url?[mt.image_url]:["/placeholder.svg"]}));u(et)}}catch(qe){console.error("Erro ao processar dados do Supabase:",qe)}},re=()=>{ie({name:"",price:"",description:"",category:"pratos_principais",available:!0,featured:!1,images:[""],ingredients:""})},Q=()=>{re(),q(null),i(!0)},ee=qe=>{var He;q(qe),ie({name:qe.name,price:qe.price.toString(),description:qe.description||"",category:qe.category||"pratos_principais",available:qe.available!==!1,featured:qe.featured||!1,images:qe.images??(qe.image_url?[qe.image_url]:[""]),ingredients:(((He=qe.nutritional_info)==null?void 0:He.ingredients)||[]).join(", ")}),i(!0)},ue=qe=>{q(qe),O(!0)},fe=async()=>{if(U){try{const{error:qe}=await Qt.from("products").delete().eq("id",U.id);if(qe)console.error("Erro ao excluir produto do Supabase:",qe);else{ar({title:"Produto excluído",description:`${U.name} foi removido com sucesso`}),u(o.filter(He=>He.id!==U.id)),O(!1),q(null);return}}catch(qe){console.error("Erro ao processar exclusão de produto:",qe)}u(o.filter(qe=>qe.id!==U.id)),ar({title:"Produto excluído",description:`${U.name} foi removido com sucesso`}),O(!1),q(null)}},ge=async()=>{if(!G.name||!G.price||!G.description){ar({title:"Campos obrigatórios",description:"Por favor, preencha todos os campos obrigatórios.",variant:"destructive"});return}const qe=parseFloat(G.price.replace(",","."));if(isNaN(qe)){ar({title:"Preço inválido",description:"Por favor, insira um valor válido para o preço.",variant:"destructive"});return}const He={id:U?U.id:Date.now(),name:G.name,description:G.description,price:qe,category:G.category,available:G.available,featured:G.featured,image_url:G.images[0]||"/placeholder.svg",images:G.images,restaurant_id:1,team_id:"default_team_id",nutritional_info:{ingredients:G.ingredients.split(",").map(et=>et.trim()).filter(Boolean)}};try{if(U){const{error:et}=await Qt.from("products").update({name:He.name,description:He.description,price:He.price,category:He.category,available:He.available,featured:He.featured,image_url:He.image_url,images:He.images,nutritional_info:He.nutritional_info,restaurant_id:He.restaurant_id,team_id:He.team_id,updated_at:new Date().toISOString()}).eq("id",U.id);if(et)console.error("Erro ao atualizar produto no Supabase:",et);else{ar({title:"Produto atualizado",description:`${G.name} foi atualizado com sucesso`}),u(o.map(mt=>mt.id===U.id?He:mt)),i(!1),re(),q(null),K();return}}else{const{data:et,error:mt}=await Qt.from("products").insert([{name:He.name,description:He.description,price:He.price,category:He.category,available:He.available,featured:He.featured,image_url:He.image_url,images:He.images,nutritional_info:He.nutritional_info,restaurant_id:He.restaurant_id,team_id:He.team_id}]).select();if(mt)console.error("Erro ao adicionar produto no Supabase:",mt);else if(et){ar({title:"Produto adicionado",description:`${G.name} foi adicionado com sucesso`});const Ze={...et[0]};u([...o,Ze]),i(!1),re(),q(null),K();return}}}catch(et){console.error("Erro ao processar produto no Supabase:",et)}U?(u(o.map(et=>et.id===U.id?He:et)),ar({title:"Produto atualizado",description:`${G.name} foi atualizado com sucesso`})):(u([...o,He]),ar({title:"Produto adicionado",description:`${G.name} foi adicionado com sucesso`})),i(!1),re(),q(null)},ke=qe=>{const{name:He,value:et}=qe.target;ie(mt=>({...mt,[He]:et}))},Ce=(qe,He)=>{ie(et=>({...et,[qe]:He}))},Be=qe=>{ie(He=>({...He,images:qe}))},dt=o.filter(qe=>qe.name.toLowerCase().includes(g.toLowerCase())||qe.description&&qe.description.toLowerCase().includes(g.toLowerCase())||qe.category&&qe.category.toLowerCase().includes(g.toLowerCase())),Qe=[{id:"todos",name:"Todos"},{id:"pratos_principais",name:"Pratos Principais"},{id:"bebidas",name:"Bebidas"},{id:"sobremesas",name:"Sobremesas"},{id:"entradas",name:"Entradas"},{id:"acompanhamentos",name:"Acompanhamentos"}];return J?w.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16",children:[w.jsxs("div",{className:"container mx-auto px-4 py-8",children:[w.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-2xl font-bold",children:"Gerenciamento de Produtos"}),w.jsx("p",{className:"text-gray-600",children:"Gerencie o cardápio do restaurante"})]}),w.jsxs($t,{onClick:Q,className:"mt-4 md:mt-0 flex items-center gap-2",children:[w.jsx(Ah,{className:"h-4 w-4"})," Adicionar Produto"]})]}),w.jsx("div",{className:"mb-6",children:w.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:w.jsxs("div",{className:"relative flex-1",children:[w.jsx(w$,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),w.jsx(En,{placeholder:"Pesquisar produtos...",value:g,onChange:qe=>b(qe.target.value),className:"pl-10"})]})})}),w.jsxs(Vh,{defaultValue:"todos",className:"w-full",children:[w.jsx(ld,{className:"mb-4 flex w-full overflow-x-auto",children:Qe.map(qe=>w.jsx(cs,{value:qe.id,className:"flex-shrink-0",children:qe.name},qe.id))}),Qe.map(qe=>w.jsxs(us,{value:qe.id,className:"mt-0",children:[w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:dt.filter(He=>qe.id==="todos"||He.category===qe.id).map(He=>{var et,mt;return w.jsxs(Un,{className:"overflow-hidden",children:[w.jsxs("div",{className:"aspect-video relative",children:[w.jsx("img",{src:He.image_url||"/placeholder.svg",alt:He.name,className:"w-full h-full object-cover"}),w.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[He.featured&&w.jsx(Ti,{className:"bg-yellow-500",children:"Destaque"}),He.available===!1&&w.jsx(Ti,{variant:"outline",className:"bg-red-100 text-red-800 border-red-300",children:"Indisponível"})]})]}),w.jsxs(wi,{className:"pb-2",children:[w.jsxs(Si,{className:"text-lg flex justify-between items-center",children:[He.name,w.jsxs("span",{className:"text-base font-normal",children:["R$ ",He.price.toFixed(2)]})]}),w.jsx(ls,{children:((mt=(et=He.nutritional_info)==null?void 0:et.ingredients)==null?void 0:mt.length)>0?w.jsxs("span",{className:"text-xs text-gray-500",children:["Ingredientes: ",He.nutritional_info.ingredients.join(", ")]}):null})]}),w.jsx(fi,{children:w.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:He.description})}),w.jsxs(fi,{className:"pt-0 flex gap-2 justify-end",children:[w.jsxs($t,{variant:"outline",size:"sm",onClick:()=>ee(He),children:[w.jsx(oC,{className:"h-4 w-4 mr-2"})," Editar"]}),w.jsxs($t,{variant:"destructive",size:"sm",onClick:()=>ue(He),children:[w.jsx($1,{className:"h-4 w-4 mr-2"})," Excluir"]})]})]},He.id)})}),dt.filter(He=>qe.id==="todos"||He.category===qe.id).length===0&&w.jsx("div",{className:"text-center py-12",children:w.jsx("p",{className:"text-gray-500",children:"Nenhum produto encontrado nesta categoria."})})]},qe.id))]})]}),w.jsx(Nl,{open:C,onOpenChange:i,children:w.jsxs(tl,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[w.jsx(Ol,{children:w.jsx(zl,{children:U?"Editar Produto":"Adicionar Novo Produto"})}),w.jsx("div",{className:"grid gap-4 py-4",children:w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"col-span-2",children:[w.jsx(Br,{htmlFor:"name",children:"Nome do Produto*"}),w.jsx(En,{id:"name",name:"name",value:G.name,onChange:ke,placeholder:"Ex: X-Burguer Especial"})]}),w.jsxs("div",{children:[w.jsx(Br,{htmlFor:"price",children:"Preço*"}),w.jsx(En,{id:"price",name:"price",type:"text",inputMode:"decimal",value:G.price,onChange:ke,placeholder:"Ex: 29,90"})]}),w.jsxs("div",{children:[w.jsx(Br,{htmlFor:"category",children:"Categoria*"}),w.jsxs("select",{id:"category",name:"category",value:G.category,onChange:ke,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[w.jsx("option",{value:"pratos_principais",children:"Pratos Principais"}),w.jsx("option",{value:"bebidas",children:"Bebidas"}),w.jsx("option",{value:"sobremesas",children:"Sobremesas"}),w.jsx("option",{value:"entradas",children:"Entradas"}),w.jsx("option",{value:"acompanhamentos",children:"Acompanhamentos"})]})]}),w.jsxs("div",{className:"col-span-2",children:[w.jsx(Br,{htmlFor:"description",children:"Descrição do Produto*"}),w.jsx(m1,{id:"description",name:"description",value:G.description,onChange:ke,placeholder:"Descreva o produto detalhadamente...",rows:3})]}),w.jsxs("div",{className:"col-span-2",children:[w.jsx(Br,{htmlFor:"ingredients",children:"Ingredientes (separados por vírgula)"}),w.jsx(m1,{id:"ingredients",name:"ingredients",value:G.ingredients,onChange:ke,placeholder:"Ex: Pão, carne, queijo, alface, tomate",rows:2})]}),w.jsxs("div",{className:"col-span-2",children:[w.jsx(Br,{className:"mb-2 block",children:"Imagens do Produto (até 5 imagens)"}),w.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"A primeira imagem será usada como thumbnail no cardápio."}),w.jsx(yJ,{values:G.images.filter(qe=>qe!==""),onImagesUpload:Be,maxImages:5,label:"Selecionar imagens"})]}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(v1,{id:"available",checked:G.available,onCheckedChange:qe=>Ce("available",qe)}),w.jsx(Br,{htmlFor:"available",children:"Produto Disponível"})]}),w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(v1,{id:"featured",checked:G.featured,onCheckedChange:qe=>Ce("featured",qe)}),w.jsx(Br,{htmlFor:"featured",children:"Destaque no Cardápio"})]})]})}),w.jsxs(wy,{children:[w.jsx($t,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),w.jsx($t,{onClick:ge,type:"button",children:U?"Salvar Alterações":"Adicionar Produto"})]})]})}),w.jsx(Nl,{open:L,onOpenChange:O,children:w.jsxs(tl,{children:[w.jsx(Ol,{children:w.jsx(zl,{children:"Confirmar exclusão"})}),w.jsxs("p",{children:['Tem certeza que deseja excluir o produto "',U==null?void 0:U.name,'"? Esta ação não pode ser desfeita.']}),w.jsxs(wy,{children:[w.jsx($t,{variant:"outline",onClick:()=>O(!1),children:"Cancelar"}),w.jsx($t,{variant:"destructive",onClick:fe,children:"Excluir"})]})]})})]}):w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs(Un,{className:"w-full max-w-md mx-auto",children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Acesso restrito"}),w.jsx(ls,{children:"Você não tem permissão para acessar esta página"})]}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-500",children:"Esta página é destinada apenas para administradores e proprietários."}),w.jsx($t,{className:"mt-4",onClick:()=>e("/"),children:"Voltar para o início"})]})]})})})};function _3(e,[n,o]){return Math.min(o,Math.max(n,e))}var vJ=[" ","Enter","ArrowUp","ArrowDown"],xJ=[" ","Enter"],Hy="Select",[bb,wb,bJ]=B1(Hy),[gm,FQ]=Jo(Hy,[bJ,cm]),Sb=cm(),[wJ,cd]=gm(Hy),[SJ,TJ]=gm(Hy),A4=e=>{const{__scopeSelect:n,children:o,open:u,defaultOpen:g,onOpenChange:b,value:C,defaultValue:i,onValueChange:L,dir:O,name:U,autoComplete:q,disabled:G,required:ie,form:J}=e,K=Sb(n),[re,Q]=Z.useState(null),[ee,ue]=Z.useState(null),[fe,ge]=Z.useState(!1),ke=fm(O),[Ce=!1,Be]=Dl({prop:u,defaultProp:g,onChange:b}),[dt,Qe]=Dl({prop:C,defaultProp:i,onChange:L}),qe=Z.useRef(null),He=re?J||!!re.closest("form"):!0,[et,mt]=Z.useState(new Set),Ze=Array.from(et).map(Tt=>Tt.props.value).join(";");return w.jsx(eO,{...K,children:w.jsxs(wJ,{required:ie,scope:n,trigger:re,onTriggerChange:Q,valueNode:ee,onValueNodeChange:ue,valueNodeHasChildren:fe,onValueNodeHasChildrenChange:ge,contentId:Ka(),value:dt,onValueChange:Qe,open:Ce,onOpenChange:Be,dir:ke,triggerPointerDownPosRef:qe,disabled:G,children:[w.jsx(bb.Provider,{scope:n,children:w.jsx(SJ,{scope:e.__scopeSelect,onNativeOptionAdd:Z.useCallback(Tt=>{mt(Gt=>new Set(Gt).add(Tt))},[]),onNativeOptionRemove:Z.useCallback(Tt=>{mt(Gt=>{const ct=new Set(Gt);return ct.delete(Tt),ct})},[]),children:o})}),He?w.jsxs(J4,{"aria-hidden":!0,required:ie,tabIndex:-1,name:U,autoComplete:q,value:dt,onChange:Tt=>Qe(Tt.target.value),disabled:G,form:J,children:[dt===void 0?w.jsx("option",{value:""}):null,Array.from(et)]},Ze):null]})})};A4.displayName=Hy;var M4="SelectTrigger",I4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,disabled:u=!1,...g}=e,b=Sb(o),C=cd(M4,o),i=C.disabled||u,L=Ln(n,C.onTriggerChange),O=wb(o),U=Z.useRef("touch"),[q,G,ie]=Q4(K=>{const re=O().filter(ue=>!ue.disabled),Q=re.find(ue=>ue.value===C.value),ee=eF(re,K,Q);ee!==void 0&&C.onValueChange(ee.value)}),J=K=>{i||(C.onOpenChange(!0),ie()),K&&(C.triggerPointerDownPosRef.current={x:Math.round(K.pageX),y:Math.round(K.pageY)})};return w.jsx(_C,{asChild:!0,...b,children:w.jsx(qr.button,{type:"button",role:"combobox","aria-controls":C.contentId,"aria-expanded":C.open,"aria-required":C.required,"aria-autocomplete":"none",dir:C.dir,"data-state":C.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Y4(C.value)?"":void 0,...g,ref:L,onClick:dr(g.onClick,K=>{K.currentTarget.focus(),U.current!=="mouse"&&J(K)}),onPointerDown:dr(g.onPointerDown,K=>{U.current=K.pointerType;const re=K.target;re.hasPointerCapture(K.pointerId)&&re.releasePointerCapture(K.pointerId),K.button===0&&K.ctrlKey===!1&&K.pointerType==="mouse"&&(J(K),K.preventDefault())}),onKeyDown:dr(g.onKeyDown,K=>{const re=q.current!=="";!(K.ctrlKey||K.altKey||K.metaKey)&&K.key.length===1&&G(K.key),!(re&&K.key===" ")&&vJ.includes(K.key)&&(J(),K.preventDefault())})})})});I4.displayName=M4;var P4="SelectValue",R4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,className:u,style:g,children:b,placeholder:C="",...i}=e,L=cd(P4,o),{onValueNodeHasChildrenChange:O}=L,U=b!==void 0,q=Ln(n,L.onValueNodeChange);return Ki(()=>{O(U)},[O,U]),w.jsx(qr.span,{...i,ref:q,style:{pointerEvents:"none"},children:Y4(L.value)?w.jsx(w.Fragment,{children:C}):b})});R4.displayName=P4;var EJ="SelectIcon",k4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,children:u,...g}=e;return w.jsx(qr.span,{"aria-hidden":!0,...g,ref:n,children:u||"▼"})});k4.displayName=EJ;var CJ="SelectPortal",D4=e=>w.jsx(Dy,{asChild:!0,...e});D4.displayName=CJ;var kh="SelectContent",L4=Z.forwardRef((e,n)=>{const o=cd(kh,e.__scopeSelect),[u,g]=Z.useState();if(Ki(()=>{g(new DocumentFragment)},[]),!o.open){const b=u;return b?Nh.createPortal(w.jsx(N4,{scope:e.__scopeSelect,children:w.jsx(bb.Slot,{scope:e.__scopeSelect,children:w.jsx("div",{children:e.children})})}),b):null}return w.jsx(O4,{...e,ref:n})});L4.displayName=kh;var Ua=10,[N4,ud]=gm(kh),AJ="SelectContentImpl",O4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,position:u="item-aligned",onCloseAutoFocus:g,onEscapeKeyDown:b,onPointerDownOutside:C,side:i,sideOffset:L,align:O,alignOffset:U,arrowPadding:q,collisionBoundary:G,collisionPadding:ie,sticky:J,hideWhenDetached:K,avoidCollisions:re,...Q}=e,ee=cd(kh,o),[ue,fe]=Z.useState(null),[ge,ke]=Z.useState(null),Ce=Ln(n,Dt=>fe(Dt)),[Be,dt]=Z.useState(null),[Qe,qe]=Z.useState(null),He=wb(o),[et,mt]=Z.useState(!1),Ze=Z.useRef(!1);Z.useEffect(()=>{if(ue)return RC(ue)},[ue]),PC();const Tt=Z.useCallback(Dt=>{const[ir,...zr]=He().map(Ht=>Ht.ref.current),[he]=zr.slice(-1),br=document.activeElement;for(const Ht of Dt)if(Ht===br||(Ht==null||Ht.scrollIntoView({block:"nearest"}),Ht===ir&&ge&&(ge.scrollTop=0),Ht===he&&ge&&(ge.scrollTop=ge.scrollHeight),Ht==null||Ht.focus(),document.activeElement!==br))return},[He,ge]),Gt=Z.useCallback(()=>Tt([Be,ue]),[Tt,Be,ue]);Z.useEffect(()=>{et&&Gt()},[et,Gt]);const{onOpenChange:ct,triggerPointerDownPosRef:Je}=ee;Z.useEffect(()=>{if(ue){let Dt={x:0,y:0};const ir=he=>{var br,Ht;Dt={x:Math.abs(Math.round(he.pageX)-(((br=Je.current)==null?void 0:br.x)??0)),y:Math.abs(Math.round(he.pageY)-(((Ht=Je.current)==null?void 0:Ht.y)??0))}},zr=he=>{Dt.x<=10&&Dt.y<=10?he.preventDefault():ue.contains(he.target)||ct(!1),document.removeEventListener("pointermove",ir),Je.current=null};return Je.current!==null&&(document.addEventListener("pointermove",ir),document.addEventListener("pointerup",zr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ir),document.removeEventListener("pointerup",zr,{capture:!0})}}},[ue,ct,Je]),Z.useEffect(()=>{const Dt=()=>ct(!1);return window.addEventListener("blur",Dt),window.addEventListener("resize",Dt),()=>{window.removeEventListener("blur",Dt),window.removeEventListener("resize",Dt)}},[ct]);const[rt,bt]=Q4(Dt=>{const ir=He().filter(br=>!br.disabled),zr=ir.find(br=>br.ref.current===document.activeElement),he=eF(ir,Dt,zr);he&&setTimeout(()=>he.ref.current.focus())}),kt=Z.useCallback((Dt,ir,zr)=>{const he=!Ze.current&&!zr;(ee.value!==void 0&&ee.value===ir||he)&&(dt(Dt),he&&(Ze.current=!0))},[ee.value]),At=Z.useCallback(()=>ue==null?void 0:ue.focus(),[ue]),_r=Z.useCallback((Dt,ir,zr)=>{const he=!Ze.current&&!zr;(ee.value!==void 0&&ee.value===ir||he)&&qe(Dt)},[ee.value]),cn=u==="popper"?JT:z4,pr=cn===JT?{side:i,sideOffset:L,align:O,alignOffset:U,arrowPadding:q,collisionBoundary:G,collisionPadding:ie,sticky:J,hideWhenDetached:K,avoidCollisions:re}:{};return w.jsx(N4,{scope:o,content:ue,viewport:ge,onViewportChange:ke,itemRefCallback:kt,selectedItem:Be,onItemLeave:At,itemTextRefCallback:_r,focusSelectedItem:Gt,selectedItemText:Qe,position:u,isPositioned:et,searchRef:rt,children:w.jsx(lb,{as:Ku,allowPinchZoom:!0,children:w.jsx(ob,{asChild:!0,trapped:ee.open,onMountAutoFocus:Dt=>{Dt.preventDefault()},onUnmountAutoFocus:dr(g,Dt=>{var ir;(ir=ee.trigger)==null||ir.focus({preventScroll:!0}),Dt.preventDefault()}),children:w.jsx(sm,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:b,onPointerDownOutside:C,onFocusOutside:Dt=>Dt.preventDefault(),onDismiss:()=>ee.onOpenChange(!1),children:w.jsx(cn,{role:"listbox",id:ee.contentId,"data-state":ee.open?"open":"closed",dir:ee.dir,onContextMenu:Dt=>Dt.preventDefault(),...Q,...pr,onPlaced:()=>mt(!0),ref:Ce,style:{display:"flex",flexDirection:"column",outline:"none",...Q.style},onKeyDown:dr(Q.onKeyDown,Dt=>{const ir=Dt.ctrlKey||Dt.altKey||Dt.metaKey;if(Dt.key==="Tab"&&Dt.preventDefault(),!ir&&Dt.key.length===1&&bt(Dt.key),["ArrowUp","ArrowDown","Home","End"].includes(Dt.key)){let he=He().filter(br=>!br.disabled).map(br=>br.ref.current);if(["ArrowUp","End"].includes(Dt.key)&&(he=he.slice().reverse()),["ArrowUp","ArrowDown"].includes(Dt.key)){const br=Dt.target,Ht=he.indexOf(br);he=he.slice(Ht+1)}setTimeout(()=>Tt(he)),Dt.preventDefault()}})})})})})})});O4.displayName=AJ;var MJ="SelectItemAlignedPosition",z4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,onPlaced:u,...g}=e,b=cd(kh,o),C=ud(kh,o),[i,L]=Z.useState(null),[O,U]=Z.useState(null),q=Ln(n,Ce=>U(Ce)),G=wb(o),ie=Z.useRef(!1),J=Z.useRef(!0),{viewport:K,selectedItem:re,selectedItemText:Q,focusSelectedItem:ee}=C,ue=Z.useCallback(()=>{if(b.trigger&&b.valueNode&&i&&O&&K&&re&&Q){const Ce=b.trigger.getBoundingClientRect(),Be=O.getBoundingClientRect(),dt=b.valueNode.getBoundingClientRect(),Qe=Q.getBoundingClientRect();if(b.dir!=="rtl"){const br=Qe.left-Be.left,Ht=dt.left-br,jr=Ce.left-Ht,wt=Ce.width+jr,dn=Math.max(wt,Be.width),rn=window.innerWidth-Ua,Vn=_3(Ht,[Ua,Math.max(Ua,rn-dn)]);i.style.minWidth=wt+"px",i.style.left=Vn+"px"}else{const br=Be.right-Qe.right,Ht=window.innerWidth-dt.right-br,jr=window.innerWidth-Ce.right-Ht,wt=Ce.width+jr,dn=Math.max(wt,Be.width),rn=window.innerWidth-Ua,Vn=_3(Ht,[Ua,Math.max(Ua,rn-dn)]);i.style.minWidth=wt+"px",i.style.right=Vn+"px"}const qe=G(),He=window.innerHeight-Ua*2,et=K.scrollHeight,mt=window.getComputedStyle(O),Ze=parseInt(mt.borderTopWidth,10),Tt=parseInt(mt.paddingTop,10),Gt=parseInt(mt.borderBottomWidth,10),ct=parseInt(mt.paddingBottom,10),Je=Ze+Tt+et+ct+Gt,rt=Math.min(re.offsetHeight*5,Je),bt=window.getComputedStyle(K),kt=parseInt(bt.paddingTop,10),At=parseInt(bt.paddingBottom,10),_r=Ce.top+Ce.height/2-Ua,cn=He-_r,pr=re.offsetHeight/2,Dt=re.offsetTop+pr,ir=Ze+Tt+Dt,zr=Je-ir;if(ir<=_r){const br=qe.length>0&&re===qe[qe.length-1].ref.current;i.style.bottom="0px";const Ht=O.clientHeight-K.offsetTop-K.offsetHeight,jr=Math.max(cn,pr+(br?At:0)+Ht+Gt),wt=ir+jr;i.style.height=wt+"px"}else{const br=qe.length>0&&re===qe[0].ref.current;i.style.top="0px";const jr=Math.max(_r,Ze+K.offsetTop+(br?kt:0)+pr)+zr;i.style.height=jr+"px",K.scrollTop=ir-_r+K.offsetTop}i.style.margin=`${Ua}px 0`,i.style.minHeight=rt+"px",i.style.maxHeight=He+"px",u==null||u(),requestAnimationFrame(()=>ie.current=!0)}},[G,b.trigger,b.valueNode,i,O,K,re,Q,b.dir,u]);Ki(()=>ue(),[ue]);const[fe,ge]=Z.useState();Ki(()=>{O&&ge(window.getComputedStyle(O).zIndex)},[O]);const ke=Z.useCallback(Ce=>{Ce&&J.current===!0&&(ue(),ee==null||ee(),J.current=!1)},[ue,ee]);return w.jsx(PJ,{scope:o,contentWrapper:i,shouldExpandOnScrollRef:ie,onScrollButtonChange:ke,children:w.jsx("div",{ref:L,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:fe},children:w.jsx(qr.div,{...g,ref:q,style:{boxSizing:"border-box",maxHeight:"100%",...g.style}})})})});z4.displayName=MJ;var IJ="SelectPopperPosition",JT=Z.forwardRef((e,n)=>{const{__scopeSelect:o,align:u="start",collisionPadding:g=Ua,...b}=e,C=Sb(o);return w.jsx(yC,{...C,...b,ref:n,align:u,collisionPadding:g,style:{boxSizing:"border-box",...b.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});JT.displayName=IJ;var[PJ,eA]=gm(kh,{}),QT="SelectViewport",j4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,nonce:u,...g}=e,b=ud(QT,o),C=eA(QT,o),i=Ln(n,b.onViewportChange),L=Z.useRef(0);return w.jsxs(w.Fragment,{children:[w.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:u}),w.jsx(bb.Slot,{scope:o,children:w.jsx(qr.div,{"data-radix-select-viewport":"",role:"presentation",...g,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...g.style},onScroll:dr(g.onScroll,O=>{const U=O.currentTarget,{contentWrapper:q,shouldExpandOnScrollRef:G}=C;if(G!=null&&G.current&&q){const ie=Math.abs(L.current-U.scrollTop);if(ie>0){const J=window.innerHeight-Ua*2,K=parseFloat(q.style.minHeight),re=parseFloat(q.style.height),Q=Math.max(K,re);if(Q<J){const ee=Q+ie,ue=Math.min(J,ee),fe=ee-ue;q.style.height=ue+"px",q.style.bottom==="0px"&&(U.scrollTop=fe>0?fe:0,q.style.justifyContent="flex-end")}}}L.current=U.scrollTop})})})]})});j4.displayName=QT;var F4="SelectGroup",[RJ,kJ]=gm(F4),DJ=Z.forwardRef((e,n)=>{const{__scopeSelect:o,...u}=e,g=Ka();return w.jsx(RJ,{scope:o,id:g,children:w.jsx(qr.div,{role:"group","aria-labelledby":g,...u,ref:n})})});DJ.displayName=F4;var B4="SelectLabel",U4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,...u}=e,g=kJ(B4,o);return w.jsx(qr.div,{id:g.id,...u,ref:n})});U4.displayName=B4;var x1="SelectItem",[LJ,V4]=gm(x1),$4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,value:u,disabled:g=!1,textValue:b,...C}=e,i=cd(x1,o),L=ud(x1,o),O=i.value===u,[U,q]=Z.useState(b??""),[G,ie]=Z.useState(!1),J=Ln(n,ee=>{var ue;return(ue=L.itemRefCallback)==null?void 0:ue.call(L,ee,u,g)}),K=Ka(),re=Z.useRef("touch"),Q=()=>{g||(i.onValueChange(u),i.onOpenChange(!1))};if(u==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return w.jsx(LJ,{scope:o,value:u,disabled:g,textId:K,isSelected:O,onItemTextChange:Z.useCallback(ee=>{q(ue=>ue||((ee==null?void 0:ee.textContent)??"").trim())},[]),children:w.jsx(bb.ItemSlot,{scope:o,value:u,disabled:g,textValue:U,children:w.jsx(qr.div,{role:"option","aria-labelledby":K,"data-highlighted":G?"":void 0,"aria-selected":O&&G,"data-state":O?"checked":"unchecked","aria-disabled":g||void 0,"data-disabled":g?"":void 0,tabIndex:g?void 0:-1,...C,ref:J,onFocus:dr(C.onFocus,()=>ie(!0)),onBlur:dr(C.onBlur,()=>ie(!1)),onClick:dr(C.onClick,()=>{re.current!=="mouse"&&Q()}),onPointerUp:dr(C.onPointerUp,()=>{re.current==="mouse"&&Q()}),onPointerDown:dr(C.onPointerDown,ee=>{re.current=ee.pointerType}),onPointerMove:dr(C.onPointerMove,ee=>{var ue;re.current=ee.pointerType,g?(ue=L.onItemLeave)==null||ue.call(L):re.current==="mouse"&&ee.currentTarget.focus({preventScroll:!0})}),onPointerLeave:dr(C.onPointerLeave,ee=>{var ue;ee.currentTarget===document.activeElement&&((ue=L.onItemLeave)==null||ue.call(L))}),onKeyDown:dr(C.onKeyDown,ee=>{var fe;((fe=L.searchRef)==null?void 0:fe.current)!==""&&ee.key===" "||(xJ.includes(ee.key)&&Q(),ee.key===" "&&ee.preventDefault())})})})})});$4.displayName=x1;var L_="SelectItemText",G4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,className:u,style:g,...b}=e,C=cd(L_,o),i=ud(L_,o),L=V4(L_,o),O=TJ(L_,o),[U,q]=Z.useState(null),G=Ln(n,Q=>q(Q),L.onItemTextChange,Q=>{var ee;return(ee=i.itemTextRefCallback)==null?void 0:ee.call(i,Q,L.value,L.disabled)}),ie=U==null?void 0:U.textContent,J=Z.useMemo(()=>w.jsx("option",{value:L.value,disabled:L.disabled,children:ie},L.value),[L.disabled,L.value,ie]),{onNativeOptionAdd:K,onNativeOptionRemove:re}=O;return Ki(()=>(K(J),()=>re(J)),[K,re,J]),w.jsxs(w.Fragment,{children:[w.jsx(qr.span,{id:L.textId,...b,ref:G}),L.isSelected&&C.valueNode&&!C.valueNodeHasChildren?Nh.createPortal(b.children,C.valueNode):null]})});G4.displayName=L_;var q4="SelectItemIndicator",H4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,...u}=e;return V4(q4,o).isSelected?w.jsx(qr.span,{"aria-hidden":!0,...u,ref:n}):null});H4.displayName=q4;var eE="SelectScrollUpButton",W4=Z.forwardRef((e,n)=>{const o=ud(eE,e.__scopeSelect),u=eA(eE,e.__scopeSelect),[g,b]=Z.useState(!1),C=Ln(n,u.onScrollButtonChange);return Ki(()=>{if(o.viewport&&o.isPositioned){let i=function(){const O=L.scrollTop>0;b(O)};const L=o.viewport;return i(),L.addEventListener("scroll",i),()=>L.removeEventListener("scroll",i)}},[o.viewport,o.isPositioned]),g?w.jsx(X4,{...e,ref:C,onAutoScroll:()=>{const{viewport:i,selectedItem:L}=o;i&&L&&(i.scrollTop=i.scrollTop-L.offsetHeight)}}):null});W4.displayName=eE;var tE="SelectScrollDownButton",Z4=Z.forwardRef((e,n)=>{const o=ud(tE,e.__scopeSelect),u=eA(tE,e.__scopeSelect),[g,b]=Z.useState(!1),C=Ln(n,u.onScrollButtonChange);return Ki(()=>{if(o.viewport&&o.isPositioned){let i=function(){const O=L.scrollHeight-L.clientHeight,U=Math.ceil(L.scrollTop)<O;b(U)};const L=o.viewport;return i(),L.addEventListener("scroll",i),()=>L.removeEventListener("scroll",i)}},[o.viewport,o.isPositioned]),g?w.jsx(X4,{...e,ref:C,onAutoScroll:()=>{const{viewport:i,selectedItem:L}=o;i&&L&&(i.scrollTop=i.scrollTop+L.offsetHeight)}}):null});Z4.displayName=tE;var X4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,onAutoScroll:u,...g}=e,b=ud("SelectScrollButton",o),C=Z.useRef(null),i=wb(o),L=Z.useCallback(()=>{C.current!==null&&(window.clearInterval(C.current),C.current=null)},[]);return Z.useEffect(()=>()=>L(),[L]),Ki(()=>{var U;const O=i().find(q=>q.ref.current===document.activeElement);(U=O==null?void 0:O.ref.current)==null||U.scrollIntoView({block:"nearest"})},[i]),w.jsx(qr.div,{"aria-hidden":!0,...g,ref:n,style:{flexShrink:0,...g.style},onPointerDown:dr(g.onPointerDown,()=>{C.current===null&&(C.current=window.setInterval(u,50))}),onPointerMove:dr(g.onPointerMove,()=>{var O;(O=b.onItemLeave)==null||O.call(b),C.current===null&&(C.current=window.setInterval(u,50))}),onPointerLeave:dr(g.onPointerLeave,()=>{L()})})}),NJ="SelectSeparator",K4=Z.forwardRef((e,n)=>{const{__scopeSelect:o,...u}=e;return w.jsx(qr.div,{"aria-hidden":!0,...u,ref:n})});K4.displayName=NJ;var rE="SelectArrow",OJ=Z.forwardRef((e,n)=>{const{__scopeSelect:o,...u}=e,g=Sb(o),b=cd(rE,o),C=ud(rE,o);return b.open&&C.position==="popper"?w.jsx(vC,{...g,...u,ref:n}):null});OJ.displayName=rE;function Y4(e){return e===""||e===void 0}var J4=Z.forwardRef((e,n)=>{const{value:o,...u}=e,g=Z.useRef(null),b=Ln(n,g),C=JC(o);return Z.useEffect(()=>{const i=g.current,L=window.HTMLSelectElement.prototype,U=Object.getOwnPropertyDescriptor(L,"value").set;if(C!==o&&U){const q=new Event("change",{bubbles:!0});U.call(i,o),i.dispatchEvent(q)}},[C,o]),w.jsx(Ly,{asChild:!0,children:w.jsx("select",{...u,ref:b,defaultValue:o})})});J4.displayName="BubbleSelect";function Q4(e){const n=_s(e),o=Z.useRef(""),u=Z.useRef(0),g=Z.useCallback(C=>{const i=o.current+C;n(i),function L(O){o.current=O,window.clearTimeout(u.current),O!==""&&(u.current=window.setTimeout(()=>L(""),1e3))}(i)},[n]),b=Z.useCallback(()=>{o.current="",window.clearTimeout(u.current)},[]);return Z.useEffect(()=>()=>window.clearTimeout(u.current),[]),[o,g,b]}function eF(e,n,o){const g=n.length>1&&Array.from(n).every(O=>O===n[0])?n[0]:n,b=o?e.indexOf(o):-1;let C=zJ(e,Math.max(b,0));g.length===1&&(C=C.filter(O=>O!==o));const L=C.find(O=>O.textValue.toLowerCase().startsWith(g.toLowerCase()));return L!==o?L:void 0}function zJ(e,n){return e.map((o,u)=>e[(n+u)%e.length])}var jJ=A4,tF=I4,FJ=R4,BJ=k4,UJ=D4,rF=L4,VJ=j4,nF=U4,iF=$4,$J=G4,GJ=H4,sF=W4,oF=Z4,aF=K4;const Ep=jJ,Cp=FJ,ph=Z.forwardRef(({className:e,children:n,...o},u)=>w.jsxs(tF,{ref:u,className:Rr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...o,children:[n,w.jsx(BJ,{asChild:!0,children:w.jsx(nC,{className:"h-4 w-4 opacity-50"})})]}));ph.displayName=tF.displayName;const lF=Z.forwardRef(({className:e,...n},o)=>w.jsx(sF,{ref:o,className:Rr("flex cursor-default items-center justify-center py-1",e),...n,children:w.jsx(xN,{className:"h-4 w-4"})}));lF.displayName=sF.displayName;const cF=Z.forwardRef(({className:e,...n},o)=>w.jsx(oF,{ref:o,className:Rr("flex cursor-default items-center justify-center py-1",e),...n,children:w.jsx(nC,{className:"h-4 w-4"})}));cF.displayName=oF.displayName;const mh=Z.forwardRef(({className:e,children:n,position:o="popper",...u},g)=>w.jsx(UJ,{children:w.jsxs(rF,{ref:g,className:Rr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:o,...u,children:[w.jsx(lF,{}),w.jsx(VJ,{className:Rr("p-1",o==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),w.jsx(cF,{})]})}));mh.displayName=rF.displayName;const qJ=Z.forwardRef(({className:e,...n},o)=>w.jsx(nF,{ref:o,className:Rr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...n}));qJ.displayName=nF.displayName;const ss=Z.forwardRef(({className:e,children:n,...o},u)=>w.jsxs(iF,{ref:u,className:Rr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...o,children:[w.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:w.jsx(GJ,{children:w.jsx(rC,{className:"h-4 w-4"})})}),w.jsx($J,{children:n})]}));ss.displayName=iF.displayName;const HJ=Z.forwardRef(({className:e,...n},o)=>w.jsx(aF,{ref:o,className:Rr("-mx-1 my-1 h-px bg-muted",e),...n}));HJ.displayName=aF.displayName;var tA="Avatar",[WJ,BQ]=Jo(tA),[ZJ,uF]=WJ(tA),dF=Z.forwardRef((e,n)=>{const{__scopeAvatar:o,...u}=e,[g,b]=Z.useState("idle");return w.jsx(ZJ,{scope:o,imageLoadingStatus:g,onImageLoadingStatusChange:b,children:w.jsx(qr.span,{...u,ref:n})})});dF.displayName=tA;var hF="AvatarImage",fF=Z.forwardRef((e,n)=>{const{__scopeAvatar:o,src:u,onLoadingStatusChange:g=()=>{},...b}=e,C=uF(hF,o),i=XJ(u,b.referrerPolicy),L=_s(O=>{g(O),C.onImageLoadingStatusChange(O)});return Ki(()=>{i!=="idle"&&L(i)},[i,L]),i==="loaded"?w.jsx(qr.img,{...b,ref:n,src:u}):null});fF.displayName=hF;var pF="AvatarFallback",mF=Z.forwardRef((e,n)=>{const{__scopeAvatar:o,delayMs:u,...g}=e,b=uF(pF,o),[C,i]=Z.useState(u===void 0);return Z.useEffect(()=>{if(u!==void 0){const L=window.setTimeout(()=>i(!0),u);return()=>window.clearTimeout(L)}},[u]),C&&b.imageLoadingStatus!=="loaded"?w.jsx(qr.span,{...g,ref:n}):null});mF.displayName=pF;function XJ(e,n){const[o,u]=Z.useState("idle");return Ki(()=>{if(!e){u("error");return}let g=!0;const b=new window.Image,C=i=>()=>{g&&u(i)};return u("loading"),b.onload=C("loaded"),b.onerror=C("error"),b.src=e,n&&(b.referrerPolicy=n),()=>{g=!1}},[e,n]),o}var gF=dF,_F=fF,yF=mF;const vF=Z.forwardRef(({className:e,...n},o)=>w.jsx(gF,{ref:o,className:Rr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...n}));vF.displayName=gF.displayName;const xF=Z.forwardRef(({className:e,...n},o)=>w.jsx(_F,{ref:o,className:Rr("aspect-square h-full w-full",e),...n}));xF.displayName=_F.displayName;const bF=Z.forwardRef(({className:e,...n},o)=>w.jsx(yF,{ref:o,className:Rr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...n}));bF.displayName=yF.displayName;const y3=({onImageUpload:e,value:n,label:o="Selecionar imagem",maxSizeInMB:u=5,acceptedFileTypes:g="image/*"})=>{const[b,C]=Z.useState(!1),[i,L]=Z.useState(n||null),O=async q=>{var K;const G=(K=q.target.files)==null?void 0:K[0];if(!G)return;if(G.size/(1024*1024)>u){ar({title:"Arquivo muito grande",description:`O arquivo excede o tamanho máximo de ${u}MB`,variant:"destructive"});return}const J=URL.createObjectURL(G);L(J),C(!0);try{let re="";try{const Q=G.name.split(".").pop(),ue=`product-images/${`${Math.random().toString(36).substring(2,15)}_${Date.now()}.${Q}`}`,{data:fe,error:ge}=await Qt.storage.from("product-images").upload(ue,G);if(ge)throw new Error(ge.message);const{data:ke}=Qt.storage.from("product-images").getPublicUrl(ue);re=(ke==null?void 0:ke.publicUrl)||""}catch(Q){console.error("Erro no upload para o Supabase:",Q),re=J}e(re),ar({title:"Upload concluído",description:"Imagem carregada com sucesso!"})}catch(re){console.error("Erro no upload:",re),ar({title:"Erro no upload",description:"Não foi possível carregar a imagem",variant:"destructive"})}finally{C(!1)}},U=()=>{L(null),e("")};return w.jsxs("div",{className:"space-y-2",children:[i?w.jsxs("div",{className:"relative rounded-md overflow-hidden h-40 bg-gray-100",children:[w.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover",onError:()=>{L("/placeholder.svg")}}),w.jsx($t,{type:"button",size:"icon",variant:"destructive",className:"absolute top-2 right-2",onClick:U,children:w.jsx(Yu,{className:"h-4 w-4"})})]}):w.jsxs("div",{className:"relative flex items-center justify-center border-2 border-dashed border-gray-300 rounded-md h-40 bg-gray-50",children:[w.jsxs("div",{className:"space-y-2 text-center",children:[w.jsx(m$,{className:"mx-auto h-12 w-12 text-gray-400"}),w.jsx("div",{className:"text-gray-500 text-sm",children:b?"Carregando...":"Arraste e solte ou clique para selecionar"})]}),w.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:O,accept:g,disabled:b})]}),w.jsx("div",{className:"flex justify-center",children:!b&&!i&&w.jsxs("div",{className:"relative w-full",children:[w.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:O,accept:g,disabled:b}),w.jsxs($t,{type:"button",variant:"outline",disabled:b,className:"w-full",children:[w.jsx(EN,{className:"h-4 w-4 mr-2"}),o]})]})})]})},KJ=[{id:1,full_name:"João Silva",email:"joao@email.com",role:"waiter",status:"active",photo_url:""},{id:2,full_name:"Maria Souza",email:"maria@email.com",role:"chef",status:"active",photo_url:""},{id:3,full_name:"Carlos Pereira",email:"carlos@email.com",role:"customer",status:"active",photo_url:""},{id:4,full_name:"Ana Oliveira",email:"ana@email.com",role:"waiter",status:"inactive",photo_url:""}],YJ=[{id:5,full_name:"Roberto Alves",email:"roberto@email.com",role:"customer",status:"active",photo_url:""},{id:6,full_name:"Fernanda Lima",email:"fernanda@email.com",role:"chef",status:"active",photo_url:""}],v3=()=>{const{currentUser:e}=Fh(),[n,o]=Z.useState(KJ),[u,g]=Z.useState(!1),[b,C]=Z.useState(!1),i=nl(),[L,O]=Z.useState(!1),[U,q]=Z.useState(!1),[G,ie]=Z.useState(null),[J,K]=Z.useState({full_name:"",email:"",role:"customer",status:"active",photo_url:"",password:""}),re=(e==null?void 0:e.role)==="admin"||(e==null?void 0:e.role)==="restaurant_owner";Z.useEffect(()=>{const He=localStorage.getItem("appUsers");if(He)try{o(JSON.parse(He))}catch(et){console.error("Erro ao carregar usuários:",et)}Q()},[]);const Q=async()=>{try{const{data:He,error:et}=await Qt.from("profiles").select("*");if(et){console.error("Erro ao buscar usuários do Supabase:",et);return}if(He&&He.length>0){const mt=He.map(Ze=>({id:Ze.id,full_name:Ze.name||Ze.email||"Nome não disponível",email:Ze.email||"Email não disponível",role:Ze.role||"customer",status:"active",photo_url:Ze.avatar_url||""}));o(mt),localStorage.setItem("appUsers",JSON.stringify(mt))}}catch(He){console.error("Erro ao processar dados do Supabase:",He)}},ee=()=>{g(!0),setTimeout(()=>{if(b)ar({title:"Lista de usuários atualizada",description:"Nenhum novo usuário encontrado."});else{const He=[...n,...YJ];o(He),C(!0),localStorage.setItem("appUsers",JSON.stringify(He)),ar({title:"Lista de usuários atualizada",description:"Foram encontrados 2 novos usuários no sistema."})}g(!1)},800)},ue=He=>{const{name:et,value:mt}=He.target;U?ie(Ze=>({...Ze,[et]:mt})):K(Ze=>({...Ze,[et]:mt}))},fe=He=>{U?ie(et=>({...et,role:He})):K(et=>({...et,role:He}))},ge=He=>{U?ie(et=>({...et,status:He})):K(et=>({...et,status:He}))},ke=He=>{U?ie(et=>({...et,photo_url:He})):K(et=>({...et,photo_url:He}))},Ce=He=>{ie(He),q(!0)},Be=async()=>{if(!G)return;try{const{error:et}=await Qt.from("profiles").update({name:G.full_name,email:G.email,role:G.role,avatar_url:G.photo_url}).eq("id",G.id);if(et)console.error("Erro ao atualizar usuário no Supabase:",et);else{ar({title:"Usuário atualizado com sucesso",description:`${G.name} foi atualizado.`}),Q(),q(!1),ie(null);return}}catch(et){console.error("Erro ao processar atualização de usuário:",et)}const He=n.map(et=>et.id===G.id?G:et);o(He),localStorage.setItem("appUsers",JSON.stringify(He)),ar({title:"Usuário atualizado com sucesso",description:`${G.full_name} foi atualizado.`}),q(!1),ie(null)},dt=async()=>{if(!J.full_name||!J.email||!J.password){ar({title:"Campos obrigatórios",description:"Preencha todos os campos obrigatórios",variant:"destructive"});return}try{const{data:Ze,error:Tt}=await Qt.auth.signUp({email:J.email,password:J.password,options:{data:{full_name:J.full_name,role:J.role,avatar_url:J.photo_url}}});if(Tt)throw console.error("Erro ao criar usuário na autenticação:",Tt),Tt;if(Ze.user){await new Promise(Je=>setTimeout(Je,1e3));const{data:Gt,error:ct}=await Qt.from("profiles").select("*").eq("id",Ze.user.id).single();if(ct&&ct.code==="PGRST116"){const{error:Je}=await Qt.from("profiles").insert({id:Ze.user.id,email:J.email,full_name:J.full_name,role:J.role,avatar_url:J.photo_url});if(Je)throw console.error("Erro ao criar perfil:",Je),Je}}console.log("Usuário criado com sucesso na autenticação do Supabase"),ar({title:"Usuário adicionado com sucesso",description:`${J.full_name} foi adicionado ao sistema.`}),await Q(),O(!1),K({full_name:"",email:"",password:"",role:"customer",status:"active",photo_url:""});return}catch(Ze){console.error("Erro ao processar adição de usuário:",Ze)}const et={id:Math.max(...n.map(Ze=>Ze.id),0)+1,full_name:J.full_name,email:J.email,role:J.role,status:J.status,photo_url:J.photo_url},mt=[...n,et];o(mt),localStorage.setItem("appUsers",JSON.stringify(mt)),ar({title:"Usuário adicionado com sucesso",description:`${J.full_name} foi adicionado ao sistema.`}),O(!1),K({full_name:"",email:"",password:"",role:"customer",status:"active",photo_url:""})},Qe=He=>{const et=n.map(Tt=>{if(Tt.id===He){const Gt=Tt.status==="active"?"inactive":"active";return{...Tt,status:Gt}}return Tt});o(et),localStorage.setItem("appUsers",JSON.stringify(et));const mt=n.find(Tt=>Tt.id===He),Ze=(mt==null?void 0:mt.status)==="active"?"inactive":"active";ar({title:"Status atualizado",description:`${mt==null?void 0:mt.full_name} agora está ${Ze==="active"?"ativo":"inativo"}.`});try{Qt.from("profiles").update({}).eq("id",He).then(({error:Tt})=>{Tt&&console.error("Erro ao atualizar status no Supabase:",Tt)})}catch(Tt){console.error("Erro ao atualizar status:",Tt)}},qe=async He=>{const et=n.find(Ze=>Ze.id===He);if(!et||!window.confirm(`Tem certeza que deseja excluir o usuário ${et.full_name}? Esta ação não pode ser desfeita.`))return;try{const{error:Ze}=await Qt.from("profiles").delete().eq("id",He);if(Ze)throw console.error("Erro ao excluir perfil do Supabase:",Ze),Ze;ar({title:"Usuário excluído com sucesso",description:`${et.full_name} foi removido do sistema.`}),await Q();return}catch(Ze){console.error("Erro ao processar exclusão de usuário:",Ze)}const mt=n.filter(Ze=>Ze.id!==He);o(mt),localStorage.setItem("appUsers",JSON.stringify(mt)),ar({title:"Usuário excluído com sucesso",description:`${et.full_name} foi removido do sistema.`})};return re?w.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16",children:[w.jsxs("div",{className:"container mx-auto px-4 py-8",children:[w.jsxs("div",{className:"flex justify-between items-center mb-6",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("h1",{className:"text-2xl font-bold",children:"Gerenciamento de Usuários"}),w.jsx($t,{size:"icon",variant:"outline",onClick:ee,className:"rounded-full h-8 w-8",disabled:u,children:w.jsx(SN,{className:`h-4 w-4 ${u?"animate-spin":""}`})})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsxs($t,{onClick:()=>O(!0),children:[w.jsx(T$,{className:"h-4 w-4 mr-2"})," Adicionar Usuário"]}),w.jsx($t,{variant:"outline",onClick:()=>i("/"),children:"Voltar para o menu"})]})]}),w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(He=>w.jsxs(Un,{children:[w.jsxs(wi,{className:"flex flex-row items-center gap-3 pb-2",children:[w.jsxs(vF,{className:"h-12 w-12",children:[w.jsx(xF,{src:He.photo_url,alt:He.full_name}),w.jsx(bF,{className:"bg-menu-primary text-white",children:He.full_name.split(" ").map(et=>et[0]).join("").toUpperCase().substring(0,2)})]}),w.jsxs("div",{children:[w.jsx(Si,{className:"text-base",children:He.full_name}),w.jsx(ls,{className:"text-xs",children:He.email})]})]}),w.jsxs(fi,{children:[w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-500",children:"Função:"}),w.jsx("span",{className:"font-medium",children:He.role==="admin"?"Administrador":He.role==="restaurant_owner"?"Proprietário":He.role==="waiter"?"Garçom":He.role==="chef"?"Chef":"Cliente"})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-500",children:"Status:"}),w.jsx("span",{className:`font-medium ${He.status==="active"?"text-green-500":"text-red-500"}`,children:He.status==="active"?"Ativo":"Inativo"})]})]}),w.jsxs("div",{className:"mt-4 space-y-2",children:[w.jsx($t,{className:"w-full",variant:He.status==="active"?"default":"outline",onClick:()=>Qe(He.id),children:He.status==="active"?"Desativar":"Ativar"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx($t,{variant:"outline",className:"flex-1",onClick:()=>Ce(He),children:"Editar"}),w.jsxs($t,{variant:"destructive",className:"flex-1",onClick:()=>qe(He.id),children:[w.jsx($1,{className:"h-4 w-4 mr-1"}),"Excluir"]})]})]})]})]},He.id))})]}),w.jsx(Nl,{open:L,onOpenChange:O,children:w.jsxs(tl,{className:"sm:max-w-[425px]",children:[w.jsx(Ol,{children:w.jsx(zl,{children:"Adicionar Novo Usuário"})}),w.jsxs("div",{className:"grid gap-4 py-4",children:[w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"photo_url",children:"Foto de Perfil"}),w.jsx(y3,{onImageUpload:ke,value:J.photo_url,label:"Selecionar foto de perfil",maxSizeInMB:2,acceptedFileTypes:"image/*"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"name",children:"Nome Completo"}),w.jsx(En,{id:"name",name:"full_name",value:J.full_name,onChange:ue,placeholder:"Digite o nome completo"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"email",children:"Email"}),w.jsx(En,{id:"email",name:"email",type:"email",value:J.email,onChange:ue,placeholder:"email@exemplo.com"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"password",children:"Senha"}),w.jsx(En,{id:"password",name:"password",type:"password",value:J.password,onChange:ue,placeholder:"Digite a senha"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"role",children:"Função"}),w.jsxs(Ep,{value:J.role,onValueChange:fe,children:[w.jsx(ph,{id:"role",children:w.jsx(Cp,{placeholder:"Selecione a função"})}),w.jsxs(mh,{children:[w.jsx(ss,{value:"admin",children:"Administrador"}),w.jsx(ss,{value:"restaurant_owner",children:"Proprietário"}),w.jsx(ss,{value:"chef",children:"Chef"}),w.jsx(ss,{value:"waiter",children:"Garçom"}),w.jsx(ss,{value:"customer",children:"Cliente"})]})]})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"status",children:"Status"}),w.jsxs(Ep,{value:J.status,onValueChange:ge,children:[w.jsx(ph,{id:"status",children:w.jsx(Cp,{placeholder:"Selecione o status"})}),w.jsxs(mh,{children:[w.jsx(ss,{value:"active",children:"Ativo"}),w.jsx(ss,{value:"inactive",children:"Inativo"})]})]})]})]}),w.jsxs(wy,{children:[w.jsx($t,{variant:"outline",onClick:()=>O(!1),type:"button",children:"Cancelar"}),w.jsx($t,{onClick:dt,type:"button",children:"Adicionar"})]})]})}),w.jsx(Nl,{open:U,onOpenChange:q,children:w.jsxs(tl,{className:"sm:max-w-[425px]",children:[w.jsx(Ol,{children:w.jsx(zl,{children:"Editar Usuário"})}),G&&w.jsxs("div",{className:"grid gap-4 py-4",children:[w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"edit_photo_url",children:"Foto de Perfil"}),w.jsx(y3,{onImageUpload:ke,value:G.photo_url,label:"Selecionar foto de perfil",maxSizeInMB:2,acceptedFileTypes:"image/*"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"edit_name",children:"Nome Completo"}),w.jsx(En,{id:"edit_name",name:"full_name",value:G.full_name,onChange:ue,placeholder:"Digite o nome completo"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"edit_email",children:"Email"}),w.jsx(En,{id:"edit_email",name:"email",type:"email",value:G.email,onChange:ue,placeholder:"email@exemplo.com"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"edit_role",children:"Função"}),w.jsxs(Ep,{value:G.role,onValueChange:fe,children:[w.jsx(ph,{id:"edit_role",children:w.jsx(Cp,{placeholder:"Selecione a função"})}),w.jsxs(mh,{children:[w.jsx(ss,{value:"admin",children:"Administrador"}),w.jsx(ss,{value:"restaurant_owner",children:"Proprietário"}),w.jsx(ss,{value:"chef",children:"Chef"}),w.jsx(ss,{value:"waiter",children:"Garçom"}),w.jsx(ss,{value:"customer",children:"Cliente"})]})]})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"edit_status",children:"Status"}),w.jsxs(Ep,{value:G.status,onValueChange:ge,children:[w.jsx(ph,{id:"edit_status",children:w.jsx(Cp,{placeholder:"Selecione o status"})}),w.jsxs(mh,{children:[w.jsx(ss,{value:"active",children:"Ativo"}),w.jsx(ss,{value:"inactive",children:"Inativo"})]})]})]})]}),w.jsxs(wy,{children:[w.jsx($t,{variant:"outline",onClick:()=>q(!1),type:"button",children:"Cancelar"}),w.jsx($t,{onClick:Be,type:"button",children:"Salvar Alterações"})]})]})})]}):w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs(Un,{className:"w-full max-w-md mx-auto",children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Acesso restrito"}),w.jsx(ls,{children:"Você não tem permissão para acessar esta página"})]}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-500",children:"Esta página é destinada apenas para administradores ou proprietários do restaurante."}),w.jsx($t,{className:"mt-4",onClick:()=>i("/"),children:"Voltar para o início"})]})]})})})},x3=()=>{const{currentUser:e}=Fh(),n=nl(),o=(e==null?void 0:e.role)==="admin"||(e==null?void 0:e.role)==="restaurant_owner",[u,g]=Z.useState(""),[b,C]=Z.useState(""),[i,L]=Z.useState(!1),[O,U]=Z.useState(null),[q,G]=Z.useState(!1),[ie,J]=Z.useState("url"),K=()=>{if(ie==="url"&&!u){ar({title:"URL vazia",description:"Por favor, insira uma URL para importar a API.",variant:"destructive"});return}if(ie==="token"&&!b){ar({title:"Token vazio",description:"Por favor, insira um token para importar a API.",variant:"destructive"});return}L(!0),setTimeout(()=>{(ie==="url"?u.includes("tracking")||u.includes("motoboy")||u.includes("rastreio"):b==="delivery_tracker_api_g2sly4g0l86")?(U("OrderTrackingAPI"),ar({title:"API importada com sucesso!",description:"A API de rastreamento de pedidos foi importada e está pronta para uso."}),setTimeout(()=>{n("/order-tracking")},1500)):ar({title:"API não reconhecida",description:"A URL ou Token fornecido não corresponde a uma API compatível ou válida.",variant:"destructive"}),L(!1)},2e3)},re=()=>{G(!0),ar({title:"Página restaurada",description:"A página de rastreamento de pedidos foi restaurada para sua versão original."}),setTimeout(()=>{G(!1)},1e3)};return o?w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsxs("div",{className:"container mx-auto px-4 py-8",children:[w.jsxs("div",{className:"flex justify-between items-center mb-6",children:[w.jsx("h1",{className:"text-2xl font-bold",children:"Gerenciamento de APIs"}),w.jsx($t,{onClick:()=>n("/"),children:"Voltar para o menu"})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[w.jsxs(Un,{children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Importar nova API"}),w.jsx(ls,{children:"Insira a URL ou o Token da API que deseja importar para o sistema"})]}),w.jsxs(fi,{className:"space-y-4",children:[w.jsxs(Vh,{defaultValue:"url",onValueChange:Q=>J(Q),children:[w.jsxs(ld,{className:"grid w-full grid-cols-2",children:[w.jsx(cs,{value:"url",children:"URL"}),w.jsx(cs,{value:"token",children:"Token"})]}),w.jsx(us,{value:"url",className:"space-y-4 mt-4",children:w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"api-url",children:"URL da API"}),w.jsx(En,{id:"api-url",placeholder:"https://api.exemplo.com/v1/tracking",value:u,onChange:Q=>g(Q.target.value)})]})}),w.jsx(us,{value:"token",className:"space-y-4 mt-4",children:w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"api-token",children:"Token da API"}),w.jsx("div",{className:"flex gap-2",children:w.jsx(En,{id:"api-token",placeholder:"delivery_tracker_api_xxxx",value:b,onChange:Q=>C(Q.target.value),className:"flex-1"})})]})})]}),w.jsxs("div",{className:"text-sm text-gray-500",children:[w.jsx("p",{children:"APIs suportadas:"}),w.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[w.jsx("li",{children:"API de Rastreamento de Pedidos"}),w.jsx("li",{children:"API de Pagamentos (em breve)"}),w.jsx("li",{children:"API de Integração com Delivery (em breve)"})]})]})]}),w.jsxs(by,{className:"flex justify-between",children:[w.jsx($t,{variant:"outline",onClick:()=>{g(""),C("")},children:"Limpar"}),w.jsx($t,{onClick:K,disabled:i||(ie==="url"?!u:!b),className:"flex items-center gap-2",children:i?w.jsxs(w.Fragment,{children:[w.jsx(nk,{className:"h-4 w-4 animate-spin"}),"Importando..."]}):w.jsxs(w.Fragment,{children:[w.jsx(i$,{className:"h-4 w-4"}),"Importar API"]})})]})]}),w.jsxs(Un,{children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"APIs Ativas"}),w.jsx(ls,{children:"Gerencie as APIs atualmente ativas no sistema"})]}),w.jsxs(fi,{className:"space-y-4",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"flex items-center justify-between border-b pb-3",children:[w.jsxs("div",{children:[w.jsx("p",{className:"font-medium",children:"API de Rastreamento de Pedidos"}),w.jsx("p",{className:"text-sm text-gray-500",children:O?"Versão personalizada":"Versão padrão"})]}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(v1,{checked:!!O,onCheckedChange:Q=>{Q||re()}}),w.jsx("span",{className:O?"text-green-500 text-sm":"text-gray-500 text-sm",children:O?"Personalizada":"Padrão"})]})]}),O&&w.jsxs("div",{className:"flex justify-between items-center",children:[w.jsx("span",{className:"text-sm",children:"Restaurar versão padrão"}),w.jsxs($t,{variant:"outline",size:"sm",onClick:re,className:"flex items-center gap-1",children:[w.jsx(nk,{className:"h-3 w-3"}),"Reset"]})]})]}),w.jsxs("div",{className:"space-y-4 mt-8",children:[w.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Outras APIs (em breve)"}),w.jsxs("div",{className:"flex items-center justify-between border-b pb-3 opacity-50",children:[w.jsxs("div",{children:[w.jsx("p",{className:"font-medium",children:"API de Pagamentos"}),w.jsx("p",{className:"text-sm text-gray-500",children:"Integração com múltiplos gateways"})]}),w.jsx("span",{className:"text-amber-500 text-sm",children:"Em breve"})]}),w.jsxs("div",{className:"flex items-center justify-between opacity-50",children:[w.jsxs("div",{children:[w.jsx("p",{className:"font-medium",children:"API de Delivery"}),w.jsx("p",{className:"text-sm text-gray-500",children:"Integração com serviços de entrega"})]}),w.jsx("span",{className:"text-amber-500 text-sm",children:"Em breve"})]})]})]}),w.jsx(by,{className:"flex justify-center",children:w.jsxs("div",{className:"text-center text-xs text-gray-500",children:[w.jsx("p",{children:"Contate nosso suporte para mais integrações"}),w.jsx("p",{children:"suporte@cardapiodigital.com.br"})]})})]})]})]})}):w.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:w.jsx("div",{className:"container mx-auto px-4 py-8",children:w.jsxs(Un,{className:"w-full max-w-md mx-auto",children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Acesso restrito"}),w.jsx(ls,{children:"Você não tem permissão para acessar esta página"})]}),w.jsxs(fi,{children:[w.jsx("p",{className:"text-gray-500",children:"Esta página é destinada apenas para administradores ou proprietários do restaurante."}),w.jsx($t,{className:"mt-4",onClick:()=>n("/"),children:"Voltar para o início"})]})]})})})},b3=()=>{const e=nl(),{signIn:n,signUp:o,signInWithGoogle:u,user:g,currentUser:b}=jh(),[C,i]=Z.useState("login"),[L,O]=Z.useState(!1),[U,q]=Z.useState(!1),[G,ie]=Z.useState({email:"",password:""}),[J,K]=Z.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phone:""});Z.useEffect(()=>{g&&b&&e("/")},[g,b,e]);const re=ge=>{const{name:ke,value:Ce}=ge.target;ie(Be=>({...Be,[ke]:Ce}))},Q=ge=>{const{name:ke,value:Ce}=ge.target;K(Be=>({...Be,[ke]:Ce}))},ee=async ge=>{ge.preventDefault(),q(!0);try{const{error:ke}=await n(G.email,G.password);ar(ke?{title:"Erro ao fazer login",description:ke.message||"Verifique suas credenciais e tente novamente.",variant:"destructive"}:{title:"Login realizado com sucesso",description:"Bem-vindo ao sistema!"})}catch(ke){console.error("Erro ao fazer login:",ke),ar({title:"Erro ao fazer login",description:"Erro inesperado. Tente novamente.",variant:"destructive"})}finally{q(!1)}},ue=async ge=>{if(ge.preventDefault(),q(!0),J.password!==J.confirmPassword){ar({title:"Senhas não coincidem",description:"A senha e a confirmação da senha devem ser iguais.",variant:"destructive"}),q(!1);return}try{const{error:ke}=await o(J.email,J.password,{full_name:`${J.firstName} ${J.lastName}`,phone:J.phone});ke?ar({title:"Erro ao fazer cadastro",description:ke.message||"Não foi possível completar o cadastro. Tente novamente.",variant:"destructive"}):(ar({title:"Cadastro realizado com sucesso",description:"Verifique seu email para confirmar a conta."}),i("login"))}catch(ke){console.error("Erro ao fazer cadastro:",ke),ar({title:"Erro ao fazer cadastro",description:"Erro inesperado. Tente novamente.",variant:"destructive"})}finally{q(!1)}},fe=async()=>{q(!0);try{const{error:ge}=await u();ge?(console.error("Erro ao fazer login com Google:",ge),ar({title:"Erro ao autenticar com Google",description:ge.message||"Não foi possível fazer login com o Google. Tente novamente.",variant:"destructive"}),q(!1)):ar({title:"Autenticando com Google",description:"Você será redirecionado..."})}catch(ge){console.error("Erro ao fazer login com Google:",ge),ar({title:"Erro ao autenticar com Google",description:ge.message||"Não foi possível fazer login com o Google. Tente novamente.",variant:"destructive"}),q(!1)}};return w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center p-4",children:w.jsxs("div",{className:"w-full max-w-md",children:[w.jsxs("div",{className:"text-center mb-8",children:[w.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"DelliApp"}),w.jsx("p",{className:"text-gray-600",children:"Sistema de Gestão de Restaurantes"})]}),w.jsxs(Un,{className:"shadow-xl border-0",children:[w.jsxs(wi,{className:"space-y-1",children:[w.jsx(Si,{className:"text-2xl text-center",children:"Bem-vindo"}),w.jsx(ls,{className:"text-center",children:"Faça login ou crie sua conta para continuar"})]}),w.jsx(fi,{children:w.jsxs(Vh,{value:C,onValueChange:i,className:"w-full",children:[w.jsxs(ld,{className:"grid w-full grid-cols-2",children:[w.jsx(cs,{value:"login",children:"Login"}),w.jsx(cs,{value:"register",children:"Cadastro"})]}),w.jsxs(us,{value:"login",className:"space-y-4",children:[w.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"email",children:"Email"}),w.jsxs("div",{className:"relative",children:[w.jsx(rk,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),w.jsx(En,{id:"email",name:"email",type:"email",placeholder:"seu@email.com",value:G.email,onChange:re,className:"pl-10",required:!0})]})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"password",children:"Senha"}),w.jsxs("div",{className:"relative",children:[w.jsx(Q2,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),w.jsx(En,{id:"password",name:"password",type:L?"text":"password",placeholder:"Sua senha",value:G.password,onChange:re,className:"pl-10 pr-10",required:!0}),w.jsx("button",{type:"button",onClick:()=>O(!L),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:L?w.jsx(tk,{className:"h-4 w-4"}):w.jsx(bT,{className:"h-4 w-4"})})]})]}),w.jsx($t,{type:"submit",className:"w-full",disabled:U,children:U?"Entrando...":"Entrar"})]}),w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 flex items-center",children:w.jsx("span",{className:"w-full border-t"})}),w.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:w.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ou continue com"})})]}),w.jsxs($t,{variant:"outline",className:"w-full",onClick:fe,disabled:U,children:[w.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[w.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),w.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),w.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),w.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),U?"Conectando...":"Continuar com Google"]})]}),w.jsxs(us,{value:"register",className:"space-y-4",children:[w.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"firstName",children:"Nome"}),w.jsx(En,{id:"firstName",name:"firstName",type:"text",placeholder:"João",value:J.firstName,onChange:Q,required:!0})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"lastName",children:"Sobrenome"}),w.jsx(En,{id:"lastName",name:"lastName",type:"text",placeholder:"Silva",value:J.lastName,onChange:Q,required:!0})]})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"registerEmail",children:"Email"}),w.jsxs("div",{className:"relative",children:[w.jsx(rk,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),w.jsx(En,{id:"registerEmail",name:"email",type:"email",placeholder:"seu@email.com",value:J.email,onChange:Q,className:"pl-10",required:!0})]})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"phone",children:"Telefone"}),w.jsx(En,{id:"phone",name:"phone",type:"tel",placeholder:"(11) 99999-9999",value:J.phone,onChange:Q})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"registerPassword",children:"Senha"}),w.jsxs("div",{className:"relative",children:[w.jsx(Q2,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),w.jsx(En,{id:"registerPassword",name:"password",type:L?"text":"password",placeholder:"Sua senha",value:J.password,onChange:Q,className:"pl-10 pr-10",required:!0}),w.jsx("button",{type:"button",onClick:()=>O(!L),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:L?w.jsx(tk,{className:"h-4 w-4"}):w.jsx(bT,{className:"h-4 w-4"})})]})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"confirmPassword",children:"Confirmar Senha"}),w.jsxs("div",{className:"relative",children:[w.jsx(Q2,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),w.jsx(En,{id:"confirmPassword",name:"confirmPassword",type:L?"text":"password",placeholder:"Confirme sua senha",value:J.confirmPassword,onChange:Q,className:"pl-10",required:!0})]})]}),w.jsx($t,{type:"submit",className:"w-full",disabled:U,children:U?"Criando conta...":"Criar conta"})]}),w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 flex items-center",children:w.jsx("span",{className:"w-full border-t"})}),w.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:w.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ou continue com"})})]}),w.jsxs($t,{variant:"outline",className:"w-full",onClick:fe,disabled:U,children:[w.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[w.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),w.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),w.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),w.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),U?"Conectando...":"Continuar com Google"]})]})]})})]})]})})},w3=()=>{const e=nl(),{user:n,currentUser:o}=jh(),{isAdminMode:u,isClientMode:g,switchToClientMode:b,switchToAdminMode:C}=Uy();return Z.useEffect(()=>{(async()=>{try{if(await new Promise(L=>setTimeout(L,1e3)),n&&o){const L=o.role;if(L==="admin"||L==="restaurant_owner"){if(!u){C();return}}else if(!g){b();return}ar({title:"Login realizado com sucesso",description:`Bem-vindo, ${o.full_name||o.email}!`}),e("/",{replace:!0})}else ar({title:"Erro na autenticação",description:"Não foi possível completar o login. Tente novamente.",variant:"destructive"}),e("/login",{replace:!0})}catch(L){console.error("Erro no callback de autenticação:",L),ar({title:"Erro na autenticação",description:"Ocorreu um erro durante o processo de login.",variant:"destructive"}),e("/login",{replace:!0})}})()},[n,o,e,u,g,C,b]),w.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),w.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Finalizando autenticação..."}),w.jsx("p",{className:"text-gray-600",children:"Aguarde enquanto redirecionamos você."})]})})},S3=()=>{const e=jy();return Z.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),w.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:w.jsxs("div",{className:"text-center",children:[w.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),w.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),w.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};var rA="Radio",[JJ,wF]=Jo(rA),[QJ,eQ]=JJ(rA),SF=Z.forwardRef((e,n)=>{const{__scopeRadio:o,name:u,checked:g=!1,required:b,disabled:C,value:i="on",onCheck:L,form:O,...U}=e,[q,G]=Z.useState(null),ie=Ln(n,re=>G(re)),J=Z.useRef(!1),K=q?O||!!q.closest("form"):!0;return w.jsxs(QJ,{scope:o,checked:g,disabled:C,children:[w.jsx(qr.button,{type:"button",role:"radio","aria-checked":g,"data-state":CF(g),"data-disabled":C?"":void 0,disabled:C,value:i,...U,ref:ie,onClick:dr(e.onClick,re=>{g||L==null||L(),K&&(J.current=re.isPropagationStopped(),J.current||re.stopPropagation())})}),K&&w.jsx(tQ,{control:q,bubbles:!J.current,name:u,value:i,checked:g,required:b,disabled:C,form:O,style:{transform:"translateX(-100%)"}})]})});SF.displayName=rA;var TF="RadioIndicator",EF=Z.forwardRef((e,n)=>{const{__scopeRadio:o,forceMount:u,...g}=e,b=eQ(TF,o);return w.jsx(rl,{present:u||b.checked,children:w.jsx(qr.span,{"data-state":CF(b.checked),"data-disabled":b.disabled?"":void 0,...g,ref:n})})});EF.displayName=TF;var tQ=e=>{const{control:n,checked:o,bubbles:u=!0,...g}=e,b=Z.useRef(null),C=JC(o),i=pC(n);return Z.useEffect(()=>{const L=b.current,O=window.HTMLInputElement.prototype,q=Object.getOwnPropertyDescriptor(O,"checked").set;if(C!==o&&q){const G=new Event("click",{bubbles:u});q.call(L,o),L.dispatchEvent(G)}},[C,o,u]),w.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:o,...g,tabIndex:-1,ref:b,style:{...e.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function CF(e){return e?"checked":"unchecked"}var rQ=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],nA="RadioGroup",[nQ,UQ]=Jo(nA,[pb,wF]),AF=pb(),MF=wF(),[iQ,sQ]=nQ(nA),IF=Z.forwardRef((e,n)=>{const{__scopeRadioGroup:o,name:u,defaultValue:g,value:b,required:C=!1,disabled:i=!1,orientation:L,dir:O,loop:U=!0,onValueChange:q,...G}=e,ie=AF(o),J=fm(O),[K,re]=Dl({prop:b,defaultProp:g,onChange:q});return w.jsx(iQ,{scope:o,name:u,required:C,disabled:i,value:K,onValueChange:re,children:w.jsx(Uz,{asChild:!0,...ie,orientation:L,dir:J,loop:U,children:w.jsx(qr.div,{role:"radiogroup","aria-required":C,"aria-orientation":L,"data-disabled":i?"":void 0,dir:J,...G,ref:n})})})});IF.displayName=nA;var PF="RadioGroupItem",RF=Z.forwardRef((e,n)=>{const{__scopeRadioGroup:o,disabled:u,...g}=e,b=sQ(PF,o),C=b.disabled||u,i=AF(o),L=MF(o),O=Z.useRef(null),U=Ln(n,O),q=b.value===g.value,G=Z.useRef(!1);return Z.useEffect(()=>{const ie=K=>{rQ.includes(K.key)&&(G.current=!0)},J=()=>G.current=!1;return document.addEventListener("keydown",ie),document.addEventListener("keyup",J),()=>{document.removeEventListener("keydown",ie),document.removeEventListener("keyup",J)}},[]),w.jsx(Vz,{asChild:!0,...i,focusable:!C,active:q,children:w.jsx(SF,{disabled:C,required:b.required,checked:q,...L,...g,name:b.name,ref:U,onCheck:()=>b.onValueChange(g.value),onKeyDown:dr(ie=>{ie.key==="Enter"&&ie.preventDefault()}),onFocus:dr(g.onFocus,()=>{var ie;G.current&&((ie=O.current)==null||ie.click())})})})});RF.displayName=PF;var oQ="RadioGroupIndicator",kF=Z.forwardRef((e,n)=>{const{__scopeRadioGroup:o,...u}=e,g=MF(o);return w.jsx(EF,{...g,...u,ref:n})});kF.displayName=oQ;var DF=IF,LF=RF,aQ=kF;const b1=Z.forwardRef(({className:e,...n},o)=>w.jsx(DF,{className:Rr("grid gap-2",e),...n,ref:o}));b1.displayName=DF.displayName;const ju=Z.forwardRef(({className:e,...n},o)=>w.jsx(LF,{ref:o,className:Rr("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...n,children:w.jsx(aQ,{className:"flex items-center justify-center",children:w.jsx(bN,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ju.displayName=LF.displayName;const lQ=({onSuccess:e})=>{const[n,o]=Z.useState(""),[u,g]=Z.useState(!1),{cartItems:b,clearCart:C,getCartTotal:i}=ad();nl();const{currentTeam:L}=Vy(),{user:O}=jh(),{subdomain:U,isAdminMode:q}=Uy(),G=async()=>{if(!n.trim()){ar({title:"Erro",description:"Por favor, informe o nome da mesa.",variant:"destructive"});return}if(b.length===0){ar({title:"Erro",description:"Seu carrinho está vazio.",variant:"destructive"});return}g(!0);try{let ie=null;if(!q&&(L!=null&&L.id)){ie=L.id,console.log("Usando team_id do subdomínio:",ie);const{error:ke}=await Qt.rpc("set_current_team_id",{team_id:ie.toString()});ke&&console.warn("Erro ao configurar team_id no Supabase:",ke)}else console.log("Modo admin ou sem team - permitindo pedido sem team_id");const J=i(),K={total:J,delivery_type:"table",table_name:n,status:"pending",restaurant_id:1};ie&&(K.team_id=ie),O!=null&&O.id&&(K.user_id=O.id),console.log("Criando pedido com payload:",K);const{data:re,error:Q}=await Qt.from("orders").insert(K).select().single();if(Q)throw console.error("Erro ao criar pedido:",Q),new Error("Não foi possível criar o pedido");console.log("Pedido criado com sucesso:",re);const ee=b.map(ke=>({order_id:re.id,product_id:ke.id,quantity:ke.quantity,price:ke.price,team_id:ie}));console.log("Criando itens do pedido:",ee);const{error:ue}=await Qt.from("order_items").insert(ee);if(ue)throw console.error("Erro ao criar itens do pedido:",ue),new Error("Não foi possível criar os itens do pedido");console.log("Itens do pedido criados com sucesso");const fe={id:re.id,items:b,total:J,tableName:n,timestamp:new Date().toISOString()},ge=JSON.parse(localStorage.getItem("tableOrders")||"[]");ge.push(fe),localStorage.setItem("tableOrders",JSON.stringify(ge)),ar({title:"Pedido realizado!",description:`Seu pedido para a mesa ${n} foi enviado com sucesso.`}),C(),e&&e()}catch(ie){console.error("Erro ao processar pedido:",ie),ar({title:"Erro",description:"Não foi possível processar seu pedido. Tente novamente.",variant:"destructive"})}finally{g(!1)}};return w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsx(Br,{htmlFor:"table-number",children:"Número da Mesa"}),w.jsx(En,{id:"table-number",placeholder:"Ex: Mesa 5",value:n,onChange:ie=>o(ie.target.value)})]}),w.jsxs("div",{className:"pt-4 border-t",children:[w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{className:"font-medium",children:["R$ ",i().toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-6",children:[w.jsx("span",{className:"font-bold text-lg",children:"Total"}),w.jsxs("span",{className:"font-bold text-lg",children:["R$ ",i().toFixed(2)]})]})]}),w.jsx($t,{onClick:G,className:"w-full bg-menu-primary hover:bg-menu-primary/90",disabled:u,children:u?"Processando...":"Finalizar Pedido"})]})},cQ=({onSuccess:e})=>{const{subtotal:n,cartItems:o,clearCart:u}=ad();nl();const[g,b]=Z.useState(!1),[C,i]=Z.useState(!1),[L,O]=Z.useState("address"),[U,q]=Z.useState("card"),[G,ie]=Z.useState("online"),[J,K]=Z.useState(!1),[re,Q]=Z.useState(""),ee=5,ue=n+ee,[fe,ge]=Z.useState("45603652"),[ke,Ce]=Z.useState("R. Nova"),[Be,dt]=Z.useState("325"),[Qe,qe]=Z.useState("Califórnia"),[He,et]=Z.useState(""),[mt,Ze]=Z.useState("Itabuna"),[Tt,Gt]=Z.useState("BA");Z.useEffect(()=>{const Dt=document.createElement("script");return Dt.src="https://sdk.mercadopago.com/js/v2",Dt.async=!0,document.body.appendChild(Dt),()=>{document.body.removeChild(Dt)}},[]);const ct=async()=>{if(!fe||fe.length!==8){ar({title:"CEP inválido",description:"Por favor, insira um CEP válido com 8 dígitos.",variant:"destructive"});return}i(!0);try{const ir=await(await fetch(`https://viacep.com.br/ws/${fe}/json/`)).json();ir.erro?ar({title:"CEP não encontrado",description:"Não foi possível encontrar o endereço para este CEP.",variant:"destructive"}):(Ce(ir.logradouro),qe(ir.bairro),Ze(ir.localidade),Gt(ir.uf))}catch(Dt){console.error("Erro ao buscar CEP:",Dt),ar({title:"Erro",description:"Ocorreu um erro ao buscar o endereço. Tente novamente.",variant:"destructive"})}finally{i(!1)}},Je=()=>{if(!fe||!ke||!Be||!Qe||!mt||!Tt){ar({title:"Dados incompletos",description:"Por favor, preencha todos os campos obrigatórios.",variant:"destructive"});return}O("payment")},rt=async({paymentMethod:Dt,paymentInfo:ir,deliveryAddress:zr})=>{const br={...{total:ue,restaurant_id:1,status:"pending",delivery_type:"delivery",payment_method:Dt},address:zr,table_name:null};console.log("Payload orderObj:",br);try{const{data:Ht,error:jr}=await Qt.from("orders").insert([br]).select("id");if(jr||!Ht||Ht.length===0)throw console.error("Supabase error detalhe:",jr),console.log("Order payload:",br),new Error("Não foi possível criar o pedido");const wt=Ht[0].id,{error:dn}=await Qt.from("order_items").insert(o.map(rn=>({product_id:rn.id,quantity:rn.quantity,price:rn.price,notes:rn.notes||void 0,order_id:wt})));if(dn)throw console.error("Erro ao criar itens do pedido:",dn),new Error("Não foi possível adicionar os itens ao pedido");u(),e&&e(),ar({title:"Pedido realizado!",description:`Seu pedido foi registrado com sucesso. Pagamento: ${ir}`})}catch(Ht){console.error("Erro ao processar pedido:",Ht),ar({title:"Erro ao processar pedido",description:Ht instanceof Error?Ht.message:"Ocorreu um erro ao processar seu pedido",variant:"destructive"})}finally{b(!1)}},bt=async()=>{(U==="card"||U==="pix")&&window.MercadoPago&&(b(!0),setTimeout(async()=>{await rt({paymentMethod:U,paymentInfo:U==="card"?"Cartão (Mercado Pago)":"Pix (Mercado Pago)",deliveryAddress:{street:ke,number:Be,complement:He||void 0,neighborhood:Qe,city:mt,state:Tt,zipcode:fe}})},2e3))},kt=async()=>{if(G==="online"&&(U==="card"||U==="pix"))await bt();else if(G==="delivery"&&(U==="cash"||U==="card_delivery")){b(!0);const Dt=U==="cash"?J?`Dinheiro (Troco para R$ ${re})`:"Dinheiro (Sem troco)":"Cartão na entrega";await rt({paymentMethod:U,paymentInfo:Dt,deliveryAddress:{street:ke,number:Be,complement:He||void 0,neighborhood:Qe,city:mt,state:Tt,zipcode:fe}})}},At=Dt=>{const ir=Dt.target.value.replace(/\D/g,"");ge(ir)},_r=()=>{fe.length===8&&ct()},cn=Dt=>{const ir=Dt.target.value.replace(/[^\d.,]/g,"");Q(ir)},pr=Dt=>{ie(Dt),q(Dt==="online"?"card":"card_delivery")};return w.jsx("div",{className:"space-y-6",children:L==="address"?w.jsxs("div",{className:"space-y-4",children:[w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"cep",children:"CEP"}),w.jsxs("div",{className:"flex",children:[w.jsx(En,{id:"cep",placeholder:"00000000",value:fe,onChange:At,onBlur:_r,maxLength:8,className:"flex-1",disabled:C}),C&&w.jsx("div",{className:"ml-2 flex items-center",children:w.jsx(r1,{className:"h-5 w-5 animate-spin text-gray-500"})})]})]})}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[w.jsxs("div",{className:"col-span-2 space-y-2",children:[w.jsx(Br,{htmlFor:"endereco",children:"Endereço"}),w.jsx(En,{id:"endereco",value:ke,onChange:Dt=>Ce(Dt.target.value),placeholder:"Rua, Avenida, etc"})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"numero",children:"Número"}),w.jsx(En,{id:"numero",value:Be,onChange:Dt=>dt(Dt.target.value),placeholder:"123"})]})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"bairro",children:"Bairro"}),w.jsx(En,{id:"bairro",value:Qe,onChange:Dt=>qe(Dt.target.value),placeholder:"Bairro"})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"complemento",children:"Complemento (opcional)"}),w.jsx(En,{id:"complemento",value:He,onChange:Dt=>et(Dt.target.value),placeholder:"Apto, Bloco, etc"})]})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"cidade",children:"Cidade"}),w.jsx(En,{id:"cidade",value:mt,onChange:Dt=>Ze(Dt.target.value),placeholder:"Cidade",readOnly:!0})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx(Br,{htmlFor:"estado",children:"Estado"}),w.jsx(En,{id:"estado",value:Tt,onChange:Dt=>Gt(Dt.target.value),placeholder:"UF",readOnly:!0})]})]}),w.jsxs("div",{className:"pt-4 border-t",children:[w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{className:"font-medium",children:["R$ ",n.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),w.jsxs("span",{className:"font-medium",children:["R$ ",ee.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-6",children:[w.jsx("span",{className:"font-bold text-lg",children:"Total"}),w.jsxs("span",{className:"font-bold text-lg",children:["R$ ",ue.toFixed(2)]})]})]}),w.jsx($t,{onClick:Je,className:"w-full bg-menu-primary hover:bg-menu-primary/90",children:"Continuar para pagamento"})]}):w.jsxs("div",{className:"space-y-4",children:[w.jsx("h3",{className:"font-bold text-lg",children:"Forma de pagamento"}),w.jsxs(Vh,{defaultValue:"online",value:G,onValueChange:Dt=>pr(Dt),className:"w-full",children:[w.jsxs(ld,{className:"grid w-full grid-cols-2",children:[w.jsx(cs,{value:"online",children:"Pagar agora"}),w.jsx(cs,{value:"delivery",children:"Pagar na entrega"})]}),w.jsxs(us,{value:"online",className:"mt-4 space-y-4",children:[w.jsxs(b1,{value:U,onValueChange:Dt=>q(Dt),className:"space-y-3",children:[w.jsx(Un,{className:`p-4 cursor-pointer ${U==="card"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"card",id:"card"}),w.jsxs(Br,{htmlFor:"card",className:"flex items-center cursor-pointer",children:[w.jsx(ek,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Cartão de Crédito/Débito"})]})]})}),w.jsx(Un,{className:`p-4 cursor-pointer ${U==="pix"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"pix",id:"pix"}),w.jsxs(Br,{htmlFor:"pix",className:"flex items-center cursor-pointer",children:[w.jsx(b$,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"PIX"})]})]})})]}),w.jsx("div",{id:"mercadopago-checkout",className:"mt-4"})]}),w.jsx(us,{value:"delivery",className:"mt-4 space-y-4",children:w.jsxs(b1,{value:U,onValueChange:Dt=>q(Dt),className:"space-y-3",children:[w.jsx(Un,{className:`p-4 cursor-pointer ${U==="card_delivery"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"card_delivery",id:"card_delivery"}),w.jsxs(Br,{htmlFor:"card_delivery",className:"flex items-center cursor-pointer",children:[w.jsx(ek,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Cartão na entrega"})]})]})}),w.jsxs("div",{children:[w.jsx(Un,{className:`p-4 cursor-pointer ${U==="cash"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"cash",id:"cash"}),w.jsxs(Br,{htmlFor:"cash",className:"flex items-center cursor-pointer",children:[w.jsx(f$,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Dinheiro"})]})]})}),U==="cash"&&w.jsxs("div",{className:"mt-3 pl-2",children:[w.jsxs("div",{className:"flex items-center mb-2",children:[w.jsx("input",{type:"checkbox",id:"needChange",checked:J,onChange:Dt=>K(Dt.target.checked),className:"mr-2"}),w.jsx(Br,{htmlFor:"needChange",children:"Precisa de troco?"})]}),J&&w.jsxs("div",{className:"space-y-1",children:[w.jsx(Br,{htmlFor:"changeAmount",children:"Troco para quanto?"}),w.jsx(En,{id:"changeAmount",value:re,onChange:cn,placeholder:"50,00",className:"w-full"})]})]})]})]})})]}),w.jsxs("div",{className:"pt-4 border-t",children:[w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{className:"font-medium",children:["R$ ",n.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),w.jsxs("span",{className:"font-medium",children:["R$ ",ee.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-6",children:[w.jsx("span",{className:"font-bold text-lg",children:"Total"}),w.jsxs("span",{className:"font-bold text-lg",children:["R$ ",ue.toFixed(2)]})]})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx($t,{variant:"outline",onClick:()=>O("address"),className:"flex-1",children:"Voltar"}),w.jsx($t,{onClick:kt,className:"flex-1 bg-menu-primary hover:bg-menu-primary/90",disabled:g,children:g?w.jsxs(w.Fragment,{children:[w.jsx(r1,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):"Finalizar Pedido"})]})]})})},uQ=({onSuccess:e})=>{const{subtotal:n,clearCart:o}=ad(),u=()=>{ar({title:"Em desenvolvimento",description:"A funcionalidade de retirada na loja estará disponível em breve."})};return w.jsxs("div",{className:"space-y-6",children:[w.jsx("div",{className:"p-4 bg-gray-50 rounded-md",children:w.jsx("p",{className:"text-gray-600",children:"Esta funcionalidade está em desenvolvimento. Em breve você poderá realizar pedidos para retirada na loja."})}),w.jsxs("div",{className:"pt-4 border-t",children:[w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{className:"font-medium",children:["R$ ",n.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-6",children:[w.jsx("span",{className:"font-bold text-lg",children:"Total"}),w.jsxs("span",{className:"font-bold text-lg",children:["R$ ",n.toFixed(2)]})]})]}),w.jsx($t,{onClick:u,className:"w-full bg-menu-primary hover:bg-menu-primary/90",disabled:!0,children:"Em breve disponível"})]})},dQ=({onBack:e})=>{const[n,o]=Z.useState(null),{subtotal:u,closeCart:g}=ad(),b=()=>{n?o(null):e()},C=()=>{switch(n){case"table":return w.jsx(lQ,{onSuccess:()=>g()});case"delivery":return w.jsx(cQ,{onSuccess:()=>g()});case"pickup":return w.jsx(uQ,{onSuccess:()=>g()});default:return null}};return w.jsxs("div",{className:"h-full flex flex-col",children:[w.jsxs("div",{className:"p-4 flex items-center justify-between border-b",children:[w.jsxs("h2",{className:"text-xl font-bold flex items-center",children:[w.jsx(n1,{className:"mr-2"})," Checkout"]}),w.jsx($t,{variant:"ghost",size:"icon",onClick:b,className:"rounded-full","aria-label":"Voltar",children:w.jsx(vN,{className:"h-5 w-5"})})]}),w.jsx("div",{className:"flex-grow overflow-auto p-4",children:n?C():w.jsxs("div",{className:"mb-8",children:[w.jsx("h3",{className:"text-lg font-medium mb-4",children:"Forma de entrega"}),w.jsxs(b1,{value:n||"",onValueChange:i=>o(i),className:"space-y-3",children:[w.jsx("div",{children:w.jsx(Un,{className:`p-4 cursor-pointer ${n==="table"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"table",id:"table"}),w.jsxs(Br,{htmlFor:"table",className:"flex items-center cursor-pointer",children:[w.jsx(sC,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Estou na loja"})]})]})})}),w.jsx("div",{children:w.jsx(Un,{className:`p-4 cursor-pointer ${n==="delivery"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"delivery",id:"delivery"}),w.jsxs(Br,{htmlFor:"delivery",className:"flex items-center cursor-pointer",children:[w.jsx(p$,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Receber em casa"})]})]})})}),w.jsx("div",{children:w.jsx(Un,{className:`p-4 cursor-pointer ${n==="pickup"?"border-menu-primary ring-2 ring-menu-primary":""}`,children:w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ju,{value:"pickup",id:"pickup"}),w.jsxs(Br,{htmlFor:"pickup",className:"flex items-center cursor-pointer",children:[w.jsx(wT,{className:"h-4 w-4 mr-2"}),w.jsx("span",{children:"Retirar na loja"})]})]})})})]})]})})]})},hQ=()=>{const[e,n]=Z.useState(!1),{cartItems:o,cartOpen:u,toggleCart:g,removeFromCart:b,updateQuantity:C,clearCart:i,subtotal:L,closeCart:O}=ad(),U=()=>{if(o.length===0){ar({title:"Carrinho vazio",description:"Adicione itens ao carrinho para finalizar o pedido."});return}n(!0)},q=()=>{n(!1)};return w.jsx("div",{className:`fixed inset-0 z-50 bg-black/50 ${u?"opacity-100":"opacity-0 pointer-events-none"} transition-opacity duration-300`,children:w.jsx("div",{className:`fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-xl ${u?"translate-x-0 animate-cart-slide-in":"translate-x-full animate-cart-slide-out"} transition-transform duration-300 flex flex-col`,children:e?w.jsx(dQ,{onBack:q}):w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"p-4 flex items-center justify-between border-b",children:[w.jsxs("h2",{className:"text-xl font-bold flex items-center",children:[w.jsx(n1,{className:"mr-2"})," Carrinho"]}),w.jsx($t,{variant:"ghost",size:"icon",onClick:g,children:w.jsx(Yu,{className:"h-6 w-6"})})]}),w.jsx("div",{className:"flex-grow overflow-auto p-4",children:o.length===0?w.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-4",children:[w.jsx(n1,{className:"h-12 w-12 text-gray-300 mb-4"}),w.jsx("h3",{className:"text-lg font-medium text-gray-500",children:"Seu carrinho está vazio"}),w.jsx("p",{className:"text-gray-400 mt-2 mb-6",children:"Adicione itens do cardápio para começar"}),w.jsx($t,{onClick:g,children:"Continuar comprando"})]}):w.jsx("div",{className:"space-y-4",children:o.map(G=>w.jsx(Un,{className:"p-4",children:w.jsxs("div",{className:"flex gap-3",children:[w.jsx("img",{src:G.imageUrl||G.image,alt:G.name,className:"h-20 w-20 object-cover rounded-md"}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("h3",{className:"font-medium",children:G.name}),w.jsx($t,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-400",onClick:()=>b(G.id,G.notes),children:w.jsx(Yu,{className:"h-4 w-4"})})]}),w.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["R$ ",G.price.toFixed(2)]}),G.notes&&w.jsx("div",{className:"text-sm text-red-500 italic mt-1",children:G.notes}),w.jsxs("div",{className:"flex items-center justify-between mt-2",children:[w.jsxs("div",{className:"flex items-center border rounded",children:[w.jsx($t,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",onClick:()=>C(G.id,G.quantity-1,G.notes),children:w.jsx(wN,{className:"h-4 w-4"})}),w.jsx("span",{className:"w-8 text-center",children:G.quantity}),w.jsx($t,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",onClick:()=>C(G.id,G.quantity+1,G.notes),children:w.jsx(Ah,{className:"h-4 w-4"})})]}),w.jsxs("div",{className:"font-medium",children:["R$ ",(G.price*G.quantity).toFixed(2)]})]})]})]})},G.id))})}),o.length>0&&w.jsxs("div",{className:"p-4 border-t",children:[w.jsxs("div",{className:"flex justify-between mb-2",children:[w.jsx("span",{className:"text-gray-600",children:"Subtotal"}),w.jsxs("span",{className:"font-medium",children:["R$ ",L.toFixed(2)]})]}),w.jsxs("div",{className:"flex justify-between mb-4",children:[w.jsx("span",{className:"text-gray-600",children:"Taxa de entrega"}),w.jsx("span",{className:"font-medium",children:"R$ 5.00"})]}),w.jsx(pm,{className:"my-3"}),w.jsxs("div",{className:"flex justify-between mb-4",children:[w.jsx("span",{className:"font-bold text-lg",children:"Total"}),w.jsxs("span",{className:"font-bold text-lg",children:["R$ ",(L+5).toFixed(2)]})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx($t,{className:"w-full bg-menu-primary hover:bg-menu-primary/90",onClick:U,children:"Finalizar pedido"}),w.jsx($t,{variant:"outline",className:"w-full",onClick:i,children:"Limpar carrinho"})]})]})]})})})},fQ=({showCreateButton:e=!0,className:n=""})=>{const{teamId:o,setTeamId:u}=sb(),{toast:g}=j1(),[b,C]=Z.useState([]),[i,L]=Z.useState(!0),[O,U]=Z.useState(!1),[q,G]=Z.useState(""),[ie,J]=Z.useState(""),[K,re]=Z.useState(!1);Z.useEffect(()=>{Q()},[]);const Q=async()=>{try{L(!0);const{data:ge,error:ke}=await Qt.from("restaurants").select("team_id, name").not("team_id","is",null);if(ke){console.error("Erro ao buscar teams:",ke);return}const Ce=(ge==null?void 0:ge.reduce((Be,dt)=>(!Be.find(qe=>qe.id===dt.team_id)&&dt.team_id&&Be.push({id:dt.team_id,name:`Team ${dt.team_id}`,description:`Grupo de restaurantes ${dt.team_id}`,created_at:new Date().toISOString()}),Be),[]))||[];Ce.find(Be=>Be.id==="default-team")||Ce.unshift({id:"default-team",name:"Team Padrão",description:"Team padrão do sistema",created_at:new Date().toISOString()}),C(Ce)}catch(ge){console.error("Erro ao buscar teams:",ge)}finally{L(!1)}},ee=ge=>{var ke;u(ge),g({title:"Team alterado",description:`Agora você está visualizando o ${((ke=b.find(Ce=>Ce.id===ge))==null?void 0:ke.name)||ge}`})},ue=async()=>{if(!q.trim()){g({title:"Erro",description:"Nome do team é obrigatório",variant:"destructive"});return}try{re(!0);const ge=`team-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,{error:ke}=await Qt.from("restaurants").insert({name:q,description:ie||`Restaurante do ${q}`,team_id:ge,owner_id:"system"});if(ke)throw ke;g({title:"Team criado com sucesso!",description:`O team "${q}" foi criado e está pronto para uso.`}),G(""),J(""),U(!1),await Q(),u(ge)}catch(ge){console.error("Erro ao criar team:",ge),g({title:"Erro ao criar team",description:"Ocorreu um erro ao criar o team. Tente novamente.",variant:"destructive"})}finally{re(!1)}},fe=b.find(ge=>ge.id===o);return w.jsxs("div",{className:`flex items-center gap-2 ${n}`,children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(M_,{className:"h-4 w-4 text-gray-500"}),w.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Team:"})]}),w.jsxs(Ep,{value:o||"",onValueChange:ee,disabled:i,children:[w.jsx(ph,{className:"w-[200px]",children:w.jsx(Cp,{placeholder:i?"Carregando...":"Selecione um team"})}),w.jsx(mh,{children:b.map(ge=>w.jsx(ss,{value:ge.id,children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(TT,{className:"h-3 w-3"}),w.jsx("span",{children:ge.name})]})},ge.id))})]}),e&&w.jsxs(Nl,{open:O,onOpenChange:U,children:[w.jsx(zj,{asChild:!0,children:w.jsxs($t,{variant:"outline",size:"sm",children:[w.jsx(Ah,{className:"h-4 w-4 mr-1"}),"Novo Team"]})}),w.jsxs(tl,{children:[w.jsxs(Ol,{children:[w.jsx(zl,{children:"Criar Novo Team"}),w.jsx(_b,{children:"Crie um novo team para organizar seus restaurantes e dados."})]}),w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsx(Br,{htmlFor:"team-name",children:"Nome do Team"}),w.jsx(En,{id:"team-name",value:q,onChange:ge=>G(ge.target.value),placeholder:"Ex: Restaurante Central"})]}),w.jsxs("div",{children:[w.jsx(Br,{htmlFor:"team-description",children:"Descrição (opcional)"}),w.jsx(En,{id:"team-description",value:ie,onChange:ge=>J(ge.target.value),placeholder:"Descrição do team..."})]}),w.jsxs("div",{className:"flex justify-end gap-2",children:[w.jsx($t,{variant:"outline",onClick:()=>U(!1),disabled:K,children:"Cancelar"}),w.jsx($t,{onClick:ue,disabled:K,children:K?"Criando...":"Criar Team"})]})]})]})]}),fe&&w.jsxs("div",{className:"text-xs text-gray-500",children:["(",fe.description,")"]})]})},pQ=()=>{const{teamId:e,isReady:n}=sb(),{teamSupabase:o}=Zj(),{isAdminMode:u,isLoading:g}=Vy(),{isAdminMode:b,isLoading:C}=Uy(),{createTeam:i}=YC(),{toast:L}=j1(),[O,U]=Z.useState({totalRestaurants:0,totalProducts:0,totalOrders:0,totalRevenue:0}),[q,G]=Z.useState(!0),[ie,J]=Z.useState([]),[K,re]=Z.useState([]),[Q,ee]=Z.useState([]),[ue,fe]=Z.useState(!1),[ge,ke]=Z.useState({name:"",slug:"",email:"",phone:"",password:"",generatePassword:!1,plan:"inicial"}),Ce=tr.useMemo(()=>{const Ze=window.location.hostname;return Ze==="localhost"||Ze==="127.0.0.1"||Ze==="app.delliapp.com.br"||b},[b]);Z.useEffect(()=>{!g&&!C&&(Ce||n&&e&&o)&&Be()},[n,e,o,g,C,Ce]);const Be=async()=>{try{G(!0);let Ze=[],Tt=[],Gt=[];if(Ce)try{const{supabase:Je}=await Ih(async()=>{const{supabase:At}=await Promise.resolve().then(()=>YW);return{supabase:At}},void 0);console.log("Carregando dados em modo admin geral (app.delliapp.com.br ou localhost)...");const[rt,bt,kt]=await Promise.all([Je.from("restaurants").select("*"),Je.from("products").select("*"),Je.from("orders").select("*")]);console.log("Resultados obtidos:",{restaurants:rt,products:bt,orders:kt}),rt.error&&console.error("Erro ao carregar restaurantes:",rt.error),bt.error&&console.error("Erro ao carregar produtos:",bt.error),kt.error&&console.error("Erro ao carregar pedidos:",kt.error),Ze=rt.data||[],Tt=bt.data||[],Gt=kt.data||[],Ze.length===0&&Tt.length===0&&Gt.length===0&&(console.log("Nenhum dado encontrado no modo admin geral, criando dados fictícios para teste..."),Ze=[{id:1,name:"Restaurante Teste 1",description:"Descrição do restaurante teste 1",team_id:"1",created_at:new Date().toISOString()},{id:2,name:"Restaurante Teste 2",description:"Descrição do restaurante teste 2",team_id:"1",created_at:new Date().toISOString()}],Tt=[{id:1,name:"Produto Teste 1",description:"Descrição do produto teste 1",price:19.9,available:!0,category:"Categoria 1",restaurant_id:1,created_at:new Date().toISOString()},{id:2,name:"Produto Teste 2",description:"Descrição do produto teste 2",price:29.9,available:!0,category:"Categoria 2",restaurant_id:1,created_at:new Date().toISOString()}],Gt=[{id:1,total_amount:19.9,status:"concluído",created_at:new Date().toISOString(),restaurant_id:1},{id:2,total_amount:29.9,status:"em andamento",created_at:new Date().toISOString(),restaurant_id:1}])}catch(Je){console.error("Erro ao carregar dados do Supabase:",Je),L({title:"Erro ao carregar dados",description:"Ocorreu um erro ao carregar os dados. Carregando dados fictícios para teste.",variant:"destructive"}),Ze=[{id:1,name:"Restaurante Teste (Fallback)",description:"Descrição do restaurante teste",team_id:"1",created_at:new Date().toISOString()}],Tt=[{id:1,name:"Produto Teste (Fallback)",description:"Descrição do produto teste",price:19.9,available:!0,category:"Categoria 1",restaurant_id:1,created_at:new Date().toISOString()}],Gt=[{id:1,total_amount:19.9,status:"concluído",created_at:new Date().toISOString(),restaurant_id:1}]}else if(o){const[Je,rt,bt]=await Promise.all([o.getRestaurants(),o.getProducts(),o.getOrders()]);Ze=Je||[],Tt=rt||[],Gt=bt||[]}J(Ze),re(Tt),ee(Gt);const ct=Gt.reduce((Je,rt)=>Je+(rt.total_amount||0),0);U({totalRestaurants:Ze.length,totalProducts:Tt.length,totalOrders:Gt.length,totalRevenue:ct}),console.log("Dashboard carregado com sucesso:",{restaurants:Ze.length,products:Tt.length,orders:Gt.length,revenue:ct})}catch(Ze){console.error("Erro ao carregar dashboard:",Ze),L({title:"Erro ao carregar dashboard",description:"Ocorreu um erro ao carregar os dados do dashboard.",variant:"destructive"})}finally{G(!1)}},dt=Ze=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Ze),Qe=Ze=>Ze.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),qe=()=>{const Ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let Tt="";for(let Gt=0;Gt<8;Gt++)Tt+=Ze.charAt(Math.floor(Math.random()*Ze.length));return Tt},He=(Ze,Tt)=>{ke(Gt=>{const ct={...Gt,[Ze]:Tt};return Ze==="name"&&typeof Tt=="string"&&(ct.slug=Qe(Tt)),Ze==="generatePassword"&&Tt===!0&&(ct.password=qe()),ct})},et=()=>{const{name:Ze,slug:Tt,email:Gt,phone:ct,password:Je,generatePassword:rt}=ge;return Ze.trim()?Tt.trim()?!Gt.trim()||!Gt.includes("@")?(L({title:"Erro",description:"Email válido é obrigatório",variant:"destructive"}),!1):ct.trim()?!rt&&!Je.trim()?(L({title:"Erro",description:"Senha é obrigatória ou marque para gerar automaticamente",variant:"destructive"}),!1):!0:(L({title:"Erro",description:"Telefone é obrigatório",variant:"destructive"}),!1):(L({title:"Erro",description:"Slug é obrigatório",variant:"destructive"}),!1):(L({title:"Erro",description:"Nome do restaurante é obrigatório",variant:"destructive"}),!1)},mt=async()=>{if(et())try{G(!0);const Ze={name:ge.name,slug:ge.slug,settings:{plan:ge.plan,contact:{email:ge.email,phone:ge.phone}}};if(console.log("Criando restaurante com dados:",Ze),!await i(Ze)){L({title:"Erro",description:"Erro ao criar estabelecimento",variant:"destructive"}),G(!1);return}L({title:"Sucesso!",description:`Estabelecimento "${ge.name}" criado com sucesso!
Acesso: https://${ge.slug}.delliapp.com.br`}),ke({name:"",slug:"",email:"",phone:"",password:"",generatePassword:!1,plan:"inicial"}),fe(!1),Be()}catch(Ze){console.error("Erro ao criar restaurante:",Ze),L({title:"Erro",description:"Erro inesperado ao criar estabelecimento",variant:"destructive"})}finally{G(!1)}};return g||C||!Ce&&!n?w.jsx("div",{className:"flex items-center justify-center min-h-screen",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),w.jsx("p",{children:"Carregando..."})]})}):w.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:w.jsxs("div",{className:"max-w-7xl mx-auto",children:[w.jsxs("div",{className:"mb-8",children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{children:[w.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard SAAS"}),w.jsx("p",{className:"text-gray-600",children:"Gerencie seus clientes e teams"})]}),w.jsx(fQ,{className:""})]}),Ce?w.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(eS,{className:"h-5 w-5 text-green-600"}),w.jsx("span",{className:"font-medium text-green-900",children:"Modo:"}),w.jsx(Ti,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Admin Geral (Local)"}),w.jsx("span",{className:"text-sm text-green-700 ml-2",children:"Acesso total a todos os dados"})]})}):e&&w.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(TT,{className:"h-5 w-5 text-blue-600"}),w.jsx("span",{className:"font-medium text-blue-900",children:"Team Ativo:"}),w.jsx(Ti,{variant:"secondary",children:e})]})})]}),w.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[w.jsxs(Un,{children:[w.jsxs(wi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[w.jsx(Si,{className:"text-sm font-medium",children:"Restaurantes"}),w.jsx(wT,{className:"h-4 w-4 text-muted-foreground"})]}),w.jsxs(fi,{children:[w.jsx("div",{className:"text-2xl font-bold",children:O.totalRestaurants}),w.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de estabelecimentos"})]})]}),w.jsxs(Un,{children:[w.jsxs(wi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[w.jsx(Si,{className:"text-sm font-medium",children:"Produtos"}),w.jsx(Mx,{className:"h-4 w-4 text-muted-foreground"})]}),w.jsxs(fi,{children:[w.jsx("div",{className:"text-2xl font-bold",children:O.totalProducts}),w.jsx("p",{className:"text-xs text-muted-foreground",children:"Itens no cardápio"})]})]}),w.jsxs(Un,{children:[w.jsxs(wi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[w.jsx(Si,{className:"text-sm font-medium",children:"Pedidos"}),w.jsx(tS,{className:"h-4 w-4 text-muted-foreground"})]}),w.jsxs(fi,{children:[w.jsx("div",{className:"text-2xl font-bold",children:O.totalOrders}),w.jsx("p",{className:"text-xs text-muted-foreground",children:"Total de pedidos"})]})]}),w.jsxs(Un,{children:[w.jsxs(wi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[w.jsx(Si,{className:"text-sm font-medium",children:"Receita"}),w.jsx(tS,{className:"h-4 w-4 text-muted-foreground"})]}),w.jsxs(fi,{children:[w.jsx("div",{className:"text-2xl font-bold",children:dt(O.totalRevenue)}),w.jsx("p",{className:"text-xs text-muted-foreground",children:"Receita total"})]})]})]}),w.jsxs(Vh,{defaultValue:"restaurants",className:"space-y-4",children:[w.jsxs(ld,{children:[w.jsx(cs,{value:"restaurants",children:"Restaurantes"}),w.jsx(cs,{value:"products",children:"Produtos"}),w.jsx(cs,{value:"orders",children:"Pedidos"}),w.jsx(cs,{value:"settings",children:"Configurações"})]}),w.jsx(us,{value:"restaurants",children:w.jsxs(Un,{children:[w.jsx(wi,{children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx(Si,{children:"Restaurantes do Team"}),w.jsx(ls,{children:"Gerencie os restaurantes deste team"})]}),w.jsxs(Nl,{open:ue,onOpenChange:fe,children:[w.jsx(zj,{asChild:!0,children:w.jsxs($t,{children:[w.jsx(Ah,{className:"h-4 w-4 mr-2"}),"Novo Restaurante"]})}),w.jsxs(tl,{className:"sm:max-w-[600px]",children:[w.jsxs(Ol,{children:[w.jsx(zl,{children:"Cadastrar Novo Estabelecimento"}),w.jsx(_b,{children:"Crie um novo cliente/tenant do SaaS. O estabelecimento terá acesso através do subdomínio gerado."})]}),w.jsxs("div",{className:"grid gap-4 py-4",children:[w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"name",children:"Nome do Restaurante *"}),w.jsx(En,{id:"name",value:ge.name,onChange:Ze=>He("name",Ze.target.value),placeholder:"Ex: Padaria do João"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"slug",children:"Slug (Subdomínio) *"}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(En,{id:"slug",value:ge.slug,onChange:Ze=>He("slug",Ze.target.value),placeholder:"padaria-joao"}),w.jsx("span",{className:"text-sm text-gray-500",children:".delliapp.com.br"})]}),w.jsxs("p",{className:"text-xs text-gray-500",children:["URL de acesso: https://",ge.slug||"seu-slug",".delliapp.com.br"]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"email",children:"Email do Responsável *"}),w.jsx(En,{id:"email",type:"email",value:ge.email,onChange:Ze=>He("email",Ze.target.value),placeholder:"joao@padaria.com"})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"phone",children:"Telefone *"}),w.jsx(En,{id:"phone",value:ge.phone,onChange:Ze=>He("phone",Ze.target.value),placeholder:"(11) 99999-9999"})]})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"password",children:"Senha"}),w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("input",{type:"checkbox",id:"generatePassword",checked:ge.generatePassword,onChange:Ze=>He("generatePassword",Ze.target.checked),className:"rounded"}),w.jsx(Br,{htmlFor:"generatePassword",className:"text-sm",children:"Gerar senha temporária automaticamente"})]}),!ge.generatePassword&&w.jsx(En,{id:"password",type:"password",value:ge.password,onChange:Ze=>He("password",Ze.target.value),placeholder:"Digite uma senha"}),ge.generatePassword&&ge.password&&w.jsxs("div",{className:"p-2 bg-gray-50 rounded border",children:[w.jsx("p",{className:"text-sm text-gray-600",children:"Senha gerada:"}),w.jsx("p",{className:"font-mono text-sm",children:ge.password})]})]})]}),w.jsxs("div",{className:"grid gap-2",children:[w.jsx(Br,{htmlFor:"plan",children:"Plano *"}),w.jsxs(Ep,{value:ge.plan,onValueChange:Ze=>He("plan",Ze),children:[w.jsx(ph,{children:w.jsx(Cp,{placeholder:"Selecione um plano"})}),w.jsxs(mh,{children:[w.jsx(ss,{value:"inicial",children:"Plano Inicial"}),w.jsx(ss,{value:"delivery-standard",children:"Plano Delivery Standard"}),w.jsx(ss,{value:"seu-app",children:"Plano Seu APP"})]})]}),w.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[ge.plan==="inicial"&&w.jsx("p",{children:"Funcionalidades básicas (em definição)"}),ge.plan==="delivery-standard"&&w.jsx("p",{children:"Funcionalidades de delivery (em definição)"}),ge.plan==="seu-app"&&w.jsx("p",{children:"Acesso completo ao sistema (exceto dashboard SaaS)"})]})]})]}),w.jsxs("div",{className:"flex justify-end gap-2",children:[w.jsx($t,{variant:"outline",onClick:()=>fe(!1),disabled:q,children:"Cancelar"}),w.jsx($t,{onClick:mt,disabled:q,children:q?"Criando...":"Criar Estabelecimento"})]})]})]})]})}),w.jsx(fi,{children:q?w.jsxs("div",{className:"text-center py-8",children:[w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),w.jsx("p",{children:"Carregando restaurantes..."})]}):ie.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(wT,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),w.jsx("p",{className:"text-gray-500",children:"Nenhum restaurante encontrado"})]}):w.jsx("div",{className:"space-y-4",children:ie.map(Ze=>w.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"font-medium",children:Ze.name}),w.jsx("p",{className:"text-sm text-gray-500",children:Ze.description}),w.jsxs(Ti,{variant:"outline",className:"mt-1",children:["Team: ",Ze.team_id]})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx($t,{variant:"outline",size:"sm",children:w.jsx(bT,{className:"h-4 w-4"})}),w.jsx($t,{variant:"outline",size:"sm",children:w.jsx(oC,{className:"h-4 w-4"})}),w.jsx($t,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:w.jsx($1,{className:"h-4 w-4"})})]})]},Ze.id))})})]})}),w.jsx(us,{value:"products",children:w.jsxs(Un,{children:[w.jsx(wi,{children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{children:[w.jsx(Si,{children:"Produtos do Team"}),w.jsx(ls,{children:"Gerencie os produtos deste team"})]}),w.jsxs($t,{children:[w.jsx(Ah,{className:"h-4 w-4 mr-2"}),"Novo Produto"]})]})}),w.jsxs(fi,{children:[q?w.jsxs("div",{className:"text-center py-8",children:[w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),w.jsx("p",{children:"Carregando produtos..."})]}):K.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(Mx,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),w.jsx("p",{className:"text-gray-500",children:"Nenhum produto encontrado"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:K.slice(0,6).map(Ze=>w.jsxs("div",{className:"border rounded-lg p-4",children:[w.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:Ze.image_url?w.jsx("img",{src:Ze.image_url,alt:Ze.name,className:"w-full h-full object-cover rounded-lg"}):w.jsx(Mx,{className:"h-8 w-8 text-gray-400"})}),w.jsx("h3",{className:"font-medium mb-1",children:Ze.name}),w.jsx("p",{className:"text-sm text-gray-500 mb-2",children:Ze.description}),w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("span",{className:"font-bold text-green-600",children:dt(Ze.price)}),w.jsx(Ti,{variant:Ze.available?"default":"secondary",children:Ze.available?"Disponível":"Indisponível"})]})]},Ze.id))}),K.length>6&&w.jsx("div",{className:"text-center mt-4",children:w.jsxs($t,{variant:"outline",children:["Ver todos os ",K.length," produtos"]})})]})]})}),w.jsx(us,{value:"orders",children:w.jsxs(Un,{children:[w.jsxs(wi,{children:[w.jsx(Si,{children:"Pedidos Recentes"}),w.jsx(ls,{children:"Últimos pedidos do team"})]}),w.jsx(fi,{children:q?w.jsxs("div",{className:"text-center py-8",children:[w.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),w.jsx("p",{children:"Carregando pedidos..."})]}):Q.length===0?w.jsxs("div",{className:"text-center py-8",children:[w.jsx(tS,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),w.jsx("p",{className:"text-gray-500",children:"Nenhum pedido encontrado"})]}):w.jsx("div",{className:"space-y-4",children:Q.slice(0,10).map(Ze=>w.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[w.jsxs("div",{children:[w.jsxs("h3",{className:"font-medium",children:["Pedido #",Ze.id.toString().slice(0,8)]}),w.jsx("p",{className:"text-sm text-gray-500",children:new Date(Ze.created_at).toLocaleDateString("pt-BR")})]}),w.jsxs("div",{className:"text-right",children:[w.jsx("p",{className:"font-bold",children:dt(Ze.total_amount||0)}),w.jsx(Ti,{variant:Ze.status==="completed"?"default":"secondary",children:Ze.status||"Pendente"})]})]},Ze.id))})})]})}),w.jsx(us,{value:"settings",children:w.jsxs(Un,{children:[w.jsxs(wi,{children:[w.jsx(Si,{children:Ce?"Configurações do Sistema":"Configurações do Team"}),w.jsx(ls,{children:Ce?"Gerencie as configurações globais do sistema":"Gerencie as configurações deste team"})]}),w.jsx(fi,{children:w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{children:[w.jsx("h3",{className:"font-medium mb-2",children:Ce?"Informações do Sistema":"Informações do Team"}),w.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:Ce?w.jsxs(w.Fragment,{children:[w.jsxs("p",{children:[w.jsx("strong",{children:"Modo:"})," Admin Geral (Ambiente Local)"]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Hostname:"})," ",window.location.hostname]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Restaurantes:"})," ",O.totalRestaurants]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Produtos:"})," ",O.totalProducts]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Pedidos:"})," ",O.totalOrders]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Receita Total:"})," ",dt(O.totalRevenue)]})]}):w.jsxs(w.Fragment,{children:[w.jsxs("p",{children:[w.jsx("strong",{children:"ID do Team:"})," ",e]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Restaurantes:"})," ",O.totalRestaurants]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Produtos:"})," ",O.totalProducts]}),w.jsxs("p",{children:[w.jsx("strong",{children:"Total de Pedidos:"})," ",O.totalOrders]})]})})]}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-lg font-medium mb-2",children:"Ações"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsxs($t,{variant:"outline",onClick:Be,children:[w.jsx(eS,{className:"h-4 w-4 mr-2"}),"Recarregar Dados"]}),w.jsxs($t,{variant:"outline",children:[w.jsx(eS,{className:"h-4 w-4 mr-2"}),"Configurações Avançadas"]}),Ce&&w.jsxs($t,{variant:"outline",className:"bg-green-50 hover:bg-green-100",children:[w.jsx(TT,{className:"h-4 w-4 mr-2"}),"Gerenciar Teams"]})]})]})]})})]})})]})]})})},mQ=new k7,gQ=()=>{const{client:e,isLoading:n,error:o,isAdminMode:u}=sZ();return Z.useMemo(()=>{const g=window.location.hostname;return g==="localhost"||g==="127.0.0.1"},[]),n?w.jsx("div",{className:"flex items-center justify-center min-h-screen",children:w.jsxs("div",{className:"text-center",children:[w.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900 mx-auto"}),w.jsx("p",{className:"mt-4 text-lg",children:"Carregando..."})]})}):!u&&o?w.jsx("div",{className:"flex items-center justify-center min-h-screen",children:w.jsxs("div",{className:"text-center",children:[w.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Cliente não encontrado"}),w.jsx("p",{className:"text-gray-600",children:o}),w.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Verifique se o subdomínio está correto."})]})}):w.jsxs(w.Fragment,{children:[w.jsx(UK,{}),w.jsx(S9,{children:u?w.jsxs(w.Fragment,{children:[w.jsx(Di,{path:"/",element:w.jsx(c3,{})}),w.jsx(Di,{path:"/order-management",element:w.jsx(h3,{})}),w.jsx(Di,{path:"/kitchen-management",element:w.jsx(m3,{})}),w.jsx(Di,{path:"/order-tracking/:orderId?",element:w.jsx(p3,{})}),w.jsx(Di,{path:"/product-management",element:w.jsx(g3,{})}),w.jsx(Di,{path:"/user-management",element:w.jsx(v3,{})}),w.jsx(Di,{path:"/api-management",element:w.jsx(x3,{})}),w.jsx(Di,{path:"/dashboard-saas",element:w.jsx(pQ,{})}),w.jsx(Di,{path:"/login",element:w.jsx(b3,{})}),w.jsx(Di,{path:"/auth/callback",element:w.jsx(w3,{})}),w.jsx(Di,{path:"*",element:w.jsx(S3,{})})]}):w.jsxs(w.Fragment,{children:[w.jsx(Di,{path:"/",element:w.jsx(c3,{})}),w.jsx(Di,{path:"/order-management",element:w.jsx(h3,{})}),w.jsx(Di,{path:"/kitchen-management",element:w.jsx(m3,{})}),w.jsx(Di,{path:"/order-tracking/:orderId?",element:w.jsx(p3,{})}),w.jsx(Di,{path:"/product-management",element:w.jsx(g3,{})}),w.jsx(Di,{path:"/user-management",element:w.jsx(v3,{})}),w.jsx(Di,{path:"/api-management",element:w.jsx(x3,{})}),w.jsx(Di,{path:"/login",element:w.jsx(b3,{})}),w.jsx(Di,{path:"/auth/callback",element:w.jsx(w3,{})}),w.jsx(Di,{path:"*",element:w.jsx(S3,{})})]})}),w.jsx(iz,{}),w.jsx(hQ,{})]})},_Q=()=>w.jsx(L7,{client:mQ,children:w.jsxs(c7,{children:[w.jsx(lG,{}),w.jsx(zG,{}),w.jsx(P9,{children:w.jsx(QW,{children:w.jsx(eZ,{children:w.jsx(oZ,{children:w.jsx(nZ,{children:w.jsx(rZ,{children:w.jsxs(tZ,{children:[w.jsx(gQ,{}),w.jsx(iz,{})]})})})})})})})]})});HL(document.getElementById("root")).render(w.jsx(_Q,{}));export{nE as g};
